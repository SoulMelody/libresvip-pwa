import{r as n,u as T,a as x,j as m,c as E,l as y}from"./index-B_CN4CJH.js";const L=E("div",{target:"exyuj7n1"})(()=>({lineHeight:0}),""),h=E("audio",{target:"exyuj7n0"})(({theme:r})=>({width:"100%",height:r.sizes.minElementHeight,margin:0,padding:0}),""),j=y.getLogger("Audio");function S({element:r,endpoints:d,elementMgr:a}){const s=n.useRef(null),{startTime:o,endTime:i,loop:u,autoplay:f}=r,g=n.useMemo(()=>{if(!r.id)return!0;const e=a.getElementState(r.id,"preventAutoplay");return e||a.setElementState(r.id,"preventAutoplay",!0),e??!1},[r.id,a]);n.useEffect(()=>{s.current&&(s.current.currentTime=o)},[o]),n.useEffect(()=>{const e=s.current,t=()=>{e&&(e.currentTime=r.startTime)};return e&&e.addEventListener("loadedmetadata",t),()=>{e&&e.removeEventListener("loadedmetadata",t)}},[r]),n.useEffect(()=>{const e=s.current;if(!e)return;let t=!1;const l=()=>{i>0&&e.currentTime>=i&&(u?(e.currentTime=o||0,e.play()):t||(t=!0,e.pause()))};return i>0&&e.addEventListener("timeupdate",l),()=>{e&&i>0&&e.removeEventListener("timeupdate",l)}},[i,u,o]),n.useEffect(()=>{const e=s.current;if(!e)return;const t=()=>{u&&(e.currentTime=o||0,e.play())};return e.addEventListener("ended",t),()=>{e&&e.removeEventListener("ended",t)}},[u,o]);const c=T(r.url),p=x(c),v=d.buildMediaURL(c),A=e=>{const t=e.currentTarget.src;j.error(`Client Error: Audio source error - ${t}`),d.sendClientErrorToHost("Audio","Audio source failed to load","onerror triggered",t)};return m.jsx(L,{children:m.jsx(h,{className:"stAudio","data-testid":"stAudio",ref:s,controls:!0,autoPlay:f&&!g,src:v,onError:A,crossOrigin:p})})}const M=n.memo(S);export{M as default};
