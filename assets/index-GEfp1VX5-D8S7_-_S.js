import{cd as $,r as d,a$ as O,bY as K,ce as z,w as g,b as u,b_ as _,bZ as Y,j as l,c as p,bV as q,bW as G,cf as Z,bX as J,bK as Q,a6 as ee,c1 as f,bH as te,bE as x,bR as ie,c2 as m,E as b,e as S}from"./index-QDZV3Rd1.js";import{d as se}from"./FormClearHelper-B_V_qF_E-ClRfNiDJ.js";import{z as le,k as ae,X as ne,y as oe,j as U,u as w,H as re,K as de}from"./FileHelper-DFhaQ7vk-CBp4xxST.js";import{U as pe,c as ce}from"./ProgressBar-C18DZCuM-DWS9EKoQ.js";import{o as he}from"./Hooks-BJjV32tK-Cb2R8ovn.js";import{t as F}from"./UploadFileInfo-B5SttewO-BfvME59S.js";var I=d.forwardRef(function(e,i){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,S({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:i}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});I.displayName="ChevronLeft";var v=d.forwardRef(function(e,i){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,S({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:i}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});v.displayName="ChevronRight";var C=d.forwardRef(function(e,i){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,S({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:i}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});C.displayName="CloudUpload";var B=d.forwardRef(function(e,i){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,S({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:i}),d.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});B.displayName="Error";const M=p("section",{target:"e1b2p2ww16"})(({isDisabled:e,theme:i})=>({display:"flex",alignItems:"center",padding:i.spacing.lg,backgroundColor:i.colors.secondaryBg,borderRadius:i.radii.default,border:i.colors.widgetBorderColor?`${i.sizes.borderWidth} solid ${i.colors.widgetBorderColor}`:void 0,height:i.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${i.colors.primary}`},cursor:e?"not-allowed":"pointer"}),""),E=p("div",{target:"e1b2p2ww15"})({name:"9xni5b",styles:"margin-right:auto;align-items:center;display:flex"}),V=p("span",{target:"e1b2p2ww14"})(({theme:e})=>({color:e.colors.darkenedBgMix100,marginRight:e.spacing.lg}),""),L=p("span",{target:"e1b2p2ww13"})(({theme:e,disabled:i})=>({color:i?e.colors.fadedText40:e.colors.bodyText}),""),ge=p("span",{target:"e1b2p2ww12"})(({theme:e,disabled:i})=>({fontSize:e.fontSizes.sm,color:i?e.colors.fadedText40:e.colors.fadedText60}),""),me=p("div",{target:"e1b2p2ww11"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),A=p("div",{target:"e1b2p2ww10"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg}),""),ue=p("ul",{target:"e1b2p2ww9"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none}),""),D=p("li",{target:"e1b2p2ww8"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none}),""),H=p("div",{target:"e1b2p2ww7"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"}),""),k=p("div",{target:"e1b2p2ww6"})(({theme:e})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),""),R=p("div",{target:"e1b2p2ww5"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS}),""),fe=p("span",{target:"e1b2p2ww4"})(({theme:e})=>({marginRight:e.spacing.twoXS}),""),xe=p("div",{target:"e1b2p2ww3"})(({theme:e})=>({display:"flex",padding:e.spacing.twoXS,color:e.colors.darkenedBgMix100}),""),N=p("small",{target:"e1b2p2ww2"})(({theme:e})=>({color:e.colors.red,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),""),T=p("span",{target:"e1b2p2ww1"})({name:"0",styles:""}),we=e=>({[M]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto"},[E]:{marginBottom:e.spacing.sm},[V]:{display:"none"},[L]:{marginBottom:e.spacing.twoXS},[A]:{paddingRight:e.spacing.lg},[R]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[k]:{width:e.sizes.full},[H]:{flexDirection:"column"},[N]:{height:"auto",whiteSpace:"initial"},[T]:{display:"none"},[D]:{margin:e.spacing.none,padding:e.spacing.none}}),be=p("div",{target:"e1b2p2ww0"})(({theme:e,width:i})=>{if(i<ee("23rem"))return we(e)},""),Se=({multiple:e,acceptedExtensions:i,maxSizeBytes:t,disabled:s})=>l.jsxs(E,{"data-testid":"stFileUploaderDropzoneInstructions",children:[l.jsx(V,{children:l.jsx(m,{content:C,size:"threeXL"})}),l.jsxs(me,{children:[l.jsxs(L,{disabled:s,children:["Drag and drop file",e?"s":""," here"]}),l.jsxs(ge,{disabled:s,children:[`Limit ${U(t,w.Byte,0)} per file`,i.length?` â€¢ ${i.map(a=>a.replace(/^\./,"").toUpperCase()).join(", ")}`:null]})]})]}),ye=d.memo(Se),Fe=({onDrop:e,multiple:i,acceptedExtensions:t,maxSizeBytes:s,disabled:a,label:n})=>l.jsx(ne,{onDrop:e,multiple:i,accept:oe(t),maxSize:s,disabled:a,useFsAccessApi:!1,children:({getRootProps:o,getInputProps:r})=>l.jsxs(M,{...o(),"data-testid":"stFileUploaderDropzone",isDisabled:a,"aria-label":n,children:[l.jsx("input",{"data-testid":"stFileUploaderDropzoneInput",...r()}),l.jsx(ye,{multiple:i,acceptedExtensions:t,maxSizeBytes:s,disabled:a}),l.jsx(f,{kind:x.SECONDARY,disabled:a,size:te.SMALL,children:"Browse files"})]})}),ze=d.memo(Fe),P=p("small",{target:"e1bju1570"})(({kind:e,theme:i})=>{const{danger:t,fadedText60:s}=i.colors;return{color:e==="danger"?t:s,fontSize:i.fontSizes.sm,lineHeight:i.lineHeights.tight}},""),je=({fileInfo:e})=>e.status.type==="uploading"?l.jsx(pe,{value:e.status.progress,size:ce.SMALL}):e.status.type==="error"?l.jsxs(N,{children:[l.jsx(fe,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),l.jsx(T,{children:l.jsx(m,{content:B,size:"lg"})})]}):e.status.type==="uploaded"?l.jsx(P,{children:U(e.size,w.Byte)}):null,Ue=({fileInfo:e,onDelete:i})=>l.jsxs(R,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[l.jsx(xe,{children:l.jsx(m,{content:re,size:"twoXL"})}),l.jsxs(H,{className:"stFileUploaderFileData",children:[l.jsx(k,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,children:e.name}),l.jsx(je,{fileInfo:e})]}),l.jsx("div",{"data-testid":"stFileUploaderDeleteBtn",children:l.jsx(f,{onClick:()=>i(e.id),kind:x.MINIMAL,children:l.jsx(m,{content:de,size:"lg"})})})]}),Ie=d.memo(Ue),ve=p("div",{target:"e1nlpozb1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS}),""),Ce=p("div",{target:"e1nlpozb0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40}),""),Be=({currentPage:e,totalPages:i,onNext:t,onPrevious:s})=>l.jsxs(ve,{"data-testid":"stFileUploaderPagination",children:[l.jsx(P,{children:`Showing page ${e} of ${i}`}),l.jsxs(Ce,{children:[l.jsx(f,{onClick:s,kind:x.MINIMAL,children:l.jsx(m,{content:I,size:"xl"})}),l.jsx(f,{onClick:t,kind:x.MINIMAL,children:l.jsx(m,{content:v,size:"xl"})})]})]}),Me=d.memo(Be),j=(e,i)=>Math.ceil(e.length/i),Ee=e=>ie(({pageSize:i,items:t,resetOnAdd:s,...a})=>{const[n,o]=d.useState(0),[r,c]=d.useState(()=>j(t,i)),h=he(t);d.useEffect(()=>{h&&h.length!==t.length&&c(j(t,i)),h&&h.length<t.length?s&&o(0):n+1>=r&&o(r-1)},[t,n,i,h,s,r]);const y=()=>{o(Math.min(n+1,r-1))},W=()=>{o(Math.max(0,n-1))},X=t.slice(n*i,n*i+i);return l.jsxs(l.Fragment,{children:[l.jsx(e,{items:X,...a}),t.length>i?l.jsx(Me,{pageSize:i,totalPages:r,currentPage:n+1,onNext:y,onPrevious:W}):null]})},e),Ve=({items:e,onDelete:i})=>l.jsx(ue,{children:e.map(t=>l.jsx(D,{children:l.jsx(Ie,{fileInfo:t,onDelete:i})},t.id))}),Le=Ee(Ve),Ae=e=>l.jsx(A,{children:l.jsx(Le,{...e})}),De=d.memo(Ae);class He extends d.PureComponent{constructor(i){super(i),this.formClearHelper=new se,this.localFileIdCounter=1,this.forceUpdatingStatus=!1,this.componentDidUpdate=()=>{if(this.status!=="ready")return;const t=this.createWidgetValue(),{element:s,widgetMgr:a,fragmentId:n}=this.props,o=a.getFileUploaderStateValue(s);O(t,o)||a.setFileUploaderStateValue(s,t,{fromUi:!0},n)},this.dropHandler=(t,s)=>{const{element:a}=this.props,{multipleFiles:n}=a;if(!n&&t.length===0&&s.length>1){const o=s.findIndex(r=>r.errors.length===1&&r.errors[0].code==="too-many-files");o>=0&&(t.push(s[o].file),s.splice(o,1))}if(this.props.uploadClient.fetchFileURLs(t).then(o=>{if(!n&&t.length>0){const r=this.state.files.find(c=>c.status.type!=="error");r&&(this.forceUpdatingStatus=!0,this.deleteFile(r.id),this.forceUpdatingStatus=!1)}K(o,t).forEach(([r,c])=>{this.uploadFile(r,c)})}).catch(o=>{this.addFiles(t.map(r=>new F(r.name,r.size,this.nextLocalFileId(),{type:"error",errorMessage:o})))}),s.length>0){const o=s.map(r=>le(r,this.nextLocalFileId(),this.maxUploadSizeInBytes));this.addFiles(o)}},this.uploadFile=(t,s)=>{const a=z.CancelToken.source(),n=new F(s.name,s.size,this.nextLocalFileId(),{type:"uploading",cancelToken:a,progress:1});this.addFile(n),this.props.uploadClient.uploadFile(this.props.element,t.uploadUrl,s,o=>this.onUploadProgress(o,n.id),a.token).then(()=>this.onUploadComplete(n.id,t)).catch(o=>{z.isCancel(o)||this.updateFile(n.id,n.setStatus({type:"error",errorMessage:o?o.toString():"Unknown error"}))})},this.onUploadComplete=(t,s)=>{const a=this.getFile(t);g(a)||a.status.type!=="uploading"||this.updateFile(a.id,a.setStatus({type:"uploaded",fileId:s.fileId,fileUrls:s}))},this.deleteFile=t=>{const s=this.getFile(t);g(s)||(s.status.type==="uploading"&&s.status.cancelToken.cancel(),s.status.type==="uploaded"&&s.status.fileUrls.deleteUrl&&this.props.uploadClient.deleteFile(s.status.fileUrls.deleteUrl),this.removeFile(t))},this.addFile=t=>{u.flushSync(()=>{this.setState(s=>({files:[...s.files,t]}))})},this.addFiles=t=>{u.flushSync(()=>{this.setState(s=>({files:[...s.files,...t]}))})},this.removeFile=t=>{u.flushSync(()=>{this.setState(s=>({files:s.files.filter(a=>a.id!==t)}))})},this.getFile=t=>this.state.files.find(s=>s.id===t),this.updateFile=(t,s)=>{u.flushSync(()=>{this.setState(a=>({files:a.files.map(n=>n.id===t?s:n)}))})},this.onUploadProgress=(t,s)=>{const a=this.getFile(s);if(g(a)||a.status.type!=="uploading")return;const n=Math.round(t.loaded*100/t.total);a.status.progress!==n&&this.updateFile(s,a.setStatus({type:"uploading",cancelToken:a.status.cancelToken,progress:n}))},this.onFormCleared=()=>{u.flushSync(()=>{this.setState({files:[]},()=>{const t=this.createWidgetValue();if(g(t))return;const{widgetMgr:s,element:a,fragmentId:n}=this.props;s.setFileUploaderStateValue(a,t,{fromUi:!0},n)})})},this.state=this.initialValue}get initialValue(){const i={files:[]},{widgetMgr:t,element:s}=this.props,a=t.getFileUploaderStateValue(s);if(g(a))return i;const{uploadedFileInfo:n}=a;return g(n)||n.length===0?i:{files:n.map(o=>{const r=o.name,c=o.size,h=o.fileId,y=o.fileUrls;return new F(r,c,this.nextLocalFileId(),{type:"uploaded",fileId:h,fileUrls:y})})}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){const i=this.props.element.maxUploadSizeMb;return ae(i,w.Megabyte,w.Byte)}get status(){const i=t=>t.status.type==="uploading";return this.state.files.some(i)||this.forceUpdatingStatus?"updating":"ready"}componentDidMount(){const i=this.createWidgetValue(),{element:t,widgetMgr:s,fragmentId:a}=this.props;s.getFileUploaderStateValue(t)===void 0&&s.setFileUploaderStateValue(t,i,{fromUi:!1},a)}createWidgetValue(){const i=this.state.files.filter(t=>t.status.type==="uploaded").map(t=>{const{name:s,size:a,status:n}=t,{fileId:o,fileUrls:r}=n;return new _({fileId:o,fileUrls:r,name:s,size:a})});return new Y({uploadedFileInfo:i})}render(){const{files:i}=this.state,{element:t,disabled:s,widgetMgr:a,width:n}=this.props,o=t.type;this.formClearHelper.manageFormClearListener(a,t.formId,this.onFormCleared);const r=i.slice().reverse();return l.jsxs(be,{className:"stFileUploader","data-testid":"stFileUploader",width:n,children:[l.jsx(q,{label:t.label,disabled:s,labelVisibility:G(t.labelVisibility?.value),children:t.help&&l.jsx(Z,{children:l.jsx(J,{content:t.help,placement:Q.TOP_RIGHT})})}),l.jsx(ze,{onDrop:this.dropHandler,multiple:t.multipleFiles,acceptedExtensions:o,maxSizeBytes:this.maxUploadSizeInBytes,label:t.label,disabled:s}),r.length>0&&l.jsx(De,{items:r,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0})]})}nextLocalFileId(){return this.localFileIdCounter++}}const Xe=$(d.memo(He));export{Xe as default};
