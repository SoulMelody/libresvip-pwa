import{r as s,u as V,bD as x,a as M,bT as R,j as m,c as j,l as N}from"./index-BYZzCQJv.js";const O=j("iframe",{target:"evvcert0"})(({theme:r})=>({colorScheme:"normal",border:"none",padding:r.spacing.none,margin:r.spacing.none,width:"100%",aspectRatio:"16 / 9"}),""),U=N.getLogger("Video"),P={width:"100%"};function $({element:r,endpoints:o,elementMgr:p}){const i=s.useRef(null),{type:h,url:v,startTime:a,subtitles:y,endTime:n,loop:d,autoplay:f,muted:E}=r,u=V(v),c=x(y);let S=M(u);const b=s.useMemo(()=>{if(!r.id)return!0;const e=p.getElementState(r.id,"preventAutoplay");return e||p.setElementState(r.id,"preventAutoplay",!0),e??!1},[r.id,p]),g=s.useMemo(()=>JSON.stringify(c?c.map(e=>o.buildMediaURL(`${e.url}`)):[]),[c,o]);s.useEffect(()=>{const e=JSON.parse(g);e.length!==0&&e.forEach(t=>{o.checkSourceUrlResponse(t,"Video Subtitle")})},[g,o]),s.useEffect(()=>{i.current&&(i.current.currentTime=a)},[a]),s.useEffect(()=>{const e=i.current,t=()=>{e&&(e.currentTime=r.startTime)};return e&&e.addEventListener("loadedmetadata",t),()=>{e&&e.removeEventListener("loadedmetadata",t)}},[r]),s.useEffect(()=>{const e=i.current;if(!e)return;let t=!1;const l=()=>{n>0&&e.currentTime>=n&&(d?(e.currentTime=a||0,e.play()):t||(t=!0,e.pause()))};return n>0&&e.addEventListener("timeupdate",l),()=>{e&&n>0&&e.removeEventListener("timeupdate",l)}},[n,d,a]),s.useEffect(()=>{const e=i.current;if(!e)return;const t=()=>{d&&(e.currentTime=a||0,e.play())};return e.addEventListener("ended",t),()=>{e&&e.removeEventListener("ended",t)}},[d,a]);const T=e=>{const t=new URL(e);if(a&&!isNaN(a)&&t.searchParams.append("start",a.toString()),n&&!isNaN(n)&&t.searchParams.append("end",n.toString()),d){t.searchParams.append("loop","1");const l=t.pathname.split("/").pop();l&&t.searchParams.append("playlist",l)}return f&&t.searchParams.append("autoplay","1"),E&&t.searchParams.append("mute","1"),t.toString()};if(h===R.Type.YOUTUBE_IFRAME)return m.jsx(O,{className:"stVideo","data-testid":"stVideo",title:u,src:T(u),allow:"autoplay; encrypted-media",allowFullScreen:!0});const L=e=>{const t=e.currentTarget.src;U.error(`Client Error: Video source error - ${t}`),o.sendClientErrorToHost("Video","Video source failed to load","onerror triggered",t)};return m.jsx("video",{className:"stVideo","data-testid":"stVideo",ref:i,controls:!0,muted:E,autoPlay:f&&!b,src:o.buildMediaURL(u),style:P,crossOrigin:S,onError:L,children:c&&c.map((e,t)=>m.jsx("track",{kind:"captions",src:o.buildMediaURL(`${e.url}`),label:`${e.label}`,default:t===0,"data-testid":"stVideoSubtitle"},t))})}const A=s.memo($);export{A as default};
