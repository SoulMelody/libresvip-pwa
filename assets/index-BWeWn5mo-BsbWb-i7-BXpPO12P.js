import{r as s,u as V,b_ as M,a as R,ci as U,j as m,c as x,l as N}from"./index-Dl0ak3r9.js";const O=x("iframe",{target:"evvcert0"})(({theme:r})=>({colorScheme:"normal",border:"none",padding:r.spacing.none,margin:r.spacing.none,width:"100%",aspectRatio:"16 / 9"}),""),P=N.getLogger("Video"),$={width:"100%"};function j({element:r,endpoints:i,elementMgr:p}){const o=s.useRef(null),{type:h,url:v,startTime:a,subtitles:y,endTime:n,loop:d,autoplay:f,muted:E}=r,u=V(v),l=M(y);let S=R(u);const b=s.useMemo(()=>{if(!r.id)return!0;const e=p.getElementState(r.id,"preventAutoplay");return e||p.setElementState(r.id,"preventAutoplay",!0),e??!1},[r.id,p]),g=s.useMemo(()=>JSON.stringify(l?l.map(e=>i.buildMediaURL(`${e.url}`)):[]),[l,i]);s.useEffect(()=>{const e=JSON.parse(g);e.length!==0&&e.forEach(t=>{i.checkSourceUrlResponse(t,"Video Subtitle")})},[g,i]),s.useEffect(()=>{o.current&&(o.current.currentTime=a)},[a]),s.useEffect(()=>{const e=o.current,t=()=>{e&&(e.currentTime=r.startTime)};return e&&e.addEventListener("loadedmetadata",t),()=>{e&&e.removeEventListener("loadedmetadata",t)}},[r]),s.useEffect(()=>{const e=o.current;if(!e)return;let t=!1;const c=()=>{n>0&&e.currentTime>=n&&(d?(e.currentTime=a||0,e.play()):t||(t=!0,e.pause()))};return n>0&&e.addEventListener("timeupdate",c),()=>{e&&n>0&&e.removeEventListener("timeupdate",c)}},[n,d,a]),s.useEffect(()=>{const e=o.current;if(!e)return;const t=()=>{d&&(e.currentTime=a||0,e.play())};return e.addEventListener("ended",t),()=>{e&&e.removeEventListener("ended",t)}},[d,a]);const T=e=>{const t=new URL(e);if(a&&!isNaN(a)&&t.searchParams.append("start",a.toString()),n&&!isNaN(n)&&t.searchParams.append("end",n.toString()),d){t.searchParams.append("loop","1");const c=t.pathname.split("/").pop();c&&t.searchParams.append("playlist",c)}return f&&t.searchParams.append("autoplay","1"),E&&t.searchParams.append("mute","1"),t.toString()};if(h===U.Type.YOUTUBE_IFRAME)return m.jsx(O,{className:"stVideo","data-testid":"stVideo",title:u,src:T(u),allow:"autoplay; encrypted-media",allowFullScreen:!0});const L=e=>{const t=e.currentTarget.src;P.error(`Client Error: Video source error - ${t}`),i.sendClientErrorToHost("Video","Video source failed to load","onerror triggered",t)};return m.jsx("video",{className:"stVideo","data-testid":"stVideo",ref:o,controls:!0,muted:E,autoPlay:f&&!b,src:i.buildMediaURL(u),style:$,crossOrigin:S,onError:L,children:l?.map((e,t)=>m.jsx("track",{kind:"captions",src:i.buildMediaURL(`${e.url}`),label:`${e.label}`,default:t===0,"data-testid":"stVideoSubtitle"},t))})}const A=s.memo(j);export{A as default};
