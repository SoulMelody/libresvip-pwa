import{r as Tt,L as aU,a0 as lU,aU as VR,a4 as WR,bu as cU,bv as AB,j as rc,c as JR,v as f2,bw as gB,a$ as uU,bx as hU,Y as Cr,by as At,f as bf,bz as zu,e as KR,Z as fU}from"./index-BKx_feNz.js";import{s as dU,w as As}from"./slicedToArray-wWrld5kI-jg-QXMZM.js";import{b as uh,p as hh,s as yw,n as Pp,l as bw}from"./inherits-D1oDQOuG-w_O3-koG.js";import{v as pU,m as XR}from"./withFullScreenWrapper-C6OFHNq5-Dc7YgbiJ.js";import{k as AU,h as gU}from"./Toolbar-KmsdFNjA-BooKw5Sk.js";import{S as mU}from"./useBasicWidgetState-DZWY5hj--B-562gBX.js";import{H as _U,I as yU}from"./threshold-CT01Jj2z-CJGDO7Zk.js";import"./FormClearHelper-B_V_qF_E-C23rXMHO.js";import"./value-DKQTM160-BzWdDXpE.js";var mB={};function bU(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function s_(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const vw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),_B=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_B&&parseFloat(_B[1]);const yB=globalThis,bB=globalThis.process||{};function vU(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function xw(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||vU()}const QR="4.0.7";function xU(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let wU=class{constructor(t,e,r="sessionStorage"){this.storage=xU(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function CU(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function EU(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var o_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(o_||(o_={}));const BU=10;function vB(t){return typeof t!="string"?t:(t=t.toUpperCase(),o_[t]||o_.WHITE)}function TU(t,e,r){return!xw&&typeof t=="string"&&(e&&(t=`\x1B[${vB(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${vB(r)+BU}m${t}\x1B[49m`)),t}function SU(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(l=>o===l)||(i[o]=s.bind(t)))}}function ww(t,e){if(!t)throw new Error("Assertion failed")}function gd(){let t;if(xw()&&yB.performance)t=yB?.performance?.now?.();else if("hrtime"in bB){const e=bB?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const md={debug:xw()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},IU={enabled:!0,level:0};function _d(){}const xB={},wB={once:!0};let ZR=class{constructor({id:t}={id:""}){this.VERSION=QR,this._startTs=gd(),this._deltaTs=gd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new wU(`__probe-${this.id}__`,IU),this.timeStamp(`${this.id} started`),SU(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((gd()-this._startTs).toPrecision(10))}getDelta(){return Number((gd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,md.warn,arguments,wB)}error(t){return this._getLogFunction(0,t,md.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,md.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,md.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,md.debug||md.info,arguments,wB)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||_d,r&&[r],{tag:PU(e)}):_d}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||_d)}group(t,e,r={collapsed:!1}){const n=CB({logLevel:t,message:e,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e,r={}){return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||_d)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=$R(t)}_getLogFunction(t,e,r,n,i){if(this._shouldLog(t)){i=CB({logLevel:t,message:e,args:n,opts:i}),r=r||i.method,ww(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=gd();const o=i.tag||i.message;if(i.once&&o)if(!xB[o])xB[o]=gd();else return _d;return e=MU(this.id,i.message,i),r.bind(console,e,...i.args)}return _d}};ZR.VERSION=QR;function $R(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ww(Number.isFinite(e)&&e>=0),e}function CB(t){const{logLevel:e,message:r}=t;t.logLevel=$R(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return ww(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function MU(t,e,r){if(typeof e=="string"){const n=r.time?EU(CU(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=TU(e,r.color,r.background)}return e}function PU(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const zb="4.3.1",LU=zb[0]>="0"&&zb[0]<="9"?`v${zb}`:"";function RU(){const t=new ZR({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=LU,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const OU=RU();function DU(t,e){return qR(t||{},e)}function qR(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=qR(n[i]||{},e[i],r+1):n[i]=e[i];return n}const FU="latest";function kU(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const NU=kU();function qu(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const rf=typeof process!="object"||String(process)!=="[object process]"||process.browser,UU=typeof window<"u"&&typeof window.orientation<"u",EB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);EB&&parseFloat(EB[1]);let GU=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){qu(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){qu(this.isRunning),this.isRunning=!1,this._reject(t)}},jb=class{terminate(){}};const Hb=new Map;function zU(t){qu(t.source&&!t.url||!t.source&&t.url);let e=Hb.get(t.source||t.url);return e||(t.url&&(e=jU(t.url),Hb.set(t.url,e)),t.source&&(e=YR(t.source),Hb.set(t.source,e))),qu(e),e}function jU(t){if(!t.startsWith("http"))return t;const e=HU(t);return YR(e)}function YR(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function HU(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function eO(t,e=!0,r){const n=r||new Set;if(t){if(BB(t))n.add(t);else if(BB(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)&&e&&typeof t=="object")for(const i in t)eO(t[i],e,n)}return r===void 0?Array.from(n):[]}function BB(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Vb=()=>{};let d2=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&rf||typeof jb<"u"&&!rf}constructor(t){const{name:e,source:r,url:n}=t;qu(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vb,this.onError=i=>console.log(i),this.worker=rf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Vb,this.onError=Vb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||eO(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=zU({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new jb(e,{eval:!1})}else if(this.source)t=new jb(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}},VU=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return d2.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(n,i,o)=>n.done(o),r=(n,i)=>n.error(i)){const n=new Promise(i=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:i}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new GU(e.name,t);t.onMessage=n=>e.onMessage(r,n.type,n.payload),t.onError=n=>e.onError(r,n),e.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!rf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new d2({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return UU?this.maxMobileConcurrency:this.maxConcurrency}};const WU={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};let tO=class Yd{props;workerPools=new Map;static _workerFarm;static isSupported(){return d2.isSupported()}static getWorkerFarm(e={}){return Yd._workerFarm=Yd._workerFarm||new Yd({}),Yd._workerFarm.setProps(e),Yd._workerFarm}constructor(e){this.props={...WU},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let o=this.workerPools.get(r);return o||(o=new VU({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function JU(t,e={}){const r=e[t.id]||{},n=rf?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(rf?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let o=t.version;o==="latest"&&(o=FU);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${s}/dist/${n}`}return qu(i),i}function KU(t,e=NU){qu(t,"no worker provided");const r=t.version;return!(!e||!r)}const Ou={};function XU(t,e){return!tO.isSupported()||!rf&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function QU(t,e,r,n,i){const o=t.id,s=JU(t,r),l=tO.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const h=await l.startJob("process-on-worker",ZU.bind(null,i));return h.postMessage("process",{input:e,options:r,context:n}),await(await h.result).result}async function ZU(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const l=await t(o,s);e.postMessage("done",{id:i,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function $U(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function qU(...t){return YU(t)}function YU(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function eG(t){const e=[];for await(const r of t)e.push(r);return qU(...e)}let tG="";const TB={};function rG(t){for(const e in TB)if(t.startsWith(e)){const r=TB[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${tG}${t}`),t}function nG(t){return t&&typeof t=="object"&&t.isBuffer}function rO(t){if(nG(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function nO(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function iG(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const sG=t=>typeof t=="boolean",ig=t=>typeof t=="function",Wg=t=>t!==null&&typeof t=="object",SB=t=>Wg(t)&&t.constructor==={}.constructor,oG=t=>!!t&&typeof t[Symbol.iterator]=="function",aG=t=>t&&typeof t[Symbol.asyncIterator]=="function",vf=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,xf=t=>typeof Blob<"u"&&t instanceof Blob,lG=t=>t&&typeof t=="object"&&t.isBuffer,cG=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Wg(t)&&ig(t.tee)&&ig(t.cancel)&&ig(t.getReader),uG=t=>Wg(t)&&ig(t.read)&&ig(t.pipe)&&sG(t.readable),iO=t=>cG(t)||uG(t);let hG=class extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}reason;url;response};const fG=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,dG=/^([-\w.]+\/[-\w.+]+)/;function IB(t,e){return t.toLowerCase()===e.toLowerCase()}function pG(t){const e=dG.exec(t);return e?e[1]:t}function MB(t){const e=fG.exec(t);return e?e[1]:""}const sO=/\?.*/;function AG(t){const e=t.match(sO);return e&&e[0]}function Cw(t){return t.replace(sO,"")}function gG(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function by(t){return vf(t)?t.url:xf(t)?t.name||"":typeof t=="string"?t:""}function Ew(t){if(vf(t)){const e=t,r=e.headers.get("content-type")||"",n=Cw(e.url);return pG(r)||MB(n)}return xf(t)?t.type||"":typeof t=="string"?MB(t):""}function mG(t){return vf(t)?t.headers["content-length"]||-1:xf(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function oO(t){if(vf(t))return t;const e={},r=mG(t);r>=0&&(e["content-length"]=String(r));const n=by(t),i=Ew(t);i&&(e["content-type"]=i);const o=await bG(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function _G(t){if(!t.ok)throw await yG(t)}async function yG(t){const e=gG(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&i?.includes("application/json")?await t.json():await t.text()}catch{}return new hG(r,n)}async function bG(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=i=>r(i?.target?.result),n.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return`data:base64,${vG(e)}`}return null}function vG(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function xG(t){return!wG(t)&&!CG(t)}function wG(t){return t.startsWith("http:")||t.startsWith("https:")}function CG(t){return t.startsWith("data:")}async function PB(t,e){if(typeof t=="string"){const r=rG(t);return xG(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await oO(t)}const LB=globalThis,RB=globalThis.process||{};function EG(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function Bw(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||EG()}const aO="4.0.7";function BG(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let TG=class{constructor(t,e,r="sessionStorage"){this.storage=BG(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function SG(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function IG(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var a_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(a_||(a_={}));const MG=10;function OB(t){return typeof t!="string"?t:(t=t.toUpperCase(),a_[t]||a_.WHITE)}function PG(t,e,r){return!Bw&&typeof t=="string"&&(e&&(t=`\x1B[${OB(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${OB(r)+MG}m${t}\x1B[49m`)),t}function LG(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(l=>o===l)||(i[o]=s.bind(t)))}}function Tw(t,e){if(!t)throw new Error("Assertion failed")}function yd(){let t;if(Bw()&&LB.performance)t=LB?.performance?.now?.();else if("hrtime"in RB){const e=RB?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const bd={debug:Bw()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},RG={enabled:!0,level:0};function vd(){}const DB={},FB={once:!0};let lO=class{constructor({id:t}={id:""}){this.VERSION=aO,this._startTs=yd(),this._deltaTs=yd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new TG(`__probe-${this.id}__`,RG),this.timeStamp(`${this.id} started`),LG(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((yd()-this._startTs).toPrecision(10))}getDelta(){return Number((yd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,bd.warn,arguments,FB)}error(t){return this._getLogFunction(0,t,bd.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,bd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,bd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,bd.debug||bd.info,arguments,FB)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||vd,r&&[r],{tag:DG(e)}):vd}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||vd)}group(t,e,r={collapsed:!1}){const n=kB({logLevel:t,message:e,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e,r={}){return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||vd)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=cO(t)}_getLogFunction(t,e,r,n,i){if(this._shouldLog(t)){i=kB({logLevel:t,message:e,args:n,opts:i}),r=r||i.method,Tw(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=yd();const o=i.tag||i.message;if(i.once&&o)if(!DB[o])DB[o]=yd();else return vd;return e=OG(this.id,i.message,i),r.bind(console,e,...i.args)}return vd}};lO.VERSION=aO;function cO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Tw(Number.isFinite(e)&&e>=0),e}function kB(t){const{logLevel:e,message:r}=t;t.logLevel=cO(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Tw(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function OG(t,e,r){if(typeof e=="string"){const n=r.time?IG(SG(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=PG(e,r.color,r.background)}return e}function DG(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const NB=new lO({id:"loaders.gl"});let FG=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},kG=class{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}};const uO={fetch:null,mimeType:void 0,nothrow:!1,log:new kG,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:vw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},NG={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hO(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function fO(){const t=hO();return t.globalOptions=t.globalOptions||{...uO},t.globalOptions}function UG(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],GG(t,r),jG(e,t,n)}function GG(t,e){UB(t,null,uO,NG,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};UB(n,r.id,i,o,e)}}function UB(t,e,r,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const l in t){const h=!e&&Wg(t[l]),A=l==="baseUri"&&!e,b=l==="workerUrl"&&e;if(!(l in r)&&!A&&!b){if(l in n)NB.warn(`${o} loader option '${s}${l}' no longer supported, use '${n[l]}'`)();else if(!h){const C=zG(l,i);NB.warn(`${o} loader option '${s}${l}' not recognized. ${C}`)()}}}}function zG(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(t===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function jG(t,e,r){const n={...t.options||{}};return HG(n,r),n.log===null&&(n.log=new FG),GB(n,fO()),GB(n,e),n}function GB(t,e){for(const r in e)if(r in e){const n=e[r];SB(n)&&SB(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function HG(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Sw(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function Iw(t){s_(t,"null loader"),s_(Sw(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const dO=()=>{const t=hO();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function VG(t){const e=dO();t=Array.isArray(t)?t:[t];for(const r of t){const n=Iw(r);e.find(i=>n===i)||e.unshift(n)}}function WG(){return dO()}const JG=/\.([^.]+)$/;async function KG(t,e=[],r,n){if(!pO(t))return null;let i=zB(t,e,{...r,nothrow:!0},n);if(i)return i;if(xf(t)&&(t=await t.slice(0,10).arrayBuffer(),i=zB(t,e,r,n)),!i&&!r?.nothrow)throw new Error(AO(t));return i}function zB(t,e=[],r,n){if(!pO(t))return null;if(e&&!Array.isArray(e))return Iw(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...WG()),QG(i);const o=XG(t,i,r,n);if(!o&&!r?.nothrow)throw new Error(AO(t));return o}function XG(t,e,r,n){const i=by(t),o=Ew(t),s=Cw(i)||n?.url;let l=null,h="";return r?.mimeType&&(l=Wb(e,r?.mimeType),h=`match forced by supplied MIME type ${r?.mimeType}`),l=l||ZG(e,s),h=h||(l?`matched url ${s}`:""),l=l||Wb(e,o),h=h||(l?`matched MIME type ${o}`:""),l=l||qG(e,t),h=h||(l?`matched initial data ${gO(t)}`:""),r?.fallbackMimeType&&(l=l||Wb(e,r?.fallbackMimeType),h=h||(l?`matched fallback MIME type ${o}`:"")),h&&OU.log(1,`selectLoader selected ${l?.name}: ${h}.`),l}function pO(t){return!(t instanceof Response&&t.status===204)}function AO(t){const e=by(t),r=Ew(t);let n="No valid loader found (";n+=e?`${nO(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?gO(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function QG(t){for(const e of t)Iw(e)}function ZG(t,e){const r=e&&JG.exec(e),n=r&&r[1];return n?$G(t,n):null}function $G(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function Wb(t,e){for(const r of t)if(r.mimeTypes?.some(n=>IB(e,n))||IB(e,`application/x.${r.id}`))return r;return null}function qG(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(YG(e,r))return r}else if(ArrayBuffer.isView(e)){if(jB(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&jB(e,0,r))return r;return null}function YG(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function jB(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>ez(t,e,r,n))}function ez(t,e,r,n){if(n instanceof ArrayBuffer)return $U(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=p2(t,e,n.length);return n===i;default:return!1}}function gO(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?p2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?p2(t,0,e):""}function p2(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const tz=256*1024;function*rz(t,e){const r=e?.chunkSize||tz;let n=0;const i=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,r),s=t.slice(n,n+o);n+=o,yield i.encode(s)}}const nz=256*1024;function*iz(t,e={}){const{chunkSize:r=nz}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(t,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const sz=1024*1024;async function*oz(t,e){const r=e?.chunkSize||sz;let n=0;for(;n<t.size;){const i=n+r,o=await t.slice(n,i).arrayBuffer();n=i,yield o}}function HB(t,e){return vw?az(t,e):lz(t)}async function*az(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:o,value:s}=await i;if(o)return;yield rO(s)}}catch{r.releaseLock()}}async function*lz(t,e){for await(const r of t)yield rO(r)}function cz(t,e){if(typeof t=="string")return rz(t,e);if(t instanceof ArrayBuffer)return iz(t,e);if(xf(t))return oz(t,e);if(iO(t))return HB(t,e);if(vf(t))return HB(t.body,e);throw new Error("makeIterator")}const mO="Cannot convert supplied data type";function uz(t,e,r){if(e.text&&typeof t=="string")return t;if(lG(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(mO)}async function hz(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return uz(t,e);if(xf(t)&&(t=await oO(t)),vf(t)){const i=t;return await _G(i),e.binary?await i.arrayBuffer():await i.text()}if(iO(t)&&(t=cz(t,r)),oG(t)||aG(t))return eG(t);throw new Error(mO)}function _O(t,e){const r=fO(),n=t||r;return typeof n.fetch=="function"?n.fetch:Wg(n.fetch)?i=>PB(i,n.fetch):e?.fetch?e?.fetch:PB}function fz(t,e,r){if(r)return r;const n={fetch:_O(e,t),...t};if(n.url){const i=Cw(n.url);n.baseUrl=i,n.queryString=AG(n.url),n.filename=nO(i),n.baseUrl=iG(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function dz(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function l_(t,e,r,n){e&&!Array.isArray(e)&&!Sw(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=by(t),o=dz(e,n),s=await KG(t,o,r);return s?(r=UG(r,s,o,i),n=fz({url:i,_parse:l_,loaders:o},r,n||null),await pz(s,t,r,n)):null}async function pz(t,e,r,n){if(KU(t),r=DU(t.options,r),vf(e)){const o=e,{ok:s,redirected:l,status:h,statusText:A,type:b,url:C}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:l,status:h,statusText:A,type:b,url:C}}e=await hz(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(XU(t,r))return await QU(t,e,r,n,l_);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw qu(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function A2(t,e,r,n){let i,o;!Array.isArray(e)&&!Sw(e)?(i=[],o=e):(i=e,o=r);const s=_O(o);let l=t;return typeof t=="string"&&(l=await s(t)),xf(t)&&(l=await s(t)),Array.isArray(i)?await l_(l,i,o):await l_(l,i,o)}const Az="4.3.1",gz=globalThis.loaders?.parseImageNode,g2=typeof Image<"u",m2=typeof ImageBitmap<"u",mz=!!gz,_2=vw?!0:mz;function _z(t){switch(t){case"auto":return m2||g2||_2;case"imagebitmap":return m2;case"image":return g2;case"data":return _2;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function yz(){if(m2)return"imagebitmap";if(g2)return"image";if(_2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function bz(t){const e=xz(t);if(!e)throw new Error("Not an image");return e}function vz(t){switch(bz(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function xz(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const wz=/^data:image\/svg\+xml/,Cz=/\.svg((\?|#).*)?$/;function Mw(t){return t&&(wz.test(t)||Cz.test(t))}function Ez(t,e){if(Mw(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return yO(t,e)}function yO(t,e){if(Mw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function bO(t,e,r){const n=Ez(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Bz(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function Bz(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Tz={};let VB=!0;async function Sz(t,e,r){let n;Mw(r)?n=await bO(t,e,r):n=yO(t,r);const i=e&&e.imagebitmap;return await Iz(n,i)}async function Iz(t,e=null){if((Mz(e)||!VB)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),VB=!1}return await createImageBitmap(t)}function Mz(t){for(const e in t||Tz)return!1;return!0}function Pz(t){return!Dz(t,"ftyp",4)||(t[8]&96)===0?null:Lz(t)}function Lz(t){switch(Rz(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Rz(t,e,r){return String.fromCharCode(...t.slice(e,r))}function Oz(t){return[...t].map(e=>e.charCodeAt(0))}function Dz(t,e,r=0){const n=Oz(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const ic=!1,sg=!0;function vO(t){const e=Jg(t);return kz(e)||Gz(e)||Nz(e)||Uz(e)||Fz(e)}function Fz(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=Pz(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function kz(t){const e=Jg(t);return e.byteLength>=24&&e.getUint32(0,ic)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ic),height:e.getUint32(20,ic)}:null}function Nz(t){const e=Jg(t);return e.byteLength>=10&&e.getUint32(0,ic)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,sg),height:e.getUint16(8,sg)}:null}function Uz(t){const e=Jg(t);return e.byteLength>=14&&e.getUint16(0,ic)===16973&&e.getUint32(2,sg)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,sg),height:e.getUint32(22,sg)}:null}function Gz(t){const e=Jg(t);if(!(e.byteLength>=3&&e.getUint16(0,ic)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=zz();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,ic);if(n.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,ic),width:e.getUint16(i+7,ic)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,ic)}return null}function zz(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Jg(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function jz(t,e){const{mimeType:r}=vO(t)||{},n=globalThis.loaders?.parseImageNode;return s_(n),await n(t,r)}async function Hz(t,e,r){e=e||{};const n=(e.image||{}).type||"auto",{url:i}=r||{},o=Vz(n);let s;switch(o){case"imagebitmap":s=await Sz(t,e,i);break;case"image":s=await bO(t,e,i);break;case"data":s=await jz(t);break;default:s_(!1)}return n==="data"&&(s=vz(s)),s}function Vz(t){switch(t){case"auto":case"data":return yz();default:return _z(t),t}}const Wz=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Jz=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Kz={image:{type:"auto",decode:!0}},Xz={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Az,mimeTypes:Jz,extensions:Wz,parse:Hz,tests:[t=>!!vO(new DataView(t))],options:Kz},c_=globalThis,u_=globalThis.process||{},Qz=globalThis.navigator||{};function xO(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function mc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||xO()}function Zz(t){return mc()?xO()?"Electron":(Qz.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const vy="4.1.0";function $z(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let qz=class{constructor(t,e,r="sessionStorage"){this.storage=$z(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function Yz(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function e7(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var h_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(h_||(h_={}));const t7=10;function WB(t){return typeof t!="string"?t:(t=t.toUpperCase(),h_[t]||h_.WHITE)}function r7(t,e,r){return!mc&&typeof t=="string"&&(e&&(t=`\x1B[${WB(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${WB(r)+t7}m${t}\x1B[49m`)),t}function n7(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(l=>o===l)||(i[o]=s.bind(t)))}}function Pw(t,e){if(!t)throw new Error("Assertion failed")}function xd(){let t;if(mc()&&c_.performance)t=c_?.performance?.now?.();else if("hrtime"in u_){const e=u_?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const wd={debug:mc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},i7={enabled:!0,level:0};function Cd(){}const JB={},KB={once:!0};let wO=class{constructor({id:t}={id:""}){this.VERSION=vy,this._startTs=xd(),this._deltaTs=xd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new qz(`__probe-${this.id}__`,i7),this.timeStamp(`${this.id} started`),n7(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((xd()-this._startTs).toPrecision(10))}getDelta(){return Number((xd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,wd.warn,arguments,KB)}error(t){return this._getLogFunction(0,t,wd.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,wd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,wd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,wd.debug||wd.info,arguments,KB)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||Cd,r&&[r],{tag:o7(e)}):Cd}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Cd)}group(t,e,r={collapsed:!1}){const n=XB({logLevel:t,message:e,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e,r={}){return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Cd)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=CO(t)}_getLogFunction(t,e,r,n,i){if(this._shouldLog(t)){i=XB({logLevel:t,message:e,args:n,opts:i}),r=r||i.method,Pw(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=xd();const o=i.tag||i.message;if(i.once&&o)if(!JB[o])JB[o]=xd();else return Cd;return e=s7(this.id,i.message,i),r.bind(console,e,...i.args)}return Cd}};wO.VERSION=vy;function CO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Pw(Number.isFinite(e)&&e>=0),e}function XB(t){const{logLevel:e,message:r}=t;t.logLevel=CO(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Pw(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function s7(t,e,r){if(typeof e=="string"){const n=r.time?e7(Yz(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=r7(e,r.color,r.background)}return e}function o7(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const $r=new wO({id:"deck"});let y2={};function a7(t){y2=t}function _o(t,e,r,n){$r.level>0&&y2[t]&&y2[t].call(null,e,r,n)}function l7(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const c7={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:l7,parseTextSync:JSON.parse};function u7(){const t="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||($r.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:$r,_registerLoggers:a7},VG([c7,[Xz,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const h7=u7();function Lw(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Jb={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function f7(t){const e={};for(const[r,n]of Object.entries(t))e[r]=d7(n);return e}function d7(t){let e=QB(t);if(e!=="object")return{value:t,...Jb[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Jb[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=QB(t.value),{...t,...Jb[e],type:e}):{type:"object",value:null};throw new Error("props")}function QB(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const p7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,A7=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,g7={vertex:p7,fragment:A7},ZB=/void\s+main\s*\([^)]*\)\s*\{\n?/,$B=/}\n?[^{}]*$/,Kb=[],F0="__LUMA_INJECT_DECLARATIONS__";function m7(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const i=_7(r);typeof n=="string"&&(n={order:0,injection:n}),e[i][r]=n}return e}function _7(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function f_(t,e,r,n=!1){const i=e==="vertex";for(const o in r){const s=r[o];s.sort((h,A)=>h.order-A.order),Kb.length=s.length;for(let h=0,A=s.length;h<A;++h)Kb[h]=s[h].injection;const l=`${Kb.join(`
`)}
`;switch(o){case"vs:#decl":i&&(t=t.replace(F0,l));break;case"vs:#main-start":i&&(t=t.replace(ZB,h=>h+l));break;case"vs:#main-end":i&&(t=t.replace($B,h=>l+h));break;case"fs:#decl":i||(t=t.replace(F0,l));break;case"fs:#main-start":i||(t=t.replace(ZB,h=>h+l));break;case"fs:#main-end":i||(t=t.replace($B,h=>l+h));break;default:t=t.replace(o,h=>h+l)}}return t=t.replace(F0,""),n&&(t=t.replace(/\}\s*$/,o=>o+g7[e])),t}function d_(t){t.map(e=>EO(e))}function EO(t){if(t.instance)return;d_(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,i={normalizedInjections:m7(n),parsedDeprecations:y7(r)};e&&(i.propValidators=f7(e)),t.instance=i;let o={};e&&(o=Object.entries(e).reduce((s,[l,h])=>{const A=h?.value;return A&&(s[l]=A),s},{})),t.defaultUniforms={...t.defaultUniforms,...o}}function BO(t,e,r){t.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function y7(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function Rw(t){d_(t);const e={},r={};TO({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((i,o)=>r[o]-r[i]).map(i=>e[i]);return d_(n),n}function TO(t){const{modules:e,level:r,moduleMap:n,moduleDepth:i}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(const o of e)o.dependencies&&TO({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function b7(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function v7(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=qB(t,x7),t;case"fragment":return t=qB(t,w7),t;default:throw new Error(e)}}const SO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],x7=[...SO,[b2("attribute"),"in $1"],[b2("varying"),"out $1"]],w7=[...SO,[b2("varying"),"in $1"]];function qB(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function b2(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function IO(t,e){let r="";for(const n in t){const i=t[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),e[n]){const o=e[n];o.sort((s,l)=>s.order-l.order);for(const s of o)r+=`  ${s.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function MO(t){const e={vertex:{},fragment:{}};for(const r of t){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();const[o,s]=i.split(":"),l=i.replace(/\(.+/,""),h=Object.assign(n,{signature:s});switch(o){case"vs":e.vertex[l]=h;break;case"fs":e.fragment[l]=h;break;default:throw new Error(o)}}return e}function C7(t,e){return{name:E7(t,e),language:"glsl",version:B7(t)}}function E7(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function B7(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const PO=`

${F0}
`,T7=`precision highp float;
`;function S7(t){const e=Rw(t.modules||[]);return{source:M7(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:LO(e)}}function I7(t){const{vs:e,fs:r}=t,n=Rw(t.modules||[]);return{vs:YB(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:YB(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:LO(n)}}function M7(t,e){const{source:r,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:l}=e;Lw(typeof r=="string","shader source must be a string");const h=r;let A="";const b=MO(o),C={},S={},D={};for(const U in s){const V=typeof s[U]=="string"?{injection:s[U],order:0}:s[U],j=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(j){const ee=j[2],Q=j[3];ee?Q==="decl"?S[U]=[V]:D[U]=[V]:C[U]=[V]}else D[U]=[V]}const N=i;for(const U of N){l&&BO(U,h,l);const V=RO(U,"wgsl");A+=V;const j=U.injections?.[n]||{};for(const ee in j){const Q=/^(v|f)s:#([\w-]+)$/.exec(ee);if(Q){const X=Q[2]==="decl"?S:D;X[ee]=X[ee]||[],X[ee].push(j[ee])}else C[ee]=C[ee]||[],C[ee].push(j[ee])}}return A+=PO,A=f_(A,n,S),A+=IO(b[n],C),A+=h,A=f_(A,n,D),A}function YB(t,e){const{id:r,source:n,stage:i,language:o="glsl",modules:s,defines:l={},hookFunctions:h=[],inject:A={},prologue:b=!0,log:C}=e;Lw(typeof n=="string","shader source must be a string");const S=o==="glsl"?C7(n).version:-1,D=t.shaderLanguageVersion,N=S===100?"#version 100":"#version 300 es",U=n.split(`
`).slice(1).join(`
`),V={};s.forEach(Y=>{Object.assign(V,Y.defines)}),Object.assign(V,l);let j="";switch(o){case"wgsl":break;case"glsl":j=b?`${N}

// ----- PROLOGUE -------------------------
${P7({id:r,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${b7(t)}
${i==="fragment"?T7:""}

// ----- APPLICATION DEFINES -------------------------

${L7(V)}

`:`${N}
`;break}const ee=MO(h),Q={},X={},pe={};for(const Y in A){const Ge=typeof A[Y]=="string"?{injection:A[Y],order:0}:A[Y],ze=/^(v|f)s:(#)?([\w-]+)$/.exec(Y);if(ze){const de=ze[2],ce=ze[3];de?ce==="decl"?X[Y]=[Ge]:pe[Y]=[Ge]:Q[Y]=[Ge]}else pe[Y]=[Ge]}for(const Y of s){C&&BO(Y,U,C);const Ge=RO(Y,i);j+=Ge;const ze=Y.instance?.normalizedInjections[i]||{};for(const de in ze){const ce=/^(v|f)s:#([\w-]+)$/.exec(de);if(ce){const De=ce[2]==="decl"?X:pe;De[de]=De[de]||[],De[de].push(ze[de])}else Q[de]=Q[de]||[],Q[de].push(ze[de])}}return j+="// ----- MAIN SHADER SOURCE -------------------------",j+=PO,j=f_(j,i,X),j+=IO(ee[i],Q),j+=U,j=f_(j,i,pe),o==="glsl"&&S!==D&&(j=v7(j,i)),j.trim()}function LO(t){return function(e){const r={};for(const n of t){const i=n.getUniforms?.(e,r);Object.assign(r,i)}return r}}function P7(t){const{id:e,source:r,stage:n}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function L7(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function RO(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:Lw(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}const R7=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,O7=/^\s*\#\s*endif\s*$/;function D7(t,e){const r=t.split(`
`),n=[];let i=!0;for(const o of r){const s=o.match(R7),l=o.match(O7);s?(s[1],i=!1):l?i=!0:i&&n.push(o)}return n.join(`
`)}class Qh{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Qh.defaultShaderAssembler=Qh.defaultShaderAssembler||new Qh,Qh.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:o}=S7({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?D7(i):i,getUniforms:o,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...I7({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const l=this._defaultModules[o],h=l.name;r[i++]=l,n[h]=!0}for(let o=0,s=e.length;o<s;++o){const l=e[o],h=l.name;n[h]||(r[i++]=l,n[h]=!0)}return r.length=i,d_(r),r}}const F7=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,k7=`#version 300 es
${F7}`;function OO(t){const{input:e,inputChannels:r,output:n}=t||{};if(!e)return k7;if(!r)throw new Error("inputChannels");const i=N7(r),o=U7(e,r);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function N7(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function U7(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}function eT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let tT=class{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},G7=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:r}=t;let n=this.stats[e];return n||(t instanceof tT?n=t:n=new tT(e,r),this.stats[e]=n),n}};class z7{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new G7({id:e})),this.stats.get(e)}}const DO=new z7;function j7(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let H7=class{constructor(t,e,r="sessionStorage"){this.storage=j7(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}};function V7(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function W7(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var p_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(p_||(p_={}));const J7=10;function rT(t){return typeof t!="string"?t:(t=t.toUpperCase(),p_[t]||p_.WHITE)}function K7(t,e,r){return!mc&&typeof t=="string"&&(e&&(t=`\x1B[${rT(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${rT(r)+J7}m${t}\x1B[49m`)),t}function X7(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(l=>o===l)||(i[o]=s.bind(t)))}}function Ow(t,e){if(!t)throw new Error("Assertion failed")}function Ed(){let t;if(mc()&&c_.performance)t=c_?.performance?.now?.();else if("hrtime"in u_){const e=u_?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Bd={debug:mc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Q7={enabled:!0,level:0};function Td(){}const nT={},iT={once:!0};let FO=class{constructor({id:t}={id:""}){this.VERSION=vy,this._startTs=Ed(),this._deltaTs=Ed(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new H7(`__probe-${this.id}__`,Q7),this.timeStamp(`${this.id} started`),X7(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ed()-this._startTs).toPrecision(10))}getDelta(){return Number((Ed()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Bd.warn,arguments,iT)}error(t){return this._getLogFunction(0,t,Bd.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Bd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Bd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Bd.debug||Bd.info,arguments,iT)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||Td,r&&[r],{tag:$7(e)}):Td}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Td)}group(t,e,r={collapsed:!1}){const n=sT({logLevel:t,message:e,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e,r={}){return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Td)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=kO(t)}_getLogFunction(t,e,r,n,i){if(this._shouldLog(t)){i=sT({logLevel:t,message:e,args:n,opts:i}),r=r||i.method,Ow(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Ed();const o=i.tag||i.message;if(i.once&&o)if(!nT[o])nT[o]=Ed();else return Td;return e=Z7(this.id,i.message,i),r.bind(console,e,...i.args)}return Td}};FO.VERSION=vy;function kO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Ow(Number.isFinite(e)&&e>=0),e}function sT(t){const{logLevel:e,message:r}=t;t.logLevel=kO(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Ow(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function Z7(t,e,r){if(typeof e=="string"){const n=r.time?W7(V7(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=K7(e,r.color,r.background)}return e}function $7(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const Yt=new FO({id:"luma.gl"}),Xb={};function xy(t="id"){Xb[t]=Xb[t]||1;const e=Xb[t]++;return`${t}-${e}`}let mi=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,r){if(!t)throw new Error("no device");this._device=t,this.props=q7(e,r);const n=this.props.id!=="undefined"?this.props.id:xy(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(t),r.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function q7(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}class Ci extends mi{static defaultProps={...mi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const n={...r};(r.usage||0)&Ci.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,Ci.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,n){const i=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:n,Ci.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&n===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}}function NO(t){const e=oT[t],r=Y7(e),n=t.includes("norm"),i=!n&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:oT[t],byteLength:r,integer:i,signed:o,normalized:n}}function Y7(t){return ej[t]}const oT={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},ej={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},ho="texture-compression-bc",pi="texture-compression-astc",ql="texture-compression-etc2",tj="texture-compression-etc1-webgl",Um="texture-compression-pvrtc-webgl",Qb="texture-compression-atc-webgl",Gm="float32-renderable-webgl",Zb="float16-renderable-webgl",rj="rgb9e5ufloat-renderable-webgl",$b="snorm8-renderable-webgl",kA="norm16-renderable-webgl",qb="snorm16-renderable-webgl",zm="float32-filterable",aT="float16-filterable-webgl";function UO(t){const e=nj[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const nj={r8unorm:{},r8snorm:{render:$b},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:$b},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Zb,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:kA},"r16snorm-webgl":{f:qb},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:$b},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Zb,filter:aT},"rg16unorm-webgl":{render:kA},"rg16snorm-webgl":{render:qb},r32uint:{},r32sint:{},r32float:{render:Gm,filter:zm},rgb9e5ufloat:{channels:"rgb",packed:!0,render:rj},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Gm},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:kA},"rgb16snorm-webgl":{f:kA},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:zm},rgba16uint:{},rgba16sint:{},rgba16float:{render:Zb,filter:aT},"rgba16unorm-webgl":{render:kA},"rgba16snorm-webgl":{render:qb},"rgb32float-webgl":{render:Gm,filter:zm},rgba32uint:{},rgba32sint:{},rgba32float:{render:Gm,filter:zm},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:ho},"bc1-rgb-unorm-srgb-webgl":{f:ho},"bc1-rgba-unorm":{f:ho},"bc1-rgba-unorm-srgb":{f:ho},"bc2-rgba-unorm":{f:ho},"bc2-rgba-unorm-srgb":{f:ho},"bc3-rgba-unorm":{f:ho},"bc3-rgba-unorm-srgb":{f:ho},"bc4-r-unorm":{f:ho},"bc4-r-snorm":{f:ho},"bc5-rg-unorm":{f:ho},"bc5-rg-snorm":{f:ho},"bc6h-rgb-ufloat":{f:ho},"bc6h-rgb-float":{f:ho},"bc7-rgba-unorm":{f:ho},"bc7-rgba-unorm-srgb":{f:ho},"etc2-rgb8unorm":{f:ql},"etc2-rgb8unorm-srgb":{f:ql},"etc2-rgb8a1unorm":{f:ql},"etc2-rgb8a1unorm-srgb":{f:ql},"etc2-rgba8unorm":{f:ql},"etc2-rgba8unorm-srgb":{f:ql},"eac-r11unorm":{f:ql},"eac-r11snorm":{f:ql},"eac-rg11unorm":{f:ql},"eac-rg11snorm":{f:ql},"astc-4x4-unorm":{f:pi},"astc-4x4-unorm-srgb":{f:pi},"astc-5x4-unorm":{f:pi},"astc-5x4-unorm-srgb":{f:pi},"astc-5x5-unorm":{f:pi},"astc-5x5-unorm-srgb":{f:pi},"astc-6x5-unorm":{f:pi},"astc-6x5-unorm-srgb":{f:pi},"astc-6x6-unorm":{f:pi},"astc-6x6-unorm-srgb":{f:pi},"astc-8x5-unorm":{f:pi},"astc-8x5-unorm-srgb":{f:pi},"astc-8x6-unorm":{f:pi},"astc-8x6-unorm-srgb":{f:pi},"astc-8x8-unorm":{f:pi},"astc-8x8-unorm-srgb":{f:pi},"astc-10x5-unorm":{f:pi},"astc-10x5-unorm-srgb":{f:pi},"astc-10x6-unorm":{f:pi},"astc-10x6-unorm-srgb":{f:pi},"astc-10x8-unorm":{f:pi},"astc-10x8-unorm-srgb":{f:pi},"astc-10x10-unorm":{f:pi},"astc-10x10-unorm-srgb":{f:pi},"astc-12x10-unorm":{f:pi},"astc-12x10-unorm-srgb":{f:pi},"astc-12x12-unorm":{f:pi},"astc-12x12-unorm-srgb":{f:pi},"pvrtc-rgb4unorm-webgl":{f:Um},"pvrtc-rgba4unorm-webgl":{f:Um},"pvrtc-rbg2unorm-webgl":{f:Um},"pvrtc-rgba2unorm-webgl":{f:Um},"etc1-rbg-unorm-webgl":{f:tj},"atc-rgb-unorm-webgl":{f:Qb},"atc-rgba-unorm-webgl":{f:Qb},"atc-rgbai-unorm-webgl":{f:Qb}},ij=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],sj=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function GO(t){return ij.some(e=>t.startsWith(e))}function Dw(t){let e=oj(t);if(GO(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=aj(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=sj.exec(t);if(r){const[,n,i,o,s,l]=r,h=`${o}${i}`,A=NO(h),b=A.byteLength*8,C=n.length,S=[b,C>=2?b:0,C>=3?b:0,C>=4?b:0];e={format:t,attachment:e.attachment,dataType:A.dataType,components:C,channels:n,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:S,bytesPerPixel:A.byteLength*n.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),s==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function oj(t){const e=UO(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function aj(t){const e=/.*-(\d+)x(\d+)-.*/.exec(t);if(e){const[,r,n]=e;return{blockWidth:Number(r),blockHeight:Number(n)}}return null}function lj(t){const e=UO(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=Dw(t),i=t.startsWith("depth")||t.startsWith("stencil"),o=n?.signed,s=n?.integer,l=n?.webgl;return r.render&&=!o,r.filter&&=!i&&!o&&!s&&!l,r}class cj{}class uj{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Xu{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Yt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Yt.get("debug")||void 0,debugShaders:Yt.get("debug-shaders")||void 0,debugFramebuffers:!!Yt.get("debug-framebuffers"),debugWebGL:!!Yt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Xu.defaultProps,...e},this.id=this.props.id||xy(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=DO;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const r=lj(e),n=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=n(r.create),o={format:e,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return GO(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&Ci.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Yt.warn("indices buffer content must be of integer type")()),r}}const hj=mc()&&typeof document<"u",fj=()=>hj&&document.readyState==="complete",dj="set luma.log.level=1 (or higher) to trace rendering",lT="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class sp{static defaultProps={...Xu.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=pj().then(()=>{Yt.probe(2,"DOM is loaded")()});stats=DO;log=Yt;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Yt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Yt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Yt.error("This version of luma.gl has already been initialized")()}Yt.log(1,`${this.VERSION} - ${dj}`)(),globalThis.luma=this}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this.getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapter(e=[]){const r=this.getAdapterMap(e);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(sp.defaultProps,e)}async createDevice(e={}){e={...sp.defaultProps,...e},e.waitForPageLoad&&await sp.pageLoaded;const r=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const i=await(this.getAdapterMap(e.adapters)||r).get(n)?.create?.(e);if(i)return i;throw new Error(lT)}async attachDevice(e){const r=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await sp.pageLoaded,e.handle===null&&(n="unknown");const i=await r.get(n)?.attach?.(null);if(i)return i;throw new Error(lT)}enforceWebGL2(e=!0,r=[]){const n=this.getAdapterMap(r).get("webgl");n||Yt.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}registerDevices(e){Yt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const r of e){const n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}}const v2=new sp;function pj(){return fj()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class Aj{}class Fw{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Fw.defaultProps,...e},e=this.props,!mc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=mj(e.canvas):this.canvas=e.canvas;else{const r=_j(e),n=gj(e?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return yj(e,n,i,o,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Yt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==e){let s=e;const l=Math.floor(n*s),h=Math.floor(i*s);if(this.htmlCanvas.width=l,this.htmlCanvas.height=h,this.device.gl){const[A,b]=this.getDrawingBufferSize();(A!==l||b!==h)&&(s=Math.min(A/n,b/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),Yt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function gj(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function mj(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function _j(t){const{width:e,height:r}=t,n=document.createElement("canvas");return n.id=xy("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function yj(t,e,r,n,i){const o=t,s=cT(o[0],e,r);let l=uT(o[1],e,n,i),h=cT(o[0]+1,e,r);const A=h===r-1?h:h-1;h=uT(o[1]+1,e,n,i);let b;return i?(h=h===0?h:h+1,b=l,l=h):b=h===n-1?h:h-1,{x:s,y:l,width:Math.max(A-s+1,1),height:Math.max(b-l+1,1)}}function cT(t,e,r){return Math.min(Math.round(t*e),r-1)}function uT(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class oi extends mi{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...mi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,r){if(r=oi.normalizeProps(e,r),super(e,r,oi.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const n=oi.getTextureDataSize(this.props.data);this.width=n?.width||1,this.height=n?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?oi.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const r=e?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return oi.getTextureDataSize(e[0]);if(oi.isExternalImage(e))return oi.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,r){let n;return ArrayBuffer.isView(e)?n=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?n=e:n=[e],n}static getMipLevelCount(e,r){return Math.floor(Math.log2(Math.max(e,r)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,r){const n={...r},i=e?.props?._resourceDefaults?.texture||{};Object.assign(n,i);const{width:o,height:s}=n;return typeof o=="number"&&(n.width=Math.max(1,Math.ceil(o))),typeof s=="number"&&(n.height=Math.max(1,Math.ceil(s))),n}}class wy extends mi{static defaultProps={...mi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,wy.defaultProps)}}function bj(t,e,r){let n="";const i=e.split(/\r?\n/),o=t.slice().sort((s,l)=>s.lineNum-l.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let l=1;l<=i.length;l++)for(n+=zO(i[l-1],l,r);o.length>s&&o[s].lineNum===l;){const h=o[s++];n+=hT(h,i,h.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const l of t)n+=hT(l,i,l.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function hT(t,e,r,n){if(n?.inlineSource){const o=vj(e,r),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${s}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function vj(t,e,r){let n="";for(let i=e-2;i<=e;i++){const o=t[i-1];o!==void 0&&(n+=zO(o,e,r))}return n}function zO(t,e,r){const n=r?.html?wj(t):t;return`${xj(String(e),4)}: ${n}${r?.html?"<br/>":`
`}`}function xj(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function wj(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Cy extends mi{static defaultProps={...mi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:Cj(r),...r},Cy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const r=jO(this.source),n=`${this.stage} ${r}`;let i=bj(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),s.onclick=()=>{const l=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(l)}}}function Cj(t){return jO(t.source)||t.id||xy(`unnamed ${t.stage}-shader`)}function jO(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}class wg extends mi{static defaultProps={...mi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=wg.normalizeProps(e,r),super(e,r,wg.defaultProps)}static normalizeProps(e,r){const n=e?.props?._resourceDefaults?.sampler||{};return{...r,...n}}}class Ey extends mi{static defaultProps={...mi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,Ey.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const r=this.colorAttachments.map(i=>i.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(e){let r=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Yt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){const i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof oi?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof oi?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:oi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:oi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}class Lp extends mi{static defaultProps={...mi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,Lp.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Kh extends mi{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...mi.defaultProps,framebuffer:null,parameters:void 0,clearColor:Kh.defaultClearColor,clearColors:void 0,clearDepth:Kh.defaultClearDepth,clearStencil:Kh.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=Kh.normalizeProps(e,r),super(e,r,Kh.defaultProps)}static normalizeProps(e,r){return{...e.props._resourceDefaults?.renderPass,...r}}}class A_ extends mi{static defaultProps={...mi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,A_.defaultProps),this.shaderLayout=r.shaderLayout}}class kw extends mi{static defaultProps={...mi.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,kw.defaultProps)}}class Nw extends mi{static defaultProps={...mi.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,Nw.defaultProps)}}function Ej(t){const[e,r]=Tj[t],n=e==="i32"||e==="u32",i=e!=="u32",o=Sj[e]*r,s=Bj(e,r);return{dataType:e,components:r,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function Bj(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const Tj={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Sj={f32:4,f16:2,i32:4,u32:4};function HO(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),i=r,o=n?parseInt(n):1,s=NO(i),l={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(l.webglOnly=!0),l}function VO(t,e){const r={};for(const n of t.attributes){const i=Mj(t,e,n.name);i&&(r[n.name]=i)}return r}function Ij(t,e,r=16){const n=VO(t,e),i=new Array(r).fill(null);for(const o of Object.values(n))i[o.location]=o;return i}function Mj(t,e,r){const n=Pj(t,r),i=Lj(e,r);if(!n)return null;const o=Ej(n.type),s=i?.vertexFormat||o.defaultVertexFormat,l=HO(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:o.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Pj(t,e){const r=t.attributes.find(n=>n.name===e);return r||Yt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function Lj(t,e){Rj(t);let r=Oj(t,e);return r||(r=Dj(t,e),r)?r:(Yt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Rj(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Yt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Oj(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Dj(t,e){for(const r of t){let n=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const s=HO(o.format);n+=s.byteLength}const i=r.attributes?.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}class Uw extends mi{static defaultProps={...mi.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,Uw.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:i}=r.renderPipeline||{};if(!n||!i)throw new Error("VertexArray");this.attributeInfos=Ij(n,i,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"))}}class Gw extends mi{static defaultProps={...mi.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,Gw.defaultProps)}}class zw extends mi{static defaultProps={...mi.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,zw.defaultProps)}}const Fj={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function kj(t){return Fj[t]}function Nj(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let jm;function WO(t){return(!jm||jm.byteLength<t)&&(jm=new ArrayBuffer(t)),jm}function Uj(t,e){const r=WO(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function Gj(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function g_(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":Gj(t)}const fT=1024;class zj{layout={};byteLength;constructor(e){let r=0;for(const[i,o]of Object.entries(e)){const s=kj(o),{type:l,components:h}=s;r=Nj(r,h);const A=r;r+=h,this.layout[i]={type:l,size:h,offset:A}}r+=(4-r%4)%4;const n=r*4;this.byteLength=Math.max(n,fT)}getData(e){const r=Math.max(this.byteLength,fT),n=WO(r),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,s]of Object.entries(e)){const l=this.layout[o];if(!l){Yt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:h,size:A,offset:b}=l,C=i[h];if(A===1){if(typeof s!="number"&&typeof s!="boolean"){Yt.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}C[b]=Number(s)}else{if(!g_(s)){Yt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}C.set(s,b)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function jj(t,e,r=16){if(t!==e)return!1;const n=t,i=e;if(!g_(n))return!1;if(g_(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function Hj(t){return g_(t)?t.slice():t}class Vj{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!r)throw new Error(e?.name);const n=r;for(const i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){jj(this.uniforms[e],r)||(this.uniforms[e]=Hj(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Wj{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,n]of Object.entries(e)){const i=r,o=new zj(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);const s=new Vj({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,n]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:Ci.UNIFORM|Ci.COPY_DST,byteLength:i}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),i=e.createBuffer({usage:Ci.UNIFORM|Ci.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||=n}return e&&Yt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;const o=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(o);const s=this.uniformBlocks.get(e)?.getAllUniforms();Yt.log(4,`Writing to uniform buffer ${String(e)}`,o,s)()}return i}}function JO(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function KO(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function Jj(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=JO(t);if(i==="uint8"&&r&&n===1)return"unorm8-webgl";if(i==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class Yb{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const i of r){const o=n.findIndex(s=>s.name===i.name);o<0?n.push(i):n[o]=i}return n}getBufferIndex(e){const r=this.bufferLayouts.findIndex(n=>n.name===e);return r===-1&&Yt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}}function Kj(t,e){const r=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),n=e.slice();return n.sort((i,o)=>{const s=i.attributes?i.attributes.map(b=>b.attribute):[i.name],l=o.attributes?o.attributes.map(b=>b.attribute):[o.name],h=Math.min(...s.map(b=>r[b])),A=Math.min(...l.map(b=>r[b]));return h-A}),n}class ja{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class dT{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Vu extends ja{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Qu extends ja{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class uf extends ja{constructor(e,r,n,i){super(e,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var ju;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ju||(ju={}));class Hm{constructor(e,r,n,i,o,s,l){this.name=e,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Xj{constructor(e,r){this.name=e,this.type=r}}class Qj{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}}class pT{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i}}class Zj{constructor(e,r,n,i){this.name=e,this.type=r,this.attributes=n,this.id=i}}class $j{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n}}class qj{constructor(e,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=n}}class Yj{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const XO=new Float32Array(1),eH=new Int32Array(XO.buffer),fo=new Uint16Array(1);function tH(t){XO[0]=t;const e=eH[0],r=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return fo[0]=r<<15|31744|(i!==0?512:0),fo[0];if(n===0){if(i===0)return fo[0]=r<<15,fo[0];i|=8388608;let o=113;for(;!(8388608&i);)i<<=1,o--;return n=127-o,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),fo[0]=r<<15|n<<10|i>>13,fo[0]):(fo[0]=r<<15,fo[0])}return n=n-127+15,n>=31?(fo[0]=r<<15|31744,fo[0]):n<=0?n<-10?(fo[0]=r<<15,fo[0]):(i=(8388608|i)>>1-n,fo[0]=r<<15|i>>13,fo[0]):(i>>=13,fo[0]=r<<15|n<<10|i,fo[0])}const jw=new Uint32Array(1),QO=new Float32Array(jw.buffer,0,1);function AT(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return jw[0]=e,QO[0]}function rH(t,e,r,n,i,o,s,l,h){const A=n*(s>>=i)*(o>>=i)+r*s+e*l;switch(h){case"r8unorm":return[Zn(t,A,"8unorm",1)[0]];case"r8snorm":return[Zn(t,A,"8snorm",1)[0]];case"r8uint":return[Zn(t,A,"8uint",1)[0]];case"r8sint":return[Zn(t,A,"8sint",1)[0]];case"rg8unorm":{const b=Zn(t,A,"8unorm",2);return[b[0],b[1]]}case"rg8snorm":{const b=Zn(t,A,"8snorm",2);return[b[0],b[1]]}case"rg8uint":{const b=Zn(t,A,"8uint",2);return[b[0],b[1]]}case"rg8sint":{const b=Zn(t,A,"8sint",2);return[b[0],b[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const b=Zn(t,A,"8unorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8snorm":{const b=Zn(t,A,"8snorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8uint":{const b=Zn(t,A,"8uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba8sint":{const b=Zn(t,A,"8sint",4);return[b[0],b[1],b[2],b[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const b=Zn(t,A,"8unorm",4);return[b[2],b[1],b[0],b[3]]}case"r16uint":return[Zn(t,A,"16uint",1)[0]];case"r16sint":return[Zn(t,A,"16sint",1)[0]];case"r16float":return[Zn(t,A,"16float",1)[0]];case"rg16uint":{const b=Zn(t,A,"16uint",2);return[b[0],b[1]]}case"rg16sint":{const b=Zn(t,A,"16sint",2);return[b[0],b[1]]}case"rg16float":{const b=Zn(t,A,"16float",2);return[b[0],b[1]]}case"rgba16uint":{const b=Zn(t,A,"16uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16sint":{const b=Zn(t,A,"16sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16float":{const b=Zn(t,A,"16float",4);return[b[0],b[1],b[2],b[3]]}case"r32uint":return[Zn(t,A,"32uint",1)[0]];case"r32sint":return[Zn(t,A,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Zn(t,A,"32float",1)[0]];case"rg32uint":{const b=Zn(t,A,"32uint",2);return[b[0],b[1]]}case"rg32sint":{const b=Zn(t,A,"32sint",2);return[b[0],b[1]]}case"rg32float":{const b=Zn(t,A,"32float",2);return[b[0],b[1]]}case"rgba32uint":{const b=Zn(t,A,"32uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32sint":{const b=Zn(t,A,"32sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32float":{const b=Zn(t,A,"32float",4);return[b[0],b[1],b[2],b[3]]}case"rg11b10ufloat":{const b=new Uint32Array(t.buffer,A,1)[0],C=(4192256&b)>>11,S=(4290772992&b)>>22;return[AT(2047&b),AT(C),(function(D){const N=112+(D>>5&31)<<23|(31&D)<<18;return jw[0]=N,QO[0]})(S),1]}}return null}function Zn(t,e,r,n){const i=[0,0,0,0];for(let A=0;A<n;++A)switch(r){case"8unorm":i[A]=t[e]/255,e++;break;case"8snorm":i[A]=t[e]/255*2-1,e++;break;case"8uint":i[A]=t[e],e++;break;case"8sint":i[A]=t[e]-127,e++;break;case"16uint":i[A]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[A]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[A]=(o=t[e]|t[e+1]<<8,s=void 0,l=void 0,h=void 0,s=(32768&o)>>15,h=1023&o,(l=(31744&o)>>10)==0?(s?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):l==31?h?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,l-15)*(1+h/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[A]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[A]=new Float32Array(t.buffer,e,1)[0],e+=4}var o,s,l,h;return i}function ti(t,e,r,n,i){for(let o=0;o<n;++o)switch(r){case"8unorm":t[e]=255*i[o],e++;break;case"8snorm":t[e]=.5*(i[o]+1)*255,e++;break;case"8uint":t[e]=i[o],e++;break;case"8sint":t[e]=i[o]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[o],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[o],e+=2;break;case"16float":{const s=tH(i[o]);new Uint16Array(t.buffer,e,1)[0]=s,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[o],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[o],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[o],e+=4}return i}const ev={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Wa{constructor(){this.id=Wa._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(m_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(__.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Wa._id=0;let m_=class extends Wa{};m_.instance=new m_;class __ extends Wa{}__.instance=new __;const ZO=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ui extends Wa{constructor(){super()}}class Cg extends Ui{constructor(e,r,n,i,o,s){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(const r of this.attributes)e(r);e(this);for(const r of this.args)e(r);this.searchBlock(this.body,e)}}class nH extends Ui{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class $O extends Ui{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class x2 extends Ui{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class qO extends Ui{constructor(e,r,n,i){super(),this.init=e,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var r,n,i;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Xc extends Ui{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}let Hw=class extends Ui{constructor(t,e,r){super(),this.attributes=null,this.name=t,this.type=e,this.value=r}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}};class og extends Ui{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class k0 extends Ui{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var op,XA,mt,rt;(t=>{t.increment="++",t.decrement="--"})(op||(op={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(op||(op={}));class YO extends Ui{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(XA||(XA={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(XA||(XA={}));class eD extends Ui{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Vw extends Ui{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return ZO.has(this.name)}search(e){for(const r of this.args)r.search(e);e(this)}}class tD extends Ui{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class rD extends Ui{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}}class nD extends Ui{constructor(e,r,n,i){super(),this.condition=e,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class iD extends Ui{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class iH extends Ui{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class sH extends Ui{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class sD extends Ui{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class Ww extends Ui{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class oH extends Ui{constructor(){super()}get astNodeType(){return"discard"}}class oD extends Ui{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class aD extends Ui{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Nt extends Ui{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Nt._priority.get(r.name);Nt._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?Nt.i32:r}getTypeName(){return this.name}}Nt.x32=new Nt("x32"),Nt.f32=new Nt("f32"),Nt.i32=new Nt("i32"),Nt.u32=new Nt("u32"),Nt.f16=new Nt("f16"),Nt.bool=new Nt("bool"),Nt.void=new Nt("void"),Nt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gT extends Nt{constructor(e){super(e)}}class Jc extends Nt{constructor(e,r,n,i){super(e),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(const r of this.members)e(r)}}class ut extends Nt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ut.vec2f=new ut("vec2",Nt.f32,null),ut.vec3f=new ut("vec3",Nt.f32,null),ut.vec4f=new ut("vec4",Nt.f32,null),ut.vec2i=new ut("vec2",Nt.i32,null),ut.vec3i=new ut("vec3",Nt.i32,null),ut.vec4i=new ut("vec4",Nt.i32,null),ut.vec2u=new ut("vec2",Nt.u32,null),ut.vec3u=new ut("vec3",Nt.u32,null),ut.vec4u=new ut("vec4",Nt.u32,null),ut.vec2h=new ut("vec2",Nt.f16,null),ut.vec3h=new ut("vec3",Nt.f16,null),ut.vec4h=new ut("vec4",Nt.f16,null),ut.vec2b=new ut("vec2",Nt.bool,null),ut.vec3b=new ut("vec3",Nt.bool,null),ut.vec4b=new ut("vec4",Nt.bool,null),ut.mat2x2f=new ut("mat2x2",Nt.f32,null),ut.mat2x3f=new ut("mat2x3",Nt.f32,null),ut.mat2x4f=new ut("mat2x4",Nt.f32,null),ut.mat3x2f=new ut("mat3x2",Nt.f32,null),ut.mat3x3f=new ut("mat3x3",Nt.f32,null),ut.mat3x4f=new ut("mat3x4",Nt.f32,null),ut.mat4x2f=new ut("mat4x2",Nt.f32,null),ut.mat4x3f=new ut("mat4x3",Nt.f32,null),ut.mat4x4f=new ut("mat4x4",Nt.f32,null),ut.mat2x2h=new ut("mat2x2",Nt.f16,null),ut.mat2x3h=new ut("mat2x3",Nt.f16,null),ut.mat2x4h=new ut("mat2x4",Nt.f16,null),ut.mat3x2h=new ut("mat3x2",Nt.f16,null),ut.mat3x3h=new ut("mat3x3",Nt.f16,null),ut.mat3x4h=new ut("mat3x4",Nt.f16,null),ut.mat4x2h=new ut("mat4x2",Nt.f16,null),ut.mat4x3h=new ut("mat4x3",Nt.f16,null),ut.mat4x4h=new ut("mat4x4",Nt.f16,null),ut.mat2x2i=new ut("mat2x2",Nt.i32,null),ut.mat2x3i=new ut("mat2x3",Nt.i32,null),ut.mat2x4i=new ut("mat2x4",Nt.i32,null),ut.mat3x2i=new ut("mat3x2",Nt.i32,null),ut.mat3x3i=new ut("mat3x3",Nt.i32,null),ut.mat3x4i=new ut("mat3x4",Nt.i32,null),ut.mat4x2i=new ut("mat4x2",Nt.i32,null),ut.mat4x3i=new ut("mat4x3",Nt.i32,null),ut.mat4x4i=new ut("mat4x4",Nt.i32,null),ut.mat2x2u=new ut("mat2x2",Nt.u32,null),ut.mat2x3u=new ut("mat2x3",Nt.u32,null),ut.mat2x4u=new ut("mat2x4",Nt.u32,null),ut.mat3x2u=new ut("mat3x2",Nt.u32,null),ut.mat3x3u=new ut("mat3x3",Nt.u32,null),ut.mat3x4u=new ut("mat3x4",Nt.u32,null),ut.mat4x2u=new ut("mat4x2",Nt.u32,null),ut.mat4x3u=new ut("mat4x3",Nt.u32,null),ut.mat4x4u=new ut("mat4x4",Nt.u32,null);class tv extends Nt{constructor(e,r,n,i){super(e),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class ag extends Nt{constructor(e,r,n,i){super(e),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class QA extends Nt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class _c extends Wa{constructor(){super(),this.postfix=null}}class hf extends _c{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class nc extends _c{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}}class Jw extends _c{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return ZO.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(const r of this.args)r.search(e);e(this)}}class fa extends _c{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}}class lD extends _c{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class xs extends _c{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof tt}get isVector(){return this.value instanceof Ue||this.value instanceof on}get scalarValue(){return this.value instanceof tt?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ue||this.value instanceof on?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class cD extends _c{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Rp extends _c{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class uD extends _c{constructor(){super()}}class fs extends uD{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class fl extends uD{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Nt.f32:e.name==="u32"||r.name==="u32"?Nt.u32:Nt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class hD extends Wa{constructor(e){super(),this.body=e}}class N0 extends _c{constructor(){super()}get astNodeType(){return"default"}}class fD extends hD{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class dD extends hD{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class mT extends Wa{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class aH extends Wa{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class _T extends Wa{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class pD extends Wa{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}class Va{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=Va._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Va._id=0;class w2 extends Va{constructor(){super(new ja("void",null),null)}toString(){return"void"}}w2.void=new w2;class Sd extends Va{constructor(e){super(new ja("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,r,n,i){this.reference.setDataValue(e,r,n,i)}getSubData(e,r,n){return r?this.reference.getSubData(e,r,n):this}}class tt extends Va{constructor(e,r,n=null){super(r,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new tt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new tt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new tt(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof tt))return void console.error("SetDataValue: Invalid value",r);let o=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}}function lH(t,e,r){const n=e.length;return n===2?r==="f32"?new Ue(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new Ue(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new Ue(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new Ue(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new Ue(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new Ue(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new Ue(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new Ue(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new Ue(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new Ue(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new Ue(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new Ue(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Ue extends Va{constructor(e,r,n=null){if(super(r,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new Ue(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ue(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ue(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,n,i){n instanceof hf?console.error("TODO: Set vector postfix"):r instanceof Ue?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof uf)i=this.typeInfo.format||i;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?i=e.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?i=e.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?i=e.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?i=e.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let o=this;for(;r!==null&&o!==null;){if(r instanceof Rp){const s=r.index;let l=-1;if(s instanceof xs){if(!(s.value instanceof tt))return console.error(`GetSubData: Invalid array index ${s.value}`),null;l=s.value.value}else{const h=e.evalExpression(s,n);if(!(h instanceof tt))return console.error("GetSubData: Unknown index type",s),null;l=h.value}if(l<0||l>=o.data.length)return console.error("GetSubData: Index out of range",l),null;if(o.data instanceof Float32Array){const h=new Float32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new tt(h,i)}if(o.data instanceof Int32Array){const h=new Int32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new tt(h,i)}if(o.data instanceof Uint32Array){const h=new Uint32Array(o.data.buffer,o.data.byteOffset+4*l,1);return new tt(h,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof hf))return console.error("GetSubData: Unknown postfix",r),null;{const s=r.value.toLowerCase();if(s.length===1){let h=0;if(s==="x"||s==="r")h=0;else if(s==="y"||s==="g")h=1;else if(s==="z"||s==="b")h=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;h=3}if(this.data instanceof Float32Array){let A=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new tt(A,i,this)}if(this.data instanceof Int32Array){let A=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new tt(A,i,this)}if(this.data instanceof Uint32Array){let A=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new tt(A,i,this)}}const l=[];for(const h of s)h==="x"||h==="r"?l.push(this.data[0]):h==="y"||h==="g"?l.push(this.data[1]):h==="z"||h==="b"?l.push(this.data[2]):h==="w"||h==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);o=lH(e,l,i.name)}r=r.postfix}return o}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class on extends Va{constructor(e,r,n=null){super(r,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new on(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,n,i){n instanceof hf?console.error("TODO: Set matrix postfix"):r instanceof on?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof uf)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(r instanceof Rp){const o=r.index;let s=-1;if(o instanceof xs){if(!(o.value instanceof tt))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;s=o.value.value}else{const A=e.evalExpression(o,n);if(!(A instanceof tt))return console.error("GetDataValue: Unknown index type",o),null;s=A.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;const l=i.endsWith("h")?"h":"f";let h;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")h=new Ue(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")h=new Ue(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;h=new Ue(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${l}`))}return r.postfix?h.getSubData(e,r.postfix,n):h}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Yi extends Va{constructor(e,r,n=0,i=null){super(r,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Yi(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let o=this.offset,s=this.typeInfo;for(;n;){if(n instanceof Rp)if(s instanceof Qu){const l=n.index;if(l instanceof xs){if(!(l.value instanceof tt))return void console.error(`SetDataValue: Invalid index type ${l.value}`);o+=l.value.value*s.stride}else{const h=e.evalExpression(l,i);if(!(h instanceof tt))return void console.error("SetDataValue: Unknown index type",l);o+=h.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(n instanceof hf))return void console.error("SetDataValue: Unknown postfix type",n);{const l=n.value;if(s instanceof Vu){let h=!1;for(const A of s.members)if(A.name===l){o+=A.offset,s=A.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${l} not found`)}else if(s instanceof ja){const h=s.getTypeName();let A=0;if(l==="x"||l==="r")A=0;else if(l==="y"||l==="g")A=1;else if(l==="z"||l==="b")A=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);A=3}if(!(r instanceof tt))return void console.error("SetDataValue: Invalid value",r);const b=r.value;return h==="vec2f"?void(new Float32Array(this.buffer,o,2)[A]=b):h==="vec3f"?void(new Float32Array(this.buffer,o,3)[A]=b):h==="vec4f"?void(new Float32Array(this.buffer,o,4)[A]=b):h==="vec2i"?void(new Int32Array(this.buffer,o,2)[A]=b):h==="vec3i"?void(new Int32Array(this.buffer,o,3)[A]=b):h==="vec4i"?void(new Int32Array(this.buffer,o,4)[A]=b):h==="vec2u"?void(new Uint32Array(this.buffer,o,2)[A]=b):h==="vec3u"?void(new Uint32Array(this.buffer,o,3)[A]=b):h==="vec4u"?void(new Uint32Array(this.buffer,o,4)[A]=b):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}n=n.postfix}this.setData(e,r,s,o,i)}setData(e,r,n,i,o){const s=n.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool")if(s!=="vec2f"&&s!=="vec2h")if(s!=="vec3f"&&s!=="vec3h")if(s!=="vec4f"&&s!=="vec4h")if(s!=="vec2i")if(s!=="vec3i")if(s!=="vec4i")if(s!=="vec2u")if(s!=="vec3u")if(s!=="vec4u")if(s!=="vec2b")if(s!=="vec3b")if(s!=="vec4b")if(s!=="mat2x2f"&&s!=="mat2x2h")if(s!=="mat2x3f"&&s!=="mat2x3h")if(s!=="mat2x4f"&&s!=="mat2x4h")if(s!=="mat3x2f"&&s!=="mat3x2h")if(s!=="mat3x3f"&&s!=="mat3x3h")if(s!=="mat3x4f"&&s!=="mat3x4h")if(s!=="mat4x2f"&&s!=="mat4x2h")if(s!=="mat4x3f"&&s!=="mat4x3h")if(s!=="mat4x4f"&&s!=="mat4x4h")if(r instanceof Yi){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",s,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`);else{const l=new Float32Array(this.buffer,i,16);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7],l[8]=r.data[8],l[9]=r.data[9],l[10]=r.data[10],l[11]=r.data[11],l[12]=r.data[12],l[13]=r.data[13],l[14]=r.data[14],l[15]=r.data[15]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15])}else{const l=new Float32Array(this.buffer,i,12);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7],l[8]=r.data[8],l[9]=r.data[9],l[10]=r.data[10],l[11]=r.data[11]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11])}else{const l=new Float32Array(this.buffer,i,8);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7])}else{const l=new Float32Array(this.buffer,i,12);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7],l[8]=r.data[8],l[9]=r.data[9],l[10]=r.data[10],l[11]=r.data[11]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11])}else{const l=new Float32Array(this.buffer,i,9);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7],l[8]=r.data[8]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8])}else{const l=new Float32Array(this.buffer,i,6);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5])}else{const l=new Float32Array(this.buffer,i,8);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5],l[6]=r.data[6],l[7]=r.data[7]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7])}else{const l=new Float32Array(this.buffer,i,6);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3],l[4]=r.data[4],l[5]=r.data[5]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5])}else{const l=new Float32Array(this.buffer,i,4);r instanceof on?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3])}else{const l=new Uint32Array(this.buffer,i,4);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3])}else{const l=new Uint32Array(this.buffer,i,3);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2]):(l[0]=r[0],l[1]=r[1],l[2]=r[2])}else{const l=new Uint32Array(this.buffer,i,2);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1]):(l[0]=r[0],l[1]=r[1])}else{const l=new Uint32Array(this.buffer,i,4);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3])}else{const l=new Uint32Array(this.buffer,i,3);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2]):(l[0]=r[0],l[1]=r[1],l[2]=r[2])}else{const l=new Uint32Array(this.buffer,i,2);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1]):(l[0]=r[0],l[1]=r[1])}else{const l=new Int32Array(this.buffer,i,4);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3])}else{const l=new Int32Array(this.buffer,i,3);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2]):(l[0]=r[0],l[1]=r[1],l[2]=r[2])}else{const l=new Int32Array(this.buffer,i,2);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1]):(l[0]=r[0],l[1]=r[1])}else{const l=new Float32Array(this.buffer,i,4);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2],l[3]=r.data[3]):(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3])}else{const l=new Float32Array(this.buffer,i,3);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1],l[2]=r.data[2]):(l[0]=r[0],l[1]=r[1],l[2]=r[2])}else{const l=new Float32Array(this.buffer,i,2);r instanceof Ue?(l[0]=r.data[0],l[1]=r.data[1]):(l[0]=r[0],l[1]=r[1])}else r instanceof tt&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof tt&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof tt&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof tt&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(e,r,n){var i,o,s;if(r===null)return this;let l=this.offset,h=this.typeInfo;for(;r;){if(r instanceof Rp){const b=r.index,C=e.evalExpression(b,n);let S=0;if(C instanceof tt?S=C.value:console.error("GetDataValue: Invalid index type",b),h instanceof Qu)l+=S*h.stride,h=h.format;else{const D=h.getTypeName();D==="mat4x4"||D==="mat4x4f"||D==="mat4x4h"?(l+=16*S,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(r instanceof hf))return console.error("GetDataValue: Unknown postfix type",r),null;{const b=r.value;if(h instanceof Vu){let C=!1;for(const S of h.members)if(S.name===b){l+=S.offset,h=S.type,C=!0;break}if(!C)return console.error(`GetDataValue: Member ${b} not found`),null}else if(h instanceof ja){const C=h.getTypeName();if(C==="vec2f"||C==="vec3f"||C==="vec4f"||C==="vec2i"||C==="vec3i"||C==="vec4i"||C==="vec2u"||C==="vec3u"||C==="vec4u"||C==="vec2b"||C==="vec3b"||C==="vec4b"||C==="vec2h"||C==="vec3h"||C==="vec4h"||C==="vec2"||C==="vec3"||C==="vec4"){if(b.length>0&&b.length<5){let S="f";const D=[];for(let N=0;N<b.length;++N){const U=b[N].toLowerCase();let V=0;if(U==="x"||U==="r")V=0;else if(U==="y"||U==="g")V=1;else if(U==="z"||U==="b")V=2;else{if(U!=="w"&&U!=="a")return console.error(`Unknown member ${b}`),null;V=3}if(b.length===1){if(C.endsWith("f"))return this.buffer.byteLength<l+4*V+4?(console.log("Insufficient buffer data"),null):new tt(new Float32Array(this.buffer,l+4*V,1),e.getTypeInfo("f32"),this);if(C.endsWith("h"))return new tt(new Float32Array(this.buffer,l+4*V,1),e.getTypeInfo("f16"),this);if(C.endsWith("i"))return new tt(new Int32Array(this.buffer,l+4*V,1),e.getTypeInfo("i32"),this);if(C.endsWith("b"))return new tt(new Int32Array(this.buffer,l+4*V,1),e.getTypeInfo("bool"),this);if(C.endsWith("u"))return new tt(new Uint32Array(this.buffer,l+4*V,1),e.getTypeInfo("i32"),this)}if(C==="vec2f")D.push(new Float32Array(this.buffer,l,2)[V]);else if(C==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const j=new Float32Array(this.buffer,l,3);D.push(j[V])}else if(C==="vec4f")D.push(new Float32Array(this.buffer,l,4)[V]);else if(C==="vec2i")S="i",D.push(new Int32Array(this.buffer,l,2)[V]);else if(C==="vec3i")S="i",D.push(new Int32Array(this.buffer,l,3)[V]);else if(C==="vec4i")S="i",D.push(new Int32Array(this.buffer,l,4)[V]);else if(C==="vec2u"){S="u";const j=new Uint32Array(this.buffer,l,2);D.push(j[V])}else C==="vec3u"?(S="u",D.push(new Uint32Array(this.buffer,l,3)[V])):C==="vec4u"&&(S="u",D.push(new Uint32Array(this.buffer,l,4)[V]))}return D.length===2?h=e.getTypeInfo(`vec2${S}`):D.length===3?h=e.getTypeInfo(`vec3${S}`):D.length===4?h=e.getTypeInfo(`vec4${S}`):console.error(`GetDataValue: Invalid vector length ${D.length}`),new Ue(D,h,null)}return console.error(`GetDataValue: Unknown member ${b}`),null}return console.error(`GetDataValue: Type ${C} is not a struct`),null}}}r=r.postfix}const A=h.getTypeName();return A==="f32"?new tt(new Float32Array(this.buffer,l,1),h,this):A==="i32"?new tt(new Int32Array(this.buffer,l,1),h,this):A==="u32"?new tt(new Uint32Array(this.buffer,l,1),h,this):A==="vec2f"?new Ue(new Float32Array(this.buffer,l,2),h,this):A==="vec3f"?new Ue(new Float32Array(this.buffer,l,3),h,this):A==="vec4f"?new Ue(new Float32Array(this.buffer,l,4),h,this):A==="vec2i"?new Ue(new Int32Array(this.buffer,l,2),h,this):A==="vec3i"?new Ue(new Int32Array(this.buffer,l,3),h,this):A==="vec4i"?new Ue(new Int32Array(this.buffer,l,4),h,this):A==="vec2u"?new Ue(new Uint32Array(this.buffer,l,2),h,this):A==="vec3u"?new Ue(new Uint32Array(this.buffer,l,3),h,this):A==="vec4u"?new Ue(new Uint32Array(this.buffer,l,4),h,this):h instanceof uf&&h.name==="atomic"?((i=h.format)===null||i===void 0?void 0:i.name)==="u32"?new tt(new Uint32Array(this.buffer,l,1)[0],h.format,this):((o=h.format)===null||o===void 0?void 0:o.name)==="i32"?new tt(new Int32Array(this.buffer,l,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=h.format)===null||s===void 0?void 0:s.name}`),null):new Yi(this.buffer,h,l,this)}toString(){let e="";if(this.typeInfo instanceof Qu)if(this.typeInfo.format.name==="f32"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){const r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){const r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)e+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else e="[...]";else this.typeInfo instanceof Vu?e+="{...}":e="[...]";return e}}class Kc extends Va{constructor(e,r,n,i){super(r,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new Kc(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>e);return r}get texelByteSize(){const e=this.format,r=ev[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,r=ev[e];return!!r&&r.isDepthStencil}getGpuSize(){const e=this.format,r=ev[e],n=this.width;if(!e||n<=0||!r)return-1;const i=this.height,o=this.depthOrArrayLayers,s=this.dimension;return n/r.blockWidth*(s==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*o}getPixel(e,r,n=0,i=0){const o=this.texelByteSize,s=this.bytesPerRow,l=this.height,h=this.data[i];return rH(new Uint8Array(h),e,r,n,i,l,s,o,this.format)}setPixel(e,r,n,i,o){const s=this.texelByteSize,l=this.bytesPerRow,h=this.height,A=this.data[i];(function(b,C,S,D,N,U,V,j,ee,Q){const X=D*(V>>=N)*(U>>=N)+S*V+C*j;switch(ee){case"r8unorm":return void ti(b,X,"8unorm",1,Q);case"r8snorm":return void ti(b,X,"8snorm",1,Q);case"r8uint":return void ti(b,X,"8uint",1,Q);case"r8sint":return void ti(b,X,"8sint",1,Q);case"rg8unorm":return void ti(b,X,"8unorm",2,Q);case"rg8snorm":return void ti(b,X,"8snorm",2,Q);case"rg8uint":return void ti(b,X,"8uint",2,Q);case"rg8sint":return void ti(b,X,"8sint",2,Q);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void ti(b,X,"8unorm",4,Q);case"rgba8snorm":return void ti(b,X,"8snorm",4,Q);case"rgba8uint":return void ti(b,X,"8uint",4,Q);case"rgba8sint":return void ti(b,X,"8sint",4,Q);case"r16uint":return void ti(b,X,"16uint",1,Q);case"r16sint":return void ti(b,X,"16sint",1,Q);case"r16float":return void ti(b,X,"16float",1,Q);case"rg16uint":return void ti(b,X,"16uint",2,Q);case"rg16sint":return void ti(b,X,"16sint",2,Q);case"rg16float":return void ti(b,X,"16float",2,Q);case"rgba16uint":return void ti(b,X,"16uint",4,Q);case"rgba16sint":return void ti(b,X,"16sint",4,Q);case"rgba16float":return void ti(b,X,"16float",4,Q);case"r32uint":return void ti(b,X,"32uint",1,Q);case"r32sint":return void ti(b,X,"32sint",1,Q);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void ti(b,X,"32float",1,Q);case"rg32uint":return void ti(b,X,"32uint",2,Q);case"rg32sint":return void ti(b,X,"32sint",2,Q);case"rg32float":return void ti(b,X,"32float",2,Q);case"rgba32uint":return void ti(b,X,"32uint",4,Q);case"rgba32sint":return void ti(b,X,"32sint",4,Q);case"rgba32float":return void ti(b,X,"32float",4,Q);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(A),e,r,n,i,h,l,s,this.format,o)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(rt||(rt={}));class nt{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class Re{}mt=Re,Re.none=new nt("",rt.reserved,""),Re.eof=new nt("EOF",rt.token,""),Re.reserved={asm:new nt("asm",rt.reserved,"asm"),bf16:new nt("bf16",rt.reserved,"bf16"),do:new nt("do",rt.reserved,"do"),enum:new nt("enum",rt.reserved,"enum"),f16:new nt("f16",rt.reserved,"f16"),f64:new nt("f64",rt.reserved,"f64"),handle:new nt("handle",rt.reserved,"handle"),i8:new nt("i8",rt.reserved,"i8"),i16:new nt("i16",rt.reserved,"i16"),i64:new nt("i64",rt.reserved,"i64"),mat:new nt("mat",rt.reserved,"mat"),premerge:new nt("premerge",rt.reserved,"premerge"),regardless:new nt("regardless",rt.reserved,"regardless"),typedef:new nt("typedef",rt.reserved,"typedef"),u8:new nt("u8",rt.reserved,"u8"),u16:new nt("u16",rt.reserved,"u16"),u64:new nt("u64",rt.reserved,"u64"),unless:new nt("unless",rt.reserved,"unless"),using:new nt("using",rt.reserved,"using"),vec:new nt("vec",rt.reserved,"vec"),void:new nt("void",rt.reserved,"void")},Re.keywords={array:new nt("array",rt.keyword,"array"),atomic:new nt("atomic",rt.keyword,"atomic"),bool:new nt("bool",rt.keyword,"bool"),f32:new nt("f32",rt.keyword,"f32"),i32:new nt("i32",rt.keyword,"i32"),mat2x2:new nt("mat2x2",rt.keyword,"mat2x2"),mat2x3:new nt("mat2x3",rt.keyword,"mat2x3"),mat2x4:new nt("mat2x4",rt.keyword,"mat2x4"),mat3x2:new nt("mat3x2",rt.keyword,"mat3x2"),mat3x3:new nt("mat3x3",rt.keyword,"mat3x3"),mat3x4:new nt("mat3x4",rt.keyword,"mat3x4"),mat4x2:new nt("mat4x2",rt.keyword,"mat4x2"),mat4x3:new nt("mat4x3",rt.keyword,"mat4x3"),mat4x4:new nt("mat4x4",rt.keyword,"mat4x4"),ptr:new nt("ptr",rt.keyword,"ptr"),sampler:new nt("sampler",rt.keyword,"sampler"),sampler_comparison:new nt("sampler_comparison",rt.keyword,"sampler_comparison"),struct:new nt("struct",rt.keyword,"struct"),texture_1d:new nt("texture_1d",rt.keyword,"texture_1d"),texture_2d:new nt("texture_2d",rt.keyword,"texture_2d"),texture_2d_array:new nt("texture_2d_array",rt.keyword,"texture_2d_array"),texture_3d:new nt("texture_3d",rt.keyword,"texture_3d"),texture_cube:new nt("texture_cube",rt.keyword,"texture_cube"),texture_cube_array:new nt("texture_cube_array",rt.keyword,"texture_cube_array"),texture_multisampled_2d:new nt("texture_multisampled_2d",rt.keyword,"texture_multisampled_2d"),texture_storage_1d:new nt("texture_storage_1d",rt.keyword,"texture_storage_1d"),texture_storage_2d:new nt("texture_storage_2d",rt.keyword,"texture_storage_2d"),texture_storage_2d_array:new nt("texture_storage_2d_array",rt.keyword,"texture_storage_2d_array"),texture_storage_3d:new nt("texture_storage_3d",rt.keyword,"texture_storage_3d"),texture_depth_2d:new nt("texture_depth_2d",rt.keyword,"texture_depth_2d"),texture_depth_2d_array:new nt("texture_depth_2d_array",rt.keyword,"texture_depth_2d_array"),texture_depth_cube:new nt("texture_depth_cube",rt.keyword,"texture_depth_cube"),texture_depth_cube_array:new nt("texture_depth_cube_array",rt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new nt("texture_depth_multisampled_2d",rt.keyword,"texture_depth_multisampled_2d"),texture_external:new nt("texture_external",rt.keyword,"texture_external"),u32:new nt("u32",rt.keyword,"u32"),vec2:new nt("vec2",rt.keyword,"vec2"),vec3:new nt("vec3",rt.keyword,"vec3"),vec4:new nt("vec4",rt.keyword,"vec4"),bitcast:new nt("bitcast",rt.keyword,"bitcast"),block:new nt("block",rt.keyword,"block"),break:new nt("break",rt.keyword,"break"),case:new nt("case",rt.keyword,"case"),continue:new nt("continue",rt.keyword,"continue"),continuing:new nt("continuing",rt.keyword,"continuing"),default:new nt("default",rt.keyword,"default"),diagnostic:new nt("diagnostic",rt.keyword,"diagnostic"),discard:new nt("discard",rt.keyword,"discard"),else:new nt("else",rt.keyword,"else"),enable:new nt("enable",rt.keyword,"enable"),fallthrough:new nt("fallthrough",rt.keyword,"fallthrough"),false:new nt("false",rt.keyword,"false"),fn:new nt("fn",rt.keyword,"fn"),for:new nt("for",rt.keyword,"for"),function:new nt("function",rt.keyword,"function"),if:new nt("if",rt.keyword,"if"),let:new nt("let",rt.keyword,"let"),const:new nt("const",rt.keyword,"const"),loop:new nt("loop",rt.keyword,"loop"),while:new nt("while",rt.keyword,"while"),private:new nt("private",rt.keyword,"private"),read:new nt("read",rt.keyword,"read"),read_write:new nt("read_write",rt.keyword,"read_write"),return:new nt("return",rt.keyword,"return"),requires:new nt("requires",rt.keyword,"requires"),storage:new nt("storage",rt.keyword,"storage"),switch:new nt("switch",rt.keyword,"switch"),true:new nt("true",rt.keyword,"true"),alias:new nt("alias",rt.keyword,"alias"),type:new nt("type",rt.keyword,"type"),uniform:new nt("uniform",rt.keyword,"uniform"),var:new nt("var",rt.keyword,"var"),override:new nt("override",rt.keyword,"override"),workgroup:new nt("workgroup",rt.keyword,"workgroup"),write:new nt("write",rt.keyword,"write"),r8unorm:new nt("r8unorm",rt.keyword,"r8unorm"),r8snorm:new nt("r8snorm",rt.keyword,"r8snorm"),r8uint:new nt("r8uint",rt.keyword,"r8uint"),r8sint:new nt("r8sint",rt.keyword,"r8sint"),r16uint:new nt("r16uint",rt.keyword,"r16uint"),r16sint:new nt("r16sint",rt.keyword,"r16sint"),r16float:new nt("r16float",rt.keyword,"r16float"),rg8unorm:new nt("rg8unorm",rt.keyword,"rg8unorm"),rg8snorm:new nt("rg8snorm",rt.keyword,"rg8snorm"),rg8uint:new nt("rg8uint",rt.keyword,"rg8uint"),rg8sint:new nt("rg8sint",rt.keyword,"rg8sint"),r32uint:new nt("r32uint",rt.keyword,"r32uint"),r32sint:new nt("r32sint",rt.keyword,"r32sint"),r32float:new nt("r32float",rt.keyword,"r32float"),rg16uint:new nt("rg16uint",rt.keyword,"rg16uint"),rg16sint:new nt("rg16sint",rt.keyword,"rg16sint"),rg16float:new nt("rg16float",rt.keyword,"rg16float"),rgba8unorm:new nt("rgba8unorm",rt.keyword,"rgba8unorm"),rgba8unorm_srgb:new nt("rgba8unorm_srgb",rt.keyword,"rgba8unorm_srgb"),rgba8snorm:new nt("rgba8snorm",rt.keyword,"rgba8snorm"),rgba8uint:new nt("rgba8uint",rt.keyword,"rgba8uint"),rgba8sint:new nt("rgba8sint",rt.keyword,"rgba8sint"),bgra8unorm:new nt("bgra8unorm",rt.keyword,"bgra8unorm"),bgra8unorm_srgb:new nt("bgra8unorm_srgb",rt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new nt("rgb10a2unorm",rt.keyword,"rgb10a2unorm"),rg11b10float:new nt("rg11b10float",rt.keyword,"rg11b10float"),rg32uint:new nt("rg32uint",rt.keyword,"rg32uint"),rg32sint:new nt("rg32sint",rt.keyword,"rg32sint"),rg32float:new nt("rg32float",rt.keyword,"rg32float"),rgba16uint:new nt("rgba16uint",rt.keyword,"rgba16uint"),rgba16sint:new nt("rgba16sint",rt.keyword,"rgba16sint"),rgba16float:new nt("rgba16float",rt.keyword,"rgba16float"),rgba32uint:new nt("rgba32uint",rt.keyword,"rgba32uint"),rgba32sint:new nt("rgba32sint",rt.keyword,"rgba32sint"),rgba32float:new nt("rgba32float",rt.keyword,"rgba32float"),static_assert:new nt("static_assert",rt.keyword,"static_assert")},Re.tokens={decimal_float_literal:new nt("decimal_float_literal",rt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new nt("hex_float_literal",rt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new nt("int_literal",rt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new nt("uint_literal",rt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new nt("name",rt.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new nt("ident",rt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new nt("and",rt.token,"&"),and_and:new nt("and_and",rt.token,"&&"),arrow:new nt("arrow ",rt.token,"->"),attr:new nt("attr",rt.token,"@"),forward_slash:new nt("forward_slash",rt.token,"/"),bang:new nt("bang",rt.token,"!"),bracket_left:new nt("bracket_left",rt.token,"["),bracket_right:new nt("bracket_right",rt.token,"]"),brace_left:new nt("brace_left",rt.token,"{"),brace_right:new nt("brace_right",rt.token,"}"),colon:new nt("colon",rt.token,":"),comma:new nt("comma",rt.token,","),equal:new nt("equal",rt.token,"="),equal_equal:new nt("equal_equal",rt.token,"=="),not_equal:new nt("not_equal",rt.token,"!="),greater_than:new nt("greater_than",rt.token,">"),greater_than_equal:new nt("greater_than_equal",rt.token,">="),shift_right:new nt("shift_right",rt.token,">>"),less_than:new nt("less_than",rt.token,"<"),less_than_equal:new nt("less_than_equal",rt.token,"<="),shift_left:new nt("shift_left",rt.token,"<<"),modulo:new nt("modulo",rt.token,"%"),minus:new nt("minus",rt.token,"-"),minus_minus:new nt("minus_minus",rt.token,"--"),period:new nt("period",rt.token,"."),plus:new nt("plus",rt.token,"+"),plus_plus:new nt("plus_plus",rt.token,"++"),or:new nt("or",rt.token,"|"),or_or:new nt("or_or",rt.token,"||"),paren_left:new nt("paren_left",rt.token,"("),paren_right:new nt("paren_right",rt.token,")"),semicolon:new nt("semicolon",rt.token,";"),star:new nt("star",rt.token,"*"),tilde:new nt("tilde",rt.token,"~"),underscore:new nt("underscore",rt.token,"_"),xor:new nt("xor",rt.token,"^"),plus_equal:new nt("plus_equal",rt.token,"+="),minus_equal:new nt("minus_equal",rt.token,"-="),times_equal:new nt("times_equal",rt.token,"*="),division_equal:new nt("division_equal",rt.token,"/="),modulo_equal:new nt("modulo_equal",rt.token,"%="),and_equal:new nt("and_equal",rt.token,"&="),or_equal:new nt("or_equal",rt.token,"|="),xor_equal:new nt("xor_equal",rt.token,"^="),shift_right_equal:new nt("shift_right_equal",rt.token,">>="),shift_left_equal:new nt("shift_left_equal",rt.token,"<<=")},Re.simpleTokens={"@":mt.tokens.attr,"{":mt.tokens.brace_left,"}":mt.tokens.brace_right,":":mt.tokens.colon,",":mt.tokens.comma,"(":mt.tokens.paren_left,")":mt.tokens.paren_right,";":mt.tokens.semicolon},Re.literalTokens={"&":mt.tokens.and,"&&":mt.tokens.and_and,"->":mt.tokens.arrow,"/":mt.tokens.forward_slash,"!":mt.tokens.bang,"[":mt.tokens.bracket_left,"]":mt.tokens.bracket_right,"=":mt.tokens.equal,"==":mt.tokens.equal_equal,"!=":mt.tokens.not_equal,">":mt.tokens.greater_than,">=":mt.tokens.greater_than_equal,">>":mt.tokens.shift_right,"<":mt.tokens.less_than,"<=":mt.tokens.less_than_equal,"<<":mt.tokens.shift_left,"%":mt.tokens.modulo,"-":mt.tokens.minus,"--":mt.tokens.minus_minus,".":mt.tokens.period,"+":mt.tokens.plus,"++":mt.tokens.plus_plus,"|":mt.tokens.or,"||":mt.tokens.or_or,"*":mt.tokens.star,"~":mt.tokens.tilde,_:mt.tokens.underscore,"^":mt.tokens.xor,"+=":mt.tokens.plus_equal,"-=":mt.tokens.minus_equal,"*=":mt.tokens.times_equal,"/=":mt.tokens.division_equal,"%=":mt.tokens.modulo_equal,"&=":mt.tokens.and_equal,"|=":mt.tokens.or_equal,"^=":mt.tokens.xor_equal,">>=":mt.tokens.shift_right_equal,"<<=":mt.tokens.shift_left_equal},Re.regexTokens={decimal_float_literal:mt.tokens.decimal_float_literal,hex_float_literal:mt.tokens.hex_float_literal,int_literal:mt.tokens.int_literal,uint_literal:mt.tokens.uint_literal,ident:mt.tokens.ident},Re.storage_class=[mt.keywords.function,mt.keywords.private,mt.keywords.workgroup,mt.keywords.uniform,mt.keywords.storage],Re.access_mode=[mt.keywords.read,mt.keywords.write,mt.keywords.read_write],Re.sampler_type=[mt.keywords.sampler,mt.keywords.sampler_comparison],Re.sampled_texture_type=[mt.keywords.texture_1d,mt.keywords.texture_2d,mt.keywords.texture_2d_array,mt.keywords.texture_3d,mt.keywords.texture_cube,mt.keywords.texture_cube_array],Re.multisampled_texture_type=[mt.keywords.texture_multisampled_2d],Re.storage_texture_type=[mt.keywords.texture_storage_1d,mt.keywords.texture_storage_2d,mt.keywords.texture_storage_2d_array,mt.keywords.texture_storage_3d],Re.depth_texture_type=[mt.keywords.texture_depth_2d,mt.keywords.texture_depth_2d_array,mt.keywords.texture_depth_cube,mt.keywords.texture_depth_cube_array,mt.keywords.texture_depth_multisampled_2d],Re.texture_external_type=[mt.keywords.texture_external],Re.any_texture_type=[...mt.sampled_texture_type,...mt.multisampled_texture_type,...mt.storage_texture_type,...mt.depth_texture_type,...mt.texture_external_type],Re.texel_format=[mt.keywords.r8unorm,mt.keywords.r8snorm,mt.keywords.r8uint,mt.keywords.r8sint,mt.keywords.r16uint,mt.keywords.r16sint,mt.keywords.r16float,mt.keywords.rg8unorm,mt.keywords.rg8snorm,mt.keywords.rg8uint,mt.keywords.rg8sint,mt.keywords.r32uint,mt.keywords.r32sint,mt.keywords.r32float,mt.keywords.rg16uint,mt.keywords.rg16sint,mt.keywords.rg16float,mt.keywords.rgba8unorm,mt.keywords.rgba8unorm_srgb,mt.keywords.rgba8snorm,mt.keywords.rgba8uint,mt.keywords.rgba8sint,mt.keywords.bgra8unorm,mt.keywords.bgra8unorm_srgb,mt.keywords.rgb10a2unorm,mt.keywords.rg11b10float,mt.keywords.rg32uint,mt.keywords.rg32sint,mt.keywords.rg32float,mt.keywords.rgba16uint,mt.keywords.rgba16sint,mt.keywords.rgba16float,mt.keywords.rgba32uint,mt.keywords.rgba32sint,mt.keywords.rgba32float],Re.const_literal=[mt.tokens.int_literal,mt.tokens.uint_literal,mt.tokens.decimal_float_literal,mt.tokens.hex_float_literal,mt.keywords.true,mt.keywords.false],Re.literal_or_ident=[mt.tokens.ident,mt.tokens.int_literal,mt.tokens.uint_literal,mt.tokens.decimal_float_literal,mt.tokens.hex_float_literal,mt.tokens.name],Re.element_count_expression=[mt.tokens.int_literal,mt.tokens.uint_literal,mt.tokens.ident],Re.template_types=[mt.keywords.vec2,mt.keywords.vec3,mt.keywords.vec4,mt.keywords.mat2x2,mt.keywords.mat2x3,mt.keywords.mat2x4,mt.keywords.mat3x2,mt.keywords.mat3x3,mt.keywords.mat3x4,mt.keywords.mat4x2,mt.keywords.mat4x3,mt.keywords.mat4x4,mt.keywords.atomic,mt.keywords.bitcast,...mt.any_texture_type],Re.attribute_name=[mt.tokens.ident,mt.keywords.block,mt.keywords.diagnostic],Re.assignment_operators=[mt.tokens.equal,mt.tokens.plus_equal,mt.tokens.minus_equal,mt.tokens.times_equal,mt.tokens.division_equal,mt.tokens.modulo_equal,mt.tokens.and_equal,mt.tokens.or_equal,mt.tokens.xor_equal,mt.tokens.shift_right_equal,mt.tokens.shift_left_equal],Re.increment_operators=[mt.tokens.plus_plus,mt.tokens.minus_minus];class yT{constructor(e,r,n,i,o){this.type=e,this.lexeme=r,this.line=n,this.start=i,this.end=o}toString(){return this.lexeme}isTemplateType(){return Re.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Re.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class cH{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new yT(Re.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const r=Re.simpleTokens[e];if(r)return this._addToken(r),!0;let n=Re.none;const i=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(i){const s=Re.keywords[e];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(Re.tokens.ident),!0;for(;;){let s=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(Re.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(Re.tokens.minus_minus),!0;const h=this._tokens.length-1;if((Re.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==Re.tokens.paren_right)&&l!=">")return this._addToken(s),!0}if(e==">"&&(l==">"||l=="=")){let h=!1,A=this._tokens.length-1;for(let b=0;b<5&&A>=0&&Re.assignment_operators.indexOf(this._tokens[A].type)===-1;++b,--A)if(this._tokens[A].type===Re.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(s),!0}if(s===Re.none){let h=e,A=0;const b=2;for(let C=0;C<b;++C)if(h+=this._peekAhead(C),s=this._findType(h),s!==Re.none){A=C;break}if(s===Re.none)return n!==Re.none&&(this._current--,this._addToken(n),!0);e=h,this._current+=A+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n!==Re.none&&(this._addToken(n),!0)}_findType(e){for(const r in Re.regexTokens){const n=Re.regexTokens[r];if(this._match(e,n.rule))return n}return Re.literalTokens[e]||Re.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new yT(e,r,this._line,this._start,this._current))}}function pr(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}const y_=new Float32Array(1),uH=new Uint32Array(y_.buffer),hH=new Uint32Array(y_.buffer),b_=new Int32Array(1),fH=new Float32Array(b_.buffer),dH=new Uint32Array(b_.buffer),v_=new Uint32Array(1),pH=new Float32Array(v_.buffer),AH=new Int32Array(v_.buffer);function bT(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return y_[0]=t,uH[0];if(r==="u32")return y_[0]=t,hH[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return b_[0]=t,fH[0];if(r==="u32")return b_[0]=t,dH[0]}else if(e==="u32"){if(r==="f32")return v_[0]=t,pH[0];if(r==="i32"||r==="x32")return v_[0]=t,AH[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}class gH{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Vm{constructor(e,r){this.align=e,this.size=r}}class lc{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Yj,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const r of e)r instanceof Cg&&this._functions.set(r.name,new gH(r));for(const r of e)if(r instanceof Jc){const n=this.getTypeInfo(r,null);n instanceof Vu&&this.structs.push(n)}for(const r of e)if(r instanceof Ww)this.aliases.push(this._getAliasInfo(r));else if(r instanceof Hw){const n=r,i=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new Zj(n.name,o,n.attributes,i))}else if(this._isUniformVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=new Hm(n.name,s,i,o,n.attributes,ju.Uniform,n.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(s),h=new Hm(n.name,s,i,o,n.attributes,l?ju.StorageTexture:ju.Storage,n.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(s),h=new Hm(n.name,s,i,o,n.attributes,l?ju.StorageTexture:ju.Texture,n.access);h.access||(h.access="read"),l?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),l=new Hm(n.name,s,i,o,n.attributes,ju.Sampler,n.access);this.samplers.push(l)}else if(r instanceof Cg){const n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),s=n||i||o,l=new qj(r.name,s?.name,r.attributes);l.attributes=r.attributes,l.startLine=r.startLine,l.endLine=r.endLine,this.functions.push(l),this._functions.get(r.name).info=l,s&&(this._functions.get(r.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(r,!!s),l.inputs=this._getInputs(r.args),l.outputs=this._getOutputs(r.returnType),this.entry[s.name].push(l)),l.arguments=r.args.map(h=>new $j(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),l.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var i,o,s;if(n instanceof pD){if(n.value)if(pr(n.value))for(const l of n.value)for(const h of this.overrides)l===h.name&&((i=r.info)===null||i===void 0||i.overrides.push(h));else for(const l of this.overrides)n.value===l.name&&((o=r.info)===null||o===void 0||o.overrides.push(l))}else if(n instanceof fa)for(const l of this.overrides)n.name===l.name&&((s=r.info)===null||s===void 0||s.overrides.push(l))});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}getStructInfo(e){for(const r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(const r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const i of e.calls){const o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&r.add(o)}}findResource(e,r,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}for(const i of this.entry.vertex)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}for(const i of this.entry.fragment)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}}for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],i=this,o=[];return e.search(s=>{if(s instanceof m_)o.push({});else if(s instanceof __)o.pop();else if(s instanceof Xc){const l=s;r&&l.type!==null&&this._markStructsFromAST(l.type),o.length>0&&(o[o.length-1][l.name]=l)}else if(s instanceof nc){const l=s;r&&l.type!==null&&this._markStructsFromAST(l.type)}else if(s instanceof og){const l=s;r&&l.type!==null&&this._markStructsFromAST(l.type),o.length>0&&(o[o.length-1][l.name]=l)}else if(s instanceof fa){const l=s;if(o.length>0&&o[o.length-1][l.name])return;const h=i._findResource(l.name);h&&n.push(h)}else if(s instanceof Jw){const l=s,h=i._functions.get(l.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,r)),n.push(...h.resources))}else if(s instanceof Vw){const l=s,h=i._functions.get(l.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=i._findResources(h.node,r)),n.push(...h.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function r(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)r(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Jc)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Jc)this._getStructOutputs(n.type,r);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const o=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),l=new pT(n.name,o,i.name,s);r.push(l)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(r.value);return new pT("",n,r.name,i)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Jc)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Jc)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(r.value),s=new Qj(e.name,i,r.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new Xj(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const r of this.structs)if(r.name==e)return r;for(const r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof ag){const i=e,o=i.format?this.getTypeInfo(i.format,i.attributes):null,s=new Qu(i.name,r);return s.format=o,s.count=i.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Jc){const i=e,o=new Vu(i.name,r);o.startLine=i.startLine,o.endLine=i.endLine;for(const s of i.members){const l=this.getTypeInfo(s.type,s.attributes);o.members.push(new dT(s.name,l,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof QA){const i=e,o=i.format instanceof Nt,s=i.format?o?this.getTypeInfo(i.format,null):new ja(i.format,null):null,l=new uf(i.name,s,r,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof ut){const i=e,o=i.format?this.getTypeInfo(i.format,null):null,s=new uf(i.name,o,r,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new ja(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n,i;const o=this._getTypeSize(e);if(e.size=(r=o?.size)!==null&&r!==void 0?r:0,e instanceof Qu&&e.format){const s=this._getTypeSize(e.format);e.stride=Math.max((n=s?.size)!==null&&n!==void 0?n:0,(i=s?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof Vu&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,i=0,o=0,s=0;for(let l=0,h=e.members.length;l<h;++l){const A=e.members[l],b=this._getTypeSize(A);if(!b)continue;(r=this._getAlias(A.type.name))!==null&&r!==void 0||A.type;const C=b.align,S=b.size;n=this._roundUp(C,n+i),i=S,o=n,s=Math.max(s,C),A.offset=n,A.size=S,this._updateTypeInfo(A.type)}e.size=this._roundUp(s,o+i),e.align=s}_getTypeSize(e){var r,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof dT&&(e=e.type),e instanceof ja){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=lc._typeInfo[e.name];if(s!==void 0){const l=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Vm(Math.max(o,s.align/l),Math.max(i,s.size/l))}}{const s=lc._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const l=e.name[e.name.length-1]==="h"?2:1;return new Vm(Math.max(o,s.align/l),Math.max(i,s.size/l))}}if(e instanceof Qu){let s=e,l=8,h=8;const A=this._getTypeSize(s.format);return A!==null&&(h=A.size,l=A.align),h=s.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,h)),i&&(h=i),new Vm(Math.max(o,l),Math.max(i,h))}if(e instanceof Vu){let s=0,l=0,h=0,A=0,b=0;for(const C of e.members){const S=this._getTypeSize(C.type);S!==null&&(s=Math.max(S.align,s),h=this._roundUp(S.align,h+A),A=S.size,b=h)}return l=this._roundUp(s,b+A),new Vm(Math.max(o,s),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof Xc&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Xc&&e.storage=="storage"}_isTextureVar(e){return e instanceof Xc&&e.type!==null&&lc._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Xc&&e.type!==null&&lc._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let i of e)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}lc._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},lc._textureTypes=Re.any_texture_type.map(t=>t.name),lc._samplerTypes=Re.sampler_type.map(t=>t.name);class Kw{constructor(e,r,n){this.name=e,this.value=r,this.node=n}clone(){return new Kw(this.name,this.value,this.node)}}class Xw{constructor(e){this.name=e.name,this.node=e}clone(){return new Xw(this.node)}}class Qw{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,n){this.variables.set(e,new Kw(e,r,n??null))}setVariable(e,r,n){const i=this.getVariable(e);i!==null?i.value=r:this.createVariable(e,r,n)}getVariableValue(e){var r;return(r=this.getVariable(e)?.value)!==null&&r!==void 0?r:null}clone(){return new Qw(this)}}class mH{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}}class _H{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){const n=this.exec.evalExpression(e.args[0],r);let i=!0;if(n instanceof Ue)return n.data.forEach(o=>{o||(i=!1)}),new tt(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue){const i=n.data.some(o=>o);return new tt(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){const n=this.exec.evalExpression(e.args[2],r);if(!(n instanceof tt))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.evalExpression(n,r);if(i instanceof Yi&&i.typeInfo.size===0){const o=i.typeInfo,s=i.buffer.byteLength/o.stride;return new tt(s,this.getTypeInfo("u32"))}return new tt(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.abs(o)),n.typeInfo);const i=n;return new tt(Math.abs(i.value),i.typeInfo)}Acos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.acos(o)),n.typeInfo);const i=n;return new tt(Math.acos(i.value),n.typeInfo)}Acosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.acosh(o)),n.typeInfo);const i=n;return new tt(Math.acosh(i.value),n.typeInfo)}Asin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.asin(o)),n.typeInfo);const i=n;return new tt(Math.asin(i.value),n.typeInfo)}Asinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.asinh(o)),n.typeInfo);const i=n;return new tt(Math.asinh(i.value),n.typeInfo)}Atan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.atan(o)),n.typeInfo);const i=n;return new tt(Math.atan(i.value),n.typeInfo)}Atanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.atanh(o)),n.typeInfo);const i=n;return new tt(Math.atanh(i.value),n.typeInfo)}Atan2(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((l,h)=>Math.atan2(l,i.data[h])),n.typeInfo);const o=n,s=i;return new tt(Math.atan2(o.value,s.value),n.typeInfo)}Ceil(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.ceil(o)),n.typeInfo);const i=n;return new tt(Math.ceil(i.value),n.typeInfo)}_clamp(e,r,n){return Math.min(Math.max(e,r),n)}Clamp(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Ue&&i instanceof Ue&&o instanceof Ue)return new Ue(n.data.map((A,b)=>this._clamp(A,i.data[b],o.data[b])),n.typeInfo);const s=n,l=i,h=o;return new tt(this._clamp(s.value,l.value,h.value),n.typeInfo)}Cos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.cos(o)),n.typeInfo);const i=n;return new tt(Math.cos(i.value),n.typeInfo)}Cosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.cosh(o)),n.typeInfo);const i=n;return new tt(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.clz32(o)),n.typeInfo);const i=n;return new tt(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>this._countOneBits(o)),n.typeInfo);const i=n;return new tt(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);const i=n;return new tt(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=n.data,s=i.data;return new Ue([o[1]*s[2]-s[1]*o[2],o[2]*s[0]-s[2]*o[0],o[0]*s[1]-s[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){const n=this.exec.evalExpression(e.args[0],r),i=180/Math.PI;return n instanceof Ue?new Ue(n.data.map(o=>o*i),n.typeInfo):new tt(n.value*i,this.getTypeInfo("f32"))}Determinant(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof on){const i=n.data,o=n.typeInfo.getTypeName(),s=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new tt(i[0]*i[3]-i[1]*i[2],s);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new tt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new tt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),s);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue){let l=0;for(let h=0;h<n.data.length;++h)l+=(n.data[h]-i.data[h])*(n.data[h]-i.data[h]);return new tt(Math.sqrt(l),this.getTypeInfo("f32"))}const o=n,s=i;return new tt(Math.abs(o.value-s.value),n.typeInfo)}_dot(e,r){let n=0;for(let i=0;i<e.length;++i)n+=r[i]*e[i];return n}Dot(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);return n instanceof Ue&&i instanceof Ue?new tt(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.exp(o)),n.typeInfo);const i=n;return new tt(Math.exp(i.value),n.typeInfo)}Exp2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.pow(2,o)),n.typeInfo);const i=n;return new tt(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const s=i.value,l=o.value;if(n instanceof Ue)return new Ue(n.data.map(A=>A>>s&(1<<l)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=n.value;return new tt(h>>s&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Ue&&i instanceof Ue&&o instanceof Ue){const s=this._dot(i.data,o.data);return new Ue(s<0?Array.from(n.data):n.data.map(l=>-l),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);const i=n;return new tt(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);const i=n;return new tt(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.floor(o)),n.typeInfo);const i=n;return new tt(Math.floor(i.value),n.typeInfo)}Fma(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Ue&&i instanceof Ue&&o instanceof Ue)return n.data.length!==i.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ue(n.data.map((A,b)=>A*i.data[b]+o.data[b]),n.typeInfo);const s=n,l=i,h=o;return new tt(s.value*l.value+h.value,s.typeInfo)}Fract(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>o-Math.floor(o)),n.typeInfo);const i=n;return new tt(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r),s=this.exec.evalExpression(e.args[3],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=o.value,h=(1<<s.value)-1<<l,A=~h;if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((S,D)=>S&A|i.data[D]<<l&h),n.typeInfo);const b=n.value,C=i.value;return new tt(b&A|C<<l&h,n.typeInfo)}InverseSqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);const i=n;return new tt(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue){let o=0;return n.data.forEach(s=>{o+=s*s}),new tt(Math.sqrt(o),this.getTypeInfo("f32"))}const i=n;return new tt(Math.abs(i.value),n.typeInfo)}Log(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.log(o)),n.typeInfo);const i=n;return new tt(Math.log(i.value),n.typeInfo)}Log2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.log2(o)),n.typeInfo);const i=n;return new tt(Math.log2(i.value),n.typeInfo)}Max(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((l,h)=>Math.max(l,i.data[h])),n.typeInfo);const o=n,s=i;return new tt(Math.max(o.value,s.value),n.typeInfo)}Min(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((l,h)=>Math.min(l,i.data[h])),n.typeInfo);const o=n,s=i;return new tt(Math.min(o.value,s.value),n.typeInfo)}Mix(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Ue&&i instanceof Ue&&o instanceof Ue)return new Ue(n.data.map((h,A)=>n.data[A]*(1-o.data[A])+i.data[A]*o.data[A]),n.typeInfo);const s=i,l=o;return new tt(n.value*(1-l.value)+s.value*l.value,n.typeInfo)}Modf(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((s,l)=>s%i.data[l]),n.typeInfo);const o=i;return new tt(n.value%o.value,n.typeInfo)}Normalize(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue){const i=this.Length(e,r).value;return new Ue(n.data.map(o=>o/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue)return new Ue(n.data.map((l,h)=>Math.pow(l,i.data[h])),n.typeInfo);const o=n,s=i;return new tt(Math.pow(o.value,s.value),n.typeInfo)}QuantizeToF16(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ue?new Ue(n.data.map(i=>i),n.typeInfo):new tt(n.value,n.typeInfo)}Radians(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ue?new Ue(n.data.map(i=>i*Math.PI/180),n.typeInfo):new tt(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ue&&i instanceof Ue){const o=this._dot(n.data,i.data);return new Ue(n.data.map((s,l)=>s-2*o*i.data[l]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Ue&&i instanceof Ue&&o instanceof tt){const s=this._dot(i.data,n.data);return new Ue(n.data.map((l,h)=>{const A=1-o.value*o.value*(1-s*s);if(A<0)return 0;const b=Math.sqrt(A);return o.value*l-(o.value*s+b)*i.data[h]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.round(o)),n.typeInfo);const i=n;return new tt(Math.round(i.value),n.typeInfo)}Saturate(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);const i=n;return new tt(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.sign(o)),n.typeInfo);const i=n;return new tt(Math.sign(i.value),n.typeInfo)}Sin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.sin(o)),n.typeInfo);const i=n;return new tt(Math.sin(i.value),n.typeInfo)}Sinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.sinh(o)),n.typeInfo);const i=n;return new tt(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,r,n){const i=Math.min(Math.max((n-e)/(r-e),0),1);return i*i*(3-2*i)}SmoothStep(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(o instanceof Ue&&n instanceof Ue&&i instanceof Ue)return new Ue(o.data.map((A,b)=>this._smoothstep(n.data[b],i.data[b],A)),o.typeInfo);const s=n,l=i,h=o;return new tt(this._smoothstep(s.value,l.value,h.value),o.typeInfo)}Sqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.sqrt(o)),n.typeInfo);const i=n;return new tt(Math.sqrt(i.value),n.typeInfo)}Step(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(i instanceof Ue&&n instanceof Ue)return new Ue(i.data.map((s,l)=>s<n.data[l]?0:1),i.typeInfo);const o=n;return new tt(i.value<o.value?0:1,o.typeInfo)}Tan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.tan(o)),n.typeInfo);const i=n;return new tt(Math.tan(i.value),n.typeInfo)}Tanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.tanh(o)),n.typeInfo);const i=n;return new tt(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){const n=this.exec.evalExpression(e.args[0],r);if(!(n instanceof on))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const o=n.data;return new on([o[0],o[2],o[1],o[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const o=n.data;return new on([o[0],o[3],o[6],o[1],o[4],o[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const o=n.data;return new on([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const o=n.data;return new on([o[0],o[3],o[1],o[4],o[2],o[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const o=n.data;return new on([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const o=n.data;return new on([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const o=n.data;return new on([o[0],o[4],o[1],o[5],o[2],o[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const o=n.data;return new on([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const o=n.data;return new on([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ue)return new Ue(n.data.map(o=>Math.trunc(o)),n.typeInfo);const i=n;return new tt(Math.trunc(i.value),n.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(n instanceof fa){const o=n.name,s=r.getVariableValue(o);if(s instanceof Kc){if(i<0||i>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=s.getMipLevelSize(i),h=s.dimension;return h==="1d"?new tt(l[0],this.getTypeInfo("u32")):h==="3d"?new Ue(l,this.getTypeInfo("vec3u")):h==="2d"?new Ue(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),o=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(i instanceof Ue)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof fa){const s=n.name,l=r.getVariableValue(s);if(l instanceof Kc){const h=Math.floor(i.data[0]),A=Math.floor(i.data[1]);if(h<0||h>=l.width||A<0||A>=l.height)return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;const b=l.getPixel(h,A,0,o);return b===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ue(b,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){const n=e.args[0];if(n instanceof fa){const i=n.name,o=r.getVariableValue(i);return o instanceof Kc?new tt(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){const n=e.args[0];if(n instanceof fa){const i=n.name,o=r.getVariableValue(i);return o instanceof Kc?new tt(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){const n=e.args[0];if(n instanceof fa){const i=n.name,o=r.getVariableValue(i);return o instanceof Kc?new tt(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),o=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,s=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Ue)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof fa){const l=n.name,h=r.getVariableValue(l);if(h instanceof Kc){const A=h.getMipLevelSize(0),b=Math.floor(i.data[0]),C=Math.floor(i.data[1]);return b<0||b>=A[0]||C<0||C>=A[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(h.setPixel(b,C,0,o,Array.from(s)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r);return h instanceof tt&&l instanceof tt&&(h.value=l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),null}AtomicAdd(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value+=l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicSub(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value-=l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicMax(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=Math.max(h.value,l.value)),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicMin(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=Math.min(h.value,l.value)),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicAnd(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=h.value&l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicOr(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=h.value|l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicXor(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=h.value^l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicExchange(e,r){let n=e.args[0];n instanceof fs&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let s=e.args[1];const l=this.exec.evalExpression(s,r),h=o.value.getSubData(this.exec,n.postfix,r),A=new tt(h.value,h.typeInfo);return h instanceof tt&&l instanceof tt&&(h.value=l.value),o.value instanceof Yi&&o.value.setDataValue(this.exec,h,n.postfix,r),A}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}}const rv={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Io={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class mo extends mH{constructor(e,r){var n;super(),this.ast=e??[],this.reflection=new lc,this.reflection.updateAST(this.ast),this.context=(n=r?.clone())!==null&&n!==void 0?n:new Qw,this.builtins=new _H(this),this.typeInfo={bool:this.getTypeInfo(Nt.bool),i32:this.getTypeInfo(Nt.i32),u32:this.getTypeInfo(Nt.u32),f32:this.getTypeInfo(Nt.f32),f16:this.getTypeInfo(Nt.f16),vec2f:this.getTypeInfo(ut.vec2f),vec2u:this.getTypeInfo(ut.vec2u),vec2i:this.getTypeInfo(ut.vec2i),vec2h:this.getTypeInfo(ut.vec2h),vec3f:this.getTypeInfo(ut.vec3f),vec3u:this.getTypeInfo(ut.vec3u),vec3i:this.getTypeInfo(ut.vec3i),vec3h:this.getTypeInfo(ut.vec3h),vec4f:this.getTypeInfo(ut.vec4f),vec4u:this.getTypeInfo(ut.vec4u),vec4i:this.getTypeInfo(ut.vec4i),vec4h:this.getTypeInfo(ut.vec4h),mat2x2f:this.getTypeInfo(ut.mat2x2f),mat2x3f:this.getTypeInfo(ut.mat2x3f),mat2x4f:this.getTypeInfo(ut.mat2x4f),mat3x2f:this.getTypeInfo(ut.mat3x2f),mat3x3f:this.getTypeInfo(ut.mat3x3f),mat3x4f:this.getTypeInfo(ut.mat3x4f),mat4x2f:this.getTypeInfo(ut.mat4x2f),mat4x3f:this.getTypeInfo(ut.mat4x3f),mat4x4f:this.getTypeInfo(ut.mat4x4f)}}getVariableValue(e){var r,n;const i=(n=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof tt)return i.value;if(i instanceof Ue||i instanceof on)return Array.from(i.data);if(i instanceof Yi&&i.typeInfo instanceof Qu){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,n,i){const o=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,o),this._execStatements(this.ast,o);const s=o.getFunction(e);if(!s)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}const l=r[0],h=r[1],A=r[2],b=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new Ue(r,b));for(const C in n)for(const S in n[C]){const D=n[C][S];o.variables.forEach(N=>{var U;const V=N.node;if(V?.attributes){let j=null,ee=null;for(const Q of V.attributes)Q.name==="binding"?j=Q.value:Q.name==="group"&&(ee=Q.value);if(S==j&&C==ee)if(D.texture!==void 0&&D.descriptor!==void 0){const Q=new Kc(D.texture,this.getTypeInfo(V.type),D.descriptor,(U=D.texture.view)!==null&&U!==void 0?U:null);N.value=Q}else D.uniform!==void 0?N.value=new Yi(D.uniform,this.getTypeInfo(V.type)):N.value=new Yi(D,this.getTypeInfo(V.type))}})}for(let C=0;C<A;++C)for(let S=0;S<h;++S)for(let D=0;D<l;++D)o.setVariable("@workgroup_id",new Ue([D,S,C],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[D,S,C],o)}execStatement(e,r){if(e instanceof iD)return this.evalExpression(e.value,r);if(e instanceof oD){if(e.condition){const n=this.evalExpression(e.condition,r);if(!(n instanceof tt))throw new Error("Invalid break-if condition");if(!n.value)return null}return mo._breakObj}if(e instanceof aD)return mo._continueObj;if(e instanceof og)this._let(e,r);else if(e instanceof Xc)this._var(e,r);else if(e instanceof k0)this._const(e,r);else if(e instanceof Cg)this._function(e,r);else{if(e instanceof nD)return this._if(e,r);if(e instanceof rD)return this._switch(e,r);if(e instanceof qO)return this._for(e,r);if(e instanceof $O)return this._while(e,r);if(e instanceof tD)return this._loop(e,r);if(e instanceof x2){const n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof eD)this._assign(e,r);else if(e instanceof YO)this._increment(e,r);else{if(e instanceof Jc)return null;if(e instanceof Hw){const n=e.name;r.getVariable(n)===null&&r.setVariable(n,new tt(0,this.getTypeInfo("u32")))}else if(e instanceof Vw)this._call(e,r);else{if(e instanceof sD||e instanceof Ww)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof fl?this._evalBinaryOp(e,r):e instanceof xs?this._evalLiteral(e,r):e instanceof fa?this._evalVariable(e,r):e instanceof Jw?this._evalCall(e,r):e instanceof nc?this._evalCreate(e,r):e instanceof lD?this._evalConst(e,r):e instanceof cD?this._evalBitcast(e,r):e instanceof fs?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Nt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,r){for(const n in e){const i=e[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?r.setVariable(n,new tt(i,o.type)):o.type.name==="bool"?r.setVariable(n,new tt(i?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?r.setVariable(n,new Ue(i,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,n){const i=[1,1,1];for(const b of e.node.attributes)if(b.name==="workgroup_size"){if(b.value.length>0){const C=n.getVariableValue(b.value[0]);i[0]=C instanceof tt?C.value:parseInt(b.value[0])}if(b.value.length>1){const C=n.getVariableValue(b.value[1]);i[1]=C instanceof tt?C.value:parseInt(b.value[1])}if(b.value.length>2){const C=n.getVariableValue(b.value[2]);i[2]=C instanceof tt?C.value:parseInt(b.value[2])}}const o=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ue(i,o));const l=i[0],h=i[1],A=i[2];for(let b=0,C=0;b<A;++b)for(let S=0;S<h;++S)for(let D=0;D<l;++D,++C){const N=[D,S,b],U=[D+r[0]*i[0],S+r[1]*i[1],b+r[2]*i[2]];n.setVariable("@local_invocation_id",new Ue(N,o)),n.setVariable("@global_invocation_id",new Ue(U,o)),n.setVariable("@local_invocation_index",new tt(C,s)),this._dispatchExec(e,n)}}_dispatchExec(e,r){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const o=`@${i.value}`,s=r.getVariable(o);s!==void 0&&r.variables.set(n.name,s)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof fs;)e=e.right;return e instanceof fa?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(const n of e){if(n instanceof Array){const o=r.clone(),s=this._execStatements(n,o);if(s)return s;continue}const i=this.execStatement(n,r);if(i)return i}return null}_call(e,r){const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(i){for(let o=0;o<i.node.args.length;++o){const s=i.node.args[o],l=this.evalExpression(e.args[o],n);n.setVariable(s.name,l,s)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){const n=this.getVariableName(e.variable,r),i=r.getVariable(n);i?e.operator==="++"?i.value instanceof tt?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof tt?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof fa){const n=this.getVariableName(e,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,r)}if(e instanceof fs){if(e.operator==="*"){const n=this._getVariableData(e.right,r);return n instanceof Sd?n.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,r);return new Sd(n)}}return null}_assign(e,r){let n=null,i="<var>",o=null;if(e.variable instanceof fs){const h=this._getVariableData(e.variable,r),A=this.evalExpression(e.value,r),b=e.operator;if(b==="="){if(h instanceof tt||h instanceof Ue||h instanceof on){if(A instanceof tt||A instanceof Ue||A instanceof on&&h.data.length===A.data.length)return void h.data.set(A.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof Yi&&A instanceof Yi&&h.buffer.byteLength-h.offset>=A.buffer.byteLength-A.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(A.buffer,A.offset,A.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(b==="+=")return h instanceof tt||h instanceof Ue||h instanceof on?A instanceof tt||A instanceof Ue||A instanceof on?void h.data.set(A.data.map((C,S)=>h.data[S]+C)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(b==="-=")return(h instanceof tt||h instanceof Ue||h instanceof on)&&(A instanceof tt||A instanceof Ue||A instanceof on)?void h.data.set(A.data.map((C,S)=>h.data[S]-C)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof fs){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,r);const h=r.getVariable(i);if(!(h&&h.value instanceof Sd))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=h.value.reference;let A=e.variable.postfix;if(!A){let b=e.variable.right;for(;b instanceof fs;){if(b.postfix){A=b.postfix;break}b=b.right}}A&&(n=n.getSubData(this,A,r))}}else{o=e.variable.postfix,i=this.getVariableName(e.variable,r);const h=r.getVariable(i);if(h===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=h.value}if(n instanceof Sd&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const s=this.evalExpression(e.value,r),l=e.operator;if(l==="=")if(n instanceof Yi)n.setDataValue(this,s,o,r);else if(o){if(!(n instanceof Ue||n instanceof on))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(o instanceof Rp){const h=this.evalExpression(o.index,r).value;if(n instanceof Ue){if(!(s instanceof tt))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[h]=s.value}else{if(!(n instanceof on))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const A=this.evalExpression(o.index,r).value;if(A<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(s instanceof Ue))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const b=n.typeInfo.getTypeName();if(b==="mat2x2"||b==="mat2x2f"||b==="mat2x2h"){if(!(A<2&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*A]=s.data[0],n.data[2*A+1]=s.data[1]}else if(b==="mat2x3"||b==="mat2x3f"||b==="mat2x3h"){if(!(A<2&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*A]=s.data[0],n.data[3*A+1]=s.data[1],n.data[3*A+2]=s.data[2]}else if(b==="mat2x4"||b==="mat2x4f"||b==="mat2x4h"){if(!(A<2&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*A]=s.data[0],n.data[4*A+1]=s.data[1],n.data[4*A+2]=s.data[2],n.data[4*A+3]=s.data[3]}else if(b==="mat3x2"||b==="mat3x2f"||b==="mat3x2h"){if(!(A<3&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*A]=s.data[0],n.data[2*A+1]=s.data[1]}else if(b==="mat3x3"||b==="mat3x3f"||b==="mat3x3h"){if(!(A<3&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*A]=s.data[0],n.data[3*A+1]=s.data[1],n.data[3*A+2]=s.data[2]}else if(b==="mat3x4"||b==="mat3x4f"||b==="mat3x4h"){if(!(A<3&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*A]=s.data[0],n.data[4*A+1]=s.data[1],n.data[4*A+2]=s.data[2],n.data[4*A+3]=s.data[3]}else if(b==="mat4x2"||b==="mat4x2f"||b==="mat4x2h"){if(!(A<4&&s.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*A]=s.data[0],n.data[2*A+1]=s.data[1]}else if(b==="mat4x3"||b==="mat4x3f"||b==="mat4x3h"){if(!(A<4&&s.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*A]=s.data[0],n.data[3*A+1]=s.data[1],n.data[3*A+2]=s.data[2]}else{if(b!=="mat4x4"&&b!=="mat4x4f"&&b!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(A<4&&s.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*A]=s.data[0],n.data[4*A+1]=s.data[1],n.data[4*A+2]=s.data[2],n.data[4*A+3]=s.data[3]}}}}}else if(o instanceof hf){const h=o.value;if(!(n instanceof Ue))return void console.error(`Invalid assignment to ${h}. Variable ${i} is not a vector. Line ${e.line}`);if(s instanceof tt){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(h==="x")n.data[0]=s.value;else if(h==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);n.data[1]=s.value}else if(h==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);n.data[2]=s.value}else if(h==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);n.data[3]=s.value}}else{if(!(s instanceof Ue))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(h.length!==s.data.length)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);for(let A=0;A<h.length;++A){const b=h[A];if(b==="x"||b==="r")n.data[0]=s.data[A];else if(b==="y"||b==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${b} for variable ${i}. Line ${e.line}`);n.data[1]=s.data[A]}else if(b==="z"||b==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${b} for variable ${i}. Line ${e.line}`);n.data[2]=s.data[A]}else{if(b!=="w"&&b!=="a")return void console.error(`Invalid assignment to ${b} for variable ${i}. Line ${e.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${b} for variable ${i}. Line ${e.line}`);n.data[3]=s.data[A]}}}}}else n instanceof tt&&s instanceof tt?n.value=s.value:n instanceof Ue&&s instanceof Ue||n instanceof on&&s instanceof on?n.data.set(s.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const h=n.getSubData(this,o,r);if(h instanceof Ue&&s instanceof tt){const A=h.data,b=s.value;if(l==="+=")for(let C=0;C<A.length;++C)A[C]+=b;else if(l==="-=")for(let C=0;C<A.length;++C)A[C]-=b;else if(l==="*=")for(let C=0;C<A.length;++C)A[C]*=b;else if(l==="/=")for(let C=0;C<A.length;++C)A[C]/=b;else if(l==="%=")for(let C=0;C<A.length;++C)A[C]%=b;else if(l==="&=")for(let C=0;C<A.length;++C)A[C]&=b;else if(l==="|=")for(let C=0;C<A.length;++C)A[C]|=b;else if(l==="^=")for(let C=0;C<A.length;++C)A[C]^=b;else if(l==="<<=")for(let C=0;C<A.length;++C)A[C]<<=b;else if(l===">>=")for(let C=0;C<A.length;++C)A[C]>>=b;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(h instanceof Ue&&s instanceof Ue){const A=h.data,b=s.data;if(A.length!==b.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let C=0;C<A.length;++C)A[C]+=b[C];else if(l==="-=")for(let C=0;C<A.length;++C)A[C]-=b[C];else if(l==="*=")for(let C=0;C<A.length;++C)A[C]*=b[C];else if(l==="/=")for(let C=0;C<A.length;++C)A[C]/=b[C];else if(l==="%=")for(let C=0;C<A.length;++C)A[C]%=b[C];else if(l==="&=")for(let C=0;C<A.length;++C)A[C]&=b[C];else if(l==="|=")for(let C=0;C<A.length;++C)A[C]|=b[C];else if(l==="^=")for(let C=0;C<A.length;++C)A[C]^=b[C];else if(l==="<<=")for(let C=0;C<A.length;++C)A[C]<<=b[C];else if(l===">>=")for(let C=0;C<A.length;++C)A[C]>>=b[C];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(h instanceof tt&&s instanceof tt))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?h.value+=s.value:l==="-="?h.value-=s.value:l==="*="?h.value*=s.value:l==="/="?h.value/=s.value:l==="%="?h.value%=s.value:l==="&="?h.value&=s.value:l==="|="?h.value|=s.value:l==="^="?h.value^=s.value:l==="<<="?h.value<<=s.value:l===">>="?h.value>>=s.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}n instanceof Yi&&n.setDataValue(this,h,o,r)}}_function(e,r){const n=new Xw(e);r.functions.set(e.name,n)}_const(e,r){let n=null;e.value!==null&&(n=this.evalExpression(e.value,r)),r.createVariable(e.name,n,e)}_let(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof fs||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const o=new nc(e.type,[]);n=this._evalCreate(o,r)}}r.createVariable(e.name,n,e)}_var(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof fs||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof ag||e.type instanceof Jc||e.type instanceof ut){const o=new nc(e.type,[]);n=this._evalCreate(o,r)}}r.createVariable(e.name,n,e)}_switch(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof tt))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const o of e.cases)if(o instanceof fD)for(const s of o.selectors){if(s instanceof N0){i=o;continue}const l=this.evalExpression(s,r);if(!(l instanceof tt))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===n.value)return this._execStatements(o.body,r)}else o instanceof dD&&(i=o);return i?this._execStatements(i.body,r):null}_if(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof tt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,r);for(const i of e.elseif){const o=this.evalExpression(i.condition,r);if(!(o instanceof tt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(i.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof tt?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===mo._breakObj)break;if(n!==null&&n!==mo._continueObj)return n;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){const n=this._execStatements(e.body,r);if(n===mo._breakObj)break;if(n===mo._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===mo._breakObj)break}else if(n!==null)return n}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===mo._breakObj)break;if(n!==mo._continueObj&&n!==null)return n}return null}_evalBitcast(e,r){const n=this.evalExpression(e.value,r),i=e.type;if(n instanceof tt){const o=bT(n.value,n.typeInfo.name,i.name);return new tt(o,this.getTypeInfo(i))}if(n instanceof Ue){const o=n.typeInfo.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;s="f16"}const l=i.getTypeName();let h="";if(l.endsWith("f"))h="f32";else if(l.endsWith("i"))h="i32";else if(l.endsWith("u"))h="u32";else if(l.endsWith("b"))h="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const A=(function(b,C,S){if(C===S)return b;const D=new Array(b.length);for(let N=0;N<b.length;N++)D[N]=bT(b[N],C,S);return D})(Array.from(n.data),s,h);return new Ue(A,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var n;if(e instanceof nc){if(e.type===null)return w2.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}const i=e instanceof nc?e.type.name:e.name,o=e instanceof nc?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(o.size===0)return null;const s=new Yi(new ArrayBuffer(o.size),o,0);if(o instanceof Vu){if(e.args)for(let l=0;l<e.args.length;++l){const h=o.members[l],A=e.args[l],b=this.evalExpression(A,r);s.setData(this,b,h.type,h.offset,r)}}else if(o instanceof Qu){let l=0;if(e.args)for(let h=0;h<e.args.length;++h){const A=e.args[h],b=this.evalExpression(A,r);o.format===null&&(((n=b.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=b.typeInfo),s.setData(this,b,o.format,l,r),l+=o.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof nc?s.getSubData(this,e.postfix,r):s}_evalLiteral(e,r){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new tt(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){const n=r.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=mo._priority.get(r.name);mo._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){const n=this.evalExpression(e.right,r);if(e.operator==="&")return new Sd(n);if(e.operator==="*")return n instanceof Sd?n.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof tt?n.value:n instanceof Ue?Array.from(n.data):null;switch(e.operator){case"+":{if(pr(i)){const l=i.map((h,A)=>+h);return new Ue(l,n.typeInfo)}const o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new tt(+o,s)}case"-":{if(pr(i)){const l=i.map((h,A)=>-h);return new Ue(l,n.typeInfo)}const o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new tt(-o,s)}case"!":{if(pr(i)){const l=i.map((h,A)=>h?0:1);return new Ue(l,n.typeInfo)}const o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new tt(o?0:1,s)}case"~":{if(pr(i)){const l=i.map((h,A)=>~h);return new Ue(l,n.typeInfo)}const o=i,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new tt(~o,s)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){const n=this.evalExpression(e.left,r),i=this.evalExpression(e.right,r),o=n instanceof tt?n.value:n instanceof Ue||n instanceof on?Array.from(n.data):null,s=i instanceof tt?i.value:i instanceof Ue||i instanceof on?Array.from(i.data):null;switch(e.operator){case"+":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D+C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S+b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b+S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l+h,A)}case"-":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D-C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S-b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b-S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l-h,A)}case"*":{if(pr(o)&&pr(s)){const b=o,C=s;if(n instanceof on&&i instanceof on){const S=(function(V,j,ee,Q){if(Io[j.name]===void 0||Io[Q.name]===void 0)return null;const X=Io[j.name][0],pe=Io[j.name][1],Y=Io[Q.name][0];if(X!==Io[Q.name][1])return null;const Ge=new Array(Y*pe);for(let ze=0;ze<pe;ze++)for(let de=0;de<Y;de++){let ce=0;for(let De=0;De<X;De++)ce+=V[De*pe+ze]*ee[de*X+De];Ge[ze*Y+de]=ce}return Ge})(b,n.typeInfo,C,i.typeInfo);if(S===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const D=Io[i.typeInfo.name][0],N=Io[n.typeInfo.name][1],U=this.getTypeInfo(`mat${D}x${N}f`);return new on(S,U)}if(n instanceof on&&i instanceof Ue){const S=(function(D,N,U,V){if(Io[N.name]===void 0||rv[V.name]===void 0)return null;const j=Io[N.name][0],ee=Io[N.name][1];if(j!==U.length)return null;const Q=new Array(ee);for(let X=0;X<ee;X++){let pe=0;for(let Y=0;Y<j;Y++)pe+=D[Y*ee+X]*U[Y];Q[X]=pe}return Q})(b,n.typeInfo,C,i.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ue(S,i.typeInfo)}if(n instanceof Ue&&i instanceof on){const S=(function(D,N,U,V){if(rv[N.name]===void 0||Io[V.name]===void 0)return null;const j=Io[V.name][0],ee=Io[V.name][1];if(ee!==D.length)return null;const Q=[];for(let X=0;X<j;X++){let pe=0;for(let Y=0;Y<ee;Y++)pe+=D[Y]*U[Y*j+X];Q[X]=pe}return Q})(b,n.typeInfo,C,i.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ue(S,n.typeInfo)}{if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D*C[N]);return new Ue(S,n.typeInfo)}}if(pr(o)){const b=s,C=o.map((S,D)=>S*b);return n instanceof on?new on(C,n.typeInfo):new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b*S);return i instanceof on?new on(C,i.typeInfo):new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l*h,A)}case"%":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D%C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S%b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b%S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l%h,A)}case"/":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D/C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S/b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b/S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l/h,A)}case"&":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D&C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S&b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b&S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l&h,A)}case"|":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D|C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S|b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b|S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l|h,A)}case"^":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D^C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S^b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b^S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l^h,A)}case"<<":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D<<C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S<<b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b<<S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l<<h,A)}case">>":{if(pr(o)&&pr(s)){const b=o,C=s;if(b.length!==C.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=b.map((D,N)=>D>>C[N]);return new Ue(S,n.typeInfo)}if(pr(o)){const b=s,C=o.map((S,D)=>S>>b);return new Ue(C,n.typeInfo)}if(pr(s)){const b=o,C=s.map((S,D)=>b>>S);return new Ue(C,i.typeInfo)}const l=o,h=s,A=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new tt(l>>h,A)}case">":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b>h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A>l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l>A?1:0);return new Ue(h,i.typeInfo)}return new tt(o>s?1:0,this.getTypeInfo("bool"));case"<":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b<h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A<l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l<A?1:0);return new Ue(h,i.typeInfo)}return new tt(o<s?1:0,this.getTypeInfo("bool"));case"==":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b===h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A==l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l==A?1:0);return new Ue(h,i.typeInfo)}return new tt(o===s?1:0,this.getTypeInfo("bool"));case"!=":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b!==h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A!==l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l!==A?1:0);return new Ue(h,i.typeInfo)}return new tt(o!==s?1:0,this.getTypeInfo("bool"));case">=":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b>=h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A>=l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l>=A?1:0);return new Ue(h,i.typeInfo)}return new tt(o>=s?1:0,this.getTypeInfo("bool"));case"<=":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b<=h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A<=l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l<=A?1:0);return new Ue(h,i.typeInfo)}return new tt(o<=s?1:0,this.getTypeInfo("bool"));case"&&":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b&&h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A&&l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l&&A?1:0);return new Ue(h,i.typeInfo)}return new tt(o&&s?1:0,this.getTypeInfo("bool"));case"||":if(pr(o)&&pr(s)){const l=o,h=s;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=l.map((b,C)=>b||h[C]?1:0);return new Ue(A,n.typeInfo)}if(pr(o)){const l=s,h=o.map((A,b)=>A||l?1:0);return new Ue(h,n.typeInfo)}if(pr(s)){const l=o,h=s.map((A,b)=>l||A?1:0);return new Ue(h,i.typeInfo)}return new tt(o||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<i.node.args.length;++o){const s=i.node.args[o],l=this.evalExpression(e.args[o],n);n.createVariable(s.name,l,s)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothStep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}const n=r.getFunction(e.name);if(n){const i=r.clone();for(let o=0;o<n.node.args.length;++o){const s=n.node.args[o],l=this.evalExpression(e.args[o],i);i.setVariable(s.name,l,s)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new tt(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],r);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=rv[i];if(o===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const s=[];if(e instanceof xs)if(e.isVector){const l=e.vectorValue;for(const h of l)s.push(h)}else s.push(e.scalarValue);else if(e.args)for(const l of e.args){const h=this.evalExpression(l,r);if(h instanceof Ue){const A=h.data;for(let b=0;b<A.length;++b){let C=A[b];s.push(C)}}else if(h instanceof tt){let A=h.value;s.push(A)}}if(e.type instanceof ut&&e.type.format===null&&(e.type.format=ut.f32),s.length===0){const l=new Array(o).fill(0);return new Ue(l,n).getSubData(this,e.postfix,r)}if(s.length===1)for(;s.length<o;)s.push(s[0]);return s.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ue(s.length>o?s.slice(0,o):s,n).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=Io[i];if(o===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const s=[];if(e instanceof xs)if(e.isVector){const l=e.vectorValue;for(const h of l)s.push(h)}else s.push(e.scalarValue);else if(e.args)for(const l of e.args){const h=this.evalExpression(l,r);h instanceof Ue?s.push(...h.data):h instanceof tt?s.push(h.value):h instanceof on&&s.push(...h.data)}if(n instanceof uf&&n.format===null&&(n.format=this.getTypeInfo("f32")),s.length===0){const l=new Array(o[2]).fill(0);return new on(l,n).getSubData(this,e.postfix,r)}return s.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new on(s,n).getSubData(this,e.postfix,r)}}mo._breakObj=new Va(new ja("BREAK",null),null),mo._continueObj=new Va(new ja("CONTINUE",null),null),mo._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class yH{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class bH{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new yH,this._exec=new mo,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,o=n.countNode;if(o instanceof fa){const s=o.name,l=this._context.constants.get(s);if(l)try{const h=l.constEvaluate(this._exec);i.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of r)n.search(i=>{i instanceof _T||i instanceof tv?i.type=this._forwardType(i.type):i instanceof ag?i.format=this._forwardType(i.format):i instanceof Xc||i instanceof og||i instanceof k0?i.type=this._forwardType(i.type):i instanceof Cg?i.returnType=this._forwardType(i.returnType):i instanceof mT&&(i.type=this._forwardType(i.type))});return r}_forwardType(e){if(e instanceof gT){const r=this._getType(e.name);if(r)return r}else e instanceof tv?e.type=this._forwardType(e.type):e instanceof ag&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const r=new cH(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Re.eof}_match(e){if(e instanceof nt)return!!this._check(e)&&(this._advance(),!0);for(let r=0,n=e.length;r<n;++r){const i=e[r];if(this._check(i))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;let i=!1;for(const o of e){if(n===o)return!0;o===Re.tokens.name&&(i=!0)}if(i){const o=Re.tokens.name.rule.exec(r.lexeme);if(o&&o.index==0&&o[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===Re.tokens.name){const n=Re.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Re.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Re.keywords.alias)){const r=this._type_alias();return this._consume(Re.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Re.keywords.diagnostic)){const r=this._diagnostic();return this._consume(Re.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Re.keywords.requires)){const r=this._requires_directive();return this._consume(Re.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Re.keywords.enable)){const r=this._enable_directive();return this._consume(Re.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}const e=this._attribute();if(this._check(Re.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(Re.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Re.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(Re.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Re.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(Re.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Re.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(Re.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Re.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(Re.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(Re.keywords.fn))return null;const e=this._currentLine,r=this._consume(Re.tokens.ident,"Expected function name.").toString();this._consume(Re.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Re.tokens.paren_right))do{if(this._check(Re.tokens.paren_right))break;const l=this._attribute(),h=this._consume(Re.tokens.name,"Expected argument name.").toString();this._consume(Re.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=A,n.push(this._updateNode(new mT(h,b,l))))}while(this._match(Re.tokens.comma));this._consume(Re.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Re.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const o=this._compound_statement(),s=this._currentLine;return this._updateNode(new Cg(r,n,i,o,e,s),e)}_compound_statement(){const e=[];for(this._consume(Re.tokens.brace_left,"Expected '{' for block.");!this._check(Re.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(Re.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Re.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Re.tokens.attr)&&this._attribute(),this._check(Re.keywords.if))return this._if_statement();if(this._check(Re.keywords.switch))return this._switch_statement();if(this._check(Re.keywords.loop))return this._loop_statement();if(this._check(Re.keywords.for))return this._for_statement();if(this._check(Re.keywords.while))return this._while_statement();if(this._check(Re.keywords.continuing))return this._continuing_statement();if(this._check(Re.keywords.static_assert))return this._static_assert_statement();if(this._check(Re.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Re.keywords.return))e=this._return_statement();else if(this._check([Re.keywords.var,Re.keywords.let,Re.keywords.const]))e=this._variable_statement();else if(this._match(Re.keywords.discard))e=this._updateNode(new oH);else if(this._match(Re.keywords.break)){const r=this._updateNode(new oD);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r,this._check(Re.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(Re.keywords.continue)){const r=this._updateNode(new aD);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Re.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Re.keywords.static_assert))return null;const e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new nH(r),e)}_while_statement(){if(!this._match(Re.keywords.while))return null;const e=this._updateNode(new $O(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Re.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Re.keywords.continuing))return null;const r=this._currentLine,n=this._compound_statement();return this._updateNode(new x2(n,e),r)}_for_statement(){if(!this._match(Re.keywords.for))return null;this._consume(Re.tokens.paren_left,"Expected '('.");const e=this._updateNode(new qO(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Re.tokens.semicolon)?null:this._for_init(),this._consume(Re.tokens.semicolon,"Expected ';'."),e.condition=this._check(Re.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Re.tokens.semicolon,"Expected ';'."),e.increment=this._check(Re.tokens.paren_right)?null:this._for_increment(),this._consume(Re.tokens.paren_right,"Expected ')'."),this._check(Re.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Re.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(Re.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Xc(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(Re.keywords.let)){const e=this._currentLine,r=this._consume(Re.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Re.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(Re.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new og(r,n,null,null,i),e)}if(this._match(Re.keywords.const)){const e=this._currentLine,r=this._consume(Re.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Re.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(Re.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof xs&&(n=i.type),this._updateNode(new k0(r,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(Re.increment_operators))return this._current=e,null;const n=this._consume(Re.increment_operators,"Expected increment operator");return this._updateNode(new YO(n.type===Re.tokens.plus_plus?op.increment:op.decrement,r))}_assignment_statement(){let e=null;const r=this._currentLine;if(this._check(Re.tokens.brace_right))return null;let n=this._match(Re.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(Re.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new eD(XA.parse(i.lexeme),e,o),r)}_func_call_statement(){if(!this._check(Re.tokens.ident))return null;const e=this._currentLine,r=this._current,n=this._consume(Re.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new Vw(n.lexeme,i),e)}_loop_statement(){if(!this._match(Re.keywords.loop))return null;this._check(Re.tokens.attr)&&this._attribute(),this._consume(Re.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new tD([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.body.push(n);else e.body.push(r);if(r instanceof x2){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(Re.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Re.keywords.switch))return null;const e=this._updateNode(new rD(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Re.tokens.attr)&&this._attribute(),this._consume(Re.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Re.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let r=!1;for(;this._check([Re.keywords.default,Re.keywords.case]);){if(this._match(Re.keywords.case)){const n=this._case_selectors();for(const o of n)if(o instanceof N0){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(Re.tokens.colon),this._check(Re.tokens.attr)&&this._attribute(),this._consume(Re.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Re.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new fD(n,i)))}if(this._match(Re.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Re.tokens.colon),this._check(Re.tokens.attr)&&this._attribute(),this._consume(Re.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Re.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new dD(n)))}}return e}_case_selectors(){const e=[];for(this._match(Re.keywords.default)?e.push(this._updateNode(new N0)):e.push(this._shift_expression());this._match(Re.tokens.comma);)this._match(Re.keywords.default)?e.push(this._updateNode(new N0)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Re.keywords.fallthrough))return this._consume(Re.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(Re.keywords.if))return null;const e=this._currentLine,r=this._optional_paren_expression();this._check(Re.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Re.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let o=null;return this._match(Re.keywords.else)&&(this._check(Re.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new nD(r,n,i,o),e)}_match_elseif(){return this._tokens[this._current].type===Re.keywords.else&&this._tokens[this._current+1].type===Re.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new aH(r,n))),this._match_elseif()&&(this._check(Re.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Re.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new iD(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Re.tokens.or_or);)e=this._updateNode(new fl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Re.tokens.and_and);)e=this._updateNode(new fl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Re.tokens.or);)e=this._updateNode(new fl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Re.tokens.xor);)e=this._updateNode(new fl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Re.tokens.and);)e=this._updateNode(new fl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Re.tokens.equal_equal,Re.tokens.not_equal])?this._updateNode(new fl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Re.tokens.less_than,Re.tokens.greater_than,Re.tokens.less_than_equal,Re.tokens.greater_than_equal]);)e=this._updateNode(new fl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Re.tokens.shift_left,Re.tokens.shift_right]);)e=this._updateNode(new fl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Re.tokens.plus,Re.tokens.minus]);)e=this._updateNode(new fl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Re.tokens.star,Re.tokens.forward_slash,Re.tokens.modulo]);)e=this._updateNode(new fl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Re.tokens.minus,Re.tokens.bang,Re.tokens.tilde,Re.tokens.star,Re.tokens.and])?this._updateNode(new fs(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(Re.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Re.tokens.bracket_right,"Expected ']'.");const r=this._updateNode(new Rp(e)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(Re.tokens.period)){const e=this._consume(Re.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new hf(e.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Nt.void;case"bool":return Nt.bool;case"i32":return Nt.i32;case"u32":return Nt.u32;case"f32":return Nt.f32;case"f16":return Nt.f16;case"vec2f":return ut.vec2f;case"vec3f":return ut.vec3f;case"vec4f":return ut.vec4f;case"vec2i":return ut.vec2i;case"vec3i":return ut.vec3i;case"vec4i":return ut.vec4i;case"vec2u":return ut.vec2u;case"vec3u":return ut.vec3u;case"vec4u":return ut.vec4u;case"vec2h":return ut.vec2h;case"vec3h":return ut.vec3h;case"vec4h":return ut.vec4h;case"mat2x2f":return ut.mat2x2f;case"mat2x3f":return ut.mat2x3f;case"mat2x4f":return ut.mat2x4f;case"mat3x2f":return ut.mat3x2f;case"mat3x3f":return ut.mat3x3f;case"mat3x4f":return ut.mat3x4f;case"mat4x2f":return ut.mat4x2f;case"mat4x3f":return ut.mat4x3f;case"mat4x4f":return ut.mat4x4f;case"mat2x2h":return ut.mat2x2h;case"mat2x3h":return ut.mat2x3h;case"mat2x4h":return ut.mat2x4h;case"mat3x2h":return ut.mat3x2h;case"mat3x3h":return ut.mat3x3h;case"mat3x4h":return ut.mat3x4h;case"mat4x2h":return ut.mat4x2h;case"mat4x3h":return ut.mat4x3h;case"mat4x4h":return ut.mat4x4h;case"mat2x2i":return ut.mat2x2i;case"mat2x3i":return ut.mat2x3i;case"mat2x4i":return ut.mat2x4i;case"mat3x2i":return ut.mat3x2i;case"mat3x3i":return ut.mat3x3i;case"mat3x4i":return ut.mat3x4i;case"mat4x2i":return ut.mat4x2i;case"mat4x3i":return ut.mat4x3i;case"mat4x4i":return ut.mat4x4i;case"mat2x2u":return ut.mat2x2u;case"mat2x3u":return ut.mat2x3u;case"mat2x4u":return ut.mat2x4u;case"mat3x2u":return ut.mat3x2u;case"mat3x3u":return ut.mat3x3u;case"mat3x4u":return ut.mat3x4u;case"mat4x2u":return ut.mat4x2u;case"mat4x3u":return ut.mat4x3u;case"mat4x4u":return ut.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Re.tokens.ident)){const n=this._previous().toString();if(this._check(Re.tokens.paren_left)){const i=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new nc(o,i)):this._updateNode(new Jw(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new lD(n,i.value))}return this._updateNode(new fa(n))}if(this._match(Re.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Nt.i32:n.endsWith("u")||n.endsWith("U")?Nt.u32:Nt.x32;const o=parseInt(n);return this._validateTypeRange(o,i),this._updateNode(new xs(new tt(o,this._exec.getTypeInfo(i)),i))}if(this._match(Re.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Nt.u32),this._updateNode(new xs(new tt(n,this._exec.getTypeInfo(Nt.u32)),Nt.u32))}if(this._match([Re.tokens.decimal_float_literal,Re.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const o=parseFloat(n);this._validateTypeRange(o,i?Nt.f16:Nt.f32);const s=i?Nt.f16:Nt.f32;return this._updateNode(new xs(new tt(o,this._exec.getTypeInfo(s)),s))}if(this._match([Re.keywords.true,Re.keywords.false])){let n=this._previous().toString()===Re.keywords.true.rule;return this._updateNode(new xs(new tt(n?1:0,this._exec.getTypeInfo(Nt.bool)),Nt.bool))}if(this._check(Re.tokens.paren_left))return this._paren_expression();if(this._match(Re.keywords.bitcast)){this._consume(Re.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Re.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new cD(n,i))}const e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new nc(e,r))}_argument_expression_list(){if(!this._match(Re.tokens.paren_left))return null;const e=[];do{if(this._check(Re.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(Re.tokens.comma));return this._consume(Re.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Re.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Re.tokens.paren_right),e}_paren_expression(){this._consume(Re.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Re.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Re.keywords.struct))return null;const e=this._currentLine,r=this._consume(Re.tokens.ident,"Expected name for struct.").toString();this._consume(Re.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Re.tokens.brace_right);){const s=this._attribute(),l=this._consume(Re.tokens.name,"Expected variable name.").toString();this._consume(Re.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=h),this._check(Re.tokens.brace_right)?this._match(Re.tokens.comma):this._consume(Re.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new _T(l,A,s)))}this._consume(Re.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=this._updateNode(new Jc(r,n,e,i),e);return this._context.structs.set(r,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Re.tokens.equal)){const r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof xs){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof xs&&(e.type=e.value.type.name==="x32"?Nt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Re.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Re.keywords.const))return null;const r=this._consume(Re.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Re.tokens.colon)){const h=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=h)}let o=null;this._consume(Re.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let h=[Nt.f32],A=s.constEvaluate(this._exec,h);A instanceof tt&&this._validateTypeRange(A.value,h[0]),h[0]instanceof ut&&h[0].format===null&&A.typeInfo instanceof uf&&A.typeInfo.format!==null&&(A.typeInfo.format.name==="f16"?h[0].format=Nt.f16:A.typeInfo.format.name==="f32"?h[0].format=Nt.f32:A.typeInfo.format.name==="i32"?h[0].format=Nt.i32:A.typeInfo.format.name==="u32"?h[0].format=Nt.u32:A.typeInfo.format.name==="bool"?h[0].format=Nt.bool:console.error(`TODO: impelement template format type ${A.typeInfo.format.name}`)),o=this._updateNode(new xs(A,h[0])),this._exec.context.setVariable(r.toString(),A)}catch{o=s}if(i!==null&&o instanceof xs){if(o.type.name!=="x32"&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else i===null&&o instanceof xs&&(i=(e=o?.type)!==null&&e!==void 0?e:Nt.f32,i===Nt.x32&&(i=Nt.i32));const l=this._updateNode(new k0(r.toString(),i,"","",o),n);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(Re.keywords.let))return null;const e=this._currentLine,r=this._consume(Re.tokens.name,"Expected variable name");let n=null;if(this._match(Re.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;if(this._match(Re.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof xs){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof xs&&(n=i.type.name==="x32"?Nt.i32:i.type);return i instanceof xs&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new og(r.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Re.keywords.var))return null;const e=this._currentLine;let r="",n="";this._match(Re.tokens.less_than)&&(r=this._consume(Re.storage_class,"Expected storage_class.").toString(),this._match(Re.tokens.comma)&&(n=this._consume(Re.access_mode,"Expected access_mode.").toString()),this._consume(Re.tokens.greater_than,"Expected '>'."));const i=this._consume(Re.tokens.name,"Expected variable name");let o=null;if(this._match(Re.tokens.colon)){const s=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=s)}return this._updateNode(new Xc(i.toString(),o,r,n,null),e)}_override_decl(){if(!this._match(Re.keywords.override))return null;const e=this._consume(Re.tokens.name,"Expected variable name");let r=null;if(this._match(Re.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new Hw(e.toString(),r,null))}_diagnostic(){this._consume(Re.tokens.paren_left,"Expected '('");const e=this._consume(Re.tokens.ident,"Expected severity control name.");this._consume(Re.tokens.comma,"Expected ','");let r=this._consume(Re.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Re.tokens.period)&&(r+=`.${this._consume(Re.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Re.tokens.paren_right,"Expected ')'"),this._updateNode(new sD(e.toString(),r))}_enable_directive(){const e=this._consume(Re.tokens.ident,"identity expected.");return this._updateNode(new iH(e.toString()))}_requires_directive(){const e=[this._consume(Re.tokens.ident,"identity expected.").toString()];for(;this._match(Re.tokens.comma);){const r=this._consume(Re.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new sH(e))}_type_alias(){const e=this._consume(Re.tokens.ident,"identity expected.");this._consume(Re.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=this._updateNode(new Ww(e.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Re.tokens.ident,...Re.texel_format,Re.keywords.bool,Re.keywords.f32,Re.keywords.i32,Re.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new gT(n));return this._forwardTypeCount++,i}return this._updateNode(new Nt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Re.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(Re.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(Re.tokens.comma)&&(o=this._consume(Re.access_mode,"Expected access_mode for pointer").toString()),this._consume(Re.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ut(n,i,o))}if(this._match(Re.keywords.ptr)){let n=this._previous().toString();this._consume(Re.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(Re.storage_class,"Expected storage_class for pointer");this._consume(Re.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(Re.tokens.comma)&&(s=this._consume(Re.access_mode,"Expected access_mode for pointer").toString()),this._consume(Re.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new tv(n,i.toString(),o,s))}const r=this._attribute();if(this._match(Re.keywords.array)){let n=null,i=-1;const o=this._previous();let s=null;if(this._match(Re.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let h="";if(this._match(Re.tokens.comma)){s=this._shift_expression();try{h=s.constEvaluate(this._exec).toString(),s=null}catch{h="1"}}this._consume(Re.tokens.greater_than,"Expected '>' for array."),i=h?parseInt(h):0}const l=this._updateNode(new ag(o.toString(),r,n,i));return s&&this._deferArrayCountEval.push({arrayType:l,countNode:s}),l}return null}_texture_sampler_types(){if(this._match(Re.sampler_type))return this._updateNode(new QA(this._previous().toString(),null,null));if(this._match(Re.depth_texture_type))return this._updateNode(new QA(this._previous().toString(),null,null));if(this._match(Re.sampled_texture_type)||this._match(Re.multisampled_texture_type)){const e=this._previous();this._consume(Re.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(Re.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new QA(e.toString(),r,null))}if(this._match(Re.storage_texture_type)){const e=this._previous();this._consume(Re.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(Re.texel_format,"Invalid texel format.").toString();this._consume(Re.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Re.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Re.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new QA(e.toString(),r,n))}return null}_attribute(){let e=[];for(;this._match(Re.tokens.attr);){const r=this._consume(Re.attribute_name,"Expected attribute name"),n=this._updateNode(new pD(r.toString(),null));if(this._match(Re.tokens.paren_left)){if(n.value=this._consume(Re.literal_or_ident,"Expected attribute value").toString(),this._check(Re.tokens.comma)){this._advance();do{const i=this._consume(Re.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(Re.tokens.comma))}this._consume(Re.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class vH extends lc{constructor(e){super(),e&&this.update(e)}update(e){const r=new bH().parse(e);this.updateAST(r)}}function xH(t){const e={attributes:[],bindings:[]};let r;try{r=wH(t)}catch(o){return Yt.error(o.message)(),e}for(const o of r.uniforms){const s=[];for(const l of o.type?.members||[])s.push({name:l.name,type:vT(l.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:s})}for(const o of r.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of r.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const n=r.entry.vertex[0],i=n?.inputs.length||0;for(let o=0;o<i;o++){const s=n.inputs[o];if(s.locationType==="location"){const l=vT(s.type);e.attributes.push({name:s.name,location:Number(s.location),type:l})}}return e}function vT(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function wH(t){try{return new vH(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const CH=1/Math.PI*180,EH=1/180*Math.PI,BH={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...BH}};const Cs=globalThis.mathgl.config;function TH(t,{precision:e=Cs.precision}={}){return t=PH(t),`${parseFloat(t.toPrecision(e))}`}function Yu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function SH(t){return MH(t)}function IH(t){return ml(t)}function MH(t,e){return Zw(t,r=>r*EH,e)}function ml(t,e){return Zw(t,r=>r*CH,e)}function $c(t,e,r){return Zw(t,n=>Math.max(e,Math.min(r,n)))}function El(t,e,r){return Yu(t)?t.map((n,i)=>El(n,e[i],r)):r*e+(1-r)*t}function ma(t,e,r){const n=Cs.EPSILON;r&&(Cs.EPSILON=r);try{if(t===e)return!0;if(Yu(t)&&Yu(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!ma(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Cs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Cs.EPSILON=n}}function PH(t){return Math.round(t/Cs.EPSILON)*Cs.EPSILON}function LH(t){return t.clone?t.clone():new Array(t.length)}function Zw(t,e,r){if(Yu(t)){const n=t;r=r||LH(n);for(let i=0;i<r.length&&i<n.length;++i){const o=typeof t=="number"?t:t[i];r[i]=e(o,i,r)}return r}return e(t)}class $w extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Yu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Cs)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+TH(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!ma(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let i=0;i<this.ELEMENTS;++i){const o=e[i],s=typeof r=="number"?r:r[i];this[i]=o+n*(s-o)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(Cs.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function RH(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function $n(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function lg(t,e,r=""){if(Cs.debug&&!RH(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function yl(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class qw extends $w{get x(){return this[0]}set x(e){this[0]=$n(e)}get y(){return this[1]}set y(e){this[1]=$n(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];r+=i*i}return $n(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return $n(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return yl(e>=0&&e<this.ELEMENTS,"index is out of range"),$n(this[e])}setComponent(e,r){return yl(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const cg=1e-6;let Sl=typeof Float32Array<"u"?Float32Array:Array;function OH(){const t=new Sl(2);return Sl!=Float32Array&&(t[0]=0,t[1]=0),t}function xT(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function DH(t,e){return t[0]=-e[0],t[1]=-e[1],t}function AD(t,e,r,n){const i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}function FH(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function kH(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function gD(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function mD(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(function(){const t=OH();return function(e,r,n,i,o,s){let l,h;for(r||(r=2),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],o(t,t,s),e[l]=t[0],e[l+1]=t[1];return e}})();function _D(t,e,r){const n=e[0],i=e[1],o=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/o,t[1]=(r[1]*n+r[5]*i)/o,t}function yD(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[3]*n+r[7]*i+r[11]*o||1;return t[0]=(r[0]*n+r[4]*i+r[8]*o)/s,t[1]=(r[1]*n+r[5]*i+r[9]*o)/s,t[2]=(r[2]*n+r[6]*i+r[10]*o)/s,t}function NH(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function UH(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t[3]=e[3],t}function bD(t,e,r){const n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*o,t[1]=r[1]*n+r[4]*i+r[7]*o,t[2]=r[2]*n+r[5]*i+r[8]*o,t[3]=e[3],t}class nv extends qw{constructor(e=0,r=0){super(2),Yu(e)&&arguments.length===1?this.copy(e):(Cs.debug&&($n(e),$n(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Cs.debug&&($n(e.x),$n(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return mD(this,this,e),this.check()}transformAsVector(e){return _D(this,this,e),this.check()}transformByMatrix3(e){return gD(this,this,e),this.check()}transformByMatrix2x3(e){return kH(this,this,e),this.check()}transformByMatrix2(e){return FH(this,this,e),this.check()}}function vD(){const t=new Sl(3);return Sl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function xD(t){const e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function wT(t,e,r){const n=new Sl(3);return n[0]=t,n[1]=e,n[2]=r,n}function GH(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function zH(t){const e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function jH(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function HH(t,e){const r=e[0],n=e[1],i=e[2];let o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Yw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function U0(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[0],l=r[1],h=r[2];return t[0]=i*h-o*l,t[1]=o*s-n*h,t[2]=n*l-i*s,t}function VH(t,e,r,n){const i=e[0],o=e[1],s=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t}function eC(t,e,r){const n=e[0],i=e[1],o=e[2];let s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,t}function wD(t,e,r){const n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function CD(t,e,r){const n=r[0],i=r[1],o=r[2],s=r[3],l=e[0],h=e[1],A=e[2];let b=i*A-o*h,C=o*l-n*A,S=n*h-i*l,D=i*S-o*C,N=o*b-n*S,U=n*C-i*b;const V=s*2;return b*=V,C*=V,S*=V,D*=2,N*=2,U*=2,t[0]=l+b+D,t[1]=h+C+N,t[2]=A+S+U,t}function WH(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function JH(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function KH(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function XH(t,e){const r=t[0],n=t[1],i=t[2],o=e[0],s=e[1],l=e[2],h=Math.sqrt((r*r+n*n+i*i)*(o*o+s*s+l*l)),A=h&&Yw(t,e)/h;return Math.acos(Math.min(Math.max(A,-1),1))}const ED=GH,BD=xD,iv=zH;(function(){const t=vD();return function(e,r,n,i,o,s){let l,h;for(r||(r=3),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],o(t,t,s),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const sv=[0,0,0];let Wm;class ft extends qw{static get ZERO(){return Wm||(Wm=new ft(0,0,0),Object.freeze(Wm)),Wm}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Yu(e)?this.copy(e):(Cs.debug&&($n(e),$n(r),$n(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Cs.debug&&($n(e.x),$n(e.y),$n(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=$n(e)}angle(e){return XH(this,e)}cross(e){return U0(this,this,e),this.check()}rotateX({radians:e,origin:r=sv}){return WH(this,this,r,e),this.check()}rotateY({radians:e,origin:r=sv}){return JH(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=sv}){return KH(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return eC(this,this,e),this.check()}transformAsVector(e){return yD(this,this,e),this.check()}transformByMatrix3(e){return wD(this,this,e),this.check()}transformByMatrix2(e){return NH(this,this,e),this.check()}transformByQuaternion(e){return CD(this,this,e),this.check()}}let Jm;class tC extends qw{static get ZERO(){return Jm||(Jm=new tC(0,0,0,0),Object.freeze(Jm)),Jm}constructor(e=0,r=0,n=0,i=0){super(-0,-0,-0,-0),Yu(e)&&arguments.length===1?this.copy(e):(Cs.debug&&($n(e),$n(r),$n(n),$n(i)),this[0]=e,this[1]=r,this[2]=n,this[3]=i)}set(e,r,n,i){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Cs.debug&&($n(e.x),$n(e.y),$n(e.z),$n(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=$n(e)}get w(){return this[3]}set w(e){this[3]=$n(e)}transform(e){return eC(this,this,e),this.check()}transformByMatrix3(e){return bD(this,this,e),this.check()}transformByMatrix2(e){return UH(this,this,e),this.check()}transformByQuaternion(e){return CD(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class TD extends $w{toString(){let e="[";if(Cs.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=$n(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(e,r){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}}function QH(){const t=new Sl(9);return Sl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ZH(t,e){if(t===e){const r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function $H(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],A=e[7],b=e[8],C=b*s-l*A,S=-b*o+l*h,D=A*o-s*h;let N=r*C+n*S+i*D;return N?(N=1/N,t[0]=C*N,t[1]=(-b*n+i*A)*N,t[2]=(l*n-i*s)*N,t[3]=S*N,t[4]=(b*r-i*h)*N,t[5]=(-l*r+i*o)*N,t[6]=D*N,t[7]=(-A*r+n*h)*N,t[8]=(s*r-n*o)*N,t):null}function qH(t){const e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],l=t[6],h=t[7],A=t[8];return e*(A*o-s*h)+r*(-A*i+s*l)+n*(h*i-o*l)}function CT(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],l=e[4],h=e[5],A=e[6],b=e[7],C=e[8],S=r[0],D=r[1],N=r[2],U=r[3],V=r[4],j=r[5],ee=r[6],Q=r[7],X=r[8];return t[0]=S*n+D*s+N*A,t[1]=S*i+D*l+N*b,t[2]=S*o+D*h+N*C,t[3]=U*n+V*s+j*A,t[4]=U*i+V*l+j*b,t[5]=U*o+V*h+j*C,t[6]=ee*n+Q*s+X*A,t[7]=ee*i+Q*l+X*b,t[8]=ee*o+Q*h+X*C,t}function YH(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],l=e[4],h=e[5],A=e[6],b=e[7],C=e[8],S=r[0],D=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=s,t[4]=l,t[5]=h,t[6]=S*n+D*s+A,t[7]=S*i+D*l+b,t[8]=S*o+D*h+C,t}function eV(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],l=e[4],h=e[5],A=e[6],b=e[7],C=e[8],S=Math.sin(r),D=Math.cos(r);return t[0]=D*n+S*s,t[1]=D*i+S*l,t[2]=D*o+S*h,t[3]=D*s-S*n,t[4]=D*l-S*i,t[5]=D*h-S*o,t[6]=A,t[7]=b,t[8]=C,t}function ET(t,e,r){const n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function tV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,l=n+n,h=i+i,A=r*s,b=n*s,C=n*l,S=i*s,D=i*l,N=i*h,U=o*s,V=o*l,j=o*h;return t[0]=1-C-N,t[3]=b-j,t[6]=S+V,t[1]=b+j,t[4]=1-A-N,t[7]=D-U,t[2]=S-V,t[5]=D+U,t[8]=1-A-C,t}var C2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(C2||(C2={}));const rV=Object.freeze([1,0,0,0,1,0,0,0,1]);class gi extends TD{static get IDENTITY(){return iV()}static get ZERO(){return nV()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return C2}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(rV)}fromObject(e){return this.check()}fromQuaternion(e){return tV(this,e),this.check()}set(e,r,n,i,o,s,l,h,A){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=l,this[7]=h,this[8]=A,this.check()}setRowMajor(e,r,n,i,o,s,l,h,A){return this[0]=e,this[1]=i,this[2]=l,this[3]=r,this[4]=o,this[5]=h,this[6]=n,this[7]=s,this[8]=A,this.check()}determinant(){return qH(this)}transpose(){return ZH(this,this),this.check()}invert(){return $H(this,this),this.check()}multiplyLeft(e){return CT(this,e,this),this.check()}multiplyRight(e){return CT(this,this,e),this.check()}rotate(e){return eV(this,this,e),this.check()}scale(e){return Array.isArray(e)?ET(this,this,e):ET(this,this,[e,e]),this.check()}translate(e){return YH(this,this,e),this.check()}transform(e,r){let n;switch(e.length){case 2:n=gD(r||[-0,-0],e,this);break;case 3:n=wD(r||[-0,-0,-0],e,this);break;case 4:n=bD(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lg(n,e.length),n}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}}let Km,Xm=null;function nV(){return Km||(Km=new gi([0,0,0,0,0,0,0,0,0]),Object.freeze(Km)),Km}function iV(){return Xm||(Xm=new gi,Object.freeze(Xm)),Xm}function sV(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oV(t,e){if(t===e){const r=e[1],n=e[2],i=e[3],o=e[6],s=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function E2(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],A=e[7],b=e[8],C=e[9],S=e[10],D=e[11],N=e[12],U=e[13],V=e[14],j=e[15],ee=r*l-n*s,Q=r*h-i*s,X=r*A-o*s,pe=n*h-i*l,Y=n*A-o*l,Ge=i*A-o*h,ze=b*U-C*N,de=b*V-S*N,ce=b*j-D*N,De=C*V-S*U,J=C*j-D*U,ue=S*j-D*V;let Ee=ee*ue-Q*J+X*De+pe*ce-Y*de+Ge*ze;return Ee?(Ee=1/Ee,t[0]=(l*ue-h*J+A*De)*Ee,t[1]=(i*J-n*ue-o*De)*Ee,t[2]=(U*Ge-V*Y+j*pe)*Ee,t[3]=(S*Y-C*Ge-D*pe)*Ee,t[4]=(h*ce-s*ue-A*de)*Ee,t[5]=(r*ue-i*ce+o*de)*Ee,t[6]=(V*X-N*Ge-j*Q)*Ee,t[7]=(b*Ge-S*X+D*Q)*Ee,t[8]=(s*J-l*ce+A*ze)*Ee,t[9]=(n*ce-r*J-o*ze)*Ee,t[10]=(N*Y-U*X+j*ee)*Ee,t[11]=(C*X-b*Y-D*ee)*Ee,t[12]=(l*de-s*De-h*ze)*Ee,t[13]=(r*De-n*de+i*ze)*Ee,t[14]=(U*Q-N*pe-V*ee)*Ee,t[15]=(b*pe-C*Q+S*ee)*Ee,t):null}function aV(t){const e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],l=t[6],h=t[7],A=t[8],b=t[9],C=t[10],S=t[11],D=t[12],N=t[13],U=t[14],V=t[15],j=e*s-r*o,ee=e*l-n*o,Q=r*l-n*s,X=A*N-b*D,pe=A*U-C*D,Y=b*U-C*N,Ge=e*Y-r*pe+n*X,ze=o*Y-s*pe+l*X,de=A*Q-b*ee+C*j,ce=D*Q-N*ee+U*j;return h*Ge-i*ze+V*de-S*ce}function nf(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],l=e[4],h=e[5],A=e[6],b=e[7],C=e[8],S=e[9],D=e[10],N=e[11],U=e[12],V=e[13],j=e[14],ee=e[15];let Q=r[0],X=r[1],pe=r[2],Y=r[3];return t[0]=Q*n+X*l+pe*C+Y*U,t[1]=Q*i+X*h+pe*S+Y*V,t[2]=Q*o+X*A+pe*D+Y*j,t[3]=Q*s+X*b+pe*N+Y*ee,Q=r[4],X=r[5],pe=r[6],Y=r[7],t[4]=Q*n+X*l+pe*C+Y*U,t[5]=Q*i+X*h+pe*S+Y*V,t[6]=Q*o+X*A+pe*D+Y*j,t[7]=Q*s+X*b+pe*N+Y*ee,Q=r[8],X=r[9],pe=r[10],Y=r[11],t[8]=Q*n+X*l+pe*C+Y*U,t[9]=Q*i+X*h+pe*S+Y*V,t[10]=Q*o+X*A+pe*D+Y*j,t[11]=Q*s+X*b+pe*N+Y*ee,Q=r[12],X=r[13],pe=r[14],Y=r[15],t[12]=Q*n+X*l+pe*C+Y*U,t[13]=Q*i+X*h+pe*S+Y*V,t[14]=Q*o+X*A+pe*D+Y*j,t[15]=Q*s+X*b+pe*N+Y*ee,t}function x_(t,e,r){const n=r[0],i=r[1],o=r[2];let s,l,h,A,b,C,S,D,N,U,V,j;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],l=e[1],h=e[2],A=e[3],b=e[4],C=e[5],S=e[6],D=e[7],N=e[8],U=e[9],V=e[10],j=e[11],t[0]=s,t[1]=l,t[2]=h,t[3]=A,t[4]=b,t[5]=C,t[6]=S,t[7]=D,t[8]=N,t[9]=U,t[10]=V,t[11]=j,t[12]=s*n+b*i+N*o+e[12],t[13]=l*n+C*i+U*o+e[13],t[14]=h*n+S*i+V*o+e[14],t[15]=A*n+D*i+j*o+e[15]),t}function rC(t,e,r){const n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lV(t,e,r,n){let i=n[0],o=n[1],s=n[2],l=Math.sqrt(i*i+o*o+s*s),h,A,b,C,S,D,N,U,V,j,ee,Q,X,pe,Y,Ge,ze,de,ce,De,J,ue,Ee,ct;return l<cg?null:(l=1/l,i*=l,o*=l,s*=l,A=Math.sin(r),h=Math.cos(r),b=1-h,C=e[0],S=e[1],D=e[2],N=e[3],U=e[4],V=e[5],j=e[6],ee=e[7],Q=e[8],X=e[9],pe=e[10],Y=e[11],Ge=i*i*b+h,ze=o*i*b+s*A,de=s*i*b-o*A,ce=i*o*b-s*A,De=o*o*b+h,J=s*o*b+i*A,ue=i*s*b+o*A,Ee=o*s*b-i*A,ct=s*s*b+h,t[0]=C*Ge+U*ze+Q*de,t[1]=S*Ge+V*ze+X*de,t[2]=D*Ge+j*ze+pe*de,t[3]=N*Ge+ee*ze+Y*de,t[4]=C*ce+U*De+Q*J,t[5]=S*ce+V*De+X*J,t[6]=D*ce+j*De+pe*J,t[7]=N*ce+ee*De+Y*J,t[8]=C*ue+U*Ee+Q*ct,t[9]=S*ue+V*Ee+X*ct,t[10]=D*ue+j*Ee+pe*ct,t[11]=N*ue+ee*Ee+Y*ct,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function SD(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],l=e[6],h=e[7],A=e[8],b=e[9],C=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+A*n,t[5]=s*i+b*n,t[6]=l*i+C*n,t[7]=h*i+S*n,t[8]=A*i-o*n,t[9]=b*i-s*n,t[10]=C*i-l*n,t[11]=S*i-h*n,t}function cV(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],l=e[2],h=e[3],A=e[8],b=e[9],C=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-A*n,t[1]=s*i-b*n,t[2]=l*i-C*n,t[3]=h*i-S*n,t[8]=o*n+A*i,t[9]=s*n+b*i,t[10]=l*n+C*i,t[11]=h*n+S*i,t}function ID(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],l=e[2],h=e[3],A=e[4],b=e[5],C=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+A*n,t[1]=s*i+b*n,t[2]=l*i+C*n,t[3]=h*i+S*n,t[4]=A*i-o*n,t[5]=b*i-s*n,t[6]=C*i-l*n,t[7]=S*i-h*n,t}function uV(t,e){const r=e[0],n=e[1],i=e[2],o=e[4],s=e[5],l=e[6],h=e[8],A=e[9],b=e[10];return t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+s*s+l*l),t[2]=Math.sqrt(h*h+A*A+b*b),t}function hV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,l=n+n,h=i+i,A=r*s,b=n*s,C=n*l,S=i*s,D=i*l,N=i*h,U=o*s,V=o*l,j=o*h;return t[0]=1-C-N,t[1]=b+j,t[2]=S-V,t[3]=0,t[4]=b-j,t[5]=1-A-N,t[6]=D+U,t[7]=0,t[8]=S+V,t[9]=D-U,t[10]=1-A-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fV(t,e,r,n,i,o,s){const l=1/(r-e),h=1/(i-n),A=1/(o-s);return t[0]=o*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*l,t[9]=(i+n)*h,t[10]=(s+o)*A,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*A,t[15]=0,t}function dV(t,e,r,n,i){const o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const s=1/(n-i);t[10]=(i+n)*s,t[14]=2*i*n*s}else t[10]=-1,t[14]=-2*n;return t}const pV=dV;function AV(t,e,r,n,i,o,s){const l=1/(e-r),h=1/(n-i),A=1/(o-s);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*A,t[11]=0,t[12]=(e+r)*l,t[13]=(i+n)*h,t[14]=(s+o)*A,t[15]=1,t}const gV=AV;function mV(t,e,r,n){let i,o,s,l,h,A,b,C,S,D;const N=e[0],U=e[1],V=e[2],j=n[0],ee=n[1],Q=n[2],X=r[0],pe=r[1],Y=r[2];return Math.abs(N-X)<cg&&Math.abs(U-pe)<cg&&Math.abs(V-Y)<cg?sV(t):(C=N-X,S=U-pe,D=V-Y,i=1/Math.sqrt(C*C+S*S+D*D),C*=i,S*=i,D*=i,o=ee*D-Q*S,s=Q*C-j*D,l=j*S-ee*C,i=Math.sqrt(o*o+s*s+l*l),i?(i=1/i,o*=i,s*=i,l*=i):(o=0,s=0,l=0),h=S*l-D*s,A=D*o-C*l,b=C*s-S*o,i=Math.sqrt(h*h+A*A+b*b),i?(i=1/i,h*=i,A*=i,b*=i):(h=0,A=0,b=0),t[0]=o,t[1]=h,t[2]=C,t[3]=0,t[4]=s,t[5]=A,t[6]=S,t[7]=0,t[8]=l,t[9]=b,t[10]=D,t[11]=0,t[12]=-(o*N+s*U+l*V),t[13]=-(h*N+A*U+b*V),t[14]=-(C*N+S*U+D*V),t[15]=1,t)}function _V(){const t=new Sl(4);return Sl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function yV(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function nC(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function bV(t){const e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}function vV(t){const e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function xV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3];let s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=o*s,t}function wV(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function CV(t,e,r,n){const i=e[0],o=e[1],s=e[2],l=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t[3]=l+n*(r[3]-l),t}function qp(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t}function EV(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[0],l=r[1],h=r[2],A=r[3],b=A*n+l*o-h*i,C=A*i+h*n-s*o,S=A*o+s*i-l*n,D=-s*n-l*i-h*o;return t[0]=b*A+D*-s+C*-h-S*-l,t[1]=C*A+D*-l+S*-s-b*-h,t[2]=S*A+D*-h+b*-l-C*-s,t[3]=e[3],t}(function(){const t=_V();return function(e,r,n,i,o,s){let l,h;for(r||(r=4),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],o(t,t,s),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var B2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(B2||(B2={}));const BV=45*Math.PI/180,TV=1,ov=.1,av=500,SV=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class bn extends TD{static get IDENTITY(){return MV()}static get ZERO(){return IV()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return B2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,i,o,s,l,h,A,b,C,S,D,N,U,V){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=l,this[7]=h,this[8]=A,this[9]=b,this[10]=C,this[11]=S,this[12]=D,this[13]=N,this[14]=U,this[15]=V,this.check()}setRowMajor(e,r,n,i,o,s,l,h,A,b,C,S,D,N,U,V){return this[0]=e,this[1]=o,this[2]=A,this[3]=D,this[4]=r,this[5]=s,this[6]=b,this[7]=N,this[8]=n,this[9]=l,this[10]=C,this[11]=U,this[12]=i,this[13]=h,this[14]=S,this[15]=V,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(SV)}fromObject(e){return this.check()}fromQuaternion(e){return hV(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:i,top:o,near:s=ov,far:l=av}=e;return l===1/0?PV(this,r,n,i,o,s):fV(this,r,n,i,o,s,l),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=e;return mV(this,r,n,i),this.check()}ortho(e){const{left:r,right:n,bottom:i,top:o,near:s=ov,far:l=av}=e;return gV(this,r,n,i,o,s,l),this.check()}orthographic(e){const{fovy:r=BV,aspect:n=TV,focalDistance:i=1,near:o=ov,far:s=av}=e;BT(r);const l=r/2,h=i*Math.tan(l),A=h*n;return this.ortho({left:-A,right:A,bottom:-h,top:h,near:o,far:s})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=e;return BT(r),pV(this,r,n,i,o),this.check()}determinant(){return aV(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*s,e}transpose(){return oV(this,this),this.check()}invert(){return E2(this,this),this.check()}multiplyLeft(e){return nf(this,e,this),this.check()}multiplyRight(e){return nf(this,this,e),this.check()}rotateX(e){return SD(this,this,e),this.check()}rotateY(e){return cV(this,this,e),this.check()}rotateZ(e){return ID(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return lV(this,this,e,r),this.check()}scale(e){return rC(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return x_(this,this,e),this.check()}transform(e,r){return e.length===4?(r=qp(r||[-0,-0,-0,-0],e,this),lg(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let i;switch(n){case 2:i=mD(r||[-0,-0],e,this);break;case 3:i=eC(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lg(i,e.length),i}transformAsVector(e,r){let n;switch(e.length){case 2:n=_D(r||[-0,-0],e,this);break;case 3:n=yD(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lg(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let Qm,Zm;function IV(){return Qm||(Qm=new bn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Qm)),Qm}function MV(){return Zm||(Zm=new bn,Object.freeze(Zm)),Zm}function BT(t){if(t>Math.PI*2)throw Error("expected radians")}function PV(t,e,r,n,i,o){const s=2*o/(r-e),l=2*o/(i-n),h=(r+e)/(r-e),A=(i+n)/(i-n),b=-1,C=-1,S=-2*o;return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=h,t[9]=A,t[10]=b,t[11]=C,t[12]=0,t[13]=0,t[14]=S,t[15]=0,t}function TT(){const t=new Sl(4);return Sl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function LV(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function MD(t,e,r){r=r*.5;const n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function ST(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],l=r[0],h=r[1],A=r[2],b=r[3];return t[0]=n*b+s*l+i*A-o*h,t[1]=i*b+s*h+o*l-n*A,t[2]=o*b+s*A+n*h-i*l,t[3]=s*b-n*l-i*h-o*A,t}function RV(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],l=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*l,t[1]=i*h+o*l,t[2]=o*h-i*l,t[3]=s*h-n*l,t}function OV(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],l=Math.sin(r),h=Math.cos(r);return t[0]=n*h-o*l,t[1]=i*h+s*l,t[2]=o*h+n*l,t[3]=s*h-i*l,t}function DV(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],l=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*l,t[1]=i*h-n*l,t[2]=o*h+s*l,t[3]=s*h-o*l,t}function FV(t,e){const r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function G0(t,e,r,n){const i=e[0],o=e[1],s=e[2],l=e[3];let h=r[0],A=r[1],b=r[2],C=r[3],S,D,N,U,V;return S=i*h+o*A+s*b+l*C,S<0&&(S=-S,h=-h,A=-A,b=-b,C=-C),1-S>cg?(D=Math.acos(S),V=Math.sin(D),N=Math.sin((1-n)*D)/V,U=Math.sin(n*D)/V):(N=1-n,U=n),t[0]=N*i+U*h,t[1]=N*o+U*A,t[2]=N*s+U*b,t[3]=N*l+U*C,t}function kV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r*r+n*n+i*i+o*o,l=s?1/s:0;return t[0]=-r*l,t[1]=-n*l,t[2]=-i*l,t[3]=o*l,t}function NV(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function PD(t,e){const r=e[0]+e[4]+e[8];let n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[s*3+s]+1),t[i]=.5*n,n=.5/n,t[3]=(e[o*3+s]-e[s*3+o])*n,t[o]=(e[o*3+i]+e[i*3+o])*n,t[s]=(e[s*3+i]+e[i*3+s])*n}return t}const UV=yV,GV=nC,zV=wV,jV=CV,HV=bV,VV=vV,LD=xV,WV=(function(){const t=vD(),e=wT(1,0,0),r=wT(0,1,0);return function(n,i,o){const s=Yw(i,o);return s<-.999999?(U0(t,e,i),BD(t)<1e-6&&U0(t,r,i),HH(t,t),MD(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(U0(t,i,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,LD(n,n))}})();(function(){const t=TT(),e=TT();return function(r,n,i,o,s,l){return G0(t,n,s,l),G0(e,i,o,l),G0(r,t,e,2*l*(1-l)),r}})(),(function(){const t=QH();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],LD(e,PD(e,t))}})();const JV=[0,0,0,1];class Eg extends $w{constructor(e=0,r=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,n,i){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return PD(this,e),this.check()}fromAxisRotation(e,r){return MD(this,e,r),this.check()}identity(){return LV(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=$n(e)}get y(){return this[1]}set y(e){this[1]=$n(e)}get z(){return this[2]}set z(e){this[2]=$n(e)}get w(){return this[3]}set w(e){this[3]=$n(e)}len(){return HV(this)}lengthSquared(){return VV(this)}dot(e){return zV(this,e)}rotationTo(e,r){return WV(this,e,r),this.check()}add(e){return UV(this,this,e),this.check()}calculateW(){return FV(this,this),this.check()}conjugate(){return NV(this,this),this.check()}invert(){return kV(this,this),this.check()}lerp(e,r,n){return n===void 0?this.lerp(this,e,r):(jV(this,e,r,n),this.check())}multiplyRight(e){return ST(this,this,e),this.check()}multiplyLeft(e){return ST(this,e,this),this.check()}normalize(){const e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return RV(this,this,e),this.check()}rotateY(e){return OV(this,this,e),this.check()}rotateZ(e){return DV(this,this,e),this.check()}scale(e){return GV(this,this,e),this.check()}slerp(e,r,n){let i,o,s;switch(arguments.length){case 1:({start:i=JV,target:o,ratio:s}=e);break;case 2:i=this,o=e,s=r;break;default:i=e,o=r,s=n}return G0(this,i,o,s),this.check()}transformVector4(e,r=new tC){return EV(r,e,this),lg(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const KV=.1,XV=1e-12,RD=1e-15,QV=1e-20;function OD(t,e=[],r=0){const n=Math.fround(t),i=t-n;return e[r]=n,e[r+1]=i,e}function ZV(t){return t-Math.fround(t)}function $V(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const i=r*4+n;OD(t[n*4+r],e,i*2)}return e}const qV=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,YV={name:"fp32",vs:qV},eW=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,tW={ONE:1},rW={name:"fp64arithmetic",vs:eW,defaultUniforms:tW,uniformTypes:{ONE:"f32"},fp64ify:OD,fp64LowPart:ZV,fp64ifyMatrix4:$V},nW=[0,1,1,1],iW=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,sW=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,IT={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:nW},vs:iW,fs:sW,getUniforms:oW};function oW(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const MT=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,aW=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,DD=3,lW=255;var Bg;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(Bg||(Bg={}));const yp={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:DD},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Bg.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:aW,vs:MT,fs:MT,getUniforms:cW};function cW(t,e={}){if(t=t&&{...t},!t)return{...yp.defaultUniforms};t.lights&&(t={...t,...hW(t.lights),lights:void 0});const{ambientLight:r,pointLights:n,directionalLights:i}=t||{};if(!(r||n&&n.length>0||i&&i.length>0))return{...yp.defaultUniforms,enabled:0};const o={...yp.defaultUniforms,...e,...uW({ambientLight:r,pointLights:n,directionalLights:i})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function uW({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const n={};n.ambientLightColor=lv(t);let i=0;for(const o of e){n.lightType=Bg.POINT;const s=i;n[`lightColor${s}`]=lv(o),n[`lightPosition${s}`]=o.position,n[`lightAttenuation${s}`]=o.attenuation||[1,0,0],i++}for(const o of r){n.lightType=Bg.DIRECTIONAL;const s=i;n[`lightColor${s}`]=lv(o),n[`lightDirection${s}`]=o.direction,i++}return i>DD&&Yt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=e.length,n}function hW(t){const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return e}function lv(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(n=>n*r/lW)}const FD=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,kD=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,ND=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,By={props:{},name:"gouraudMaterial",vs:kD.replace("phongMaterial","gouraudMaterial"),fs:FD.replace("phongMaterial","gouraudMaterial"),source:ND.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[yp],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...By.defaultUniforms,...e}}},iC={name:"phongMaterial",dependencies:[yp],source:ND,vs:FD,fs:kD,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...iC.defaultUniforms,...e}}},fW=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,dW=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,PT=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,pW={name:"pbrProjection",vs:PT,fs:PT,getUniforms:t=>t,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},sC={props:{},uniforms:{},name:"pbrMaterial",dependencies:[yp,pW],vs:fW,fs:dW,defines:{LIGHTING_FRAGMENT:1},getUniforms:t=>t,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},LT=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,AW={name:"layer",vs:LT,fs:LT,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},gW=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,UD="#define SMOOTH_EDGE_RADIUS 0.5",mW=`${UD}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,_W=`${UD}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,GD={name:"geometry",source:gW,vs:mW,fs:_W},yW=25;var ps;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(ps||(ps={}));var ws;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ws||(ws={}));var yn;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(yn||(yn={}));const bW="compute",vW="auto",T2="manipulation",z0="none",S2="pan-x",I2="pan-y";function xW(t){if(t.includes(z0))return z0;const e=t.includes(S2),r=t.includes(I2);return e&&r?z0:e||r?e?S2:I2:t.includes(T2)?T2:vW}class wW{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===bW&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return xW(e.join(" "))}}function w_(t){return t.trim().split(/\s+/g)}function cv(t,e,r){if(t)for(const n of w_(e))t.addEventListener(n,r,!1)}function uv(t,e,r){if(t)for(const n of w_(e))t.removeEventListener(n,r,!1)}function RT(t){return(t.ownerDocument||t).defaultView}function CW(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function zD(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,i=0;for(;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:Math.round(r/e),y:Math.round(n/e)}}function OT(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:zD(e),deltaX:t.deltaX,deltaY:t.deltaY}}function jD(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function DT(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function EW(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function FT(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function HD(t,e){return t===e?ws.None:Math.abs(t)>=Math.abs(e)?t<0?ws.Left:ws.Right:e<0?ws.Up:ws.Down}function BW(t,e){const r=e.center;let n=t.offsetDelta,i=t.prevDelta;const o=t.prevInput;return(e.eventType===ps.Start||o?.eventType===ps.End)&&(i=t.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function VD(t,e,r){return{x:e/t||0,y:r/t||0}}function TW(t,e){return DT(e[0],e[1])/DT(t[0],t[1])}function SW(t,e){return FT(e[1],e[0])-FT(t[1],t[0])}function IW(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let i,o,s,l;if(e.eventType!==ps.Cancel&&(n>yW||r.velocity===void 0)){const h=e.deltaX-r.deltaX,A=e.deltaY-r.deltaY,b=VD(n,h,A);o=b.x,s=b.y,i=Math.abs(b.x)>Math.abs(b.y)?b.x:b.y,l=HD(h,A),t.lastInterval=e}else i=r.velocity,o=r.velocityX,s=r.velocityY,l=r.direction;e.velocity=i,e.velocityX=o,e.velocityY=s,e.direction=l}function MW(t,e){const{session:r}=t,{pointers:n}=e,{length:i}=n;r.firstInput||(r.firstInput=OT(e)),i>1&&!r.firstMultiple?r.firstMultiple=OT(e):i===1&&(r.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=r,l=s?s.center:o.center,h=e.center=zD(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=EW(l,h),e.distance=jD(l,h);const{deltaX:A,deltaY:b}=BW(r,e);e.deltaX=A,e.deltaY=b,e.offsetDirection=HD(e.deltaX,e.deltaY);const C=VD(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=C.x,e.overallVelocityY=C.y,e.overallVelocity=Math.abs(C.x)>Math.abs(C.y)?C.x:C.y,e.scale=s?TW(s.pointers,n):1,e.rotation=s?SW(s.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let S=t.element;return CW(e.srcEvent.target,S)&&(S=e.srcEvent.target),e.target=S,IW(r,e),e}function PW(t,e,r){const n=r.pointers.length,i=r.changedPointers.length,o=e&ps.Start&&n-i===0,s=e&(ps.End|ps.Cancel)&&n-i===0;r.isFirst=!!o,r.isFinal=!!s,o&&(t.session={}),r.eventType=e;const l=MW(t,r);t.emit("hammer.input",l),t.recognize(l),t.session.prevInput=l}let LW=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,e){PW(this.manager,t,e)}init(){cv(this.element,this.evEl,this.domHandler),cv(this.target,this.evTarget,this.domHandler),cv(RT(this.element),this.evWin,this.domHandler)}destroy(){uv(this.element,this.evEl,this.domHandler),uv(this.target,this.evTarget,this.domHandler),uv(RT(this.element),this.evWin,this.domHandler)}};const RW={pointerdown:ps.Start,pointermove:ps.Move,pointerup:ps.End,pointercancel:ps.Cancel,pointerout:ps.Cancel},OW="pointerdown",DW="pointermove pointerup pointercancel";class FW extends LW{constructor(e){super(e),this.evEl=OW,this.evWin=DW,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const i=RW[e.type],o=e.pointerType,s=o==="touch";let l=r.findIndex(h=>h.pointerId===e.pointerId);i&ps.Start&&(e.buttons||s)?l<0&&(r.push(e),l=r.length-1):i&(ps.End|ps.Cancel)&&(n=!0),!(l<0)&&(r[l]=e,this.callback(i,{pointers:r,changedPointers:[e],eventType:i,pointerType:o,srcEvent:e}),n&&r.splice(l,1))}}const kW=["","webkit","Moz","MS","ms","o"];function NW(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of kW){const i=n?n+r:e;if(i in t)return i}}const UW=1,kT=2,NT={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let GW=class{constructor(t,e){this.options={...NT,...e,cssProps:{...NT.cssProps,...e.cssProps},inputTarget:e.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new FW(this),this.touchAction=new wW(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?kT:UW}recognize(t){const{session:e}=this;if(e.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let r;const{recognizers:n}=this;let{curRecognizer:i}=e;(!i||i&&i.state&yn.Recognized)&&(i=e.curRecognizer=null);let o=0;for(;o<n.length;)r=n[o],e.stopped!==kT&&(!i||r===i||r.canRecognizeWith(i))?r.recognize(t):r.reset(),!i&&r.state&(yn.Began|yn.Changed|yn.Ended)&&(i=e.curRecognizer=r),o++}get(t){const{recognizers:e}=this;for(let r=0;r<e.length;r++)if(e[r].options.event===t)return e[r];return null}add(t){if(Array.isArray(t)){for(const r of t)this.add(r);return this}const e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(const r of t)this.remove(r);return this}const e=typeof t=="string"?this.get(t):t;if(e){const{recognizers:r}=this,n=r.indexOf(e);n!==-1&&(r.splice(n,1),this.touchAction.update())}return this}on(t,e){if(!t||!e)return;const{handlers:r}=this;for(const n of w_(t))r[n]=r[n]||[],r[n].push(e)}off(t,e){if(!t)return;const{handlers:r}=this;for(const n of w_(t))e?r[n]&&r[n].splice(r[n].indexOf(e),1):delete r[n]}emit(t,e){const r=this.handlers[t]&&this.handlers[t].slice();if(!r||!r.length)return;const n=e;n.type=t,n.preventDefault=function(){e.srcEvent.preventDefault()};let i=0;for(;i<r.length;)r[i](n),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){const{element:e}=this;if(e){for(const[r,n]of Object.entries(this.options.cssProps)){const i=NW(e.style,r);t?(this.oldCssProps[i]=e.style[i],e.style[i]=n):e.style[i]=this.oldCssProps[i]||""}t||(this.oldCssProps={})}}},zW=1;function jW(){return zW++}function UT(t){return t&yn.Cancelled?"cancel":t&yn.Ended?"end":t&yn.Changed?"move":t&yn.Began?"start":""}class WD{constructor(e){this.options=e,this.id=jW(),this.state=yn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<yn.Ended&&this.manager.emit(this.options.event+UT(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=yn.Ended&&this.manager.emit(this.options.event+UT(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=yn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(yn.Failed|yn.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=yn.Failed;return}this.state&(yn.Recognized|yn.Cancelled|yn.Failed)&&(this.state=yn.Possible),this.state=this.process(r),this.state&(yn.Began|yn.Changed|yn.Ended|yn.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class JD extends WD{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,i=r&(yn.Began|yn.Changed),o=this.attrTest(e);return i&&(n&ps.Cancel||!o)?r|yn.Cancelled:i||o?n&ps.End?r|yn.Ended:r&yn.Began?r|yn.Changed:yn.Began:yn.Failed}}class GT extends WD{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[T2]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,i=e.distance<r.threshold,o=e.deltaTime<r.time;if(this.reset(),e.eventType&ps.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(e.eventType!==ps.End)return this.failTimeout();const s=this.pTime?e.timeStamp-this.pTime<r.interval:!0,l=!this.pCenter||jD(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!s?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=yn.Recognized,this.tryEmit(this._input)},r.interval),yn.Began):yn.Recognized}return yn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=yn.Failed},this.options.interval),yn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===yn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const HW=["","start","move","end","cancel","up","down","left","right"];class zT extends JD{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ws.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&ws.Horizontal&&r.push(I2),e&ws.Vertical&&r.push(S2),r}getEventNames(){return HW.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:i}=e,{direction:o}=e;const s=e.deltaX,l=e.deltaY;return o&r.direction||(r.direction&ws.Horizontal?(o=s===0?ws.None:s<0?ws.Left:ws.Right,n=s!==this.pX,i=Math.abs(e.deltaX)):(o=l===0?ws.None:l<0?ws.Up:ws.Down,n=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>r.threshold&&!!(o&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&yn.Began)||!(this.state&yn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=ws[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const VW=["","start","move","end","cancel","in","out"];class WW extends JD{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[z0]}getEventNames(){return VW.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&yn.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}let Ty=class{constructor(t,e,r){this.element=t,this.callback=e,this.options=r}};const JW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",KW=JW.indexOf("firefox")!==-1,jT=4.000244140625,XW=40,QW=.25;let ZW=class extends Ty{constructor(t,e,r){super(t,e,{enable:!0,...r}),this.handleEvent=n=>{if(!this.options.enable)return;let i=n.deltaY;globalThis.WheelEvent&&(KW&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(i/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(i*=XW)),i!==0&&i%jT===0&&(i=Math.floor(i/jT)),n.shiftKey&&i&&(i=i*QW),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-i,srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,e){t==="wheel"&&(this.options.enable=e)}};const HT=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let $W=class extends Ty{constructor(t,e,r){super(t,e,{enable:!0,...r}),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,HT.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){HT.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){switch(t){case"pointermove":this.enableMoveEvent=e;break;case"pointerover":this.enableOverEvent=e;break;case"pointerout":this.enableOutEvent=e;break;case"pointerenter":this.enableEnterEvent=e;break;case"pointerleave":this.enableLeaveEvent=e;break}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}};const VT=["keydown","keyup"];let qW=class extends Ty{constructor(t,e,r){super(t,e,{enable:!0,tabIndex:0,...r}),this.handleEvent=n=>{const i=n.target||n.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",VT.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){VT.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t==="keydown"&&(this.enableDownEvent=e),t==="keyup"&&(this.enableUpEvent=e)}},YW=class extends Ty{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t==="contextmenu"&&(this.options.enable=e)}};const WT=1,M2=2,JT=4,eJ={pointerdown:WT,pointermove:M2,pointerup:JT,mousedown:WT,mousemove:M2,mouseup:JT},tJ=0,rJ=1,nJ=2,iJ=1,sJ=2,oJ=4;function aJ(t){const e=eJ[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,o=!1,s=!1;return e===M2?(i=!!(r&iJ),o=!!(r&oJ),s=!!(r&sJ)):(i=n===tJ,o=n===rJ,s=n===nJ),{leftButton:i,middleButton:o,rightButton:s}}function lJ(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/o};return{center:r,offsetCenter:s}}const cJ={srcElement:"root",priority:0};let uJ=class{constructor(t,e){this.handleEvent=r=>{if(this.isEmpty())return;const n=this._normalizeEvent(r);let i=r.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=t,this.recognizerName=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,r,n=!1,i=!1){const{handlers:o,handlersByElement:s}=this,l={...cJ,...r};let h=s.get(l.srcElement);h||(h=[],s.set(l.srcElement,h));const A={type:t,handler:e,srcElement:l.srcElement,priority:l.priority};n&&(A.once=!0),i&&(A.passive=!0),o.push(A),this._active=this._active||!A.passive;let b=h.length-1;for(;b>=0&&!(h[b].priority>=A.priority);)b--;h.splice(b+1,0,A)}remove(t,e){const{handlers:r,handlersByElement:n}=this;for(let i=r.length-1;i>=0;i--){const o=r[i];if(o.type===t&&o.handler===e){r.splice(i,1);const s=n.get(o.srcElement);s.splice(s.indexOf(o),1),s.length===0&&n.delete(o.srcElement)}}this._active=r.some(i=>!i.passive)}_emit(t,e){const r=this.handlersByElement.get(e);if(r){let n=!1;const i=()=>{t.handled=!0},o=()=>{t.handled=!0,n=!0},s=[];for(let l=0;l<r.length;l++){const{type:h,handler:A,once:b}=r[l];if(A({...t,type:h,stopPropagation:i,stopImmediatePropagation:o}),b&&s.push(r[l]),n)break}for(let l=0;l<s.length;l++){const{type:h,handler:A}=s[l];this.remove(h,A)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...aJ(t),...lJ(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}};function hJ(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),i=r.shift()||{};e=new n(i)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}let fJ=class{constructor(t=null,e={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...e},this.events=new Map,this.element=t,!!t){this.manager=new GW(t,this.options);for(const r of this.options.recognizers){const{recognizer:n,recognizeWith:i,requireFailure:o}=hJ(r);this.manager.add(n),i&&n.recognizeWith(i),o&&n.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new ZW(t,this._onOtherEvent,{enable:!1}),this.moveInput=new $W(t,this._onOtherEvent,{enable:!1}),this.keyInput=new qW(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new YW(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,e,r){this._addEventHandler(t,e,r,!1)}once(t,e,r){this._addEventHandler(t,e,r,!0)}watch(t,e,r){this._addEventHandler(t,e,r,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:r}=this;if(!r)return;const n=r.get(t);n&&(n.set({enable:e}),r.touchAction.update()),this.wheelInput?.enableEventType(t,e),this.moveInput?.enableEventType(t,e),this.keyInput?.enableEventType(t,e),this.contextmenuInput?.enableEventType(t,e)}_addEventHandler(t,e,r,n,i){if(typeof t!="string"){r=e;for(const[h,A]of Object.entries(t))this._addEventHandler(h,A,r,n,i);return}const{manager:o,events:s}=this;if(!o)return;let l=s.get(t);if(!l){const h=this._getRecognizerName(t)||t;l=new uJ(this,h),s.set(t,l),o&&o.on(t,l.handleEvent)}l.add(t,e,r,n,i),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const[i,o]of Object.entries(t))this._removeEventHandler(i,o);return}const{events:r}=this,n=r.get(t);if(n&&(n.remove(t,e),n.isEmpty())){const{recognizerName:i}=n;let o=!1;for(const s of r.values())if(s.recognizerName===i&&!s.isEmpty()){o=!0;break}o||this._toggleRecognizer(i,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(e=>e.getEventNames().includes(t))?.options.event}};const Yr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Yr,"IDENTITY",{get:()=>($r.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const da={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Po={common:0,meters:1,pixels:2},P2={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},KT={multipan:[zT,{threshold:10,direction:ws.Vertical,pointers:2}],pinch:[WW,{},null,["multipan"]],pan:[zT,{threshold:1},["pinch"],["multipan"]],dblclick:[GT,{event:"dblclick",taps:2}],click:[GT,{event:"click"},null,["dblclick"]]};function dJ(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Kg(t){let e={},r;return n=>{for(const i in n)if(!dJ(n[i],e[i])){r=t(n),e=n;break}return r}}const XT=[0,0,0,0],pJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],AJ=[0,0,0],XD=[0,0,0],gJ=Kg(yJ);function QD(t,e,r=XD){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(e===Yr.LNGLAT_OFFSETS||e===Yr.METER_OFFSETS?i=r:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case da.WEB_MERCATOR:(e===Yr.LNGLAT||e===Yr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case da.WEB_MERCATOR_AUTO_OFFSET:e===Yr.LNGLAT?n=i:e===Yr.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case da.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case da.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function mJ(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:i}=t;let{viewMatrix:o,viewProjectionMatrix:s}=t,l=XT,h=XT,A=t.cameraPosition;const{geospatialOrigin:b,shaderCoordinateOrigin:C,offsetMode:S}=QD(t,e,r);return S&&(h=t.projectPosition(b||C),A=[A[0]-h[0],A[1]-h[1],A[2]-h[2]],h[3]=1,l=qp([],h,s),o=n||o,s=nf([],i,o),s=nf([],s,pJ)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:l,originCommon:h,cameraPosCommon:A,shaderCoordinateOrigin:C,geospatialOrigin:b}}function _J({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=Yr.DEFAULT,coordinateOrigin:i=XD,autoWrapLongitude:o=!1}){n===Yr.DEFAULT&&(n=t.isGeospatial?Yr.LNGLAT:Yr.CARTESIAN);const s=gJ({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return s.wrapLongitude=o,s.modelMatrix=r||KD,s}function yJ({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:A}=mJ(t,r,n),b=t.getDistanceScales(),C=[t.width*e,t.height*e],S=qp([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,D={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:h,commonOrigin:s.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:C,devicePixelRatio:e,focalDistance:S,commonUnitsPerMeter:b.unitsPerMeter,commonUnitsPerWorldUnit:b.unitsPerMeter,commonUnitsPerWorldUnit2:AJ,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:KD,cameraPosition:l};if(A){const N=t.getDistanceScales(A);switch(r){case Yr.METER_OFFSETS:D.commonUnitsPerWorldUnit=N.unitsPerMeter,D.commonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case Yr.LNGLAT:case Yr.LNGLAT_OFFSETS:t._pseudoMeters||(D.commonUnitsPerMeter=N.unitsPerMeter),D.commonUnitsPerWorldUnit=N.unitsPerDegree,D.commonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case Yr.CARTESIAN:D.commonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],D.commonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return D}const bJ=Object.keys(Yr).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Yr[t]};`).join(""),vJ=Object.keys(da).map(t=>`const PROJECTION_MODE_${t}: i32 = ${da[t]};`).join(""),xJ=Object.keys(Po).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Po[t]};`).join(""),wJ=`${bJ}
${vJ}
${xJ}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,CJ=`${wJ}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,EJ=Object.keys(Yr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Yr[t]};`).join(""),BJ=Object.keys(da).map(t=>`const int PROJECTION_MODE_${t} = ${da[t]};`).join(""),TJ=Object.keys(Po).map(t=>`const int UNIT_${t.toUpperCase()} = ${Po[t]};`).join(""),SJ=`${EJ}
${BJ}
${TJ}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,IJ={};function MJ(t=IJ){return"viewport"in t?_J(t):{}}const Sy={name:"project",dependencies:[YV,GD],source:CJ,vs:SJ,getUniforms:MJ,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},PJ=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,LJ=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Fs={name:"project32",dependencies:[Sy],source:PJ,vs:LJ};function RJ(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bp(t,e){const r=qp([],e,t);return nC(r,r,1/r[3]),r}function QT(t,e){const r=t%e;return r<0?e+r:r}function L2(t,e,r){return t<e?e:t>r?r:t}function OJ(t){return Math.log(t)*Math.LOG2E}const oC=Math.log2||OJ;function tu(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const vl=Math.PI,ZD=vl/4,Ha=vl/180,R2=180/vl,Op=512,C_=4003e4,ap=85.051129,DJ=1.5;function FJ(t){return oC(t)}function ru(t){const[e,r]=t;tu(Number.isFinite(e)),tu(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*Ha,i=r*Ha,o=Op*(n+vl)/(2*vl),s=Op*(vl+Math.log(Math.tan(ZD+i*.5)))/(2*vl);return[o,s]}function dc(t){const[e,r]=t,n=e/Op*(2*vl)-vl,i=2*(Math.atan(Math.exp(r/Op*(2*vl)-vl))-ZD);return[n*R2,i*R2]}function kJ(t){const{latitude:e}=t;tu(Number.isFinite(e));const r=Math.cos(e*Ha);return FJ(C_*r)-9}function hv(t){const e=Math.cos(t*Ha);return Op/C_/e}function O2(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;tu(Number.isFinite(e)&&Number.isFinite(r));const i=Op,o=Math.cos(e*Ha),s=i/360,l=s/o,h=i/C_/o,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[s,l,h],degreesPerUnit:[1/s,1/l,1/h]};if(n){const b=Ha*Math.tan(e*Ha)/o,C=s*b/2,S=i/C_*b,D=S/l*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[D,0,D]}return A}function $D(t,e){const[r,n,i]=t,[o,s,l]=e,{unitsPerMeter:h,unitsPerMeter2:A}=O2({longitude:r,latitude:n,highPrecision:!0}),b=ru(t);b[0]+=o*(h[0]+A[0]*s),b[1]+=s*(h[1]+A[1]*s);const C=dc(b),S=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[C[0],C[1],S]:C}function NJ(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:o,center:s}=t,l=RJ();x_(l,l,[0,0,-i]),SD(l,l,-r*Ha),ID(l,l,n*Ha);const h=o/e;return rC(l,l,[h,h,h]),s&&x_(l,l,jH([],s)),l}function UJ(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:l,nearZMultiplier:h=1,farZMultiplier:A=1}=t;let{fovy:b=Tg(DJ)}=t;n!==void 0&&(b=Tg(n));const C=b*Ha,S=i*Ha,D=aC(b);let N=D;s&&(N+=s[2]*l/Math.cos(S)/r);const U=C*(.5+(o?o[1]:0)/r),V=Math.sin(U)*N/Math.sin(L2(Math.PI/2-S-U,.01,Math.PI-.01)),j=Math.sin(S)*V+N,ee=N*10,Q=Math.min(j*A,ee);return{fov:C,aspect:e/r,focalDistance:D,near:h,far:Q}}function Tg(t){return 2*Math.atan(.5/t)*R2}function aC(t){return .5/Math.tan(.5*t*Ha)}function qD(t,e){const[r,n,i=0]=t;return tu(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),bp(e,[r,n,i,1])}function lC(t,e,r=0){const[n,i,o]=t;if(tu(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return bp(e,[n,i,o,1]);const s=bp(e,[n,i,0,1]),l=bp(e,[n,i,1,1]),h=s[2],A=l[2],b=h===A?0:((r||0)-h)/(A-h);return AD([],s,l,b)}function GJ(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=t,[[l,h],[A,b]]=n,C=zJ(t.padding),S=ru([l,L2(b,-ap,ap)]),D=ru([A,L2(h,-ap,ap)]),N=[Math.max(Math.abs(D[0]-S[0]),i),Math.max(Math.abs(D[1]-S[1]),i)],U=[e-C.left-C.right-Math.abs(s[0])*2,r-C.top-C.bottom-Math.abs(s[1])*2];tu(U[0]>0&&U[1]>0);const V=U[0]/N[0],j=U[1]/N[1],ee=(C.right-C.left)/2/V,Q=(C.top-C.bottom)/2/j,X=[(D[0]+S[0])/2+ee,(D[1]+S[1])/2+Q],pe=dc(X),Y=Math.min(o,oC(Math.abs(Math.min(V,j))));return tu(Number.isFinite(Y)),{longitude:pe[0],latitude:pe[1],zoom:Y}}function zJ(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(tu(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const ZT=Math.PI/180;function jJ(t,e=0){const{width:r,height:n,unproject:i}=t,o={targetZ:e},s=i([0,n],o),l=i([r,n],o);let h,A;const b=t.fovy?.5*t.fovy*ZT:Math.atan(.5/t.altitude),C=(90-t.pitch)*ZT;return b>C-.01?(h=$T(t,0,e),A=$T(t,r,e)):(h=i([0,0],o),A=i([r,0],o)),[s,l,A,h]}function $T(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=bp(n,[e,0,1,1]),o=bp(n,[e,t.height,1,1]),s=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),l=AD([],i,o,s),h=dc(l);return h.push(r),h}const qT=512;function HJ(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:o,zoom:s,bearing:l=0}=t;(i<-180||i>180)&&(i=QT(i+180,360)-180),(l<-180||l>180)&&(l=QT(l+180,360)-180);const h=oC(r/qT);if(s<=h)s=h,o=0;else{const A=r/2/Math.pow(2,s),b=dc([0,A])[1];if(o<b)o=b;else{const C=dc([0,qT-A])[1];o>C&&(o=C)}}return{width:e,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:l}}const YD=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,VJ=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,WJ=`
${YD}
${VJ}
`,JJ=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,KJ=`
${YD}
${JJ}
`,XJ=Kg(YJ),QJ=Kg(eK),ZJ=[0,0,0,1],$J=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function qJ(t,e){const[r,n,i]=t,o=lC([r,n,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function YJ({viewport:t,center:e}){return new bn(t.viewProjectionMatrix).invert().transform(e)}function eK({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,o=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(s=>qJ(s,n));for(const s of e){const l=s.clone().translate(new ft(t.center).negate()),h=o.map(b=>l.transform(b)),A=new bn().ortho({left:Math.min(...h.map(b=>b[0])),right:Math.max(...h.map(b=>b[0])),bottom:Math.min(...h.map(b=>b[1])),top:Math.max(...h.map(b=>b[1])),near:Math.min(...h.map(b=>-b[2])),far:Math.max(...h.map(b=>-b[2]))});r.push(A.multiplyRight(s))}return r}function tK(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=Sy.getUniforms(r),i=XJ({viewport:r.viewport,center:n.center}),o=[],s=QJ({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let h=0;h<t.shadowMatrices.length;h++){const A=s[h],b=A.clone().translate(new ft(r.viewport.center).negate());n.coordinateSystem===Yr.LNGLAT&&n.projectionMode===da.WEB_MERCATOR?(s[h]=b,o[h]=i):(s[h]=A.clone().multiplyRight($J),o[h]=b.transform(i))}const l={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||ZJ,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let h=0;h<s.length;h++)l[`viewProjectionMatrix${h}`]=s[h],l[`projectCenter${h}`]=o[h];for(let h=0;h<2;h++)l[`shadow_uShadowMap${h}`]=t.shadowMaps&&t.shadowMaps[h]||t.dummyShadowMap;return l}const YT={name:"shadow",dependencies:[Sy],vs:WJ,fs:KJ,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:tK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},_a={...IT,defaultUniforms:{...IT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},rK=[GD],nK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],iK=[];function sK(t){const e=Qh.getDefaultShaderAssembler();for(const n of rK)e.addDefaultModule(n);const r=t==="glsl"?nK:iK;for(const n of r)e.addShaderHook(n);return e}const oK=[255,255,255],aK=1;let lK=0;class cK{constructor(e={}){this.type="ambient";const{color:r=oK}=e,{intensity:n=aK}=e;this.id=e.id||`ambient-${lK++}`,this.color=r,this.intensity=n}}const uK=[255,255,255],hK=1,fK=[0,0,-1];let dK=0;class eS{constructor(e={}){this.type="directional";const{color:r=uK}=e,{intensity:n=hK}=e,{direction:i=fK}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${dK++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new ft(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class e6{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Iy extends e6{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,o=e.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,l=i?0:!1,h=e.colorMask??15,A={viewport:[0,0,r,n]};e.colorMask&&(A.colorMask=h),e.scissorRect&&(A.scissorRect=e.scissorRect);const b=this.device.beginRenderPass({framebuffer:e.target,parameters:A,clearColor:o,clearDepth:s,clearStencil:l});try{return this._drawLayers(b,e)}finally{b.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:i,viewports:o,views:s,onViewportActive:l,clearStack:h=!0}=r;r.pass=r.pass||"unknown",h&&(this._lastRenderIndex=-1);const A=[];for(const b of o){const C=s&&s[b.id];l?.(b);const S=this._getDrawLayerParams(b,r),D=b.subViewports||[b];for(const N of D){const U=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:N,view:C,pass:r.pass,layers:r.layers},S);A.push(U)}}return A}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:l,shaderModuleProps:h},A=!1){const b=[],C=t6(this._lastRenderIndex+1),S={layer:r[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},D={};for(let N=0;N<r.length;N++){const U=r[N],V=this._shouldDrawLayer(U,S,o,D),j={shouldDrawLayer:V};V&&!A&&(j.shouldDrawLayer=!0,j.layerRenderIndex=C(U,V),j.shaderModuleProps=this._getShaderModuleProps(U,l,n,h),j.layerParameters={...U.context.deck?.props.parameters,...this.getLayerParameters(U,N,e)}),b[N]=j}return b}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:i,target:o,viewport:s,view:l},h){const A=pK(this.device,{shaderModuleProps:n,target:o,viewport:s});if(l&&l.props.clear){const C=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:A,scissorRect:A},clearColor:C.color?[0,0,0,0]:!1,clearDepth:C.depth?1:!1}).end()}const b={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:A});for(let C=0;C<r.length;C++){const S=r[C],D=h[C],{shouldDrawLayer:N}=D;if(N&&S.props.pickable&&b.pickableCount++,S.isComposite&&b.compositeCount++,S.isDrawable&&D.shouldDrawLayer){const{layerRenderIndex:U,shaderModuleProps:V,layerParameters:j}=D;b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,U),V.project&&(V.project.viewport=s),S.context.renderPass=e;try{S._drawLayer({renderPass:e,shaderModuleProps:V,uniforms:{layerIndex:U},parameters:j})}catch(ee){S.raiseError(ee,`drawing ${S} to ${i}`)}}}return b}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(r))return!1;r.layer=o,o=o.parent}if(n){const s=r.layer.id;if(s in i||(i[s]=n(r)),!i[s])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,i){const o=this.device.canvasContext.cssToDeviceRatio(),s=e.internalState?.propsInTransition||e.props,l={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const h of r)tS(l,h.getShaderModuleProps?.(e,l));return tS(l,this.getShaderModuleProps(e,r,l),i)}}function t6(t=0,e={}){const r={},n=(i,o)=>{const s=i.props._offset,l=i.id,h=i.parent&&i.parent.id;let A;if(h&&!(h in e)&&n(i.parent,!1),h in r){const b=r[h]=r[h]||t6(e[h],e);A=b(i,o),r[l]=b}else Number.isFinite(s)?(A=s+(e[h]||0),r[l]=null):A=t;return o&&A>=t&&(t=A+1),e[l]=A,A};return n}function pK(t,{shaderModuleProps:e,target:r,viewport:n}){const i=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),s=r?r.height:o,l=n;return[l.x*i,s-(l.y+l.height)*i,l.width*i,l.height*i]}function tS(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class AK extends Iy{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],o=i.width*n,s=i.height*n,l=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...e,clearColor:l,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const gK={color:[255,255,255],intensity:1},rS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],mK=[0,0,0,200/255];class r6{constructor(e={}){this.id="lighting-effect",this.shadowColor=mK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(YT),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(YT))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new bn().lookAt({eye:new ft(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new AK(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new cK(gK),this.directionalLights.push(new eS(rS[0]),new eS(rS[1])))}}class _K{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:l=!1,maxCount:h}){const A=i||e&&e.constructor||Float32Array,b=r*n+o;if(ArrayBuffer.isView(e)){if(b<=e.length)return e;if(b*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new A(e.buffer,0,b)}let C=1/0;h&&(C=h*n+o);const S=this._allocate(A,b,l,C);return e&&s?S.set(e):l||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);const s=this._pool,l=e.BYTES_PER_ELEMENT*o,h=s.findIndex(A=>A.byteLength>=l);if(h>=0){const A=new e(s.splice(h,1)[0],0,o);return n&&A.fill(0),A}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:i}=n,o=r.findIndex(s=>s.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}}const Dp=new _K;function ZA(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yK(t){return[t[12],t[13],t[14]]}function bK(t){return{left:Id(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Id(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Id(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Id(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Id(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Id(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const nS=new ft;function Id(t,e,r,n){nS.set(t,e,r);const i=nS.len();return{distance:n/i,normal:new ft(-t/i,-e/i,-r/i)}}function vK(t){return t-Math.fround(t)}let NA;function fv(t,e){const{size:r=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,o=(i-n)/r;NA=Dp.allocate(NA,o,{type:Float32Array,size:r*2});let s=n,l=0;for(;s<i;){for(let h=0;h<r;h++){const A=t[s++];NA[l+h]=A,NA[l+h+r]=vK(A)}l+=r*2}return NA.subarray(0,o*r*2)}function xK(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const wK=Math.PI/180,CK=ZA(),iS=[0,0,0],EK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function BK({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:s,far:l}){const h=t/e,A=r?new bn().orthographic({fovy:n,aspect:h,focalDistance:i,near:s,far:l}):new bn().perspective({fovy:n,aspect:h,near:s,far:l});if(o){const{left:b=0,right:C=0,top:S=0,bottom:D=0}=o,N=$c((b+t-C)/2,0,t)-t/2,U=$c((S+e-D)/2,0,e)-e/2;A[8]-=N*2/t,A[9]+=U*2/e}return A}class ou{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||EK,this.focalDistance=e.focalDistance||1,this.position=e.position||iS,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?da.WEB_MERCATOR:da.WEB_MERCATOR_AUTO_OFFSET:da.IDENTITY}equals(e){return e instanceof ou?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ma(e.projectionMatrix,this.projectionMatrix)&&ma(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),i=qD(n,this.pixelProjectionMatrix),[o,s]=i,l=r?s:this.height-s;return e.length===2?[o,l]:[o,l,i[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,o,s]=e,l=r?o:this.height-o,h=n&&n*this.distanceScales.unitsPerMeter[2],A=lC([i,l,s],this.pixelUnprojectionMatrix,h),[b,C,S]=this.unprojectPosition(A);return Number.isFinite(s)?[b,C,S]:Number.isFinite(n)?[b,C,n]:[b,C]}projectPosition(e){const[r,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(e){if(this.isGeospatial){const r=ru(e);return r[1]=$c(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?dc(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?O2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,bK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=kJ({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||O2({latitude:n,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:s}=e;let l=iS;if(o&&(l=s?new bn(s).transformAsVector(o,[]):o),this.isGeospatial){const h=this.projectPosition([r,n,0]);this.center=new ft(l).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:r=CK,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:l=.1,far:h=1e3,padding:A=null,focalDistance:b=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new bn().multiplyRight(r).translate(new ft(this.center).negate()),this.projectionMatrix=n||BK({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*wK,focalDistance:b,padding:A,near:l,far:h});const C=ZA();nf(C,C,this.projectionMatrix),nf(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=E2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=yK(this.viewMatrixInverse);const S=ZA(),D=ZA();rC(S,S,[this.width/2,-this.height/2,1]),x_(S,S,[1,-1,0]),nf(D,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=E2(ZA(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$r.warn("Pixel project matrix not invertible")()}}ou.displayName="Viewport";let Sg=class D2 extends ou{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:l=.1,farZMultiplier:h=1.01,nearZ:A,farZ:b,orthographic:C=!1,projectionMatrix:S,repeat:D=!1,worldOffset:N=0,position:U,padding:V,legacyMeterSizes:j=!1}=e;let{width:ee,height:Q,altitude:X=1.5}=e;const pe=Math.pow(2,i);ee=ee||1,Q=Q||1;let Y,Ge=null;if(S)X=S[5]/2,Y=Tg(X);else{e.fovy?(Y=e.fovy,X=aC(Y)):Y=Tg(X);let de;if(V){const{top:ce=0,bottom:De=0}=V;de=[0,$c((ce+Q-De)/2,0,Q)-Q/2]}Ge=UJ({width:ee,height:Q,scale:pe,center:U&&[0,0,U[2]*hv(r)],offset:de,pitch:o,fovy:Y,nearZMultiplier:l,farZMultiplier:h}),Number.isFinite(A)&&(Ge.near=A),Number.isFinite(b)&&(Ge.far=b)}let ze=NJ({height:Q,pitch:o,bearing:s,scale:pe,altitude:X});N&&(ze=new bn().translate([512*N,0,0]).multiplyLeft(ze)),super({...e,width:ee,height:Q,viewMatrix:ze,longitude:n,latitude:r,zoom:i,...Ge,fovy:Y,focalDistance:X}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=X,this.fovy=Y,this.orthographic=C,this._subViewports=D?[]:null,this._pseudoMeters=j,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=r;i<=n;i++){const o=i?new D2({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),i=(e[2]||0)*hv(e[1]);return[r,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),i=(e[2]||0)/hv(n);return[r,n,i]}addMetersToLngLat(e,r){return $D(e,r)}panByPosition(e,r){const n=lC(r,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=xT([],i,DH([],n)),s=xT([],this.center,o),[l,h]=this.unprojectFlat(s);return{longitude:l,latitude:h}}getBounds(e={}){const r=jJ(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:l}=GJ({width:n,height:i,bounds:e,...r});return new D2({width:n,height:i,longitude:o,latitude:s,zoom:l})}};Sg.displayName="WebMercatorViewport";const sS=[0,0,0];function dv(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof Sg){const[i,o,s=0]=t,l=e.getDistanceScales([i,o]);n[2]=s*l.unitsPerMeter[2]}return n}function TK(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=t;return i===Yr.DEFAULT&&(i=e.isGeospatial?Yr.LNGLAT:Yr.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function n6(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,l,h=0]=t;switch(r&&([s,l,h]=qp([],[s,l,h,1],r)),n){case Yr.LNGLAT:return dv([s,l,h],e,o);case Yr.LNGLAT_OFFSETS:return dv([s+i[0],l+i[1],h+(i[2]||0)],e,o);case Yr.METER_OFFSETS:return dv($D(i,[s,l,h]),e,o);case Yr.CARTESIAN:default:return e.isGeospatial?[s+i[0],l+i[1],h+i[2]]:e.projectPosition([s,l,h])}}function SK(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:l}=TK(e),{autoOffset:h=!0}=e,{geospatialOrigin:A=sS,shaderCoordinateOrigin:b=sS,offsetMode:C=!1}=h?QD(r,n,i):{},S=n6(t,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:l,offsetMode:C});if(C){const D=r.projectPosition(A||b);ED(S,S,D)}return S}let IK=1,MK=1;class i6{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,s=IK++,l={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(l,this.time),this.channels.set(s,l),s}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const i of r)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=MK++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function PK(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function LK(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function oS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let aS=class{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},RK=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:r}=t;let n=this.stats[e];return n||(t instanceof aS?n=t:n=new aS(e,r),this.stats[e]=n),n}},OK=0;const DK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:v2.stats.get(`animation-loop-${OK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class FK{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...DK,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new RK({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=PK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(LK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const pv={};function wf(t="id"){pv[t]=pv[t]||1;const e=pv[t]++;return`${t}-${e}`}class lS{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||wf("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ci.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function kK(t,e){if(e instanceof lS)return e;const r=NK(t,e),{attributes:n,bufferLayout:i}=UK(t,e);return new lS({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:r,attributes:n})}function NK(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Ci.INDEX,data:r})}function UK(t,e){const r=[],n={};for(const[o,s]of Object.entries(e.attributes)){let l=o;switch(o){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(s){n[l]=t.createBuffer({data:s.value,id:`${o}-buffer`});const{value:h,size:A,normalized:b}=s;r.push({name:l,format:Jj(h,A,b)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}class cC{static defaultProps={...Lp.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new cC(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const r={...Lp.defaultProps,...e},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const r={...A_.defaultProps,...e},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const r=e.hash,n=e instanceof A_?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${i}BL${o}`;default:const s=this._getHash(JSON.stringify(e.parameters));return`${r}/${n}V${i}T${e.topology}P${s}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class uC{static defaultProps={...Cy.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new uC(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const r=this._hashShader(e);let n=this._cache[r];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const r=this._hashShader(e),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function GK(t,e){const r={},n="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of t.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;r[`in ${o}`]={[n]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const o=`${i.location} ${i.name}`;r[`out ${o}`]={[n]:JSON.stringify(i)}}return r}let Ds=null,Av=null;function zK(t,{id:e,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Ds||(Ds=document.createElement("canvas"),Ds.id=e,Ds.title=e,Ds.style.zIndex="100",Ds.style.position="absolute",Ds.style.top=i,Ds.style.left=o,Ds.style.border="blue 5px solid",Ds.style.transform="scaleY(-1)",document.body.appendChild(Ds),Av=Ds.getContext("2d")),(Ds.width!==t.width||Ds.height!==t.height)&&(Ds.width=t.width/2,Ds.height=t.height/2,Ds.style.width="400px",Ds.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),h=Av?.createImageData(t.width,t.height);if(h){for(let A=0;A<l.length;A+=4)h.data[0+A+0]=l[A+0]*s,h.data[0+A+1]=l[A+1]*s,h.data[0+A+2]=l[A+2]*s,h.data[0+A+3]=n?255:l[A+3]*s;Av?.putImageData(h,0,0)}}function F2(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!F2(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!F2(t[o],e[o],r-1))return!1;return!0}return!1}function jK(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function HK(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function s6(t){return jK(t)||HK(t)}function VK(t){return s6(t)||typeof t=="number"||typeof t=="boolean"}function o6(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];VK(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class WK{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);const n=Rw(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Yt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,o]of Object.entries(e))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Yt.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(e){for(const r of Object.keys(e)){const n=r,i=e[n]||{},o=this.modules[n];if(!o){this.options.disableWarnings||Yt.warn(`Module ${r} not found`)();continue}const s=this.moduleUniforms[n],l=this.moduleBindings[n],h=o.getUniforms?.(i,s)||i,{uniforms:A,bindings:b}=o6(h);this.moduleUniforms[n]={...s,...A},this.moduleBindings[n]={...l,...b}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(n))e[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(o)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let JK="";async function KK(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:JK+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}class gv{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e,this.id=r.id||wf("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:KK(r.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(r)}async initAsync(e){const r=e.data;let n;try{n=await a6(r)}catch(o){this.rejectReady(o)}if(this.destroyed)return;const i={...e,data:n};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}}async function a6(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(a6));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let o=0;o<n.length;o++)i[n[o]]=r[o];return i}return t}const Gh=2,XK=1e4;class Di{static defaultProps={...Lp.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Qh.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...Di.defaultProps,...r},r=this.props,this.id=r.id||wf("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(this.props.modules?.map(l=>[l.name,l])||[]),i=r.shaderInputs||new WK(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const o=ZK(e),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:l,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=l,this._getModuleUniforms=h,this.props.shaderLayout||=xH(this.source)}else{const{vs:l,fs:h,getUniforms:A}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=l,this.fs=h,this._getModuleUniforms=A}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||cC.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||uC.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return Yt.info(Gh,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),k2(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&kK(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const n=new Yb(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new Yb(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){F2(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Wj(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(QK(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=r?.disableWarnings??this.props.disableWarnings;e.indices&&Yt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=Kj(this.pipeline.shaderLayout,this.bufferLayout);const i=new Yb(this.bufferLayout);for(const[o,s]of Object.entries(e)){const l=i.getBufferLayout(o);if(!l){n||Yt.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const h=i.getAttributeNamesForBuffer(l);let A=!1;for(const b of h){const C=this._attributeInfos[b];if(C){const S=this.device.type==="webgpu"?i.getBufferIndex(C.bufferName):C.location;this.vertexArray.setBuffer(S,s),A=!0}}!A&&!n&&Yt.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,i]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):(r?.disableWarnings??this.props.disableWarnings)||Yt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){k2(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:r,uniforms:n}=o6(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof gv&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof gv?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof wy?e=Math.max(e,r.texture.updateTimestamp):r instanceof Ci||r instanceof oi?e=Math.max(e,r.updateTimestamp):r instanceof gv?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof wg||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Yt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=VO(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Yt.level>3?0:XK;Yt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Yt.group(Gh,`>>> DRAWING MODEL ${this.id}`,{collapsed:Yt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=GK(this.pipeline.shaderLayout,this.id);Yt.table(Gh,e)();const r=this.shaderInputs.getDebugTable();for(const[i,o]of Object.entries(this.uniforms))r[i]={value:o};Yt.table(Gh,r)();const n=this._getAttributeDebugTable();Yt.table(Gh,this._attributeInfos)(),Yt.table(Gh,n)(),Yt.groupEnd(Gh)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&zK(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=KO(r);return(e instanceof Ci?new n(e.debugData):e).toString()}}function QK(t){return!!(t.uniformTypes&&!k2(t.uniformTypes))}function ZK(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function k2(t){for(const e in t)return!1;return!0}class ff{device;model;transformFeedback;static defaultProps={...Di.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=ff.defaultProps){if(!ff.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Di(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||OO(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof Ci)return r.readAsync();const{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}}const $K="transform_output";class cS{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,r){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Di(this.device,{id:r.id||"texture-transform-model",fs:r.fs||OO({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:$K}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),i){e.targetTexture=i;const{width:o,height:s}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),e.framebuffer.resize({width:o,height:s})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(const n in r)r[n].sampler=this.sampler}}class eo{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||wf("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,s]of Object.entries(r)){const l=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!l.size&&(l.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[o]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const i of Object.values(e)){const{value:o,size:s,constant:l}=i;!l&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}}const qK=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,YK=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,uS=[-1,-1,1,-1,-1,1,1,1];class eX extends Di{constructor(e,r){const n=uS.map(i=>i===-1?0:i);r.source&&(r={...r,source:`${qK}
${r.source}`}),super(e,{id:r.id||wf("clip-space"),...r,vs:YK,vertexCount:4,geometry:new eo({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(uS)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class E_{id;matrix=new bn;display=!0;position=new ft;rotation=new ft;scale=new ft(1,1,1);userData={};props={};constructor(e={}){const{id:r}=e;this.id=r||wf(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:r,rotation:n,scale:i,update:o=!0}=e;return r&&this.setPosition(r),n&&this.setRotation(n),i&&this.setScale(i),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,r=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(n),this}update(e={}){const{position:r,rotation:n,scale:i}=e;return r&&this.setPosition(r),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,r){r=r||this.matrix;const n=new bn(e).multiplyRight(r),i=n.invert(),o=i.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class vp extends E_{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:r=[]}=e;Yt.assert(r.every(n=>n instanceof E_),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:n})=>{const i=r.getBounds();if(!i)return;const[o,s]=i,l=new ft(o).add(s).divide([2,2,2]);n.transformAsPoint(l,l);const h=new ft(s).subtract(o).divide([2,2,2]);n.transformAsVector(h,h);for(let A=0;A<8;A++){const b=new ft(A&1?-1:1,A&2?-1:1,A&4?-1:1).multiply(h).add(l);for(let C=0;C<3;C++)e[0][C]=Math.min(e[0][C],b[C]),e[1][C]=Math.max(e[1][C],b[C])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const r=this.children,n=r.indexOf(e);return n>-1&&r.splice(n,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new bn}={}){const n=new bn(r).multiplyRight(this.matrix);for(const i of this.children)i instanceof vp?i.traverse(e,{worldMatrix:n}):e(i,{worldMatrix:n})}}class N2 extends E_{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}}class l6 extends eo{constructor(e={}){const{id:r=wf("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:r,topology:"triangle-list",indices:{size:1,value:tX},attributes:{...lX,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...cX,...e.attributes}})}}const tX=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),rX=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),nX=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),iX=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),sX=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),oX=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),aX=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),lX={POSITION:{size:3,value:rX},NORMAL:{size:3,value:nX},TEXCOORD_0:{size:2,value:iX}},cX={POSITION:{size:3,value:sX},TEXCOORD_0:{size:2,value:oX},COLOR_0:{size:3,value:aX}},uX=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,hX={name:"screen",fs:uX,uniformTypes:{texSize:"vec2<f32>"}};class fX extends e6{constructor(e,r){super(e,r);const{module:n,fs:i,id:o}=r,s={depthWriteEnabled:!1,depthCompare:"always"};this.model=new eX(e,{id:o,fs:i,modules:[n,hX],parameters:s})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,r){const{clearCanvas:n,inputBuffer:i,outputBuffer:o}=r,s=[i.width,i.height],l={texSrc:i.colorAttachments[0],texSize:s};this.model.shaderInputs.setProps({screen:l,...r.moduleProps});const h=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:n?[0,0,0,0]:!1,clearDepth:1,clearStencil:!1});this.model.draw(h),h.end()}}class dX{constructor(e,r){this.id=`${e.name}-pass`,this.props=r,EO(e),this.module=e}setup({device:e}){this.passes=pX(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const r=this.passes,{target:n}=e;let i=e.inputBuffer,o=e.swapBuffer;for(let s=0;s<r.length;s++){const l=s===r.length-1,h=n!==void 0&&l;h&&(o=n);const A=!h||!!e.clearCanvas,b={},C=this.module.passes[s].uniforms;b[this.module.name]={...this.props,...C},r[s].render({clearCanvas:A,inputBuffer:i,outputBuffer:o,moduleProps:b});const S=o;o=i,i=S}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function pX(t,e,r){return e.passes.map((n,i)=>{const o=mX(e,n),s=`${r}-${i}`;return new fX(t,{id:s,module:e,fs:o})})}const c6=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,AX=t=>`${c6}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${t}(fragColor, screen.texSize, coordinate);
}
`,gX=t=>`${c6}
void main() {
  fragColor = ${t}(texSrc, screen.texSize, coordinate);
}
`;function mX(t,e){if(e.filter){const r=typeof e.filter=="string"?e.filter:`${t.name}_filterColor_ext`;return AX(r)}if(e.sampler){const r=typeof e.sampler=="string"?e.sampler:`${t.name}_sampleColor`;return gX(r)}return""}const _X={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class u6 extends Iy{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:l,y:h,width:A,height:b},cullRect:C,effects:S,pass:D="picking",pickZ:N,shaderModuleProps:U}){this.pickZ=N;const V=this._resetColorEncoder(N),j=[l,h,A,b],ee=super.render({target:s,layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:C,effects:S?.filter(Q=>Q.useInPicking),pass:D,isPicking:!0,shaderModuleProps:U,clearColor:[0,0,0,0],colorMask:15,scissorRect:j});return this._colorEncoderState=null,{decodePickingColor:V&&bX.bind(null,V),stats:ee}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const i={...e.props.parameters},{pickable:o,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,_X),i.blend=!0,i.blendColor=yX(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function yX(t,e,r){const{byLayer:n,byAlpha:i}=t;let o,s=n.get(e);return s?(s.viewports.push(r),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:e,viewports:[r]},n.set(e,s),i[o]=s):($r.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function bX(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const ep={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},B_=Symbol.for("component"),Zu=Symbol.for("propTypes"),mv=Symbol.for("deprecatedProps"),xp=Symbol.for("asyncPropDefaults"),df=Symbol.for("asyncPropOriginal"),Wu=Symbol.for("asyncPropResolved");function My(t,e=()=>!0){return Array.isArray(t)?h6(t,e,[]):e(t)?[t]:[]}function h6(t,e,r){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?h6(i,e,r):e(i)&&r.push(i)}return r}function vX({target:t,source:e,start:r=0,count:n=1}){const i=e.length,o=n*i;let s=0;for(let l=r;s<i;s++)t[l++]=e[s];for(;s<o;)s<o-s?(t.copyWithin(r+s,r,r+s),s*=2):(t.copyWithin(r+s,r,r+o-s),s=o);return t}function hS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let fS=class{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=hS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(hS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},f6=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:r}=t;let n=this.stats[e];return n||(t instanceof fS?n=t:n=new fS(e,r),this.stats[e]=n),n}};class xX{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=A2(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class wX{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(r,n):(o=new xX(e,r,this._context),this._resources[e]=o),o.persistent=i}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:i="default"}){const{_resources:o,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=o[e];if(this._track(n,i,l,r),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,i){const o=this._consumers,s=o[e]=o[e]||{};let l=s[r];const h=l&&l.resourceId&&this._resources[l.resourceId];h&&(h.unsubscribe(l),this.prune()),n&&(l?(l.onChange=i,l.resourceId=n.id):l={onChange:i,resourceId:n.id},s[r]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const CX="layerManager.setLayers",EX="layerManager.activateViewport";class BX{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{_o(EX,this,l),l&&(this.context.viewport=l)};const{deck:n,stats:i,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new wX({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:sK(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[AW],renderPass:void 0,stats:i||new f6({id:"deck.gl"}),viewport:o||new ou({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new i6,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){_o(CX,this,r,e),this._lastRenderedLayers=e;const n=My(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const s of e)n[s.id]?$r.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(const s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,r,n){for(const i of e){i.context=this.context;const o=r[i.id];o===null&&$r.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ep.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=ep.MATCHED,r!==e&&(e.lifecycle=ep.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ep.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ep.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function es(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!es(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!es(t[o],e[o],r-1))return!1;return!0}return!1}class TX{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const s=n[o];if(s.containsPixel(i)){const l=e.slice();return l[0]-=s.x,l[1]-=s.y,s.unproject(l,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=My(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!es(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):$r.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>this.getView(e.id)?.makeViewport({viewState:i,width:this.width,height:this.height})})}_updateController(e,r,n,i){const o=e.controller;if(o&&n){const s={...r,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const o=e[i],s=this.getViewState(o),l=o.makeViewport({viewState:s,width:this.width,height:this.height});let h=r[o.id];const A=!!o.controller;A&&!h&&(n=!0),(n||!A)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,s,l,h),l&&this._viewports.unshift(l)}for(const i in r){const o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,i)=>!e[i].equals(r[i]))}}const SX=/([0-9]+\.?[0-9]*)(%|px)/;function Du(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=SX.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Fu(t,e){return t.relative?Math.round(t.position*e):t.position}class Fp{constructor(e){const{id:r,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:l=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Du(n),this._y=Du(i),this._width=Du(o),this._height=Du(s),this._padding=l&&{left:Du(l.left||0),right:Du(l.right||0),top:Du(l.top||0),bottom:Du(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&es(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:r});if(!i.height||!i.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:Fu(this._x,e),y:Fu(this._y,r),width:Fu(this._width,e),height:Fu(this._height,r)};return this._padding&&(n.padding={left:Fu(this._padding.left,e),top:Fu(this._padding.top,r),right:Fu(this._padding.right,e),bottom:Fu(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Py{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const dS=()=>{},U2={BREAK:1,SNAP_TO_END:2,IGNORE:3},IX=t=>t,MX=U2.BREAK;let PX=class{constructor(t){this._onTransitionUpdate=e=>{const{time:r,settings:{interpolator:n,startProps:i,endProps:o,duration:s,easing:l}}=e,h=l(r/s),A=n.interpolateProps(i,o,h);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Py(t.timeline),this.onViewStateChange=t.onViewStateChange||dS,this.onStateChange=t.onStateChange||dS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){let n=r;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;n={...r,...i===U2.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(n,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:r}=t;return(e>0||e==="auto")&&!!r}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===U2.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const r=this.getControllerState(t),n=this.getControllerState(e).shortestPathFrom(r),i=e.transitionInterpolator,o=i.getDuration?i.getDuration(t,e):e.transitionDuration;if(o===0)return;const s=i.initializeProps(t,n);this.propsInTransition={};const l={duration:o,easing:e.transitionEasing||IX,interpolator:i,interruption:e.transitionInterruption||MX,startProps:s.start,endProps:s.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(e)}}};function Ys(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}let LX=class{constructor(t){const{compare:e,extract:r,required:n}=t;this._propsToCompare=e,this._propsToExtract=r||e,this._requiredProps=n}arePropsEqual(t,e){for(const r of this._propsToCompare)if(!(r in t)||!(r in e)||!ma(t[r],e[r]))return!1;return!0}initializeProps(t,e){const r={},n={};for(const i of this._propsToExtract)(i in t||i in e)&&(r[i]=t[i],n[i]=e[i]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const r=t[e];Ys(Number.isFinite(r)||Array.isArray(r),`${e} is required for transition`)})}};const RX=["longitude","latitude","zoom","bearing","pitch"],OX=["longitude","latitude","zoom"];let d6=class extends LX{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,r=Array.isArray(t)?{}:t;r.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:RX,required:OX},super(r.transitionProps),this.opts=r}initializeProps(t,e){const r=super.initializeProps(t,e),{makeViewport:n,around:i}=this.opts;if(n&&i){const o=n(t),s=n(e),l=o.unproject(i);r.start.around=i,Object.assign(r.end,{around:s.project(l),aroundPosition:l,width:e.width,height:e.height})}return r}interpolateProps(t,e,r){const n={};for(const i of this._propsToExtract)n[i]=El(t[i]||0,e[i]||0,r);if(e.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...e,...n});Object.assign(n,i.panByPosition(e.aroundPosition,El(t.around,e.around,r)))}return n}};const ku={transitionDuration:0},DX=300,$m=t=>1-(1-t)*(1-t),Md={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},zh={};class FX{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new PX({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:i}=e;return[i.x-r,i.y-n]}isPointInBounds(e,r){const{width:n,height:i}=this.props;if(r&&r.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?DX:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:l=!0,touchRotate:h=!1,keyboard:A=!0}=e,b=!!this.onViewStateChange;this.toggleEvents(Md.WHEEL,b&&n),this.toggleEvents(Md.PAN,b),this.toggleEvents(Md.PINCH,b&&(l||h)),this.toggleEvents(Md.MULTI_PAN,b&&h),this.toggleEvents(Md.DOUBLE_CLICK,b&&s),this.toggleEvents(Md.KEYBOARD,b&&A),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=l,this.touchRotate=h,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const i={...e.getViewportProps(),...r},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,ku,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,ku,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$m},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,ku,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$m},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);const l=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(l,{...this._getTransitionProps({around:r}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,ku,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,ku,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$m},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return zh._startPinchRotation=e.rotation,zh._lastPinchEvent=e,this.updateViewport(n,ku,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:zh._startPinchRotation-n})}return this.updateViewport(r,ku,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),zh._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=zh;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),l=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),h=Math.pow(2,s+l*r/2);o=o.zoom({pos:i,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:$m},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return zh._startPinchRotation=null,zh._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let h;const A={};switch(e.srcEvent.code){case"Minus":h=r?l.zoomOut(n).zoomOut(n):l.zoomOut(n),A.isZooming=!0;break;case"Equal":h=r?l.zoomIn(n).zoomIn(n):l.zoomIn(n),A.isZooming=!0;break;case"ArrowLeft":r?(h=l.rotateLeft(o),A.isRotating=!0):(h=l.moveLeft(i),A.isPanning=!0);break;case"ArrowRight":r?(h=l.rotateRight(o),A.isRotating=!0):(h=l.moveRight(i),A.isPanning=!0);break;case"ArrowUp":r?(h=l.rotateUp(s),A.isRotating=!0):(h=l.moveUp(i),A.isPanning=!0);break;case"ArrowDown":r?(h=l.rotateDown(s),A.isRotating=!0):(h=l.moveDown(i),A.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),A),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?ku:e?{...r,transitionInterpolator:new d6({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class kX{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const pS=5,NX=1.2;let UX=class extends kX{constructor(t){const{width:e,height:r,latitude:n,longitude:i,zoom:o,bearing:s=0,pitch:l=0,altitude:h=1.5,position:A=[0,0,0],maxZoom:b=20,minZoom:C=0,maxPitch:S=60,minPitch:D=0,startPanLngLat:N,startZoomLngLat:U,startRotatePos:V,startBearing:j,startPitch:ee,startZoom:Q,normalize:X=!0}=t;Ys(Number.isFinite(i)),Ys(Number.isFinite(n)),Ys(Number.isFinite(o)),super({width:e,height:r,latitude:n,longitude:i,zoom:o,bearing:s,pitch:l,altitude:h,maxZoom:b,minZoom:C,maxPitch:S,minPitch:D,normalize:X,position:A},{startPanLngLat:N,startZoomLngLat:U,startRotatePos:V,startBearing:j,startPitch:ee,startZoom:Q}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const r=this.getState().startPanLngLat||this._unproject(e);if(!r)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(r,t);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:r=0}){const{startRotatePos:n,startBearing:i,startPitch:o}=this.getState();if(!n||i===void 0||o===void 0)return this;let s;return t?s=this._getNewRotation(t,n,o,i):s={bearing:i+e,pitch:o+r},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:r}){let{startZoom:n,startZoomLngLat:i}=this.getState();if(i||(n=this.getViewportProps().zoom,i=this._unproject(e)||this._unproject(t)),!i)return this;const{maxZoom:o,minZoom:s}=this.getViewportProps();let l=n+Math.log2(r);l=$c(l,s,o);const h=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...h.panByPosition(i,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:i}=r;return Math.abs(n-e.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(i-e.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}applyConstraints(t){const{maxZoom:e,minZoom:r,zoom:n}=t;t.zoom=$c(n,r,e);const{maxPitch:i,minPitch:o,pitch:s}=t;t.pitch=$c(s,o,i);const{normalize:l=!0}=t;return l&&Object.assign(t,HJ(t)),t}_zoomFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.zoom({pos:[e/2,r/2],scale:t})}_panFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.pan({startPos:[e/2,r/2],pos:[e/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,r,n){const i=t[0]-e[0],o=t[1]-e[1],s=t[1],l=e[1],{width:h,height:A}=this.getViewportProps(),b=i/h;let C=0;o>0?Math.abs(A-l)>pS&&(C=o/(l-A)*NX):o<0&&l>pS&&(C=1-s/l),C=$c(C,-1,1);const{minPitch:S,maxPitch:D}=this.getViewportProps(),N=n+180*b;let U=r;return C>0?U=r+C*(D-r):C<0&&(U=r-C*(S-r)),{pitch:U,bearing:N}}},GX=class extends FX{constructor(){super(...arguments),this.ControllerState=UX,this.transition={transitionDuration:300,transitionInterpolator:new d6({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};class p6 extends Fp{constructor(e={}){super(e)}getViewportType(){return Sg}get ControllerType(){return GX}}p6.displayName="MapView";const zX=new r6;function jX(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class HX{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(i=>jX(i,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(es(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const i of this.effects)r[i.id]=i;const n=[];for(const i of e){const o=r[i.id];let s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete r[i.id]}for(const i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof r6)||this._resolvedEffects.push(zX),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class VX extends Iy{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const WX="deckRenderer.renderLayers";class JX{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new VX(e),this.pickLayersPass=new u6(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=r.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,_o(WX,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;const s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}const KX={pickedColor:null,pickedObjectIndex:-1};function XX({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){const{x:s,y:l,width:h,height:A}=o;let b=i*i,C=-1,S=0;for(let D=0;D<A;D++){const N=D+l-n,U=N*N;if(U>b)S+=4*h;else for(let V=0;V<h;V++){if(t[S+3]-1>=0){const j=V+s-r,ee=j*j+U;ee<=b&&(b=ee,C=S)}S+=4}}if(C>=0){const D=t.slice(C,C+4),N=e(D);if(N){const U=Math.floor(C/4/h),V=C/4-U*h;return{...N,pickedColor:D,pickedX:s+V,pickedY:l+U}}$r.error("Picked non-existent layer. Is picking buffer corrupt?")()}return KX}function QX({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const i=t.slice(n,n+4),o=i.join(",");if(!r.has(o)){const s=e(i);s?r.set(o,{...s,color:i}):$r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function A6({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:i,z:o}){let s=e[0];e.length>1&&(s=$X(t?.pickedViewports||e,{x:n,y:i}));let l;if(s){const h=[n-s.x,i-s.y];o!==void 0&&(h[2]=o),l=s.unproject(h)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function ZX(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:i}=t,{pickedColor:o,pickedLayer:s,pickedObjectIndex:l}=e,h=s?[s]:[];if(n==="hover"){const C=r.index,S=r.layerId,D=s?s.props.id:null;if(D!==S||l!==C){if(D!==S){const N=i.find(U=>U.props.id===S);N&&h.unshift(N)}r.layerId=D,r.index=l,r.info=null}}const A=A6(t),b=new Map;return b.set(null,A),h.forEach(C=>{let S={...A};C===s&&(S.color=o,S.index=l,S.picked=!0),S=g6({layer:C,info:S,mode:n});const D=S.layer;C===s&&n==="hover"&&(r.info=S),b.set(D.id,S),n==="hover"&&D.updateAutoHighlight(S)}),b}function g6({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function $X(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class qX{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new u6(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,l=o&&o.viewport&&o.viewport.id,h=s?n.find(C=>C.id===s):null,A=l&&i.find(C=>C.id===l)||i[0],b=A&&A.unproject([e-A.x,r-A.y]);return{...o,x:e,y:r,viewport:A,coordinate:b,layer:h}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:n,x:i,y:o,radius:s=0,depth:l=1,mode:h="query",unproject3D:A,onViewportActive:b,effects:C}){const S=this.device.canvasContext.cssToDeviceRatio(),D=this._getPickable(e);if(!D||n.length===0)return{result:[],emptyInfo:A6({viewports:n,x:i,y:o,pixelRatio:S})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],V=Math.round(s*S),{width:j,height:ee}=this.pickingFBO,Q=this._getPickingRect({deviceX:U[0],deviceY:U[1],deviceRadius:V,deviceWidth:j,deviceHeight:ee}),X={x:i-s,y:o-s,width:s*2+1,height:s*2+1};let pe;const Y=[],Ge=new Set;for(let ze=0;ze<l;ze++){let de;if(Q){const De=this._drawAndSample({layers:D,views:r,viewports:n,onViewportActive:b,deviceRect:Q,cullRect:X,effects:C,pass:`picking:${h}`});de=XX({...De,deviceX:U[0],deviceY:U[1],deviceRadius:V,deviceRect:Q})}else de={pickedColor:null,pickedObjectIndex:-1};let ce;if(de.pickedLayer&&A&&this.depthFBO){const{pickedColors:De}=this._drawAndSample({layers:[de.pickedLayer],views:r,viewports:n,onViewportActive:b,deviceRect:{x:de.pickedX,y:de.pickedY,width:1,height:1},cullRect:X,effects:C,pass:`picking:${h}:z`},!0);De[3]&&(ce=De[0])}de.pickedLayer&&ze+1<l&&(Ge.add(de.pickedLayer),de.pickedLayer.disablePickingIndex(de.pickedObjectIndex)),pe=ZX({pickInfo:de,lastPickedInfo:this.lastPickedInfo,mode:h,layers:D,viewports:n,x:i,y:o,z:ce,pixelRatio:S});for(const De of pe.values())De.layer&&Y.push(De);if(!de.pickedColor)break}for(const ze of Ge)ze.restorePickingColors();return{result:Y,emptyInfo:pe.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:n,x:i,y:o,width:s=1,height:l=1,mode:h="query",maxObjects:A=null,onViewportActive:b,effects:C}){const S=this._getPickable(e);if(!S||n.length===0)return[];this._resizeBuffer();const D=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=N.x,V=N.y+N.height,j=this.device.canvasContext.cssToDevicePixels([i+s,o+l],!0),ee=j.x+j.width,Q=j.y,X={x:U,y:Q,width:ee-U,height:V-Q},pe=this._drawAndSample({layers:S,views:r,viewports:n,onViewportActive:b,deviceRect:X,cullRect:{x:i,y:o,width:s,height:l},effects:C,pass:`picking:${h}`}),Y=QX(pe),Ge=new Map,ze=[],de=Number.isFinite(A);for(let ce=0;ce<Y.length&&!(de&&ze.length>=A);ce++){const De=Y[ce];let J={color:De.pickedColor,layer:null,index:De.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:D};J=g6({layer:De.pickedLayer,info:J,mode:h});const ue=J.layer.id;Ge.has(ue)||Ge.set(ue,new Set);const Ee=Ge.get(ue),ct=J.object??J.index;Ee.has(ct)||(Ee.add(ct),ze.push(J))}return ze}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:l,pass:h},A=!1){const b=A?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:b,deviceRect:o,cullRect:s,effects:l,pass:h,pickZ:A,preRenderStats:{},isPicking:!0};for(const ee of l)ee.useInPicking&&(C.preRenderStats[ee.id]=ee.preRender(C));const{decodePickingColor:S}=this.pickLayersPass.render(C),{x:D,y:N,width:U,height:V}=o,j=new(A?Float32Array:Uint8Array)(U*V*4);return this.device.readPixelsToArrayWebGL(b,{sourceX:D,sourceY:N,sourceWidth:U,sourceHeight:V,target:j}),{pickedColors:j,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){const s=Math.max(0,e-n),l=Math.max(0,r-n),h=Math.min(i,e+n+1)-s,A=Math.min(o,r+n+1)-l;return h<=0||A<=0?null:{x:s,y:l,width:h,height:A}}}const YX={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},eQ="top-left",AS="__root";class tQ{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!es(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const i=r[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:r=null,placement:n=eQ}=e,i=e.onAdd({deck:this.deck,viewId:r});i&&this._getContainer(r,n).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){const n=e||AS;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,YX[r]),i.append(o)),o}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,o=n===AS||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:r}px`):s.style.display="none"}}onRedraw({viewports:e,layers:r}){const n=e.reduce((i,o)=>(i[o.id]=o,i),{});for(const i of this.getWidgets()){const{viewId:o}=i;if(o){const s=n[o];s&&(i.onViewportChange&&i.onViewportChange(s),i.onRedraw?.({viewports:[s],layers:r}))}else{if(i.onViewportChange)for(const s of e)i.onViewportChange(s);i.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){for(const n of this.getWidgets()){const{viewId:i}=n;(!i||i===e.viewport?.id)&&n.onHover?.(e,r)}}onEvent(e,r){const n=P2[r.type];if(n)for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===e.viewport?.id)&&i[n]?.(e,r)}}}const rQ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class nQ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,rQ),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,r,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var lp;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(lp||(lp={}));const hC={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},hs=(t,e,r)=>e?t.enable(r):t.disable(r),gS=(t,e,r)=>t.hint(r,e),aa=(t,e,r)=>t.pixelStorei(r,e),mS=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},UA=(t,e,r)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(n,e)};function _v(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const iQ={3042:hs,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:hs,2885:(t,e)=>t.cullFace(e),2929:hs,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:hs,35723:gS,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:mS,36010:mS,34964:UA,36662:UA,36663:UA,35053:UA,35055:UA,2886:(t,e)=>t.frontFace(e),33170:gS,2849:(t,e)=>t.lineWidth(e),32823:hs,32824:"polygonOffset",10752:"polygonOffset",35977:hs,32926:hs,32928:hs,32938:"sampleCoverage",32939:"sampleCoverage",3089:hs,3088:(t,e)=>t.scissor(...e),2960:hs,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:hs,10754:hs,12288:hs,12289:hs,12290:hs,12291:hs,12292:hs,12293:hs,12294:hs,12295:hs,3333:aa,3317:aa,37440:aa,37441:aa,37443:aa,3330:aa,3332:aa,3331:aa,3314:aa,32878:aa,3316:aa,3315:aa,32877:aa,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=_v(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=_v(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,s,l]=e;t.stencilFuncSeparate(1028,r,n,i),t.stencilFuncSeparate(1029,o,s,l)},stencilOp:(t,e)=>{e=_v(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,s,l]=e;t.stencilOpSeparate(1028,r,n,i),t.stencilOpSeparate(1029,o,s,l)},viewport:(t,e)=>t.viewport(...e)};function qi(t,e,r){return e[t]!==void 0?e[t]:r[t]}const sQ={blendEquation:(t,e,r)=>t.blendEquationSeparate(qi(32777,e,r),qi(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(qi(32969,e,r),qi(32968,e,r),qi(32971,e,r),qi(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(qi(32824,e,r),qi(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(qi(32938,e,r),qi(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,qi(2962,e,r),qi(2967,e,r),qi(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,qi(34816,e,r),qi(36003,e,r),qi(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,qi(2964,e,r),qi(2965,e,r),qi(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,qi(34817,e,r),qi(34818,e,r),qi(34819,e,r))},_S={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,i)=>t({32773:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,i)=>t({32969:e,32968:r,32971:n,32970:i}),clearColor:(t,e,r,n,i)=>t({3106:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,i)=>t({3107:[e,r,n,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,i)=>t({3088:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(t,e,r,n,i)=>t({2978:[e,r,n,i]})},Yl=(t,e)=>t.isEnabled(e),yS={3042:Yl,2884:Yl,2929:Yl,3024:Yl,32823:Yl,32926:Yl,32928:Yl,3089:Yl,2960:Yl,35977:Yl},oQ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Yp(t,e){if(lQ(e))return;const r={};for(const i in e){const o=Number(i),s=iQ[i];s&&(typeof s=="string"?r[s]=!0:s(t,e[i],o))}const n=t.state&&t.state.cache;if(n)for(const i in r){const o=sQ[i];o(t,e,n)}}function m6(t,e=hC){if(typeof e=="number"){const i=e,o=yS[i];return o?o(t,i):t.getParameter(i)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const i of r){const o=yS[i];n[i]=o?o(t,Number(i)):t.getParameter(Number(i))}return n}function aQ(t){Yp(t,hC)}function lQ(t){for(const e in t)return!1;return!0}function cQ(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class sf{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Yp(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?m6(e):Object.assign({},hC),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,hQ(e);for(const n in _S){const i=_S[n];uQ(e,n,i)}bS(e,"getParameter"),bS(e,"isEnabled")}_updateCache(e){let r=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const s=e[o],l=this.cache[o];cQ(s,l)||(r=!0,n=l,i&&!(o in i)&&(i[o]=l),this.cache[o]=s)}return{valueChanged:r,oldValue:n}}}function bS(t,e){const r=t[e].bind(t);t[e]=function(n){if(n===void 0||oQ.has(n))return r(n);const i=sf.get(t);return n in i.cache||(i.cache[n]=r(n)),i.enable?i.cache[n]:r(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function uQ(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...i){const o=sf.get(t),{valueChanged:s,oldValue:l}=r(o._updateCache,...i);return s&&n(...i),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function hQ(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const n=sf.get(t);n.program!==r&&(e(r),n.program=r)}}function fQ(t,e,r){let n="";const i={preserveDrawingBuffer:!0,...r};let o=null;if(o||=t.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=t.getContext("webgl2",i),o.luma||={},o.luma.softwareRenderer=!0),o||(o=t.getContext("webgl",{}),o&&(o=null,n||="Your browser only supports WebGL1")),!o)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:s,onContextRestored:l}=e;return t.addEventListener("webglcontextlost",h=>s(h),!1),t.addEventListener("webglcontextrestored",h=>l(h),!1),o.luma||={},o}function kp(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function dQ(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);kp(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,o=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=o||r,h=s||n,A=t.getParameter(7938),b=_6(l,h),C=pQ(l,h),S=AQ(l,h);return{type:"webgl",gpu:b,gpuType:S,gpuBackend:C,vendor:l,renderer:h,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function _6(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function pQ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function AQ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(_6(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function y6(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const $A="WEBGL_compressed_texture_s3tc",qA="WEBGL_compressed_texture_s3tc_srgb",cp="EXT_texture_compression_rgtc",up="EXT_texture_compression_bptc",gQ="WEBGL_compressed_texture_etc",mQ="WEBGL_compressed_texture_astc",_Q="WEBGL_compressed_texture_etc1",yQ="WEBGL_compressed_texture_pvrtc",bQ="WEBGL_compressed_texture_atc",vS="EXT_texture_norm16",xS="EXT_render_snorm",vQ="EXT_color_buffer_float",fC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[xS],"norm16-renderable-webgl":[vS],"snorm16-renderable-webgl":[vS,xS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[$A,qA,cp,up],"texture-compression-bc5-webgl":[cp],"texture-compression-bc7-webgl":[up],"texture-compression-etc2":[gQ],"texture-compression-astc":[mQ],"texture-compression-etc1-webgl":[_Q],"texture-compression-pvrtc-webgl":[yQ],"texture-compression-atc-webgl":[bQ]};function xQ(t){return t in fC}function wQ(t,e,r){return(fC[e]||[]).every(n=>kp(t,n,r))}const dC={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:vQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:$A},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:qA},"bc1-rgba-unorm":{gl:33777,x:$A},"bc1-rgba-unorm-srgb":{gl:35916,x:qA},"bc2-rgba-unorm":{gl:33778,x:$A},"bc2-rgba-unorm-srgb":{gl:35918,x:qA},"bc3-rgba-unorm":{gl:33779,x:$A},"bc3-rgba-unorm-srgb":{gl:35919,x:qA},"bc4-r-unorm":{gl:36283,x:cp},"bc4-r-snorm":{gl:36284,x:cp},"bc5-rg-unorm":{gl:36285,x:cp},"bc5-rg-snorm":{gl:36286,x:cp},"bc6h-rgb-ufloat":{gl:36495,x:up},"bc6h-rgb-float":{gl:36494,x:up},"bc7-rgba-unorm":{gl:36492,x:up},"bc7-rgba-unorm-srgb":{gl:36493,x:up},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function CQ(t,e,r){let n=e.create;const i=dC[e.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!kp(t,i.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function b6(t){const e=dC[t],r=TQ(t),n=Dw(t);return{internalFormat:r,format:e?.dataFormat||BQ(n.channels,n.integer,n.normalized,r),type:n.dataType?y6(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function EQ(t){switch(Dw(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function BQ(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function TQ(t){const e=dC[t]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${t}`);return e}const wS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class SQ extends uj{gl;extensions;testedFeatures=new Set;constructor(e,r,n){super([],n),this.gl=e,this.extensions=r,kp(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),xQ(e)&&wQ(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(wS),...Object.keys(fC)]}getWebGLFeature(e){const r=wS[e];return typeof r=="string"?!!kp(this.gl,r,this.extensions):!!r}}class IQ extends cj{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class ug extends Ey{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);const n=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const n=this.colorAttachments[r];if(n){const i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){const r=EQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${PQ(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){const{gl:n}=this.device,{texture:i}=r,o=r.props.baseMipLevel,s=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,o,s);break;case 34067:const l=MQ(s);n.framebufferTexture2D(36160,e,l,i.handle,o);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}function MQ(t){return t<34069?t+34069:t}function PQ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class LQ extends Fw{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ug(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}}async function v6(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${t}': ${s}`)),r.appendChild(n)})}const RQ=1;let la=null,CS=!1;const pC={debugSpectorJS:Yt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function OQ(t){if(!globalThis.SPECTOR)try{await v6(t.debugSpectorJSUrl||pC.debugSpectorJSUrl)}catch(e){Yt.warn(String(e))}}function DQ(t){if(t={...pC,...t},!t.debugSpectorJS)return null;if(!la&&globalThis.SPECTOR&&!globalThis.luma?.spector){Yt.probe(RQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;la=new e,globalThis.luma&&(globalThis.luma.spector=la)}if(!la)return null;if(CS||(CS=!0,la.spyCanvases(),la?.onCaptureStarted.add(e=>Yt.info("Spector capture started:",e)()),la?.onCapture.add(e=>{Yt.info("Spector capture complete:",e)(),la?.getResultUI(),la?.resultView.display(),la?.resultView.addCapture(e)})),t.gl){const e=t.gl,r=e.device;la?.startCapture(t.gl,500),e.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Yt.info("Spector capture stopped after 2 seconds")(),la?.stopCapture()})}return la}const FQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function x6(t){return t.luma=t.luma||{},t.luma}async function kQ(){mc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await v6(FQ))}function NQ(t,e={}){return e.debugWebGL||e.traceWebGL?GQ(t,e):UQ(t)}function UQ(t){const e=x6(t);return e.realContext?e.realContext:t}function GQ(t,e){if(!globalThis.WebGLDebugUtils)return Yt.warn("webgl-debug not loaded")(),t;const r=x6(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...lp,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,zQ.bind(null,e),jQ.bind(null,e));for(const s in lp)!(s in n)&&typeof lp[s]=="number"&&(n[s]=lp[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,n);const o=Object.create(i);return r.realContext=t,r.debugContext=o,o.debug=!0,o}function ES(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function zQ(t,e,r,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${i} in gl.${r}(${o})`;Yt.error(s)();debugger}function jQ(t,e,r){let n="";Yt.level>=1&&(n=ES(e,r),t.traceWebGL&&Yt.log(1,n)());for(const i of r)if(i===void 0){n=n||ES(e,r);debugger}}const yv={};function HQ(t="id"){yv[t]=yv[t]||1;const e=yv[t]++;return`${t}-${e}`}class hg extends Ci{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=VQ(this.props.usage),this.glUsage=WQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,n=e.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const n=new Uint8Array(r);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,r),n}}function VQ(t){return t&Ci.INDEX?34963:t&Ci.VERTEX?34962:t&Ci.UNIFORM?35345:34962}function WQ(t){return t&Ci.INDEX||t&Ci.VERTEX?35044:t&Ci.UNIFORM?35048:35044}function JQ(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[C,S]=i;r.push({message:S.trim(),type:BS(C),lineNum:0,linePos:0});continue}const[o,s,l,...h]=i;let A=parseInt(l,10);isNaN(A)&&(A=0);let b=parseInt(s,10);isNaN(b)&&(b=0),r.push({message:h.join(":").trim(),type:BS(o),lineNum:A,linePos:b})}return r}function BS(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class KQ extends Cy{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?JQ(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Yt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Yt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async n=>await new Promise(i=>setTimeout(i,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function XQ(t,e,r,n){if(qQ(e))return n(t);const i=t;i.pushState();try{return QQ(t,e),Yp(i.gl,r),n(t)}finally{i.popState()}}function QQ(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(of("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const i=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=of("provokingVertex",e.provokingVertex,{first:36429,last:36430});i?.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=of("polygonMode",e.polygonMode,{fill:6914,line:6913});i?.polygonModeWEBGL(1028,o),i?.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask($Q("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(G2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Yt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,o=G2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=bv("stencilPassOperation",e.stencilPassOperation),o=bv("stencilFailOperation",e.stencilFailOperation),s=bv("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=TS("blendColorOperation",e.blendColorOperation||"add"),o=TS("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);const s=qm("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=qm("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=qm("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),A=qm("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,l,h,A)}}function G2(t,e){return of(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function bv(t,e){return of(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function TS(t,e){return of(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function qm(t,e){return of(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function ZQ(t,e){return`Illegal parameter ${e} for ${t}`}function of(t,e,r){if(!(e in r))throw new Error(ZQ(t,e));return r[e]}function $Q(t,e){return e}function qQ(t){let e=!0;for(const r in t){e=!1;break}return e}function w6(t){const e={};return t.addressModeU&&(e[10242]=vv(t.addressModeU)),t.addressModeV&&(e[10243]=vv(t.addressModeV)),t.addressModeW&&(e[32882]=vv(t.addressModeW)),t.magFilter&&(e[10240]=z2(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=YQ(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=G2("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function vv(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function z2(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function YQ(t,e="none"){if(!e)return z2(t);switch(e){case"none":return z2(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class j2 extends wg{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=w6(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,n]of Object.entries(e)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}class hp extends wy{device;gl;handle;texture;constructor(e,r){super(e,{...oi.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const eZ="Failed to deduce GL constant from typed array";function tZ(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(eZ)}}function rZ(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function C6(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function nZ(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function T_(t,e,r){if(iZ(e))return r(t);const{nocatch:n=!0}=e,i=sf.get(t);i.push(),Yp(t,e);let o;if(n)o=r(t),i.pop();else try{o=r(t)}finally{i.pop()}return o}function iZ(t){for(const e in t)return!1;return!0}function sZ(t,e,r){const{dimension:n,width:i,height:o,depth:s=0}=r,{glInternalFormat:l}=r,h=r.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(h,e,l,i,o,s);break;default:t.texStorage2D(h,e,l,i,o)}}function SS(t,e,r,n){const{width:i,height:o}=n,{dimension:s,depth:l=0,mipLevel:h=0}=n,{x:A=0,y:b=0,z:C=0}=n,{glFormat:S,glType:D}=n,N=E6(n.glTarget,s,l),U=n.flipY?{37440:!0}:{};T_(t,U,()=>{switch(s){case"2d-array":case"3d":t.bindTexture(N,e),t.texSubImage3D(N,h,A,b,C,i,o,l,S,D,r),t.bindTexture(N,null);break;case"2d":case"cube":t.bindTexture(N,e),t.texSubImage2D(N,h,A,b,i,o,S,D,r),t.bindTexture(N,null);break;default:throw new Error(s)}})}function IS(t,e,r){const{dimension:n,width:i,height:o,depth:s=0,mipLevel:l=0,byteOffset:h=0}=r,{x:A=0,y:b=0,z:C=0}=r,{glFormat:S,glType:D,compressed:N}=r,U=E6(r.glTarget,n,s);switch(n){case"2d-array":case"3d":N?t.compressedTexSubImage3D(U,l,A,b,C,i,o,s,S,e,h):t.texSubImage3D(U,l,A,b,C,i,o,s,S,D,e,h);break;case"2d":case"cube":N?t.compressedTexSubImage2D(U,l,A,b,i,o,S,e,h):t.texSubImage2D(U,l,A,b,i,o,S,D,e,h);break;default:throw new Error(n)}}function oZ(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function E6(t,e,r){return e==="cube"?34069+r:t}function aZ(t,e){const{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:o=null,sourceWidth:s,sourceHeight:l,sourceDepth:h,sourceFormat:A,sourceType:b}=e||{};const{framebuffer:C,deleteFramebuffer:S}=B6(t),{gl:D,handle:N}=C;s||=C.width,l||=C.height;const U=C.colorAttachments[i]?.texture;if(!U)throw new Error(`Invalid framebuffer attachment ${i}`);h=U?.depth||1,A||=U?.glFormat||6408,b||=U?.glType||5121,o=uZ(o,b,A,s,l),b=b||tZ(o);const V=D.bindFramebuffer(36160,N);return D.readBuffer(36064+i),D.readPixels(r,n,s,l,A,b,o),D.readBuffer(36064),D.bindFramebuffer(36160,V||null),S&&C.destroy(),o}function lZ(t,e){const{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:l,sourceHeight:h,sourceType:A}=e||{};const{framebuffer:b,deleteFramebuffer:C}=B6(t);l=l||b.width,h=h||b.height;const S=b;A=A||5121;let D=r;if(!D){const U=C6(o),V=nZ(A),j=s+l*h*U*V;D=S.device.createBuffer({byteLength:j})}const N=t.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:t,width:l,height:h,origin:[n,i],destinationBuffer:D,byteOffset:s}),N.destroy(),C&&b.destroy(),D}function B6(t){return t instanceof Ey?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:cZ(t),deleteFramebuffer:!0}}function cZ(t,e){const{device:r,width:n,height:i,id:o}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[t]})}function uZ(t,e,r,n,i,o){if(t)return t;e||=5121;const s=rZ(e,{clamped:!1}),l=C6(r);return new s(n*i*l)}class fg extends oi{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,r){super(e,r);const n={...this.props};n.data=r.data,this.device=e,this.gl=this.device.gl,this.glTarget=oZ(this.props.dimension);const i=b6(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(n),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:r,height:n}=e;if(!r||!n){const i=oi.getTextureDataSize(e.data);r=i?.width||1,n=i?.height||1}if(this.width=r,this.height=n,this.depth=e.depth,this.setSampler(e.sampler),this.view=new hp(this.device,{...this.props,texture:this}),this.bind(),sZ(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new hp(this.device,{...e,texture:this})}setSampler(e={}){let r;e instanceof j2?(this.sampler=e,r=e.props):(this.sampler=new j2(this.device,e),r=e);const n=w6(r);this._setSamplerParameters(n)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Yt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){Yt.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const r=oi.getExternalImageSize(e.image),n={...oi.defaultCopyExternalImageOptions,...r,...e},{image:i,depth:o,mipLevel:s,x:l,y:h,z:A,flipY:b}=n;let{width:C,height:S}=n;const{dimension:D,glTarget:N,glFormat:U,glInternalFormat:V,glType:j}=this;if(C=Math.min(C,this.width-l),S=Math.min(S,this.height-h),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return SS(this.device.gl,this.handle,i,{dimension:D,mipLevel:s,x:l,y:h,z:A,width:C,height:S,depth:o,glFormat:U,glType:j,glTarget:N,flipY:b}),{width:n.width,height:n.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,r=0){this.bind();const n=oi.normalizeTextureData(e,this);n.length>1&&this.props.mipmaps!==!1&&Yt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const o=n[i];this._setMipLevel(r,i,o)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),IS(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of oi.CubeFaces)this.setTextureCubeFaceData(e[n],n)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,r,n=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Yt.warn(`${this.id} has mipmap and multiple LODs.`)();const i=oi.CubeFaces.indexOf(r);this.setTexture2DData(e,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:r,width:n,height:i,pixels:o,data:s,format:l=6408,type:h=5121}=e,{gl:A}=this,b=o||s;this.bind(),b instanceof Promise?b.then(C=>this.setImageDataForFace(Object.assign({},e,{face:r,data:C,pixels:C}))):this.width||this.height?A.texImage2D(r,0,l,n,i,0,l,h,b):A.texImage2D(r,0,l,l,h,b)}_getImageDataMap(e){for(let r=0;r<oi.CubeFaces.length;++r){const n=oi.CubeFaces[r];e[n]&&(e[34069+r]=e[n],delete e[n])}return e}_setSamplerParameters(e){Yt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,n]of Object.entries(e)){const i=Number(r),o=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;default:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,r,n,i=this.glTarget){if(oi.isExternalImage(n)){SS(this.device.gl,this.handle,n,{...this,depth:e,mipLevel:r,glTarget:i,flipY:this.props.flipY});return}if(oi.isTextureLevelData(n)){IS(this.device.gl,n.data,{...this,depth:e,mipLevel:r,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}}const hZ=[1,2,4,8];class fZ extends Kh{device;glParameters;constructor(e,r){super(e,r),this.device=e;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:i,height:o}=r.framebuffer;n=[0,0,i,o]}else{const[i,o]=e.getCanvasContext().getDrawingBufferSize();n=[0,0,i,o]}if(this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const i=this.props.framebuffer.colorAttachments.map((o,s)=>36064+s);this.device.gl.drawBuffers(i)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=hZ.map(n=>!!(n&e.colorMask))),this.glParameters=r,Yp(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&T_(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){T_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function dZ(t){return pZ.includes(t)}const pZ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],T6={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function S6(t){const e=T6[t];if(!e)throw new Error("uniform");const[r,n,,i]=e;return{format:i,components:n,glType:r}}function AZ(t){const e=T6[t];if(!e)throw new Error("attribute");const[,r,,n,i]=e;return{attributeType:n,vertexFormat:i,components:r}}function gZ(t,e){const r={attributes:[],bindings:[]};r.attributes=mZ(t,e);const n=bZ(t,e);for(const l of n){const h=l.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));r.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:h})}const i=yZ(t,e);let o=0;for(const l of i)if(dZ(l.type)){const{viewDimension:h,sampleType:A}=xZ(l.type);r.bindings.push({type:"texture",name:l.name,group:0,location:o,viewDimension:h,sampleType:A}),l.textureUnit=o,o+=1}i.length&&(r.uniforms=i);const s=_Z(t,e);return s?.length&&(r.varyings=s),r}function mZ(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=t.getActiveAttrib(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:l}=o,h=t.getAttribLocation(e,s);if(h>=0){const{attributeType:A}=AZ(l),b=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:h,stepMode:b,type:A})}}return r.sort((i,o)=>i.location-o.location),r}function _Z(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let i=0;i<n;i++){const o=t.getTransformFeedbackVarying(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:l,size:h}=o,{glType:A,components:b}=S6(l),C={location:i,name:s,type:A,size:h*b};r.push(C)}return r.sort((i,o)=>i.location-o.location),r}function yZ(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let i=0;i<n;i++){const o=t.getActiveUniform(e,i);if(!o)throw new Error("activeInfo");const{name:s,size:l,type:h}=o,{name:A,isArray:b}=wZ(s);let C=t.getUniformLocation(e,A);const S={location:C,name:A,size:l,type:h,isArray:b};if(r.push(S),S.size>1)for(let D=0;D<S.size;D++){const N=`${A}[${D}]`;C=t.getUniformLocation(e,N);const U={...S,name:N,location:C};r.push(U)}}return r}function bZ(t,e){const r=(o,s)=>t.getActiveUniformBlockParameter(e,o,s),n=[],i=t.getProgramParameter(e,35382);for(let o=0;o<i;o++){const s={name:t.getActiveUniformBlockName(e,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},l=r(o,35395)||[],h=t.getActiveUniforms(e,l,35383),A=t.getActiveUniforms(e,l,35384),b=t.getActiveUniforms(e,l,35387),C=t.getActiveUniforms(e,l,35388);for(let S=0;S<s.uniformCount;++S){const D=t.getActiveUniform(e,l[S]);if(!D)throw new Error("activeInfo");s.uniforms.push({name:D.name,format:S6(h[S]).format,type:h[S],arrayLength:A[S],byteOffset:b[S],byteStride:C[S]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}const vZ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function xZ(t){const e=vZ[t];if(!e)throw new Error("sampler");const[r,n]=e;return{viewDimension:r,sampleType:n}}function wZ(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function CZ(t,e,r,n){const i=t;let o=n;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,s);case 35664:return t.uniform2fv(e,s);case 35665:return t.uniform3fv(e,s);case 35666:return t.uniform4fv(e,s);case 5124:return t.uniform1iv(e,s);case 35667:return t.uniform2iv(e,s);case 35668:return t.uniform3iv(e,s);case 35669:return t.uniform4iv(e,s);case 35670:return t.uniform1iv(e,s);case 35671:return t.uniform2iv(e,s);case 35672:return t.uniform3iv(e,s);case 35673:return t.uniform4iv(e,s);case 5125:return i.uniform1uiv(e,s,1);case 36294:return i.uniform2uiv(e,s,2);case 36295:return i.uniform3uiv(e,s,3);case 36296:return i.uniform4uiv(e,s,4);case 35674:return t.uniformMatrix2fv(e,!1,s);case 35675:return t.uniformMatrix3fv(e,!1,s);case 35676:return t.uniformMatrix4fv(e,!1,s);case 35685:return i.uniformMatrix2x3fv(e,!1,s);case 35686:return i.uniformMatrix2x4fv(e,!1,s);case 35687:return i.uniformMatrix3x2fv(e,!1,s);case 35688:return i.uniformMatrix3x4fv(e,!1,s);case 35689:return i.uniformMatrix4x2fv(e,!1,s);case 35690:return i.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function EZ(t){return s6(t)!==null||typeof t=="number"||typeof t=="boolean"}function BZ(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];EZ(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}function TZ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function SZ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const MS=4;class IZ extends Lp{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Yt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=gZ(this.device.gl,this.handle),Yt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=MZ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(const[n,i]of Object.entries(e)){const o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){const s=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r?.disableWarnings||Yt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${s}`,i)();continue}switch(i||Yt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof hg)&&!(i.buffer instanceof hg))throw new Error("buffer value");break;case"texture":if(!(i instanceof hp||i instanceof fg||i instanceof ug))throw new Error("texture value");break;case"sampler":Yt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=i}}draw(e){const{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:l,isInstanced:h=!1,firstVertex:A=0,transformFeedback:b}=e,C=TZ(i),S=!!o.indexBuffer,D=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Yt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Yt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),b&&b.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const N=r;return XQ(this.device,n,N.glParameters,()=>{S&&h?this.device.gl.drawElementsInstanced(C,s||0,D,A,l||0):S?this.device.gl.drawElements(C,s||0,D,A):h?this.device.gl.drawArraysInstanced(C,A,s||0,l||0):this.device.gl.drawArrays(C,A,s||0),b&&b.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(e){const{bindings:r}=BZ(e);Object.keys(r).forEach(n=>{Yt.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Yt.time(MS,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Yt.timeEnd(MS,`linkProgram for ${this.id}`)(),Yt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Yt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Yt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${r}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async n=>await new Promise(i=>setTimeout(i,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Yt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,n=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:s}=i,l=e.getUniformBlockIndex(this.handle,s);if(l===4294967295)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,n,l),o instanceof hg?e.bindBufferBase(35345,n,o.handle):e.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof hp||o instanceof fg||o instanceof ug))throw new Error("texture");let h;if(o instanceof hp)h=o.texture;else if(o instanceof fg)h=o;else if(o instanceof ug&&o.colorAttachments[0]instanceof hp)Yt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:i,textureUnit:o}=e,s=this.uniforms[r]??o;s!==void 0&&CZ(this.device.gl,n,i,s)}}}function MZ(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Yt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class PZ extends Nw{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":LZ(this.device,r.options);break;case"copy-buffer-to-texture":RZ(this.device,r.options);break;case"copy-texture-to-buffer":OZ(this.device,r.options);break;case"copy-texture-to-texture":DZ(this.device,r.options);break;default:throw new Error(r.name)}}}function LZ(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function RZ(t,e){throw new Error("Not implemented")}function OZ(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:o=e.sourceTexture.width,height:s=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:h=[0,0],destinationBuffer:A,byteOffset:b=0,bytesPerRow:C,rowsPerImage:S}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||l!==0||C||S)throw new Error("not implemented");const{framebuffer:D,destroyFramebuffer:N}=I6(r);let U;try{const V=A,j=o||D.width,ee=s||D.height,Q=b6(D.colorAttachments[0].texture.props.format),X=Q.format,pe=Q.type;t.gl.bindBuffer(35051,V.handle),U=t.gl.bindFramebuffer(36160,D.handle),t.gl.readPixels(h[0],h[1],j,ee,X,pe,b)}finally{t.gl.bindBuffer(35051,null),U!==void 0&&t.gl.bindFramebuffer(36160,U),N&&D.destroy()}}function DZ(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=e;let{width:l=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:A,destroyFramebuffer:b}=I6(r),[C,S]=i,[D,N,U]=o,V=t.gl.bindFramebuffer(36160,A.handle);let j=null,ee;if(s instanceof fg)j=s,l=Number.isFinite(l)?l:j.width,h=Number.isFinite(h)?h:j.height,j.bind(0),ee=j.glTarget;else throw new Error("invalid destination");switch(ee){case 3553:case 34067:t.gl.copyTexSubImage2D(ee,n,D,N,C,S,l,h);break;case 35866:case 32879:t.gl.copyTexSubImage3D(ee,n,D,N,U,C,S,l,h);break}j&&j.unbind(),t.gl.bindFramebuffer(36160,V),b&&A.destroy()}function I6(t){if(t instanceof oi){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class FZ extends kw{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new PZ(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,n){}}function kZ(t){const{target:e,source:r,start:n=0,count:i=1}=t,o=r.length,s=i*o;let l=0;for(let h=n;l<o;l++)e[h++]=r[l];for(;l<s;)l<s-l?(e.copyWithin(n+l,n,n+l),l*=2):(e.copyWithin(n+l,n,n+s-l),l=s);return t.target}class AC extends Uw{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return Zz()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:s,offset:l,normalized:h,integer:A,divisor:b}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),A?this.device.gl.vertexAttribIPointer(e,i,o,s,l):this.device.gl.vertexAttribPointer(e,i,o,h,s,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,b||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const n=y6(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const n=AC.isConstantAttributeZeroSupported(this.device)||e!==0;(r||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const n=NZ(r),i=n.byteLength*e,o=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!UZ(n,this.bufferValue),s){const l=Uj(r.constructor,o);kZ({target:l,source:n,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function NZ(t){return Array.isArray(t)?new Float32Array(t):t}function UZ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class GZ extends Gw{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(SZ(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const n=this._getVaryingIndex(e),{buffer:i,byteLength:o,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[e]=i,Yt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:i,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,o)}getBuffer(e){if(PS(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof hg)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(PS(e))return Number(e);for(const r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,n=0,i){const o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,n,i)}}function PS(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class zZ extends zw{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{const o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class fp extends Xu{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||HQ("webgl-device")});const r=Xu._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new LQ(this,r),this.lost=new Promise(h=>{this._resolveContextLost=h});const i={...e.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const o=this.props._handle||fQ(this.canvasContext.canvas,{onContextLost:h=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:h=>console.log("WebGL context restored")},i);if(!o)throw new Error("WebGL context creation failed");if(n=o.device,n){if(e._reuseDevices)return Yt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=o,this.gl=o,this.spectorJS=DQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=dQ(this.gl,this._extensions),this.limits=new IQ(this.gl),this.features=new SQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new sf(this.gl,{log:(...h)=>Yt.log(1,...h)()}).trackState(this.gl,{copyState:!1});const s=e.debugWebGL||e.debug,l=e.debugWebGL;s&&(this.gl=NQ(this.gl,{debugWebGL:s,traceWebGL:l}),Yt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Yt.level=Math.max(Yt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._normalizeBufferProps(e);return new hg(this,r)}createTexture(e){return new fg(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new j2(this,e)}createShader(e){return new KQ(this,e)}createFramebuffer(e){return new ug(this,e)}createVertexArray(e){return new AC(this,e)}createTransformFeedback(e){return new GZ(this,e)}createQuerySet(e){return new zZ(this,e)}createRenderPipeline(e){return new IZ(this,e)}beginRenderPass(e){return new fZ(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new FZ(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return aZ(e,r)}readPixelsToBufferWebGL(e,r){return lZ(e,r)}setParametersWebGL(e){Yp(this.gl,e)}getParametersWebGL(e){return m6(this.gl,e)}withParametersWebGL(e,r){return T_(this.gl,e,r)}resetWebGL(){Yt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),aQ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return CQ(this.gl,e,this._extensions)}loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){sf.get(this.gl).push()}popState(){sf.get(this.gl).pop()}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){const r={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[i,o])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${o}:${this.getGLKey(o,r)}`,n),{})}_constants;setConstantAttributeWebGL(e,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&WZ(i,r)&&Yt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:jZ(this,e,r);break;case Int32Array:HZ(this,e,r);break;case Uint32Array:VZ(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return kp(this.gl,e,this._extensions),this._extensions}}function jZ(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function HZ(t,e,r){t.gl.vertexAttribI4iv(e,r)}function VZ(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function WZ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const JZ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},KZ=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),XZ=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),QZ=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function ZZ(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&$Z(i),i}return this.originalGetContext(r,n)}}function $Z(t){t.getExtension("EXT_color_buffer_float");const e={...JZ,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:KZ(t),OES_vertex_array_object:XZ(t),ANGLE_instanced_arrays:QZ(t)},r=t.getExtension;t.getExtension=function(i){return r.call(t,i)||(i in e?e[i]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(n.apply(t)||[])?.concat(Object.keys(e))}}const Ym=1;class qZ extends Aj{type="webgl";constructor(){super(),Xu.defaultProps={...Xu.defaultProps,...pC},fp.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){ZZ(e)}async attach(e){if(e instanceof fp)return e;if(e?.device instanceof Xu)return e.device;if(!YZ(e))throw new Error("Invalid WebGL2RenderingContext");return new fp({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Yt.groupCollapsed(Ym,"WebGLDevice created")();const r=[];(e.debugWebGL||e.debug)&&r.push(kQ()),e.debugSpectorJS&&r.push(OQ(e));const n=await Promise.allSettled(r);for(const s of n)s.status==="rejected"&&Yt.error(`Failed to initialize debug libraries ${s.reason}`)();const i=new fp(e),o=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return Yt.probe(Ym,o)(),Yt.table(Ym,i.info)(),Yt.groupEnd(Ym)(),i}}function YZ(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const LS=new qZ;function Nu(){}const e$=({isDragging:t})=>t?"grabbing":"grab",M6={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Nu,onWebGLInitialized:Nu,onResize:Nu,onViewStateChange:Nu,onInteractionStateChange:Nu,onBeforeRender:Nu,onAfterRender:Nu,onLoad:Nu,onError:t=>$r.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:e$,getTooltip:null,debug:!1,drawPickingColors:!1};class H2{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new f6({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=P2[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:h}=l,A=h&&(h[i]||h.props[i]),b=this.props[i];let C=!1;A&&(C=A.call(h,l,n)),C||(b?.(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...M6,...e},e=this.props,e.viewState&&e.initialViewState&&$r.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&$r.error("WebGL1 context not supported.")(),r=LS.attach(e.gl)),r||(r=v2.createDevice({type:"best-available",_reuseDevices:!0,adapters:[LS],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Dp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&$r.removed("onLayerHover","onHover")(),"onLayerClick"in e&&$r.removed("onLayerClick","onClick")(),e.initialViewState&&!es(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return r=r||n||i||o||s,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Ys(this.viewManager),this.viewManager.views}getViewports(e){return Ys(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,n){Ys(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Ys(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:i,useDevicePixels:o}=r;return new FK({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new p6({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let i=n,o=!1;for(const s of r)i=s,o=s.layer?.onHover(s,e.event)||o;o||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new i6;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new fJ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(KT).map(i=>{const[o,s,l,h]=KT[i],A=this.props.eventRecognizerOptions?.[i],b={...s,...A,event:i};return{recognizer:new o(b),recognizeWith:l,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in P2)this.eventManager.on(i,this._onEvent);this.viewManager=new TX({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new BX(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new HX({deck:this,device:this.device}),this.deckRenderer=new JX(this.device),this.deckPicker=new qX(this.device),this.widgetManager=new tQ({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new nQ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$r.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=v2.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}H2.defaultProps=M6,H2.VERSION=h7;function t$(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return KO(t)}}const r$=JO;function e0(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Zh(t){return t.stride||t.size*t.bytesPerElement}function n$(t,e){return t.type===e.type&&t.size===e.size&&Zh(t)===Zh(e)&&(t.offset||0)===(e.offset||0)}function V2(t,e){e.offset&&$r.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Zh(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,o=n*r+i*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:r}}function i$(t,e){const r=V2(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class s${constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const i=r.logicalType||r.type,o=i==="float64";let{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let l;o?l="float32":!i&&r.isIndexed?l="uint32":l=i||"float32";let h=t$(i||l);this.doublePrecision=o,o&&r.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...r,defaultType:h,defaultValue:s,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Zh(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Dp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const i=this.value;if(r){const o=V2(this.getAccessor(),r),s=o.offset/i.BYTES_PER_ELEMENT,l=o.size||this.size;n[e]=i.subarray(s,s+l)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),i=[],o={name:this.id,byteStride:Zh(n),attributes:i};if(this.doublePrecision){const s=i$(n,r||{});i.push(e0(e,{...n,...s.high},this.device.type),e0(`${e}64Low`,{...n,...s.low},this.device.type))}else if(r){const s=V2(n,r);i.push(e0(e,{...n,...s},this.device.type))}else i.push(e0(e,n,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){const s=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let h=0;h<o;)for(let A=0;A<i;A++){const b=r[h++];b<s[A]&&(s[A]=b),b>l[A]&&(l[A]=b)}e=[s,l]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ci?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const o=r$(n.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Zh(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this;const l=Zh(i),h=(i.vertexOffset||0)*l;if(this.doublePrecision&&o instanceof Float64Array&&(o=fv(o,i)),this.settings.isIndexed){const b=this.settings.defaultType;o.constructor!==b&&(o=new b(o))}const A=o.byteLength+h+l*2;(!s||s.byteLength<A)&&(s=this._createBuffer(A)),s.write(o,h)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?fv(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,i=n.allocatedValue,o=Dp.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;const{byteOffset:s}=this;let{buffer:l}=this;return(!l||l.byteLength<o.byteLength+s)&&(l=this._createBuffer(o.byteLength+s),r&&i&&l.write(i instanceof Float64Array?fv(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&$r.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let s=o;for(;--s>=0;)r[n+s]=i[s];return r}switch(o){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=o;for(;--s>=0;)r[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==r[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?Ci.INDEX:Ci.VERTEX)|Ci.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const RS=[],OS=[];function yc(t,e=0,r=1/0){let n=RS;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(OS.length=t.length,n=OS):n=RS,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),i.index=e-1),{iterable:n,objectInfo:i}}function P6(t){return t&&t[Symbol.asyncIterator]}function L6(t,e){const{size:r,stride:n,offset:i,startIndices:o,nested:s}=e,l=t.BYTES_PER_ELEMENT,h=n?n/l:r,A=i?i/l:0,b=Math.floor((t.length-A)/h);return(C,{index:S,target:D})=>{if(!o){const j=S*h+A;for(let ee=0;ee<r;ee++)D[ee]=t[j+ee];return D}const N=o[S],U=o[S+1]||b;let V;if(s){V=new Array(U-N);for(let j=N;j<U;j++){const ee=j*h+A;D=new Array(r);for(let Q=0;Q<r;Q++)D[Q]=t[ee+Q];V[j-N]=D}}else if(h===r)V=t.subarray(N*r+A,U*r+A);else{V=new t.constructor((U-N)*r);let j=0;for(let ee=N;ee<U;ee++){const Q=ee*h+A;for(let X=0;X<r;X++)V[j++]=t[Q+X]}}return V}}const o$=[],j0=[[0,1/0]];function a$(t,e){if(t===j0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let i=0;for(let o=0;o<n;o++){const s=t[o];s[1]<e[0]?(r.push(s),i=o+1):s[0]>e[1]?r.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return r.splice(i,0,e),r}const l$={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function R6(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...l$[r],...e,...t,type:r}}class O6 extends s${constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:j0}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!n$(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?e[r.find(o=>e[o])]:e[r];return R6(i,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=a$(this.state.updateRanges,[n,i])}else this.state.updateRanges=j0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=o$}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==j0),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:l}}=this;let h=!0;if(s){for(const[A,b]of o)s.call(i,this,{data:r,startRow:A,endRow:b,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,b]of o){const C=Number.isFinite(A)?this.getVertexOffset(A):0,S=Number.isFinite(b)?this.getVertexOffset(b):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:S})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ys(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const s=!!o.size&&o.size!==this.size;return n.binaryAccessor=L6(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:r,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(const o in r){const s=super._getBufferLayout(o,r[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:i,props:o,numInstances:s}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:h,value:A,size:b,startIndices:C}=e,{accessor:S,transform:D}=l;let N=h.binaryAccessor||(typeof S=="function"?S:o[S]);typeof N!="function"&&(N=()=>N),Ys(typeof N=="function",`accessor "${S}" is not a function`);let U=e.getVertexOffset(n);const{iterable:V,objectInfo:j}=yc(r,n,i);for(const ee of V){j.index++;let Q=N(ee,j);if(D&&(Q=D.call(this,Q)),C){const X=(j.index<C.length-1?C[j.index+1]:s)-C[j.index];if(Q&&Array.isArray(Q[0])){let pe=U;for(const Y of Q)e._normalizeValue(Y,A,pe),pe+=b}else Q&&Q.length>b?A.set(Q,U):(e._normalizeValue(Q,j.target,0),vX({target:A,source:j.target,start:U,count:X}));U+=X*b}else e._normalizeValue(Q,A,U),U+=b}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function xv(t){const{source:e,target:r,start:n=0,size:i,getData:o}=t,s=t.end||r.length,l=e.length,h=s-n;if(l>h){r.set(e.subarray(0,h),n);return}if(r.set(e,n),!o)return;let A=l;for(;A<h;){const b=o(A,e);for(let C=0;C<i;C++)r[n+A]=b[C]||0,A++}}function c$({source:t,target:e,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return xv({source:t,target:e,size:r,getData:n}),e;let s=0,l=0;const h=n&&((b,C)=>n(b+l,C)),A=Math.min(i.length,o.length);for(let b=1;b<A;b++){const C=i[b]*r,S=o[b]*r;xv({source:t.subarray(s,C),target:e,start:l,end:S,size:r,getData:h}),s=C,l=S}return l<e.length&&xv({source:[],target:e,start:l,size:r,getData:h}),e}function u$(t){const{device:e,settings:r,value:n}=t,i=new O6(e,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function D6(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function F6(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function k6(t){t.push(t.shift())}function h$(t,e){const{doublePrecision:r,settings:n,value:i,size:o}=t,s=r&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:h}=t.settings;if(h)for(const A of Object.values(h))l=Math.max(l,A.vertexOffset??0);return(n.noAlloc?i.length:(e+l)*o)*s}function N6({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function U6({device:t,buffer:e,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:s=l=>l}){const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,h=r.size*l,A=r.byteOffset,b=r.settings.bytesPerElement<4?A/r.settings.bytesPerElement*4:A,C=r.startIndices,S=o&&C,D=r.isConstant;if(!S&&e&&n>=i)return e;const N=r.value instanceof Float64Array?Float32Array:r.value.constructor,U=D?r.value:new N(r.getBuffer().readSyncWebGL(A,i*N.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!D){const Q=s;s=(X,pe)=>r.normalizeConstant(Q(X,pe))}const V=D?(Q,X)=>s(U,X):(Q,X)=>s(U.subarray(Q+A,Q+A+h),X),j=e?new Float32Array(e.readSyncWebGL(b,n*4).buffer):new Float32Array(0),ee=new Float32Array(i);return c$({source:j,target:ee,sourceStartIndices:o,targetStartIndices:C,size:h,getData:V}),(!e||e.byteLength<ee.byteLength+b)&&(e?.destroy(),e=t.createBuffer({byteLength:ee.byteLength+b,usage:35050})),e.write(ee,b),e}class G6{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Py(n),this.attribute=r,this.attributeInTransition=u$(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=h$(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class f$ extends G6{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=g$(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;k6(o),o[0]=U6({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),o[1]=N6({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:l}=this,h=l.model;let A=Math.floor(this.currentLength/s.size);z6(s)&&(A/=2),h.setVertexCount(A),s.isConstant?(h.setAttributes({aFrom:o[0]}),h.setConstantAttributes({aTo:s.value})):h.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let i=n/e;r&&(i=r(i));const{model:o}=this.transform,s={time:i};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const d$=`uniform interpolationUniforms {
  float time;
} interpolation;
`,DS={name:"interpolation",vs:d$,uniformTypes:{time:"f32"}},p$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,A$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function z6(t){return t.doublePrecision&&t.value instanceof Float64Array}function g$(t,e){const r=e.size,n=D6(r),i=F6(r),o=e.getBufferLayout();return z6(e)?new ff(t,{vs:A$,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[rW,DS],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ff(t,{vs:p$,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[DS],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class m$ extends G6{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=w$(e),this.framebuffer=C$(e,this.texture),this.transform=x$(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;super.start(e,r);const{buffers:o,attribute:s}=this;for(let h=0;h<2;h++)o[h]=U6({device:this.device,buffer:o[h],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});o[2]=N6({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?l.setConstantAttributes({aTo:s.value}):l.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:s}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),k6(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const _$=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,y$={name:"spring",vs:_$,uniformTypes:{damping:"f32",stiffness:"f32"}},b$=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,v$=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function x$(t,e){const r=D6(e.size),n=F6(e.size);return new ff(t,{vs:b$,fs:v$,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[y$],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function w$(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function C$(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const E$={interpolation:f$,spring:m$};class B${constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const i in e){const o=e[i],s=o.getTransitionSetting(r);s&&this._updateAttribute(i,o,s)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const i=this.transitions[e];let o=!i||i.type!==n.type;if(o){i&&this._removeTransition(e);const s=E$[n.type];s?this.transitions[e]=new s({attribute:r,timeline:this.timeline,device:this.device}):($r.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const FS="attributeManager.invalidate",T$="attributeManager.updateStart",S$="attributeManager.updateEnd",I$="attribute.updateStart",M$="attribute.allocate",P$="attribute.updateEnd";class Ly{constructor(e,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Kg(xK),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new B$(e,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);_o(FS,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);_o(FS,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:l={}}){let h=!1;_o(T$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const b=this.attributes[A],C=b.settings.accessor;b.startIndices=n,b.numInstances=r,o[A]&&$r.removed(`props.${A}`,`data.attributes.${A}`)(),b.setExternalBuffer(s[A])||b.setBinaryValue(typeof C=="string"?s[C]:void 0,e.startIndices)||typeof C=="string"&&!s[C]&&b.setConstantValue(o[C])||b.needsUpdate()&&(h=!0,this._updateAttribute({attribute:b,numInstances:r,data:e,props:o,context:l})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}h&&_o(S$,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const o in r){const s=r[o];s.needsRedraw(e)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const i=e[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new O6(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:i}=this,o=i[e];return o&&o.forEach(s=>{const l=n[s];l&&l.setNeedsUpdate(l.id,r)}),o}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(_o(I$,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&_o(M$,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,_o(P$,r,n))}}class L$ extends Py{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,s=o(e/i);this._value=El(r,n,s)}}const kS=1e-5;function NS(t,e,r,n,i){const o=e-t,s=(r-e)*i,l=-o*n;return s+l+o+e}function R$(t,e,r,n,i){if(Array.isArray(r)){const o=[];for(let s=0;s<r.length;s++)o[s]=NS(t[s],e[s],r[s],n,i);return o}return NS(t,e,r,n,i)}function US(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}class O$ extends Py{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let l=R$(o,s,r,n,i);const h=US(l,r),A=US(l,s);h<kS&&A<kS&&(l=r,this.end()),this._prevValue=s,this._currValue=l}}const D$={interpolation:L$,spring:O$};class F${constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,i){const{transitions:o}=this;if(o.has(e)){const h=o.get(e),{value:A=h.settings.fromValue}=h;r=A,this.remove(e)}if(i=R6(i),!i)return;const s=D$[i.type];if(!s){$r.error(`unsupported transition type '${i.type}'`)();return}const l=new s(this.timeline);l.start({...i,fromValue:r,toValue:n}),o.set(e,l)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function k$(t){const e=t[Zu];for(const r in e){const n=e[r],{validate:i}=n;if(i&&!i(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function N$(t,e){const r=gC({newProps:t,oldProps:e,propTypes:t[Zu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=G$(t,e);let i=!1;return n||(i=z$(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:j$(t,e),transitionsChanged:U$(t,e)}}function U$(t,e){if(!t.transitions)return!1;const r={},n=t[Zu];let i=!1;for(const o in t.transitions){const s=n[o],l=s&&s.type;(l==="number"||l==="color"||l==="array")&&W2(t[o],e[o],s)&&(r[o]=!0,i=!0)}return i?r:!1}function gC({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} added`;const s=W2(t[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}for(const o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){const s=W2(t[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function W2(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function G$(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:i}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}function z$(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&GS(t,e,"all"))return{all:!0};const r={};let n=!1;for(const i in t.updateTriggers)i!=="all"&&GS(t,e,i)&&(r[i]=!0,n=!0);return n?r:!1}function j$(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function GS(t,e,r){let n=t.updateTriggers[r];n=n??{};let i=e.updateTriggers[r];return i=i??{},gC({oldProps:i,newProps:n,triggerName:r})}const H$="count(): argument not an object",V$="count(): argument not a container";function W$(t){if(!K$(t))throw new Error(H$);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(J$(t))return Object.keys(t).length;throw new Error(V$)}function J$(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function K$(t){return t!==null&&typeof t=="object"}function zS(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];r.inject=n}return r}const X$={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},J2={};function Q$(t,e,r,n){if(r instanceof oi)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const o=e.createTexture({...r,sampler:{...X$,...i,...n},mipmaps:!0});return J2[o.id]=t,o}function Z$(t,e){!e||!(e instanceof oi)||J2[e.id]===t&&(e.delete(),delete J2[e.id])}const $$={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||K2(t)&&(t.length===3||t.length===4)},equal(t,e,r){return es(t,e,1)}},accessor:{validate(t,e){const r=S_(t);return r==="function"||r===S_(e.value)},equal(t,e,r){return typeof e=="function"?!0:es(t,e,1)}},array:{validate(t,e){return e.optional&&!t||K2(t)},equal(t,e,r){const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?es(t,e,i):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?es(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:Q$(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{Z$(r.id,t)}}};function q$(t){const e={},r={},n={};for(const[i,o]of Object.entries(t)){const s=o?.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{const l=Y$(i,o);e[i]=l,r[i]=l.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function Y$(t,e){switch(S_(e)){case"object":return GA(t,e);case"array":return GA(t,{type:"array",value:e,compare:!1});case"boolean":return GA(t,{type:"boolean",value:e});case"number":return GA(t,{type:"number",value:e});case"function":return GA(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function GA(t,e){return"type"in e?{name:t,...$$[e.type],...e}:"value"in e?{name:t,type:S_(e.value),...e}:{name:t,type:"object",value:e}}function K2(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function S_(t){return K2(t)?"array":t===null?"null":typeof t}function eq(t,e){let r;for(let o=e.length-1;o>=0;o--){const s=e[o];"extensions"in s&&(r=s.extensions)}const n=X2(t.constructor,r),i=Object.create(n);i[B_]=t,i[df]={},i[Wu]={};for(let o=0;o<e.length;++o){const s=e[o];for(const l in s)i[l]=s[l]}return Object.freeze(i),i}const tq="_mergedDefaultProps";function X2(t,e){if(!(t instanceof I_.constructor))return{};let r=tq;if(e)for(const n of e){const i=n.constructor;i&&(r+=`:${i.extensionName||i.name}`)}return j6(t,r)||(t[r]=rq(t,e||[]))}function rq(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),n=X2(r),i=j6(t,"defaultProps")||{},o=q$(i),s=Object.assign(Object.create(null),n,o.defaultProps),l=Object.assign(Object.create(null),n?.[Zu],o.propTypes),h=Object.assign(Object.create(null),n?.[mv],o.deprecatedProps);for(const A of e){const b=X2(A.constructor);b&&(Object.assign(s,b),Object.assign(l,b[Zu]),Object.assign(h,b[mv]))}return nq(s,t),sq(s,l),iq(s,h),s[Zu]=l,s[mv]=h,e.length===0&&!mC(t,"_propTypes")&&(t._propTypes=l),s}function nq(t,e){const r=aq(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function iq(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const i=`${this.id}: ${r}`;for(const o of e[r])mC(this,o)||(this[o]=n);$r.deprecated(i,e[r].join("/"))()}})}function sq(t,e){const r={},n={};for(const i in e){const o=e[i],{name:s,value:l}=o;o.async&&(r[s]=l,n[s]=oq(s))}t[xp]=r,t[df]={},Object.defineProperties(t,n)}function oq(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||P6(e)?this[df][t]=e:this[Wu][t]=e},get(){if(this[Wu]){if(t in this[Wu])return this[Wu][t]||this[xp][t];if(t in this[df]){const e=this[B_]&&this[B_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[xp][t]}}return this[xp][t]}}}function mC(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function j6(t,e){return mC(t,e)&&t[e]}function aq(t){const e=t.componentName;return e||$r.warn(`${t.name}.componentName not specified`)(),e||t.name}let lq=0;class I_{constructor(...e){this.props=eq(this,e),this.id=this.props.id,this.count=lq++}clone(e){const{props:r}=this,n={};for(const i in r[xp])i in r[Wu]?n[i]=r[Wu][i]:i in r[df]&&(n[i]=r[df][i]);return new this.constructor({...r,...n,...e})}}I_.componentName="Component",I_.defaultProps={};const cq=Object.freeze({});class uq{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||cq}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[B_]||this.component;const r=e[Wu]||{},n=e[df]||e,i=e[xp]||{};for(const o in r){const s=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(const o in n){const s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(P6(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let o=[],s=0;for await(const l of r){if(!this.component)return;const{dataTransform:h}=this.component.props;h?o=h(l,o):o=o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Zu];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class hq extends uq{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,i=n?.props.fetch;return i?i(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const fq="layer.changeFlag",dq="layer.initialize",pq="layer.update",Aq="layer.finalize",gq="layer.matched",jS=2**24-1,mq=Object.freeze([]),_q=Kg(({oldViewport:t,viewport:e})=>t.equals(e));let cl=new Uint8ClampedArray(0);const yq={data:{type:"data",value:mq,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:i,signal:o})=>{const{resourceManager:s}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i?.fetch,signal:o}});let l=s.contains(t);return!l&&!i&&(s.add({resourceId:t,data:A2(t,n),persistent:!1}),l=!0),l?s.subscribe({resourceId:t,onChange:h=>r.internalState?.reloadAsyncProp(e,h),consumerId:r.id,requestId:e}):A2(t,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Yr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Es extends I_{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ep.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ys(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=n6(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=qD(n,r.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,s]}unproject(e){return Ys(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Ys(this.internalState);const n=this.internalState.viewport||this.context.viewport;return SK(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Yr.DEFAULT||e===Yr.LNGLAT||e===Yr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Ys(e instanceof Uint8Array);const[r,n,i]=e;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:W$(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=zS(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=zS(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const i of n)r.invalidateAll(i);else r.invalidateAll();if(r){const{props:i}=e,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:l,instancePickingColors:h}=r.attributes,A=l||h;A&&(s&&A.constant&&(A.constant=!1,r.invalidate(A.id)),!A.value&&!s&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!_q({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor(cl.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>jS&&$r.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),cl=Dp.allocate(cl,r,{size:4,copy:!0,maxCount:Math.max(r,jS)});const i=Math.floor(cl.length/4),o=[0,0,0];for(let s=n;s<i;s++)this.encodePickingColor(s,o),cl[s*4+0]=o[0],cl[s*4+1]=o[1],cl[s*4+2]=o[2],cl[s*4+3]=0}e.value=cl.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){if(!Object.keys(r).length)return;if(n){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),r=l.getAttributes()}const i=e.userData?.excludeAttributes||{},o={},s={};for(const l in r){if(i[l])continue;const h=r[l].getValue();for(const A in h){const b=h[A];b instanceof Ci?r[l].settings.isIndexed?e.setIndexBuffer(b):o[A]=b:b&&(s[A]=b)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){const l=s.value,h=this.encodePickingColor(e);for(let A=0;A<r.length;A++){const b=o.getVertexOffset(A);l[b]===h[0]&&l[b+1]===h[1]&&l[b+2]===h[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;const o=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==cl.buffer&&(n.value=cl.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ys(!this.internalState),Ys(Number.isFinite(this.props.coordinateSystem)),_o(dq,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new hq({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($r.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new F$(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){_o(gq,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(_o(pq,this,e),!e)return;const r=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{const l=this._getUpdateParams(),h=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const b of this.props.extensions)b.updateState.call(this,l,b);this.setNeedsRedraw(),this._updateAttributes();const A=this.getModels()[0]!==h[0];this._postUpdate(l,A)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){_o(Aq,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:l}=this.props,h=l&&l(n)||[0,0];s.device instanceof fp&&s.device.setParametersWebGL({polygonOffset:h});for(const A of this.getModels())A.device.type==="webgpu"?A.setParameters({...A.parameters,...i}):A.setParameters(i);if(s.device instanceof fp)s.device.withParametersWebGL(i,()=>{const A={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(const b of this.props.extensions)b.draw.call(this,A,b);this.draw(A)});else{const A={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(const b of this.props.extensions)b.draw.call(this,A,b);this.draw(A)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const s=e[i],l=r[i];s&&Array.isArray(l)&&(r.dataChanged=Array.isArray(s)?l.concat(s):s,o=!0);default:r[i]||(r[i]=e[i],o=!0)}o&&_o(fq,this,i,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const n=N$(e,r);if(n.updateTriggersChanged)for(const i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){k$(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Ly(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:i}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:l,highlightColor:h}=n;if(r||i.autoHighlight!==s||i.highlightedObjectIndex!==l||i.highlightColor!==h){const A={};Array.isArray(h)&&(A.highlightColor=h),(r||i.autoHighlight!==s||l!==i.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(r=r||i,r)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Es.defaultProps=yq,Es.layerName="Layer";const bq="compositeLayer.renderLayers";class Bs extends Es{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||r}getSubLayerRow(e,r,n){return e.__source={parent:this,object:r,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,e(n.__source.object,r)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:h,highlightColor:A,coordinateSystem:b,coordinateOrigin:C,wrapLongitude:S,positionFormat:D,modelMatrix:N,extensions:U,fetch:V,operation:j,_subLayerProps:ee}=this.props,Q={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:h,highlightColor:A,coordinateSystem:b,coordinateOrigin:C,wrapLongitude:S,positionFormat:D,modelMatrix:N,extensions:U,fetch:V,operation:j},X=ee&&e.id&&ee[e.id],pe=X&&X.updateTriggers,Y=e.id||"sublayer";if(X){const Ge=this.props[Zu],ze=e.type?e.type._propTypes:{};for(const de in X){const ce=ze[de]||Ge[de];ce&&ce.type==="accessor"&&(X[de]=this.getSubLayerAccessor(X[de]))}}Object.assign(Q,e,X),Q.id=`${this.props.id}-${Y}`,Q.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...pe};for(const Ge of U){const ze=Ge.getSubLayerProps.call(this,Ge);ze&&Object.assign(Q,ze,{updateTriggers:Object.assign(Q.updateTriggers,ze.updateTriggers)})}return Q}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const o=this.renderLayers();n=My(o,Boolean),this.internalState.subLayers=n}_o(bq,this,i,n);for(const o of n)o.parent=this}}Bs.layerName="CompositeLayer";const t0=Math.PI/180,HS=180/Math.PI,H0=6370972,dp=256;function vq(){const t=dp/H0,e=Math.PI/180*dp;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class xq extends ou{constructor(e={}){const{longitude:r=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:o=1,resolution:s=10}=e;let{latitude:l=0,height:h,altitude:A=1.5,fovy:b}=e;l=Math.max(Math.min(l,ap),-ap),h=h||1,b?A=aC(b):b=Tg(A);const C=1/Math.PI/Math.cos(l*Math.PI/180),S=Math.pow(2,n)*C,D=e.nearZ??i,N=e.farZ??(A+dp*2*S/h)*o,U=new bn().lookAt({eye:[0,-A,0],up:[0,0,1]});U.rotateX(l*t0),U.rotateZ(-r*t0),U.scale(S/h),super({...e,height:h,viewMatrix:U,longitude:r,latitude:l,zoom:n,distanceScales:vq(),fovy:b,focalDistance:A,near:D,far:N}),this.scale=S,this.latitude=l,this.longitude=r,this.resolution=s}get projectionMode(){return da.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,this.height/2],r),i=this.unproject([this.width/2,0],r),o=this.unproject([this.width,this.height/2],r),s=this.unproject([this.width/2,this.height],r);return o[0]<this.longitude&&(o[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],o[0],i[0],s[0]),Math.min(n[1],o[1],i[1],s[1]),Math.max(n[0],o[0],i[0],s[0]),Math.max(n[1],o[1],i[1],s[1])]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,o,s]=e,l=r?o:this.height-o,{pixelUnprojectionMatrix:h}=this;let A;if(Number.isFinite(s))A=wv(h,[i,l,s,1]);else{const D=wv(h,[i,l,-1,1]),N=wv(h,[i,l,1,1]),U=((n||0)/H0+1)*dp,V=iv(ED([],D,N)),j=iv(D),ee=iv(N),Q=4*((4*j*ee-(V-j-ee)**2)/16)/V,X=Math.sqrt(j-Q),pe=Math.sqrt(Math.max(0,U*U-Q)),Y=(X-pe)/Math.sqrt(V);A=VH([],D,N,Y)}const[b,C,S]=this.unprojectPosition(A);return Number.isFinite(s)?[b,C,S]:Number.isFinite(n)?[b,C,n]:[b,C]}projectPosition(e){const[r,n,i=0]=e,o=r*t0,s=n*t0,l=Math.cos(s),h=(i/H0+1)*dp;return[Math.sin(o)*l*h,-Math.cos(o)*l*h,Math.sin(s)*h]}unprojectPosition(e){const[r,n,i]=e,o=BD(e),s=Math.asin(i/o),l=Math.atan2(r,-n)*HS,h=s*HS,A=(o/dp-1)*H0;return[l,h,A]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){const n=this.unproject(r);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function wv(t,e){const r=qp([],e,t);return nC(r,r,1/r[3]),r}class M_{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&es(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:r}=e.constructor,n={updateTriggers:{}};for(const i in r)if(i in this.props){const o=r[i],s=this.props[i];n[i]=s,o&&o.type==="accessor"&&(n.updateTriggers[i]=this.props.updateTriggers[i],typeof s=="function"&&(n[i]=this.getSubLayerAccessor(s)))}return n}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}}M_.defaultProps={},M_.extensionName="LayerExtension";class H6{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=Dp,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:n={},getGeometry:i,geometryBuffer:o,positionFormat:s,dataChanged:l,normalize:h=!0}=this.opts;if(this.data=r,this.getGeometry=i,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=n,this.normalize=h,o&&(Ys(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),h||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(l))for(const A of l)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?L6(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:n,buffers:i,_attributeDefs:o,typedArrayManager:s}=this;for(const l in o)if(l in i)s.release(n[l]),n[l]=null;else{const h=o[l];h.copy=r,n[l]=s.allocate(n[l],e,h)}}_forEachGeometry(e,r,n){const{data:i,getGeometry:o}=this,{iterable:s,objectInfo:l}=yc(i,r,n);for(const h of s){l.index++;const A=o?o(h,l):null;e(A,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:i}=this;const{data:o,geometryBuffer:s}=this,{startRow:l=0,endRow:h=1/0}=e||{},A={};if(e||(r=[0],n=[0]),this.normalize||!s)this._forEachGeometry((C,S)=>{const D=C&&this.normalizeGeometry(C);A[S]=D,n[S+1]=n[S]+(D?this.getGeometrySize(D):0)},l,h),i=n[n.length-1];else if(n=o.startIndices,i=n[o.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Ci){const C=this.positionSize*4;i=i||s.byteLength/C}else if(s.buffer){const C=s.stride||this.positionSize*4;i=i||s.buffer.byteLength/C}else if(s.value){const C=s.value,S=s.stride/C.BYTES_PER_ELEMENT||this.positionSize;i=i||C.length/S}this._allocate(i,!!e),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;const b={};this._forEachGeometry((C,S)=>{const D=A[S]||C;b.vertexStart=n[S],b.indexStart=r[S];const N=S<n.length-1?n[S+1]:i;b.geometrySize=N-n[S],b.geometryIndex=S,this.updateGeometryAttributes(D,b)},l,h),this.vertexCount=r[r.length-1]}}const wq=typeof window<"u"?Tt.useLayoutEffect:Tt.useEffect;function P_(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const Cq={position:"absolute",zIndex:-1};function V6(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(r=>V6(r,e));if(Ry(t)){if(Eq(t))return e.style=Cq,Tt.cloneElement(t,e);if(Bq(t))return Tt.cloneElement(t,e)}return t}function Ry(t){return t&&typeof t=="object"&&"type"in t||!1}function Eq(t){return t.props?.mapStyle}function Bq(t){const e=t.type;return e&&e.deckGLViewProps}function Q2(t){if(typeof t=="function")return Tt.createElement(Fp,{},t);if(Array.isArray(t))return t.map(Q2);if(Ry(t)){if(t.type===Tt.Fragment)return Q2(t.props.children);if(P_(t.type,Fp))return t}return t}function Tq({children:t,layers:e=[],views:r=null}){const n=[],i=[],o={};return Tt.Children.forEach(Q2(t),s=>{if(Ry(s)){const l=s.type;if(P_(l,Es)){const h=Sq(l,s.props);i.push(h)}else n.push(s);if(P_(l,Fp)&&l!==Fp&&s.props.id){const h=new l(s.props);o[h.id]=h}}else s&&n.push(s)}),Object.keys(o).length>0&&(Array.isArray(r)?r.forEach(s=>{o[s.id]=s}):r&&(o[r.id]=r),r=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:r}}function Sq(t,e){const r={},n=t.defaultProps||{};for(const i in e)n[i]!==e[i]&&(r[i]=e[i]);return new t(r)}const Iq=Tt.createContext();function Mq({children:t,deck:e,ContextProvider:r=Iq.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},o=n.views[0].id;for(const s of t){let l=o,h=s;Ry(s)&&P_(s.type,Fp)&&(l=s.props.id||o,h=s.props.children);const A=n.getViewport(l),b=n.getViewState(l);if(A){b.padding=A.padding;const{x:C,y:S,width:D,height:N}=A;h=V6(h,{x:C,y:S,width:D,height:N,viewport:A,viewState:b}),i[l]||(i[l]={viewport:A,children:[]}),i[l].children.push(h)}}return Object.keys(i).map(s=>{const{viewport:l,children:h}=i[s],{x:A,y:b,width:C,height:S}=l,D={position:"absolute",left:A,top:b,width:C,height:S},N=`view-${s}`,U=Tt.createElement("div",{key:N,id:N,style:D},...h),V={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:ee=>{ee.viewId=s,e._onViewStateChange(ee)},widgets:[]},j=`view-${s}-context`;return Tt.createElement(r,{key:j,value:V},U)})}const Pq={mixBlendMode:null};function Lq({width:t,height:e,style:r}){const n={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(r)for(const o in r)o in Pq?i[o]=r[o]:n[o]=r[o];return{containerStyle:n,canvasStyle:i}}function Rq(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function W6(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Oq(t,e,r){const n=new e({...r,_customRender:r.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{t.redrawReason=i;const o=n.getViewports();t.lastRenderedViewports!==o?t.forceUpdate():W6(t)}});return n}function Dq(t,e){const[r,n]=Tt.useState(0),i=Tt.useRef({control:null,version:r,forceUpdate:()=>n(X=>X+1)}).current,o=Tt.useRef(null),s=Tt.useRef(null),l=Tt.useMemo(()=>Tq(t),[t.layers,t.views,t.children]);let h=!0;const A=X=>h&&t.viewState?(i.viewStateUpdateRequested=X,null):(i.viewStateUpdateRequested=null,t.onViewStateChange?.(X)),b=X=>{h?i.interactionStateUpdateRequested=X:(i.interactionStateUpdateRequested=null,t.onInteractionStateChange?.(X))},C=Tt.useMemo(()=>{const X={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:s.current,layers:l.layers,views:l.views,onViewStateChange:A,onInteractionStateChange:b};return delete X._customRender,i.deck&&i.deck.setProps(X),X},[t]);Tt.useEffect(()=>{const X=t.Deck||H2;return i.deck=Oq(i,X,{...C,parent:o.current,canvas:s.current}),()=>i.deck?.finalize()},[]),wq(()=>{W6(i);const{viewStateUpdateRequested:X,interactionStateUpdateRequested:pe}=i;X&&A(X),pe&&b(pe)}),Tt.useImperativeHandle(e,()=>Rq(i),[]);const S=i.deck&&i.deck.isInitialized?i.deck.getViewports():void 0,{ContextProvider:D,width:N="100%",height:U="100%",id:V,style:j}=t,{containerStyle:ee,canvasStyle:Q}=Tt.useMemo(()=>Lq({width:N,height:U,style:j}),[N,U,j]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===S||i.version!==r){i.lastRenderedViewports=S,i.version=r;const X=Mq({children:l.children,deck:i.deck,ContextProvider:D}),pe=Tt.createElement("canvas",{key:"canvas",id:V||"deckgl-overlay",ref:s,style:Q});i.control=Tt.createElement("div",{id:`${V||"deckgl"}-wrapper`,ref:o,style:ee},[pe,X])}return h=!1,i.control}const Fq=Tt.forwardRef(Dq);function VS(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const J6=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),WS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);WS&&parseFloat(WS[1]);const JS=globalThis,KS=globalThis.process||{};function kq(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function _C(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||kq()}const K6="4.0.7";function Nq(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class Uq{constructor(e,r,n="sessionStorage"){this.storage=Nq(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function Gq(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function zq(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var L_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(L_||(L_={}));const jq=10;function XS(t){return typeof t!="string"?t:(t=t.toUpperCase(),L_[t]||L_.WHITE)}function Hq(t,e,r){return!_C&&typeof t=="string"&&(e&&(t=`\x1B[${XS(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${XS(r)+jq}m${t}\x1B[49m`)),t}function Vq(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(l=>o===l)||(i[o]=s.bind(t)))}}function yC(t,e){if(!t)throw new Error("Assertion failed")}function Pd(){let t;if(_C()&&JS.performance)t=JS?.performance?.now?.();else if("hrtime"in KS){const e=KS?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Ld={debug:_C()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Wq={enabled:!0,level:0};function Rd(){}const QS={},ZS={once:!0};class Oy{constructor({id:e}={id:""}){this.VERSION=K6,this._startTs=Pd(),this._deltaTs=Pd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Uq(`__probe-${this.id}__`,Wq),this.timeStamp(`${this.id} started`),Vq(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Pd()-this._startTs).toPrecision(10))}getDelta(){return Number((Pd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ld.warn,arguments,ZS)}error(e){return this._getLogFunction(0,e,Ld.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,Ld.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,Ld.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,Ld.debug||Ld.info,arguments,ZS)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||Rd,n&&[n],{tag:Kq(r)}):Rd}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Rd)}group(e,r,n={collapsed:!1}){const i=$S({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Rd)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=X6(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=$S({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,yC(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Pd();const s=o.tag||o.message;if(o.once&&s)if(!QS[s])QS[s]=Pd();else return Rd;return r=Jq(this.id,o.message,o),n.bind(console,r,...o.args)}return Rd}}Oy.VERSION=K6;function X6(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return yC(Number.isFinite(e)&&e>=0),e}function $S(t){const{logLevel:e,message:r}=t;t.logLevel=X6(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return yC(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function Jq(t,e,r){if(typeof e=="string"){const n=r.time?zq(Gq(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=Hq(e,r.color,r.background)}return e}function Kq(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}globalThis.probe={};const Q6=new Oy({id:"@probe.gl/log"}),Cv="4.3.3",Xq=Cv[0]>="0"&&Cv[0]<="9"?`v${Cv}`:"";function Qq(){const t=new Oy({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=Xq,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const Zq=Qq();function $q(t,e){return Z6(t||{},e)}function Z6(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=Z6(n[i]||{},e[i],r+1):n[i]=e[i];return n}const qq="latest";function Yq(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const eY=Yq();function eh(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const af=typeof process!="object"||String(process)!=="[object process]"||process.browser,tY=typeof window<"u"&&typeof window.orientation<"u",qS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);qS&&parseFloat(qS[1]);class rY{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){eh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){eh(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ev{terminate(){}}const Bv=new Map;function nY(t){eh(t.source&&!t.url||!t.source&&t.url);let e=Bv.get(t.source||t.url);return e||(t.url&&(e=iY(t.url),Bv.set(t.url,e)),t.source&&(e=$6(t.source),Bv.set(t.source,e))),eh(e),e}function iY(t){if(!t.startsWith("http"))return t;const e=sY(t);return $6(e)}function $6(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function sY(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function q6(t,e=!0,r){const n=r||new Set;if(t){if(YS(t))n.add(t);else if(YS(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)&&e&&typeof t=="object")for(const i in t)q6(t[i],e,n)}return r===void 0?Array.from(n):[]}function YS(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Tv=()=>{};class Z2{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&af||typeof Ev<"u"&&!af}constructor(e){const{name:r,source:n,url:i}=e;eh(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=Tv,this.onError=o=>console.log(o),this.worker=af?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Tv,this.onError=Tv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||q6(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=nY({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ev(r,{eval:!1})}else if(this.source)e=new Ev(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class oY{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Z2.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new rY(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!af||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Z2({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return tY?this.maxMobileConcurrency:this.maxConcurrency}}const aY={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Hu{props;workerPools=new Map;static _workerFarm;static isSupported(){return Z2.isSupported()}static getWorkerFarm(e={}){return Hu._workerFarm=Hu._workerFarm||new Hu({}),Hu._workerFarm.setProps(e),Hu._workerFarm}constructor(e){this.props={...aY},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let o=this.workerPools.get(r);return o||(o=new oY({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function lY(t,e={}){const r=e[t.id]||{},n=af?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(af?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let o=t.version;o==="latest"&&(o=qq);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${s}/dist/${n}`}return eh(i),i}function cY(t,e=eY){eh(t,"no worker provided");const r=t.version;return!(!e||!r)}function uY(t,e){return!Hu.isSupported()||!af&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function hY(t,e,r,n,i){const o=t.id,s=lY(t,r),l=Hu.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const h=await l.startJob("process-on-worker",fY.bind(null,i));return h.postMessage("process",{input:e,options:r,context:n}),await(await h.result).result}async function fY(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const l=await t(o,s);e.postMessage("done",{id:i,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:h})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function dY(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function pY(...t){return AY(t)}function AY(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function gY(t){const e=[];for await(const r of t)e.push(r);return pY(...e)}function eI(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class tI{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Y6{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof tI?i=e:i=new tI(r,n),this.stats[r]=i),i}}let mY="";const rI={};function _Y(t){for(const e in rI)if(t.startsWith(e)){const r=rI[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${mY}${t}`),t}function yY(t){return t&&typeof t=="object"&&t.isBuffer}function eF(t){if(yY(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function tF(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function bY(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const vY=t=>typeof t=="boolean",dg=t=>typeof t=="function",Xg=t=>t!==null&&typeof t=="object",nI=t=>Xg(t)&&t.constructor==={}.constructor,xY=t=>!!t&&typeof t[Symbol.iterator]=="function",wY=t=>t&&typeof t[Symbol.asyncIterator]=="function",Cf=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ef=t=>typeof Blob<"u"&&t instanceof Blob,CY=t=>t&&typeof t=="object"&&t.isBuffer,EY=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Xg(t)&&dg(t.tee)&&dg(t.cancel)&&dg(t.getReader),BY=t=>Xg(t)&&dg(t.read)&&dg(t.pipe)&&vY(t.readable),rF=t=>EY(t)||BY(t);class TY extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const SY=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,IY=/^([-\w.]+\/[-\w.+]+)/;function iI(t,e){return t.toLowerCase()===e.toLowerCase()}function MY(t){const e=IY.exec(t);return e?e[1]:t}function sI(t){const e=SY.exec(t);return e?e[1]:""}const nF=/\?.*/;function PY(t){const e=t.match(nF);return e&&e[0]}function bC(t){return t.replace(nF,"")}function LY(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Dy(t){return Cf(t)?t.url:Ef(t)?t.name||"":typeof t=="string"?t:""}function vC(t){if(Cf(t)){const e=t,r=e.headers.get("content-type")||"",n=bC(e.url);return MY(r)||sI(n)}return Ef(t)?t.type||"":typeof t=="string"?sI(t):""}function RY(t){return Cf(t)?t.headers["content-length"]||-1:Ef(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function iF(t){if(Cf(t))return t;const e={},r=RY(t);r>=0&&(e["content-length"]=String(r));const n=Dy(t),i=vC(t);i&&(e["content-type"]=i);const o=await FY(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function OY(t){if(!t.ok)throw await DY(t)}async function DY(t){const e=LY(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&i?.includes("application/json")?await t.json():await t.text()}catch{}return new TY(r,n)}async function FY(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=i=>r(i?.target?.result),n.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return`data:base64,${kY(e)}`}return null}function kY(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function NY(t){return!UY(t)&&!GY(t)}function UY(t){return t.startsWith("http:")||t.startsWith("https:")}function GY(t){return t.startsWith("data:")}async function oI(t,e){if(typeof t=="string"){const r=_Y(t);return NY(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await iF(t)}const aI=new Oy({id:"loaders.gl"});class zY{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class jY{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const sF={fetch:null,mimeType:void 0,nothrow:!1,log:new jY,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:J6,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},HY={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function oF(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function aF(){const t=oF();return t.globalOptions=t.globalOptions||{...sF},t.globalOptions}function VY(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],WY(t,r),KY(e,t,n)}function WY(t,e){lI(t,null,sF,HY,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};lI(n,r.id,i,o,e)}}function lI(t,e,r,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const l in t){const h=!e&&Xg(t[l]),A=l==="baseUri"&&!e,b=l==="workerUrl"&&e;if(!(l in r)&&!A&&!b){if(l in n)aI.warn(`${o} loader option '${s}${l}' no longer supported, use '${n[l]}'`)();else if(!h){const C=JY(l,i);aI.warn(`${o} loader option '${s}${l}' not recognized. ${C}`)()}}}}function JY(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(t===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function KY(t,e,r){const n={...t.options||{}};return XY(n,r),n.log===null&&(n.log=new zY),cI(n,aF()),cI(n,e),n}function cI(t,e){for(const r in e)if(r in e){const n=e[r];nI(n)&&nI(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function XY(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function xC(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function wC(t){VS(t,"null loader"),VS(xC(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const lF=()=>{const t=oF();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Qg(t){const e=lF();t=Array.isArray(t)?t:[t];for(const r of t){const n=wC(r);e.find(i=>n===i)||e.unshift(n)}}function QY(){return lF()}const ZY=/\.([^.]+)$/;async function $Y(t,e=[],r,n){if(!cF(t))return null;let i=uI(t,e,{...r,nothrow:!0},n);if(i)return i;if(Ef(t)&&(t=await t.slice(0,10).arrayBuffer(),i=uI(t,e,r,n)),!i&&!r?.nothrow)throw new Error(uF(t));return i}function uI(t,e=[],r,n){if(!cF(t))return null;if(e&&!Array.isArray(e))return wC(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...QY()),YY(i);const o=qY(t,i,r,n);if(!o&&!r?.nothrow)throw new Error(uF(t));return o}function qY(t,e,r,n){const i=Dy(t),o=vC(t),s=bC(i)||n?.url;let l=null,h="";return r?.mimeType&&(l=Sv(e,r?.mimeType),h=`match forced by supplied MIME type ${r?.mimeType}`),l=l||eee(e,s),h=h||(l?`matched url ${s}`:""),l=l||Sv(e,o),h=h||(l?`matched MIME type ${o}`:""),l=l||ree(e,t),h=h||(l?`matched initial data ${hF(t)}`:""),r?.fallbackMimeType&&(l=l||Sv(e,r?.fallbackMimeType),h=h||(l?`matched fallback MIME type ${o}`:"")),h&&Zq.log(1,`selectLoader selected ${l?.name}: ${h}.`),l}function cF(t){return!(t instanceof Response&&t.status===204)}function uF(t){const e=Dy(t),r=vC(t);let n="No valid loader found (";n+=e?`${tF(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?hF(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function YY(t){for(const e of t)wC(e)}function eee(t,e){const r=e&&ZY.exec(e),n=r&&r[1];return n?tee(t,n):null}function tee(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function Sv(t,e){for(const r of t)if(r.mimeTypes?.some(n=>iI(e,n))||iI(e,`application/x.${r.id}`))return r;return null}function ree(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(nee(e,r))return r}else if(ArrayBuffer.isView(e)){if(hI(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&hI(e,0,r))return r;return null}function nee(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function hI(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>iee(t,e,r,n))}function iee(t,e,r,n){if(n instanceof ArrayBuffer)return dY(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=$2(t,e,n.length);return n===i;default:return!1}}function hF(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?$2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?$2(t,0,e):""}function $2(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const see=256*1024;function*oee(t,e){const r=e?.chunkSize||see;let n=0;const i=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,r),s=t.slice(n,n+o);n+=o,yield i.encode(s)}}const aee=256*1024;function*lee(t,e={}){const{chunkSize:r=aee}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(t,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const cee=1024*1024;async function*uee(t,e){const r=e?.chunkSize||cee;let n=0;for(;n<t.size;){const i=n+r,o=await t.slice(n,i).arrayBuffer();n=i,yield o}}function fI(t,e){return J6?hee(t,e):fee(t)}async function*hee(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:o,value:s}=await i;if(o)return;yield eF(s)}}catch{r.releaseLock()}}async function*fee(t,e){for await(const r of t)yield eF(r)}function dee(t,e){if(typeof t=="string")return oee(t,e);if(t instanceof ArrayBuffer)return lee(t,e);if(Ef(t))return uee(t,e);if(rF(t))return fI(t,e);if(Cf(t))return fI(t.body,e);throw new Error("makeIterator")}const fF="Cannot convert supplied data type";function pee(t,e,r){if(e.text&&typeof t=="string")return t;if(CY(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(fF)}async function Aee(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return pee(t,e);if(Ef(t)&&(t=await iF(t)),Cf(t)){const i=t;return await OY(i),e.binary?await i.arrayBuffer():await i.text()}if(rF(t)&&(t=dee(t,r)),xY(t)||wY(t))return gY(t);throw new Error(fF)}function dF(t,e){const r=aF(),n=t||r;return typeof n.fetch=="function"?n.fetch:Xg(n.fetch)?i=>oI(i,n.fetch):e?.fetch?e?.fetch:oI}function gee(t,e,r){if(r)return r;const n={fetch:dF(e,t),...t};if(n.url){const i=bC(n.url);n.baseUrl=i,n.queryString=PY(n.url),n.filename=tF(i),n.baseUrl=bY(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function mee(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function R_(t,e,r,n){e&&!Array.isArray(e)&&!xC(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=Dy(t),o=mee(e,n),s=await $Y(t,o,r);return s?(r=VY(r,s,o,i),n=gee({url:i,_parse:R_,loaders:o},r,n||null),await _ee(s,t,r,n)):null}async function _ee(t,e,r,n){if(cY(t),r=$q(t.options,r),Cf(e)){const o=e,{ok:s,redirected:l,status:h,statusText:A,type:b,url:C}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:l,status:h,statusText:A,type:b,url:C}}e=await Aee(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(uY(t,r))return await hY(t,e,r,n,R_);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw eh(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function eA(t,e,r,n){let i,o;!Array.isArray(e)&&!xC(e)?(i=[],o=e):(i=e,o=r);const s=dF(o);let l=t;return typeof t=="string"&&(l=await s(t)),Ef(t)&&(l=await s(t)),Array.isArray(i)?await R_(l,i,o):await R_(l,i,o)}const dI=100;class yee{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(e,r){if(this.options=r,this.schema=e,!Array.isArray(e)){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="array-row-table",this.rows=this.rows||new Array(dI),this.rows[this.length]=e,this.length++}addObjectRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="object-row-table",this.rows=this.rows||new Array(dI),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function pF(t,e){if(!t)throw new Error("null row");const r={};if(e)for(let n=0;n<e.length;n++)r[e[n]]=t[n];else for(let n=0;n<t.length;n++){const i=`column-${n}`;r[i]=t[n]}return r}function AF(t,e){if(!t)throw new Error("null row");if(e){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=t[e[n]];return r}return Object.values(t)}function bee(t){const e=[];for(let r=0;r<t.length;r++){const n=`column-${r}`;e.push(n)}return e}function vee(t){return Object.keys(t)}const pI=100;class xee{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(e,r){if(this.options=r,this.schema=e,e){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=bee(e),this.options.shape){case"object-row-table":const n=pF(e,this._headers);this.addObjectRow(n,r);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(pI),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=vee(e),this.options.shape){case"array-row-table":const n=AF(e,this._headers);this.addArrayRow(n,r);break;case"object-row-table":this.objectRows=this.objectRows||new Array(pI),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const wee=100;class Cee{schema;length=0;allocated=0;columns={};constructor(e,r){this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let r=0;for(const n in this.columns)this.columns[n][this.length]=e[r++];this.length++}addObjectRow(e){this._reallocateColumns();for(const r in e)this.columns[r][this.length]=e[r];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const r in this.schema){const n=this.schema[r];e[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:wee,this.columns={};for(const e in this.schema){const r=this.schema[e],n=r.type||Float32Array,i=this.columns[r.index];if(i&&ArrayBuffer.isView(i)){const o=new n(this.allocated);o.set(i),this.columns[r.index]=o}else i?(i.length=this.allocated,this.columns[r.index]=i):this.columns[r.index]=new n(this.allocated)}}}_pruneColumns(){for(const[e,r]of Object.entries(this.columns))this.columns[e]=r.slice(0,this.length)}}const Eee={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},Bee="TableBatchBuilder";class O_{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(e,r){this.schema=e,this.options={...Eee,...r}}limitReached(){return!!(this.options?.limit&&this.totalLength>=this.options.limit||this.options?._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e?.bytesUsed&&(this.bytesUsed=e.bytesUsed);const r=this.aggregator.getBatch();return r.count=this.batchCount,r.bytesUsed=this.bytesUsed,Object.assign(r,e),this.batchCount++,this.aggregator=null,r}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return xee;case"columnar-table":return Cee;case"arrow-table":if(!O_.ArrowBatch)throw new Error(Bee);return O_.ArrowBatch;default:return yee}}}class AI extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class Tee{_values;_settlers;_closed;constructor(){this._values=new AI,this._settlers=new AI,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const r=this._settlers.dequeue();e instanceof Error?r.reject(e):r.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,r)=>{this._settlers.enqueue({resolve:e,reject:r})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const gI="\uFEFF";function See(t,e={},r=Mee){e=e||{};var n=e.dynamicTyping||!1;xl(n)&&(e.dynamicTypingFunction=n,n={}),e.dynamicTyping=n,e.transform=xl(e.transform)?e.transform:!1;var i=new r(e);return i.stream(t)}function Iee(t,e){var r=!1,n=!0,i=",",o=`\r
`,s='"',l=s+s,h=!1,A=null;C();var b=new RegExp(Ig(s),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return S(null,t,h);if(typeof t[0]=="object")return S(A||Object.keys(t[0]),t,h)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:Object.keys(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),S(t.fields||[],t.data||[],h);throw new Error("Unable to serialize unrecognized input");function C(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!Ua.BAD_DELIMITERS.filter(function(U){return e.delimiter.indexOf(U)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(r=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(h=e.skipEmptyLines),typeof e.newline=="string"&&(o=e.newline),typeof e.quoteChar=="string"&&(s=e.quoteChar),typeof e.header=="boolean"&&(n=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");A=e.columns}e.escapeChar!==void 0&&(l=e.escapeChar+s)}}function S(U,V,j){var ee="";typeof U=="string"&&(U=JSON.parse(U)),typeof V=="string"&&(V=JSON.parse(V));var Q=Array.isArray(U)&&U.length>0,X=!Array.isArray(V[0]);if(Q&&n){for(var pe=0;pe<U.length;pe++)pe>0&&(ee+=i),ee+=D(U[pe],pe);V.length>0&&(ee+=o)}for(var Y=0;Y<V.length;Y++){var Ge=Q?U.length:V[Y].length,ze=!1,de=Q?Object.keys(V[Y]).length===0:V[Y].length===0;if(j&&!Q&&(ze=j==="greedy"?V[Y].join("").trim()==="":V[Y].length===1&&V[Y][0].length===0),j==="greedy"&&Q){for(var ce=[],De=0;De<Ge;De++){var J=X?U[De]:De;ce.push(V[Y][J])}ze=ce.join("").trim()===""}if(!ze){for(var ue=0;ue<Ge;ue++){ue>0&&!de&&(ee+=i);var Ee=Q&&X?U[ue]:ue;ee+=D(V[Y][Ee],ue)}Y<V.length-1&&(!j||Ge>0&&!de)&&(ee+=o)}}return ee}function D(U,V){if(typeof U>"u"||U===null)return"";if(U.constructor===Date)return JSON.stringify(U).slice(1,25);U=U.toString().replace(b,l);var j=typeof r=="boolean"&&r||Array.isArray(r)&&r[V]||N(U,Ua.BAD_DELIMITERS)||U.indexOf(i)>-1||U.charAt(0)===" "||U.charAt(U.length-1)===" ";return j?s+U+s:U}function N(U,V){for(var j=0;j<V.length;j++)if(U.indexOf(V[j])>-1)return!0;return!1}}let gF=class{_handle;_config;_finished=!1;_completed=!1;_input=null;_baseIndex=0;_partialLine="";_rowCount=0;_start=0;isFirstChunk=!0;_completeResults={data:[],errors:[],meta:{}};constructor(t){var e={...t};e.chunkSize=parseInt(e.chunkSize),!t.step&&!t.chunk&&(e.chunkSize=null),this._handle=new mF(e),this._handle.streamer=this,this._config=e}parseChunk(t,e){if(this.isFirstChunk&&xl(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(t);r!==void 0&&(t=r)}this.isFirstChunk=!1;var n=this._partialLine+t;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var o=i.meta.cursor;this._finished||(this._partialLine=n.substring(o-this._baseIndex),this._baseIndex=o),i&&i.data&&(this._rowCount+=i.data.length);var s=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(xl(this._config.chunk)&&!e){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return;i=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),!this._completed&&s&&xl(this._config.complete)&&(!i||!i.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),i}}_sendError(t){xl(this._config.error)&&this._config.error(t)}};class Mee extends gF{remaining;constructor(e={}){super(e)}stream(e){return this.remaining=e,this._nextChunk()}_nextChunk(){if(!this._finished){var e=this._config.chunkSize,r=e?this.remaining.substr(0,e):this.remaining;return this.remaining=e?this.remaining.substr(e):"",this._finished=!this.remaining,this.parseChunk(r)}}}const Pee=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,Lee=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class mF{_config;_stepCounter=0;_rowCounter=0;_input;_parser;_paused=!1;_aborted=!1;_delimiterError=!1;_fields=[];_results={data:[],errors:[],meta:{}};constructor(e){if(xl(e.step)){var r=e.step;e.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,e.preview&&this._stepCounter>e.preview?this._parser.abort():r(this._results,this)}}}this._config=e}parse(e,r,n){var i=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=Ree(e,i)),this._delimiterError=!1,this._config.delimiter)xl(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(e),this._results.meta.delimiter=this._config.delimiter);else{var o=this.guessDelimiter(e,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);o.successful?this._config.delimiter=o.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=Ua.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var s=_F(this._config);return this._config.preview&&this._config.header&&s.preview++,this._input=e,this._parser=new q2(s),this._results=this._parser.parse(this._input,r,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,xl(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(e){return this._config.skipEmptyLines==="greedy"?e.join("").trim()==="":e.length===1&&e[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Ua.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var e=0;e<this._results.data.length;e++)this.testEmptyLine(this._results.data[e])&&this._results.data.splice(e--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const e=n=>{xl(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var r=0;this.needsHeaderRow()&&r<this._results.data.length;r++)this._results.data[r].forEach(e);this._results.data.splice(0,1)}else this._results.data.forEach(e)}shouldApplyDynamicTyping(e){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[e]===void 0&&(this._config.dynamicTyping[e]=this._config.dynamicTypingFunction(e)),(this._config.dynamicTyping[e]||this._config.dynamicTyping)===!0}parseDynamic(e,r){return this.shouldApplyDynamicTyping(e)?r==="true"||r==="TRUE"?!0:r==="false"||r==="FALSE"?!1:Pee.test(r)?parseFloat(r):Lee.test(r)?new Date(r):r===""?null:r:r}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var e=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),e=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=e,this._results}processRow(e,r){var n=this._config.header?{}:[],i;for(i=0;i<e.length;i++){var o=i,s=e[i];this._config.header&&(o=i>=this._fields.length?"__parsed_extra":this._fields[i]),this._config.transform&&(s=this._config.transform(s,o)),s=this.parseDynamic(o,s),o==="__parsed_extra"?(n[o]=n[o]||[],n[o].push(s)):n[o]=s}return this._config.header&&(i>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+r):i<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+r)),n}guessDelimiter(e,r,n,i,o){var s,l,h;o=o||[",","	","|",";",Ua.RECORD_SEP,Ua.UNIT_SEP];for(var A=0;A<o.length;A++){var b=o[A],C=0,S=0,D=0;h=void 0;for(var N=new q2({comments:i,delimiter:b,newline:r,preview:10}).parse(e),U=0;U<N.data.length;U++){if(n&&this.testEmptyLine(N.data[U])){D++;continue}var V=N.data[U].length;if(S+=V,typeof h>"u"){h=0;continue}else V>1&&(C+=Math.abs(V-h),h=V)}N.data.length>0&&(S/=N.data.length-D),(typeof l>"u"||C>l)&&S>1.99&&(l=C,s=b)}return this._config.delimiter=s,{successful:!!s,bestDelimiter:s}}addError(e,r,n,i){this._results.errors.push({type:e,code:r,message:n,row:i})}}function Ree(t,e){t=t.substr(0,1024*1024);var r=new RegExp(Ig(e)+"([^]*?)"+Ig(e),"gm");t=t.replace(r,"");var n=t.split("\r"),i=t.split(`
`),o=i.length>1&&i[0].length<n[0].length;if(n.length===1||o)return`
`;for(var s=0,l=0;l<n.length;l++)n[l][0]===`
`&&s++;return s>=n.length/2?`\r
`:"\r"}function Ig(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function q2(t){t=t||{};var e=t.delimiter,r=t.newline,n=t.comments,i=t.step,o=t.preview,s=t.fastMode,l;t.quoteChar===void 0?l='"':l=t.quoteChar;var h=l;if(t.escapeChar!==void 0&&(h=t.escapeChar),(typeof e!="string"||Ua.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||Ua.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var A=0,b=!1;this.parse=function(C,S,D){if(typeof C!="string")throw new Error("Input must be a string");var N=C.length,U=e.length,V=r.length,j=n.length,ee=xl(i);A=0;var Q=[],X=[],pe=[],Y=0;if(!C)return ot();if(s||s!==!1&&C.indexOf(l)===-1){for(var Ge=C.split(r),ze=0;ze<Ge.length;ze++){const Mt=Ge[ze];if(A+=Mt.length,ze!==Ge.length-1)A+=r.length;else if(D)return ot();if(!(n&&Mt.substr(0,j)===n)){if(ee){if(Q=[],Le(Mt.split(e)),dt(),b)return ot()}else Le(Mt.split(e));if(o&&ze>=o)return Q=Q.slice(0,o),ot(!0)}}return ot()}for(var de=C.indexOf(e,A),ce=C.indexOf(r,A),De=new RegExp(Ig(h)+Ig(l),"g"),J;;){if(C[A]===l){for(J=A,A++;;){if(J=C.indexOf(l,J+1),J===-1)return D||X.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Q.length,index:A}),$e();if(J===N-1){var ue=C.substring(A,J).replace(De,l);return $e(ue)}if(l===h&&C[J+1]===h){J++;continue}if(!(l!==h&&J!==0&&C[J-1]===h)){var Ee=ce===-1?de:Math.min(de,ce),ct=Ne(Ee);if(C[J+1+ct]===e){if(pe.push(C.substring(A,J).replace(De,l)),A=J+1+ct+U,de=C.indexOf(e,A),ce=C.indexOf(r,A),ee&&(dt(),b))return ot();if(o&&Q.length>=o)return ot(!0);break}var Ce=Ne(ce);if(C.substr(J+1+Ce,V)===r){if(pe.push(C.substring(A,J).replace(De,l)),it(J+1+Ce+V),de=C.indexOf(e,A),ee&&(dt(),b))return ot();if(o&&Q.length>=o)return ot(!0);break}X.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Q.length,index:A}),J++}}if(ee&&(dt(),b))return ot();if(o&&Q.length>=o)return ot(!0);continue}if(n&&pe.length===0&&C.substr(A,j)===n){if(ce===-1)return ot();A=ce+V,ce=C.indexOf(r,A),de=C.indexOf(e,A);continue}if(de!==-1&&(de<ce||ce===-1)){pe.push(C.substring(A,de)),A=de+U,de=C.indexOf(e,A);continue}if(ce!==-1){if(pe.push(C.substring(A,ce)),it(ce+V),ee&&(dt(),b))return ot();if(o&&Q.length>=o)return ot(!0);continue}break}return $e();function Le(Mt){Q.push(Mt),Y=A}function Ne(Mt){var St=0;if(Mt!==-1){var st=C.substring(J+1,Mt);st&&st.trim()===""&&(St=st.length)}return St}function $e(Mt){return D||(typeof Mt>"u"&&(Mt=C.substr(A)),pe.push(Mt),A=N,Le(pe),ee&&dt()),ot()}function it(Mt){A=Mt,Le(pe),pe=[],ce=C.indexOf(r,A)}function ot(Mt,St){var st=St||!1;return{data:st?Q[0]:Q,errors:X,meta:{delimiter:e,linebreak:r,aborted:b,truncated:!!Mt,cursor:Y+(S||0)}}}function dt(){i(ot(void 0,!0)),Q=[],X=[]}},this.abort=function(){b=!0},this.getCharIndex=function(){return A}}function _F(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=_F(t[r]);return e}function xl(t){return typeof t=="function"}const Ua={parse:See,unparse:Iee,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:gI,BAD_DELIMITERS:["\r",`
`,'"',gI],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:q2,ParserHandle:mF,ChunkStreamer:gF},{ChunkStreamer:Oee}=Ua;class Dee extends Oee{textDecoder=new TextDecoder(this._config.encoding);constructor(e={}){super(e)}async stream(e){this._input=e;try{for await(const r of e)this.parseChunk(this.getStringChunk(r));this._finished=!0,this.parseChunk("")}catch(r){this._sendError(r)}}_nextChunk(){}getStringChunk(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}const Fee="4.3.3",CC="object-row-table",EC={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:Fee,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>mI(new TextDecoder().decode(t),e),parseText:(t,e)=>mI(t,e),parseInBatches:kee,options:{csv:{shape:CC,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function mI(t,e){const r={...EC.options.csv,...e?.csv},n=Nee(t),i=r.header==="auto"?yF(n):!!r.header,o={...r,header:i,download:!1,transformHeader:i?bF():void 0,error:b=>{throw new Error(b)}},s=Ua.parse(t,o),l=s.data,h=s.meta.fields||vF(r.columnPrefix,n.length),A=r.shape||CC;switch(A){case"object-row-table":return{shape:"object-row-table",data:l.map(b=>Array.isArray(b)?pF(b,h):b)};case"array-row-table":return{shape:"array-row-table",data:l.map(b=>Array.isArray(b)?b:AF(b,h))};default:throw new Error(A)}}function kee(t,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const r={...EC.options.csv,...e?.csv},n=new Tee;let i=!0,o=null,s=null,l=null;const h={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(A){let b=A.data;if(r.skipEmptyLines&&b.flat().join("").trim()==="")return;const C=A.meta.cursor;if(i&&!o&&(r.header==="auto"?yF(b):r.header)){o=b.map(bF());return}i&&(i=!1,o||(o=vF(r.columnPrefix,b.length)),l=Uee(b,o)),r.optimizeMemoryUsage&&(b=JSON.parse(JSON.stringify(b)));const S=r.shape||CC;s=s||new O_(l,{shape:S,...e});try{s.addRow(b);const D=s&&s.getFullBatch({bytesUsed:C});D&&n.enqueue(D)}catch(D){n.enqueue(D)}},complete(A){try{const b=A.meta.cursor,C=s&&s.getFinalBatch({bytesUsed:b});C&&n.enqueue(C)}catch(b){n.enqueue(b)}n.close()}};return Ua.parse(t,h,Dee),n}function yF(t){return t&&t.every(e=>typeof e=="string")}function Nee(t){return Ua.parse(t,{dynamicTyping:!0,preview:1}).data[0]}function bF(){const t=new Set;return e=>{let r=e,n=1;for(;t.has(r);)r=`${e}.${n}`,n++;return t.add(r),r}}function vF(t,e=0){const r=[];for(let n=0;n<e;n++)r.push(`${t}${n+1}`);return r}function Uee(t,e){const r=e?{}:[];for(let n=0;n<t.length;n++){const i=e&&e[n]||n;switch(typeof t[n]){case"number":case"boolean":r[i]={name:String(i),index:n,type:Float32Array};break;case"string":default:r[i]={name:String(i),index:n,type:Array}}}return r}const Gee="4.3.3";async function xF(t,e,r,n){return n._parse(t,e,r,n)}function pf(t,e){if(!t)throw new Error("loader assertion failed.")}const wF=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),_I=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_I&&parseFloat(_I[1]);function zee(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function jee(t){return globalThis.loaders?.modules?.[t]||null}function Hee(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Vee=Hee();function Wee(t,e){if(!t)throw new Error("loaders.gl assertion failed.")}const Zg=typeof process!="object"||String(process)!=="[object process]"||process.browser,BC=typeof importScripts=="function",yI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);yI&&parseFloat(yI[1]);const Iv={};async function lf(t,e=null,r={},n=null){return e&&(t=Jee(t,e,r,n)),Iv[t]=Iv[t]||Kee(t),await Iv[t]}function Jee(t,e,r={},n=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const i=r.modules||{};return i[n]?i[n]:Zg?r.CDN?(Wee(r.CDN.startsWith("http")),`${r.CDN}/${e}@${Vee}/dist/libs/${n}`):BC?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function Kee(t){if(t.endsWith("wasm"))return await Qee(t);if(!Zg)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(BC)return importScripts(t);const e=await Zee(t);return Xee(e,t)}function Xee(t,e){if(!Zg){const{requireFromString:n}=globalThis.loaders||{};return n?.(t,e)}if(BC)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function Qee(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Zg||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function Zee(t){const{readFileAsText:e}=globalThis.loaders||{};return Zg||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function $ee(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?bI(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?bI(t,0,e):""}function bI(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function qee(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${$ee(t)}"`)}}function CF(t,e,r){const n=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function $g(t,e){return pf(t>=0),pf(e>0),t+(e-1)&-4}function Yee(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const i=t.byteOffset,o=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,o)}return e.set(n,r),r+$g(n.byteLength,4)}const ete=globalThis.loaders?.parseImageNode,Y2=typeof Image<"u",ex=typeof ImageBitmap<"u",tte=!!ete,tx=wF?!0:tte;function rte(t){switch(t){case"auto":return ex||Y2||tx;case"imagebitmap":return ex;case"image":return Y2;case"data":return tx;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function nte(){if(ex)return"imagebitmap";if(Y2)return"image";if(tx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ite(t){const e=ste(t);if(!e)throw new Error("Not an image");return e}function EF(t){switch(ite(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function ste(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const ote=/^data:image\/svg\+xml/,ate=/\.svg((\?|#).*)?$/;function TC(t){return t&&(ote.test(t)||ate.test(t))}function lte(t,e){if(TC(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return BF(t,e)}function BF(t,e){if(TC(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function TF(t,e,r){const n=lte(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await cte(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function cte(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const ute={};let vI=!0;async function hte(t,e,r){let n;TC(r)?n=await TF(t,e,r):n=BF(t,r);const i=e&&e.imagebitmap;return await fte(n,i)}async function fte(t,e=null){if((dte(e)||!vI)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),vI=!1}return await createImageBitmap(t)}function dte(t){for(const e in t||ute)return!1;return!0}function pte(t){return!_te(t,"ftyp",4)||(t[8]&96)===0?null:Ate(t)}function Ate(t){switch(gte(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function gte(t,e,r){return String.fromCharCode(...t.slice(e,r))}function mte(t){return[...t].map(e=>e.charCodeAt(0))}function _te(t,e,r=0){const n=mte(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const sc=!1,pg=!0;function SC(t){const e=qg(t);return bte(e)||wte(e)||vte(e)||xte(e)||yte(e)}function yte(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=pte(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function bte(t){const e=qg(t);return e.byteLength>=24&&e.getUint32(0,sc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,sc),height:e.getUint32(20,sc)}:null}function vte(t){const e=qg(t);return e.byteLength>=10&&e.getUint32(0,sc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,pg),height:e.getUint16(8,pg)}:null}function xte(t){const e=qg(t);return e.byteLength>=14&&e.getUint16(0,sc)===16973&&e.getUint32(2,pg)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,pg),height:e.getUint32(22,pg)}:null}function wte(t){const e=qg(t);if(!(e.byteLength>=3&&e.getUint16(0,sc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=Cte();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,sc);if(n.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,sc),width:e.getUint16(i+7,sc)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,sc)}return null}function Cte(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function qg(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Ete(t,e){const{mimeType:r}=SC(t)||{},n=globalThis.loaders?.parseImageNode;return pf(n),await n(t,r)}async function Bte(t,e,r){e=e||{};const n=(e.image||{}).type||"auto",{url:i}=r||{},o=Tte(n);let s;switch(o){case"imagebitmap":s=await hte(t,e,i);break;case"image":s=await TF(t,e,i);break;case"data":s=await Ete(t);break;default:pf(!1)}return n==="data"&&(s=EF(s)),s}function Tte(t){switch(t){case"auto":case"data":return nte();default:return rte(t),t}}const Ste=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Ite=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Mte={image:{type:"auto",decode:!0}},Pte={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Gee,mimeTypes:Ite,extensions:Ste,parse:Bte,tests:[t=>!!SC(new DataView(t))],options:Mte},Mv={};function Lte(t){if(Mv[t]===void 0){const e=wF?Ote(t):Rte(t);Mv[t]=e}return Mv[t]}function Rte(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function Ote(t){switch(t){case"image/avif":case"image/webp":return Dte(t);default:return!0}}function Dte(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function Ga(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const SF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IF={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xI=["SCALAR","VEC2","VEC3","VEC4"],Fte=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],kte=new Map(Fte),Nte={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ute={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Gte={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function MF(t){return xI[t-1]||xI[0]}function Fy(t){const e=kte.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function PF(t,e){const r=Gte[t.componentType],n=Nte[t.type],i=Ute[t.componentType],o=t.count*n,s=t.count*n*i;Ga(s>=0&&s<=e.byteLength);const l=IF[t.componentType],h=SF[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:l,numberOfComponentsInElement:h}}function zte(t,e,r){const n=t.bufferViews[r];Ga(n);const i=n.buffer,o=e[i];Ga(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function jte(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],l=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:h,length:A,componentByteSize:b,numberOfComponentsInElement:C}=PF(n,i),S=b*C,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new h(o,l,A);const N=new h(A);for(let U=0;U<n.count;U++){const V=new h(o,l+U*D,C);N.set(V,U*C)}return N}function Hte(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let ks=class{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||Hte(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(n=>n===t),r=this.getRequiredExtensions().find(n=>n===t);return typeof e=="string"||typeof r=="string"}getExtension(t){const e=this.getUsedExtensions().find(n=>n===t),r=this.json.extensions||{};return e?r[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,r=this.gltf.buffers[e];Ga(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return jte(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){const n=t.extensions||{};n[e]=r}removeObjectExtension(t,e){const r=t?.extensions||{};if(r[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}delete r[e]}addExtension(t,e={}){return Ga(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return Ga(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const n={mesh:e};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:n,mode:i=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:i}]};if(r){const s=this._addIndices(r);o.primitives[0].indices=s}return Number.isFinite(n)&&(o.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=SC(t),n=e||r?.mimeType,i={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(t,e=0,r=this.byteLength){const n=t.byteLength;Ga(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:e,byteOffset:r,byteLength:n};return this.byteLength+=$g(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:MF(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const r=this.addBufferView(t);let n={min:e.min,max:e.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,e.size));const i={size:e.size,componentType:Fy(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(i,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){const t=this.byteLength,e=new ArrayBuffer(t),r=new Uint8Array(e);let n=0;for(const i of this.sourceBuffers||[])n=Yee(i,r,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=e,this.sourceBuffers=[e],this.gltf.buffers=[{arrayBuffer:e,byteOffset:0,byteLength:e.byteLength}]}_removeStringFromArray(t,e){let r=!0;for(;r;){const n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}_addAttributes(t={}){const e={};for(const r in t){const n=t[r],i=this._getGltfAttributeName(r),o=this.addBinaryBuffer(n.value,n);e[i]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const n=t.subarray(0,e);for(const i of n)r.min.push(i),r.max.push(i);for(let i=e;i<t.length;i+=e)for(let o=0;o<e;o++)r.min[0+o]=Math.min(r.min[0+o],t[i+o]),r.max[0+o]=Math.max(r.max[0+o],t[i+o]);return r}};function wI(t){return(t%1+1)%1}const LF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Vte={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},RF={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function IC(t,e){return RF[e]*LF[t]}function ky(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=Ny(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Ny(t,e,r,n=1){const i=LF[e],o=Vte[r],s=RF[r],l=n*i,h=l*s;let A=t.buffer,b=t.byteOffset;return b%s!==0&&(A=new Uint8Array(A).slice(b,b+h).buffer,b=0),new o(A,b,l)}function MC(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,l=e.index,h=s.textures?.[l]?.source;if(typeof h<"u"){const A=s.images?.[h]?.mimeType,b=t.gltf.images?.[h];if(b&&typeof b.width<"u"){const C=[];for(let S=0;S<o.length;S+=2){const D=Wte(b,A,o,S,e.channels);C.push(D)}return C}}return[]}function OF(t,e,r,n,i){if(!r?.length)return;const o=[];for(const b of r){let C=n.findIndex(S=>S===b);C===-1&&(C=n.push(b)-1),o.push(C)}const s=new Uint32Array(o),l=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,h=t.addBufferView(s,l,0),A=t.addAccessor(h,{size:1,componentType:Fy(s),count:s.length});i.attributes[e]=A}function Wte(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],l=r[n+1];let h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);const A=Jte(s,l,t,h);let b=0;for(const C of i){const S=typeof C=="number"?Object.values(o)[C]:o[C],D=A+S.offset,N=EF(t);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const U=N.data[D];b|=U<<S.shift}return b}function Jte(t,e,r,n=1){const i=r.width,o=wI(t)*(i-1),s=Math.round(o),l=r.height,h=wI(e)*(l-1),A=Math.round(h),b=r.components?r.components:n;return(A*i+s)*b}function DF(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const l=r[s],h=r[s+1]-r[s];if(h+l>n)break;const A=l/i,b=h/i;o.push(t.slice(A,A+b))}return o}function FF(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function kF(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let l=0;l<t;l++){const h=n[l+1]-n[l];if(h+s<=e.length){const A=e.subarray(s,h+s),b=o.decode(A);i.push(b),s+=h}}return i}return[]}const wp="EXT_mesh_features",Kte=wp;async function Xte(t,e){const r=new ks(t);Zte(r,e)}function Qte(t,e){const r=new ks(t);return qte(r),r.createBinaryChunk(),r.gltf}function Zte(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)$te(t,i,e)}function $te(t,e,r){if(!r?.gltf?.loadBuffers)return;const n=e.extensions?.[wp]?.featureIds;if(n)for(const i of n){let o;if(typeof i.attribute<"u"){const s=`_FEATURE_ID_${i.attribute}`,l=e.attributes[s];o=t.getTypedArrayForAccessor(l)}else typeof i.texture<"u"&&r?.gltf?.loadImages?o=MC(t,i.texture,e):o=[];i.data=o}}function qte(t,e){const r=t.gltf.json.meshes;if(r)for(const n of r)for(const i of n.primitives)ere(t,i)}function Yte(t,e,r,n){e.extensions||(e.extensions={});let i=e.extensions[wp];i||(i={featureIds:[]},e.extensions[wp]=i);const{featureIds:o}=i,s={featureCount:r.length,propertyTable:n,data:r};o.push(s),t.addObjectExtension(e,wp,i)}function ere(t,e){const r=e.extensions?.[wp];if(!r)return;const n=r.featureIds;n.forEach((i,o)=>{if(i.data){const{accessorKey:s,index:l}=tre(e.attributes),h=new Uint32Array(i.data);n[o]={featureCount:h.length,propertyTable:i.propertyTable,attribute:l},t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=t.addBufferView(h),b=t.addAccessor(A,{size:1,componentType:Fy(h),count:h.length});e.attributes[s]=b}})}function tre(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(i=>i.indexOf(e)===0);let n=-1;for(const i of r){const o=Number(i.substring(e.length));o>n&&(n=o)}return n++,{accessorKey:`${e}${n}`,index:n}}const rre=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Yte,decode:Xte,encode:Qte,name:Kte},Symbol.toStringTag,{value:"Module"})),Np="EXT_structural_metadata",nre=Np;async function ire(t,e){const r=new ks(t);ore(r,e)}function sre(t,e){const r=new ks(t);return xre(r),r.createBinaryChunk(),r.gltf}function ore(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(Np);r&&(e.gltf?.loadImages&&are(t,r),lre(t,r))}function are(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)ure(t,r,o,e)}function lre(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=cre(i,o);s&&fre(t,r,s)}}function cre(t,e){for(const r of t)if(r.class===e)return r;return null}function ure(t,e,r,n){if(!e)return;const i=r.extensions?.[Np]?.propertyTextures;if(i)for(const o of i){const s=e[o];hre(t,s,r,n)}}function hre(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,l=e.properties?.[o];if(!l)continue;l.data||(l.data=[]);const h=l.data,A=MC(t,l,r);A!==null&&(OF(t,s,A,h,r),l.data=h,n.dataAttributeNames.push(s))}}function fre(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=dre(t,e,s,i,l);l.data=h}}}function dre(t,e,r,n,i){let o=[];const s=i.values,l=t.getTypedArrayForBufferView(s),h=pre(t,r,i,n),A=Are(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=gre(r,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=kF(n,l,h,A);break}case"ENUM":{o=mre(e,r,n,l,h);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function pre(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?ky(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function Are(t,e,r){return typeof e.stringOffsets<"u"?ky(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function gre(t,e,r,n){const i=t.array,o=t.count,s=IC(t.type,t.componentType),l=r.byteLength/s;let h;return t.componentType?h=Ny(r,t.type,t.componentType,l):h=r,i?n?DF(h,e,n,r.length,s):o?FF(h,e,o):[]:h}function mre(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=s.valueType||"UINT16",h=IC(e.type,l),A=n.byteLength/h;let b=Ny(n,e.type,l,A);if(b||(b=n),e.array){if(i)return _re({valuesData:b,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:h,enumEntry:s});const C=e.count;return C?yre(b,r,C,s):[]}return PC(b,0,r,s)}function _re(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,l=[];for(let h=0;h<r;h++){const A=n[h],b=n[h+1]-n[h];if(b+A>i)break;const C=A/o,S=b/o,D=PC(e,C,S,s);l.push(D)}return l}function yre(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,l=PC(t,s,r,n);i.push(l)}return i}function PC(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],l=bre(n,s);l?i.push(l.name):i.push("")}return i}function bre(t,e){for(const r of t.values)if(r.value===e)return r;return null}const vre="schemaClassId";function xre(t,e){const r=t.getExtension(Np);if(r&&r.propertyTables)for(const n of r.propertyTables){const i=n.class,o=r.schema?.classes?.[i];n.properties&&o&&wre(n,o,t)}}function wre(t,e,r){for(const n in t.properties){const i=t.properties[n].data;if(i){const o=e.properties[n];if(o){const s=Tre(i,o,r);t.properties[n]=s}}}}function Cre(t,e,r=vre){let n=t.getExtension(Np);n||(n=t.addExtension(Np)),n.schema=Ere(e,r,n.schema);const i=Bre(e,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function Ere(t,e,r){const n=r??{id:"schema_id"},i={properties:{}};for(const o of t){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function Bre(t,e,r){const n={class:e,count:0};let i=0;const o=r.classes?.[e];for(const s of t){if(i===0&&(i=s.values.length),i!==s.values.length&&s.values.length)throw new Error("Illegal values in attributes");o?.properties[s.name]&&(n.properties||(n.properties={}),n.properties[s.name]={values:0,data:s.values})}return n.count=i,n}function Tre(t,e,r){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=Mre(t);n.stringOffsets=Pv(o,r),n.values=Pv(i,r)}else if(e.type==="SCALAR"&&e.componentType){const i=Ire(t,e.componentType);n.values=Pv(i,r)}return n}const Sre={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Ire(t,e){const r=[];for(const i of t)r.push(Number(i));const n=Sre[e];if(!n)throw new Error("Illegal component type");return new n(r)}function Mre(t){const e=new TextEncoder,r=[];let n=0;for(const h of t){const A=e.encode(h);n+=A.length,r.push(A)}const i=new Uint8Array(n),o=[];let s=0;for(const h of r)i.set(h,s),o.push(s),s+=h.length;o.push(s);const l=new Uint32Array(o);return{stringData:i,stringOffsets:l}}function Pv(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const Pre=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Cre,decode:ire,encode:sre,name:nre},Symbol.toStringTag,{value:"Module"})),NF="EXT_feature_metadata",Lre=NF;async function Rre(t,e){const r=new ks(t);Ore(r,e)}function Ore(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(NF);r&&(e.gltf?.loadImages&&Dre(t,r),Fre(t,r))}function Dre(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],l=Nre(i,o);l&&Gre(t,l,s)}}function Fre(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=kre(i,o);s&&Ure(t,r,s)}}function kre(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function Nre(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function Ure(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=zre(t,e,s,i,l);l.data=h}}}function Gre(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=Jre(t,o,n);o.data=s}}}function zre(t,e,r,n,i){let o=[];const s=i.bufferView,l=t.getTypedArrayForBufferView(s),h=jre(t,r,i,n),A=Hre(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=kF(n,l,h,A):Vre(r)&&(o=Wre(r,n,l,h)),o}function jre(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?ky(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function Hre(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?ky(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function Vre(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function Wre(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",l=t.componentType||t.type,h=IC(s,l),A=r.byteLength/h,b=Ny(r,s,l,A);return i?n?DF(b,e,n,r.length,h):o?FF(b,e,o):[]:b}function Jre(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)Kre(t,r,e,i,s);return i}function Kre(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=MC(t,o,i);s&&OF(t,e,s,n,i)}const Xre=Object.freeze(Object.defineProperty({__proto__:null,decode:Rre,name:Lre},Symbol.toStringTag,{value:"Module"})),Qre="4.3.3",Zre="4.3.3",D_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let CI;async function EI(t){return zee(t.modules),jee("basis")||(CI||=$re(t),await CI)}async function $re(t){let e=null,r=null;return[e,r]=await Promise.all([await lf(D_.TRANSCODER,"textures",t),await lf(D_.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await qre(e,r)}function qre(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let Lv;async function BI(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Lv=Lv||Yre(t),await Lv)}async function Yre(t){let e=null,r=null;return[e,r]=await Promise.all([await lf(D_.ENCODER,"textures",t),await lf(D_.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await ene(e,r)}function ene(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:l,BasisEncoder:h}=i;l(),n({BasisFile:o,KTX2File:s,BasisEncoder:h})})})}const Od={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},tne=["","WEBKIT_","MOZ_"],TI={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let r0=null;function rne(t){if(!r0){t=t||nne()||void 0,r0=new Set;for(const e of tne)for(const r in TI)if(t&&t.getExtension(`${e}${r}`)){const n=TI[r];r0.add(n)}}return r0}function nne(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ca=[171,75,84,88,32,50,48,187,13,10,26,10];function ine(t){const e=new Uint8Array(t);return!(e.byteLength<ca.length||e[0]!==ca[0]||e[1]!==ca[1]||e[2]!==ca[2]||e[3]!==ca[3]||e[4]!==ca[4]||e[5]!==ca[5]||e[6]!==ca[6]||e[7]!==ca[7]||e[8]!==ca[8]||e[9]!==ca[9]||e[10]!==ca[10]||e[11]!==ca[11])}const sne={etc1:{basisFormat:0,compressed:!0,format:Od.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Od.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Od.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Od.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Od.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Od.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function one(t,e){if(e.basis.containerFormat==="auto"){if(ine(t)){const n=await BI(e);return SI(n.KTX2File,t,e)}const{BasisFile:r}=await EI(e);return Rv(r,t,e)}switch(e.basis.module){case"encoder":const r=await BI(e);switch(e.basis.containerFormat){case"ktx2":return SI(r.KTX2File,t,e);case"basis":default:return Rv(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await EI(e);return Rv(n,t,e)}}function Rv(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const l=n.getNumLevels(s),h=[];for(let A=0;A<l;A++)h.push(ane(n,s,A,r));o.push(h)}return o}finally{n.close(),n.delete()}}function ane(t,e,r,n){const i=t.getImageWidth(e,r),o=t.getImageHeight(e,r),s=t.getHasAlpha(),{compressed:l,format:h,basisFormat:A}=UF(n,s),b=t.getImageTranscodedSizeInBytes(e,r,A),C=new Uint8Array(b);if(!t.transcodeImage(C,e,r,A,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:C,compressed:l,format:h,hasAlpha:s}}function SI(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++)o.push(lne(n,s,r));return[o]}finally{n.close(),n.delete()}}function lne(t,e,r){const{alphaFlag:n,height:i,width:o}=t.getImageLevelInfo(e,0,0),{compressed:s,format:l,basisFormat:h}=UF(r,n),A=t.getImageTranscodedSizeInBytes(e,0,0,h),b=new Uint8Array(A);if(!t.transcodeImage(b,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:A,hasAlpha:n,format:l}}function UF(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=GF()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),sne[r]}function GF(){const t=rne();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const cne={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Zre,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},une={...cne,parse:one},Up=!0,II=1735152710,LC=12,F_=8,hne=1313821514,fne=5130562,dne=0,pne=0,Ane=1;function gne(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function mne(t,e=0,r={}){const n=new DataView(t),{magic:i=II}=r,o=n.getUint32(e,!1);return o===i||o===II}function _ne(t,e,r=0,n={}){const i=new DataView(e),o=gne(i,r+0),s=i.getUint32(r+4,Up),l=i.getUint32(r+8,Up);switch(Object.assign(t,{header:{byteOffset:r,byteLength:l,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=LC,t.version){case 1:return yne(t,i,r);case 2:return bne(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function yne(t,e,r){pf(t.header.byteLength>LC+F_);const n=e.getUint32(r+0,Up),i=e.getUint32(r+4,Up);return r+=F_,pf(i===dne),rx(t,e,r,n),r+=n,r+=nx(t,e,r,t.header.byteLength),r}function bne(t,e,r,n){return pf(t.header.byteLength>LC+F_),vne(t,e,r,n),r+t.header.byteLength}function vne(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,Up),o=e.getUint32(r+4,Up);switch(r+=F_,o){case hne:rx(t,e,r,i);break;case fne:nx(t,e,r,i);break;case pne:n.strict||rx(t,e,r,i);break;case Ane:n.strict||nx(t,e,r,i);break}r+=$g(i,4)}return r}function rx(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),$g(n,4)}function nx(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),$g(n,4)}function zF(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const xne="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",wne="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Cne=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Ene=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Bne={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Tne={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Sne(t,e,r,n,i,o="NONE"){const s=await Ine();Lne(s,s.exports[Tne[i]],t,e,r,n,s.exports[Bne[o||"NONE"]])}let Ov;async function Ine(){return Ov||(Ov=Mne()),Ov}async function Mne(){let t=xne;WebAssembly.validate(Cne)&&(t=wne,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Pne(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Pne(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?Ene[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function Lne(t,e,r,n,i,o,s){const l=t.exports.sbrk,h=n+3&-4,A=l(h*i),b=l(o.length),C=new Uint8Array(t.exports.memory.buffer);C.set(o,b);const S=e(A,n,i,b,o.length);if(S===0&&s&&s(A,h,i),r.set(C.subarray(A,A+n*i)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const k_="EXT_meshopt_compression",Rne=k_;async function One(t,e){const r=new ks(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(Dne(r,i));await Promise.all(n),r.removeExtension(k_)}async function Dne(t,e){const r=t.getObjectExtension(e,k_);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:l,filter:h="NONE",buffer:A}=r,b=t.gltf.buffers[A],C=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Sne(S,s,o,C,l,h),t.removeObjectExtension(e,k_)}}const Fne=Object.freeze(Object.defineProperty({__proto__:null,decode:One,name:Rne},Symbol.toStringTag,{value:"Module"})),tp="EXT_texture_webp",kne=tp;function Nne(t,e){const r=new ks(t);if(!Lte("image/webp")){if(r.getRequiredExtensions().includes(tp))throw new Error(`gltf: Required extension ${tp} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,tp);o&&(i.source=o.source),r.removeObjectExtension(i,tp)}r.removeExtension(tp)}const Une=Object.freeze(Object.defineProperty({__proto__:null,name:kne,preprocess:Nne},Symbol.toStringTag,{value:"Module"})),V0="KHR_texture_basisu",Gne=V0;function zne(t,e){const r=new ks(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,V0);o&&(i.source=o.source,r.removeObjectExtension(i,V0))}r.removeExtension(V0)}const jne=Object.freeze(Object.defineProperty({__proto__:null,name:Gne,preprocess:zne},Symbol.toStringTag,{value:"Module"})),Hne="4.3.3",Vne={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Hne,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Wne(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Jne(t){let e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const l=t.POSITION?t.POSITION.value:[],h=l&&l.length;for(let A=0;A<h;A+=3){const b=l[A],C=l[A+1],S=l[A+2];e=b<e?b:e,r=C<r?C:r,n=S<n?S:n,i=b>i?b:i,o=C>o?C:o,s=S>s?S:s}return[[e,r,n],[i,o,s]]}function Kne(t,e,r){const n=Wne(e.value),i=r||Xne(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Xne(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}function Qne(t,e,r){const n=jF(e.metadata),i=[],o=Zne(e.attributes);for(const s in t){const l=t[s],h=MI(s,l,o[s]);i.push(h)}if(r){const s=MI("indices",r);i.push(s)}return{fields:i,metadata:n}}function Zne(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}function MI(t,e,r){const n=r?jF(r.metadata):void 0;return Kne(t,e,n)}function jF(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const PI={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},$ne={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},qne=4;let Yne=class{draco;decoder;metadataQuerier;constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const n=this.decoder.GetEncodedGeometryType(r),i=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(n){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const b=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(b)}const s=this._getDracoLoaderData(i,n,e),l=this._getMeshData(i,s,e),h=Jne(l.attributes),A=Qne(l.attributes,s,l.indices);return{loader:"draco",loaderData:s,header:{vertexCount:i.num_points(),boundingBox:h},...l,schema:A}}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,e,r){const n=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:i}}_getDracoAttributes(t,e){const r={};for(let n=0;n<t.num_attributes();n++){const i=this.decoder.GetAttribute(t,n),o=this._getAttributeMetadata(t,n);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:n,metadata:o};const s=this._getQuantizationTransform(i,e);s&&(r[i.unique_id()].quantization_transform=s);const l=this._getOctahedronTransform(i,e);l&&(r[i.unique_id()].octahedron_transform=l)}return r}_getMeshData(t,e,r){const n=this._getMeshAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,r){const n={};for(const i of Object.values(t.attributes)){const o=this._deduceAttributeName(i,r);i.name=o;const s=this._getAttributeValues(e,i);if(s){const{value:l,size:h}=s;n[o]={value:l,size:h,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return n}_getTriangleListIndices(t){const e=t.num_faces()*3,r=e*qne,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),rie(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=$ne[e.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${e.data_type}`),null;const n=e.num_components,i=t.num_points()*n,o=i*r.BYTES_PER_ELEMENT,s=eie(this.draco,r);let l;const h=this.draco._malloc(o);try{const A=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,A,s,o,h),l=new r(this.draco.HEAPF32.buffer,h,i).slice()}finally{this.draco._free(h)}return{value:l,size:n}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[o,s]of Object.entries(e.extraAttributes||{}))if(s===r)return o;const n=t.attribute_type;for(const o in PI)if(this.draco[o]===n)return PI[o];const i=e.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let n=0;n<r;n++){const i=this.metadataQuerier.GetEntryName(t,n);e[i]=this._getDracoMetadataField(t,i)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const n=tie(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,n=[...e,...r];for(const i of n)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,n=t.attribute_type();if(r.map(i=>this.decoder[i]).includes(n)){const i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits(),range:i.range(),min_values:new Float32Array([1,2,3]).map(o=>i.min_value(o))}}finally{this.draco.destroy(i)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,n=t.attribute_type();if(r.map(i=>this.decoder[i]).includes(n)){const i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits()}}finally{this.draco.destroy(i)}}return null}};function eie(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function tie(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function rie(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}const nie="1.5.6",iie="1.4.1",Dv=`https://www.gstatic.com/draco/versioned/decoders/${nie}`,Ho={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Fv={[Ho.DECODER]:`${Dv}/${Ho.DECODER}`,[Ho.DECODER_WASM]:`${Dv}/${Ho.DECODER_WASM}`,[Ho.FALLBACK_DECODER]:`${Dv}/${Ho.FALLBACK_DECODER}`,[Ho.ENCODER]:`https://raw.githubusercontent.com/google/draco/${iie}/javascript/${Ho.ENCODER}`};let kv;async function sie(t){const e=t.modules||{};return e.draco3d?kv||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):kv||=oie(t),await kv}async function oie(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await lf(Fv[Ho.FALLBACK_DECODER],"draco",t,Ho.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await lf(Fv[Ho.DECODER],"draco",t,Ho.DECODER),await lf(Fv[Ho.DECODER_WASM],"draco",t,Ho.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await aie(e,r)}function aie(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t({...r,onModuleLoaded:i=>n({draco:i})})})}const lie={...Vne,parse:cie};async function cie(t,e){const{draco:r}=await sie(e),n=new Yne(r);try{return n.parseSync(t,e?.draco)}finally{n.destroy()}}function uie(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=HF(n);e[r]=i}}return e}function HF(t){const{buffer:e,size:r,count:n}=hie(t);return{value:e,size:r,byteOffset:0,count:n,type:MF(r),componentType:Fy(e)}}function hie(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=fie(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function fie(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const th="KHR_draco_mesh_compression",die=th;function pie(t,e,r){const n=new ks(t);for(const i of VF(n))n.getObjectExtension(i,th)}async function Aie(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new ks(t),i=[];for(const o of VF(n))n.getObjectExtension(o,th)&&i.push(mie(n,o,e,r));await Promise.all(i),n.removeExtension(th)}function gie(t,e={}){const r=new ks(t);for(const n of r.json.meshes||[])_ie(n),r.addRequiredExtension(th)}async function mie(t,e,r,n){const i=t.getObjectExtension(e,th);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=CF(o.buffer,o.byteOffset),l={...r};delete l["3d-tiles"];const h=await xF(s,lie,l,n),A=uie(h.attributes);for(const[b,C]of Object.entries(A))if(b in e.attributes){const S=e.attributes[b],D=t.getAccessor(S);D?.min&&D?.max&&(C.min=D.min,C.max=D.max)}e.attributes=A,h.indices&&(e.indices=HF(h.indices)),t.removeObjectExtension(e,th),yie(e)}function _ie(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),l=n._addFauxAttributes(s.attributes),h=n.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[th]:{bufferView:h,attributes:l}}}]}}function yie(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*VF(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const bie=Object.freeze(Object.defineProperty({__proto__:null,decode:Aie,encode:gie,name:die,preprocess:pie},Symbol.toStringTag,{value:"Module"})),Uy="KHR_texture_transform",vie=Uy,n0=new ft,xie=new gi,wie=new gi;async function Cie(t,e){if(!new ks(t).hasExtension(Uy)||!e.gltf?.loadBuffers)return;const r=t.json.materials||[];for(let n=0;n<r.length;n++)Eie(n,t)}function Eie(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[Uy]&&Bie(e,t,o,i)}function Bie(t,e,r,n){const i=Tie(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const l of s.primitives){const h=l.material;Number.isFinite(h)&&e===h&&Sie(t,l,i)}}function Tie(t,e){const r=t.extensions?.[Uy],{texCoord:n=0}=t,{texCoord:i=n}=r;if(e.findIndex(([o,s])=>o===n&&s===i)===-1){const o=Pie(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function Sie(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const l=t.json.accessors?.[s];if(l&&l.bufferView){const h=t.json.bufferViews?.[l.bufferView];if(h){const{arrayBuffer:A,byteOffset:b}=t.buffers[h.buffer],C=(b||0)+(l.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:D}=PF(l,h),N=IF[l.componentType],U=SF[l.type],V=h.byteStride||N*U,j=new Float32Array(D);for(let ee=0;ee<l.count;ee++){const Q=new S(A,C+ee*V,2);n0.set(Q[0],Q[1],1),n0.transformByMatrix3(o),j.set([n0[0],n0[1]],ee*U)}n===i?Iie(l,h,t.buffers,j):Mie(i,l,e,t,j)}}}}function Iie(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Mie(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function Pie(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new gi().set(1,0,0,0,1,0,e[0],e[1],1),o=xie.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=wie.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Lie=Object.freeze(Object.defineProperty({__proto__:null,decode:Cie,name:vie},Symbol.toStringTag,{value:"Module"})),$h="KHR_lights_punctual",Rie=$h;async function Oie(t){const e=new ks(t),{json:r}=e,n=e.getExtension($h);n&&(e.json.lights=n.lights,e.removeExtension($h));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,$h);o&&(i.light=o.light),e.removeObjectExtension(i,$h)}}async function Die(t){const e=new ks(t),{json:r}=e;if(r.lights){const n=e.addExtension($h);Ga(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,$h,n)}delete e.json.lights}}const Fie=Object.freeze(Object.defineProperty({__proto__:null,decode:Oie,encode:Die,name:Rie},Symbol.toStringTag,{value:"Module"})),Mg="KHR_materials_unlit",kie=Mg;async function Nie(t){const e=new ks(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,Mg);e.removeExtension(Mg)}function Uie(t){const e=new ks(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,Mg,{}),e.addExtension(Mg))}const Gie=Object.freeze(Object.defineProperty({__proto__:null,decode:Nie,encode:Uie,name:kie},Symbol.toStringTag,{value:"Module"})),YA="KHR_techniques_webgl",zie=YA;async function jie(t){const e=new ks(t),{json:r}=e,n=e.getExtension(YA);if(n){const i=Vie(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,YA);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Wie(o.technique,e)),e.removeObjectExtension(o,YA)}e.removeExtension(YA)}}async function Hie(t,e){}function Vie(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function Wie(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const Jie=Object.freeze(Object.defineProperty({__proto__:null,decode:jie,encode:Hie,name:zie},Symbol.toStringTag,{value:"Module"})),WF=[Pre,rre,Fne,Une,jne,bie,Fie,Gie,Jie,Lie,Xre];function Kie(t,e={},r){const n=WF.filter(i=>JF(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function Xie(t,e={},r){const n=WF.filter(i=>JF(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function JF(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const Nv="KHR_binary_glTF";function Qie(t){const e=new ks(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,Nv);i&&Object.assign(n,i),e.removeObjectExtension(n,Nv)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(Nv)}const LI={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Zie={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let $ie=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),Qie(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in LI)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(!(!r||Array.isArray(r))){t[e]=[];for(const n in r){const i=r[n];i.id=i.id||n;const o=t[e].length;t[e].push(i),this.idToIndexMap[e][n]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in LI)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:r,indices:n,material:i}=e;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),i&&(e.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const r of t[e])for(const n in r){const i=r[n],o=this._convertIdToIndex(i,n);r[n]=o}}_convertIdToIndex(t,e){const r=Zie[e];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return n}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=e.values?.tex||e.values?.texture2d_0||e.values?.diffuseTex,n=t.textures.findIndex(i=>i.id===r);n!==-1&&(e.pbrMetallicRoughness.baseColorTexture={index:n})}}};function qie(t,e={}){return new $ie().normalize(t,e)}async function Yie(t,e,r=0,n,i){return ese(t,e,r,n),qie(t,{normalize:n?.gltf?.normalize}),Kie(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await tse(t,n,i),n?.gltf?.loadImages&&await rse(t,n,i),await Xie(t,n,i),t}function ese(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!mne(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=qee(e);else if(e instanceof ArrayBuffer){const s={};r=_ne(s,e,r,n.glb),Ga(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else Ga(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function tse(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;Ga(s);const l=zF(o.uri,e),h=await(await r?.fetch?.(l))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function rse(t,e,r){const n=nse(t),i=t.json.images||[],o=[];for(const s of n)o.push(ise(t,i[s],s,e,r));return await Promise.all(o)}function nse(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function ise(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=zF(e.uri,n),{fetch:h}=i;o=await(await h(l)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const l=zte(t.json,t.buffers,e.bufferView);o=CF(l.buffer,l.byteOffset,l.byteLength)}Ga(o,"glTF image has no data");let s=await xF(o,[Pte,une],{...n,mimeType:e.mimeType,basis:n.basis||{format:GF()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const ix={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Qre,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:sse,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function sse(t,e={},r){e={...ix.options,...e},e.gltf={...ix.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Yie({},t,n,e,r)}var po=1e-6,Gp=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ose(){var t=new Gp(4);return Gp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ase(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function lse(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t}(function(){var t=ose();return function(e,r,n,i,o,s){var l,h;for(r||(r=4),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],o(t,t,s),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();function W0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Cp(t,e){const r=lse([],e,t);return ase(r,r,1/r[3]),r}function RI(t,e){const r=t%e;return r<0?e+r:r}function cse(t,e,r){return r*e+(1-r)*t}function sx(t,e,r){return t<e?e:t>r?r:t}function use(t){return Math.log(t)*Math.LOG2E}const RC=Math.log2||use;function hse(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],h=e[6],A=e[7],b=e[8],C=e[9],S=e[10],D=e[11],N=e[12],U=e[13],V=e[14],j=e[15],ee=r*l-n*s,Q=r*h-i*s,X=r*A-o*s,pe=n*h-i*l,Y=n*A-o*l,Ge=i*A-o*h,ze=b*U-C*N,de=b*V-S*N,ce=b*j-D*N,De=C*V-S*U,J=C*j-D*U,ue=S*j-D*V,Ee=ee*ue-Q*J+X*De+pe*ce-Y*de+Ge*ze;return Ee?(Ee=1/Ee,t[0]=(l*ue-h*J+A*De)*Ee,t[1]=(i*J-n*ue-o*De)*Ee,t[2]=(U*Ge-V*Y+j*pe)*Ee,t[3]=(S*Y-C*Ge-D*pe)*Ee,t[4]=(h*ce-s*ue-A*de)*Ee,t[5]=(r*ue-i*ce+o*de)*Ee,t[6]=(V*X-N*Ge-j*Q)*Ee,t[7]=(b*Ge-S*X+D*Q)*Ee,t[8]=(s*J-l*ce+A*ze)*Ee,t[9]=(n*ce-r*J-o*ze)*Ee,t[10]=(N*Y-U*X+j*ee)*Ee,t[11]=(C*X-b*Y-D*ee)*Ee,t[12]=(l*de-s*De-h*ze)*Ee,t[13]=(r*De-n*de+i*ze)*Ee,t[14]=(U*Q-N*pe-V*ee)*Ee,t[15]=(b*pe-C*Q+S*ee)*Ee,t):null}function Uv(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],l=e[4],h=e[5],A=e[6],b=e[7],C=e[8],S=e[9],D=e[10],N=e[11],U=e[12],V=e[13],j=e[14],ee=e[15],Q=r[0],X=r[1],pe=r[2],Y=r[3];return t[0]=Q*n+X*l+pe*C+Y*U,t[1]=Q*i+X*h+pe*S+Y*V,t[2]=Q*o+X*A+pe*D+Y*j,t[3]=Q*s+X*b+pe*N+Y*ee,Q=r[4],X=r[5],pe=r[6],Y=r[7],t[4]=Q*n+X*l+pe*C+Y*U,t[5]=Q*i+X*h+pe*S+Y*V,t[6]=Q*o+X*A+pe*D+Y*j,t[7]=Q*s+X*b+pe*N+Y*ee,Q=r[8],X=r[9],pe=r[10],Y=r[11],t[8]=Q*n+X*l+pe*C+Y*U,t[9]=Q*i+X*h+pe*S+Y*V,t[10]=Q*o+X*A+pe*D+Y*j,t[11]=Q*s+X*b+pe*N+Y*ee,Q=r[12],X=r[13],pe=r[14],Y=r[15],t[12]=Q*n+X*l+pe*C+Y*U,t[13]=Q*i+X*h+pe*S+Y*V,t[14]=Q*o+X*A+pe*D+Y*j,t[15]=Q*s+X*b+pe*N+Y*ee,t}function ox(t,e,r){var n=r[0],i=r[1],o=r[2],s,l,h,A,b,C,S,D,N,U,V,j;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],l=e[1],h=e[2],A=e[3],b=e[4],C=e[5],S=e[6],D=e[7],N=e[8],U=e[9],V=e[10],j=e[11],t[0]=s,t[1]=l,t[2]=h,t[3]=A,t[4]=b,t[5]=C,t[6]=S,t[7]=D,t[8]=N,t[9]=U,t[10]=V,t[11]=j,t[12]=s*n+b*i+N*o+e[12],t[13]=l*n+C*i+U*o+e[13],t[14]=h*n+S*i+V*o+e[14],t[15]=A*n+D*i+j*o+e[15]),t}function KF(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fse(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],l=e[6],h=e[7],A=e[8],b=e[9],C=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+A*n,t[5]=s*i+b*n,t[6]=l*i+C*n,t[7]=h*i+S*n,t[8]=A*i-o*n,t[9]=b*i-s*n,t[10]=C*i-l*n,t[11]=S*i-h*n,t}function dse(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],l=e[2],h=e[3],A=e[4],b=e[5],C=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+A*n,t[1]=s*i+b*n,t[2]=l*i+C*n,t[3]=h*i+S*n,t[4]=A*i-o*n,t[5]=b*i-s*n,t[6]=C*i-l*n,t[7]=S*i-h*n,t}function pse(t,e,r,n,i){var o=1/Math.tan(e/2),s;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t}var Ase=pse;function OI(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],l=t[5],h=t[6],A=t[7],b=t[8],C=t[9],S=t[10],D=t[11],N=t[12],U=t[13],V=t[14],j=t[15],ee=e[0],Q=e[1],X=e[2],pe=e[3],Y=e[4],Ge=e[5],ze=e[6],de=e[7],ce=e[8],De=e[9],J=e[10],ue=e[11],Ee=e[12],ct=e[13],Ce=e[14],Le=e[15];return Math.abs(r-ee)<=po*Math.max(1,Math.abs(r),Math.abs(ee))&&Math.abs(n-Q)<=po*Math.max(1,Math.abs(n),Math.abs(Q))&&Math.abs(i-X)<=po*Math.max(1,Math.abs(i),Math.abs(X))&&Math.abs(o-pe)<=po*Math.max(1,Math.abs(o),Math.abs(pe))&&Math.abs(s-Y)<=po*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(l-Ge)<=po*Math.max(1,Math.abs(l),Math.abs(Ge))&&Math.abs(h-ze)<=po*Math.max(1,Math.abs(h),Math.abs(ze))&&Math.abs(A-de)<=po*Math.max(1,Math.abs(A),Math.abs(de))&&Math.abs(b-ce)<=po*Math.max(1,Math.abs(b),Math.abs(ce))&&Math.abs(C-De)<=po*Math.max(1,Math.abs(C),Math.abs(De))&&Math.abs(S-J)<=po*Math.max(1,Math.abs(S),Math.abs(J))&&Math.abs(D-ue)<=po*Math.max(1,Math.abs(D),Math.abs(ue))&&Math.abs(N-Ee)<=po*Math.max(1,Math.abs(N),Math.abs(Ee))&&Math.abs(U-ct)<=po*Math.max(1,Math.abs(U),Math.abs(ct))&&Math.abs(V-Ce)<=po*Math.max(1,Math.abs(V),Math.abs(Ce))&&Math.abs(j-Le)<=po*Math.max(1,Math.abs(j),Math.abs(Le))}function gse(){var t=new Gp(2);return Gp!=Float32Array&&(t[0]=0,t[1]=0),t}function ax(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function mse(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _se(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function yse(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function bse(t,e){return t[0]=-e[0],t[1]=-e[1],t}function XF(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}var vse=mse;(function(){var t=gse();return function(e,r,n,i,o,s){var l,h;for(r||(r=2),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],o(t,t,s),e[l]=t[0],e[l+1]=t[1];return e}})();function xse(){var t=new Gp(3);return Gp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wse(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Cse(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Ese(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}var Bse=Cse;(function(){var t=xse();return function(e,r,n,i,o,s){var l,h;for(r||(r=3),n||(n=0),i?h=Math.min(i*r+n,e.length):h=e.length,l=n;l<h;l+=r)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],o(t,t,s),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();function rh(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const wl=Math.PI,QF=wl/4,uc=wl/180,lx=180/wl,Pg=512,DI=4003e4,i0=85.051129,ZF=1.5;function cx(t){return Math.pow(2,t)}function Tse(t){return RC(t)}function Ju(t){const[e,r]=t;rh(Number.isFinite(e)),rh(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*uc,i=r*uc,o=Pg*(n+wl)/(2*wl),s=Pg*(wl+Math.log(Math.tan(QF+i*.5)))/(2*wl);return[o,s]}function $u(t){const[e,r]=t,n=e/Pg*(2*wl)-wl,i=2*(Math.atan(Math.exp(r/Pg*(2*wl)-wl))-QF);return[n*lx,i*lx]}function Sse(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;rh(Number.isFinite(e)&&Number.isFinite(r));const i=Pg,o=Math.cos(e*uc),s=i/360,l=s/o,h=i/DI/o,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[s,l,h],degreesPerUnit:[1/s,1/l,1/h]};if(n){const b=uc*Math.tan(e*uc)/o,C=s*b/2,S=i/DI*b,D=S/l*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[D,0,D]}return A}function Ise(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:o,center:s}=t,l=W0();ox(l,l,[0,0,-i]),fse(l,l,-r*uc),dse(l,l,n*uc);const h=o/e;return KF(l,l,[h,h,h]),s&&ox(l,l,Ese([],s)),l}function Mse(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:l,nearZMultiplier:h=1,farZMultiplier:A=1}=t;let{fovy:b=N_(ZF)}=t;n!==void 0&&(b=N_(n));const C=b*uc,S=i*uc,D=$F(b);let N=D;s&&(N+=s[2]*l/Math.cos(S)/r);const U=C*(.5+(o?o[1]:0)/r),V=Math.sin(U)*N/Math.sin(sx(Math.PI/2-S-U,.01,Math.PI-.01)),j=Math.sin(S)*V+N,ee=N*10,Q=Math.min(j*A,ee);return{fov:C,aspect:e/r,focalDistance:D,near:h,far:Q}}function Pse(t){const{fov:e,aspect:r,near:n,far:i}=Mse(t);return Ase([],e,r,n,i)}function N_(t){return 2*Math.atan(.5/t)*lx}function $F(t){return .5/Math.tan(.5*t*uc)}function Lse(t,e){const[r,n,i=0]=t;return rh(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),Cp(e,[r,n,i,1])}function FI(t,e,r=0){const[n,i,o]=t;if(rh(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return Cp(e,[n,i,o,1]);const s=Cp(e,[n,i,0,1]),l=Cp(e,[n,i,1,1]),h=s[2],A=l[2],b=h===A?0:((r||0)-h)/(A-h);return XF([],s,l,b)}function Rse(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=t,[[l,h],[A,b]]=n,C=Ose(t.padding),S=Ju([l,sx(b,-i0,i0)]),D=Ju([A,sx(h,-i0,i0)]),N=[Math.max(Math.abs(D[0]-S[0]),i),Math.max(Math.abs(D[1]-S[1]),i)],U=[e-C.left-C.right-Math.abs(s[0])*2,r-C.top-C.bottom-Math.abs(s[1])*2];rh(U[0]>0&&U[1]>0);const V=U[0]/N[0],j=U[1]/N[1],ee=(C.right-C.left)/2/V,Q=(C.top-C.bottom)/2/j,X=[(D[0]+S[0])/2+ee,(D[1]+S[1])/2+Q],pe=$u(X),Y=Math.min(o,RC(Math.abs(Math.min(V,j))));return rh(Number.isFinite(Y)),{longitude:pe[0],latitude:pe[1],zoom:Y}}function Ose(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(rh(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const kI=Math.PI/180;function Dse(t,e=0){const{width:r,height:n,unproject:i}=t,o={targetZ:e},s=i([0,n],o),l=i([r,n],o);let h,A;const b=t.fovy?.5*t.fovy*kI:Math.atan(.5/t.altitude),C=(90-t.pitch)*kI;return b>C-.01?(h=NI(t,0,e),A=NI(t,r,e)):(h=i([0,0],o),A=i([r,0],o)),[s,l,A,h]}function NI(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=Cp(n,[e,0,1,1]),o=Cp(n,[e,t.height,1,1]),s=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),l=XF([],i,o,s),h=$u(l);return h.push(r),h}class hc{constructor(e={width:1,height:1}){Cr(this,"latitude",void 0),Cr(this,"longitude",void 0),Cr(this,"zoom",void 0),Cr(this,"pitch",void 0),Cr(this,"bearing",void 0),Cr(this,"altitude",void 0),Cr(this,"fovy",void 0),Cr(this,"meterOffset",void 0),Cr(this,"center",void 0),Cr(this,"width",void 0),Cr(this,"height",void 0),Cr(this,"scale",void 0),Cr(this,"distanceScales",void 0),Cr(this,"viewMatrix",void 0),Cr(this,"projectionMatrix",void 0),Cr(this,"viewProjectionMatrix",void 0),Cr(this,"pixelProjectionMatrix",void 0),Cr(this,"pixelUnprojectionMatrix",void 0),Cr(this,"equals",j=>j instanceof hc?j.width===this.width&&j.height===this.height&&OI(j.projectionMatrix,this.projectionMatrix)&&OI(j.viewMatrix,this.viewMatrix):!1),Cr(this,"project",(j,ee={})=>{const{topLeft:Q=!0}=ee,X=this.projectPosition(j),pe=Lse(X,this.pixelProjectionMatrix),[Y,Ge]=pe,ze=Q?Ge:this.height-Ge;return j.length===2?[Y,ze]:[Y,ze,pe[2]]}),Cr(this,"unproject",(j,ee={})=>{const{topLeft:Q=!0,targetZ:X=void 0}=ee,[pe,Y,Ge]=j,ze=Q?Y:this.height-Y,de=X&&X*this.distanceScales.unitsPerMeter[2],ce=FI([pe,ze,Ge],this.pixelUnprojectionMatrix,de),[De,J,ue]=this.unprojectPosition(ce);return Number.isFinite(Ge)?[De,J,ue]:Number.isFinite(X)?[De,J,X]:[De,J]}),Cr(this,"projectPosition",j=>{const[ee,Q]=Ju(j),X=(j[2]||0)*this.distanceScales.unitsPerMeter[2];return[ee,Q,X]}),Cr(this,"unprojectPosition",j=>{const[ee,Q]=$u(j),X=(j[2]||0)*this.distanceScales.metersPerUnit[2];return[ee,Q,X]});let{width:r,height:n,altitude:i=null,fovy:o=null}=e;const{latitude:s=0,longitude:l=0,zoom:h=0,pitch:A=0,bearing:b=0,position:C=null,nearZMultiplier:S=.02,farZMultiplier:D=1.01}=e;r=r||1,n=n||1,o===null&&i===null?(i=ZF,o=N_(i)):o===null?o=N_(i):i===null&&(i=$F(o));const N=cx(h);i=Math.max(.75,i);const U=Sse({longitude:l,latitude:s}),V=Ju([l,s]);V.push(0),C&&wse(V,V,Bse([],C,U.unitsPerMeter)),this.projectionMatrix=Pse({width:r,height:n,scale:N,center:V,pitch:A,fovy:o,nearZMultiplier:S,farZMultiplier:D}),this.viewMatrix=Ise({height:n,scale:N,center:V,pitch:A,bearing:b,altitude:i}),this.width=r,this.height=n,this.scale=N,this.latitude=s,this.longitude=l,this.zoom=h,this.pitch=A,this.bearing=b,this.altitude=i,this.fovy=o,this.center=V,this.meterOffset=C||[0,0,0],this.distanceScales=U,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:r,projectionMatrix:n,viewMatrix:i}=this,o=W0();Uv(o,o,n),Uv(o,o,i),this.viewProjectionMatrix=o;const s=W0();KF(s,s,[e/2,-r/2,1]),ox(s,s,[1,-1,0]),Uv(s,s,o);const l=hse(W0(),s);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=l}projectFlat(e){return Ju(e)}unprojectFlat(e){return $u(e)}getMapCenterByLngLatPosition({lngLat:e,pos:r}){const n=FI(r,this.pixelUnprojectionMatrix),i=Ju(e),o=ax([],i,bse([],n)),s=ax([],this.center,o);return $u(s)}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:l}=Rse(Object.assign({width:n,height:i,bounds:e},r));return new hc({width:n,height:i,longitude:o,latitude:s,zoom:l})}getBounds(e){const r=this.getBoundingRegion(e),n=Math.min(...r.map(l=>l[0])),i=Math.max(...r.map(l=>l[0])),o=Math.min(...r.map(l=>l[1])),s=Math.max(...r.map(l=>l[1]));return[[n,o],[i,s]]}getBoundingRegion(e={}){return Dse(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:r}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}}const UI=512;function Fse(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:o,zoom:s,bearing:l=0}=t;(i<-180||i>180)&&(i=RI(i+180,360)-180),(l<-180||l>180)&&(l=RI(l+180,360)-180);const h=RC(r/UI);if(s<=h)s=h,o=0;else{const A=r/2/Math.pow(2,s),b=$u([0,A])[1];if(o<b)o=b;else{const C=$u([0,UI-A])[1];o>C&&(o=C)}}return{width:e,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:l}}const qF=.01,kse=["longitude","latitude","zoom"],YF={curve:1.414,speed:1.2};function Nse(t,e,r,n){const{startZoom:i,startCenterXY:o,uDelta:s,w0:l,u1:h,S:A,rho:b,rho2:C,r0:S}=e8(t,e,n);if(h<qF){const X={};for(const pe of kse){const Y=t[pe],Ge=e[pe];X[pe]=cse(Y,Ge,r)}return X}const D=r*A,N=Math.cosh(S)/Math.cosh(S+b*D),U=l*((Math.cosh(S)*Math.tanh(S+b*D)-Math.sinh(S))/C)/h,V=1/N,j=i+Tse(V),ee=_se([],s,U);ax(ee,ee,o);const Q=$u(ee);return{longitude:Q[0],latitude:Q[1],zoom:j}}function Use(t,e,r){const n={...YF,...r},{screenSpeed:i,speed:o,maxDuration:s}=n,{S:l,rho:h}=e8(t,e,n),A=1e3*l;let b;return Number.isFinite(i)?b=A/(i/h):b=A/o,Number.isFinite(s)&&b>s?0:b}function e8(t,e,r){r=Object.assign({},YF,r);const n=r.curve,i=t.zoom,o=[t.longitude,t.latitude],s=cx(i),l=e.zoom,h=[e.longitude,e.latitude],A=cx(l-i),b=Ju(o),C=Ju(h),S=vse([],C,b),D=Math.max(t.width,t.height),N=D/A,U=yse(S)*s,V=Math.max(U,qF),j=n*n,ee=(N*N-D*D+j*j*V*V)/(2*D*j*V),Q=(N*N-D*D-j*j*V*V)/(2*N*j*V),X=Math.log(Math.sqrt(ee*ee+1)-ee),pe=Math.log(Math.sqrt(Q*Q+1)-Q),Y=(pe-X)/n;return{startZoom:i,startCenterXY:b,uDelta:S,w0:D,u1:U,S:Y,rho:n,rho2:j,r0:X,r1:pe}}var Qc=typeof document<"u"?document:{};function GI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function s0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?GI(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):GI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function zI(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Gse(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){r=t[Symbol.iterator]()},n:function(){var h=r.next();return o=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Gse(t,e){if(t){if(typeof t=="string")return jI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jI(t,e)}}function jI(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var zse=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Gv(t){if(!t)return null;if(typeof t=="string")return t;t.toJS&&(t=t.toJS());var e={},r=zI(t.layers),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;e[i.id]=i}}catch(s){r.e(s)}finally{r.f()}var o=t.layers.map(function(s){var l=e[s.ref],h=null;if("interactive"in s&&(h=s0({},s),delete h.interactive),l){h=h||s0({},s),delete h.ref;var A=zI(zse),b;try{for(A.s();!(b=A.n()).done;){var C=b.value;C in l&&(h[C]=l[C])}}catch(S){A.e(S)}finally{A.f()}}return h||s});return s0(s0({},t),{},{layers:o})}function jse(){}function Hse(t){t&&console.error(t.error)}var t8={container:At.object,gl:At.object,mapboxApiAccessToken:At.string,mapboxApiUrl:At.string,attributionControl:At.bool,preserveDrawingBuffer:At.bool,reuseMaps:At.bool,transformRequest:At.func,mapOptions:At.object,mapStyle:At.oneOfType([At.string,At.object]),preventStyleDiffing:At.bool,visible:At.bool,asyncRender:At.bool,onLoad:At.func,onError:At.func,width:At.number,height:At.number,viewState:At.object,longitude:At.number,latitude:At.number,zoom:At.number,bearing:At.number,pitch:At.number,altitude:At.number},J0={container:Qc.body,mapboxApiAccessToken:Vse(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:jse,onError:Hse,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Vse(){var t=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}return!t&&typeof process<"u"&&(t=t||mB.MapboxAccessToken||mB.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function HI(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&At.checkPropTypes(t8,t,"prop",e)}var qh=(function(){function t(e){var r=this;if(hh(this,t),Cr(this,"props",J0),Cr(this,"width",0),Cr(this,"height",0),Cr(this,"_fireLoadEvent",function(){r.props.onLoad({type:"load",target:r._map})}),Cr(this,"_handleError",function(n){r.props.onError(n)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return uh(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var r=this._map.getContainer(),n=e.container;for(n.classList.add("mapboxgl-map");r.childNodes.length>0;)n.appendChild(r.childNodes[0]);this._map._container=n,t.savedMap=null,e.mapStyle&&this._map.setStyle(Gv(e.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var r=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=r,e.gl}}var n={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:Gv(e.mapStyle),interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(n.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,e.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!t.savedMap?(t.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(e){var r=this;e=Object.assign({},J0,e),HI(e,"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||J0.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var n=e,i=n.container;Object.defineProperty(i,"offsetWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(i,"clientWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(i,"offsetHeight",{configurable:!0,get:function(){return r.height}}),Object.defineProperty(i,"clientHeight",{configurable:!0,get:function(){return r.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,r){if(this._map){r=Object.assign({},this.props,r),HI(r,"Mapbox");var n=this._updateMapViewport(e,r),i=this._updateMapSize(e,r);this._updateMapStyle(e,r),!r.asyncRender&&(n||i)&&this.redraw(),this.props=r}}},{key:"_updateMapStyle",value:function(e,r){var n=e.mapStyle!==r.mapStyle;n&&this._map.setStyle(Gv(r.mapStyle),{diff:!r.preventStyleDiffing})}},{key:"_updateMapSize",value:function(e,r){var n=e.width!==r.width||e.height!==r.height;return n&&(this.width=r.width,this.height=r.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(e,r){var n=this._getViewState(e),i=this._getViewState(r),o=i.latitude!==n.latitude||i.longitude!==n.longitude||i.zoom!==n.zoom||i.pitch!==n.pitch||i.bearing!==n.bearing||i.altitude!==n.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(i)),i.altitude!==n.altitude&&(this._map.transform.altitude=i.altitude)),o}},{key:"_getViewState",value:function(e){var r=e.viewState||e,n=r.longitude,i=r.latitude,o=r.zoom,s=r.pitch,l=s===void 0?0:s,h=r.bearing,A=h===void 0?0:h,b=r.altitude,C=b===void 0?1.5:b;return{longitude:n,latitude:i,zoom:o,pitch:l,bearing:A,altitude:C}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Qc>"u"))try{var r=Qc.createElement("div");r.className="mapboxgl-map",r.style.display="none",Qc.body.appendChild(r);var n=window.getComputedStyle(r).position!=="static";if(!n){var i=Qc.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),Qc.head.appendChild(i)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),t})();Cr(qh,"initialized",!1),Cr(qh,"propTypes",t8),Cr(qh,"defaultProps",J0),Cr(qh,"savedMap",null);var ux={exports:{}},Wse=ux.exports,VI;function Jse(){return VI||(VI=1,(function(t,e){(function(r,n){t.exports=n()})(Wse,function(){var r,n,i;function o(s,l){if(!r)r=l;else if(!n)n=l;else{var h="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",A={};r(A),i=l(A),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([h],{type:"text/javascript"})))}}return o(["exports"],function(s){function l(a,u){return a(u={exports:{}},u.exports),u.exports}var h=A;function A(a,u,p,x){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=p,this.p2y=x}A.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},A.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},A.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},A.prototype.solveCurveX=function(a,u){var p,x,B,I,R;for(u===void 0&&(u=1e-6),B=a,R=0;R<8;R++){if(I=this.sampleCurveX(B)-a,Math.abs(I)<u)return B;var k=this.sampleCurveDerivativeX(B);if(Math.abs(k)<1e-6)break;B-=I/k}if((B=a)<(p=0))return p;if(B>(x=1))return x;for(;p<x;){if(I=this.sampleCurveX(B),Math.abs(I-a)<u)return B;a>I?p=B:x=B,B=.5*(x-p)+p}return B},A.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var b=C;function C(a,u){this.x=a,this.y=u}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,p=a.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),p=Math.sin(a),x=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=x,this},_rotateAround:function(a,u){var p=Math.cos(a),x=Math.sin(a),B=u.y+x*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-x*(this.y-u.y),this.y=B,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(a){return a instanceof C?a:Array.isArray(a)?new C(a[0],a[1]):a};var S=typeof self<"u"?self:{},D=Math.pow(2,53)-1;function N(a,u,p,x){var B=new h(a,u,p,x);return function(I){return B.solve(I)}}var U=N(.25,.1,.25,1);function V(a,u,p){return Math.min(p,Math.max(u,a))}function j(a,u,p){var x=p-u,B=((a-u)%x+x)%x+u;return B===u?p:B}function ee(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var R in I)a[R]=I[R]}return a}var Q=1;function X(){return Q++}function pe(){return(function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()}function Y(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ge(a,u){a.forEach(function(p){u[p]&&(u[p]=u[p].bind(u))})}function ze(a,u){return a.indexOf(u,a.length-u.length)!==-1}function de(a,u,p){var x={};for(var B in a)x[B]=u.call(p||this,a[B],B,a);return x}function ce(a,u,p){var x={};for(var B in a)u.call(p||this,a[B],B,a)&&(x[B]=a[B]);return x}function De(a){return Array.isArray(a)?a.map(De):typeof a=="object"&&a?de(a,De):a}var J={};function ue(a){J[a]||(typeof console<"u"&&console.warn(a),J[a]=!0)}function Ee(a,u,p){return(p.y-a.y)*(u.x-a.x)>(u.y-a.y)*(p.x-a.x)}function ct(a){for(var u=0,p=0,x=a.length,B=x-1,I=void 0,R=void 0;p<x;B=p++)u+=((R=a[B]).x-(I=a[p]).x)*(I.y+R.y);return u}function Ce(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Le(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,B,I,R){var k=I||R;return u[B]=!k||k.toLowerCase(),""}),u["max-age"]){var p=parseInt(u["max-age"],10);isNaN(p)?delete u["max-age"]:u["max-age"]=p}return u}var Ne=null;function $e(a){if(Ne==null){var u=a.navigator?a.navigator.userAgent:null;Ne=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Ne}function it(a){try{var u=S[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var ot,dt,Mt,St,st=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),Ar=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,Qt=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,Zt={now:st,frame:function(a){var u=Ar(a);return{cancel:function(){return Qt(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var p=S.document.createElement("canvas"),x=p.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return p.width=a.width,p.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return ot||(ot=S.document.createElement("a")),ot.href=a,ot.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(dt==null&&(dt=S.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}},Ht={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},dr={supported:!1,testSupport:function(a){!ln&&St&&(Lr?vr(a):Mt=a)}},ln=!1,Lr=!1;function vr(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,St),a.isContextLost())return;dr.supported=!0}catch{}a.deleteTexture(u),ln=!0}S.document&&((St=S.document.createElement("img")).onload=function(){Mt&&vr(Mt),Mt=null,Lr=!0},St.onerror=function(){ln=!0,Mt=null},St.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Hn="01",_r=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function yr(a){return a.indexOf("mapbox:")===0}_r.prototype._createSkuToken=function(){var a=(function(){for(var u="",p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Hn,u].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},_r.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},_r.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},_r.prototype.normalizeStyleURL=function(a,u){if(!yr(a))return a;var p=qn(a);return p.path="/styles/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},_r.prototype.normalizeGlyphsURL=function(a,u){if(!yr(a))return a;var p=qn(a);return p.path="/fonts/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},_r.prototype.normalizeSourceURL=function(a,u){if(!yr(a))return a;var p=qn(a);return p.path="/v4/"+p.authority+".json",p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||u)},_r.prototype.normalizeSpriteURL=function(a,u,p,x){var B=qn(a);return yr(a)?(B.path="/styles/v1"+B.path+"/sprite"+u+p,this._makeAPIURL(B,this._customAccessToken||x)):(B.path+=""+u+p,mn(B))},_r.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!yr(a))return a;var p=qn(a);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Zt.devicePixelRatio>=2||u===512?"@2x":"")+(dr.supported?".webp":"$1")),p.path=p.path.replace(/^.+\/v4\//,"/"),p.path="/v4"+p.path;var x=this._customAccessToken||(function(B){for(var I=0,R=B;I<R.length;I+=1){var k=R[I].match(/^access_token=(.*)$/);if(k)return k[1]}return null})(p.params)||Ht.ACCESS_TOKEN;return Ht.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&p.params.push("sku="+this._skuToken),this._makeAPIURL(p,x)},_r.prototype.canonicalizeTileURL=function(a,u){var p=qn(a);if(!p.path.match(/(^\/v4\/)/)||!p.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=p.path.replace("/v4/","");var B=p.params;return u&&(B=B.filter(function(I){return!I.match(/^access_token=/)})),B.length&&(x+="?"+B.join("&")),x},_r.prototype.canonicalizeTileset=function(a,u){for(var p=!!u&&yr(u),x=[],B=0,I=a.tiles||[];B<I.length;B+=1){var R=I[B];Rr(R)?x.push(this.canonicalizeTileURL(R,p)):x.push(R)}return x},_r.prototype._makeAPIURL=function(a,u){var p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=qn(Ht.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var B=a.params.indexOf("secure");B>=0&&a.params.splice(B,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Ht.REQUIRE_ACCESS_TOKEN)return mn(a);if(!(u=u||Ht.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+p);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+p);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+u),mn(a)};var un=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Rr(a){return un.test(a)}var ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qn(a){var u=a.match(ci);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function mn(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function ri(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(u[1]).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Vn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Vn.prototype.getStorageKey=function(a){var u,p=ri(Ht.ACCESS_TOKEN);return u=p&&p.u?S.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,function(x,B){return String.fromCharCode(+("0x"+B))})):Ht.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},Vn.prototype.fetchEventData=function(){var a=it("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{var x=S.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var B=S.localStorage.getItem(p);B&&(this.anonId=B)}catch{ue("Unable to read from LocalStorage")}},Vn.prototype.saveEventData=function(){var a=it("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ue("Unable to write to LocalStorage")}},Vn.prototype.processRequests=function(a){},Vn.prototype.postEvent=function(a,u,p,x){var B=this;if(Ht.EVENTS_URL){var I=qn(Ht.EVENTS_URL);I.params.push("access_token="+(x||Ht.ACCESS_TOKEN||""));var R={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Hn,userId:this.anonId},k=u?ee(R,u):R,z={url:mn(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=lt(z,function(K){B.pendingRequest=null,p(K),B.saveEventData(),B.processRequests(x)})}},Vn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var Tn,Yn,zt=(function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(p,x,B,I){this.skuToken=B;var R=!(!I&&!Ht.ACCESS_TOKEN),k=Array.isArray(p)&&p.some(function(z){return yr(z)||Rr(z)});Ht.EVENTS_URL&&R&&k&&this.queueRequest({id:x,timestamp:Date.now()},I)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var B=this.queue.shift(),I=B.id,R=B.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),Y(this.anonId)||(this.anonId=pe()),this.postEvent(R,{skuToken:this.skuToken},function(k){k||I&&(x.success[I]=!0)},p))}},u})(Vn),gr=new((function(a){function u(p){a.call(this,"appUserTurnstile"),this._customAccessToken=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(p,x){Ht.EVENTS_URL&&Ht.ACCESS_TOKEN&&Array.isArray(p)&&p.some(function(B){return yr(B)||Rr(B)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var B=ri(Ht.ACCESS_TOKEN),I=B?B.u:Ht.ACCESS_TOKEN,R=I!==this.eventData.tokenU;Y(this.anonId)||(this.anonId=pe(),R=!0);var k=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),K=new Date(k),q=(k-this.eventData.lastSuccess)/864e5;R=R||q>=1||q<-1||z.getDate()!==K.getDate()}else R=!0;if(!R)return this.processRequests();this.postEvent(k,{"enabled.telemetry":!1},function(ie){ie||(x.eventData.lastSuccess=k,x.eventData.tokenU=I)},p)}},u})(Vn)),Mr=gr.postTurnstileEvent.bind(gr),nn=new zt,_i=nn.postMapLoadEvent.bind(nn),Se=500,kt=50;function Jt(){S.caches&&!Tn&&(Tn=S.caches.open("mapbox-tiles"))}function cr(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var qe,Lt=1/0;function ge(){return qe==null&&(qe=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),qe}var Gt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Gt);var wt=(function(a){function u(p,x,B){x===401&&Rr(B)&&(p+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,p),this.status=x,this.url=B,this.name=this.constructor.name,this.message=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u})(Error),H=Ce()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},yt,Bt,xe=function(a,u){if(!(/^file:/.test(p=a.url)||/^file:/.test(H())&&!/^\w+:/.test(p))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return(function(x,B){var I,R=new S.AbortController,k=new S.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:H(),signal:R.signal}),z=!1,K=!1,q=(I=k.url).indexOf("sku=")>0&&Rr(I);x.type==="json"&&k.headers.set("Accept","application/json");var ie=function(_e,Fe,ke){if(!K){if(_e&&_e.message!=="SecurityError"&&ue(_e),Fe&&ke)return he(Fe);var Ve=Date.now();S.fetch(k).then(function(je){if(je.ok){var Ze=q?je.clone():null;return he(je,Ze,Ve)}return B(new wt(je.statusText,je.status,x.url))}).catch(function(je){je.code!==20&&B(new Error(je.message))})}},he=function(_e,Fe,ke){(x.type==="arrayBuffer"?_e.arrayBuffer():x.type==="json"?_e.json():_e.text()).then(function(Ve){K||(Fe&&ke&&(function(je,Ze,at){if(Jt(),Tn){var gt={status:Ze.status,statusText:Ze.statusText,headers:new S.Headers};Ze.headers.forEach(function(Rt,Wt){return gt.headers.set(Wt,Rt)});var _t=Le(Ze.headers.get("Cache-Control")||"");_t["no-store"]||(_t["max-age"]&&gt.headers.set("Expires",new Date(at+1e3*_t["max-age"]).toUTCString()),new Date(gt.headers.get("Expires")).getTime()-at<42e4||(function(Rt,Wt){if(Yn===void 0)try{new Response(new ReadableStream),Yn=!0}catch{Yn=!1}Yn?Wt(Rt.body):Rt.blob().then(Wt)})(Ze,function(Rt){var Wt=new S.Response(Rt,gt);Jt(),Tn&&Tn.then(function($t){return $t.put(cr(je.url),Wt)}).catch(function($t){return ue($t.message)})}))}})(k,Fe,ke),z=!0,B(null,Ve,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(Ve){K||B(new Error(Ve.message))})};return q?(function(_e,Fe){if(Jt(),!Tn)return Fe(null);var ke=cr(_e.url);Tn.then(function(Ve){Ve.match(ke).then(function(je){var Ze=(function(at){if(!at)return!1;var gt=new Date(at.headers.get("Expires")||0),_t=Le(at.headers.get("Cache-Control")||"");return gt>Date.now()&&!_t["no-cache"]})(je);Ve.delete(ke),Ze&&Ve.put(ke,je.clone()),Fe(null,je,Ze)}).catch(Fe)}).catch(Fe)})(k,ie):ie(null,null),{cancel:function(){K=!0,z||R.abort()}}})(a,u);if(Ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var p;return(function(x,B){var I=new S.XMLHttpRequest;for(var R in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(R,x.headers[R]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){B(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var k=I.response;if(x.type==="json")try{k=JSON.parse(I.response)}catch(z){return B(z)}B(null,k,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else B(new wt(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}})(a,u)},Ke=function(a,u){return xe(ee(a,{type:"arrayBuffer"}),u)},lt=function(a,u){return xe(ee(a,{method:"POST"}),u)},Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yt=[],Bt=0;var ne=function(a,u){if(dr.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Bt>=Ht.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return yt.push(p),p}Bt++;var x=!1,B=function(){if(!x)for(x=!0,Bt--;yt.length&&Bt<Ht.MAX_PARALLEL_IMAGE_REQUESTS;){var R=yt.shift();R.cancelled||(R.cancel=ne(R.requestParameters,R.callback).cancel)}},I=Ke(a,function(R,k,z,K){B(),R?u(R):k&&(ge()?(function(q,ie){var he=new S.Blob([new Uint8Array(q)],{type:"image/png"});S.createImageBitmap(he).then(function(_e){ie(null,_e)}).catch(function(_e){ie(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})})(k,u):(function(q,ie,he,_e){var Fe=new S.Image,ke=S.URL;Fe.onload=function(){ie(null,Fe),ke.revokeObjectURL(Fe.src),Fe.onload=null,S.requestAnimationFrame(function(){Fe.src=Z})},Fe.onerror=function(){return ie(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ve=new S.Blob([new Uint8Array(q)],{type:"image/png"});Fe.cacheControl=he,Fe.expires=_e,Fe.src=q.byteLength?ke.createObjectURL(Ve):Z})(k,u,z,K))});return{cancel:function(){I.cancel(),B()}}};function ae(a,u,p){p[a]&&p[a].indexOf(u)!==-1||(p[a]=p[a]||[],p[a].push(u))}function ye(a,u,p){if(p&&p[a]){var x=p[a].indexOf(u);x!==-1&&p[a].splice(x,1)}}var Oe=function(a,u){u===void 0&&(u={}),ee(this,u),this.type=a},fe=(function(a){function u(p,x){x===void 0&&(x={}),a.call(this,"error",ee({error:p},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Oe),be=function(){};be.prototype.on=function(a,u){return this._listeners=this._listeners||{},ae(a,u,this._listeners),this},be.prototype.off=function(a,u){return ye(a,u,this._listeners),ye(a,u,this._oneTimeListeners),this},be.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},ae(a,u,this._oneTimeListeners),this},be.prototype.fire=function(a,u){typeof a=="string"&&(a=new Oe(a,u||{}));var p=a.type;if(this.listens(p)){a.target=this;for(var x=0,B=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];x<B.length;x+=1)B[x].call(this,a);for(var I=0,R=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];I<R.length;I+=1){var k=R[I];ye(p,k,this._oneTimeListeners),k.call(this,a)}var z=this._eventedParent;z&&(ee(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(a))}else a instanceof fe&&console.error(a.error);return this},be.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},be.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},we=function(a,u,p,x){this.message=(a?a+": ":"")+p,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function g(a){var u=a.value;return u?[new we(a.key,u,"constants have been deprecated as of v8")]:[]}function le(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var R in I)a[R]=I[R]}return a}function Ct(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Qe(a){if(Array.isArray(a))return a.map(Qe);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var p in a)u[p]=Qe(a[p]);return u}return Ct(a)}var Et=(function(a){function u(p,x){a.call(this,x),this.message=x,this.key=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Error),Pt=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var p=0,x=u;p<x.length;p+=1){var B=x[p];this.bindings[B[0]]=B[1]}};Pt.prototype.concat=function(a){return new Pt(this,a)},Pt.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Pt.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Dt={kind:"null"},ht={kind:"number"},Ft={kind:"string"},It={kind:"boolean"},jt={kind:"color"},Nr={kind:"object"},er={kind:"value"},en={kind:"collator"},cn={kind:"formatted"},Jr={kind:"resolvedImage"};function Kr(a,u){return{kind:"array",itemType:a,N:u}}function zr(a){if(a.kind==="array"){var u=zr(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var yi=[Dt,ht,Ft,It,jt,cn,Nr,Kr(er),Jr];function Xr(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Xr(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var p=0,x=yi;p<x.length;p+=1)if(!Xr(x[p],u))return null}}return"Expected "+zr(a)+" but found "+zr(u)+" instead."}function mr(a,u){return u.some(function(p){return p.kind===a.kind})}function Be(a,u){return u.some(function(p){return p==="null"?a===null:p==="array"?Array.isArray(a):p==="object"?a&&!Array.isArray(a)&&typeof a=="object":p===typeof a})}var Xt=l(function(a,u){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(k){return(k=Math.round(k))<0?0:k>255?255:k}function B(k){return x(k[k.length-1]==="%"?parseFloat(k)/100*255:parseInt(k))}function I(k){return(z=k[k.length-1]==="%"?parseFloat(k)/100:parseFloat(k))<0?0:z>1?1:z;var z}function R(k,z,K){return K<0?K+=1:K>1&&(K-=1),6*K<1?k+(z-k)*K*6:2*K<1?z:3*K<2?k+(z-k)*(2/3-K)*6:k}try{u.parseCSSColor=function(k){var z,K=k.replace(/ /g,"").toLowerCase();if(K in p)return p[K].slice();if(K[0]==="#")return K.length===4?(z=parseInt(K.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:K.length===7&&(z=parseInt(K.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var q=K.indexOf("("),ie=K.indexOf(")");if(q!==-1&&ie+1===K.length){var he=K.substr(0,q),_e=K.substr(q+1,ie-(q+1)).split(","),Fe=1;switch(he){case"rgba":if(_e.length!==4)return null;Fe=I(_e.pop());case"rgb":return _e.length!==3?null:[B(_e[0]),B(_e[1]),B(_e[2]),Fe];case"hsla":if(_e.length!==4)return null;Fe=I(_e.pop());case"hsl":if(_e.length!==3)return null;var ke=(parseFloat(_e[0])%360+360)%360/360,Ve=I(_e[1]),je=I(_e[2]),Ze=je<=.5?je*(Ve+1):je+Ve-je*Ve,at=2*je-Ze;return[x(255*R(at,Ze,ke+1/3)),x(255*R(at,Ze,ke)),x(255*R(at,Ze,ke-1/3)),Fe];default:return null}}return null}}catch{}}).parseCSSColor,tn=function(a,u,p,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=p,this.a=x};tn.parse=function(a){if(a){if(a instanceof tn)return a;if(typeof a=="string"){var u=Xt(a);if(u)return new tn(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},tn.prototype.toString=function(){var a=this.toArray(),u=a[1],p=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(p)+","+x+")"},tn.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},tn.black=new tn(0,0,0,1),tn.white=new tn(1,1,1,1),tn.transparent=new tn(0,0,0,0),tn.red=new tn(1,0,0,1);var Vi=function(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Vi.prototype.compare=function(a,u){return this.collator.compare(a,u)},Vi.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ya=function(a,u,p,x,B){this.text=a,this.image=u,this.scale=p,this.fontStack=x,this.textColor=B},ui=function(a){this.sections=a};ui.fromString=function(a){return new ui([new ya(a,null,null,null,null)])},ui.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ui.factory=function(a){return a instanceof ui?a:ui.fromString(a)},ui.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ui.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var B={};x.fontStack&&(B["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(B["font-scale"]=x.scale),x.textColor&&(B["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(B)}}return a};var Wn=function(a){this.name=a.name,this.available=a.available};function Te(a,u,p,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof p=="number"&&p>=0&&p<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,p,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,p,x]:[a,u,p]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Wo(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof tn||a instanceof Vi||a instanceof ui||a instanceof Wn)return!0;if(Array.isArray(a)){for(var u=0,p=a;u<p.length;u+=1)if(!Wo(p[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Wo(a[x]))return!1;return!0}return!1}function Jn(a){if(a===null)return Dt;if(typeof a=="string")return Ft;if(typeof a=="boolean")return It;if(typeof a=="number")return ht;if(a instanceof tn)return jt;if(a instanceof Vi)return en;if(a instanceof ui)return cn;if(a instanceof Wn)return Jr;if(Array.isArray(a)){for(var u,p=a.length,x=0,B=a;x<B.length;x+=1){var I=Jn(B[x]);if(u){if(u===I)continue;u=er;break}u=I}return Kr(u||er,p)}return Nr}function Jo(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof tn||a instanceof ui||a instanceof Wn?a.toString():JSON.stringify(a)}Wn.prototype.toString=function(){return this.name},Wn.fromString=function(a){return a?new Wn({name:a,available:!1}):null},Wn.prototype.serialize=function(){return["image",this.name]};var Fi=function(a,u){this.type=a,this.value=u};Fi.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Wo(a[1]))return u.error("invalid value");var p=a[1],x=Jn(p),B=u.expectedType;return x.kind!=="array"||x.N!==0||!B||B.kind!=="array"||typeof B.N=="number"&&B.N!==0||(x=B),new Fi(x,p)},Fi.prototype.evaluate=function(){return this.value},Fi.prototype.eachChild=function(){},Fi.prototype.outputDefined=function(){return!0},Fi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toArray()):this.value instanceof ui?this.value.serialize():this.value};var hi=function(a){this.name="ExpressionEvaluationError",this.message=a};hi.prototype.toJSON=function(){return this.message};var Mi={string:Ft,number:ht,boolean:It,object:Nr},Ln=function(a,u){this.type=a,this.args=u};Ln.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p,x=1,B=a[0];if(B==="array"){var I,R;if(a.length>2){var k=a[1];if(typeof k!="string"||!(k in Mi)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=Mi[k],x++}else I=er;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=a[2],x++}p=Kr(I,R)}else p=Mi[B];for(var z=[];x<a.length;x++){var K=u.parse(a[x],x,er);if(!K)return null;z.push(K)}return new Ln(p,z)},Ln.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var p=this.args[u].evaluate(a);if(!Xr(this.type,Jn(p)))return p;if(u===this.args.length-1)throw new hi("Expected value to be of type "+zr(this.type)+", but found "+zr(Jn(p))+" instead.")}return null},Ln.prototype.eachChild=function(a){this.args.forEach(a)},Ln.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ln.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){u.push(p.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(B){return B.serialize()}))};var gs=function(a){this.type=cn,this.sections=a};gs.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");for(var x=[],B=!1,I=1;I<=a.length-1;++I){var R=a[I];if(B&&typeof R=="object"&&!Array.isArray(R)){B=!1;var k=null;if(R["font-scale"]&&!(k=u.parse(R["font-scale"],1,ht)))return null;var z=null;if(R["text-font"]&&!(z=u.parse(R["text-font"],1,Kr(Ft))))return null;var K=null;if(R["text-color"]&&!(K=u.parse(R["text-color"],1,jt)))return null;var q=x[x.length-1];q.scale=k,q.font=z,q.textColor=K}else{var ie=u.parse(a[I],1,er);if(!ie)return null;var he=ie.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");B=!0,x.push({content:ie,scale:null,font:null,textColor:null})}}return new gs(x)},gs.prototype.evaluate=function(a){return new ui(this.sections.map(function(u){var p=u.content.evaluate(a);return Jn(p)===Jr?new ya("",p,null,null,null):new ya(Jo(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},gs.prototype.eachChild=function(a){for(var u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},gs.prototype.outputDefined=function(){return!1},gs.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a.push(x.content.serialize());var B={};x.scale&&(B["font-scale"]=x.scale.serialize()),x.font&&(B["text-font"]=x.font.serialize()),x.textColor&&(B["text-color"]=x.textColor.serialize()),a.push(B)}return a};var Wi=function(a){this.type=Jr,this.input=a};Wi.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var p=u.parse(a[1],1,Ft);return p?new Wi(p):u.error("No image name provided.")},Wi.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=Wn.fromString(u);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(u)>-1),p},Wi.prototype.eachChild=function(a){a(this.input)},Wi.prototype.outputDefined=function(){return!1},Wi.prototype.serialize=function(){return["image",this.input.serialize()]};var Gs={"to-boolean":It,"to-color":jt,"to-number":ht,"to-string":Ft},Sn=function(a,u){this.type=a,this.args=u};Sn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[0];if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Gs[p],B=[],I=1;I<a.length;I++){var R=u.parse(a[I],I,er);if(!R)return null;B.push(R)}return new Sn(x,B)},Sn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,p,x=0,B=this.args;x<B.length;x+=1){if(p=null,(u=B[x].evaluate(a))instanceof tn)return u;if(typeof u=="string"){var I=a.parseColor(u);if(I)return I}else if(Array.isArray(u)&&!(p=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Te(u[0],u[1],u[2],u[3])))return new tn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new hi(p||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var R=null,k=0,z=this.args;k<z.length;k+=1){if((R=z[k].evaluate(a))===null)return 0;var K=Number(R);if(!isNaN(K))return K}throw new hi("Could not convert "+JSON.stringify(R)+" to number.")}return this.type.kind==="formatted"?ui.fromString(Jo(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Wn.fromString(Jo(this.args[0].evaluate(a))):Jo(this.args[0].evaluate(a))},Sn.prototype.eachChild=function(a){this.args.forEach(a)},Sn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Sn.prototype.serialize=function(){if(this.type.kind==="formatted")return new gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wi(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var bc=["Unknown","Point","LineString","Polygon"],Ae=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ae.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ae.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?bc[this.feature.type]:this.feature.type:null},Ae.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ae.prototype.canonicalID=function(){return this.canonical},Ae.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ae.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=tn.parse(a)),u};var Me=function(a,u,p,x){this.name=a,this.type=u,this._evaluate=p,this.args=x};Me.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Me.prototype.eachChild=function(a){this.args.forEach(a)},Me.prototype.outputDefined=function(){return!1},Me.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Me.parse=function(a,u){var p,x=a[0],B=Me.definitions[x];if(!B)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(B)?B[0]:B.type,R=Array.isArray(B)?[[B[1],B[2]]]:B.overloads,k=R.filter(function(Br){var ir=Br[0];return!Array.isArray(ir)||ir.length===a.length-1}),z=null,K=0,q=k;K<q.length;K+=1){var ie=q[K],he=ie[0],_e=ie[1];z=new bi(u.registry,u.path,null,u.scope);for(var Fe=[],ke=!1,Ve=1;Ve<a.length;Ve++){var je=a[Ve],Ze=Array.isArray(he)?he[Ve-1]:he.type,at=z.parse(je,1+Fe.length,Ze);if(!at){ke=!0;break}Fe.push(at)}if(!ke)if(Array.isArray(he)&&he.length!==Fe.length)z.error("Expected "+he.length+" arguments, but found "+Fe.length+" instead.");else{for(var gt=0;gt<Fe.length;gt++){var _t=Array.isArray(he)?he[gt]:he.type,Rt=Fe[gt];z.concat(gt+1).checkSubtype(_t,Rt.type)}if(z.errors.length===0)return new Me(x,I,_e,Fe)}}if(k.length===1)(p=u.errors).push.apply(p,z.errors);else{for(var Wt=(k.length?k:R).map(function(Br){var ir;return ir=Br[0],Array.isArray(ir)?"("+ir.map(zr).join(", ")+")":"("+zr(ir.type)+"...)"}).join(" | "),$t=[],br=1;br<a.length;br++){var nr=u.parse(a[br],1+$t.length);if(!nr)return null;$t.push(zr(nr.type))}u.error("Expected arguments of type "+Wt+", but found ("+$t.join(", ")+") instead.")}return null},Me.register=function(a,u){for(var p in Me.definitions=u,u)a[p]=Me};var We=function(a,u,p){this.type=en,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u};function vt(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function Vt(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function jr(a,u){var p=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,B=Math.pow(2,u.z);return[Math.round(p*B*8192),Math.round(x*B*8192)]}function Ir(a,u,p){return u[1]>a[1]!=p[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]}function Dn(a,u){for(var p,x,B,I,R,k,z,K=!1,q=0,ie=u.length;q<ie;q++)for(var he=u[q],_e=0,Fe=he.length;_e<Fe-1;_e++){if((I=(p=a)[0]-(x=he[_e])[0])*(z=p[1]-(B=he[_e+1])[1])-(k=p[0]-B[0])*(R=p[1]-x[1])==0&&I*k<=0&&R*z<=0)return!1;Ir(a,he[_e],he[_e+1])&&(K=!K)}return K}function Ts(a,u){for(var p=0;p<u.length;p++)if(Dn(a,u[p]))return!0;return!1}function cs(a,u,p,x){var B=x[0]-p[0],I=x[1]-p[1],R=(a[0]-p[0])*I-B*(a[1]-p[1]),k=(u[0]-p[0])*I-B*(u[1]-p[1]);return R>0&&k<0||R<0&&k>0}function to(a,u,p){for(var x=0,B=p;x<B.length;x+=1)for(var I=B[x],R=0;R<I.length-1;++R)if((ie=[(q=I[R+1])[0]-(K=I[R])[0],q[1]-K[1]])[0]*(he=[(z=u)[0]-(k=a)[0],z[1]-k[1]])[1]-ie[1]*he[0]!=0&&cs(k,z,K,q)&&cs(K,q,k,z))return!0;var k,z,K,q,ie,he;return!1}function Pf(a,u){for(var p=0;p<a.length;++p)if(!Dn(a[p],u))return!1;for(var x=0;x<a.length-1;++x)if(to(a[x],a[x+1],u))return!1;return!0}function Ah(a,u){for(var p=0;p<u.length;p++)if(Pf(a,u[p]))return!0;return!1}function ba(a,u,p){for(var x=[],B=0;B<a.length;B++){for(var I=[],R=0;R<a[B].length;R++){var k=jr(a[B][R],p);vt(u,k),I.push(k)}x.push(I)}return x}function vc(a,u,p){for(var x=[],B=0;B<a.length;B++){var I=ba(a[B],u,p);x.push(I)}return x}function xc(a,u,p,x){if(a[0]<p[0]||a[0]>p[2]){var B=.5*x,I=a[0]-p[0]>B?-x:p[0]-a[0]>B?x:0;I===0&&(I=a[0]-p[2]>B?-x:p[2]-a[0]>B?x:0),a[0]+=I}vt(u,a)}function Lf(a,u,p,x){for(var B=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],R=[],k=0,z=a;k<z.length;k+=1)for(var K=0,q=z[k];K<q.length;K+=1){var ie=q[K],he=[ie.x+I[0],ie.y+I[1]];xc(he,u,p,B),R.push(he)}return R}function wc(a,u,p,x){for(var B,I=8192*Math.pow(2,x.z),R=[8192*x.x,8192*x.y],k=[],z=0,K=a;z<K.length;z+=1){for(var q=[],ie=0,he=K[z];ie<he.length;ie+=1){var _e=he[ie],Fe=[_e.x+R[0],_e.y+R[1]];vt(u,Fe),q.push(Fe)}k.push(q)}if(u[2]-u[0]<=I/2){(B=u)[0]=B[1]=1/0,B[2]=B[3]=-1/0;for(var ke=0,Ve=k;ke<Ve.length;ke+=1)for(var je=0,Ze=Ve[ke];je<Ze.length;je+=1)xc(Ze[je],u,p,I)}return k}We.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");var x=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,It);if(!x)return null;var B=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,It);if(!B)return null;var I=null;return p.locale&&!(I=u.parse(p.locale,1,Ft))?null:new We(x,B,I)},We.prototype.evaluate=function(a){return new Vi(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},We.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},We.prototype.outputDefined=function(){return!1},We.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var zs=function(a,u){this.type=It,this.geojson=a,this.geometries=u};function Ko(a){if(a instanceof Me&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof zs)return!1;var u=!0;return a.eachChild(function(p){u&&!Ko(p)&&(u=!1)}),u}function va(a){if(a instanceof Me&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(p){u&&!va(p)&&(u=!1)}),u}function Ja(a,u){if(a instanceof Me&&u.indexOf(a.name)>=0)return!1;var p=!0;return a.eachChild(function(x){p&&!Ja(x,u)&&(p=!1)}),p}zs.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Wo(a[1])){var p=a[1];if(p.type==="FeatureCollection")for(var x=0;x<p.features.length;++x){var B=p.features[x].geometry.type;if(B==="Polygon"||B==="MultiPolygon")return new zs(p,p.features[x].geometry)}else if(p.type==="Feature"){var I=p.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new zs(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new zs(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},zs.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var R=ba(p.coordinates,B,I),k=Lf(u.geometry(),x,B,I);if(!Vt(x,B))return!1;for(var z=0,K=k;z<K.length;z+=1)if(!Dn(K[z],R))return!1}if(p.type==="MultiPolygon"){var q=vc(p.coordinates,B,I),ie=Lf(u.geometry(),x,B,I);if(!Vt(x,B))return!1;for(var he=0,_e=ie;he<_e.length;he+=1)if(!Ts(_e[he],q))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var R=ba(p.coordinates,B,I),k=wc(u.geometry(),x,B,I);if(!Vt(x,B))return!1;for(var z=0,K=k;z<K.length;z+=1)if(!Pf(K[z],R))return!1}if(p.type==="MultiPolygon"){var q=vc(p.coordinates,B,I),ie=wc(u.geometry(),x,B,I);if(!Vt(x,B))return!1;for(var he=0,_e=ie;he<_e.length;he+=1)if(!Ah(_e[he],q))return!1}return!0})(a,this.geometries)}return!1},zs.prototype.eachChild=function(){},zs.prototype.outputDefined=function(){return!0},zs.prototype.serialize=function(){return["within",this.geojson]};var xa=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};xa.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var p=a[1];return u.scope.has(p)?new xa(p,u.scope.get(p)):u.error('Unknown variable "'+p+'". Make sure "'+p+'" has been bound in an enclosing "let" expression before using it.',1)},xa.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},xa.prototype.eachChild=function(){},xa.prototype.outputDefined=function(){return!1},xa.prototype.serialize=function(){return["var",this.name]};var bi=function(a,u,p,x,B){u===void 0&&(u=[]),x===void 0&&(x=new Pt),B===void 0&&(B=[]),this.registry=a,this.path=u,this.key=u.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=B,this.expectedType=p};function Lo(a,u){for(var p,x=a.length-1,B=0,I=x,R=0;B<=I;)if((p=a[R=Math.floor((B+I)/2)])<=u){if(R===x||u<a[R+1])return R;B=R+1}else{if(!(p>u))throw new hi("Input is not a number.");I=R-1}return 0}bi.prototype.parse=function(a,u,p,x,B){return B===void 0&&(B={}),u?this.concat(u,p,x)._parse(a,B):this._parse(a,B)},bi.prototype._parse=function(a,u){function p(K,q,ie){return ie==="assert"?new Ln(q,[K]):ie==="coerce"?new Sn(q,[K]):K}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var B=this.registry[x];if(B){var I=B.parse(a,this);if(!I)return null;if(this.expectedType){var R=this.expectedType,k=I.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||k.kind!=="value")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(R,k))return null}else I=p(I,R,u.typeAnnotation||"coerce");else I=p(I,R,u.typeAnnotation||"assert")}if(!(I instanceof Fi)&&I.type.kind!=="resolvedImage"&&(function K(q){if(q instanceof xa)return K(q.boundExpression);if(q instanceof Me&&q.name==="error"||q instanceof We||q instanceof zs)return!1;var ie=q instanceof Sn||q instanceof Ln,he=!0;return q.eachChild(function(_e){he=ie?he&&K(_e):he&&_e instanceof Fi}),!!he&&Ko(q)&&Ja(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])})(I)){var z=new Ae;try{I=new Fi(I.type,I.evaluate(z))}catch(K){return this.error(K.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},bi.prototype.concat=function(a,u,p){var x=typeof a=="number"?this.path.concat(a):this.path,B=p?this.scope.concat(p):this.scope;return new bi(this.registry,x,u||null,B,this.errors)},bi.prototype.error=function(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];var x=""+this.key+u.map(function(B){return"["+B+"]"}).join("");this.errors.push(new Et(x,a))},bi.prototype.checkSubtype=function(a,u){var p=Xr(a,u);return p&&this.error(p),p};var zn=function(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,B=p;x<B.length;x+=1){var I=B[x],R=I[1];this.labels.push(I[0]),this.outputs.push(R)}};function fi(a,u,p){return a*(1-p)+u*p}zn.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var p=u.parse(a[1],1,ht);if(!p)return null;var x=[],B=null;u.expectedType&&u.expectedType.kind!=="value"&&(B=u.expectedType);for(var I=1;I<a.length;I+=2){var R=I===1?-1/0:a[I],k=a[I+1],z=I,K=I+1;if(typeof R!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(x.length&&x[x.length-1][0]>=R)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var q=u.parse(k,K,B);if(!q)return null;B=B||q.type,x.push([R,q])}return new zn(B,p,x)},zn.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;return x>=u[B-1]?p[B-1].evaluate(a):p[Lo(u,x)].evaluate(a)},zn.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},zn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},zn.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var Ka=Object.freeze({__proto__:null,number:fi,color:function(a,u,p){return new tn(fi(a.r,u.r,p),fi(a.g,u.g,p),fi(a.b,u.b,p),fi(a.a,u.a,p))},array:function(a,u,p){return a.map(function(x,B){return fi(x,u[B],p)})}}),Cc=6/29*3*(6/29),sA=Math.PI/180,oA=180/Math.PI;function gh(a){return a>.008856451679035631?Math.pow(a,1/3):a/Cc+4/29}function lu(a){return a>6/29?a*a*a:Cc*(a-4/29)}function Ml(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Xo(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function mh(a){var u=Xo(a.r),p=Xo(a.g),x=Xo(a.b),B=gh((.4124564*u+.3575761*p+.1804375*x)/.95047),I=gh((.2126729*u+.7151522*p+.072175*x)/1);return{l:116*I-16,a:500*(B-I),b:200*(I-gh((.0193339*u+.119192*p+.9503041*x)/1.08883)),alpha:a.a}}function _h(a){var u=(a.l+16)/116,p=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*lu(u),p=.95047*lu(p),x=1.08883*lu(x),new tn(Ml(3.2404542*p-1.5371385*u-.4985314*x),Ml(-.969266*p+1.8760108*u+.041556*x),Ml(.0556434*p-.2040259*u+1.0572252*x),a.alpha)}function cu(a,u,p){var x=u-a;return a+p*(x>180||x<-180?x-360*Math.round(x/360):x)}var xo={forward:mh,reverse:_h,interpolate:function(a,u,p){return{l:fi(a.l,u.l,p),a:fi(a.a,u.a,p),b:fi(a.b,u.b,p),alpha:fi(a.alpha,u.alpha,p)}}},ro={forward:function(a){var u=mh(a),p=u.l,x=u.a,B=u.b,I=Math.atan2(B,x)*oA;return{h:I<0?I+360:I,c:Math.sqrt(x*x+B*B),l:p,alpha:a.a}},reverse:function(a){var u=a.h*sA,p=a.c;return _h({l:a.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:a.alpha})},interpolate:function(a,u,p){return{h:cu(a.h,u.h,p),c:fi(a.c,u.c,p),l:fi(a.l,u.l,p),alpha:fi(a.alpha,u.alpha,p)}}},yh=Object.freeze({__proto__:null,lab:xo,hcl:ro}),Gi=function(a,u,p,x,B){this.type=a,this.operator=u,this.interpolation=p,this.input=x,this.labels=[],this.outputs=[];for(var I=0,R=B;I<R.length;I+=1){var k=R[I],z=k[1];this.labels.push(k[0]),this.outputs.push(z)}};function Ec(a,u,p,x){var B=x-p,I=a-p;return B===0?0:u===1?I/B:(Math.pow(u,I)-1)/(Math.pow(u,B)-1)}Gi.interpolationFactor=function(a,u,p,x){var B=0;if(a.name==="exponential")B=Ec(u,a.base,p,x);else if(a.name==="linear")B=Ec(u,1,p,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;B=new h(I[0],I[1],I[2],I[3]).solve(Ec(u,1,p,x))}return B},Gi.parse=function(a,u){var p=a[0],x=a[1],B=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var R=x[1];if(typeof R!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:R}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var k=x.slice(1);if(k.length!==4||k.some(function(Ve){return typeof Ve!="number"||Ve<0||Ve>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:k}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(B=u.parse(B,2,ht)))return null;var z=[],K=null;p==="interpolate-hcl"||p==="interpolate-lab"?K=jt:u.expectedType&&u.expectedType.kind!=="value"&&(K=u.expectedType);for(var q=0;q<I.length;q+=2){var ie=I[q],he=I[q+1],_e=q+3,Fe=q+4;if(typeof ie!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(z.length&&z[z.length-1][0]>=ie)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var ke=u.parse(he,Fe,K);if(!ke)return null;K=K||ke.type,z.push([ie,ke])}return K.kind==="number"||K.kind==="color"||K.kind==="array"&&K.itemType.kind==="number"&&typeof K.N=="number"?new Gi(K,p,x,B,z):u.error("Type "+zr(K)+" is not interpolatable.")},Gi.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;if(x>=u[B-1])return p[B-1].evaluate(a);var I=Lo(u,x),R=Gi.interpolationFactor(this.interpolation,x,u[I],u[I+1]),k=p[I].evaluate(a),z=p[I+1].evaluate(a);return this.operator==="interpolate"?Ka[this.type.kind.toLowerCase()](k,z,R):this.operator==="interpolate-hcl"?ro.reverse(ro.interpolate(ro.forward(k),ro.forward(z),R)):xo.reverse(xo.interpolate(xo.forward(k),xo.forward(z),R))},Gi.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},Gi.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Gi.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],p=0;p<this.labels.length;p++)u.push(this.labels[p],this.outputs[p].serialize());return u};var wa=function(a,u){this.type=a,this.args=u};wa.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var p=null,x=u.expectedType;x&&x.kind!=="value"&&(p=x);for(var B=[],I=0,R=a.slice(1);I<R.length;I+=1){var k=u.parse(R[I],1+B.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,B.push(k)}var z=x&&B.some(function(K){return Xr(x,K.type)});return new wa(z?er:p,B)},wa.prototype.evaluate=function(a){for(var u,p=null,x=0,B=0,I=this.args;B<I.length&&(x++,(p=I[B].evaluate(a))&&p instanceof Wn&&!p.available&&(u||(u=p.name),p=null,x===this.args.length&&(p=u)),p===null);B+=1);return p},wa.prototype.eachChild=function(a){this.args.forEach(a)},wa.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wa.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ca=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};Ca.prototype.evaluate=function(a){return this.result.evaluate(a)},Ca.prototype.eachChild=function(a){for(var u=0,p=this.bindings;u<p.length;u+=1)a(p[u][1]);a(this.result)},Ca.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var p=[],x=1;x<a.length-1;x+=2){var B=a[x];if(typeof B!="string")return u.error("Expected string, but found "+typeof B+" instead.",x);if(/[^a-zA-Z0-9_]/.test(B))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=u.parse(a[x+1],x+1);if(!I)return null;p.push([B,I])}var R=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return R?new Ca(p,R):null},Ca.prototype.outputDefined=function(){return this.result.outputDefined()},Ca.prototype.serialize=function(){for(var a=["let"],u=0,p=this.bindings;u<p.length;u+=1){var x=p[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var Ea=function(a,u,p){this.type=a,this.index=u,this.input=p};Ea.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ht),x=u.parse(a[2],2,Kr(u.expectedType||er));return p&&x?new Ea(x.type.itemType,p,x):null},Ea.prototype.evaluate=function(a){var u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new hi("Array index out of bounds: "+u+" < 0.");if(u>=p.length)throw new hi("Array index out of bounds: "+u+" > "+(p.length-1)+".");if(u!==Math.floor(u))throw new hi("Array index must be an integer, but found "+u+" instead.");return p[u]},Ea.prototype.eachChild=function(a){a(this.index),a(this.input)},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Xa=function(a,u){this.type=It,this.needle=a,this.haystack=u};Xa.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,er),x=u.parse(a[2],2,er);return p&&x?mr(p.type,[It,Ft,ht,Dt,er])?new Xa(p,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+zr(p.type)+" instead"):null},Xa.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Be(u,["boolean","string","number","null"]))throw new hi("Expected first argument to be of type boolean, string, number or null, but found "+zr(Jn(u))+" instead.");if(!Be(p,["string","array"]))throw new hi("Expected second argument to be of type array or string, but found "+zr(Jn(p))+" instead.");return p.indexOf(u)>=0},Xa.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Xa.prototype.outputDefined=function(){return!0},Xa.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ba=function(a,u,p){this.type=ht,this.needle=a,this.haystack=u,this.fromIndex=p};Ba.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,er),x=u.parse(a[2],2,er);if(!p||!x)return null;if(!mr(p.type,[It,Ft,ht,Dt,er]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+zr(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,ht);return B?new Ba(p,x,B):null}return new Ba(p,x)},Ba.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Be(u,["boolean","string","number","null"]))throw new hi("Expected first argument to be of type boolean, string, number or null, but found "+zr(Jn(u))+" instead.");if(!Be(p,["string","array"]))throw new hi("Expected second argument to be of type array or string, but found "+zr(Jn(p))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return p.indexOf(u,x)}return p.indexOf(u)},Ba.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Qa=function(a,u,p,x,B,I){this.inputType=a,this.type=u,this.input=p,this.cases=x,this.outputs=B,this.otherwise=I};Qa.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var p,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var B={},I=[],R=2;R<a.length-1;R+=2){var k=a[R],z=a[R+1];Array.isArray(k)||(k=[k]);var K=u.concat(R);if(k.length===0)return K.error("Expected at least one branch label.");for(var q=0,ie=k;q<ie.length;q+=1){var he=ie[q];if(typeof he!="number"&&typeof he!="string")return K.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return K.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return K.error("Numeric branch labels must be integer values.");if(p){if(K.checkSubtype(p,Jn(he)))return null}else p=Jn(he);if(B[String(he)]!==void 0)return K.error("Branch labels must be unique.");B[String(he)]=I.length}var _e=u.parse(z,R,x);if(!_e)return null;x=x||_e.type,I.push(_e)}var Fe=u.parse(a[1],1,er);if(!Fe)return null;var ke=u.parse(a[a.length-1],a.length-1,x);return ke?Fe.type.kind!=="value"&&u.concat(1).checkSubtype(p,Fe.type)?null:new Qa(p,x,Fe,B,I,ke):null},Qa.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Jn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},Qa.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Qa.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Qa.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],p=[],x={},B=0,I=Object.keys(this.cases).sort();B<I.length;B+=1){var R=I[B];(ie=x[this.cases[R]])===void 0?(x[this.cases[R]]=p.length,p.push([this.cases[R],[R]])):p[ie][1].push(R)}for(var k=function(_e){return a.inputType.kind==="number"?Number(_e):_e},z=0,K=p;z<K.length;z+=1){var q=K[z],ie=q[0],he=q[1];u.push(he.length===1?k(he[0]):he.map(k)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Za=function(a,u,p){this.type=a,this.branches=u,this.otherwise=p};Za.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);for(var x=[],B=1;B<a.length-1;B+=2){var I=u.parse(a[B],B,It);if(!I)return null;var R=u.parse(a[B+1],B+1,p);if(!R)return null;x.push([I,R]),p=p||R.type}var k=u.parse(a[a.length-1],a.length-1,p);return k?new Za(p,x,k):null},Za.prototype.evaluate=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];if(x[0].evaluate(a))return B.evaluate(a)}return this.otherwise.evaluate(a)},Za.prototype.eachChild=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];a(x[0]),a(B)}a(this.otherwise)},Za.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Za.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ta=function(a,u,p,x){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=x};function Rf(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Of(a,u,p,x){return x.compare(u,p)===0}function In(a,u,p){var x=a!=="=="&&a!=="!=";return(function(){function B(I,R,k){this.type=It,this.lhs=I,this.rhs=R,this.collator=k,this.hasUntypedArgument=I.type.kind==="value"||R.type.kind==="value"}return B.parse=function(I,R){if(I.length!==3&&I.length!==4)return R.error("Expected two or three arguments.");var k=I[0],z=R.parse(I[1],1,er);if(!z)return null;if(!Rf(k,z.type))return R.concat(1).error('"'+k+`" comparisons are not supported for type '`+zr(z.type)+"'.");var K=R.parse(I[2],2,er);if(!K)return null;if(!Rf(k,K.type))return R.concat(2).error('"'+k+`" comparisons are not supported for type '`+zr(K.type)+"'.");if(z.type.kind!==K.type.kind&&z.type.kind!=="value"&&K.type.kind!=="value")return R.error("Cannot compare types '"+zr(z.type)+"' and '"+zr(K.type)+"'.");x&&(z.type.kind==="value"&&K.type.kind!=="value"?z=new Ln(K.type,[z]):z.type.kind!=="value"&&K.type.kind==="value"&&(K=new Ln(z.type,[K])));var q=null;if(I.length===4){if(z.type.kind!=="string"&&K.type.kind!=="string"&&z.type.kind!=="value"&&K.type.kind!=="value")return R.error("Cannot use collator to compare non-string types.");if(!(q=R.parse(I[3],3,en)))return null}return new B(z,K,q)},B.prototype.evaluate=function(I){var R=this.lhs.evaluate(I),k=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var z=Jn(R),K=Jn(k);if(z.kind!==K.kind||z.kind!=="string"&&z.kind!=="number")throw new hi('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+z.kind+", "+K.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var q=Jn(R),ie=Jn(k);if(q.kind!=="string"||ie.kind!=="string")return u(I,R,k)}return this.collator?p(I,R,k,this.collator.evaluate(I)):u(I,R,k)},B.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},B.prototype.outputDefined=function(){return!0},B.prototype.serialize=function(){var I=[a];return this.eachChild(function(R){I.push(R.serialize())}),I},B})()}Ta.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,er),x=u.parse(a[2],2,ht);if(!p||!x)return null;if(!mr(p.type,[Kr(er),Ft,er]))return u.error("Expected first argument to be of type array or string, but found "+zr(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,ht);return B?new Ta(p.type,p,x,B):null}return new Ta(p.type,p,x)},Ta.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!Be(u,["string","array"]))throw new hi("Expected first argument to be of type array or string, but found "+zr(Jn(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(p,x)}return u.slice(p)},Ta.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Ta.prototype.outputDefined=function(){return!1},Ta.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var uu=In("==",function(a,u,p){return u===p},Of),hu=In("!=",function(a,u,p){return u!==p},function(a,u,p,x){return!Of(0,u,p,x)}),Df=In("<",function(a,u,p){return u<p},function(a,u,p,x){return x.compare(u,p)<0}),Ff=In(">",function(a,u,p){return u>p},function(a,u,p,x){return x.compare(u,p)>0}),Pl=In("<=",function(a,u,p){return u<=p},function(a,u,p,x){return x.compare(u,p)<=0}),kf=In(">=",function(a,u,p){return u>=p},function(a,u,p,x){return x.compare(u,p)>=0}),Qo=function(a,u,p,x,B){this.type=Ft,this.number=a,this.locale=u,this.currency=p,this.minFractionDigits=x,this.maxFractionDigits=B};Qo.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var p=u.parse(a[1],1,ht);if(!p)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var B=null;if(x.locale&&!(B=u.parse(x.locale,1,Ft)))return null;var I=null;if(x.currency&&!(I=u.parse(x.currency,1,Ft)))return null;var R=null;if(x["min-fraction-digits"]&&!(R=u.parse(x["min-fraction-digits"],1,ht)))return null;var k=null;return x["max-fraction-digits"]&&!(k=u.parse(x["max-fraction-digits"],1,ht))?null:new Qo(p,B,I,R,k)},Qo.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Qo.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Zo=function(a){this.type=ht,this.input=a};Zo.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+zr(p.type)+" instead."):new Zo(p):null},Zo.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new hi("Expected value to be of type string or array, but found "+zr(Jn(u))+" instead.")},Zo.prototype.eachChild=function(a){a(this.input)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var no={"==":uu,"!=":hu,">":Ff,"<":Df,">=":kf,"<=":Pl,array:Ln,at:Ea,boolean:Ln,case:Za,coalesce:wa,collator:We,format:gs,image:Wi,in:Xa,"index-of":Ba,interpolate:Gi,"interpolate-hcl":Gi,"interpolate-lab":Gi,length:Zo,let:Ca,literal:Fi,match:Qa,number:Ln,"number-format":Qo,object:Ln,slice:Ta,step:zn,string:Ln,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:xa,within:zs};function Nf(a,u){var p=u[0],x=u[1],B=u[2],I=u[3];p=p.evaluate(a),x=x.evaluate(a),B=B.evaluate(a);var R=I?I.evaluate(a):1,k=Te(p,x,B,R);if(k)throw new hi(k);return new tn(p/255*R,x/255*R,B/255*R,R)}function fu(a,u){return a in u}function du(a,u){var p=u[a];return p===void 0?null:p}function $a(a){return{type:a}}function bh(a){return{result:"success",value:a}}function $o(a){return{result:"error",value:a}}function qo(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Bc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Rn(a){return!!a.expression&&a.expression.interpolated}function Fn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function pu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function aA(a){return a}function Ll(a,u,p){return a!==void 0?a:u!==void 0?u:p!==void 0?p:void 0}function Uf(a,u,p,x,B){return Ll(typeof p===B?x[p]:void 0,a.default,u.default)}function lA(a,u,p){if(Fn(p)!=="number")return Ll(a.default,u.default);var x=a.stops.length;if(x===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[x-1][0])return a.stops[x-1][1];var B=Lo(a.stops.map(function(I){return I[0]}),p);return a.stops[B][1]}function Gf(a,u,p){var x=a.base!==void 0?a.base:1;if(Fn(p)!=="number")return Ll(a.default,u.default);var B=a.stops.length;if(B===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[B-1][0])return a.stops[B-1][1];var I=Lo(a.stops.map(function(ie){return ie[0]}),p),R=(function(ie,he,_e,Fe){var ke=Fe-_e,Ve=ie-_e;return ke===0?0:he===1?Ve/ke:(Math.pow(he,Ve)-1)/(Math.pow(he,ke)-1)})(p,x,a.stops[I][0],a.stops[I+1][0]),k=a.stops[I][1],z=a.stops[I+1][1],K=Ka[u.type]||aA;if(a.colorSpace&&a.colorSpace!=="rgb"){var q=yh[a.colorSpace];K=function(ie,he){return q.reverse(q.interpolate(q.forward(ie),q.forward(he),R))}}return typeof k.evaluate=="function"?{evaluate:function(){for(var ie=[],he=arguments.length;he--;)ie[he]=arguments[he];var _e=k.evaluate.apply(void 0,ie),Fe=z.evaluate.apply(void 0,ie);if(_e!==void 0&&Fe!==void 0)return K(_e,Fe,R)}}:K(k,z,R)}function ts(a,u,p){return u.type==="color"?p=tn.parse(p):u.type==="formatted"?p=ui.fromString(p.toString()):u.type==="resolvedImage"?p=Wn.fromString(p.toString()):Fn(p)===u.type||u.type==="enum"&&u.values[p]||(p=void 0),Ll(p,a.default,u.default)}Me.register(no,{error:[{kind:"error"},[Ft],function(a,u){throw new hi(u[0].evaluate(a))}],typeof:[Ft,[er],function(a,u){return zr(Jn(u[0].evaluate(a)))}],"to-rgba":[Kr(ht,4),[jt],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[jt,[ht,ht,ht],Nf],rgba:[jt,[ht,ht,ht,ht],Nf],has:{type:It,overloads:[[[Ft],function(a,u){return fu(u[0].evaluate(a),a.properties())}],[[Ft,Nr],function(a,u){var p=u[1];return fu(u[0].evaluate(a),p.evaluate(a))}]]},get:{type:er,overloads:[[[Ft],function(a,u){return du(u[0].evaluate(a),a.properties())}],[[Ft,Nr],function(a,u){var p=u[1];return du(u[0].evaluate(a),p.evaluate(a))}]]},"feature-state":[er,[Ft],function(a,u){return du(u[0].evaluate(a),a.featureState||{})}],properties:[Nr,[],function(a){return a.properties()}],"geometry-type":[Ft,[],function(a){return a.geometryType()}],id:[er,[],function(a){return a.id()}],zoom:[ht,[],function(a){return a.globals.zoom}],"heatmap-density":[ht,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ht,[],function(a){return a.globals.lineProgress||0}],accumulated:[er,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ht,$a(ht),function(a,u){for(var p=0,x=0,B=u;x<B.length;x+=1)p+=B[x].evaluate(a);return p}],"*":[ht,$a(ht),function(a,u){for(var p=1,x=0,B=u;x<B.length;x+=1)p*=B[x].evaluate(a);return p}],"-":{type:ht,overloads:[[[ht,ht],function(a,u){var p=u[1];return u[0].evaluate(a)-p.evaluate(a)}],[[ht],function(a,u){return-u[0].evaluate(a)}]]},"/":[ht,[ht,ht],function(a,u){var p=u[1];return u[0].evaluate(a)/p.evaluate(a)}],"%":[ht,[ht,ht],function(a,u){var p=u[1];return u[0].evaluate(a)%p.evaluate(a)}],ln2:[ht,[],function(){return Math.LN2}],pi:[ht,[],function(){return Math.PI}],e:[ht,[],function(){return Math.E}],"^":[ht,[ht,ht],function(a,u){var p=u[1];return Math.pow(u[0].evaluate(a),p.evaluate(a))}],sqrt:[ht,[ht],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[ht,[ht],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[ht,[ht],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[ht,[ht],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[ht,[ht],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[ht,[ht],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[ht,[ht],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[ht,[ht],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[ht,[ht],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[ht,[ht],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[ht,$a(ht),function(a,u){return Math.min.apply(Math,u.map(function(p){return p.evaluate(a)}))}],max:[ht,$a(ht),function(a,u){return Math.max.apply(Math,u.map(function(p){return p.evaluate(a)}))}],abs:[ht,[ht],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[ht,[ht],function(a,u){var p=u[0].evaluate(a);return p<0?-Math.round(-p):Math.round(p)}],floor:[ht,[ht],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[ht,[ht],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[It,[Ft,er],function(a,u){var p=u[0],x=u[1];return a.properties()[p.value]===x.value}],"filter-id-==":[It,[er],function(a,u){var p=u[0];return a.id()===p.value}],"filter-type-==":[It,[Ft],function(a,u){var p=u[0];return a.geometryType()===p.value}],"filter-<":[It,[Ft,er],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<I}],"filter-id-<":[It,[er],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<B}],"filter->":[It,[Ft,er],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>I}],"filter-id->":[It,[er],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>B}],"filter-<=":[It,[Ft,er],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<=I}],"filter-id-<=":[It,[er],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<=B}],"filter->=":[It,[Ft,er],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>=I}],"filter-id->=":[It,[er],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>=B}],"filter-has":[It,[er],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[It,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[It,[Kr(Ft)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[It,[Kr(er)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[It,[Ft,Kr(er)],function(a,u){var p=u[0];return u[1].value.indexOf(a.properties()[p.value])>=0}],"filter-in-large":[It,[Ft,Kr(er)],function(a,u){var p=u[0],x=u[1];return(function(B,I,R,k){for(;R<=k;){var z=R+k>>1;if(I[z]===B)return!0;I[z]>B?k=z-1:R=z+1}return!1})(a.properties()[p.value],x.value,0,x.value.length-1)}],all:{type:It,overloads:[[[It,It],function(a,u){var p=u[1];return u[0].evaluate(a)&&p.evaluate(a)}],[$a(It),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(!x[p].evaluate(a))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],function(a,u){var p=u[1];return u[0].evaluate(a)||p.evaluate(a)}],[$a(It),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(x[p].evaluate(a))return!0;return!1}]]},"!":[It,[It],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[It,[Ft],function(a,u){var p=a.globals&&a.globals.isSupportedScript;return!p||p(u[0].evaluate(a))}],upcase:[Ft,[Ft],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Ft,[Ft],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Ft,$a(er),function(a,u){return u.map(function(p){return Jo(p.evaluate(a))}).join("")}],"resolved-locale":[Ft,[en],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var Sa=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new Ae,this._defaultValue=u?(function(p){return p.type==="color"&&pu(p.default)?new tn(0,0,0,0):p.type==="color"?tn.parse(p.default)||null:p.default===void 0?null:p.default})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function wo(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in no}function Au(a,u){var p=new bi(no,[],u?(function(B){var I={color:jt,string:Ft,number:ht,enum:Ft,boolean:It,formatted:cn,resolvedImage:Jr};return B.type==="array"?Kr(I[B.value]||er,B.length):I[B.type]})(u):void 0),x=p.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?bh(new Sa(x,u)):$o(p.errors)}Sa.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},Sa.prototype.evaluate=function(a,u,p,x,B,I){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I||null;try{var R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new hi("Expected value to be one of "+Object.keys(this._enumValues).map(function(k){return JSON.stringify(k)}).join(", ")+", but found "+JSON.stringify(R)+" instead.");return R}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}};var qa=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!va(u.expression)};qa.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},qa.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)};var Rl=function(a,u,p,x){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!va(u.expression),this.interpolationType=x};function js(a,u){if((a=Au(a,u)).result==="error")return a;var p=a.value.expression,x=Ko(p);if(!x&&!qo(u))return $o([new Et("","data expressions not supported")]);var B=Ja(p,["zoom"]);if(!B&&!Bc(u))return $o([new Et("","zoom expressions not supported")]);var I=(function R(k){var z=null;if(k instanceof Ca)z=R(k.result);else if(k instanceof wa)for(var K=0,q=k.args;K<q.length&&!(z=R(q[K]));K+=1);else(k instanceof zn||k instanceof Gi)&&k.input instanceof Me&&k.input.name==="zoom"&&(z=k);return z instanceof Et||k.eachChild(function(ie){var he=R(ie);he instanceof Et?z=he:!z&&he?z=new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&he&&z!==he&&(z=new Et("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z})(p);return I||B?I instanceof Et?$o([I]):I instanceof Gi&&!Rn(u)?$o([new Et("",'"interpolate" expressions cannot be used with this property')]):bh(I?new Rl(x?"camera":"composite",a.value,I.labels,I instanceof Gi?I.interpolation:void 0):new qa(x?"constant":"source",a.value)):$o([new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Rl.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},Rl.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)},Rl.prototype.interpolationFactor=function(a,u,p){return this.interpolationType?Gi.interpolationFactor(this.interpolationType,a,u,p):0};var Ya=function(a,u){this._parameters=a,this._specification=u,le(this,(function p(x,B){var I,R,k,z=B.type==="color",K=x.stops&&typeof x.stops[0][0]=="object",q=K||!(K||x.property!==void 0),ie=x.type||(Rn(B)?"exponential":"interval");if(z&&((x=le({},x)).stops&&(x.stops=x.stops.map(function(nr){return[nr[0],tn.parse(nr[1])]})),x.default=tn.parse(x.default?x.default:B.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!yh[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(ie==="exponential")I=Gf;else if(ie==="interval")I=lA;else if(ie==="categorical"){I=Uf,R=Object.create(null);for(var he=0,_e=x.stops;he<_e.length;he+=1){var Fe=_e[he];R[Fe[0]]=Fe[1]}k=typeof x.stops[0][0]}else{if(ie!=="identity")throw new Error('Unknown function type "'+ie+'"');I=ts}if(K){for(var ke={},Ve=[],je=0;je<x.stops.length;je++){var Ze=x.stops[je],at=Ze[0].zoom;ke[at]===void 0&&(ke[at]={zoom:at,type:x.type,property:x.property,default:x.default,stops:[]},Ve.push(at)),ke[at].stops.push([Ze[0].value,Ze[1]])}for(var gt=[],_t=0,Rt=Ve;_t<Rt.length;_t+=1){var Wt=Rt[_t];gt.push([ke[Wt].zoom,p(ke[Wt],B)])}var $t={name:"linear"};return{kind:"composite",interpolationType:$t,interpolationFactor:Gi.interpolationFactor.bind(void 0,$t),zoomStops:gt.map(function(nr){return nr[0]}),evaluate:function(nr,Br){var ir=nr.zoom;return Gf({stops:gt,base:x.base},B,ir).evaluate(ir,Br)}}}if(q){var br=ie==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:br,interpolationFactor:Gi.interpolationFactor.bind(void 0,br),zoomStops:x.stops.map(function(nr){return nr[0]}),evaluate:function(nr){return I(x,B,nr.zoom,R,k)}}}return{kind:"source",evaluate:function(nr,Br){var ir=Br&&Br.properties?Br.properties[x.property]:void 0;return ir===void 0?Ll(x.default,B.default):I(x,B,ir,R,k)}}})(this._parameters,this._specification))};function Hs(a){var u=a.key,p=a.value,x=a.valueSpec||{},B=a.objectElementValidators||{},I=a.style,R=a.styleSpec,k=[],z=Fn(p);if(z!=="object")return[new we(u,p,"object expected, "+z+" found")];for(var K in p){var q=K.split(".")[0],ie=x[q]||x["*"],he=void 0;if(B[q])he=B[q];else if(x[q])he=hn;else if(B["*"])he=B["*"];else{if(!x["*"]){k.push(new we(u,p[K],'unknown property "'+K+'"'));continue}he=hn}k=k.concat(he({key:(u&&u+".")+K,value:p[K],valueSpec:ie,style:I,styleSpec:R,object:p,objectKey:K},p))}for(var _e in x)B[_e]||x[_e].required&&x[_e].default===void 0&&p[_e]===void 0&&k.push(new we(u,p,'missing required property "'+_e+'"'));return k}function el(a){var u=a.value,p=a.valueSpec,x=a.style,B=a.styleSpec,I=a.key,R=a.arrayElementValidator||hn;if(Fn(u)!=="array")return[new we(I,u,"array expected, "+Fn(u)+" found")];if(p.length&&u.length!==p.length)return[new we(I,u,"array length "+p.length+" expected, length "+u.length+" found")];if(p["min-length"]&&u.length<p["min-length"])return[new we(I,u,"array length at least "+p["min-length"]+" expected, length "+u.length+" found")];var k={type:p.value,values:p.values};B.$version<7&&(k.function=p.function),Fn(p.value)==="object"&&(k=p.value);for(var z=[],K=0;K<u.length;K++)z=z.concat(R({array:u,arrayIndex:K,value:u[K],valueSpec:k,style:x,styleSpec:B,key:I+"["+K+"]"}));return z}function Ol(a){var u=a.key,p=a.value,x=a.valueSpec,B=Fn(p);return B==="number"&&p!=p&&(B="NaN"),B!=="number"?[new we(u,p,"number expected, "+B+" found")]:"minimum"in x&&p<x.minimum?[new we(u,p,p+" is less than the minimum value "+x.minimum)]:"maximum"in x&&p>x.maximum?[new we(u,p,p+" is greater than the maximum value "+x.maximum)]:[]}function Dl(a){var u,p,x,B=a.valueSpec,I=Ct(a.value.type),R={},k=I!=="categorical"&&a.value.property===void 0,z=!k,K=Fn(a.value.stops)==="array"&&Fn(a.value.stops[0])==="array"&&Fn(a.value.stops[0][0])==="object",q=Hs({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(_e){if(I==="identity")return[new we(_e.key,_e.value,'identity function may not have a "stops" property')];var Fe=[],ke=_e.value;return Fe=Fe.concat(el({key:_e.key,value:ke,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ie})),Fn(ke)==="array"&&ke.length===0&&Fe.push(new we(_e.key,ke,"array must have at least one stop")),Fe},default:function(_e){return hn({key:_e.key,value:_e.value,valueSpec:B,style:_e.style,styleSpec:_e.styleSpec})}}});return I==="identity"&&k&&q.push(new we(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||q.push(new we(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!Rn(a.valueSpec)&&q.push(new we(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(z&&!qo(a.valueSpec)?q.push(new we(a.key,a.value,"property functions not supported")):k&&!Bc(a.valueSpec)&&q.push(new we(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!K||a.value.property!==void 0||q.push(new we(a.key,a.value,'"property" property is required')),q;function ie(_e){var Fe=[],ke=_e.value,Ve=_e.key;if(Fn(ke)!=="array")return[new we(Ve,ke,"array expected, "+Fn(ke)+" found")];if(ke.length!==2)return[new we(Ve,ke,"array length 2 expected, length "+ke.length+" found")];if(K){if(Fn(ke[0])!=="object")return[new we(Ve,ke,"object expected, "+Fn(ke[0])+" found")];if(ke[0].zoom===void 0)return[new we(Ve,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new we(Ve,ke,"object stop key must have value")];if(x&&x>Ct(ke[0].zoom))return[new we(Ve,ke[0].zoom,"stop zoom values must appear in ascending order")];Ct(ke[0].zoom)!==x&&(x=Ct(ke[0].zoom),p=void 0,R={}),Fe=Fe.concat(Hs({key:Ve+"[0]",value:ke[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:Ol,value:he}}))}else Fe=Fe.concat(he({key:Ve+"[0]",value:ke[0],style:_e.style,styleSpec:_e.styleSpec},ke));return wo(Qe(ke[1]))?Fe.concat([new we(Ve+"[1]",ke[1],"expressions are not allowed in function stops.")]):Fe.concat(hn({key:Ve+"[1]",value:ke[1],valueSpec:B,style:_e.style,styleSpec:_e.styleSpec}))}function he(_e,Fe){var ke=Fn(_e.value),Ve=Ct(_e.value),je=_e.value!==null?_e.value:Fe;if(u){if(ke!==u)return[new we(_e.key,je,ke+" stop domain type must match previous stop domain type "+u)]}else u=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new we(_e.key,je,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&I!=="categorical"){var Ze="number expected, "+ke+" found";return qo(B)&&I===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new we(_e.key,je,Ze)]}return I!=="categorical"||ke!=="number"||isFinite(Ve)&&Math.floor(Ve)===Ve?I!=="categorical"&&ke==="number"&&p!==void 0&&Ve<p?[new we(_e.key,je,"stop domain values must appear in ascending order")]:(p=Ve,I==="categorical"&&Ve in R?[new we(_e.key,je,"stop domain values must be unique")]:(R[Ve]=!0,[])):[new we(_e.key,je,"integer expected, found "+Ve)]}}function tl(a){var u=(a.expressionContext==="property"?js:Au)(Qe(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new we(""+a.key+x.key,a.value,x.message)});var p=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!p.outputDefined())return[new we(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!va(p))return[new we(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!va(p))return[new we(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ja(p,["zoom","feature-state"]))return[new we(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Ko(p))return[new we(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fl(a){var u=a.key,p=a.value,x=a.valueSpec,B=[];return Array.isArray(x.values)?x.values.indexOf(Ct(p))===-1&&B.push(new we(u,p,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(p)+" found")):Object.keys(x.values).indexOf(Ct(p))===-1&&B.push(new we(u,p,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(p)+" found")),B}function gu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,p=a.slice(1);u<p.length;u+=1){var x=p[u];if(!gu(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}Ya.deserialize=function(a){return new Ya(a._parameters,a._specification)},Ya.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Tc={type:"boolean",default:!1};function mu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};gu(a)||(a=Sc(a));var u=Au(a,Tc);if(u.result==="error")throw new Error(u.value.map(function(p){return p.key+": "+p.message}).join(", "));return{filter:function(p,x,B){return u.value.evaluate(p,x,{},B)},needGeometry:(function p(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var B=1;B<x.length;B++)if(p(x[B]))return!0;return!1})(a)}}function cA(a,u){return a<u?-1:a>u?1:0}function Sc(a){if(!a)return!0;var u,p=a[0];return a.length<=1?p!=="any":p==="=="?_u(a[1],a[2],"=="):p==="!="?yu(_u(a[1],a[2],"==")):p==="<"||p===">"||p==="<="||p===">="?_u(a[1],a[2],p):p==="any"?(u=a.slice(1),["any"].concat(u.map(Sc))):p==="all"?["all"].concat(a.slice(1).map(Sc)):p==="none"?["all"].concat(a.slice(1).map(Sc).map(yu)):p==="in"?kl(a[1],a.slice(2)):p==="!in"?yu(kl(a[1],a.slice(2))):p==="has"?rl(a[1]):p==="!has"?yu(rl(a[1])):p!=="within"||a}function _u(a,u,p){switch(a){case"$type":return["filter-type-"+p,u];case"$id":return["filter-id-"+p,u];default:return["filter-"+p,a,u]}}function kl(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(p){return typeof p!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(cA)]]:["filter-in-small",a,["literal",u]]}}function rl(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function yu(a){return["!",a]}function nl(a){return gu(Qe(a.value))?tl(le({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):(function u(p){var x=p.value,B=p.key;if(Fn(x)!=="array")return[new we(B,x,"array expected, "+Fn(x)+" found")];var I,R=p.styleSpec,k=[];if(x.length<1)return[new we(B,x,"filter array must have at least 1 element")];switch(k=k.concat(Fl({key:B+"[0]",value:x[0],valueSpec:R.filter_operator,style:p.style,styleSpec:p.styleSpec})),Ct(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&Ct(x[1])==="$type"&&k.push(new we(B,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&k.push(new we(B,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=Fn(x[1]))!=="string"&&k.push(new we(B+"[1]",x[1],"string expected, "+I+" found"));for(var z=2;z<x.length;z++)I=Fn(x[z]),Ct(x[1])==="$type"?k=k.concat(Fl({key:B+"["+z+"]",value:x[z],valueSpec:R.geometry_type,style:p.style,styleSpec:p.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&k.push(new we(B+"["+z+"]",x[z],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var K=1;K<x.length;K++)k=k.concat(u({key:B+"["+K+"]",value:x[K],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":I=Fn(x[1]),x.length!==2?k.push(new we(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&k.push(new we(B+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=Fn(x[1]),x.length!==2?k.push(new we(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&k.push(new we(B+"[1]",x[1],"object expected, "+I+" found"))}return k})(a)}function vh(a,u){var p=a.key,x=a.style,B=a.styleSpec,I=a.value,R=a.objectKey,k=B[u+"_"+a.layerType];if(!k)return[];var z=R.match(/^(.*)-transition$/);if(u==="paint"&&z&&k[z[1]]&&k[z[1]].transition)return hn({key:p,value:I,valueSpec:B.transition,style:x,styleSpec:B});var K,q=a.valueSpec||k[R];if(!q)return[new we(p,I,'unknown property "'+R+'"')];if(Fn(I)==="string"&&qo(q)&&!q.tokens&&(K=/^{([^}]+)}$/.exec(I)))return[new we(p,I,'"'+R+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(K[1])+" }`.")];var ie=[];return a.layerType==="symbol"&&(R==="text-field"&&x&&!x.glyphs&&ie.push(new we(p,I,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&pu(Qe(I))&&Ct(I.type)==="identity"&&ie.push(new we(p,I,'"text-font" does not support identity functions'))),ie.concat(hn({key:a.key,value:I,valueSpec:q,style:x,styleSpec:B,expressionContext:"property",propertyType:u,propertyKey:R}))}function xh(a){return vh(a,"paint")}function Ic(a){return vh(a,"layout")}function zf(a){var u=[],p=a.value,x=a.key,B=a.style,I=a.styleSpec;p.type||p.ref||u.push(new we(x,p,'either "type" or "ref" is required'));var R,k=Ct(p.type),z=Ct(p.ref);if(p.id)for(var K=Ct(p.id),q=0;q<a.arrayIndex;q++){var ie=B.layers[q];Ct(ie.id)===K&&u.push(new we(x,p.id,'duplicate layer id "'+p.id+'", previously used at line '+ie.id.__line__))}if("ref"in p)["type","source","source-layer","filter","layout"].forEach(function(Fe){Fe in p&&u.push(new we(x,p[Fe],'"'+Fe+'" is prohibited for ref layers'))}),B.layers.forEach(function(Fe){Ct(Fe.id)===z&&(R=Fe)}),R?R.ref?u.push(new we(x,p.ref,"ref cannot reference another ref layer")):k=Ct(R.type):u.push(new we(x,p.ref,'ref layer "'+z+'" not found'));else if(k!=="background")if(p.source){var he=B.sources&&B.sources[p.source],_e=he&&Ct(he.type);he?_e==="vector"&&k==="raster"?u.push(new we(x,p.source,'layer "'+p.id+'" requires a raster source')):_e==="raster"&&k!=="raster"?u.push(new we(x,p.source,'layer "'+p.id+'" requires a vector source')):_e!=="vector"||p["source-layer"]?_e==="raster-dem"&&k!=="hillshade"?u.push(new we(x,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!p.paint||!p.paint["line-gradient"]||_e==="geojson"&&he.lineMetrics||u.push(new we(x,p,'layer "'+p.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new we(x,p,'layer "'+p.id+'" must specify a "source-layer"')):u.push(new we(x,p.source,'source "'+p.source+'" not found'))}else u.push(new we(x,p,'missing required property "source"'));return u=u.concat(Hs({key:x,value:p,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return hn({key:x+".type",value:p.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:p,objectKey:"type"})},filter:nl,layout:function(Fe){return Hs({layer:p,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(ke){return Ic(le({layerType:k},ke))}}})},paint:function(Fe){return Hs({layer:p,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(ke){return xh(le({layerType:k},ke))}}})}}}))}function il(a){var u=a.value,p=a.key,x=Fn(u);return x!=="string"?[new we(p,u,"string expected, "+x+" found")]:[]}var Kn={promoteId:function(a){var u=a.key,p=a.value;if(Fn(p)==="string")return il({key:u,value:p});var x=[];for(var B in p)x.push.apply(x,il({key:u+"."+B,value:p[B]}));return x}};function bu(a){var u=a.value,p=a.key,x=a.styleSpec,B=a.style;if(!u.type)return[new we(p,u,'"type" is required')];var I,R=Ct(u.type);switch(R){case"vector":case"raster":case"raster-dem":return Hs({key:p,value:u,valueSpec:x["source_"+R.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Kn});case"geojson":if(I=Hs({key:p,value:u,valueSpec:x.source_geojson,style:B,styleSpec:x,objectElementValidators:Kn}),u.cluster)for(var k in u.clusterProperties){var z=u.clusterProperties[k],K=z[0],q=typeof K=="string"?[K,["accumulated"],["get",k]]:K;I.push.apply(I,tl({key:p+"."+k+".map",value:z[1],expressionContext:"cluster-map"})),I.push.apply(I,tl({key:p+"."+k+".reduce",value:q,expressionContext:"cluster-reduce"}))}return I;case"video":return Hs({key:p,value:u,valueSpec:x.source_video,style:B,styleSpec:x});case"image":return Hs({key:p,value:u,valueSpec:x.source_image,style:B,styleSpec:x});case"canvas":return[new we(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fl({key:p+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Yo(a){var u=a.value,p=a.styleSpec,x=p.light,B=a.style,I=[],R=Fn(u);if(u===void 0)return I;if(R!=="object")return I.concat([new we("light",u,"object expected, "+R+" found")]);for(var k in u){var z=k.match(/^(.*)-transition$/);I=I.concat(z&&x[z[1]]&&x[z[1]].transition?hn({key:k,value:u[k],valueSpec:p.transition,style:B,styleSpec:p}):x[k]?hn({key:k,value:u[k],valueSpec:x[k],style:B,styleSpec:p}):[new we(k,u[k],'unknown property "'+k+'"')])}return I}var ea={"*":function(){return[]},array:el,boolean:function(a){var u=a.value,p=a.key,x=Fn(u);return x!=="boolean"?[new we(p,u,"boolean expected, "+x+" found")]:[]},number:Ol,color:function(a){var u=a.key,p=a.value,x=Fn(p);return x!=="string"?[new we(u,p,"color expected, "+x+" found")]:Xt(p)===null?[new we(u,p,'color expected, "'+p+'" found')]:[]},constants:g,enum:Fl,filter:nl,function:Dl,layer:zf,object:Hs,source:bu,light:Yo,string:il,formatted:function(a){return il(a).length===0?[]:tl(a)},resolvedImage:function(a){return il(a).length===0?[]:tl(a)}};function hn(a){var u=a.value,p=a.valueSpec,x=a.styleSpec;return p.expression&&pu(Ct(u))?Dl(a):p.expression&&wo(Qe(u))?tl(a):p.type&&ea[p.type]?ea[p.type](a):Hs(le({},a,{valueSpec:p.type?x[p.type]:p}))}function kn(a){var u=a.value,p=a.key,x=il(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new we(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new we(p,u,'"glyphs" url must include a "{range}" token'))),x}function Vs(a,u){u===void 0&&(u=oe);var p=[];return p=p.concat(hn({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:kn,"*":function(){return[]}}})),a.constants&&(p=p.concat(g({key:"constants",value:a.constants}))),Mc(p)}function Mc(a){return[].concat(a).sort(function(u,p){return u.line-p.line})}function Nl(a){return function(){for(var u=[],p=arguments.length;p--;)u[p]=arguments[p];return Mc(a.apply(this,u))}}Vs.source=Nl(bu),Vs.light=Nl(Yo),Vs.layer=Nl(zf),Vs.filter=Nl(nl),Vs.paintProperty=Nl(xh),Vs.layoutProperty=Nl(Ic);var Pc=Vs,uA=Pc.light,hA=Pc.paintProperty,Ul=Pc.layoutProperty;function Lc(a,u){var p=!1;if(u&&u.length)for(var x=0,B=u;x<B.length;x+=1)a.fire(new fe(new Error(B[x].message))),p=!0;return p}var Ro=Nn;function Nn(a,u,p){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var B=new Int32Array(this.arrayBuffer);a=B[0],this.d=(u=B[1])+2*(p=B[2]);for(var I=0;I<this.d*this.d;I++){var R=B[3+I],k=B[3+I+1];x.push(R===k?null:B.subarray(R,k))}var z=B[3+x.length+1];this.keys=B.subarray(B[3+x.length],z),this.bboxes=B.subarray(z),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var K=0;K<this.d*this.d;K++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=p,this.scale=u/a,this.uid=0;var q=p/u*a;this.min=-q,this.max=a+q}Nn.prototype.insert=function(a,u,p,x,B){this._forEachCell(u,p,x,B,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(B)},Nn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Nn.prototype._insertCell=function(a,u,p,x,B,I){this.cells[B].push(I)},Nn.prototype.query=function(a,u,p,x,B){var I=this.min,R=this.max;if(a<=I&&u<=I&&R<=p&&R<=x&&!B)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,u,p,x,this._queryCell,k,{},B),k},Nn.prototype._queryCell=function(a,u,p,x,B,I,R,k){var z=this.cells[B];if(z!==null)for(var K=this.keys,q=this.bboxes,ie=0;ie<z.length;ie++){var he=z[ie];if(R[he]===void 0){var _e=4*he;(k?k(q[_e+0],q[_e+1],q[_e+2],q[_e+3]):a<=q[_e+2]&&u<=q[_e+3]&&p>=q[_e+0]&&x>=q[_e+1])?(R[he]=!0,I.push(K[he])):R[he]=!1}}},Nn.prototype._forEachCell=function(a,u,p,x,B,I,R,k){for(var z=this._convertToCellCoord(a),K=this._convertToCellCoord(u),q=this._convertToCellCoord(p),ie=this._convertToCellCoord(x),he=z;he<=q;he++)for(var _e=K;_e<=ie;_e++){var Fe=this.d*_e+he;if((!k||k(this._convertFromCellCoord(he),this._convertFromCellCoord(_e),this._convertFromCellCoord(he+1),this._convertFromCellCoord(_e+1)))&&B.call(this,a,u,p,x,Fe,I,R,k))return}},Nn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Nn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Nn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var B=new Int32Array(u+p+this.keys.length+this.bboxes.length);B[0]=this.extent,B[1]=this.n,B[2]=this.padding;for(var I=u,R=0;R<a.length;R++){var k=a[R];B[3+R]=I,B.set(k,I),I+=k.length}return B[3+a.length]=I,B.set(this.keys,I),B[3+a.length+1]=I+=this.keys.length,B.set(this.bboxes,I),I+=this.bboxes.length,B.buffer};var Gl=S.ImageData,jf=S.ImageBitmap,Ei={};function or(a,u,p){p===void 0&&(p={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),Ei[a]={klass:u,omit:p.omit||[],shallow:p.shallow||[]}}for(var Ss in or("Object",Object),Ro.serialize=function(a,u){var p=a.toArrayBuffer();return u&&u.push(p),{buffer:p}},Ro.deserialize=function(a){return new Ro(a.buffer)},or("Grid",Ro),or("Color",tn),or("Error",Error),or("ResolvedImage",Wn),or("StylePropertyFunction",Ya),or("StyleExpression",Sa,{omit:["_evaluator"]}),or("ZoomDependentExpression",Rl),or("ZoomConstantExpression",qa),or("CompoundExpression",Me,{omit:["_evaluate"]}),no)no[Ss]._classRegistryKey||or("Expression_"+Ss,no[Ss]);function vu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ws(a){return jf&&a instanceof jf}function io(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(vu(a)||Ws(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var p=a;return u&&u.push(p.buffer),p}if(a instanceof Gl)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],B=0,I=a;B<I.length;B+=1)x.push(io(I[B],u));return x}if(typeof a=="object"){var R=a.constructor,k=R._classRegistryKey;if(!k)throw new Error("can't serialize object of unregistered class");var z=R.serialize?R.serialize(a,u):{};if(!R.serialize){for(var K in a)if(a.hasOwnProperty(K)&&!(Ei[k].omit.indexOf(K)>=0)){var q=a[K];z[K]=Ei[k].shallow.indexOf(K)>=0?q:io(q,u)}a instanceof Error&&(z.message=a.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return k!=="Object"&&(z.$name=k),z}throw new Error("can't serialize object of type "+typeof a)}function ms(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||vu(a)||Ws(a)||ArrayBuffer.isView(a)||a instanceof Gl)return a;if(Array.isArray(a))return a.map(ms);if(typeof a=="object"){var u=a.$name||"Object",p=Ei[u].klass;if(!p)throw new Error("can't deserialize unregistered class "+u);if(p.deserialize)return p.deserialize(a);for(var x=Object.create(p.prototype),B=0,I=Object.keys(a);B<I.length;B+=1){var R=I[B];if(R!=="$name"){var k=a[R];x[R]=Ei[u].shallow.indexOf(R)>=0?k:ms(k)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var wh=function(){this.first=!0};wh.prototype.update=function(a,u){var p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))};var qt={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Ch(a){for(var u=0,p=a;u<p.length;u+=1)if(xu(p[u].charCodeAt(0)))return!0;return!1}function xu(a){return!(a!==746&&a!==747&&(a<4352||!(qt["Bopomofo Extended"](a)||qt.Bopomofo(a)||qt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||qt["CJK Compatibility Ideographs"](a)||qt["CJK Compatibility"](a)||qt["CJK Radicals Supplement"](a)||qt["CJK Strokes"](a)||!(!qt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||qt["CJK Unified Ideographs Extension A"](a)||qt["CJK Unified Ideographs"](a)||qt["Enclosed CJK Letters and Months"](a)||qt["Hangul Compatibility Jamo"](a)||qt["Hangul Jamo Extended-A"](a)||qt["Hangul Jamo Extended-B"](a)||qt["Hangul Jamo"](a)||qt["Hangul Syllables"](a)||qt.Hiragana(a)||qt["Ideographic Description Characters"](a)||qt.Kanbun(a)||qt["Kangxi Radicals"](a)||qt["Katakana Phonetic Extensions"](a)||qt.Katakana(a)&&a!==12540||!(!qt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!qt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||qt["Unified Canadian Aboriginal Syllabics"](a)||qt["Unified Canadian Aboriginal Syllabics Extended"](a)||qt["Vertical Forms"](a)||qt["Yijing Hexagram Symbols"](a)||qt["Yi Syllables"](a)||qt["Yi Radicals"](a))))}function Eh(a){return!(xu(a)||(function(u){return!!(qt["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||qt["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||qt["Letterlike Symbols"](u)||qt["Number Forms"](u)||qt["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||qt["Control Pictures"](u)&&u!==9251||qt["Optical Character Recognition"](u)||qt["Enclosed Alphanumerics"](u)||qt["Geometric Shapes"](u)||qt["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||qt["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||qt["CJK Symbols and Punctuation"](u)||qt.Katakana(u)||qt["Private Use Area"](u)||qt["CJK Compatibility Forms"](u)||qt["Small Form Variants"](u)||qt["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)})(a))}function so(a){return a>=1424&&a<=2303||qt["Arabic Presentation Forms-A"](a)||qt["Arabic Presentation Forms-B"](a)}function Is(a,u){return!(!u&&so(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||qt.Khmer(a))}function wu(a){for(var u=0,p=a;u<p.length;u+=1)if(so(p[u].charCodeAt(0)))return!0;return!1}var Cu=null,Ms="unavailable",ta=null,Bh=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ms="error"),Cu&&Cu(a)};function zl(){Bi.fire(new Oe("pluginStateChange",{pluginStatus:Ms,pluginURL:ta}))}var Bi=new be,Th=function(){return Ms},Co=function(){if(Ms!=="deferred"||!ta)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ms="loading",zl(),ta&&Ke({url:ta},function(a){a?Bh(a):(Ms="loaded",zl())})},rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ms==="loaded"||rs.applyArabicShaping!=null},isLoading:function(){return Ms==="loading"},setState:function(a){Ms=a.pluginStatus,ta=a.pluginURL},isParsed:function(){return rs.applyArabicShaping!=null&&rs.processBidirectionalText!=null&&rs.processStyledBidirectionalText!=null},getPluginURL:function(){return ta}},Hr=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wh,this.transition={})};Hr.prototype.isSupportedScript=function(a){return(function(u,p){for(var x=0,B=u;x<B.length;x+=1)if(!Is(B[x].charCodeAt(0),p))return!1;return!0})(a,rs.isLoaded())},Hr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Hr.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}};var Oo=function(a,u){this.property=a,this.value=u,this.expression=(function(p,x){if(pu(p))return new Ya(p,x);if(wo(p)){var B=js(p,x);if(B.result==="error")throw new Error(B.value.map(function(R){return R.key+": "+R.message}).join(", "));return B.value}var I=p;return typeof p=="string"&&x.type==="color"&&(I=tn.parse(p)),{kind:"constant",evaluate:function(){return I}}})(u===void 0?a.specification.default:u,a.specification)};Oo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Oo.prototype.possiblyEvaluate=function(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)};var oo=function(a){this.property=a,this.value=new Oo(a,void 0)};oo.prototype.transitioned=function(a,u){return new Ia(this.property,this.value,u,ee({},a.transition,this.transition),a.now)},oo.prototype.untransitioned=function(){return new Ia(this.property,this.value,null,{},0)};var Ji=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Ji.prototype.getValue=function(a){return De(this._values[a].value.value)},Ji.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new oo(this._values[a].property)),this._values[a].value=new Oo(this._values[a].property,u===null?void 0:De(u))},Ji.prototype.getTransition=function(a){return De(this._values[a].transition)},Ji.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new oo(this._values[a].property)),this._values[a].transition=De(u)||void 0},Ji.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},Ji.prototype.transitioned=function(a,u){for(var p=new ra(this._properties),x=0,B=Object.keys(this._values);x<B.length;x+=1){var I=B[x];p._values[I]=this._values[I].transitioned(a,u._values[I])}return p},Ji.prototype.untransitioned=function(){for(var a=new ra(this._properties),u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u];a._values[x]=this._values[x].untransitioned()}return a};var Ia=function(a,u,p,x,B){this.property=a,this.value=u,this.begin=B+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=p)};Ia.prototype.possiblyEvaluate=function(a,u,p){var x=a.now||0,B=this.value.possiblyEvaluate(a,u,p),I=this.prior;if(I){if(x>this.end)return this.prior=null,B;if(this.value.isDataDriven())return this.prior=null,B;if(x<this.begin)return I.possiblyEvaluate(a,u,p);var R=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,u,p),B,(function(k){if(k<=0)return 0;if(k>=1)return 1;var z=k*k,K=z*k;return 4*(k<.5?K:3*(k-z)+K-.75)})(R))}return B};var ra=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};ra.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Rc(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var R=I[B];x._values[R]=this._values[R].possiblyEvaluate(a,u,p)}return x},ra.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var ao=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};ao.prototype.getValue=function(a){return De(this._values[a].value)},ao.prototype.setValue=function(a,u){this._values[a]=new Oo(this._values[a].property,u===null?void 0:De(u))},ao.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B)}return a},ao.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Rc(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var R=I[B];x._values[R]=this._values[R].possiblyEvaluate(a,u,p)}return x};var ns=function(a,u,p){this.property=a,this.value=u,this.parameters=p};ns.prototype.isConstant=function(){return this.value.kind==="constant"},ns.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},ns.prototype.evaluate=function(a,u,p,x){return this.property.evaluate(this.value,this.parameters,a,u,p,x)};var Rc=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Rc.prototype.get=function(a){return this._values[a]};var xr=function(a){this.specification=a};xr.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},xr.prototype.interpolate=function(a,u,p){var x=Ka[this.specification.type];return x?x(a,u,p):a};var ur=function(a,u){this.specification=a,this.overrides=u};ur.prototype.possiblyEvaluate=function(a,u,p,x){return new ns(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,x)}:a.expression,u)},ur.prototype.interpolate=function(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new ns(this,{kind:"constant",value:void 0},a.parameters);var x=Ka[this.specification.type];return x?new ns(this,{kind:"constant",value:x(a.value.value,u.value.value,p)},a.parameters):a},ur.prototype.evaluate=function(a,u,p,x,B,I){return a.kind==="constant"?a.value:a.evaluate(u,p,x,B,I)};var Eu=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x,B,I){if(p.value===void 0)return new ns(this,{kind:"constant",value:void 0},x);if(p.expression.kind==="constant"){var R=p.expression.evaluate(x,null,{},B,I),k=p.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,z=this._calculate(k,k,k,x);return new ns(this,{kind:"constant",value:z},x)}if(p.expression.kind==="camera"){var K=this._calculate(p.expression.evaluate({zoom:x.zoom-1}),p.expression.evaluate({zoom:x.zoom}),p.expression.evaluate({zoom:x.zoom+1}),x);return new ns(this,{kind:"constant",value:K},x)}return new ns(this,p.expression,x)},u.prototype.evaluate=function(p,x,B,I,R,k){if(p.kind==="source"){var z=p.evaluate(x,B,I,R,k);return this._calculate(z,z,z,x)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(x.zoom)-1},B,I),p.evaluate({zoom:Math.floor(x.zoom)},B,I),p.evaluate({zoom:Math.floor(x.zoom)+1},B,I),x):p.value},u.prototype._calculate=function(p,x,B,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:p,to:x}:{from:B,to:x}},u.prototype.interpolate=function(p){return p},u})(ur),us=function(a){this.specification=a};us.prototype.possiblyEvaluate=function(a,u,p,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var B=a.expression.evaluate(u,null,{},p,x);return this._calculate(B,B,B,u)}return this._calculate(a.expression.evaluate(new Hr(Math.floor(u.zoom-1),u)),a.expression.evaluate(new Hr(Math.floor(u.zoom),u)),a.expression.evaluate(new Hr(Math.floor(u.zoom+1),u)),u)}},us.prototype._calculate=function(a,u,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}},us.prototype.interpolate=function(a){return a};var Ki=function(a){this.specification=a};Ki.prototype.possiblyEvaluate=function(a,u,p,x){return!!a.expression.evaluate(u,null,{},p,x)},Ki.prototype.interpolate=function(){return!1};var Xn=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var p=a[u];p.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new Oo(p,void 0),B=this.defaultTransitionablePropertyValues[u]=new oo(p);this.defaultTransitioningPropertyValues[u]=B.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};or("DataDrivenProperty",ur),or("DataConstantProperty",xr),or("CrossFadedDataDrivenProperty",Eu),or("CrossFadedProperty",us),or("ColorRampProperty",Ki);var Ur=(function(a){function u(p,x){if(a.call(this),this.id=p.id,this.type=p.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},p.type!=="custom"&&(this.metadata=(p=p).metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),x.layout&&(this._unevaluatedLayout=new ao(x.layout)),x.paint)){for(var B in this._transitionablePaint=new Ji(x.paint),p.paint)this.setPaintProperty(B,p.paint[B],{validate:!1});for(var I in p.layout)this.setLayoutProperty(I,p.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Rc(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)},u.prototype.setLayoutProperty=function(p,x,B){B===void 0&&(B={}),x!=null&&this._validate(Ul,"layers."+this.id+".layout."+p,p,x,B)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,x):this.visibility=x)},u.prototype.getPaintProperty=function(p){return ze(p,"-transition")?this._transitionablePaint.getTransition(p.slice(0,-11)):this._transitionablePaint.getValue(p)},u.prototype.setPaintProperty=function(p,x,B){if(B===void 0&&(B={}),x!=null&&this._validate(hA,"layers."+this.id+".paint."+p,p,x,B))return!1;if(ze(p,"-transition"))return this._transitionablePaint.setTransition(p.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[p],R=I.property.specification["property-type"]==="cross-faded-data-driven",k=I.value.isDataDriven(),z=I.value;this._transitionablePaint.setValue(p,x),this._handleSpecialPaintPropertyUpdate(p);var K=this._transitionablePaint._values[p].value;return K.isDataDriven()||k||R||this._handleOverridablePaintPropertyUpdate(p,z,K)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!1},u.prototype.isHidden=function(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(p,x){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,x)},u.prototype.serialize=function(){var p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),ce(p,function(x,B){return!(x===void 0||B==="layout"&&!Object.keys(x).length||B==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(p,x,B,I,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Lc(this,p.call(Pc,{key:x,layerType:this.type,objectKey:B,value:I,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var p in this.paint._values){var x=this.paint.get(p);if(x instanceof ns&&qo(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u})(be),lo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},An=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Qr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ki(a,u){u===void 0&&(u=1);var p=0,x=0;return{members:a.map(function(B){var I=lo[B.type].BYTES_PER_ELEMENT,R=p=Bu(p,Math.max(u,I)),k=B.components||1;return x=Math.max(x,I),p+=I*k,{name:B.name,type:B.type,components:k,offset:R}}),size:Bu(p,Math.max(x,u)),alignment:u}}function Bu(a,u){return Math.ceil(a/u)*u}Qr.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Qr.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Qr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Qr.prototype.clear=function(){this.length=0},Qr.prototype.resize=function(a){this.reserve(a),this.length=a},Qr.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Qr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Js=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.int16[I+0]=x,this.int16[I+1]=B,p},u})(Qr);Js.prototype.bytesPerElement=4,or("StructArrayLayout2i4",Js);var Sh=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,R){var k=4*p;return this.int16[k+0]=x,this.int16[k+1]=B,this.int16[k+2]=I,this.int16[k+3]=R,p},u})(Qr);Sh.prototype.bytesPerElement=8,or("StructArrayLayout4i8",Sh);var di=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k){var z=this.length;return this.resize(z+1),this.emplace(z,p,x,B,I,R,k)},u.prototype.emplace=function(p,x,B,I,R,k,z){var K=6*p;return this.int16[K+0]=x,this.int16[K+1]=B,this.int16[K+2]=I,this.int16[K+3]=R,this.int16[K+4]=k,this.int16[K+5]=z,p},u})(Qr);di.prototype.bytesPerElement=12,or("StructArrayLayout2i4i12",di);var is=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k){var z=this.length;return this.resize(z+1),this.emplace(z,p,x,B,I,R,k)},u.prototype.emplace=function(p,x,B,I,R,k,z){var K=4*p,q=8*p;return this.int16[K+0]=x,this.int16[K+1]=B,this.uint8[q+4]=I,this.uint8[q+5]=R,this.uint8[q+6]=k,this.uint8[q+7]=z,p},u})(Qr);is.prototype.bytesPerElement=8,or("StructArrayLayout2i4ub8",is);var Eo=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.float32[I+0]=x,this.float32[I+1]=B,p},u})(Qr);Eo.prototype.bytesPerElement=8,or("StructArrayLayout2f8",Eo);var Bo=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k,z,K,q,ie){var he=this.length;return this.resize(he+1),this.emplace(he,p,x,B,I,R,k,z,K,q,ie)},u.prototype.emplace=function(p,x,B,I,R,k,z,K,q,ie,he){var _e=10*p;return this.uint16[_e+0]=x,this.uint16[_e+1]=B,this.uint16[_e+2]=I,this.uint16[_e+3]=R,this.uint16[_e+4]=k,this.uint16[_e+5]=z,this.uint16[_e+6]=K,this.uint16[_e+7]=q,this.uint16[_e+8]=ie,this.uint16[_e+9]=he,p},u})(Qr);Bo.prototype.bytesPerElement=20,or("StructArrayLayout10ui20",Bo);var Kt=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k,z,K,q,ie,he,_e){var Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,p,x,B,I,R,k,z,K,q,ie,he,_e)},u.prototype.emplace=function(p,x,B,I,R,k,z,K,q,ie,he,_e,Fe){var ke=12*p;return this.int16[ke+0]=x,this.int16[ke+1]=B,this.int16[ke+2]=I,this.int16[ke+3]=R,this.uint16[ke+4]=k,this.uint16[ke+5]=z,this.uint16[ke+6]=K,this.uint16[ke+7]=q,this.int16[ke+8]=ie,this.int16[ke+9]=he,this.int16[ke+10]=_e,this.int16[ke+11]=Fe,p},u})(Qr);Kt.prototype.bytesPerElement=24,or("StructArrayLayout4i4ui4i24",Kt);var tr=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var R=3*p;return this.float32[R+0]=x,this.float32[R+1]=B,this.float32[R+2]=I,p},u})(Qr);tr.prototype.bytesPerElement=12,or("StructArrayLayout3f12",tr);var jl=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint32[1*p+0]=x,p},u})(Qr);jl.prototype.bytesPerElement=4,or("StructArrayLayout1ul4",jl);var Oc=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k,z,K,q){var ie=this.length;return this.resize(ie+1),this.emplace(ie,p,x,B,I,R,k,z,K,q)},u.prototype.emplace=function(p,x,B,I,R,k,z,K,q,ie){var he=10*p,_e=5*p;return this.int16[he+0]=x,this.int16[he+1]=B,this.int16[he+2]=I,this.int16[he+3]=R,this.int16[he+4]=k,this.int16[he+5]=z,this.uint32[_e+3]=K,this.uint16[he+8]=q,this.uint16[he+9]=ie,p},u})(Qr);Oc.prototype.bytesPerElement=20,or("StructArrayLayout6i1ul2ui20",Oc);var na=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k){var z=this.length;return this.resize(z+1),this.emplace(z,p,x,B,I,R,k)},u.prototype.emplace=function(p,x,B,I,R,k,z){var K=6*p;return this.int16[K+0]=x,this.int16[K+1]=B,this.int16[K+2]=I,this.int16[K+3]=R,this.int16[K+4]=k,this.int16[K+5]=z,p},u})(Qr);na.prototype.bytesPerElement=12,or("StructArrayLayout2i2i2i12",na);var Do=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,B,I,R)},u.prototype.emplace=function(p,x,B,I,R,k){var z=4*p,K=8*p;return this.float32[z+0]=x,this.float32[z+1]=B,this.float32[z+2]=I,this.int16[K+6]=R,this.int16[K+7]=k,p},u})(Qr);Do.prototype.bytesPerElement=16,or("StructArrayLayout2f1f2i16",Do);var ia=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,R){var k=12*p,z=3*p;return this.uint8[k+0]=x,this.uint8[k+1]=B,this.float32[z+1]=I,this.float32[z+2]=R,p},u})(Qr);ia.prototype.bytesPerElement=12,or("StructArrayLayout2ub2f12",ia);var sa=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var R=3*p;return this.uint16[R+0]=x,this.uint16[R+1]=B,this.uint16[R+2]=I,p},u})(Qr);sa.prototype.bytesPerElement=6,or("StructArrayLayout3ui6",sa);var _s=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze){var at=this.length;return this.resize(at+1),this.emplace(at,p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze)},u.prototype.emplace=function(p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze,at){var gt=24*p,_t=12*p,Rt=48*p;return this.int16[gt+0]=x,this.int16[gt+1]=B,this.uint16[gt+2]=I,this.uint16[gt+3]=R,this.uint32[_t+2]=k,this.uint32[_t+3]=z,this.uint32[_t+4]=K,this.uint16[gt+10]=q,this.uint16[gt+11]=ie,this.uint16[gt+12]=he,this.float32[_t+7]=_e,this.float32[_t+8]=Fe,this.uint8[Rt+36]=ke,this.uint8[Rt+37]=Ve,this.uint8[Rt+38]=je,this.uint32[_t+10]=Ze,this.int16[gt+22]=at,p},u})(Qr);_s.prototype.bytesPerElement=48,or("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_s);var y=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze,at,gt,_t,Rt,Wt,$t,br,nr,Br,ir,sn){var Dr=this.length;return this.resize(Dr+1),this.emplace(Dr,p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze,at,gt,_t,Rt,Wt,$t,br,nr,Br,ir,sn)},u.prototype.emplace=function(p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke,Ve,je,Ze,at,gt,_t,Rt,Wt,$t,br,nr,Br,ir,sn,Dr){var fr=34*p,fn=17*p;return this.int16[fr+0]=x,this.int16[fr+1]=B,this.int16[fr+2]=I,this.int16[fr+3]=R,this.int16[fr+4]=k,this.int16[fr+5]=z,this.int16[fr+6]=K,this.int16[fr+7]=q,this.uint16[fr+8]=ie,this.uint16[fr+9]=he,this.uint16[fr+10]=_e,this.uint16[fr+11]=Fe,this.uint16[fr+12]=ke,this.uint16[fr+13]=Ve,this.uint16[fr+14]=je,this.uint16[fr+15]=Ze,this.uint16[fr+16]=at,this.uint16[fr+17]=gt,this.uint16[fr+18]=_t,this.uint16[fr+19]=Rt,this.uint16[fr+20]=Wt,this.uint16[fr+21]=$t,this.uint16[fr+22]=br,this.uint32[fn+12]=nr,this.float32[fn+13]=Br,this.float32[fn+14]=ir,this.float32[fn+15]=sn,this.float32[fn+16]=Dr,p},u})(Qr);y.prototype.bytesPerElement=68,or("StructArrayLayout8i15ui1ul4f68",y);var _=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.float32[1*p+0]=x,p},u})(Qr);_.prototype.bytesPerElement=4,or("StructArrayLayout1f4",_);var v=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var R=3*p;return this.int16[R+0]=x,this.int16[R+1]=B,this.int16[R+2]=I,p},u})(Qr);v.prototype.bytesPerElement=6,or("StructArrayLayout3i6",v);var w=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var R=4*p;return this.uint32[2*p+0]=x,this.uint16[R+2]=B,this.uint16[R+3]=I,p},u})(Qr);w.prototype.bytesPerElement=8,or("StructArrayLayout1ul2ui8",w);var T=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.uint16[I+0]=x,this.uint16[I+1]=B,p},u})(Qr);T.prototype.bytesPerElement=4,or("StructArrayLayout2ui4",T);var M=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint16[1*p+0]=x,p},u})(Qr);M.prototype.bytesPerElement=2,or("StructArrayLayout1ui2",M);var O=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,R){var k=4*p;return this.float32[k+0]=x,this.float32[k+1]=B,this.float32[k+2]=I,this.float32[k+3]=R,p},u})(Qr);O.prototype.bytesPerElement=16,or("StructArrayLayout4f16",O);var c=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return p.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},p.x1.get=function(){return this._structArray.int16[this._pos2+2]},p.y1.get=function(){return this._structArray.int16[this._pos2+3]},p.x2.get=function(){return this._structArray.int16[this._pos2+4]},p.y2.get=function(){return this._structArray.int16[this._pos2+5]},p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.anchorPoint.get=function(){return new b(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,p),u})(An);c.prototype.size=20;var d=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new c(this,p)},u})(Oc);or("CollisionBoxArray",d);var f=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},p.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},p.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},p.segment.get=function(){return this._structArray.uint16[this._pos2+10]},p.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},p.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},p.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},p.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},p.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},p.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},p.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},p.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},p.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},p.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,p),u})(An);f.prototype.size=48;var m=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new f(this,p)},u})(_s);or("PlacedSymbolArray",m);var E=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},p.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},p.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},p.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},p.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},p.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},p.key.get=function(){return this._structArray.uint16[this._pos2+8]},p.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},p.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},p.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},p.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},p.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},p.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},p.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},p.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},p.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},p.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},p.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},p.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},p.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},p.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},p.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},p.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},p.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,p),u})(An);E.prototype.size=68;var P=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new E(this,p)},u})(y);or("SymbolInstanceArray",P);var L=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(p){return this.float32[1*p+0]},u})(_);or("GlyphOffsetArray",L);var F=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(p){return this.int16[3*p+0]},u.prototype.gety=function(p){return this.int16[3*p+1]},u.prototype.gettileUnitDistanceFromAnchor=function(p){return this.int16[3*p+2]},u})(v);or("SymbolLineVertexArray",F);var G=(function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,p),u})(An);G.prototype.size=8;var W=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new G(this,p)},u})(w);or("FeatureIndexArray",W);var te=ki([{name:"a_pos",components:2,type:"Int16"}],4).members,$=function(a){a===void 0&&(a=[]),this.segments=a};function re(a,u){return 256*(a=V(Math.floor(a),0,255))+V(Math.floor(u),0,255)}$.prototype.prepareSegment=function(a,u,p,x){var B=this.segments[this.segments.length-1];return a>$.MAX_VERTEX_ARRAY_LENGTH&&ue("Max vertices per segment is "+$.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!B||B.vertexLength+a>$.MAX_VERTEX_ARRAY_LENGTH||B.sortKey!==x)&&(B={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},x!==void 0&&(B.sortKey=x),this.segments.push(B)),B},$.prototype.get=function(){return this.segments},$.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var p=u[a];for(var x in p.vaos)p.vaos[x].destroy()}},$.simpleSegment=function(a,u,p,x){return new $([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:x,vaos:{},sortKey:0}])},$.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,or("SegmentVector",$);var se=ki([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ve=l(function(a){a.exports=function(u,p){var x,B,I,R,k,z,K,q;for(B=u.length-(x=3&u.length),I=p,k=3432918353,z=461845907,q=0;q<B;)K=255&u.charCodeAt(q)|(255&u.charCodeAt(++q))<<8|(255&u.charCodeAt(++q))<<16|(255&u.charCodeAt(++q))<<24,++q,I=27492+(65535&(R=5*(65535&(I=(I^=K=(65535&(K=(K=(65535&K)*k+(((K>>>16)*k&65535)<<16)&4294967295)<<15|K>>>17))*z+(((K>>>16)*z&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(K=0,x){case 3:K^=(255&u.charCodeAt(q+2))<<16;case 2:K^=(255&u.charCodeAt(q+1))<<8;case 1:I^=K=(65535&(K=(K=(65535&(K^=255&u.charCodeAt(q)))*k+(((K>>>16)*k&65535)<<16)&4294967295)<<15|K>>>17))*z+(((K>>>16)*z&65535)<<16)&4294967295}return I^=u.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Pe=l(function(a){a.exports=function(u,p){for(var x,B=u.length,I=p^B,R=0;B>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(R)|(255&u.charCodeAt(++R))<<8|(255&u.charCodeAt(++R))<<16|(255&u.charCodeAt(++R))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),B-=4,++R;switch(B){case 3:I^=(255&u.charCodeAt(R+2))<<16;case 2:I^=(255&u.charCodeAt(R+1))<<8;case 1:I=1540483477*(65535&(I^=255&u.charCodeAt(R)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),me=ve,Ie=Pe;me.murmur3=ve,me.murmur2=Ie;var He=function(){this.ids=[],this.positions=[],this.indexed=!1};He.prototype.add=function(a,u,p,x){this.ids.push(et(a)),this.positions.push(u,p,x)},He.prototype.getPositions=function(a){for(var u=et(a),p=0,x=this.ids.length-1;p<x;){var B=p+x>>1;this.ids[B]>=u?x=B:p=B+1}for(var I=[];this.ids[p]===u;)I.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return I},He.serialize=function(a,u){var p=new Float64Array(a.ids),x=new Uint32Array(a.positions);return(function B(I,R,k,z){for(;k<z;){for(var K=I[k+z>>1],q=k-1,ie=z+1;;){do q++;while(I[q]<K);do ie--;while(I[ie]>K);if(q>=ie)break;Xe(I,q,ie),Xe(R,3*q,3*ie),Xe(R,3*q+1,3*ie+1),Xe(R,3*q+2,3*ie+2)}ie-k<z-ie?(B(I,R,k,ie),k=ie+1):(B(I,R,ie+1,z),z=ie)}})(p,x,0,p.length-1),u&&u.push(p.buffer,x.buffer),{ids:p,positions:x}},He.deserialize=function(a){var u=new He;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var Je=Math.pow(2,53)-1;function et(a){var u=+a;return!isNaN(u)&&u<=Je?u:me(String(a))}function Xe(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}or("FeaturePositionMap",He);var Ye=function(a,u){this.gl=a.gl,this.location=u},pt=(function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))},u})(Ye),Ot=(function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))},u})(Ye),xt=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))},u})(Ye),Ut=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))},u})(Ye),sr=(function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))},u})(Ye),Er=(function(a){function u(p,x){a.call(this,p,x),this.current=tn.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))},u})(Ye),Sr=new Float32Array(16),xn=(function(a){function u(p,x){a.call(this,p,x),this.current=Sr}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(var x=1;x<16;x++)if(p[x]!==this.current[x]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}},u})(Ye);function ar(a){return[re(255*a.r,255*a.g),re(255*a.b,255*a.a)]}var Wr=function(a,u,p){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=p};Wr.prototype.setUniform=function(a,u,p){a.set(p.constantOr(this.value))},Wr.prototype.getBinding=function(a,u,p){return this.type==="color"?new Er(a,u):new Ot(a,u)};var rn=function(a,u){this.uniformNames=u.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};rn.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},rn.prototype.setUniform=function(a,u,p,x){var B=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;B&&a.set(B)},rn.prototype.getBinding=function(a,u,p){return p.substr(0,9)==="u_pattern"?new sr(a,u):new Ot(a,u)};var Vr=function(a,u,p,x){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(function(B){return{name:"a_"+B,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new x};Vr.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.paintVertexArray.length,R=this.expression.evaluate(new Hr(0),u,{},x,[],B);this.paintVertexArray.resize(a),this._setPaintValue(I,a,R)},Vr.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:0},p,x);this._setPaintValue(a,u,B)},Vr.prototype._setPaintValue=function(a,u,p){if(this.type==="color")for(var x=ar(p),B=a;B<u;B++)this.paintVertexArray.emplace(B,x[0],x[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}},Vr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Vr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Gr=function(a,u,p,x,B,I){this.expression=a,this.uniformNames=u.map(function(R){return"u_"+R+"_t"}),this.type=p,this.useIntegerZoom=x,this.zoom=B,this.maxValue=0,this.paintVertexAttributes=u.map(function(R){return{name:"a_"+R,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new I};Gr.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.expression.evaluate(new Hr(this.zoom),u,{},x,[],B),R=this.expression.evaluate(new Hr(this.zoom+1),u,{},x,[],B),k=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(k,a,I,R)},Gr.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:this.zoom},p,x),I=this.expression.evaluate({zoom:this.zoom+1},p,x);this._setPaintValue(a,u,B,I)},Gr.prototype._setPaintValue=function(a,u,p,x){if(this.type==="color")for(var B=ar(p),I=ar(x),R=a;R<u;R++)this.paintVertexArray.emplace(R,B[0],B[1],I[0],I[1]);else{for(var k=a;k<u;k++)this.paintVertexArray.emplace(k,p,x);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(x))}},Gr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gr.prototype.setUniform=function(a,u){var p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=V(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(x)},Gr.prototype.getBinding=function(a,u,p){return new Ot(a,u)};var qr=function(a,u,p,x,B,I){this.expression=a,this.type=u,this.useIntegerZoom=p,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new B,this.zoomOutPaintVertexArray=new B};qr.prototype.populatePaintArray=function(a,u,p){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],p)},qr.prototype.updatePaintArray=function(a,u,p,x,B){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],B)},qr.prototype._setPaintValues=function(a,u,p,x){if(x&&p){var B=x[p.min],I=x[p.mid],R=x[p.max];if(B&&I&&R)for(var k=a;k<u;k++)this.zoomInPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],I.pixelRatio,B.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],I.pixelRatio,R.pixelRatio)}},qr.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,se.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,se.members,this.expression.isStateDependent))},qr.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Fr=function(a,u,p){this.binders={},this._buffers=[];var x=[];for(var B in a.paint._values)if(p(B)){var I=a.paint.get(B);if(I instanceof ns&&qo(I.property.specification)){var R=Xi(B,a.type),k=I.value,z=I.property.specification.type,K=I.property.useIntegerZoom,q=I.property.specification["property-type"],ie=q==="cross-faded"||q==="cross-faded-data-driven";if(k.kind==="constant")this.binders[B]=ie?new rn(k.value,R):new Wr(k.value,R,z),x.push("/u_"+B);else if(k.kind==="source"||ie){var he=Ti(B,z,"source");this.binders[B]=ie?new qr(k,z,K,u,he,a.id):new Vr(k,R,z,he),x.push("/a_"+B)}else{var _e=Ti(B,z,"composite");this.binders[B]=new Gr(k,R,z,K,u,_e),x.push("/z_"+B)}}}this.cacheKey=x.sort().join("")};Fr.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof Vr||u instanceof Gr?u.maxValue:0},Fr.prototype.populatePaintArrays=function(a,u,p,x,B){for(var I in this.binders){var R=this.binders[I];(R instanceof Vr||R instanceof Gr||R instanceof qr)&&R.populatePaintArray(a,u,p,x,B)}},Fr.prototype.setConstantPatternPositions=function(a,u){for(var p in this.binders){var x=this.binders[p];x instanceof rn&&x.setConstantPatternPositions(a,u)}},Fr.prototype.updatePaintArrays=function(a,u,p,x,B){var I=!1;for(var R in a)for(var k=0,z=u.getPositions(R);k<z.length;k+=1){var K=z[k],q=p.feature(K.index);for(var ie in this.binders){var he=this.binders[ie];if((he instanceof Vr||he instanceof Gr||he instanceof qr)&&he.expression.isStateDependent===!0){var _e=x.paint.get(ie);he.expression=_e.value,he.updatePaintArray(K.start,K.end,q,a[R],B),I=!0}}}return I},Fr.prototype.defines=function(){var a=[];for(var u in this.binders){var p=this.binders[u];(p instanceof Wr||p instanceof rn)&&a.push.apply(a,p.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Fr.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Vr||p instanceof Gr)for(var x=0;x<p.paintVertexAttributes.length;x++)a.push(p.paintVertexAttributes[x].name);else if(p instanceof qr)for(var B=0;B<se.members.length;B++)a.push(se.members[B].name)}return a},Fr.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Wr||p instanceof rn||p instanceof Gr)for(var x=0,B=p.uniformNames;x<B.length;x+=1)a.push(B[x])}return a},Fr.prototype.getPaintVertexBuffers=function(){return this._buffers},Fr.prototype.getUniforms=function(a,u){var p=[];for(var x in this.binders){var B=this.binders[x];if(B instanceof Wr||B instanceof rn||B instanceof Gr)for(var I=0,R=B.uniformNames;I<R.length;I+=1){var k=R[I];if(u[k]){var z=B.getBinding(a,u[k],k);p.push({name:k,property:x,binding:z})}}}return p},Fr.prototype.setUniforms=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1){var R=I[B],k=R.name,z=R.property;this.binders[z].setUniform(R.binding,x,p.get(z),k)}},Fr.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var p=this.binders[u];if(a&&p instanceof qr){var x=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(p instanceof Vr||p instanceof Gr)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}},Fr.prototype.upload=function(a){for(var u in this.binders){var p=this.binders[u];(p instanceof Vr||p instanceof Gr||p instanceof qr)&&p.upload(a)}this.updatePaintBuffers()},Fr.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof Vr||u instanceof Gr||u instanceof qr)&&u.destroy()}};var Or=function(a,u,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var x=0,B=a;x<B.length;x+=1){var I=B[x];this.programConfigurations[I.id]=new Fr(I,u,p)}this.needsUpload=!1,this._featureMap=new He,this._bufferOffset=0};function Xi(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function Ti(a,u,p){var x={color:{source:Eo,composite:O},number:{source:_,composite:Eo}},B=(function(I){return{"line-pattern":{source:Bo,composite:Bo},"fill-pattern":{source:Bo,composite:Bo},"fill-extrusion-pattern":{source:Bo,composite:Bo}}[I]})(a);return B&&B[p]||x[u][p]}Or.prototype.populatePaintArrays=function(a,u,p,x,B,I){for(var R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(a,u,x,B,I);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Or.prototype.updatePaintArrays=function(a,u,p,x){for(var B=0,I=p;B<I.length;B+=1){var R=I[B];this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,u,R,x)||this.needsUpload}},Or.prototype.get=function(a){return this.programConfigurations[a]},Or.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},Or.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},or("ConstantBinder",Wr),or("CrossFadedConstantBinder",rn),or("SourceExpressionBinder",Vr),or("CrossFadedCompositeBinder",qr),or("CompositeExpressionBinder",Gr),or("ProgramConfiguration",Fr,{omit:["_buffers"]}),or("ProgramConfigurationSet",Or);var ys=Math.pow(2,14)-1,ss=-ys-1;function vi(a){for(var u=8192/a.extent,p=a.loadGeometry(),x=0;x<p.length;x++)for(var B=p[x],I=0;I<B.length;I++){var R=B[I],k=Math.round(R.x*u),z=Math.round(R.y*u);R.x=V(k,ss,ys),R.y=V(z,ss,ys),(k<R.x||k>R.x+1||z<R.y||z>R.y+1)&&ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return p}function Pi(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?vi(a):[]}}function co(a,u,p,x,B){a.emplaceBack(2*u+(x+1)/2,2*p+(B+1)/2)}var Ps=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Js,this.indexArray=new sa,this.segments=new $,this.programConfigurations=new Or(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Hl(a,u){for(var p=0;p<a.length;p++)if(Ma(u,a[p]))return!0;for(var x=0;x<u.length;x++)if(Ma(a,u[x]))return!0;return!!Ih(a,u)}function Ks(a,u,p){return!!Ma(a,u)||!!Vl(u,a,p)}function oa(a,u){if(a.length===1)return Mh(u,a[0]);for(var p=0;p<u.length;p++)for(var x=u[p],B=0;B<x.length;B++)if(Ma(a,x[B]))return!0;for(var I=0;I<a.length;I++)if(Mh(u,a[I]))return!0;for(var R=0;R<u.length;R++)if(Ih(a,u[R]))return!0;return!1}function Fo(a,u,p){if(a.length>1){if(Ih(a,u))return!0;for(var x=0;x<u.length;x++)if(Vl(u[x],a,p))return!0}for(var B=0;B<a.length;B++)if(Vl(a[B],u,p))return!0;return!1}function Ih(a,u){if(a.length===0||u.length===0)return!1;for(var p=0;p<a.length-1;p++)for(var x=a[p],B=a[p+1],I=0;I<u.length-1;I++)if(Tu(x,B,u[I],u[I+1]))return!0;return!1}function Tu(a,u,p,x){return Ee(a,p,x)!==Ee(u,p,x)&&Ee(a,u,p)!==Ee(a,u,x)}function Vl(a,u,p){var x=p*p;if(u.length===1)return a.distSqr(u[0])<x;for(var B=1;B<u.length;B++)if(Su(a,u[B-1],u[B])<x)return!0;return!1}function Su(a,u,p){var x=u.distSqr(p);if(x===0)return a.distSqr(u);var B=((a.x-u.x)*(p.x-u.x)+(a.y-u.y)*(p.y-u.y))/x;return a.distSqr(B<0?u:B>1?p:p.sub(u)._mult(B)._add(u))}function Mh(a,u){for(var p,x,B,I=!1,R=0;R<a.length;R++)for(var k=0,z=(p=a[R]).length-1;k<p.length;z=k++)(x=p[k]).y>u.y!=(B=p[z]).y>u.y&&u.x<(B.x-x.x)*(u.y-x.y)/(B.y-x.y)+x.x&&(I=!I);return I}function Ma(a,u){for(var p=!1,x=0,B=a.length-1;x<a.length;B=x++){var I=a[x],R=a[B];I.y>u.y!=R.y>u.y&&u.x<(R.x-I.x)*(u.y-I.y)/(R.y-I.y)+I.x&&(p=!p)}return p}function Ph(a,u,p){var x=p[0],B=p[2];if(a.x<x.x&&u.x<x.x||a.x>B.x&&u.x>B.x||a.y<x.y&&u.y<x.y||a.y>B.y&&u.y>B.y)return!1;var I=Ee(a,u,p[0]);return I!==Ee(a,u,p[1])||I!==Ee(a,u,p[2])||I!==Ee(a,u,p[3])}function Pa(a,u,p){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:p.programConfigurations.get(u.id).getMaxValue(a)}function Qi(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function sl(a,u,p,x,B){if(!u[0]&&!u[1])return a;var I=b.convert(u)._mult(B);p==="viewport"&&I._rotate(-x);for(var R=[],k=0;k<a.length;k++)R.push(a[k].sub(I));return R}Ps.prototype.populate=function(a,u,p){var x=this.layers[0],B=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var R=0,k=a;R<k.length;R+=1){var z=k[R],K=z.feature,q=z.id,ie=z.index,he=z.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Fe=Pi(K,_e);if(this.layers[0]._featureFilter.filter(new Hr(this.zoom),Fe,p)){var ke=I?I.evaluate(Fe,{},p):void 0,Ve={id:q,properties:K.properties,type:K.type,sourceLayerIndex:he,index:ie,geometry:_e?Fe.geometry:vi(K),patterns:{},sortKey:ke};B.push(Ve)}}I&&B.sort(function($t,br){return $t.sortKey-br.sortKey});for(var je=0,Ze=B;je<Ze.length;je+=1){var at=Ze[je],gt=at.geometry,_t=at.index,Rt=at.sourceLayerIndex,Wt=a[_t].feature;this.addFeature(at,gt,_t,p),u.featureIndex.insert(Wt,gt,_t,Rt,this.index)}},Ps.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},Ps.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ps.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ps.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,te),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ps.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ps.prototype.addFeature=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1)for(var R=0,k=I[B];R<k.length;R+=1){var z=k[R],K=z.x,q=z.y;if(!(K<0||K>=8192||q<0||q>=8192)){var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),he=ie.vertexLength;co(this.layoutVertexArray,K,q,-1,-1),co(this.layoutVertexArray,K,q,1,-1),co(this.layoutVertexArray,K,q,1,1),co(this.layoutVertexArray,K,q,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),ie.vertexLength+=4,ie.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},x)},or("CircleBucket",Ps,{omit:["layers"]});var Wl=new Xn({"circle-sort-key":new ur(oe.layout_circle["circle-sort-key"])}),Dc={paint:new Xn({"circle-radius":new ur(oe.paint_circle["circle-radius"]),"circle-color":new ur(oe.paint_circle["circle-color"]),"circle-blur":new ur(oe.paint_circle["circle-blur"]),"circle-opacity":new ur(oe.paint_circle["circle-opacity"]),"circle-translate":new xr(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new xr(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xr(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xr(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ur(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ur(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ur(oe.paint_circle["circle-stroke-opacity"])}),layout:Wl},Bn=typeof Float32Array<"u"?Float32Array:Array;function To(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Xs(a,u,p){var x=u[0],B=u[1],I=u[2],R=u[3],k=u[4],z=u[5],K=u[6],q=u[7],ie=u[8],he=u[9],_e=u[10],Fe=u[11],ke=u[12],Ve=u[13],je=u[14],Ze=u[15],at=p[0],gt=p[1],_t=p[2],Rt=p[3];return a[0]=at*x+gt*k+_t*ie+Rt*ke,a[1]=at*B+gt*z+_t*he+Rt*Ve,a[2]=at*I+gt*K+_t*_e+Rt*je,a[3]=at*R+gt*q+_t*Fe+Rt*Ze,a[4]=(at=p[4])*x+(gt=p[5])*k+(_t=p[6])*ie+(Rt=p[7])*ke,a[5]=at*B+gt*z+_t*he+Rt*Ve,a[6]=at*I+gt*K+_t*_e+Rt*je,a[7]=at*R+gt*q+_t*Fe+Rt*Ze,a[8]=(at=p[8])*x+(gt=p[9])*k+(_t=p[10])*ie+(Rt=p[11])*ke,a[9]=at*B+gt*z+_t*he+Rt*Ve,a[10]=at*I+gt*K+_t*_e+Rt*je,a[11]=at*R+gt*q+_t*Fe+Rt*Ze,a[12]=(at=p[12])*x+(gt=p[13])*k+(_t=p[14])*ie+(Rt=p[15])*ke,a[13]=at*B+gt*z+_t*he+Rt*Ve,a[14]=at*I+gt*K+_t*_e+Rt*je,a[15]=at*R+gt*q+_t*Fe+Rt*Ze,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,p=arguments.length;p--;)u+=a[p]*a[p];return Math.sqrt(u)});var Fc,cb=Xs;function Hf(a,u,p){var x=u[0],B=u[1],I=u[2],R=u[3];return a[0]=p[0]*x+p[4]*B+p[8]*I+p[12]*R,a[1]=p[1]*x+p[5]*B+p[9]*I+p[13]*R,a[2]=p[2]*x+p[6]*B+p[10]*I+p[14]*R,a[3]=p[3]*x+p[7]*B+p[11]*I+p[15]*R,a}Fc=new Bn(3),Bn!=Float32Array&&(Fc[0]=0,Fc[1]=0,Fc[2]=0),(function(){var a=new Bn(4);Bn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)})();var ub=((function(){var a=new Bn(2);Bn!=Float32Array&&(a[0]=0,a[1]=0)})(),(function(a){function u(p){a.call(this,p,Dc)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new Ps(p)},u.prototype.queryRadius=function(p){var x=p;return Pa("circle-radius",this,x)+Pa("circle-stroke-width",this,x)+Qi(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,R,k,z,K){for(var q=sl(p,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,z),ie=this.paint.get("circle-radius").evaluate(x,B)+this.paint.get("circle-stroke-width").evaluate(x,B),he=this.paint.get("circle-pitch-alignment")==="map",_e=he?q:(function(Wt,$t){return Wt.map(function(br){return Lh(br,$t)})})(q,K),Fe=he?ie*z:ie,ke=0,Ve=I;ke<Ve.length;ke+=1)for(var je=0,Ze=Ve[ke];je<Ze.length;je+=1){var at=Ze[je],gt=he?at:Lh(at,K),_t=Fe,Rt=Hf([],[at.x,at.y,0,1],K);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_t*=Rt[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_t*=k.cameraToCenterDistance/Rt[3]),Ks(_e,gt,_t))return!0}return!1},u})(Ur));function Lh(a,u){var p=Hf([],[a.x,a.y,0,1],u);return new b(p[0]/p[3],p[1]/p[3])}var om=(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Ps);function Iu(a,u,p,x){var B=u.width,I=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==B*I*p)throw new RangeError("mismatched image size")}else x=new Uint8Array(B*I*p);return a.width=B,a.height=I,a.data=x,a}function Vf(a,u,p){var x=u.width,B=u.height;if(x!==a.width||B!==a.height){var I=Iu({},{width:x,height:B},p);hb(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,B)},p),a.width=x,a.height=B,a.data=I.data}}function hb(a,u,p,x,B,I){if(B.width===0||B.height===0)return u;if(B.width>a.width||B.height>a.height||p.x>a.width-B.width||p.y>a.height-B.height)throw new RangeError("out of range source coordinates for image copy");if(B.width>u.width||B.height>u.height||x.x>u.width-B.width||x.y>u.height-B.height)throw new RangeError("out of range destination coordinates for image copy");for(var R=a.data,k=u.data,z=0;z<B.height;z++)for(var K=((p.y+z)*a.width+p.x)*I,q=((x.y+z)*u.width+x.x)*I,ie=0;ie<B.width*I;ie++)k[q+ie]=R[K+ie];return u}or("HeatmapBucket",om,{omit:["layers"]});var Rh=function(a,u){Iu(this,a,1,u)};Rh.prototype.resize=function(a){Vf(this,a,1)},Rh.prototype.clone=function(){return new Rh({width:this.width,height:this.height},new Uint8Array(this.data))},Rh.copy=function(a,u,p,x,B){hb(a,u,p,x,B,1)};var uo=function(a,u){Iu(this,a,4,u)};uo.prototype.resize=function(a){Vf(this,a,4)},uo.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},uo.prototype.clone=function(){return new uo({width:this.width,height:this.height},new Uint8Array(this.data))},uo.copy=function(a,u,p,x,B){hb(a,u,p,x,B,4)},or("AlphaImage",Rh),or("RGBAImage",uo);var S9={paint:new Xn({"heatmap-radius":new ur(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ur(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xr(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ki(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xr(oe.paint_heatmap["heatmap-opacity"])})};function QE(a){var u={},p=a.resolution||256,x=a.clips?a.clips.length:1,B=a.image||new uo({width:p,height:x}),I=function(Fe,ke,Ve){u[a.evaluationKey]=Ve;var je=a.expression.evaluate(u);B.data[Fe+ke+0]=Math.floor(255*je.r/je.a),B.data[Fe+ke+1]=Math.floor(255*je.g/je.a),B.data[Fe+ke+2]=Math.floor(255*je.b/je.a),B.data[Fe+ke+3]=Math.floor(255*je.a)};if(a.clips)for(var R=0,k=0;R<x;++R,k+=4*p)for(var z=0,K=0;z<p;z++,K+=4){var q=z/(p-1),ie=a.clips[R];I(k,K,ie.start*(1-q)+ie.end*q)}else for(var he=0,_e=0;he<p;he++,_e+=4)I(0,_e,he/(p-1));return B}var I9=(function(a){function u(p){a.call(this,p,S9),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new om(p)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=QE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u})(Ur),M9={paint:new Xn({"hillshade-illumination-direction":new xr(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xr(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xr(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xr(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xr(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xr(oe.paint_hillshade["hillshade-accent-color"])})},P9=(function(a){function u(p){a.call(this,p,M9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u})(Ur),L9=ki([{name:"a_pos",components:2,type:"Int16"}],4).members,fb=am,R9=am;function am(a,u,p){p=p||2;var x,B,I,R,k,z,K,q=u&&u.length,ie=q?u[0]*p:a.length,he=ZE(a,0,ie,p,!0),_e=[];if(!he||he.next===he.prev)return _e;if(q&&(he=(function(ke,Ve,je,Ze){var at,gt,_t,Rt=[];for(at=0,gt=Ve.length;at<gt;at++)(_t=ZE(ke,Ve[at]*Ze,at<gt-1?Ve[at+1]*Ze:ke.length,Ze,!1))===_t.next&&(_t.steiner=!0),Rt.push(z9(_t));for(Rt.sort(N9),at=0;at<Rt.length;at++)U9(Rt[at],je),je=Mu(je,je.next);return je})(a,u,he,p)),a.length>80*p){x=I=a[0],B=R=a[1];for(var Fe=p;Fe<ie;Fe+=p)(k=a[Fe])<x&&(x=k),(z=a[Fe+1])<B&&(B=z),k>I&&(I=k),z>R&&(R=z);K=(K=Math.max(I-x,R-B))!==0?1/K:0}return fA(he,_e,p,x,B,K),_e}function ZE(a,u,p,x,B){var I,R;if(B===Ab(a,u,p,x)>0)for(I=u;I<p;I+=x)R=YE(I,a[I],a[I+1],R);else for(I=p-x;I>=u;I-=x)R=YE(I,a[I],a[I+1],R);return R&&lm(R,R.next)&&(pA(R),R=R.next),R}function Mu(a,u){if(!a)return a;u||(u=a);var p,x=a;do if(p=!1,x.steiner||!lm(x,x.next)&&zi(x.prev,x,x.next)!==0)x=x.next;else{if(pA(x),(x=u=x.prev)===x.next)break;p=!0}while(p||x!==u);return u}function fA(a,u,p,x,B,I,R){if(a){!R&&I&&(function(q,ie,he,_e){var Fe=q;do Fe.z===null&&(Fe.z=db(Fe.x,Fe.y,ie,he,_e)),Fe.prevZ=Fe.prev,Fe.nextZ=Fe.next,Fe=Fe.next;while(Fe!==q);Fe.prevZ.nextZ=null,Fe.prevZ=null,(function(ke){var Ve,je,Ze,at,gt,_t,Rt,Wt,$t=1;do{for(je=ke,ke=null,gt=null,_t=0;je;){for(_t++,Ze=je,Rt=0,Ve=0;Ve<$t&&(Rt++,Ze=Ze.nextZ);Ve++);for(Wt=$t;Rt>0||Wt>0&&Ze;)Rt!==0&&(Wt===0||!Ze||je.z<=Ze.z)?(at=je,je=je.nextZ,Rt--):(at=Ze,Ze=Ze.nextZ,Wt--),gt?gt.nextZ=at:ke=at,at.prevZ=gt,gt=at;je=Ze}gt.nextZ=null,$t*=2}while(_t>1)})(Fe)})(a,x,B,I);for(var k,z,K=a;a.prev!==a.next;)if(k=a.prev,z=a.next,I?D9(a,x,B,I):O9(a))u.push(k.i/p),u.push(a.i/p),u.push(z.i/p),pA(a),a=z.next,K=z.next;else if((a=z)===K){R?R===1?fA(a=F9(Mu(a),u,p),u,p,x,B,I,2):R===2&&k9(a,u,p,x,B,I):fA(Mu(a),u,p,x,B,I,1);break}}}function O9(a){var u=a.prev,p=a,x=a.next;if(zi(u,p,x)>=0)return!1;for(var B=a.next.next;B!==a.prev;){if(Wf(u.x,u.y,p.x,p.y,x.x,x.y,B.x,B.y)&&zi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function D9(a,u,p,x){var B=a.prev,I=a,R=a.next;if(zi(B,I,R)>=0)return!1;for(var k=B.x>I.x?B.x>R.x?B.x:R.x:I.x>R.x?I.x:R.x,z=B.y>I.y?B.y>R.y?B.y:R.y:I.y>R.y?I.y:R.y,K=db(B.x<I.x?B.x<R.x?B.x:R.x:I.x<R.x?I.x:R.x,B.y<I.y?B.y<R.y?B.y:R.y:I.y<R.y?I.y:R.y,u,p,x),q=db(k,z,u,p,x),ie=a.prevZ,he=a.nextZ;ie&&ie.z>=K&&he&&he.z<=q;){if(ie!==a.prev&&ie!==a.next&&Wf(B.x,B.y,I.x,I.y,R.x,R.y,ie.x,ie.y)&&zi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,he!==a.prev&&he!==a.next&&Wf(B.x,B.y,I.x,I.y,R.x,R.y,he.x,he.y)&&zi(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ie&&ie.z>=K;){if(ie!==a.prev&&ie!==a.next&&Wf(B.x,B.y,I.x,I.y,R.x,R.y,ie.x,ie.y)&&zi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;he&&he.z<=q;){if(he!==a.prev&&he!==a.next&&Wf(B.x,B.y,I.x,I.y,R.x,R.y,he.x,he.y)&&zi(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function F9(a,u,p){var x=a;do{var B=x.prev,I=x.next.next;!lm(B,I)&&$E(B,x,x.next,I)&&dA(B,I)&&dA(I,B)&&(u.push(B.i/p),u.push(x.i/p),u.push(I.i/p),pA(x),pA(x.next),x=a=I),x=x.next}while(x!==a);return Mu(x)}function k9(a,u,p,x,B,I){var R=a;do{for(var k=R.next.next;k!==R.prev;){if(R.i!==k.i&&j9(R,k)){var z=qE(R,k);return R=Mu(R,R.next),z=Mu(z,z.next),fA(R,u,p,x,B,I),void fA(z,u,p,x,B,I)}k=k.next}R=R.next}while(R!==a)}function N9(a,u){return a.x-u.x}function U9(a,u){if(u=(function(x,B){var I,R=B,k=x.x,z=x.y,K=-1/0;do{if(z<=R.y&&z>=R.next.y&&R.next.y!==R.y){var q=R.x+(z-R.y)*(R.next.x-R.x)/(R.next.y-R.y);if(q<=k&&q>K){if(K=q,q===k){if(z===R.y)return R;if(z===R.next.y)return R.next}I=R.x<R.next.x?R:R.next}}R=R.next}while(R!==B);if(!I)return null;if(k===K)return I;var ie,he=I,_e=I.x,Fe=I.y,ke=1/0;R=I;do k>=R.x&&R.x>=_e&&k!==R.x&&Wf(z<Fe?k:K,z,_e,Fe,z<Fe?K:k,z,R.x,R.y)&&(ie=Math.abs(z-R.y)/(k-R.x),dA(R,x)&&(ie<ke||ie===ke&&(R.x>I.x||R.x===I.x&&G9(I,R)))&&(I=R,ke=ie)),R=R.next;while(R!==he);return I})(a,u)){var p=qE(u,a);Mu(u,u.next),Mu(p,p.next)}}function G9(a,u){return zi(a.prev,a,u.prev)<0&&zi(u.next,a,a.next)<0}function db(a,u,p,x,B){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*B)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*B)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function z9(a){var u=a,p=a;do(u.x<p.x||u.x===p.x&&u.y<p.y)&&(p=u),u=u.next;while(u!==a);return p}function Wf(a,u,p,x,B,I,R,k){return(B-R)*(u-k)-(a-R)*(I-k)>=0&&(a-R)*(x-k)-(p-R)*(u-k)>=0&&(p-R)*(I-k)-(B-R)*(x-k)>=0}function j9(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!(function(p,x){var B=p;do{if(B.i!==p.i&&B.next.i!==p.i&&B.i!==x.i&&B.next.i!==x.i&&$E(B,B.next,p,x))return!0;B=B.next}while(B!==p);return!1})(a,u)&&(dA(a,u)&&dA(u,a)&&(function(p,x){var B=p,I=!1,R=(p.x+x.x)/2,k=(p.y+x.y)/2;do B.y>k!=B.next.y>k&&B.next.y!==B.y&&R<(B.next.x-B.x)*(k-B.y)/(B.next.y-B.y)+B.x&&(I=!I),B=B.next;while(B!==p);return I})(a,u)&&(zi(a.prev,a,u.prev)||zi(a,u.prev,u))||lm(a,u)&&zi(a.prev,a,a.next)>0&&zi(u.prev,u,u.next)>0)}function zi(a,u,p){return(u.y-a.y)*(p.x-u.x)-(u.x-a.x)*(p.y-u.y)}function lm(a,u){return a.x===u.x&&a.y===u.y}function $E(a,u,p,x){var B=um(zi(a,u,p)),I=um(zi(a,u,x)),R=um(zi(p,x,a)),k=um(zi(p,x,u));return B!==I&&R!==k||!(B!==0||!cm(a,p,u))||!(I!==0||!cm(a,x,u))||!(R!==0||!cm(p,a,x))||!(k!==0||!cm(p,u,x))}function cm(a,u,p){return u.x<=Math.max(a.x,p.x)&&u.x>=Math.min(a.x,p.x)&&u.y<=Math.max(a.y,p.y)&&u.y>=Math.min(a.y,p.y)}function um(a){return a>0?1:a<0?-1:0}function dA(a,u){return zi(a.prev,a,a.next)<0?zi(a,u,a.next)>=0&&zi(a,a.prev,u)>=0:zi(a,u,a.prev)<0||zi(a,a.next,u)<0}function qE(a,u){var p=new pb(a.i,a.x,a.y),x=new pb(u.i,u.x,u.y),B=a.next,I=u.prev;return a.next=u,u.prev=a,p.next=B,B.prev=p,x.next=p,p.prev=x,I.next=x,x.prev=I,x}function YE(a,u,p,x){var B=new pb(a,u,p);return x?(B.next=x.next,B.prev=x,x.next.prev=B,x.next=B):(B.prev=B,B.next=B),B}function pA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function pb(a,u,p){this.i=a,this.x=u,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ab(a,u,p,x){for(var B=0,I=u,R=p-x;I<p;I+=x)B+=(a[R]-a[I])*(a[I+1]+a[R+1]),R=I;return B}function H9(a,u,p,x,B){(function I(R,k,z,K,q){for(;K>z;){if(K-z>600){var ie=K-z+1,he=k-z+1,_e=Math.log(ie),Fe=.5*Math.exp(2*_e/3),ke=.5*Math.sqrt(_e*Fe*(ie-Fe)/ie)*(he-ie/2<0?-1:1);I(R,k,Math.max(z,Math.floor(k-he*Fe/ie+ke)),Math.min(K,Math.floor(k+(ie-he)*Fe/ie+ke)),q)}var Ve=R[k],je=z,Ze=K;for(AA(R,z,k),q(R[K],Ve)>0&&AA(R,z,K);je<Ze;){for(AA(R,je,Ze),je++,Ze--;q(R[je],Ve)<0;)je++;for(;q(R[Ze],Ve)>0;)Ze--}q(R[z],Ve)===0?AA(R,z,Ze):AA(R,++Ze,K),Ze<=k&&(z=Ze+1),k<=Ze&&(K=Ze-1)}})(a,u,p,x||a.length-1,B||V9)}function AA(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}function V9(a,u){return a<u?-1:a>u?1:0}function gb(a,u){var p=a.length;if(p<=1)return[a];for(var x,B,I=[],R=0;R<p;R++){var k=ct(a[R]);k!==0&&(a[R].area=Math.abs(k),B===void 0&&(B=k<0),B===k<0?(x&&I.push(x),x=[a[R]]):x.push(a[R]))}if(x&&I.push(x),u>1)for(var z=0;z<I.length;z++)I[z].length<=u||(H9(I[z],u,1,I[z].length-1,W9),I[z]=I[z].slice(0,u));return I}function W9(a,u){return u.area-a.area}function mb(a,u,p){for(var x=p.patternDependencies,B=!1,I=0,R=u;I<R.length;I+=1){var k=R[I].paint.get(a+"-pattern");k.isConstant()||(B=!0);var z=k.constantOr(null);z&&(B=!0,x[z.to]=!0,x[z.from]=!0)}return B}function _b(a,u,p,x,B){for(var I=B.patternDependencies,R=0,k=u;R<k.length;R+=1){var z=k[R],K=z.paint.get(a+"-pattern").value;if(K.kind!=="constant"){var q=K.evaluate({zoom:x-1},p,{},B.availableImages),ie=K.evaluate({zoom:x},p,{},B.availableImages),he=K.evaluate({zoom:x+1},p,{},B.availableImages);ie=ie&&ie.name?ie.name:ie,he=he&&he.name?he.name:he,I[q=q&&q.name?q.name:q]=!0,I[ie]=!0,I[he]=!0,p.patterns[z.id]={min:q,mid:ie,max:he}}}return p}am.deviation=function(a,u,p,x){var B=u&&u.length,I=Math.abs(Ab(a,0,B?u[0]*p:a.length,p));if(B)for(var R=0,k=u.length;R<k;R++)I-=Math.abs(Ab(a,u[R]*p,R<k-1?u[R+1]*p:a.length,p));var z=0;for(R=0;R<x.length;R+=3){var K=x[R]*p,q=x[R+1]*p,ie=x[R+2]*p;z+=Math.abs((a[K]-a[ie])*(a[q+1]-a[K+1])-(a[K]-a[q])*(a[ie+1]-a[K+1]))}return I===0&&z===0?0:Math.abs((z-I)/I)},am.flatten=function(a){for(var u=a[0][0].length,p={vertices:[],holes:[],dimensions:u},x=0,B=0;B<a.length;B++){for(var I=0;I<a[B].length;I++)for(var R=0;R<u;R++)p.vertices.push(a[B][I][R]);B>0&&p.holes.push(x+=a[B-1].length)}return p},fb.default=R9;var ol=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Js,this.indexArray=new sa,this.indexArray2=new T,this.programConfigurations=new Or(a.layers,a.zoom),this.segments=new $,this.segments2=new $,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ol.prototype.populate=function(a,u,p){this.hasPattern=mb("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),B=[],I=0,R=a;I<R.length;I+=1){var k=R[I],z=k.feature,K=k.id,q=k.index,ie=k.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,_e=Pi(z,he);if(this.layers[0]._featureFilter.filter(new Hr(this.zoom),_e,p)){var Fe=x?x.evaluate(_e,{},p,u.availableImages):void 0,ke={id:K,properties:z.properties,type:z.type,sourceLayerIndex:ie,index:q,geometry:he?_e.geometry:vi(z),patterns:{},sortKey:Fe};B.push(ke)}}x&&B.sort(function(Wt,$t){return Wt.sortKey-$t.sortKey});for(var Ve=0,je=B;Ve<je.length;Ve+=1){var Ze=je[Ve],at=Ze.geometry,gt=Ze.index,_t=Ze.sourceLayerIndex;if(this.hasPattern){var Rt=_b("fill",this.layers,Ze,this.zoom,u);this.patternFeatures.push(Rt)}else this.addFeature(Ze,at,gt,p,{});u.featureIndex.insert(a[gt].feature,at,gt,_t,this.index)}},ol.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},ol.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},ol.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ol.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ol.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,L9),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},ol.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ol.prototype.addFeature=function(a,u,p,x,B){for(var I=0,R=gb(u,500);I<R.length;I+=1){for(var k=R[I],z=0,K=0,q=k;K<q.length;K+=1)z+=q[K].length;for(var ie=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),he=ie.vertexLength,_e=[],Fe=[],ke=0,Ve=k;ke<Ve.length;ke+=1){var je=Ve[ke];if(je.length!==0){je!==k[0]&&Fe.push(_e.length/2);var Ze=this.segments2.prepareSegment(je.length,this.layoutVertexArray,this.indexArray2),at=Ze.vertexLength;this.layoutVertexArray.emplaceBack(je[0].x,je[0].y),this.indexArray2.emplaceBack(at+je.length-1,at),_e.push(je[0].x),_e.push(je[0].y);for(var gt=1;gt<je.length;gt++)this.layoutVertexArray.emplaceBack(je[gt].x,je[gt].y),this.indexArray2.emplaceBack(at+gt-1,at+gt),_e.push(je[gt].x),_e.push(je[gt].y);Ze.vertexLength+=je.length,Ze.primitiveLength+=je.length}}for(var _t=fb(_e,Fe),Rt=0;Rt<_t.length;Rt+=3)this.indexArray.emplaceBack(he+_t[Rt],he+_t[Rt+1],he+_t[Rt+2]);ie.vertexLength+=z,ie.primitiveLength+=_t.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},or("FillBucket",ol,{omit:["layers","patternFeatures"]});var J9=new Xn({"fill-sort-key":new ur(oe.layout_fill["fill-sort-key"])}),K9={paint:new Xn({"fill-antialias":new xr(oe.paint_fill["fill-antialias"]),"fill-opacity":new ur(oe.paint_fill["fill-opacity"]),"fill-color":new ur(oe.paint_fill["fill-color"]),"fill-outline-color":new ur(oe.paint_fill["fill-outline-color"]),"fill-translate":new xr(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new xr(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Eu(oe.paint_fill["fill-pattern"])}),layout:J9},X9=(function(a){function u(p){a.call(this,p,K9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x);var B=this.paint._values["fill-outline-color"];B.value.kind==="constant"&&B.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(p){return new ol(p)},u.prototype.queryRadius=function(){return Qi(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,R,k,z){return oa(sl(p,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,z),I)},u.prototype.isTileClipped=function(){return!0},u})(Ur),Q9=ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,e3=Jf;function Jf(a,u,p,x,B){this.properties={},this.extent=p,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=B,a.readFields(Z9,this,u)}function Z9(a,u,p){a==1?u.id=p.readVarint():a==2?(function(x,B){for(var I=x.readVarint()+x.pos;x.pos<I;){var R=B._keys[x.readVarint()],k=B._values[x.readVarint()];B.properties[R]=k}})(p,u):a==3?u.type=p.readVarint():a==4&&(u._geometry=p.pos)}function $9(a){for(var u,p,x=0,B=0,I=a.length,R=I-1;B<I;R=B++)x+=((p=a[R]).x-(u=a[B]).x)*(u.y+p.y);return x}Jf.types=["Unknown","Point","LineString","Polygon"],Jf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,p=a.readVarint()+a.pos,x=1,B=0,I=0,R=0,k=[];a.pos<p;){if(B<=0){var z=a.readVarint();x=7&z,B=z>>3}if(B--,x===1||x===2)I+=a.readSVarint(),R+=a.readSVarint(),x===1&&(u&&k.push(u),u=[]),u.push(new b(I,R));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&k.push(u),k},Jf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,p=1,x=0,B=0,I=0,R=1/0,k=-1/0,z=1/0,K=-1/0;a.pos<u;){if(x<=0){var q=a.readVarint();p=7&q,x=q>>3}if(x--,p===1||p===2)(B+=a.readSVarint())<R&&(R=B),B>k&&(k=B),(I+=a.readSVarint())<z&&(z=I),I>K&&(K=I);else if(p!==7)throw new Error("unknown command "+p)}return[R,z,k,K]},Jf.prototype.toGeoJSON=function(a,u,p){var x,B,I=this.extent*Math.pow(2,p),R=this.extent*a,k=this.extent*u,z=this.loadGeometry(),K=Jf.types[this.type];function q(_e){for(var Fe=0;Fe<_e.length;Fe++){var ke=_e[Fe];_e[Fe]=[360*(ke.x+R)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+k)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var ie=[];for(x=0;x<z.length;x++)ie[x]=z[x][0];q(z=ie);break;case 2:for(x=0;x<z.length;x++)q(z[x]);break;case 3:for(z=(function(_e){var Fe=_e.length;if(Fe<=1)return[_e];for(var ke,Ve,je=[],Ze=0;Ze<Fe;Ze++){var at=$9(_e[Ze]);at!==0&&(Ve===void 0&&(Ve=at<0),Ve===at<0?(ke&&je.push(ke),ke=[_e[Ze]]):ke.push(_e[Ze]))}return ke&&je.push(ke),je})(z),x=0;x<z.length;x++)for(B=0;B<z[x].length;B++)q(z[x][B])}z.length===1?z=z[0]:K="Multi"+K;var he={type:"Feature",geometry:{type:K,coordinates:z},properties:this.properties};return"id"in this&&(he.id=this.id),he};var t3=r3;function r3(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(q9,this,u),this.length=this._features.length}function q9(a,u,p){a===15?u.version=p.readVarint():a===1?u.name=p.readString():a===5?u.extent=p.readVarint():a===2?u._features.push(p.pos):a===3?u._keys.push(p.readString()):a===4&&u._values.push((function(x){for(var B=null,I=x.readVarint()+x.pos;x.pos<I;){var R=x.readVarint()>>3;B=R===1?x.readString():R===2?x.readFloat():R===3?x.readDouble():R===4?x.readVarint64():R===5?x.readVarint():R===6?x.readSVarint():R===7?x.readBoolean():null}return B})(p))}function Y9(a,u,p){if(a===3){var x=new t3(p,p.readVarint()+p.pos);x.length&&(u[x.name]=x)}}r3.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new e3(this._pbf,u,this.extent,this._keys,this._values)};var Kf={VectorTile:function(a,u){this.layers=a.readFields(Y9,{},u)},VectorTileFeature:e3,VectorTileLayer:t3},eN=Kf.VectorTileFeature.types,yb=Math.pow(2,13);function gA(a,u,p,x,B,I,R,k){a.emplaceBack(u,p,2*Math.floor(x*yb)+R,B*yb*2,I*yb*2,Math.round(k))}var al=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new di,this.indexArray=new sa,this.programConfigurations=new Or(a.layers,a.zoom),this.segments=new $,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function tN(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}al.prototype.populate=function(a,u,p){this.features=[],this.hasPattern=mb("fill-extrusion",this.layers,u);for(var x=0,B=a;x<B.length;x+=1){var I=B[x],R=I.feature,k=I.id,z=I.index,K=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,ie=Pi(R,q);if(this.layers[0]._featureFilter.filter(new Hr(this.zoom),ie,p)){var he={id:k,sourceLayerIndex:K,index:z,geometry:q?ie.geometry:vi(R),properties:R.properties,type:R.type,patterns:{}};this.hasPattern?this.features.push(_b("fill-extrusion",this.layers,he,this.zoom,u)):this.addFeature(he,he.geometry,z,p,{}),u.featureIndex.insert(R,he.geometry,z,K,this.index,!0)}}},al.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.features;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},al.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},al.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},al.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},al.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Q9),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},al.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},al.prototype.addFeature=function(a,u,p,x,B){for(var I=0,R=gb(u,500);I<R.length;I+=1){for(var k=R[I],z=0,K=0,q=k;K<q.length;K+=1)z+=q[K].length;for(var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,_e=k;he<_e.length;he+=1){var Fe=_e[he];if(Fe.length!==0&&!((fn=Fe).every(function(Zr){return Zr.x<0})||fn.every(function(Zr){return Zr.x>8192})||fn.every(function(Zr){return Zr.y<0})||fn.every(function(Zr){return Zr.y>8192})))for(var ke=0,Ve=0;Ve<Fe.length;Ve++){var je=Fe[Ve];if(Ve>=1){var Ze=Fe[Ve-1];if(!tN(je,Ze)){ie.vertexLength+4>$.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var at=je.sub(Ze)._perp()._unit(),gt=Ze.dist(je);ke+gt>32768&&(ke=0),gA(this.layoutVertexArray,je.x,je.y,at.x,at.y,0,0,ke),gA(this.layoutVertexArray,je.x,je.y,at.x,at.y,0,1,ke),gA(this.layoutVertexArray,Ze.x,Ze.y,at.x,at.y,0,0,ke+=gt),gA(this.layoutVertexArray,Ze.x,Ze.y,at.x,at.y,0,1,ke);var _t=ie.vertexLength;this.indexArray.emplaceBack(_t,_t+2,_t+1),this.indexArray.emplaceBack(_t+1,_t+2,_t+3),ie.vertexLength+=4,ie.primitiveLength+=2}}}}if(ie.vertexLength+z>$.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),eN[a.type]==="Polygon"){for(var Rt=[],Wt=[],$t=ie.vertexLength,br=0,nr=k;br<nr.length;br+=1){var Br=nr[br];if(Br.length!==0){Br!==k[0]&&Wt.push(Rt.length/2);for(var ir=0;ir<Br.length;ir++){var sn=Br[ir];gA(this.layoutVertexArray,sn.x,sn.y,0,0,1,1,0),Rt.push(sn.x),Rt.push(sn.y)}}}for(var Dr=fb(Rt,Wt),fr=0;fr<Dr.length;fr+=3)this.indexArray.emplaceBack($t+Dr[fr],$t+Dr[fr+2],$t+Dr[fr+1]);ie.primitiveLength+=Dr.length/3,ie.vertexLength+=z}}var fn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},or("FillExtrusionBucket",al,{omit:["layers","features"]});var rN={paint:new Xn({"fill-extrusion-opacity":new xr(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ur(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xr(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xr(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Eu(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ur(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ur(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xr(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},nN=(function(a){function u(p){a.call(this,p,rN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new al(p)},u.prototype.queryRadius=function(){return Qi(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(p,x,B,I,R,k,z,K){var q=sl(p,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,z),ie=this.paint.get("fill-extrusion-height").evaluate(x,B),he=this.paint.get("fill-extrusion-base").evaluate(x,B),_e=(function(ke,Ve,je,Ze){for(var at=[],gt=0,_t=ke;gt<_t.length;gt+=1){var Rt=_t[gt],Wt=[Rt.x,Rt.y,0,1];Hf(Wt,Wt,Ve),at.push(new b(Wt[0]/Wt[3],Wt[1]/Wt[3]))}return at})(q,K),Fe=(function(ke,Ve,je,Ze){for(var at=[],gt=[],_t=Ze[8]*Ve,Rt=Ze[9]*Ve,Wt=Ze[10]*Ve,$t=Ze[11]*Ve,br=Ze[8]*je,nr=Ze[9]*je,Br=Ze[10]*je,ir=Ze[11]*je,sn=0,Dr=ke;sn<Dr.length;sn+=1){for(var fr=[],fn=[],Zr=0,vn=Dr[sn];Zr<vn.length;Zr+=1){var Tr=vn[Zr],Cn=Tr.x,ii=Tr.y,Si=Ze[0]*Cn+Ze[4]*ii+Ze[12],xi=Ze[1]*Cn+Ze[5]*ii+Ze[13],si=Ze[2]*Cn+Ze[6]*ii+Ze[14],Ii=Ze[3]*Cn+Ze[7]*ii+Ze[15],Zi=si+Wt,$i=Ii+$t,Rs=Si+br,as=xi+nr,Os=si+Br,Li=Ii+ir,ls=new b((Si+_t)/$i,(xi+Rt)/$i);ls.z=Zi/$i,fr.push(ls);var gn=new b(Rs/Li,as/Li);gn.z=Os/Li,fn.push(gn)}at.push(fr),gt.push(fn)}return[at,gt]})(I,he,ie,K);return(function(ke,Ve,je){var Ze=1/0;oa(je,Ve)&&(Ze=n3(je,Ve[0]));for(var at=0;at<Ve.length;at++)for(var gt=Ve[at],_t=ke[at],Rt=0;Rt<gt.length-1;Rt++){var Wt=gt[Rt],$t=[Wt,gt[Rt+1],_t[Rt+1],_t[Rt],Wt];Hl(je,$t)&&(Ze=Math.min(Ze,n3(je,$t)))}return Ze!==1/0&&Ze})(Fe[0],Fe[1],_e)},u})(Ur);function mA(a,u){return a.x*u.x+a.y*u.y}function n3(a,u){if(a.length===1){for(var p,x=0,B=u[x++];!p||B.equals(p);)if(!(p=u[x++]))return 1/0;for(;x<u.length;x++){var I=u[x],R=a[0],k=p.sub(B),z=I.sub(B),K=R.sub(B),q=mA(k,k),ie=mA(k,z),he=mA(z,z),_e=mA(K,k),Fe=mA(K,z),ke=q*he-ie*ie,Ve=(he*_e-ie*Fe)/ke,je=(q*Fe-ie*_e)/ke,Ze=B.z*(1-Ve-je)+p.z*Ve+I.z*je;if(isFinite(Ze))return Ze}return 1/0}for(var at=1/0,gt=0,_t=u;gt<_t.length;gt+=1)at=Math.min(at,_t[gt].z);return at}var iN=ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,sN=ki([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,oN=Kf.VectorTileFeature.types,aN=Math.cos(Math.PI/180*37.5),i3=Math.pow(2,14)/.5,Qs=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){u.gradients[p.id]={}}),this.layoutVertexArray=new is,this.layoutVertexArray2=new Eo,this.indexArray=new sa,this.programConfigurations=new Or(a.layers,a.zoom),this.segments=new $,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};Qs.prototype.populate=function(a,u,p){this.hasPattern=mb("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),B=[],I=0,R=a;I<R.length;I+=1){var k=R[I],z=k.feature,K=k.id,q=k.index,ie=k.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,_e=Pi(z,he);if(this.layers[0]._featureFilter.filter(new Hr(this.zoom),_e,p)){var Fe=x?x.evaluate(_e,{},p):void 0,ke={id:K,properties:z.properties,type:z.type,sourceLayerIndex:ie,index:q,geometry:he?_e.geometry:vi(z),patterns:{},sortKey:Fe};B.push(ke)}}x&&B.sort(function(Wt,$t){return Wt.sortKey-$t.sortKey});for(var Ve=0,je=B;Ve<je.length;Ve+=1){var Ze=je[Ve],at=Ze.geometry,gt=Ze.index,_t=Ze.sourceLayerIndex;if(this.hasPattern){var Rt=_b("line",this.layers,Ze,this.zoom,u);this.patternFeatures.push(Rt)}else this.addFeature(Ze,at,gt,p,{});u.featureIndex.insert(a[gt].feature,at,gt,_t,this.index)}},Qs.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},Qs.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},Qs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qs.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,sN)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,iN),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Qs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Qs.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Qs.prototype.addFeature=function(a,u,p,x,B){var I=this.layers[0].layout,R=I.get("line-join").evaluate(a,{}),k=I.get("line-cap"),z=I.get("line-miter-limit"),K=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var q=0,ie=u;q<ie.length;q+=1)this.addLine(ie[q],a,R,k,z,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},Qs.prototype.addLine=function(a,u,p,x,B,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var R=0;R<a.length-1;R++)this.totalDistance+=a[R].dist(a[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var k=oN[u.type]==="Polygon",z=a.length;z>=2&&a[z-1].equals(a[z-2]);)z--;for(var K=0;K<z-1&&a[K].equals(a[K+1]);)K++;if(!(z<(k?3:2))){p==="bevel"&&(B=1.05);var q,ie=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),_e=void 0,Fe=void 0,ke=void 0,Ve=void 0;this.e1=this.e2=-1,k&&(Ve=a[K].sub(q=a[z-2])._unit()._perp());for(var je=K;je<z;je++)if(!(Fe=je===z-1?k?a[K+1]:void 0:a[je+1])||!a[je].equals(Fe)){Ve&&(ke=Ve),q&&(_e=q),q=a[je],Ve=Fe?Fe.sub(q)._unit()._perp():ke;var Ze=(ke=ke||Ve).add(Ve);Ze.x===0&&Ze.y===0||Ze._unit();var at=ke.x*Ve.x+ke.y*Ve.y,gt=Ze.x*Ve.x+Ze.y*Ve.y,_t=gt!==0?1/gt:1/0,Rt=2*Math.sqrt(2-2*gt),Wt=gt<aN&&_e&&Fe,$t=ke.x*Ve.y-ke.y*Ve.x>0;if(Wt&&je>K){var br=q.dist(_e);if(br>2*ie){var nr=q.sub(q.sub(_e)._mult(ie/br)._round());this.updateDistance(_e,nr),this.addCurrentVertex(nr,ke,0,0,he),_e=nr}}var Br=_e&&Fe,ir=Br?p:k?"butt":x;if(Br&&ir==="round"&&(_t<I?ir="miter":_t<=2&&(ir="fakeround")),ir==="miter"&&_t>B&&(ir="bevel"),ir==="bevel"&&(_t>2&&(ir="flipbevel"),_t<B&&(ir="miter")),_e&&this.updateDistance(_e,q),ir==="miter")Ze._mult(_t),this.addCurrentVertex(q,Ze,0,0,he);else if(ir==="flipbevel"){if(_t>100)Ze=Ve.mult(-1);else{var sn=_t*ke.add(Ve).mag()/ke.sub(Ve).mag();Ze._perp()._mult(sn*($t?-1:1))}this.addCurrentVertex(q,Ze,0,0,he),this.addCurrentVertex(q,Ze.mult(-1),0,0,he)}else if(ir==="bevel"||ir==="fakeround"){var Dr=-Math.sqrt(_t*_t-1),fr=$t?Dr:0,fn=$t?0:Dr;if(_e&&this.addCurrentVertex(q,ke,fr,fn,he),ir==="fakeround")for(var Zr=Math.round(180*Rt/Math.PI/20),vn=1;vn<Zr;vn++){var Tr=vn/Zr;if(Tr!==.5){var Cn=Tr-.5;Tr+=Tr*Cn*(Tr-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*Cn*Cn+(.848013+at*(.215638*at-1.06021)))}var ii=Ve.sub(ke)._mult(Tr)._add(ke)._unit()._mult($t?-1:1);this.addHalfVertex(q,ii.x,ii.y,!1,$t,0,he)}Fe&&this.addCurrentVertex(q,Ve,-fr,-fn,he)}else if(ir==="butt")this.addCurrentVertex(q,Ze,0,0,he);else if(ir==="square"){var Si=_e?1:-1;this.addCurrentVertex(q,Ze,Si,Si,he)}else ir==="round"&&(_e&&(this.addCurrentVertex(q,ke,0,0,he),this.addCurrentVertex(q,ke,1,1,he,!0)),Fe&&(this.addCurrentVertex(q,Ve,-1,-1,he,!0),this.addCurrentVertex(q,Ve,0,0,he)));if(Wt&&je<z-1){var xi=q.dist(Fe);if(xi>2*ie){var si=q.add(Fe.sub(q)._mult(ie/xi)._round());this.updateDistance(q,si),this.addCurrentVertex(si,Ve,0,0,he),q=si}}}}},Qs.prototype.addCurrentVertex=function(a,u,p,x,B,I){I===void 0&&(I=!1);var R=u.y*x-u.x,k=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*p,u.y-u.x*p,I,!1,p,B),this.addHalfVertex(a,R,k,I,!0,-x,B),this.distance>i3/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,p,x,B,I))},Qs.prototype.addHalfVertex=function(a,u,p,x,B,I,R){var k=.5*(this.lineClips?this.scaledDistance*(i3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(B?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),R.primitiveLength++),B?this.e2=z:this.e1=z},Qs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Qs.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},or("LineBucket",Qs,{omit:["layers","patternFeatures"]});var lN=new Xn({"line-cap":new xr(oe.layout_line["line-cap"]),"line-join":new ur(oe.layout_line["line-join"]),"line-miter-limit":new xr(oe.layout_line["line-miter-limit"]),"line-round-limit":new xr(oe.layout_line["line-round-limit"]),"line-sort-key":new ur(oe.layout_line["line-sort-key"])}),s3={paint:new Xn({"line-opacity":new ur(oe.paint_line["line-opacity"]),"line-color":new ur(oe.paint_line["line-color"]),"line-translate":new xr(oe.paint_line["line-translate"]),"line-translate-anchor":new xr(oe.paint_line["line-translate-anchor"]),"line-width":new ur(oe.paint_line["line-width"]),"line-gap-width":new ur(oe.paint_line["line-gap-width"]),"line-offset":new ur(oe.paint_line["line-offset"]),"line-blur":new ur(oe.paint_line["line-blur"]),"line-dasharray":new us(oe.paint_line["line-dasharray"]),"line-pattern":new Eu(oe.paint_line["line-pattern"]),"line-gradient":new Ki(oe.paint_line["line-gradient"])}),layout:lN},o3=new((function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x){return x=new Hr(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,p,x)},u.prototype.evaluate=function(p,x,B,I){return x=ee({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,p,x,B,I)},u})(ur))(s3.paint.properties["line-width"].specification);o3.useIntegerZoom=!0;var cN=(function(a){function u(p){a.call(this,p,s3),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof zn,this.gradientVersion=(this.gradientVersion+1)%D)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x),this.paint._values["line-floorwidth"]=o3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,p)},u.prototype.createBucket=function(p){return new Qs(p)},u.prototype.queryRadius=function(p){var x=p,B=a3(Pa("line-width",this,x),Pa("line-gap-width",this,x)),I=Pa("line-offset",this,x);return B/2+Math.abs(I)+Qi(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,R,k,z){var K=sl(p,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,z),q=z/2*a3(this.paint.get("line-width").evaluate(x,B),this.paint.get("line-gap-width").evaluate(x,B)),ie=this.paint.get("line-offset").evaluate(x,B);return ie&&(I=(function(he,_e){for(var Fe=[],ke=new b(0,0),Ve=0;Ve<he.length;Ve++){for(var je=he[Ve],Ze=[],at=0;at<je.length;at++){var gt=je[at],_t=je[at+1],Rt=at===0?ke:gt.sub(je[at-1])._unit()._perp(),Wt=at===je.length-1?ke:_t.sub(gt)._unit()._perp(),$t=Rt._add(Wt)._unit();$t._mult(1/($t.x*Wt.x+$t.y*Wt.y)),Ze.push($t._mult(_e)._add(gt))}Fe.push(Ze)}return Fe})(I,ie*z)),(function(he,_e,Fe){for(var ke=0;ke<_e.length;ke++){var Ve=_e[ke];if(he.length>=3){for(var je=0;je<Ve.length;je++)if(Ma(he,Ve[je]))return!0}if(Fo(he,Ve,Fe))return!0}return!1})(K,I,q)},u.prototype.isTileClipped=function(){return!0},u})(Ur);function a3(a,u){return u>0?u+2*a:a}var uN=ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hN=ki([{name:"a_projected_pos",components:3,type:"Float32"}],4),fN=(ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),l3=(ki([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),dN=ki([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pN(a,u,p){return a.sections.forEach(function(x){x.text=(function(B,I,R){var k=I.layout.get("text-transform").evaluate(R,{});return k==="uppercase"?B=B.toLocaleUpperCase():k==="lowercase"&&(B=B.toLocaleLowerCase()),rs.applyArabicShaping&&(B=rs.applyArabicShaping(B)),B})(x.text,u,p)}),a}ki([{name:"triangle",components:3,type:"Uint16"}]),ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ki([{type:"Float32",name:"offsetX"}]),ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var _A={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},c3=function(a,u,p,x,B){var I,R,k=8*B-x-1,z=(1<<k)-1,K=z>>1,q=-7,ie=B-1,he=-1,_e=a[u+ie];for(ie+=he,I=_e&(1<<-q)-1,_e>>=-q,q+=k;q>0;I=256*I+a[u+ie],ie+=he,q-=8);for(R=I&(1<<-q)-1,I>>=-q,q+=x;q>0;R=256*R+a[u+ie],ie+=he,q-=8);if(I===0)I=1-K;else{if(I===z)return R?NaN:1/0*(_e?-1:1);R+=Math.pow(2,x),I-=K}return(_e?-1:1)*R*Math.pow(2,I-x)},u3=function(a,u,p,x,B,I){var R,k,z,K=8*I-B-1,q=(1<<K)-1,ie=q>>1,he=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=0,Fe=1,ke=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(k=isNaN(u)?1:0,R=q):(R=Math.floor(Math.log(u)/Math.LN2),u*(z=Math.pow(2,-R))<1&&(R--,z*=2),(u+=R+ie>=1?he/z:he*Math.pow(2,1-ie))*z>=2&&(R++,z/=2),R+ie>=q?(k=0,R=q):R+ie>=1?(k=(u*z-1)*Math.pow(2,B),R+=ie):(k=u*Math.pow(2,ie-1)*Math.pow(2,B),R=0));B>=8;a[p+_e]=255&k,_e+=Fe,k/=256,B-=8);for(R=R<<B|k,K+=B;K>0;a[p+_e]=255&R,_e+=Fe,R/=256,K-=8);a[p+_e-Fe]|=128*ke},hm=Qn;function Qn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var h3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function kc(a){return a.type===Qn.Bytes?a.readVarint()+a.pos:a.pos+1}function AN(a,u,p){return p?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function f3(a,u,p){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));p.realloc(x);for(var B=p.pos-1;B>=a;B--)p.buf[B+x]=p.buf[B]}function gN(a,u){for(var p=0;p<a.length;p++)u.writeVarint(a[p])}function mN(a,u){for(var p=0;p<a.length;p++)u.writeSVarint(a[p])}function _N(a,u){for(var p=0;p<a.length;p++)u.writeFloat(a[p])}function yN(a,u){for(var p=0;p<a.length;p++)u.writeDouble(a[p])}function bN(a,u){for(var p=0;p<a.length;p++)u.writeBoolean(a[p])}function vN(a,u){for(var p=0;p<a.length;p++)u.writeFixed32(a[p])}function xN(a,u){for(var p=0;p<a.length;p++)u.writeSFixed32(a[p])}function wN(a,u){for(var p=0;p<a.length;p++)u.writeFixed64(a[p])}function CN(a,u){for(var p=0;p<a.length;p++)u.writeSFixed64(a[p])}function fm(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function Xf(a,u,p){a[p]=u,a[p+1]=u>>>8,a[p+2]=u>>>16,a[p+3]=u>>>24}function d3(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function EN(a,u,p){a===1&&p.readMessage(BN,u)}function BN(a,u,p){if(a===3){var x=p.readMessage(TN,{}),B=x.width,I=x.height,R=x.left,k=x.top,z=x.advance;u.push({id:x.id,bitmap:new Rh({width:B+6,height:I+6},x.bitmap),metrics:{width:B,height:I,left:R,top:k,advance:z}})}}function TN(a,u,p){a===1?u.id=p.readVarint():a===2?u.bitmap=p.readBytes():a===3?u.width=p.readVarint():a===4?u.height=p.readVarint():a===5?u.left=p.readSVarint():a===6?u.top=p.readSVarint():a===7&&(u.advance=p.readVarint())}function p3(a){for(var u=0,p=0,x=0,B=a;x<B.length;x+=1){var I=B[x];u+=I.w*I.h,p=Math.max(p,I.w)}a.sort(function(ke,Ve){return Ve.h-ke.h});for(var R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),p),h:1/0}],k=0,z=0,K=0,q=a;K<q.length;K+=1)for(var ie=q[K],he=R.length-1;he>=0;he--){var _e=R[he];if(!(ie.w>_e.w||ie.h>_e.h)){if(ie.x=_e.x,ie.y=_e.y,z=Math.max(z,ie.y+ie.h),k=Math.max(k,ie.x+ie.w),ie.w===_e.w&&ie.h===_e.h){var Fe=R.pop();he<R.length&&(R[he]=Fe)}else ie.h===_e.h?(_e.x+=ie.w,_e.w-=ie.w):ie.w===_e.w?(_e.y+=ie.h,_e.h-=ie.h):(R.push({x:_e.x+ie.w,y:_e.y,w:_e.w-ie.w,h:ie.h}),_e.y+=ie.h,_e.h-=ie.h);break}}return{w:k,h:z,fill:u/(k*z)||0}}Qn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,p){for(p=p||this.length;this.pos<p;){var x=this.readVarint(),B=x>>3,I=this.pos;this.type=7&x,a(B,u,this),this.pos===I&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=fm(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=d3(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=fm(this.buf,this.pos)+4294967296*fm(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=fm(this.buf,this.pos)+4294967296*d3(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=c3(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=c3(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,p,x=this.buf;return u=127&(p=x[this.pos++]),p<128?u:(u|=(127&(p=x[this.pos++]))<<7,p<128?u:(u|=(127&(p=x[this.pos++]))<<14,p<128?u:(u|=(127&(p=x[this.pos++]))<<21,p<128?u:(function(B,I,R){var k,z,K=R.buf;if(k=(112&(z=K[R.pos++]))>>4,z<128||(k|=(127&(z=K[R.pos++]))<<3,z<128)||(k|=(127&(z=K[R.pos++]))<<10,z<128)||(k|=(127&(z=K[R.pos++]))<<17,z<128)||(k|=(127&(z=K[R.pos++]))<<24,z<128)||(k|=(1&(z=K[R.pos++]))<<31,z<128))return AN(B,k,I);throw new Error("Expected varint not more than 10 bytes")})(u|=(15&(p=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&h3?(function(p,x,B){return h3.decode(p.subarray(x,B))})(this.buf,u,a):(function(p,x,B){for(var I="",R=x;R<B;){var k,z,K,q=p[R],ie=null,he=q>239?4:q>223?3:q>191?2:1;if(R+he>B)break;he===1?q<128&&(ie=q):he===2?(192&(k=p[R+1]))==128&&(ie=(31&q)<<6|63&k)<=127&&(ie=null):he===3?(z=p[R+2],(192&(k=p[R+1]))==128&&(192&z)==128&&((ie=(15&q)<<12|(63&k)<<6|63&z)<=2047||ie>=55296&&ie<=57343)&&(ie=null)):he===4&&(z=p[R+2],K=p[R+3],(192&(k=p[R+1]))==128&&(192&z)==128&&(192&K)==128&&((ie=(15&q)<<18|(63&k)<<12|(63&z)<<6|63&K)<=65535||ie>=1114112)&&(ie=null)),ie===null?(ie=65533,he=1):ie>65535&&(ie-=65536,I+=String.fromCharCode(ie>>>10&1023|55296),ie=56320|1023&ie),I+=String.fromCharCode(ie),R+=he}return I})(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Qn.Bytes)return a.push(this.readVarint(u));var p=kc(this);for(a=a||[];this.pos<p;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSVarint());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Qn.Bytes)return a.push(this.readBoolean());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFloat());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Qn.Bytes)return a.push(this.readDouble());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFixed32());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSFixed32());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Qn.Bytes)return a.push(this.readFixed64());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Qn.Bytes)return a.push(this.readSFixed64());var u=kc(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Qn.Fixed32)this.pos+=4;else{if(u!==Qn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Xf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Xf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Xf(this.buf,-1&a,this.pos),Xf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Xf(this.buf,-1&a,this.pos),Xf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?(function(u,p){var x,B;if(u>=0?(x=u%4294967296|0,B=u/4294967296|0):(B=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,B=B+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(I,R,k){k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,k.buf[k.pos]=127&(I>>>=7)})(x,0,p),(function(I,R){var k=(7&I)<<4;R.buf[R.pos++]|=k|((I>>>=3)?128:0),I&&(R.buf[R.pos++]=127&I|((I>>>=7)?128:0),I&&(R.buf[R.pos++]=127&I|((I>>>=7)?128:0),I&&(R.buf[R.pos++]=127&I|((I>>>=7)?128:0),I&&(R.buf[R.pos++]=127&I|((I>>>=7)?128:0),I&&(R.buf[R.pos++]=127&I)))))})(B,p)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=(function(x,B,I){for(var R,k,z=0;z<B.length;z++){if((R=B.charCodeAt(z))>55295&&R<57344){if(!k){R>56319||z+1===B.length?(x[I++]=239,x[I++]=191,x[I++]=189):k=R;continue}if(R<56320){x[I++]=239,x[I++]=191,x[I++]=189,k=R;continue}R=k-55296<<10|R-56320|65536,k=null}else k&&(x[I++]=239,x[I++]=191,x[I++]=189,k=null);R<128?x[I++]=R:(R<2048?x[I++]=R>>6|192:(R<65536?x[I++]=R>>12|224:(x[I++]=R>>18|240,x[I++]=R>>12&63|128),x[I++]=R>>6&63|128),x[I++]=63&R|128)}return I})(this.buf,a,this.pos);var p=this.pos-u;p>=128&&f3(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(a){this.realloc(4),u3(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),u3(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=a[p]},writeRawMessage:function(a,u){this.pos++;var p=this.pos;a(u,this);var x=this.pos-p;x>=128&&f3(p,x,this),this.pos=p-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,p){this.writeTag(a,Qn.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,gN,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,mN,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,bN,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,_N,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,yN,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,vN,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,xN,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,wN,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,CN,u)},writeBytesField:function(a,u){this.writeTag(a,Qn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Qn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Qn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Qn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Qn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Qn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var dm=function(a,u){var p=u.pixelRatio,x=u.version,B=u.stretchX,I=u.stretchY,R=u.content;this.paddedRect=a,this.pixelRatio=p,this.stretchX=B,this.stretchY=I,this.content=R,this.version=x},yA={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yA.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yA.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yA.tlbr.get=function(){return this.tl.concat(this.br)},yA.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(dm.prototype,yA);var bA=function(a,u){var p={},x={};this.haveRenderCallbacks=[];var B=[];this.addImages(a,p,B),this.addImages(u,x,B);var I=p3(B),R=new uo({width:I.w||1,height:I.h||1});for(var k in a){var z=a[k],K=p[k].paddedRect;uo.copy(z.data,R,{x:0,y:0},{x:K.x+1,y:K.y+1},z.data)}for(var q in u){var ie=u[q],he=x[q].paddedRect,_e=he.x+1,Fe=he.y+1,ke=ie.data.width,Ve=ie.data.height;uo.copy(ie.data,R,{x:0,y:0},{x:_e,y:Fe},ie.data),uo.copy(ie.data,R,{x:0,y:Ve-1},{x:_e,y:Fe-1},{width:ke,height:1}),uo.copy(ie.data,R,{x:0,y:0},{x:_e,y:Fe+Ve},{width:ke,height:1}),uo.copy(ie.data,R,{x:ke-1,y:0},{x:_e-1,y:Fe},{width:1,height:Ve}),uo.copy(ie.data,R,{x:0,y:0},{x:_e+ke,y:Fe},{width:1,height:Ve})}this.image=R,this.iconPositions=p,this.patternPositions=x};bA.prototype.addImages=function(a,u,p){for(var x in a){var B=a[x],I={x:0,y:0,w:B.data.width+2,h:B.data.height+2};p.push(I),u[x]=new dm(I,B),B.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},bA.prototype.patchUpdatedImages=function(a,u){for(var p in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),u)},bA.prototype.patchUpdatedImage=function(a,u,p){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;p.update(u.data,void 0,{x:x[0],y:x[1]})}},or("ImagePosition",dm),or("ImageAtlas",bA);var ko={horizontal:1,vertical:2,horizontalOnly:3},Qf=function(){this.scale=1,this.fontStack="",this.imageName=null};Qf.forText=function(a,u){var p=new Qf;return p.scale=a||1,p.fontStack=u,p},Qf.forImage=function(a){var u=new Qf;return u.imageName=a,u};var Ls=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pm(a,u,p,x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke){var Ve,je=Ls.fromFeature(a,B);ie===ko.vertical&&je.verticalizePunctuation();var Ze=rs.processBidirectionalText,at=rs.processStyledBidirectionalText;if(Ze&&je.sections.length===1){Ve=[];for(var gt=0,_t=Ze(je.toString(),bb(je,K,I,u,x,_e,Fe));gt<_t.length;gt+=1){var Rt=_t[gt],Wt=new Ls;Wt.text=Rt,Wt.sections=je.sections;for(var $t=0;$t<Rt.length;$t++)Wt.sectionIndex.push(0);Ve.push(Wt)}}else if(at){Ve=[];for(var br=0,nr=at(je.text,je.sectionIndex,bb(je,K,I,u,x,_e,Fe));br<nr.length;br+=1){var Br=nr[br],ir=new Ls;ir.text=Br[0],ir.sectionIndex=Br[1],ir.sections=je.sections,Ve.push(ir)}}else Ve=(function(fr,fn){for(var Zr=[],vn=fr.text,Tr=0,Cn=0,ii=fn;Cn<ii.length;Cn+=1){var Si=ii[Cn];Zr.push(fr.substring(Tr,Si)),Tr=Si}return Tr<vn.length&&Zr.push(fr.substring(Tr,vn.length)),Zr})(je,bb(je,K,I,u,x,_e,Fe));var sn=[],Dr={positionedLines:sn,text:je.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:ie,iconsInText:!1,verticalizable:!1};return(function(fr,fn,Zr,vn,Tr,Cn,ii,Si,xi,si,Ii,Zi){for(var $i=0,Rs=-17,as=0,Os=0,Li=Si==="right"?1:Si==="left"?0:.5,ls=0,gn=0,Un=Tr;gn<Un.length;gn+=1){var Mn=Un[gn];Mn.trim();var wn=Mn.getMaxScale(),Zs=24*(wn-1),bs={positionedGlyphs:[],lineOffset:0};fr.positionedLines[ls]=bs;var ei=bs.positionedGlyphs,Ni=0;if(Mn.length()){for(var vs=0;vs<Mn.length();vs++){var En=Mn.getSection(vs),Jl=Mn.getSectionIndex(vs),No=Mn.getCharCode(vs),Kl=0,Ri=null,Xl=null,La=null,nd=24,kh=!(xi===ko.horizontal||!Ii&&!xu(No)||Ii&&(Am[No]||(zc=No,qt.Arabic(zc)||qt["Arabic Supplement"](zc)||qt["Arabic Extended-A"](zc)||qt["Arabic Presentation Forms-A"](zc)||qt["Arabic Presentation Forms-B"](zc))));if(En.imageName){var id=vn[En.imageName];if(!id)continue;La=En.imageName,fr.iconsInText=fr.iconsInText||!0,Xl=id.paddedRect;var Gc=id.displaySize;En.scale=24*En.scale/Zi,Kl=Zs+(24-Gc[1]*En.scale),nd=(Ri={width:Gc[0],height:Gc[1],left:1,top:-3,advance:kh?Gc[1]:Gc[0]}).advance;var sd=kh?Gc[0]*En.scale-24*wn:Gc[1]*En.scale-24*wn;sd>0&&sd>Ni&&(Ni=sd)}else{var Cm=Zr[En.fontStack],od=Cm&&Cm[No];if(od&&od.rect)Xl=od.rect,Ri=od.metrics;else{var wA=fn[En.fontStack],Em=wA&&wA[No];if(!Em)continue;Ri=Em.metrics}Kl=24*(wn-En.scale)}kh?(fr.verticalizable=!0,ei.push({glyph:No,imageName:La,x:$i,y:Rs+Kl,vertical:kh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Jl,metrics:Ri,rect:Xl}),$i+=nd*En.scale+si):(ei.push({glyph:No,imageName:La,x:$i,y:Rs+Kl,vertical:kh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Jl,metrics:Ri,rect:Xl}),$i+=Ri.advance*En.scale+si)}ei.length!==0&&(as=Math.max($i-si,as),IN(ei,0,ei.length-1,Li,Ni)),$i=0;var Bm=Cn*wn+Ni;bs.lineOffset=Math.max(Ni,Zs),Rs+=Bm,Os=Math.max(Bm,Os),++ls}else Rs+=Cn,++ls}var zc,CA=Rs- -17,ad=vb(ii),Lu=ad.horizontalAlign,ld=ad.verticalAlign;(function(Tm,Sm,EA,BA,Im,TA,SA,IA,Mm){var cd,Pm=(Sm-EA)*Im;cd=TA!==SA?-IA*BA- -17:(-BA*Mm+.5)*SA;for(var ud=0,MA=Tm;ud<MA.length;ud+=1)for(var Nh=0,PA=MA[ud].positionedGlyphs;Nh<PA.length;Nh+=1){var hd=PA[Nh];hd.x+=Pm,hd.y+=cd}})(fr.positionedLines,Li,Lu,ld,as,Os,Cn,CA,Tr.length),fr.top+=-ld*CA,fr.bottom=fr.top+CA,fr.left+=-Lu*as,fr.right=fr.left+as})(Dr,u,p,x,Ve,R,k,z,ie,K,he,ke),!(function(fr){for(var fn=0,Zr=fr;fn<Zr.length;fn+=1)if(Zr[fn].positionedGlyphs.length!==0)return!1;return!0})(sn)&&Dr}Ls.fromFeature=function(a,u){for(var p=new Ls,x=0;x<a.sections.length;x++){var B=a.sections[x];B.image?p.addImageSection(B):p.addTextSection(B,u)}return p},Ls.prototype.length=function(){return this.text.length},Ls.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Ls.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Ls.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Ls.prototype.verticalizePunctuation=function(){this.text=(function(a){for(var u="",p=0;p<a.length;p++){var x=a.charCodeAt(p+1)||null,B=a.charCodeAt(p-1)||null;u+=x&&Eh(x)&&!_A[a[p+1]]||B&&Eh(B)&&!_A[a[p-1]]||!_A[a[p]]?a[p]:_A[a[p]]}return u})(this.text)},Ls.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&Am[this.text.charCodeAt(u)];u++)a++;for(var p=this.text.length,x=this.text.length-1;x>=0&&x>=a&&Am[this.text.charCodeAt(x)];x--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)},Ls.prototype.substring=function(a,u){var p=new Ls;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p},Ls.prototype.toString=function(){return this.text},Ls.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,p){return Math.max(u,a.sections[p].scale)},0)},Ls.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(Qf.forText(a.scale,a.fontStack||u));for(var p=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(p)},Ls.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Qf.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ue("Reached maximum number of images 6401")}else ue("Can't add FormattedSection with an empty image.")},Ls.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Am={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},So={};function A3(a,u,p,x,B,I){if(u.imageName){var R=x[u.imageName];return R?R.displaySize[0]*u.scale*24/I+B:0}var k=p[u.fontStack],z=k&&k[a];return z?z.metrics.advance*u.scale+B:0}function g3(a,u,p,x){var B=Math.pow(a-u,2);return x?a<u?B/2:2*B:B+Math.abs(p)*p}function SN(a,u,p){var x=0;return a===10&&(x-=1e4),p&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function m3(a,u,p,x,B,I){for(var R=null,k=g3(u,p,B,I),z=0,K=x;z<K.length;z+=1){var q=K[z],ie=g3(u-q.x,p,B,I)+q.badness;ie<=k&&(R=q,k=ie)}return{index:a,x:u,priorBreak:R,badness:k}}function bb(a,u,p,x,B,I,R){if(I!=="point")return[];if(!a)return[];for(var k,z=[],K=(function(Ve,je,Ze,at,gt,_t){for(var Rt=0,Wt=0;Wt<Ve.length();Wt++){var $t=Ve.getSection(Wt);Rt+=A3(Ve.getCharCode(Wt),$t,at,gt,je,_t)}return Rt/Math.max(1,Math.ceil(Rt/Ze))})(a,u,p,x,B,R),q=a.text.indexOf("")>=0,ie=0,he=0;he<a.length();he++){var _e=a.getSection(he),Fe=a.getCharCode(he);if(Am[Fe]||(ie+=A3(Fe,_e,x,B,u,R)),he<a.length()-1){var ke=!((k=Fe)<11904||!(qt["Bopomofo Extended"](k)||qt.Bopomofo(k)||qt["CJK Compatibility Forms"](k)||qt["CJK Compatibility Ideographs"](k)||qt["CJK Compatibility"](k)||qt["CJK Radicals Supplement"](k)||qt["CJK Strokes"](k)||qt["CJK Symbols and Punctuation"](k)||qt["CJK Unified Ideographs Extension A"](k)||qt["CJK Unified Ideographs"](k)||qt["Enclosed CJK Letters and Months"](k)||qt["Halfwidth and Fullwidth Forms"](k)||qt.Hiragana(k)||qt["Ideographic Description Characters"](k)||qt["Kangxi Radicals"](k)||qt["Katakana Phonetic Extensions"](k)||qt.Katakana(k)||qt["Vertical Forms"](k)||qt["Yi Radicals"](k)||qt["Yi Syllables"](k)));(So[Fe]||ke||_e.imageName)&&z.push(m3(he+1,ie,K,z,SN(Fe,a.getCharCode(he+1),ke&&q),!1))}}return(function Ve(je){return je?Ve(je.priorBreak).concat(je.index):[]})(m3(a.length(),ie,K,z,0,!0))}function vb(a){var u=.5,p=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:u,verticalAlign:p}}function IN(a,u,p,x,B){if(x||B)for(var I=a[p],R=(a[p].x+I.metrics.advance*I.scale)*x,k=u;k<=p;k++)a[k].x-=R,a[k].y+=B}function _3(a,u,p,x,B,I){var R,k=a.image;if(k.content){var z=k.content,K=k.pixelRatio||1;R=[z[0]/K,z[1]/K,k.displaySize[0]-z[2]/K,k.displaySize[1]-z[3]/K]}var q,ie,he,_e,Fe=u.left*I,ke=u.right*I;p==="width"||p==="both"?(_e=B[0]+Fe-x[3],ie=B[0]+ke+x[1]):ie=(_e=B[0]+(Fe+ke-k.displaySize[0])/2)+k.displaySize[0];var Ve=u.top*I,je=u.bottom*I;return p==="height"||p==="both"?(q=B[1]+Ve-x[0],he=B[1]+je+x[2]):he=(q=B[1]+(Ve+je-k.displaySize[1])/2)+k.displaySize[1],{image:k,top:q,right:ie,bottom:he,left:_e,collisionPadding:R}}So[10]=!0,So[32]=!0,So[38]=!0,So[40]=!0,So[41]=!0,So[43]=!0,So[45]=!0,So[47]=!0,So[173]=!0,So[183]=!0,So[8203]=!0,So[8208]=!0,So[8211]=!0,So[8231]=!0;var Zf=(function(a){function u(p,x,B,I){a.call(this,p,x),this.angle=B,I!==void 0&&(this.segment=I)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u})(b);function xb(a,u){var p=u.expression;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Hr(a+1))};if(p.kind==="source")return{kind:"source"};for(var x=p.zoomStops,B=p.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var R=I=Math.max(0,I-1);R<x.length&&x[R]<a+1;)R++;R=Math.min(x.length-1,R);var k=x[I],z=x[R];return p.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:z,interpolationType:B}:{kind:"camera",minZoom:k,maxZoom:z,minSize:p.evaluate(new Hr(k)),maxSize:p.evaluate(new Hr(z)),interpolationType:B}}function y3(a,u,p){var x=u.uSize,B=p.lowerSize;return a.kind==="source"?B/128:a.kind==="composite"?fi(B/128,p.upperSize/128,u.uSizeT):x}function b3(a,u){var p=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var B=a.interpolationType,I=B?V(Gi.interpolationFactor(B,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=fi(a.minSize,a.maxSize,I):p=I}return{uSizeT:p,uSize:x}}or("Anchor",Zf);var MN=Object.freeze({__proto__:null,getSizeData:xb,evaluateSizeForFeature:y3,evaluateSizeForZoom:b3,SIZE_PACK_FACTOR:128});function v3(a,u,p,x,B){if(u.segment===void 0)return!0;for(var I=u,R=u.segment+1,k=0;k>-p/2;){if(--R<0)return!1;k-=a[R].dist(I),I=a[R]}k+=a[R].dist(a[R+1]),R++;for(var z=[],K=0;k<p/2;){var q=a[R],ie=a[R+1];if(!ie)return!1;var he=a[R-1].angleTo(q)-q.angleTo(ie);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:k,angleDelta:he}),K+=he;k-z[0].distance>x;)K-=z.shift().angleDelta;if(K>B)return!1;R++,k+=q.dist(ie)}return!0}function x3(a){for(var u=0,p=0;p<a.length-1;p++)u+=a[p].dist(a[p+1]);return u}function w3(a,u,p){return a?.6*u*p:0}function C3(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function PN(a,u,p,x,B,I){for(var R=w3(p,B,I),k=C3(p,x)*I,z=0,K=x3(a)/2,q=0;q<a.length-1;q++){var ie=a[q],he=a[q+1],_e=ie.dist(he);if(z+_e>K){var Fe=(K-z)/_e,ke=fi(ie.x,he.x,Fe),Ve=fi(ie.y,he.y,Fe),je=new Zf(ke,Ve,he.angleTo(ie),q);return je._round(),!R||v3(a,je,k,R,u)?je:void 0}z+=_e}}function LN(a,u,p,x,B,I,R,k,z){var K=w3(x,I,R),q=C3(x,B),ie=q*R,he=a[0].x===0||a[0].x===z||a[0].y===0||a[0].y===z;return u-ie<u/4&&(u=ie+u/4),(function _e(Fe,ke,Ve,je,Ze,at,gt,_t,Rt){for(var Wt=at/2,$t=x3(Fe),br=0,nr=ke-Ve,Br=[],ir=0;ir<Fe.length-1;ir++){for(var sn=Fe[ir],Dr=Fe[ir+1],fr=sn.dist(Dr),fn=Dr.angleTo(sn);nr+Ve<br+fr;){var Zr=((nr+=Ve)-br)/fr,vn=fi(sn.x,Dr.x,Zr),Tr=fi(sn.y,Dr.y,Zr);if(vn>=0&&vn<Rt&&Tr>=0&&Tr<Rt&&nr-Wt>=0&&nr+Wt<=$t){var Cn=new Zf(vn,Tr,fn,ir);Cn._round(),je&&!v3(Fe,Cn,at,je,Ze)||Br.push(Cn)}}br+=fr}return _t||Br.length||gt||(Br=_e(Fe,br/2,Ve,je,Ze,at,gt,!0,Rt)),Br})(a,he?u/2*k%u:(q/2+2*I)*R*k%u,u,K,p,ie,he,!1,z)}function E3(a,u,p,x,B){for(var I=[],R=0;R<a.length;R++)for(var k=a[R],z=void 0,K=0;K<k.length-1;K++){var q=k[K],ie=k[K+1];q.x<u&&ie.x<u||(q.x<u?q=new b(u,q.y+(u-q.x)/(ie.x-q.x)*(ie.y-q.y))._round():ie.x<u&&(ie=new b(u,q.y+(u-q.x)/(ie.x-q.x)*(ie.y-q.y))._round()),q.y<p&&ie.y<p||(q.y<p?q=new b(q.x+(p-q.y)/(ie.y-q.y)*(ie.x-q.x),p)._round():ie.y<p&&(ie=new b(q.x+(p-q.y)/(ie.y-q.y)*(ie.x-q.x),p)._round()),q.x>=x&&ie.x>=x||(q.x>=x?q=new b(x,q.y+(x-q.x)/(ie.x-q.x)*(ie.y-q.y))._round():ie.x>=x&&(ie=new b(x,q.y+(x-q.x)/(ie.x-q.x)*(ie.y-q.y))._round()),q.y>=B&&ie.y>=B||(q.y>=B?q=new b(q.x+(B-q.y)/(ie.y-q.y)*(ie.x-q.x),B)._round():ie.y>=B&&(ie=new b(q.x+(B-q.y)/(ie.y-q.y)*(ie.x-q.x),B)._round()),z&&q.equals(z[z.length-1])||I.push(z=[q]),z.push(ie)))))}return I}function B3(a,u,p,x){var B=[],I=a.image,R=I.pixelRatio,k=I.paddedRect.w-2,z=I.paddedRect.h-2,K=a.right-a.left,q=a.bottom-a.top,ie=I.stretchX||[[0,k]],he=I.stretchY||[[0,z]],_e=function(vn,Tr){return vn+Tr[1]-Tr[0]},Fe=ie.reduce(_e,0),ke=he.reduce(_e,0),Ve=k-Fe,je=z-ke,Ze=0,at=Fe,gt=0,_t=ke,Rt=0,Wt=Ve,$t=0,br=je;if(I.content&&x){var nr=I.content;Ze=gm(ie,0,nr[0]),gt=gm(he,0,nr[1]),at=gm(ie,nr[0],nr[2]),_t=gm(he,nr[1],nr[3]),Rt=nr[0]-Ze,$t=nr[1]-gt,Wt=nr[2]-nr[0]-at,br=nr[3]-nr[1]-_t}var Br=function(vn,Tr,Cn,ii){var Si=mm(vn.stretch-Ze,at,K,a.left),xi=_m(vn.fixed-Rt,Wt,vn.stretch,Fe),si=mm(Tr.stretch-gt,_t,q,a.top),Ii=_m(Tr.fixed-$t,br,Tr.stretch,ke),Zi=mm(Cn.stretch-Ze,at,K,a.left),$i=_m(Cn.fixed-Rt,Wt,Cn.stretch,Fe),Rs=mm(ii.stretch-gt,_t,q,a.top),as=_m(ii.fixed-$t,br,ii.stretch,ke),Os=new b(Si,si),Li=new b(Zi,si),ls=new b(Zi,Rs),gn=new b(Si,Rs),Un=new b(xi/R,Ii/R),Mn=new b($i/R,as/R),wn=u*Math.PI/180;if(wn){var Zs=Math.sin(wn),bs=Math.cos(wn),ei=[bs,-Zs,Zs,bs];Os._matMult(ei),Li._matMult(ei),gn._matMult(ei),ls._matMult(ei)}var Ni=vn.stretch+vn.fixed,vs=Tr.stretch+Tr.fixed;return{tl:Os,tr:Li,bl:gn,br:ls,tex:{x:I.paddedRect.x+1+Ni,y:I.paddedRect.y+1+vs,w:Cn.stretch+Cn.fixed-Ni,h:ii.stretch+ii.fixed-vs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Un,pixelOffsetBR:Mn,minFontScaleX:Wt/R/K,minFontScaleY:br/R/q,isSDF:p}};if(x&&(I.stretchX||I.stretchY))for(var ir=T3(ie,Ve,Fe),sn=T3(he,je,ke),Dr=0;Dr<ir.length-1;Dr++)for(var fr=ir[Dr],fn=ir[Dr+1],Zr=0;Zr<sn.length-1;Zr++)B.push(Br(fr,sn[Zr],fn,sn[Zr+1]));else B.push(Br({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:z+1}));return B}function gm(a,u,p){for(var x=0,B=0,I=a;B<I.length;B+=1){var R=I[B];x+=Math.max(u,Math.min(p,R[1]))-Math.max(u,Math.min(p,R[0]))}return x}function T3(a,u,p){for(var x=[{fixed:-1,stretch:0}],B=0,I=a;B<I.length;B+=1){var R=I[B],k=R[0],z=R[1],K=x[x.length-1];x.push({fixed:k-K.stretch,stretch:K.stretch}),x.push({fixed:k-K.stretch,stretch:K.stretch+(z-k)})}return x.push({fixed:u+1,stretch:p}),x}function mm(a,u,p,x){return a/u*p+x}function _m(a,u,p,x){return a-u*p/x}var ym=function(a,u,p,x,B,I,R,k,z,K){if(this.boxStartIndex=a.length,z){var q=I.top,ie=I.bottom,he=I.collisionPadding;he&&(q-=he[1],ie+=he[3]);var _e=ie-q;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Fe=I.top*R-k,ke=I.bottom*R+k,Ve=I.left*R-k,je=I.right*R+k,Ze=I.collisionPadding;if(Ze&&(Ve-=Ze[0]*R,Fe-=Ze[1]*R,je+=Ze[2]*R,ke+=Ze[3]*R),K){var at=new b(Ve,Fe),gt=new b(je,Fe),_t=new b(Ve,ke),Rt=new b(je,ke),Wt=K*Math.PI/180;at._rotate(Wt),gt._rotate(Wt),_t._rotate(Wt),Rt._rotate(Wt),Ve=Math.min(at.x,gt.x,_t.x,Rt.x),je=Math.max(at.x,gt.x,_t.x,Rt.x),Fe=Math.min(at.y,gt.y,_t.y,Rt.y),ke=Math.max(at.y,gt.y,_t.y,Rt.y)}a.emplaceBack(u.x,u.y,Ve,Fe,je,ke,p,x,B)}this.boxEndIndex=a.length},$f=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=RN),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function RN(a,u){return a<u?-1:a>u?1:0}function ON(a,u,p){p===void 0&&(p=!1);for(var x=1/0,B=1/0,I=-1/0,R=-1/0,k=a[0],z=0;z<k.length;z++){var K=k[z];(!z||K.x<x)&&(x=K.x),(!z||K.y<B)&&(B=K.y),(!z||K.x>I)&&(I=K.x),(!z||K.y>R)&&(R=K.y)}var q=Math.min(I-x,R-B),ie=q/2,he=new $f([],DN);if(q===0)return new b(x,B);for(var _e=x;_e<I;_e+=q)for(var Fe=B;Fe<R;Fe+=q)he.push(new qf(_e+ie,Fe+ie,ie,a));for(var ke=(function(Ze){for(var at=0,gt=0,_t=0,Rt=Ze[0],Wt=0,$t=Rt.length,br=$t-1;Wt<$t;br=Wt++){var nr=Rt[Wt],Br=Rt[br],ir=nr.x*Br.y-Br.x*nr.y;gt+=(nr.x+Br.x)*ir,_t+=(nr.y+Br.y)*ir,at+=3*ir}return new qf(gt/at,_t/at,0,Ze)})(a),Ve=he.length;he.length;){var je=he.pop();(je.d>ke.d||!ke.d)&&(ke=je,p&&console.log("found best %d after %d probes",Math.round(1e4*je.d)/1e4,Ve)),je.max-ke.d<=u||(he.push(new qf(je.p.x-(ie=je.h/2),je.p.y-ie,ie,a)),he.push(new qf(je.p.x+ie,je.p.y-ie,ie,a)),he.push(new qf(je.p.x-ie,je.p.y+ie,ie,a)),he.push(new qf(je.p.x+ie,je.p.y+ie,ie,a)),Ve+=4)}return p&&(console.log("num probes: "+Ve),console.log("best distance: "+ke.d)),ke.p}function DN(a,u){return u.max-a.max}function qf(a,u,p,x){this.p=new b(a,u),this.h=p,this.d=(function(B,I){for(var R=!1,k=1/0,z=0;z<I.length;z++)for(var K=I[z],q=0,ie=K.length,he=ie-1;q<ie;he=q++){var _e=K[q],Fe=K[he];_e.y>B.y!=Fe.y>B.y&&B.x<(Fe.x-_e.x)*(B.y-_e.y)/(Fe.y-_e.y)+_e.x&&(R=!R),k=Math.min(k,Su(B,_e,Fe))}return(R?1:-1)*Math.sqrt(k)})(this.p,x),this.max=this.d+this.h*Math.SQRT2}$f.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},$f.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},$f.prototype.peek=function(){return this.data[0]},$f.prototype._up=function(a){for(var u=this.data,p=this.compare,x=u[a];a>0;){var B=a-1>>1,I=u[B];if(p(x,I)>=0)break;u[a]=I,a=B}u[a]=x},$f.prototype._down=function(a){for(var u=this.data,p=this.compare,x=this.length>>1,B=u[a];a<x;){var I=1+(a<<1),R=u[I],k=I+1;if(k<this.length&&p(u[k],R)<0&&(I=k,R=u[k]),p(R,B)>=0)break;u[a]=R,a=I}u[a]=B};var wb=Number.POSITIVE_INFINITY;function S3(a,u){return u[1]!==wb?(function(p,x,B){var I=0,R=0;switch(x=Math.abs(x),B=Math.abs(B),p){case"top-right":case"top-left":case"top":R=B-7;break;case"bottom-right":case"bottom-left":case"bottom":R=7-B}switch(p){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,R]})(a,u[0],u[1]):(function(p,x){var B=0,I=0;x<0&&(x=0);var R=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":I=R-7;break;case"bottom-right":case"bottom-left":I=7-R;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(p){case"top-right":case"bottom-right":B=-R;break;case"top-left":case"bottom-left":B=R;break;case"left":B=x;break;case"right":B=-x}return[B,I]})(a,u[0])}function Cb(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I3(a,u,p,x,B,I,R,k,z,K,q,ie,he,_e,Fe){var ke=(function(gt,_t,Rt,Wt,$t,br,nr,Br){for(var ir=Wt.layout.get("text-rotate").evaluate(br,{})*Math.PI/180,sn=[],Dr=0,fr=_t.positionedLines;Dr<fr.length;Dr+=1)for(var fn=fr[Dr],Zr=0,vn=fn.positionedGlyphs;Zr<vn.length;Zr+=1){var Tr=vn[Zr];if(Tr.rect){var Cn=Tr.rect||{},ii=4,Si=!0,xi=1,si=0,Ii=($t||Br)&&Tr.vertical,Zi=Tr.metrics.advance*Tr.scale/2;if(Br&&_t.verticalizable&&(si=fn.lineOffset/2-(Tr.imageName?-(24-Tr.metrics.width*Tr.scale)/2:24*(Tr.scale-1))),Tr.imageName){var $i=nr[Tr.imageName];Si=$i.sdf,ii=1/(xi=$i.pixelRatio)}var Rs=$t?[Tr.x+Zi,Tr.y]:[0,0],as=$t?[0,0]:[Tr.x+Zi+Rt[0],Tr.y+Rt[1]-si],Os=[0,0];Ii&&(Os=as,as=[0,0]);var Li=(Tr.metrics.left-ii)*Tr.scale-Zi+as[0],ls=(-Tr.metrics.top-ii)*Tr.scale+as[1],gn=Li+Cn.w*Tr.scale/xi,Un=ls+Cn.h*Tr.scale/xi,Mn=new b(Li,ls),wn=new b(gn,ls),Zs=new b(Li,Un),bs=new b(gn,Un);if(Ii){var ei=new b(-Zi,Zi- -17),Ni=-Math.PI/2,vs=12-Zi,En=new b(22-vs,-(Tr.imageName?vs:0)),Jl=new(Function.prototype.bind.apply(b,[null].concat(Os)));Mn._rotateAround(Ni,ei)._add(En)._add(Jl),wn._rotateAround(Ni,ei)._add(En)._add(Jl),Zs._rotateAround(Ni,ei)._add(En)._add(Jl),bs._rotateAround(Ni,ei)._add(En)._add(Jl)}if(ir){var No=Math.sin(ir),Kl=Math.cos(ir),Ri=[Kl,-No,No,Kl];Mn._matMult(Ri),wn._matMult(Ri),Zs._matMult(Ri),bs._matMult(Ri)}var Xl=new b(0,0),La=new b(0,0);sn.push({tl:Mn,tr:wn,bl:Zs,br:bs,tex:Cn,writingMode:_t.writingMode,glyphOffset:Rs,sectionIndex:Tr.sectionIndex,isSDF:Si,pixelOffsetTL:Xl,pixelOffsetBR:La,minFontScaleX:0,minFontScaleY:0})}}return sn})(0,p,k,B,I,R,x,a.allowVerticalPlacement),Ve=a.textSizeData,je=null;Ve.kind==="source"?(je=[128*B.layout.get("text-size").evaluate(R,{})])[0]>32640&&ue(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ve.kind==="composite"&&((je=[128*_e.compositeTextSizes[0].evaluate(R,{},Fe),128*_e.compositeTextSizes[1].evaluate(R,{},Fe)])[0]>32640||je[1]>32640)&&ue(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,ke,je,k,I,R,K,u,z.lineStartIndex,z.lineLength,he,Fe);for(var Ze=0,at=q;Ze<at.length;Ze+=1)ie[at[Ze]]=a.text.placedSymbolArray.length-1;return 4*ke.length}function M3(a){for(var u in a)return a[u];return null}function FN(a,u,p,x){var B=a.compareText;if(u in B){for(var I=B[u],R=I.length-1;R>=0;R--)if(x.dist(I[R])<p)return!0}else B[u]=[];return B[u].push(x),!1}var kN=Kf.VectorTileFeature.types,NN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bm(a,u,p,x,B,I,R,k,z,K,q,ie,he){var _e=k?Math.min(32640,Math.round(k[0])):0,Fe=k?Math.min(32640,Math.round(k[1])):0;a.emplaceBack(u,p,Math.round(32*x),Math.round(32*B),I,R,(_e<<1)+(z?1:0),Fe,16*K,16*q,256*ie,256*he)}function Eb(a,u,p){a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p)}function UN(a){for(var u=0,p=a.sections;u<p.length;u+=1)if(wu(p[u].text))return!0;return!1}var Yf=function(a){this.layoutVertexArray=new Kt,this.indexArray=new sa,this.programConfigurations=a,this.segments=new $,this.dynamicLayoutVertexArray=new tr,this.opacityVertexArray=new jl,this.placedSymbolArray=new m};Yf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Yf.prototype.upload=function(a,u,p,x){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,uN.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,hN.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,NN,!0),this.opacityVertexBuffer.itemSize=1),(p||x)&&this.programConfigurations.upload(a))},Yf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},or("SymbolBuffers",Yf);var vA=function(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new $,this.collisionVertexArray=new ia};vA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,fN.members,!0)},vA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},or("CollisionBuffers",vA);var On=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=To([]),this.placementViewportMatrix=To([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xb(this.zoom,u["text-size"]),this.iconSizeData=xb(this.zoom,u["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),B=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=B!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(B==="viewport-y"||B==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(I){return ko[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};On.prototype.createArrays=function(){this.text=new Yf(new Or(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Yf(new Or(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new L,this.lineVertexArray=new F,this.symbolInstances=new P},On.prototype.calculateGlyphDependencies=function(a,u,p,x,B){for(var I=0;I<a.length;I++)if(u[a.charCodeAt(I)]=!0,(p||x)&&B){var R=_A[a.charAt(I)];R&&(u[R.charCodeAt(0)]=!0)}},On.prototype.populate=function(a,u,p){var x=this.layers[0],B=x.layout,I=B.get("text-font"),R=B.get("text-field"),k=B.get("icon-image"),z=(R.value.kind!=="constant"||R.value.value instanceof ui&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),K=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,q=B.get("symbol-sort-key");if(this.features=[],z||K){for(var ie=u.iconDependencies,he=u.glyphDependencies,_e=u.availableImages,Fe=new Hr(this.zoom),ke=0,Ve=a;ke<Ve.length;ke+=1){var je=Ve[ke],Ze=je.feature,at=je.id,gt=je.index,_t=je.sourceLayerIndex,Rt=x._featureFilter.needGeometry,Wt=Pi(Ze,Rt);if(x._featureFilter.filter(Fe,Wt,p)){Rt||(Wt.geometry=vi(Ze));var $t=void 0;if(z){var br=x.getValueAndResolveTokens("text-field",Wt,p,_e),nr=ui.factory(br);UN(nr)&&(this.hasRTLText=!0),(!this.hasRTLText||Th()==="unavailable"||this.hasRTLText&&rs.isParsed())&&($t=pN(nr,x,Wt))}var Br=void 0;if(K){var ir=x.getValueAndResolveTokens("icon-image",Wt,p,_e);Br=ir instanceof Wn?ir:Wn.fromString(ir)}if($t||Br){var sn=this.sortFeaturesByKey?q.evaluate(Wt,{},p):void 0;if(this.features.push({id:at,text:$t,icon:Br,index:gt,sourceLayerIndex:_t,geometry:Wt.geometry,properties:Ze.properties,type:kN[Ze.type],sortKey:sn}),Br&&(ie[Br.name]=!0),$t){var Dr=I.evaluate(Wt,{},p).join(","),fr=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ko.vertical)>=0;for(var fn=0,Zr=$t.sections;fn<Zr.length;fn+=1){var vn=Zr[fn];if(vn.image)ie[vn.image.name]=!0;else{var Tr=Ch($t.toString()),Cn=vn.fontStack||Dr,ii=he[Cn]=he[Cn]||{};this.calculateGlyphDependencies(vn.text,ii,fr,this.allowVerticalPlacement,Tr)}}}}}}B.get("symbol-placement")==="line"&&(this.features=(function(Si){var xi={},si={},Ii=[],Zi=0;function $i(ei){Ii.push(Si[ei]),Zi++}function Rs(ei,Ni,vs){var En=si[ei];return delete si[ei],si[Ni]=En,Ii[En].geometry[0].pop(),Ii[En].geometry[0]=Ii[En].geometry[0].concat(vs[0]),En}function as(ei,Ni,vs){var En=xi[Ni];return delete xi[Ni],xi[ei]=En,Ii[En].geometry[0].shift(),Ii[En].geometry[0]=vs[0].concat(Ii[En].geometry[0]),En}function Os(ei,Ni,vs){var En=vs?Ni[0][Ni[0].length-1]:Ni[0][0];return ei+":"+En.x+":"+En.y}for(var Li=0;Li<Si.length;Li++){var ls=Si[Li],gn=ls.geometry,Un=ls.text?ls.text.toString():null;if(Un){var Mn=Os(Un,gn),wn=Os(Un,gn,!0);if(Mn in si&&wn in xi&&si[Mn]!==xi[wn]){var Zs=as(Mn,wn,gn),bs=Rs(Mn,wn,Ii[Zs].geometry);delete xi[Mn],delete si[wn],si[Os(Un,Ii[bs].geometry,!0)]=bs,Ii[Zs].geometry=null}else Mn in si?Rs(Mn,wn,gn):wn in xi?as(Mn,wn,gn):($i(Li),xi[Mn]=Zi-1,si[wn]=Zi-1)}else $i(Li)}return Ii.filter(function(ei){return ei.geometry})})(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Si,xi){return Si.sortKey-xi.sortKey})}},On.prototype.update=function(a,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,p))},On.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},On.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},On.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},On.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},On.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},On.prototype.addToLineVertexArray=function(a,u){var p=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),B=a.dist(u[a.segment]),I={},R=a.segment+1;R<u.length;R++)I[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:x},R<u.length-1&&(x+=u[R+1].dist(u[R]));for(var k=a.segment||0;k>=0;k--)I[k]={x:u[k].x,y:u[k].y,tileUnitDistanceFromAnchor:B},k>0&&(B+=u[k-1].dist(u[k]));for(var z=0;z<u.length;z++){var K=I[z];this.lineVertexArray.emplaceBack(K.x,K.y,K.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}},On.prototype.addSymbols=function(a,u,p,x,B,I,R,k,z,K,q,ie){for(var he=a.indexArray,_e=a.layoutVertexArray,Fe=a.segments.prepareSegment(4*u.length,_e,he,this.canOverlap?I.sortKey:void 0),ke=this.glyphOffsetArray.length,Ve=Fe.vertexLength,je=this.allowVerticalPlacement&&R===ko.vertical?Math.PI/2:0,Ze=I.text&&I.text.sections,at=0;at<u.length;at++){var gt=u[at],_t=gt.tl,Rt=gt.tr,Wt=gt.bl,$t=gt.br,br=gt.tex,nr=gt.pixelOffsetTL,Br=gt.pixelOffsetBR,ir=gt.minFontScaleX,sn=gt.minFontScaleY,Dr=gt.glyphOffset,fr=gt.isSDF,fn=gt.sectionIndex,Zr=Fe.vertexLength,vn=Dr[1];bm(_e,k.x,k.y,_t.x,vn+_t.y,br.x,br.y,p,fr,nr.x,nr.y,ir,sn),bm(_e,k.x,k.y,Rt.x,vn+Rt.y,br.x+br.w,br.y,p,fr,Br.x,nr.y,ir,sn),bm(_e,k.x,k.y,Wt.x,vn+Wt.y,br.x,br.y+br.h,p,fr,nr.x,Br.y,ir,sn),bm(_e,k.x,k.y,$t.x,vn+$t.y,br.x+br.w,br.y+br.h,p,fr,Br.x,Br.y,ir,sn),Eb(a.dynamicLayoutVertexArray,k,je),he.emplaceBack(Zr,Zr+1,Zr+2),he.emplaceBack(Zr+1,Zr+2,Zr+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dr[0]),at!==u.length-1&&fn===u[at+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,I,I.index,{},ie,Ze&&Ze[fn])}a.placedSymbolArray.emplaceBack(k.x,k.y,ke,this.glyphOffsetArray.length-ke,Ve,z,K,k.segment,p?p[0]:0,p?p[1]:0,x[0],x[1],R,0,!1,0,q)},On.prototype._addCollisionDebugVertex=function(a,u,p,x,B,I){return u.emplaceBack(0,0),a.emplaceBack(p.x,p.y,x,B,Math.round(I.x),Math.round(I.y))},On.prototype.addCollisionDebugVertices=function(a,u,p,x,B,I,R){var k=B.segments.prepareSegment(4,B.layoutVertexArray,B.indexArray),z=k.vertexLength,K=B.layoutVertexArray,q=B.collisionVertexArray,ie=R.anchorX,he=R.anchorY;this._addCollisionDebugVertex(K,q,I,ie,he,new b(a,u)),this._addCollisionDebugVertex(K,q,I,ie,he,new b(p,u)),this._addCollisionDebugVertex(K,q,I,ie,he,new b(p,x)),this._addCollisionDebugVertex(K,q,I,ie,he,new b(a,x)),k.vertexLength+=4;var _e=B.indexArray;_e.emplaceBack(z,z+1),_e.emplaceBack(z+1,z+2),_e.emplaceBack(z+2,z+3),_e.emplaceBack(z+3,z),k.primitiveLength+=4},On.prototype.addDebugCollisionBoxes=function(a,u,p,x){for(var B=a;B<u;B++){var I=this.collisionBoxArray.get(B);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}},On.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vA(na,l3.members,T),this.iconCollisionBox=new vA(na,l3.members,T);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},On.prototype._deserializeCollisionBoxesForSymbol=function(a,u,p,x,B,I,R,k,z){for(var K={},q=u;q<p;q++){var ie=a.get(q);K.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},K.textFeatureIndex=ie.featureIndex;break}for(var he=x;he<B;he++){var _e=a.get(he);K.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},K.verticalTextFeatureIndex=_e.featureIndex;break}for(var Fe=I;Fe<R;Fe++){var ke=a.get(Fe);K.iconBox={x1:ke.x1,y1:ke.y1,x2:ke.x2,y2:ke.y2,anchorPointX:ke.anchorPointX,anchorPointY:ke.anchorPointY},K.iconFeatureIndex=ke.featureIndex;break}for(var Ve=k;Ve<z;Ve++){var je=a.get(Ve);K.verticalIconBox={x1:je.x1,y1:je.y1,x2:je.x2,y2:je.y2,anchorPointX:je.anchorPointX,anchorPointY:je.anchorPointY},K.verticalIconFeatureIndex=je.featureIndex;break}return K},On.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}},On.prototype.hasTextData=function(){return this.text.segments.get().length>0},On.prototype.hasIconData=function(){return this.icon.segments.get().length>0},On.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},On.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},On.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},On.prototype.addIndicesForPlacedSymbol=function(a,u){for(var p=a.placedSymbolArray.get(u),x=p.vertexStartIndex+4*p.numGlyphs,B=p.vertexStartIndex;B<x;B+=4)a.indexArray.emplaceBack(B,B+1,B+2),a.indexArray.emplaceBack(B+1,B+2,B+3)},On.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),p=Math.cos(a),x=[],B=[],I=[],R=0;R<this.symbolInstances.length;++R){I.push(R);var k=this.symbolInstances.get(R);x.push(0|Math.round(u*k.anchorX+p*k.anchorY)),B.push(k.featureIndex)}return I.sort(function(z,K){return x[z]-x[K]||B[K]-B[z]}),I},On.prototype.addToSortKeyRanges=function(a,u){var p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},On.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var p=0,x=this.symbolInstanceIndexes;p<x.length;p+=1){var B=this.symbolInstances.get(x[p]);this.featureSortOrder.push(B.featureIndex),[B.rightJustifiedTextSymbolIndex,B.centerJustifiedTextSymbolIndex,B.leftJustifiedTextSymbolIndex].forEach(function(I,R,k){I>=0&&k.indexOf(I)===R&&u.addIndicesForPlacedSymbol(u.text,I)}),B.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,B.verticalPlacedTextSymbolIndex),B.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.placedIconSymbolIndex),B.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},or("SymbolBucket",On,{omit:["layers","collisionBoxArray","features","compareText"]}),On.MAX_GLYPHS=65535,On.addDynamicAttributes=Eb;var GN=new Xn({"symbol-placement":new xr(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new xr(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xr(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ur(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xr(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xr(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xr(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new xr(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xr(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ur(oe.layout_symbol["icon-size"]),"icon-text-fit":new xr(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xr(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ur(oe.layout_symbol["icon-image"]),"icon-rotate":new ur(oe.layout_symbol["icon-rotate"]),"icon-padding":new xr(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new xr(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new ur(oe.layout_symbol["icon-offset"]),"icon-anchor":new ur(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xr(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xr(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xr(oe.layout_symbol["text-rotation-alignment"]),"text-field":new ur(oe.layout_symbol["text-field"]),"text-font":new ur(oe.layout_symbol["text-font"]),"text-size":new ur(oe.layout_symbol["text-size"]),"text-max-width":new ur(oe.layout_symbol["text-max-width"]),"text-line-height":new xr(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new ur(oe.layout_symbol["text-letter-spacing"]),"text-justify":new ur(oe.layout_symbol["text-justify"]),"text-radial-offset":new ur(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xr(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new ur(oe.layout_symbol["text-anchor"]),"text-max-angle":new xr(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new xr(oe.layout_symbol["text-writing-mode"]),"text-rotate":new ur(oe.layout_symbol["text-rotate"]),"text-padding":new xr(oe.layout_symbol["text-padding"]),"text-keep-upright":new xr(oe.layout_symbol["text-keep-upright"]),"text-transform":new ur(oe.layout_symbol["text-transform"]),"text-offset":new ur(oe.layout_symbol["text-offset"]),"text-allow-overlap":new xr(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xr(oe.layout_symbol["text-ignore-placement"]),"text-optional":new xr(oe.layout_symbol["text-optional"])}),Bb={paint:new Xn({"icon-opacity":new ur(oe.paint_symbol["icon-opacity"]),"icon-color":new ur(oe.paint_symbol["icon-color"]),"icon-halo-color":new ur(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ur(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ur(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new xr(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new xr(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ur(oe.paint_symbol["text-opacity"]),"text-color":new ur(oe.paint_symbol["text-color"],{runtimeType:jt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new ur(oe.paint_symbol["text-halo-color"]),"text-halo-width":new ur(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new ur(oe.paint_symbol["text-halo-blur"]),"text-translate":new xr(oe.paint_symbol["text-translate"]),"text-translate-anchor":new xr(oe.paint_symbol["text-translate-anchor"])}),layout:GN},ed=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Dt,this.defaultValue=a};ed.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},ed.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},ed.prototype.outputDefined=function(){return!1},ed.prototype.serialize=function(){return null},or("FormatSectionOverride",ed,{omit:["defaultValue"]});var zN=(function(a){function u(p){a.call(this,p,Bb)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){if(a.prototype.recalculate.call(this,p,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var B=this.layout.get("text-writing-mode");if(B){for(var I=[],R=0,k=B;R<k.length;R+=1){var z=k[R];I.indexOf(z)<0&&I.push(z)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(p,x,B,I){var R=this.layout.get(p).evaluate(x,{},B,I),k=this._unevaluatedLayout._values[p];return k.isDataDriven()||wo(k.value)||!R?R:(function(z,K){return K.replace(/{([^{}]+)}/g,function(q,ie){return ie in z?String(z[ie]):""})})(x.properties,R)},u.prototype.createBucket=function(p){return new On(p)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var p=0,x=Bb.paint.overridableProperties;p<x.length;p+=1){var B=x[p];if(u.hasPaintOverride(this.layout,B)){var I,R=this.paint.get(B),k=new ed(R),z=new Sa(k,R.property.specification);I=R.value.kind==="constant"||R.value.kind==="source"?new qa("source",z):new Rl("composite",z,R.value.zoomStops,R.value._interpolationType),this.paint._values[B]=new ns(R.property,I,R.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!(!this.layout||x.isDataDriven()||B.isDataDriven())&&u.hasPaintOverride(this.layout,p)},u.hasPaintOverride=function(p,x){var B=p.get("text-field"),I=Bb.paint.properties[x],R=!1,k=function(q){for(var ie=0,he=q;ie<he.length;ie+=1)if(I.overrides&&I.overrides.hasOverride(he[ie]))return void(R=!0)};if(B.value.kind==="constant"&&B.value.value instanceof ui)k(B.value.value.sections);else if(B.value.kind==="source"){var z=function(q){R||(q instanceof Fi&&Jn(q.value)===cn?k(q.value.sections):q instanceof gs?k(q.sections):q.eachChild(z))},K=B.value;K._styleExpression&&z(K._styleExpression.expression)}return R},u})(Ur),jN={paint:new Xn({"background-color":new xr(oe.paint_background["background-color"]),"background-pattern":new us(oe.paint_background["background-pattern"]),"background-opacity":new xr(oe.paint_background["background-opacity"])})},HN=(function(a){function u(p){a.call(this,p,jN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Ur),VN={paint:new Xn({"raster-opacity":new xr(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new xr(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xr(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xr(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new xr(oe.paint_raster["raster-saturation"]),"raster-contrast":new xr(oe.paint_raster["raster-contrast"]),"raster-resampling":new xr(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new xr(oe.paint_raster["raster-fade-duration"])})},WN=(function(a){function u(p){a.call(this,p,VN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u})(Ur),JN=(function(a){function u(p){a.call(this,p,{}),this.implementation=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(p){this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},u.prototype.onRemove=function(p){this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},u})(Ur),KN={circle:ub,heatmap:I9,hillshade:P9,fill:X9,"fill-extrusion":nN,line:cN,symbol:zN,background:HN,raster:WN},P3=S.HTMLImageElement,L3=S.HTMLCanvasElement,R3=S.HTMLVideoElement,O3=S.ImageData,vm=S.ImageBitmap,Oh=function(a,u,p,x){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(u,x)};Oh.prototype.update=function(a,u,p){var x=a.width,B=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===B||p),R=this.context,k=R.gl;if(this.useMipmap=!!(u&&u.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),I)this.size=[x,B],a instanceof P3||a instanceof L3||a instanceof R3||a instanceof O3||vm&&a instanceof vm?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,x,B,0,this.format,k.UNSIGNED_BYTE,a.data);else{var z=p||{x:0,y:0},K=z.x,q=z.y;a instanceof P3||a instanceof L3||a instanceof R3||a instanceof O3||vm&&a instanceof vm?k.texSubImage2D(k.TEXTURE_2D,0,K,q,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,K,q,x,B,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)},Oh.prototype.bind=function(a,u,p){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},Oh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Oh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Tb=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Tb.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Tb.prototype.remove=function(){delete this._channel,this._callback=function(){}};var td=function(a,u,p){this.target=a,this.parent=u,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ge(["receive","process"],this),this.invoker=new Tb(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ce()?a:S};function D3(a,u,p){var x=2*Math.PI*6378137/256/Math.pow(2,p);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}td.prototype.send=function(a,u,p,x,B){var I=this;B===void 0&&(B=!1);var R=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(this.callbacks[R]=p);var k=$e(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:a,hasCallback:!!p,targetMapId:x,mustQueue:B,sourceMapId:this.mapId,data:io(u,k)},k),{cancel:function(){p&&delete I.callbacks[R],I.target.postMessage({id:R,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},td.prototype.receive=function(a){var u=a.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[p];var x=this.cancelCallbacks[p];delete this.cancelCallbacks[p],x&&x()}else Ce()||u.mustQueue?(this.tasks[p]=u,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,u)},td.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},td.prototype.processTask=function(a,u){var p=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(ms(u.error)):x(null,ms(u.data)))}else{var B=!1,I=$e(this.globalScope)?void 0:[],R=u.hasCallback?function(q,ie){B=!0,delete p.cancelCallbacks[a],p.target.postMessage({id:a,type:"<response>",sourceMapId:p.mapId,error:q?io(q):null,data:io(ie,I)},I)}:function(q){B=!0},k=null,z=ms(u.data);if(this.parent[u.type])k=this.parent[u.type](u.sourceMapId,z,R);else if(this.parent.getWorkerSource){var K=u.type.split(".");k=this.parent.getWorkerSource(u.sourceMapId,K[0],z.source)[K[1]](z,R)}else R(new Error("Could not find function "+u.type));!B&&k&&k.cancel&&(this.cancelCallbacks[a]=k.cancel)}},td.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ji=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};ji.prototype.setNorthEast=function(a){return this._ne=a instanceof ni?new ni(a.lng,a.lat):ni.convert(a),this},ji.prototype.setSouthWest=function(a){return this._sw=a instanceof ni?new ni(a.lng,a.lat):ni.convert(a),this},ji.prototype.extend=function(a){var u,p,x=this._sw,B=this._ne;if(a instanceof ni)u=a,p=a;else{if(!(a instanceof ji))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(ji.convert(a)):this.extend(ni.convert(a)):this;if(p=a._ne,!(u=a._sw)||!p)return this}return x||B?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),B.lng=Math.max(p.lng,B.lng),B.lat=Math.max(p.lat,B.lat)):(this._sw=new ni(u.lng,u.lat),this._ne=new ni(p.lng,p.lat)),this},ji.prototype.getCenter=function(){return new ni((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ji.prototype.getSouthWest=function(){return this._sw},ji.prototype.getNorthEast=function(){return this._ne},ji.prototype.getNorthWest=function(){return new ni(this.getWest(),this.getNorth())},ji.prototype.getSouthEast=function(){return new ni(this.getEast(),this.getSouth())},ji.prototype.getWest=function(){return this._sw.lng},ji.prototype.getSouth=function(){return this._sw.lat},ji.prototype.getEast=function(){return this._ne.lng},ji.prototype.getNorth=function(){return this._ne.lat},ji.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ji.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ji.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ji.prototype.contains=function(a){var u=ni.convert(a),p=u.lng,x=u.lat,B=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&B},ji.convert=function(a){return!a||a instanceof ji?a:new ji(a)};var ni=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ni.prototype.wrap=function(){return new ni(j(this.lng,-180,180),this.lat)},ni.prototype.toArray=function(){return[this.lng,this.lat]},ni.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ni.prototype.distanceTo=function(a){var u=Math.PI/180,p=this.lat*u,x=a.lat*u,B=Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(B,1))},ni.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,p=u/Math.cos(Math.PI/180*this.lat);return new ji(new ni(this.lng-p,this.lat-u),new ni(this.lng+p,this.lat+u))},ni.convert=function(a){if(a instanceof ni)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new ni(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new ni(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var F3=2*Math.PI*63710088e-1;function k3(a){return F3*Math.cos(a*Math.PI/180)}function N3(a){return(180+a)/360}function U3(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function G3(a,u){return a/k3(u)}function Sb(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Dh=function(a,u,p){p===void 0&&(p=0),this.x=+a,this.y=+u,this.z=+p};Dh.fromLngLat=function(a,u){u===void 0&&(u=0);var p=ni.convert(a);return new Dh(N3(p.lng),U3(p.lat),G3(u,p.lat))},Dh.prototype.toLngLat=function(){return new ni(360*this.x-180,Sb(this.y))},Dh.prototype.toAltitude=function(){return this.z*k3(Sb(this.y))},Dh.prototype.meterInMercatorCoordinateUnits=function(){return 1/F3*(a=Sb(this.y),1/Math.cos(a*Math.PI/180));var a};var Fh=function(a,u,p){this.z=a,this.x=u,this.y=p,this.key=xA(0,a,a,u,p)};Fh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Fh.prototype.url=function(a,u){var p,x,B,I,R,k=(x=this.y,B=this.z,I=D3(256*(p=this.x),256*(x=Math.pow(2,B)-x-1),B),R=D3(256*(p+1),256*(x+1),B),I[0]+","+I[1]+","+R[0]+","+R[1]),z=(function(K,q,ie){for(var he,_e="",Fe=K;Fe>0;Fe--)_e+=(q&(he=1<<Fe-1)?1:0)+(ie&he?2:0);return _e})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",k)},Fh.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new b(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},Fh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var z3=function(a,u){this.wrap=a,this.canonical=u,this.key=xA(a,u.z,u.z,u.x,u.y)},Hi=function(a,u,p,x,B){this.overscaledZ=a,this.wrap=u,this.canonical=new Fh(p,+x,+B),this.key=xA(u,a,p,x,B)};function xA(a,u,p,x,B){(a*=2)<0&&(a=-1*a-1);var I=1<<p;return(I*I*a+I*B+x).toString(36)+p.toString(36)+u.toString(36)}Hi.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Hi.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Hi(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Hi.prototype.calculateScaledKey=function(a,u){var p=this.canonical.z-a;return a>this.canonical.z?xA(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):xA(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)},Hi.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Hi.prototype.children=function(a){if(this.overscaledZ>=a)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,p=2*this.canonical.x,x=2*this.canonical.y;return[new Hi(u,this.wrap,u,p,x),new Hi(u,this.wrap,u,p+1,x),new Hi(u,this.wrap,u,p,x+1),new Hi(u,this.wrap,u,p+1,x+1)]},Hi.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Hi.prototype.wrapped=function(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Hi.prototype.unwrapTo=function(a){return new Hi(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Hi.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Hi.prototype.toUnwrapped=function(){return new z3(this.wrap,this.canonical)},Hi.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Hi.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Dh(a.x-this.wrap,a.y))},or("CanonicalTileID",Fh),or("OverscaledTileID",Hi,{omit:["posMatrix"]});var Nc=function(a,u,p){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return ue('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=p||"mapbox";for(var B=0;B<x;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(x,B)]=this.data[this._idx(x-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,x)]=this.data[this._idx(B,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};Nc.prototype.get=function(a,u){var p=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[x],p[x+1],p[x+2])},Nc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Nc.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},Nc.prototype._unpackMapbox=function(a,u,p){return(256*a*256+256*u+p)/10-1e4},Nc.prototype._unpackTerrarium=function(a,u,p){return 256*a+u+p/256-32768},Nc.prototype.getPixels=function(){return new uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Nc.prototype.backfillBorder=function(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,B=u*this.dim+this.dim,I=p*this.dim,R=p*this.dim+this.dim;switch(u){case-1:x=B-1;break;case 1:B=x+1}switch(p){case-1:I=R-1;break;case 1:R=I+1}for(var k=-u*this.dim,z=-p*this.dim,K=I;K<R;K++)for(var q=x;q<B;q++)this.data[this._idx(q,K)]=a.data[this._idx(q+k,K+z)]},or("DEMData",Nc);var xm=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}};xm.prototype.encode=function(a){return this._stringToNumber[a]},xm.prototype.decode=function(a){return this._numberToString[a]};var wm=function(a,u,p,x,B){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=p,a._y=x,this.properties=a.properties,this.id=B},Ib={geometry:{configurable:!0}};Ib.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ib.geometry.set=function(a){this._geometry=a},wm.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(wm.prototype,Ib);var rd=function(){this.state={},this.stateChanges={},this.deletedStates={}};rd.prototype.updateState=function(a,u,p){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},ee(this.stateChanges[a][x],p),this.deletedStates[a]===null)for(var B in this.deletedStates[a]={},this.state[a])B!==x&&(this.deletedStates[a][B]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])p[I]||(this.deletedStates[a][x][I]=null);else for(var R in p)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][R]===null&&delete this.deletedStates[a][x][R]},rd.prototype.removeFeatureState=function(a,u,p){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][p]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(p in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][p]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},rd.prototype.getState=function(a,u){var p=String(u),x=ee({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var B=this.deletedStates[a][u];if(B===null)return{};for(var I in B)delete x[I]}return x},rd.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},rd.prototype.coalesceChanges=function(a,u){var p={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var B={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),ee(this.state[x][I],this.stateChanges[x][I]),B[I]=this.state[x][I];p[x]=B}for(var R in this.deletedStates){this.state[R]=this.state[R]||{};var k={};if(this.deletedStates[R]===null)for(var z in this.state[R])k[z]={},this.state[R][z]={};else for(var K in this.deletedStates[R]){if(this.deletedStates[R][K]===null)this.state[R][K]={};else for(var q=0,ie=Object.keys(this.deletedStates[R][K]);q<ie.length;q+=1)delete this.state[R][K][ie[q]];k[K]=this.state[R][K]}p[R]=p[R]||{},ee(p[R],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(var he in a)a[he].setFeatureState(p,u)};var Uc=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Ro(8192,16,0),this.grid3D=new Ro(8192,16,0),this.featureIndexArray=new W,this.promoteId=u};function j3(a,u,p,x,B){return de(a,function(I,R){var k=u instanceof Rc?u.get(R):null;return k&&k.evaluate?k.evaluate(p,x,B):k})}function H3(a){for(var u=1/0,p=1/0,x=-1/0,B=-1/0,I=0,R=a;I<R.length;I+=1){var k=R[I];u=Math.min(u,k.x),p=Math.min(p,k.y),x=Math.max(x,k.x),B=Math.max(B,k.y)}return{minX:u,minY:p,maxX:x,maxY:B}}function XN(a,u){return u-a}Uc.prototype.insert=function(a,u,p,x,B,I){var R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,x,B);for(var k=I?this.grid3D:this.grid,z=0;z<u.length;z++){for(var K=u[z],q=[1/0,1/0,-1/0,-1/0],ie=0;ie<K.length;ie++){var he=K[ie];q[0]=Math.min(q[0],he.x),q[1]=Math.min(q[1],he.y),q[2]=Math.max(q[2],he.x),q[3]=Math.max(q[3],he.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&k.insert(R,q[0],q[1],q[2],q[3])}},Uc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Kf.VectorTile(new hm(this.rawTileData)).layers,this.sourceLayerCoder=new xm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Uc.prototype.query=function(a,u,p,x){var B=this;this.loadVTLayers();for(var I=a.params||{},R=8192/a.tileSize/a.scale,k=mu(I.filter),z=a.queryGeometry,K=a.queryPadding*R,q=H3(z),ie=this.grid.query(q.minX-K,q.minY-K,q.maxX+K,q.maxY+K),he=H3(a.cameraQueryGeometry),_e=this.grid3D.query(he.minX-K,he.minY-K,he.maxX+K,he.maxY+K,function(gt,_t,Rt,Wt){return(function($t,br,nr,Br,ir){for(var sn=0,Dr=$t;sn<Dr.length;sn+=1){var fr=Dr[sn];if(br<=fr.x&&nr<=fr.y&&Br>=fr.x&&ir>=fr.y)return!0}var fn=[new b(br,nr),new b(br,ir),new b(Br,ir),new b(Br,nr)];if($t.length>2){for(var Zr=0,vn=fn;Zr<vn.length;Zr+=1)if(Ma($t,vn[Zr]))return!0}for(var Tr=0;Tr<$t.length-1;Tr++)if(Ph($t[Tr],$t[Tr+1],fn))return!0;return!1})(a.cameraQueryGeometry,gt-K,_t-K,Rt+K,Wt+K)}),Fe=0,ke=_e;Fe<ke.length;Fe+=1)ie.push(ke[Fe]);ie.sort(XN);for(var Ve,je={},Ze=function(gt){var _t=ie[gt];if(_t!==Ve){Ve=_t;var Rt=B.featureIndexArray.get(_t),Wt=null;B.loadMatchingFeature(je,Rt.bucketIndex,Rt.sourceLayerIndex,Rt.featureIndex,k,I.layers,I.availableImages,u,p,x,function($t,br,nr){return Wt||(Wt=vi($t)),br.queryIntersectsFeature(z,$t,nr,Wt,B.z,a.transform,R,a.pixelPosMatrix)})}},at=0;at<ie.length;at++)Ze(at);return je},Uc.prototype.loadMatchingFeature=function(a,u,p,x,B,I,R,k,z,K,q){var ie=this.bucketLayerIDs[u];if(!I||(function($t,br){for(var nr=0;nr<$t.length;nr++)if(br.indexOf($t[nr])>=0)return!0;return!1})(I,ie)){var he=this.sourceLayerCoder.decode(p),_e=this.vtLayers[he].feature(x);if(B.needGeometry){var Fe=Pi(_e,!0);if(!B.filter(new Hr(this.tileID.overscaledZ),Fe,this.tileID.canonical))return}else if(!B.filter(new Hr(this.tileID.overscaledZ),_e))return;for(var ke=this.getId(_e,he),Ve=0;Ve<ie.length;Ve++){var je=ie[Ve];if(!(I&&I.indexOf(je)<0)){var Ze=k[je];if(Ze){var at={};ke!==void 0&&K&&(at=K.getState(Ze.sourceLayer||"_geojsonTileLayer",ke));var gt=ee({},z[je]);gt.paint=j3(gt.paint,Ze.paint,_e,at,R),gt.layout=j3(gt.layout,Ze.layout,_e,at,R);var _t=!q||q(_e,Ze,at);if(_t){var Rt=new wm(_e,this.z,this.x,this.y,ke);Rt.layer=gt;var Wt=a[je];Wt===void 0&&(Wt=a[je]=[]),Wt.push({featureIndex:x,feature:Rt,intersectionZ:_t})}}}}}},Uc.prototype.lookupSymbolFeatures=function(a,u,p,x,B,I,R,k){var z={};this.loadVTLayers();for(var K=mu(B),q=0,ie=a;q<ie.length;q+=1)this.loadMatchingFeature(z,p,x,ie[q],K,I,R,k,u);return z},Uc.prototype.hasLayer=function(a){for(var u=0,p=this.bucketLayerIDs;u<p.length;u+=1)for(var x=0,B=p[u];x<B.length;x+=1)if(a===B[x])return!0;return!1},Uc.prototype.getId=function(a,u){var p=a.id;return this.promoteId&&typeof(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(p=Number(p)),p},or("FeatureIndex",Uc,{omit:["rawTileData","sourceLayerCoder"]});var os=function(a,u){this.tileID=a,this.uid=X(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};os.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<Zt.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},os.prototype.loadVectorData=function(a,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=(function(K,q){var ie={};if(!q)return ie;for(var he=function(){var ke=Fe[_e],Ve=ke.layerIds.map(function(at){return q.getLayer(at)}).filter(Boolean);if(Ve.length!==0){ke.layers=Ve,ke.stateDependentLayerIds&&(ke.stateDependentLayers=ke.stateDependentLayerIds.map(function(at){return Ve.filter(function(gt){return gt.id===at})[0]}));for(var je=0,Ze=Ve;je<Ze.length;je+=1)ie[Ze[je].id]=ke}},_e=0,Fe=K;_e<Fe.length;_e+=1)he();return ie})(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var B=this.buckets[x];if(B instanceof On){if(this.hasSymbolBuckets=!0,!p)break;B.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var R=this.buckets[I];if(R instanceof On&&R.hasRTLText){this.hasRTLText=!0,rs.isLoading()||rs.isLoaded()||Th()!=="deferred"||Co();break}}for(var k in this.queryPadding=0,this.buckets){var z=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(k).queryRadius(z))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},os.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},os.prototype.getBucket=function(a){return this.buckets[a.id]},os.prototype.upload=function(a){for(var u in this.buckets){var p=this.buckets[u];p.uploadPending()&&p.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Oh(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Oh(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},os.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},os.prototype.queryRenderedFeatures=function(a,u,p,x,B,I,R,k,z,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:B,scale:I,tileSize:this.tileSize,pixelPosMatrix:K,transform:k,params:R,queryPadding:this.queryPadding*z},a,u,p):{}},os.prototype.querySourceFeatures=function(a,u){var p=this.latestFeatureIndex;if(p&&p.rawTileData){var x=p.loadVTLayers(),B=u?u.sourceLayer:"",I=x._geojsonTileLayer||x[B];if(I)for(var R=mu(u&&u.filter),k=this.tileID.canonical,z=k.z,K=k.x,q=k.y,ie={z,x:K,y:q},he=0;he<I.length;he++){var _e=I.feature(he);if(R.needGeometry){var Fe=Pi(_e,!0);if(!R.filter(new Hr(this.tileID.overscaledZ),Fe,this.tileID.canonical))continue}else if(!R.filter(new Hr(this.tileID.overscaledZ),_e))continue;var ke=p.getId(_e,B),Ve=new wm(_e,z,K,q,ke);Ve.tile=ie,a.push(Ve)}}},os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},os.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var p=Le(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),B=!1;if(this.expirationTime>x)B=!1;else if(u)if(this.expirationTime<u)B=!0;else{var I=this.expirationTime-u;I?this.expirationTime=x+Math.max(I,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},os.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var p=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var B=this.buckets[x],I=B.layers[0].sourceLayer||"_geojsonTileLayer",R=p[I],k=a[I];if(R&&k&&Object.keys(k).length!==0){B.update(k,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=u&&u.style&&u.style.getLayer(x);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(B)))}}}},os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zt.now()},os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},os.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Zt.now()+a},os.prototype.setDependencies=function(a,u){for(var p={},x=0,B=u;x<B.length;x+=1)p[B[x]]=!0;this.dependencies[a]=p},os.prototype.hasDependency=function(a,u){for(var p=0,x=a;p<x.length;p+=1){var B=this.dependencies[x[p]];if(B){for(var I=0,R=u;I<R.length;I+=1)if(B[R[I]])return!0}}return!1};var Pu=S.performance,V3=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Pu.mark(this._marks.start)};V3.prototype.finish=function(){Pu.mark(this._marks.end);var a=Pu.getEntriesByName(this._marks.measure);return a.length===0&&(Pu.measure(this._marks.measure,this._marks.start,this._marks.end),a=Pu.getEntriesByName(this._marks.measure),Pu.clearMarks(this._marks.start),Pu.clearMarks(this._marks.end),Pu.clearMeasures(this._marks.measure)),a},s.Actor=td,s.AlphaImage=Rh,s.CanonicalTileID=Fh,s.CollisionBoxArray=d,s.Color=tn,s.DEMData=Nc,s.DataConstantProperty=xr,s.DictionaryCoder=xm,s.EXTENT=8192,s.ErrorEvent=fe,s.EvaluationParameters=Hr,s.Event=Oe,s.Evented=be,s.FeatureIndex=Uc,s.FillBucket=ol,s.FillExtrusionBucket=al,s.ImageAtlas=bA,s.ImagePosition=dm,s.LineBucket=Qs,s.LngLat=ni,s.LngLatBounds=ji,s.MercatorCoordinate=Dh,s.ONE_EM=24,s.OverscaledTileID=Hi,s.Point=b,s.Point$1=b,s.Properties=Xn,s.Protobuf=hm,s.RGBAImage=uo,s.RequestManager=_r,s.RequestPerformance=V3,s.ResourceType=Gt,s.SegmentVector=$,s.SourceFeatureState=rd,s.StructArrayLayout1ui2=M,s.StructArrayLayout2f1f2i16=Do,s.StructArrayLayout2i4=Js,s.StructArrayLayout3ui6=sa,s.StructArrayLayout4i8=Sh,s.SymbolBucket=On,s.Texture=Oh,s.Tile=os,s.Transitionable=Ji,s.Uniform1f=Ot,s.Uniform1i=pt,s.Uniform2f=xt,s.Uniform3f=Ut,s.Uniform4f=sr,s.UniformColor=Er,s.UniformMatrix4f=xn,s.UnwrappedTileID=z3,s.ValidationError=we,s.WritingMode=ko,s.ZoomHistory=wh,s.add=function(a,u,p){return a[0]=u[0]+p[0],a[1]=u[1]+p[1],a[2]=u[2]+p[2],a},s.addDynamicAttributes=Eb,s.asyncAll=function(a,u,p){if(!a.length)return p(null,[]);var x=a.length,B=new Array(a.length),I=null;a.forEach(function(R,k){u(R,function(z,K){z&&(I=z),B[k]=K,--x==0&&p(I,B)})})},s.bezier=N,s.bindAll=Ge,s.browser=Zt,s.cacheEntryPossiblyAdded=function(a){++Lt>kt&&(a.getActor().send("enforceCacheSizeLimit",Se),Lt=0)},s.clamp=V,s.clearTileCache=function(a){var u=S.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},s.clipLine=E3,s.clone=function(a){var u=new Bn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},s.clone$1=De,s.clone$2=function(a){var u=new Bn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},s.collisionCircleLayout=dN,s.config=Ht,s.create=function(){var a=new Bn(16);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new Bn(9);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new Bn(4);return Bn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=l,s.createExpression=Au,s.createLayout=ki,s.createStyleLayer=function(a){return a.type==="custom"?new JN(a):new KN[a.type](a)},s.cross=function(a,u,p){var x=u[0],B=u[1],I=u[2],R=p[0],k=p[1],z=p[2];return a[0]=B*z-I*k,a[1]=I*R-x*z,a[2]=x*k-B*R,a},s.deepEqual=function a(u,p){if(Array.isArray(u)){if(!Array.isArray(p)||u.length!==p.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],p[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&p!==null){if(typeof p!="object"||Object.keys(u).length!==Object.keys(p).length)return!1;for(var B in u)if(!a(u[B],p[B]))return!1;return!0}return u===p},s.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},s.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},s.ease=U,s.emitValidationErrors=Lc,s.endsWith=ze,s.enforceCacheSizeLimit=function(a){Jt(),Tn&&Tn.then(function(u){u.keys().then(function(p){for(var x=0;x<p.length-a;x++)u.delete(p[x])})})},s.evaluateSizeForFeature=y3,s.evaluateSizeForZoom=b3,s.evaluateVariableOffset=S3,s.evented=Bi,s.extend=ee,s.featureFilter=mu,s.filterObject=ce,s.fromRotation=function(a,u){var p=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=p,a[2]=0,a[3]=-p,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=vb,s.getAnchorJustification=Cb,s.getArrayBuffer=Ke,s.getImage=ne,s.getJSON=function(a,u){return xe(ee(a,{type:"json"}),u)},s.getRTLTextPluginStatus=Th,s.getReferrer=H,s.getVideo=function(a,u){var p,x,B=S.document.createElement("video");B.muted=!0,B.onloadstart=function(){u(null,B)};for(var I=0;I<a.length;I++){var R=S.document.createElement("source");p=a[I],x=void 0,(x=S.document.createElement("a")).href=p,(x.protocol!==S.document.location.protocol||x.host!==S.document.location.host)&&(B.crossOrigin="Anonymous"),R.src=a[I],B.appendChild(R)}return{cancel:function(){}}},s.identity=To,s.invert=function(a,u){var p=u[0],x=u[1],B=u[2],I=u[3],R=u[4],k=u[5],z=u[6],K=u[7],q=u[8],ie=u[9],he=u[10],_e=u[11],Fe=u[12],ke=u[13],Ve=u[14],je=u[15],Ze=p*k-x*R,at=p*z-B*R,gt=p*K-I*R,_t=x*z-B*k,Rt=x*K-I*k,Wt=B*K-I*z,$t=q*ke-ie*Fe,br=q*Ve-he*Fe,nr=q*je-_e*Fe,Br=ie*Ve-he*ke,ir=ie*je-_e*ke,sn=he*je-_e*Ve,Dr=Ze*sn-at*ir+gt*Br+_t*nr-Rt*br+Wt*$t;return Dr?(a[0]=(k*sn-z*ir+K*Br)*(Dr=1/Dr),a[1]=(B*ir-x*sn-I*Br)*Dr,a[2]=(ke*Wt-Ve*Rt+je*_t)*Dr,a[3]=(he*Rt-ie*Wt-_e*_t)*Dr,a[4]=(z*nr-R*sn-K*br)*Dr,a[5]=(p*sn-B*nr+I*br)*Dr,a[6]=(Ve*gt-Fe*Wt-je*at)*Dr,a[7]=(q*Wt-he*gt+_e*at)*Dr,a[8]=(R*ir-k*nr+K*$t)*Dr,a[9]=(x*nr-p*ir-I*$t)*Dr,a[10]=(Fe*Rt-ke*gt+je*Ze)*Dr,a[11]=(ie*gt-q*Rt-_e*Ze)*Dr,a[12]=(k*br-R*Br-z*$t)*Dr,a[13]=(p*Br-x*br+B*$t)*Dr,a[14]=(ke*at-Fe*_t-Ve*Ze)*Dr,a[15]=(q*_t-ie*at+he*Ze)*Dr,a):null},s.isChar=qt,s.isMapboxURL=yr,s.keysDifference=function(a,u){var p=[];for(var x in a)x in u||p.push(x);return p},s.makeRequest=xe,s.mapObject=de,s.mercatorXfromLng=N3,s.mercatorYfromLat=U3,s.mercatorZfromAltitude=G3,s.mul=cb,s.multiply=Xs,s.mvt=Kf,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,u){var p=u[0],x=u[1],B=u[2],I=p*p+x*x+B*B;return I>0&&(I=1/Math.sqrt(I)),a[0]=u[0]*I,a[1]=u[1]*I,a[2]=u[2]*I,a},s.number=fi,s.offscreenCanvasSupported=ge,s.ortho=function(a,u,p,x,B,I,R){var k=1/(u-p),z=1/(x-B),K=1/(I-R);return a[0]=-2*k,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*z,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*K,a[11]=0,a[12]=(u+p)*k,a[13]=(B+x)*z,a[14]=(R+I)*K,a[15]=1,a},s.parseGlyphPBF=function(a){return new hm(a).readFields(EN,[])},s.pbf=hm,s.performSymbolLayout=function(a,u,p,x,B,I,R){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var k=a.layers[0].layout,z=a.layers[0]._unevaluatedLayout._values,K={};if(a.textSizeData.kind==="composite"){var q=a.textSizeData,ie=q.maxZoom;K.compositeTextSizes=[z["text-size"].possiblyEvaluate(new Hr(q.minZoom),R),z["text-size"].possiblyEvaluate(new Hr(ie),R)]}if(a.iconSizeData.kind==="composite"){var he=a.iconSizeData,_e=he.maxZoom;K.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new Hr(he.minZoom),R),z["icon-size"].possiblyEvaluate(new Hr(_e),R)]}K.layoutTextSize=z["text-size"].possiblyEvaluate(new Hr(a.zoom+1),R),K.layoutIconSize=z["icon-size"].possiblyEvaluate(new Hr(a.zoom+1),R),K.textMaxSize=z["text-size"].possiblyEvaluate(new Hr(18));for(var Fe=24*k.get("text-line-height"),ke=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ve=k.get("text-keep-upright"),je=k.get("text-size"),Ze=function(){var _t=gt[at],Rt=k.get("text-font").evaluate(_t,{},R).join(","),Wt=je.evaluate(_t,{},R),$t=K.layoutTextSize.evaluate(_t,{},R),br=K.layoutIconSize.evaluate(_t,{},R),nr={horizontal:{},vertical:void 0},Br=_t.text,ir=[0,0];if(Br){var sn=Br.toString(),Dr=24*k.get("text-letter-spacing").evaluate(_t,{},R),fr=(function(gn){for(var Un=0,Mn=gn;Un<Mn.length;Un+=1)if(wn=Mn[Un].charCodeAt(0),qt.Arabic(wn)||qt["Arabic Supplement"](wn)||qt["Arabic Extended-A"](wn)||qt["Arabic Presentation Forms-A"](wn)||qt["Arabic Presentation Forms-B"](wn))return!1;var wn;return!0})(sn)?Dr:0,fn=k.get("text-anchor").evaluate(_t,{},R),Zr=k.get("text-variable-anchor");if(!Zr){var vn=k.get("text-radial-offset").evaluate(_t,{},R);ir=vn?S3(fn,[24*vn,wb]):k.get("text-offset").evaluate(_t,{},R).map(function(gn){return 24*gn})}var Tr=ke?"center":k.get("text-justify").evaluate(_t,{},R),Cn=k.get("symbol-placement"),ii=Cn==="point"?24*k.get("text-max-width").evaluate(_t,{},R):0,Si=function(){a.allowVerticalPlacement&&Ch(sn)&&(nr.vertical=pm(Br,u,p,B,Rt,ii,Fe,fn,"left",fr,ir,ko.vertical,!0,Cn,$t,Wt))};if(!ke&&Zr){for(var xi=Tr==="auto"?Zr.map(function(gn){return Cb(gn)}):[Tr],si=!1,Ii=0;Ii<xi.length;Ii++){var Zi=xi[Ii];if(!nr.horizontal[Zi])if(si)nr.horizontal[Zi]=nr.horizontal[0];else{var $i=pm(Br,u,p,B,Rt,ii,Fe,"center",Zi,fr,ir,ko.horizontal,!1,Cn,$t,Wt);$i&&(nr.horizontal[Zi]=$i,si=$i.positionedLines.length===1)}}Si()}else{Tr==="auto"&&(Tr=Cb(fn));var Rs=pm(Br,u,p,B,Rt,ii,Fe,fn,Tr,fr,ir,ko.horizontal,!1,Cn,$t,Wt);Rs&&(nr.horizontal[Tr]=Rs),Si(),Ch(sn)&&ke&&Ve&&(nr.vertical=pm(Br,u,p,B,Rt,ii,Fe,fn,Tr,fr,ir,ko.vertical,!1,Cn,$t,Wt))}}var as=void 0,Os=!1;if(_t.icon&&_t.icon.name){var Li=x[_t.icon.name];Li&&(as=(function(gn,Un,Mn){var wn=vb(Mn),Zs=Un[0]-gn.displaySize[0]*wn.horizontalAlign,bs=Un[1]-gn.displaySize[1]*wn.verticalAlign;return{image:gn,top:bs,bottom:bs+gn.displaySize[1],left:Zs,right:Zs+gn.displaySize[0]}})(B[_t.icon.name],k.get("icon-offset").evaluate(_t,{},R),k.get("icon-anchor").evaluate(_t,{},R)),Os=Li.sdf,a.sdfIcons===void 0?a.sdfIcons=Li.sdf:a.sdfIcons!==Li.sdf&&ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Li.pixelRatio!==a.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var ls=M3(nr.horizontal)||nr.vertical;a.iconsInText=!!ls&&ls.iconsInText,(ls||as)&&(function(gn,Un,Mn,wn,Zs,bs,ei,Ni,vs,En,Jl){var No=bs.textMaxSize.evaluate(Un,{});No===void 0&&(No=ei);var Kl,Ri=gn.layers[0].layout,Xl=Ri.get("icon-offset").evaluate(Un,{},Jl),La=M3(Mn.horizontal),nd=ei/24,kh=gn.tilePixelRatio*nd,id=gn.tilePixelRatio*No/24,Gc=gn.tilePixelRatio*Ni,sd=gn.tilePixelRatio*Ri.get("symbol-spacing"),Cm=Ri.get("text-padding")*gn.tilePixelRatio,od=Ri.get("icon-padding")*gn.tilePixelRatio,wA=Ri.get("text-max-angle")/180*Math.PI,Em=Ri.get("text-rotation-alignment")==="map"&&Ri.get("symbol-placement")!=="point",Bm=Ri.get("icon-rotation-alignment")==="map"&&Ri.get("symbol-placement")!=="point",zc=Ri.get("symbol-placement"),CA=sd/2,ad=Ri.get("icon-text-fit");wn&&ad!=="none"&&(gn.allowVerticalPlacement&&Mn.vertical&&(Kl=_3(wn,Mn.vertical,ad,Ri.get("icon-text-fit-padding"),Xl,nd)),La&&(wn=_3(wn,La,ad,Ri.get("icon-text-fit-padding"),Xl,nd)));var Lu=function(QN,LA){LA.x<0||LA.x>=8192||LA.y<0||LA.y>=8192||(function(Oi,ll,ZN,Ru,Rb,K3,Lm,Ql,Rm,RA,Om,Dm,Ob,X3,OA,Q3,Z3,$3,q3,Y3,Uo,Fm,eB,Zl,$N){var tB,Uh,fd,dd,pd,Ad=Oi.addToLineVertexArray(ll,ZN),rB=0,nB=0,iB=0,sB=0,Db=-1,Fb=-1,jc={},oB=me(""),kb=0,Nb=0;if(Ql._unevaluatedLayout.getValue("text-radial-offset")===void 0?(kb=(tB=Ql.layout.get("text-offset").evaluate(Uo,{},Zl).map(function(FA){return 24*FA}))[0],Nb=tB[1]):(kb=24*Ql.layout.get("text-radial-offset").evaluate(Uo,{},Zl),Nb=wb),Oi.allowVerticalPlacement&&Ru.vertical){var aB=Ql.layout.get("text-rotate").evaluate(Uo,{},Zl)+90;dd=new ym(Rm,ll,RA,Om,Dm,Ru.vertical,Ob,X3,OA,aB),Lm&&(pd=new ym(Rm,ll,RA,Om,Dm,Lm,Z3,$3,OA,aB))}if(Rb){var Ub=Ql.layout.get("icon-rotate").evaluate(Uo,{}),lB=Ql.layout.get("icon-text-fit")!=="none",cB=B3(Rb,Ub,eB,lB),Gb=Lm?B3(Lm,Ub,eB,lB):void 0;fd=new ym(Rm,ll,RA,Om,Dm,Rb,Z3,$3,!1,Ub),rB=4*cB.length;var uB=Oi.iconSizeData,DA=null;uB.kind==="source"?(DA=[128*Ql.layout.get("icon-size").evaluate(Uo,{})])[0]>32640&&ue(Oi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):uB.kind==="composite"&&((DA=[128*Fm.compositeIconSizes[0].evaluate(Uo,{},Zl),128*Fm.compositeIconSizes[1].evaluate(Uo,{},Zl)])[0]>32640||DA[1]>32640)&&ue(Oi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Oi.addSymbols(Oi.icon,cB,DA,Y3,q3,Uo,!1,ll,Ad.lineStartIndex,Ad.lineLength,-1,Zl),Db=Oi.icon.placedSymbolArray.length-1,Gb&&(nB=4*Gb.length,Oi.addSymbols(Oi.icon,Gb,DA,Y3,q3,Uo,ko.vertical,ll,Ad.lineStartIndex,Ad.lineLength,-1,Zl),Fb=Oi.icon.placedSymbolArray.length-1)}for(var hB in Ru.horizontal){var km=Ru.horizontal[hB];if(!Uh){oB=me(km.text);var qN=Ql.layout.get("text-rotate").evaluate(Uo,{},Zl);Uh=new ym(Rm,ll,RA,Om,Dm,km,Ob,X3,OA,qN)}var fB=km.positionedLines.length===1;if(iB+=I3(Oi,ll,km,K3,Ql,OA,Uo,Q3,Ad,Ru.vertical?ko.horizontal:ko.horizontalOnly,fB?Object.keys(Ru.horizontal):[hB],jc,Db,Fm,Zl),fB)break}Ru.vertical&&(sB+=I3(Oi,ll,Ru.vertical,K3,Ql,OA,Uo,Q3,Ad,ko.vertical,["vertical"],jc,Fb,Fm,Zl));var YN=Uh?Uh.boxStartIndex:Oi.collisionBoxArray.length,eU=Uh?Uh.boxEndIndex:Oi.collisionBoxArray.length,tU=dd?dd.boxStartIndex:Oi.collisionBoxArray.length,rU=dd?dd.boxEndIndex:Oi.collisionBoxArray.length,nU=fd?fd.boxStartIndex:Oi.collisionBoxArray.length,iU=fd?fd.boxEndIndex:Oi.collisionBoxArray.length,sU=pd?pd.boxStartIndex:Oi.collisionBoxArray.length,oU=pd?pd.boxEndIndex:Oi.collisionBoxArray.length,$l=-1,Nm=function(FA,pB){return FA&&FA.circleDiameter?Math.max(FA.circleDiameter,pB):pB};$l=Nm(Uh,$l),$l=Nm(dd,$l),$l=Nm(fd,$l);var dB=($l=Nm(pd,$l))>-1?1:0;dB&&($l*=$N/24),Oi.glyphOffsetArray.length>=On.MAX_GLYPHS&&ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Uo.sortKey!==void 0&&Oi.addToSortKeyRanges(Oi.symbolInstances.length,Uo.sortKey),Oi.symbolInstances.emplaceBack(ll.x,ll.y,jc.right>=0?jc.right:-1,jc.center>=0?jc.center:-1,jc.left>=0?jc.left:-1,jc.vertical||-1,Db,Fb,oB,YN,eU,tU,rU,nU,iU,sU,oU,RA,iB,sB,rB,nB,dB,0,Ob,kb,Nb,$l)})(gn,LA,QN,Mn,wn,Zs,Kl,gn.layers[0],gn.collisionBoxArray,Un.index,Un.sourceLayerIndex,gn.index,kh,Cm,Em,vs,Gc,od,Bm,Xl,Un,bs,En,Jl,ei)};if(zc==="line")for(var ld=0,Tm=E3(Un.geometry,0,0,8192,8192);ld<Tm.length;ld+=1)for(var Sm=Tm[ld],EA=0,BA=LN(Sm,sd,wA,Mn.vertical||La,wn,24,id,gn.overscaling,8192);EA<BA.length;EA+=1){var Im=BA[EA];La&&FN(gn,La.text,CA,Im)||Lu(Sm,Im)}else if(zc==="line-center")for(var TA=0,SA=Un.geometry;TA<SA.length;TA+=1){var IA=SA[TA];if(IA.length>1){var Mm=PN(IA,wA,Mn.vertical||La,wn,24,id);Mm&&Lu(IA,Mm)}}else if(Un.type==="Polygon")for(var cd=0,Pm=gb(Un.geometry,0);cd<Pm.length;cd+=1){var ud=Pm[cd],MA=ON(ud,16);Lu(ud[0],new Zf(MA.x,MA.y,0))}else if(Un.type==="LineString")for(var Nh=0,PA=Un.geometry;Nh<PA.length;Nh+=1){var hd=PA[Nh];Lu(hd,new Zf(hd[0].x,hd[0].y,0))}else if(Un.type==="Point")for(var Mb=0,W3=Un.geometry;Mb<W3.length;Mb+=1)for(var Pb=0,J3=W3[Mb];Pb<J3.length;Pb+=1){var Lb=J3[Pb];Lu([Lb],new Zf(Lb.x,Lb.y,0))}})(a,_t,nr,as,x,K,$t,br,ir,Os,R)},at=0,gt=a.features;at<gt.length;at+=1)Ze();I&&a.generateCollisionDebugBuffers()},s.perspective=function(a,u,p,x,B){var I,R=1/Math.tan(u/2);return a[0]=R/p,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=R,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,B!=null&&B!==1/0?(a[10]=(B+x)*(I=1/(x-B)),a[14]=2*B*x*I):(a[10]=-1,a[14]=-2*x),a},s.pick=function(a,u){for(var p={},x=0;x<u.length;x++){var B=u[x];B in a&&(p[B]=a[B])}return p},s.plugin=rs,s.polygonIntersectsPolygon=Hl,s.postMapLoadEvent=_i,s.postTurnstileEvent=Mr,s.potpack=p3,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=or,s.registerForPluginStateChange=function(a){return a({pluginStatus:Ms,pluginURL:ta}),Bi.on("pluginStateChange",a),a},s.renderColorRamp=QE,s.rotate=function(a,u,p){var x=u[0],B=u[1],I=u[2],R=u[3],k=Math.sin(p),z=Math.cos(p);return a[0]=x*z+I*k,a[1]=B*z+R*k,a[2]=x*-k+I*z,a[3]=B*-k+R*z,a},s.rotateX=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[4],R=u[5],k=u[6],z=u[7],K=u[8],q=u[9],ie=u[10],he=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=I*B+K*x,a[5]=R*B+q*x,a[6]=k*B+ie*x,a[7]=z*B+he*x,a[8]=K*B-I*x,a[9]=q*B-R*x,a[10]=ie*B-k*x,a[11]=he*B-z*x,a},s.rotateZ=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[0],R=u[1],k=u[2],z=u[3],K=u[4],q=u[5],ie=u[6],he=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=I*B+K*x,a[1]=R*B+q*x,a[2]=k*B+ie*x,a[3]=z*B+he*x,a[4]=K*B-I*x,a[5]=q*B-R*x,a[6]=ie*B-k*x,a[7]=he*B-z*x,a},s.scale=function(a,u,p){var x=p[0],B=p[1],I=p[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*B,a[5]=u[5]*B,a[6]=u[6]*B,a[7]=u[7]*B,a[8]=u[8]*I,a[9]=u[9]*I,a[10]=u[10]*I,a[11]=u[11]*I,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},s.scale$1=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a[3]=u[3]*p,a},s.scale$2=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a},s.setCacheLimits=function(a,u){Se=a,kt=u},s.setRTLTextPlugin=function(a,u,p){if(p===void 0&&(p=!1),Ms==="deferred"||Ms==="loading"||Ms==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ta=Zt.resolveURL(a),Ms="deferred",Cu=u,zl(),p||Co()},s.sphericalToCartesian=function(a){var u=a[0],p=a[1],x=a[2];return p+=90,p*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(p)*Math.sin(x),y:u*Math.sin(p)*Math.sin(x),z:u*Math.cos(x)}},s.sqrLen=function(a){var u=a[0],p=a[1];return u*u+p*p},s.styleSpec=oe,s.sub=function(a,u,p){return a[0]=u[0]-p[0],a[1]=u[1]-p[1],a[2]=u[2]-p[2],a},s.symbolSize=MN,s.transformMat3=function(a,u,p){var x=u[0],B=u[1],I=u[2];return a[0]=x*p[0]+B*p[3]+I*p[6],a[1]=x*p[1]+B*p[4]+I*p[7],a[2]=x*p[2]+B*p[5]+I*p[8],a},s.transformMat4=Hf,s.translate=function(a,u,p){var x,B,I,R,k,z,K,q,ie,he,_e,Fe,ke=p[0],Ve=p[1],je=p[2];return u===a?(a[12]=u[0]*ke+u[4]*Ve+u[8]*je+u[12],a[13]=u[1]*ke+u[5]*Ve+u[9]*je+u[13],a[14]=u[2]*ke+u[6]*Ve+u[10]*je+u[14],a[15]=u[3]*ke+u[7]*Ve+u[11]*je+u[15]):(B=u[1],I=u[2],R=u[3],k=u[4],z=u[5],K=u[6],q=u[7],ie=u[8],he=u[9],_e=u[10],Fe=u[11],a[0]=x=u[0],a[1]=B,a[2]=I,a[3]=R,a[4]=k,a[5]=z,a[6]=K,a[7]=q,a[8]=ie,a[9]=he,a[10]=_e,a[11]=Fe,a[12]=x*ke+k*Ve+ie*je+u[12],a[13]=B*ke+z*Ve+he*je+u[13],a[14]=I*ke+K*Ve+_e*je+u[14],a[15]=R*ke+q*Ve+Fe*je+u[15]),a},s.triggerPluginCompletionEvent=Bh,s.uniqueId=X,s.validateCustomStyleLayer=function(a){var u=[],p=a.id;return p===void 0&&u.push({message:"layers."+p+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+p+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+p+': property "renderingMode" must be either "2d" or "3d"'}),u},s.validateLight=uA,s.validateStyle=Pc,s.values=function(a){var u=[];for(var p in a)u.push(a[p]);return u},s.vectorTile=Kf,s.version="1.13.3",s.warnOnce=ue,s.webpSupported=dr,s.window=S,s.wrap=j}),o(["./shared"],function(s){function l(Z){var ne=typeof Z;if(ne==="number"||ne==="boolean"||ne==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){for(var ae="[",ye=0,Oe=Z;ye<Oe.length;ye+=1)ae+=l(Oe[ye])+",";return ae+"]"}for(var fe=Object.keys(Z).sort(),be="{",oe=0;oe<fe.length;oe++)be+=JSON.stringify(fe[oe])+":"+l(Z[fe[oe]])+",";return be+"}"}function h(Z){for(var ne="",ae=0,ye=s.refProperties;ae<ye.length;ae+=1)ne+="/"+l(Z[ye[ae]]);return ne}var A=function(Z){this.keyCache={},Z&&this.replace(Z)};A.prototype.replace=function(Z){this._layerConfigs={},this._layers={},this.update(Z,[])},A.prototype.update=function(Z,ne){for(var ae=this,ye=0,Oe=Z;ye<Oe.length;ye+=1){var fe=Oe[ye];this._layerConfigs[fe.id]=fe;var be=this._layers[fe.id]=s.createStyleLayer(fe);be._featureFilter=s.featureFilter(be.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(var oe=0,we=ne;oe<we.length;oe+=1){var g=we[oe];delete this.keyCache[g],delete this._layerConfigs[g],delete this._layers[g]}this.familiesBySource={};for(var le=0,Ct=(function(It,jt){for(var Nr={},er=0;er<It.length;er++){var en=jt&&jt[It[er].id]||h(It[er]);jt&&(jt[It[er].id]=en);var cn=Nr[en];cn||(cn=Nr[en]=[]),cn.push(It[er])}var Jr=[];for(var Kr in Nr)Jr.push(Nr[Kr]);return Jr})(s.values(this._layerConfigs),this.keyCache);le<Ct.length;le+=1){var Qe=Ct[le].map(function(It){return ae._layers[It.id]}),Et=Qe[0];if(Et.visibility!=="none"){var Pt=Et.source||"",Dt=this.familiesBySource[Pt];Dt||(Dt=this.familiesBySource[Pt]={});var ht=Et.sourceLayer||"_geojsonTileLayer",Ft=Dt[ht];Ft||(Ft=Dt[ht]=[]),Ft.push(Qe)}}};var b=function(Z){var ne={},ae=[];for(var ye in Z){var Oe=Z[ye],fe=ne[ye]={};for(var be in Oe){var oe=Oe[+be];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var we={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};ae.push(we),fe[be]={rect:we,metrics:oe.metrics}}}}var g=s.potpack(ae),le=new s.AlphaImage({width:g.w||1,height:g.h||1});for(var Ct in Z){var Qe=Z[Ct];for(var Et in Qe){var Pt=Qe[+Et];if(Pt&&Pt.bitmap.width!==0&&Pt.bitmap.height!==0){var Dt=ne[Ct][Et].rect;s.AlphaImage.copy(Pt.bitmap,le,{x:0,y:0},{x:Dt.x+1,y:Dt.y+1},Pt.bitmap)}}}this.image=le,this.positions=ne};s.register("GlyphAtlas",b);var C=function(Z){this.tileID=new s.OverscaledTileID(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId};function S(Z,ne,ae){for(var ye=new s.EvaluationParameters(ne),Oe=0,fe=Z;Oe<fe.length;Oe+=1)fe[Oe].recalculate(ye,ae)}function D(Z,ne){var ae=s.getArrayBuffer(Z.request,function(ye,Oe,fe,be){ye?ne(ye):Oe&&ne(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(Oe)),rawData:Oe,cacheControl:fe,expires:be})});return function(){ae.cancel(),ne()}}C.prototype.parse=function(Z,ne,ae,ye,Oe){var fe=this;this.status="parsing",this.data=Z,this.collisionBoxArray=new s.CollisionBoxArray;var be=new s.DictionaryCoder(Object.keys(Z.layers).sort()),oe=new s.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var we,g,le,Ct,Qe={},Et={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},Pt=ne.familiesBySource[this.source];for(var Dt in Pt){var ht=Z.layers[Dt];if(ht){ht.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+Dt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ft=be.encode(Dt),It=[],jt=0;jt<ht.length;jt++){var Nr=ht.feature(jt),er=oe.getId(Nr,Dt);It.push({feature:Nr,id:er,index:jt,sourceLayerIndex:Ft})}for(var en=0,cn=Pt[Dt];en<cn.length;en+=1){var Jr=cn[en],Kr=Jr[0];Kr.minzoom&&this.zoom<Math.floor(Kr.minzoom)||Kr.maxzoom&&this.zoom>=Kr.maxzoom||Kr.visibility!=="none"&&(S(Jr,this.zoom,ae),(Qe[Kr.id]=Kr.createBucket({index:oe.bucketLayerIDs.length,layers:Jr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(It,Et,this.tileID.canonical),oe.bucketLayerIDs.push(Jr.map(function(Be){return Be.id})))}}}var zr=s.mapObject(Et.glyphDependencies,function(Be){return Object.keys(Be).map(Number)});Object.keys(zr).length?ye.send("getGlyphs",{uid:this.uid,stacks:zr},function(Be,Xt){we||(we=Be,g=Xt,mr.call(fe))}):g={};var yi=Object.keys(Et.iconDependencies);yi.length?ye.send("getImages",{icons:yi,source:this.source,tileID:this.tileID,type:"icons"},function(Be,Xt){we||(we=Be,le=Xt,mr.call(fe))}):le={};var Xr=Object.keys(Et.patternDependencies);function mr(){if(we)return Oe(we);if(g&&le&&Ct){var Be=new b(g),Xt=new s.ImageAtlas(le,Ct);for(var tn in Qe){var Vi=Qe[tn];Vi instanceof s.SymbolBucket?(S(Vi.layers,this.zoom,ae),s.performSymbolLayout(Vi,g,Be.positions,le,Xt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Vi.hasPattern&&(Vi instanceof s.LineBucket||Vi instanceof s.FillBucket||Vi instanceof s.FillExtrusionBucket)&&(S(Vi.layers,this.zoom,ae),Vi.addFeatures(Et,this.tileID.canonical,Xt.patternPositions))}this.status="done",Oe(null,{buckets:s.values(Qe).filter(function(ya){return!ya.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Be.image,imageAtlas:Xt,glyphMap:this.returnDependencies?g:null,iconMap:this.returnDependencies?le:null,glyphPositions:this.returnDependencies?Be.positions:null})}}Xr.length?ye.send("getImages",{icons:Xr,source:this.source,tileID:this.tileID,type:"patterns"},function(Be,Xt){we||(we=Be,Ct=Xt,mr.call(fe))}):Ct={},mr.call(this)};var N=function(Z,ne,ae,ye){this.actor=Z,this.layerIndex=ne,this.availableImages=ae,this.loadVectorData=ye||D,this.loading={},this.loaded={}};N.prototype.loadTile=function(Z,ne){var ae=this,ye=Z.uid;this.loading||(this.loading={});var Oe=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new s.RequestPerformance(Z.request),fe=this.loading[ye]=new C(Z);fe.abort=this.loadVectorData(Z,function(be,oe){if(delete ae.loading[ye],be||!oe)return fe.status="done",ae.loaded[ye]=fe,ne(be);var we=oe.rawData,g={};oe.expires&&(g.expires=oe.expires),oe.cacheControl&&(g.cacheControl=oe.cacheControl);var le={};if(Oe){var Ct=Oe.finish();Ct&&(le.resourceTiming=JSON.parse(JSON.stringify(Ct)))}fe.vectorTile=oe.vectorTile,fe.parse(oe.vectorTile,ae.layerIndex,ae.availableImages,ae.actor,function(Qe,Et){if(Qe||!Et)return ne(Qe);ne(null,s.extend({rawTileData:we.slice(0)},Et,g,le))}),ae.loaded=ae.loaded||{},ae.loaded[ye]=fe})},N.prototype.reloadTile=function(Z,ne){var ae=this,ye=this.loaded,Oe=Z.uid,fe=this;if(ye&&ye[Oe]){var be=ye[Oe];be.showCollisionBoxes=Z.showCollisionBoxes;var oe=function(we,g){var le=be.reloadCallback;le&&(delete be.reloadCallback,be.parse(be.vectorTile,fe.layerIndex,ae.availableImages,fe.actor,le)),ne(we,g)};be.status==="parsing"?be.reloadCallback=oe:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},N.prototype.abortTile=function(Z,ne){var ae=this.loading,ye=Z.uid;ae&&ae[ye]&&ae[ye].abort&&(ae[ye].abort(),delete ae[ye]),ne()},N.prototype.removeTile=function(Z,ne){var ae=this.loaded,ye=Z.uid;ae&&ae[ye]&&delete ae[ye],ne()};var U=s.window.ImageBitmap,V=function(){this.loaded={}};function j(Z,ne){if(Z.length!==0){ee(Z[0],ne);for(var ae=1;ae<Z.length;ae++)ee(Z[ae],!ne)}}function ee(Z,ne){for(var ae=0,ye=0,Oe=0,fe=Z.length,be=fe-1;Oe<fe;be=Oe++){var oe=(Z[Oe][0]-Z[be][0])*(Z[be][1]+Z[Oe][1]),we=ae+oe;ye+=Math.abs(ae)>=Math.abs(oe)?ae-we+oe:oe-we+ae,ae=we}ae+ye>=0!=!!ne&&Z.reverse()}V.prototype.loadTile=function(Z,ne){var ae=Z.uid,ye=Z.encoding,Oe=Z.rawImageData,fe=U&&Oe instanceof U?this.getImageData(Oe):Oe,be=new s.DEMData(ae,fe,ye);this.loaded=this.loaded||{},this.loaded[ae]=be,ne(null,be)},V.prototype.getImageData=function(Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);var ne=this.offscreenCanvasContext.getImageData(-1,-1,Z.width+2,Z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ne.width,height:ne.height},ne.data)},V.prototype.removeTile=function(Z){var ne=this.loaded,ae=Z.uid;ne&&ne[ae]&&delete ne[ae]};var Q=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,X=function(Z){this._feature=Z,this.extent=s.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))};X.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Z=[],ne=0,ae=this._feature.geometry;ne<ae.length;ne+=1){var ye=ae[ne];Z.push([new s.Point$1(ye[0],ye[1])])}return Z}for(var Oe=[],fe=0,be=this._feature.geometry;fe<be.length;fe+=1){for(var oe=[],we=0,g=be[fe];we<g.length;we+=1){var le=g[we];oe.push(new s.Point$1(le[0],le[1]))}Oe.push(oe)}return Oe},X.prototype.toGeoJSON=function(Z,ne,ae){return Q.call(this,Z,ne,ae)};var pe=function(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Z.length,this._features=Z};pe.prototype.feature=function(Z){return new X(this._features[Z])};var Y=s.vectorTile.VectorTileFeature,Ge=ze;function ze(Z,ne){this.options=ne||{},this.features=Z,this.length=Z.length}function de(Z,ne){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=ne||4096}ze.prototype.feature=function(Z){return new de(this.features[Z],this.options.extent)},de.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Z.length;ne++){for(var ae=Z[ne],ye=[],Oe=0;Oe<ae.length;Oe++)ye.push(new s.Point$1(ae[Oe][0],ae[Oe][1]));this.geometry.push(ye)}return this.geometry},de.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,ne=1/0,ae=-1/0,ye=1/0,Oe=-1/0,fe=0;fe<Z.length;fe++)for(var be=Z[fe],oe=0;oe<be.length;oe++){var we=be[oe];ne=Math.min(ne,we.x),ae=Math.max(ae,we.x),ye=Math.min(ye,we.y),Oe=Math.max(Oe,we.y)}return[ne,ye,ae,Oe]},de.prototype.toGeoJSON=Y.prototype.toGeoJSON;var ce=J,De=Ge;function J(Z){var ne=new s.pbf;return(function(ae,ye){for(var Oe in ae.layers)ye.writeMessage(3,ue,ae.layers[Oe])})(Z,ne),ne.finish()}function ue(Z,ne){var ae;ne.writeVarintField(15,Z.version||1),ne.writeStringField(1,Z.name||""),ne.writeVarintField(5,Z.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<Z.length;ae++)ye.feature=Z.feature(ae),ne.writeMessage(2,Ee,ye);var Oe=ye.keys;for(ae=0;ae<Oe.length;ae++)ne.writeStringField(3,Oe[ae]);var fe=ye.values;for(ae=0;ae<fe.length;ae++)ne.writeMessage(4,$e,fe[ae])}function Ee(Z,ne){var ae=Z.feature;ae.id!==void 0&&ne.writeVarintField(1,ae.id),ne.writeMessage(2,ct,Z),ne.writeVarintField(3,ae.type),ne.writeMessage(4,Ne,ae)}function ct(Z,ne){var ae=Z.feature,ye=Z.keys,Oe=Z.values,fe=Z.keycache,be=Z.valuecache;for(var oe in ae.properties){var we=fe[oe];we===void 0&&(ye.push(oe),fe[oe]=we=ye.length-1),ne.writeVarint(we);var g=ae.properties[oe],le=typeof g;le!=="string"&&le!=="boolean"&&le!=="number"&&(g=JSON.stringify(g));var Ct=le+":"+g,Qe=be[Ct];Qe===void 0&&(Oe.push(g),be[Ct]=Qe=Oe.length-1),ne.writeVarint(Qe)}}function Ce(Z,ne){return(ne<<3)+(7&Z)}function Le(Z){return Z<<1^Z>>31}function Ne(Z,ne){for(var ae=Z.loadGeometry(),ye=Z.type,Oe=0,fe=0,be=ae.length,oe=0;oe<be;oe++){var we=ae[oe],g=1;ye===1&&(g=we.length),ne.writeVarint(Ce(1,g));for(var le=ye===3?we.length-1:we.length,Ct=0;Ct<le;Ct++){Ct===1&&ye!==1&&ne.writeVarint(Ce(2,le-1));var Qe=we[Ct].x-Oe,Et=we[Ct].y-fe;ne.writeVarint(Le(Qe)),ne.writeVarint(Le(Et)),Oe+=Qe,fe+=Et}ye===3&&ne.writeVarint(Ce(7,1))}}function $e(Z,ne){var ae=typeof Z;ae==="string"?ne.writeStringField(1,Z):ae==="boolean"?ne.writeBooleanField(7,Z):ae==="number"&&(Z%1!=0?ne.writeDoubleField(3,Z):Z<0?ne.writeSVarintField(6,Z):ne.writeVarintField(5,Z))}function it(Z,ne,ae,ye){ot(Z,ae,ye),ot(ne,2*ae,2*ye),ot(ne,2*ae+1,2*ye+1)}function ot(Z,ne,ae){var ye=Z[ne];Z[ne]=Z[ae],Z[ae]=ye}function dt(Z,ne,ae,ye){var Oe=Z-ae,fe=ne-ye;return Oe*Oe+fe*fe}ce.fromVectorTileJs=J,ce.fromGeojsonVt=function(Z,ne){ne=ne||{};var ae={};for(var ye in Z)ae[ye]=new Ge(Z[ye].features,ne),ae[ye].name=ye,ae[ye].version=ne.version,ae[ye].extent=ne.extent;return J({layers:ae})},ce.GeoJSONWrapper=De;var Mt=function(Z){return Z[0]},St=function(Z){return Z[1]},st=function(Z,ne,ae,ye,Oe){ne===void 0&&(ne=Mt),ae===void 0&&(ae=St),ye===void 0&&(ye=64),Oe===void 0&&(Oe=Float64Array),this.nodeSize=ye,this.points=Z;for(var fe=Z.length<65536?Uint16Array:Uint32Array,be=this.ids=new fe(Z.length),oe=this.coords=new Oe(2*Z.length),we=0;we<Z.length;we++)be[we]=we,oe[2*we]=ne(Z[we]),oe[2*we+1]=ae(Z[we]);(function g(le,Ct,Qe,Et,Pt,Dt){if(!(Pt-Et<=Qe)){var ht=Et+Pt>>1;(function Ft(It,jt,Nr,er,en,cn){for(;en>er;){if(en-er>600){var Jr=en-er+1,Kr=Nr-er+1,zr=Math.log(Jr),yi=.5*Math.exp(2*zr/3),Xr=.5*Math.sqrt(zr*yi*(Jr-yi)/Jr)*(Kr-Jr/2<0?-1:1);Ft(It,jt,Nr,Math.max(er,Math.floor(Nr-Kr*yi/Jr+Xr)),Math.min(en,Math.floor(Nr+(Jr-Kr)*yi/Jr+Xr)),cn)}var mr=jt[2*Nr+cn],Be=er,Xt=en;for(it(It,jt,er,Nr),jt[2*en+cn]>mr&&it(It,jt,er,en);Be<Xt;){for(it(It,jt,Be,Xt),Be++,Xt--;jt[2*Be+cn]<mr;)Be++;for(;jt[2*Xt+cn]>mr;)Xt--}jt[2*er+cn]===mr?it(It,jt,er,Xt):it(It,jt,++Xt,en),Xt<=Nr&&(er=Xt+1),Nr<=Xt&&(en=Xt-1)}})(le,Ct,ht,Et,Pt,Dt%2),g(le,Ct,Qe,Et,ht-1,Dt+1),g(le,Ct,Qe,ht+1,Pt,Dt+1)}})(be,oe,ye,0,be.length-1,0)};st.prototype.range=function(Z,ne,ae,ye){return(function(Oe,fe,be,oe,we,g,le){for(var Ct,Qe,Et=[0,Oe.length-1,0],Pt=[];Et.length;){var Dt=Et.pop(),ht=Et.pop(),Ft=Et.pop();if(ht-Ft<=le)for(var It=Ft;It<=ht;It++)Qe=fe[2*It+1],(Ct=fe[2*It])>=be&&Ct<=we&&Qe>=oe&&Qe<=g&&Pt.push(Oe[It]);else{var jt=Math.floor((Ft+ht)/2);Qe=fe[2*jt+1],(Ct=fe[2*jt])>=be&&Ct<=we&&Qe>=oe&&Qe<=g&&Pt.push(Oe[jt]);var Nr=(Dt+1)%2;(Dt===0?be<=Ct:oe<=Qe)&&(Et.push(Ft),Et.push(jt-1),Et.push(Nr)),(Dt===0?we>=Ct:g>=Qe)&&(Et.push(jt+1),Et.push(ht),Et.push(Nr))}}return Pt})(this.ids,this.coords,Z,ne,ae,ye,this.nodeSize)},st.prototype.within=function(Z,ne,ae){return(function(ye,Oe,fe,be,oe,we){for(var g=[0,ye.length-1,0],le=[],Ct=oe*oe;g.length;){var Qe=g.pop(),Et=g.pop(),Pt=g.pop();if(Et-Pt<=we)for(var Dt=Pt;Dt<=Et;Dt++)dt(Oe[2*Dt],Oe[2*Dt+1],fe,be)<=Ct&&le.push(ye[Dt]);else{var ht=Math.floor((Pt+Et)/2),Ft=Oe[2*ht],It=Oe[2*ht+1];dt(Ft,It,fe,be)<=Ct&&le.push(ye[ht]);var jt=(Qe+1)%2;(Qe===0?fe-oe<=Ft:be-oe<=It)&&(g.push(Pt),g.push(ht-1),g.push(jt)),(Qe===0?fe+oe>=Ft:be+oe>=It)&&(g.push(ht+1),g.push(Et),g.push(jt))}}return le})(this.ids,this.coords,Z,ne,ae,this.nodeSize)};var Ar={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},Qt=function(Z){this.options=Hn(Object.create(Ar),Z),this.trees=new Array(this.options.maxZoom+1)};function Zt(Z,ne,ae,ye,Oe){return{x:Z,y:ne,zoom:1/0,id:ae,parentId:-1,numPoints:ye,properties:Oe}}function Ht(Z,ne){var ae=Z.geometry.coordinates,ye=ae[1];return{x:Lr(ae[0]),y:vr(ye),zoom:1/0,index:ne,parentId:-1}}function dr(Z){return{type:"Feature",id:Z.id,properties:ln(Z),geometry:{type:"Point",coordinates:[(ye=Z.x,360*(ye-.5)),(ne=Z.y,ae=(180-360*ne)*Math.PI/180,360*Math.atan(Math.exp(ae))/Math.PI-90)]}};var ne,ae,ye}function ln(Z){var ne=Z.numPoints,ae=ne>=1e4?Math.round(ne/1e3)+"k":ne>=1e3?Math.round(ne/100)/10+"k":ne;return Hn(Hn({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:ne,point_count_abbreviated:ae})}function Lr(Z){return Z/360+.5}function vr(Z){var ne=Math.sin(Z*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function Hn(Z,ne){for(var ae in ne)Z[ae]=ne[ae];return Z}function _r(Z){return Z.x}function yr(Z){return Z.y}function un(Z,ne,ae,ye,Oe,fe){var be=Oe-ae,oe=fe-ye;if(be!==0||oe!==0){var we=((Z-ae)*be+(ne-ye)*oe)/(be*be+oe*oe);we>1?(ae=Oe,ye=fe):we>0&&(ae+=be*we,ye+=oe*we)}return(be=Z-ae)*be+(oe=ne-ye)*oe}function Rr(Z,ne,ae,ye){var Oe={id:Z===void 0?null:Z,type:ne,geometry:ae,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(fe){var be=fe.geometry,oe=fe.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ci(fe,be);else if(oe==="Polygon"||oe==="MultiLineString")for(var we=0;we<be.length;we++)ci(fe,be[we]);else if(oe==="MultiPolygon")for(we=0;we<be.length;we++)for(var g=0;g<be[we].length;g++)ci(fe,be[we][g])})(Oe),Oe}function ci(Z,ne){for(var ae=0;ae<ne.length;ae+=3)Z.minX=Math.min(Z.minX,ne[ae]),Z.minY=Math.min(Z.minY,ne[ae+1]),Z.maxX=Math.max(Z.maxX,ne[ae]),Z.maxY=Math.max(Z.maxY,ne[ae+1])}function qn(Z,ne,ae,ye){if(ne.geometry){var Oe=ne.geometry.coordinates,fe=ne.geometry.type,be=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),oe=[],we=ne.id;if(ae.promoteId?we=ne.properties[ae.promoteId]:ae.generateId&&(we=ye||0),fe==="Point")mn(Oe,oe);else if(fe==="MultiPoint")for(var g=0;g<Oe.length;g++)mn(Oe[g],oe);else if(fe==="LineString")ri(Oe,oe,be,!1);else if(fe==="MultiLineString"){if(ae.lineMetrics){for(g=0;g<Oe.length;g++)ri(Oe[g],oe=[],be,!1),Z.push(Rr(we,"LineString",oe,ne.properties));return}Vn(Oe,oe,be,!1)}else if(fe==="Polygon")Vn(Oe,oe,be,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(g=0;g<ne.geometry.geometries.length;g++)qn(Z,{id:we,geometry:ne.geometry.geometries[g],properties:ne.properties},ae,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(g=0;g<Oe.length;g++){var le=[];Vn(Oe[g],le,be,!0),oe.push(le)}}Z.push(Rr(we,fe,oe,ne.properties))}}function mn(Z,ne){ne.push(Tn(Z[0])),ne.push(Yn(Z[1])),ne.push(0)}function ri(Z,ne,ae,ye){for(var Oe,fe,be=0,oe=0;oe<Z.length;oe++){var we=Tn(Z[oe][0]),g=Yn(Z[oe][1]);ne.push(we),ne.push(g),ne.push(0),oe>0&&(be+=ye?(Oe*g-we*fe)/2:Math.sqrt(Math.pow(we-Oe,2)+Math.pow(g-fe,2))),Oe=we,fe=g}var le=ne.length-3;ne[2]=1,(function Ct(Qe,Et,Pt,Dt){for(var ht,Ft=Dt,It=Pt-Et>>1,jt=Pt-Et,Nr=Qe[Et],er=Qe[Et+1],en=Qe[Pt],cn=Qe[Pt+1],Jr=Et+3;Jr<Pt;Jr+=3){var Kr=un(Qe[Jr],Qe[Jr+1],Nr,er,en,cn);if(Kr>Ft)ht=Jr,Ft=Kr;else if(Kr===Ft){var zr=Math.abs(Jr-It);zr<jt&&(ht=Jr,jt=zr)}}Ft>Dt&&(ht-Et>3&&Ct(Qe,Et,ht,Dt),Qe[ht+2]=Ft,Pt-ht>3&&Ct(Qe,ht,Pt,Dt))})(ne,0,le,ae),ne[le+2]=1,ne.size=Math.abs(be),ne.start=0,ne.end=ne.size}function Vn(Z,ne,ae,ye){for(var Oe=0;Oe<Z.length;Oe++){var fe=[];ri(Z[Oe],fe,ae,ye),ne.push(fe)}}function Tn(Z){return Z/360+.5}function Yn(Z){var ne=Math.sin(Z*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function zt(Z,ne,ae,ye,Oe,fe,be,oe){if(ye/=ne,fe>=(ae/=ne)&&be<ye)return Z;if(be<ae||fe>=ye)return null;for(var we=[],g=0;g<Z.length;g++){var le=Z[g],Ct=le.geometry,Qe=le.type,Et=Oe===0?le.minX:le.minY,Pt=Oe===0?le.maxX:le.maxY;if(Et>=ae&&Pt<ye)we.push(le);else if(!(Pt<ae||Et>=ye)){var Dt=[];if(Qe==="Point"||Qe==="MultiPoint")gr(Ct,Dt,ae,ye,Oe);else if(Qe==="LineString")Mr(Ct,Dt,ae,ye,Oe,!1,oe.lineMetrics);else if(Qe==="MultiLineString")_i(Ct,Dt,ae,ye,Oe,!1);else if(Qe==="Polygon")_i(Ct,Dt,ae,ye,Oe,!0);else if(Qe==="MultiPolygon")for(var ht=0;ht<Ct.length;ht++){var Ft=[];_i(Ct[ht],Ft,ae,ye,Oe,!0),Ft.length&&Dt.push(Ft)}if(Dt.length){if(oe.lineMetrics&&Qe==="LineString"){for(ht=0;ht<Dt.length;ht++)we.push(Rr(le.id,Qe,Dt[ht],le.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Dt.length===1?(Qe="LineString",Dt=Dt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Dt.length===3?"Point":"MultiPoint"),we.push(Rr(le.id,Qe,Dt,le.tags))}}}return we.length?we:null}function gr(Z,ne,ae,ye,Oe){for(var fe=0;fe<Z.length;fe+=3){var be=Z[fe+Oe];be>=ae&&be<=ye&&(ne.push(Z[fe]),ne.push(Z[fe+1]),ne.push(Z[fe+2]))}}function Mr(Z,ne,ae,ye,Oe,fe,be){for(var oe,we,g=nn(Z),le=Oe===0?kt:Jt,Ct=Z.start,Qe=0;Qe<Z.length-3;Qe+=3){var Et=Z[Qe],Pt=Z[Qe+1],Dt=Z[Qe+2],ht=Z[Qe+3],Ft=Z[Qe+4],It=Oe===0?Et:Pt,jt=Oe===0?ht:Ft,Nr=!1;be&&(oe=Math.sqrt(Math.pow(Et-ht,2)+Math.pow(Pt-Ft,2))),It<ae?jt>ae&&(we=le(g,Et,Pt,ht,Ft,ae),be&&(g.start=Ct+oe*we)):It>ye?jt<ye&&(we=le(g,Et,Pt,ht,Ft,ye),be&&(g.start=Ct+oe*we)):Se(g,Et,Pt,Dt),jt<ae&&It>=ae&&(we=le(g,Et,Pt,ht,Ft,ae),Nr=!0),jt>ye&&It<=ye&&(we=le(g,Et,Pt,ht,Ft,ye),Nr=!0),!fe&&Nr&&(be&&(g.end=Ct+oe*we),ne.push(g),g=nn(Z)),be&&(Ct+=oe)}var er=Z.length-3;Et=Z[er],Pt=Z[er+1],Dt=Z[er+2],(It=Oe===0?Et:Pt)>=ae&&It<=ye&&Se(g,Et,Pt,Dt),er=g.length-3,fe&&er>=3&&(g[er]!==g[0]||g[er+1]!==g[1])&&Se(g,g[0],g[1],g[2]),g.length&&ne.push(g)}function nn(Z){var ne=[];return ne.size=Z.size,ne.start=Z.start,ne.end=Z.end,ne}function _i(Z,ne,ae,ye,Oe,fe){for(var be=0;be<Z.length;be++)Mr(Z[be],ne,ae,ye,Oe,fe,!1)}function Se(Z,ne,ae,ye){Z.push(ne),Z.push(ae),Z.push(ye)}function kt(Z,ne,ae,ye,Oe,fe){var be=(fe-ne)/(ye-ne);return Z.push(fe),Z.push(ae+(Oe-ae)*be),Z.push(1),be}function Jt(Z,ne,ae,ye,Oe,fe){var be=(fe-ae)/(Oe-ae);return Z.push(ne+(ye-ne)*be),Z.push(fe),Z.push(1),be}function cr(Z,ne){for(var ae=[],ye=0;ye<Z.length;ye++){var Oe,fe=Z[ye],be=fe.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")Oe=qe(fe.geometry,ne);else if(be==="MultiLineString"||be==="Polygon"){Oe=[];for(var oe=0;oe<fe.geometry.length;oe++)Oe.push(qe(fe.geometry[oe],ne))}else if(be==="MultiPolygon")for(Oe=[],oe=0;oe<fe.geometry.length;oe++){for(var we=[],g=0;g<fe.geometry[oe].length;g++)we.push(qe(fe.geometry[oe][g],ne));Oe.push(we)}ae.push(Rr(fe.id,be,Oe,fe.tags))}return ae}function qe(Z,ne){var ae=[];ae.size=Z.size,Z.start!==void 0&&(ae.start=Z.start,ae.end=Z.end);for(var ye=0;ye<Z.length;ye+=3)ae.push(Z[ye]+ne,Z[ye+1],Z[ye+2]);return ae}function Lt(Z,ne){if(Z.transformed)return Z;var ae,ye,Oe,fe=1<<Z.z,be=Z.x,oe=Z.y;for(ae=0;ae<Z.features.length;ae++){var we=Z.features[ae],g=we.geometry,le=we.type;if(we.geometry=[],le===1)for(ye=0;ye<g.length;ye+=2)we.geometry.push(ge(g[ye],g[ye+1],ne,fe,be,oe));else for(ye=0;ye<g.length;ye++){var Ct=[];for(Oe=0;Oe<g[ye].length;Oe+=2)Ct.push(ge(g[ye][Oe],g[ye][Oe+1],ne,fe,be,oe));we.geometry.push(Ct)}}return Z.transformed=!0,Z}function ge(Z,ne,ae,ye,Oe,fe){return[Math.round(ae*(Z*ye-Oe)),Math.round(ae*(ne*ye-fe))]}function Gt(Z,ne,ae,ye,Oe){for(var fe=ne===Oe.maxZoom?0:Oe.tolerance/((1<<ne)*Oe.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:ye,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<Z.length;oe++){be.numFeatures++,wt(be,Z[oe],fe,Oe);var we=Z[oe].minX,g=Z[oe].minY,le=Z[oe].maxX,Ct=Z[oe].maxY;we<be.minX&&(be.minX=we),g<be.minY&&(be.minY=g),le>be.maxX&&(be.maxX=le),Ct>be.maxY&&(be.maxY=Ct)}return be}function wt(Z,ne,ae,ye){var Oe=ne.geometry,fe=ne.type,be=[];if(fe==="Point"||fe==="MultiPoint")for(var oe=0;oe<Oe.length;oe+=3)be.push(Oe[oe]),be.push(Oe[oe+1]),Z.numPoints++,Z.numSimplified++;else if(fe==="LineString")H(be,Oe,Z,ae,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(oe=0;oe<Oe.length;oe++)H(be,Oe[oe],Z,ae,fe==="Polygon",oe===0);else if(fe==="MultiPolygon")for(var we=0;we<Oe.length;we++){var g=Oe[we];for(oe=0;oe<g.length;oe++)H(be,g[oe],Z,ae,!0,oe===0)}if(be.length){var le=ne.tags||null;if(fe==="LineString"&&ye.lineMetrics){for(var Ct in le={},ne.tags)le[Ct]=ne.tags[Ct];le.mapbox_clip_start=Oe.start/Oe.size,le.mapbox_clip_end=Oe.end/Oe.size}var Qe={geometry:be,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:le};ne.id!==null&&(Qe.id=ne.id),Z.features.push(Qe)}}function H(Z,ne,ae,ye,Oe,fe){var be=ye*ye;if(ye>0&&ne.size<(Oe?be:ye))ae.numPoints+=ne.length/3;else{for(var oe=[],we=0;we<ne.length;we+=3)(ye===0||ne[we+2]>be)&&(ae.numSimplified++,oe.push(ne[we]),oe.push(ne[we+1])),ae.numPoints++;Oe&&(function(g,le){for(var Ct=0,Qe=0,Et=g.length,Pt=Et-2;Qe<Et;Pt=Qe,Qe+=2)Ct+=(g[Qe]-g[Pt])*(g[Qe+1]+g[Pt+1]);if(Ct>0===le)for(Qe=0,Et=g.length;Qe<Et/2;Qe+=2){var Dt=g[Qe],ht=g[Qe+1];g[Qe]=g[Et-2-Qe],g[Qe+1]=g[Et-1-Qe],g[Et-2-Qe]=Dt,g[Et-1-Qe]=ht}})(oe,fe),Z.push(oe)}}function yt(Z,ne){var ae=(ne=this.options=(function(Oe,fe){for(var be in fe)Oe[be]=fe[be];return Oe})(Object.create(this.options),ne)).debug;if(ae&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=(function(Oe,fe){var be=[];if(Oe.type==="FeatureCollection")for(var oe=0;oe<Oe.features.length;oe++)qn(be,Oe.features[oe],fe,oe);else qn(be,Oe.type==="Feature"?Oe:{geometry:Oe},fe);return be})(Z,ne);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=(function(Oe,fe){var be=fe.buffer/fe.extent,oe=Oe,we=zt(Oe,1,-1-be,be,0,-1,2,fe),g=zt(Oe,1,1-be,2+be,0,-1,2,fe);return(we||g)&&(oe=zt(Oe,1,-be,1+be,0,-1,2,fe)||[],we&&(oe=cr(we,1).concat(oe)),g&&(oe=oe.concat(cr(g,-1)))),oe})(ye,ne)).length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Bt(Z,ne,ae){return 32*((1<<Z)*ae+ne)+Z}function xe(Z,ne){var ae=Z.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);var ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return ne(null,null);var Oe=new pe(ye.features),fe=ce(Oe);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),ne(null,{vectorTile:Oe,rawData:fe.buffer})}Qt.prototype.load=function(Z){var ne=this.options,ae=ne.log,ye=ne.minZoom,Oe=ne.maxZoom,fe=ne.nodeSize;ae&&console.time("total time");var be="prepare "+Z.length+" points";ae&&console.time(be),this.points=Z;for(var oe=[],we=0;we<Z.length;we++)Z[we].geometry&&oe.push(Ht(Z[we],we));this.trees[Oe+1]=new st(oe,_r,yr,fe,Float32Array),ae&&console.timeEnd(be);for(var g=Oe;g>=ye;g--){var le=+Date.now();oe=this._cluster(oe,g),this.trees[g]=new st(oe,_r,yr,fe,Float32Array),ae&&console.log("z%d: %d clusters in %dms",g,oe.length,+Date.now()-le)}return ae&&console.timeEnd("total time"),this},Qt.prototype.getClusters=function(Z,ne){var ae=((Z[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,Z[1])),Oe=Z[2]===180?180:((Z[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ae=-180,Oe=180;else if(ae>Oe){var be=this.getClusters([ae,ye,180,fe],ne),oe=this.getClusters([-180,ye,Oe,fe],ne);return be.concat(oe)}for(var we=this.trees[this._limitZoom(ne)],g=[],le=0,Ct=we.range(Lr(ae),vr(fe),Lr(Oe),vr(ye));le<Ct.length;le+=1){var Qe=we.points[Ct[le]];g.push(Qe.numPoints?dr(Qe):this.points[Qe.index])}return g},Qt.prototype.getChildren=function(Z){var ne=this._getOriginId(Z),ae=this._getOriginZoom(Z),ye="No cluster with the specified id.",Oe=this.trees[ae];if(!Oe)throw new Error(ye);var fe=Oe.points[ne];if(!fe)throw new Error(ye);for(var be=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),oe=[],we=0,g=Oe.within(fe.x,fe.y,be);we<g.length;we+=1){var le=Oe.points[g[we]];le.parentId===Z&&oe.push(le.numPoints?dr(le):this.points[le.index])}if(oe.length===0)throw new Error(ye);return oe},Qt.prototype.getLeaves=function(Z,ne,ae){var ye=[];return this._appendLeaves(ye,Z,ne=ne||10,ae=ae||0,0),ye},Qt.prototype.getTile=function(Z,ne,ae){var ye=this.trees[this._limitZoom(Z)],Oe=Math.pow(2,Z),fe=this.options,be=fe.radius/fe.extent,oe=(ae-be)/Oe,we=(ae+1+be)/Oe,g={features:[]};return this._addTileFeatures(ye.range((ne-be)/Oe,oe,(ne+1+be)/Oe,we),ye.points,ne,ae,Oe,g),ne===0&&this._addTileFeatures(ye.range(1-be/Oe,oe,1,we),ye.points,Oe,ae,Oe,g),ne===Oe-1&&this._addTileFeatures(ye.range(0,oe,be/Oe,we),ye.points,-1,ae,Oe,g),g.features.length?g:null},Qt.prototype.getClusterExpansionZoom=function(Z){for(var ne=this._getOriginZoom(Z)-1;ne<=this.options.maxZoom;){var ae=this.getChildren(Z);if(ne++,ae.length!==1)break;Z=ae[0].properties.cluster_id}return ne},Qt.prototype._appendLeaves=function(Z,ne,ae,ye,Oe){for(var fe=0,be=this.getChildren(ne);fe<be.length;fe+=1){var oe=be[fe],we=oe.properties;if(we&&we.cluster?Oe+we.point_count<=ye?Oe+=we.point_count:Oe=this._appendLeaves(Z,we.cluster_id,ae,ye,Oe):Oe<ye?Oe++:Z.push(oe),Z.length===ae)break}return Oe},Qt.prototype._addTileFeatures=function(Z,ne,ae,ye,Oe,fe){for(var be=0,oe=Z;be<oe.length;be+=1){var we=ne[oe[be]],g=we.numPoints,le={type:1,geometry:[[Math.round(this.options.extent*(we.x*Oe-ae)),Math.round(this.options.extent*(we.y*Oe-ye))]],tags:g?ln(we):this.points[we.index].properties},Ct=void 0;g?Ct=we.id:this.options.generateId?Ct=we.index:this.points[we.index].id&&(Ct=this.points[we.index].id),Ct!==void 0&&(le.id=Ct),fe.features.push(le)}},Qt.prototype._limitZoom=function(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))},Qt.prototype._cluster=function(Z,ne){for(var ae=[],ye=this.options,Oe=ye.reduce,fe=ye.minPoints,be=ye.radius/(ye.extent*Math.pow(2,ne)),oe=0;oe<Z.length;oe++){var we=Z[oe];if(!(we.zoom<=ne)){we.zoom=ne;for(var g=this.trees[ne+1],le=g.within(we.x,we.y,be),Ct=we.numPoints||1,Qe=Ct,Et=0,Pt=le;Et<Pt.length;Et+=1){var Dt=g.points[Pt[Et]];Dt.zoom>ne&&(Qe+=Dt.numPoints||1)}if(Qe>=fe){for(var ht=we.x*Ct,Ft=we.y*Ct,It=Oe&&Ct>1?this._map(we,!0):null,jt=(oe<<5)+(ne+1)+this.points.length,Nr=0,er=le;Nr<er.length;Nr+=1){var en=g.points[er[Nr]];if(!(en.zoom<=ne)){en.zoom=ne;var cn=en.numPoints||1;ht+=en.x*cn,Ft+=en.y*cn,en.parentId=jt,Oe&&(It||(It=this._map(we,!0)),Oe(It,this._map(en)))}}we.parentId=jt,ae.push(Zt(ht/Qe,Ft/Qe,jt,Qe,It))}else if(ae.push(we),Qe>1)for(var Jr=0,Kr=le;Jr<Kr.length;Jr+=1){var zr=g.points[Kr[Jr]];zr.zoom<=ne||(zr.zoom=ne,ae.push(zr))}}}return ae},Qt.prototype._getOriginId=function(Z){return Z-this.points.length>>5},Qt.prototype._getOriginZoom=function(Z){return(Z-this.points.length)%32},Qt.prototype._map=function(Z,ne){if(Z.numPoints)return ne?Hn({},Z.properties):Z.properties;var ae=this.points[Z.index].properties,ye=this.options.map(ae);return ne&&ye===ae?Hn({},ye):ye},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(Z,ne,ae,ye,Oe,fe,be){for(var oe=[Z,ne,ae,ye],we=this.options,g=we.debug;oe.length;){ye=oe.pop(),ae=oe.pop(),ne=oe.pop(),Z=oe.pop();var le=1<<ne,Ct=Bt(ne,ae,ye),Qe=this.tiles[Ct];if(!Qe&&(g>1&&console.time("creation"),Qe=this.tiles[Ct]=Gt(Z,ne,ae,ye,we),this.tileCoords.push({z:ne,x:ae,y:ye}),g)){g>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ae,ye,Qe.numFeatures,Qe.numPoints,Qe.numSimplified),console.timeEnd("creation"));var Et="z"+ne;this.stats[Et]=(this.stats[Et]||0)+1,this.total++}if(Qe.source=Z,Oe){if(ne===we.maxZoom||ne===Oe)continue;var Pt=1<<Oe-ne;if(ae!==Math.floor(fe/Pt)||ye!==Math.floor(be/Pt))continue}else if(ne===we.indexMaxZoom||Qe.numPoints<=we.indexMaxPoints)continue;if(Qe.source=null,Z.length!==0){g>1&&console.time("clipping");var Dt,ht,Ft,It,jt,Nr,er=.5*we.buffer/we.extent,en=.5-er,cn=.5+er,Jr=1+er;Dt=ht=Ft=It=null,jt=zt(Z,le,ae-er,ae+cn,0,Qe.minX,Qe.maxX,we),Nr=zt(Z,le,ae+en,ae+Jr,0,Qe.minX,Qe.maxX,we),Z=null,jt&&(Dt=zt(jt,le,ye-er,ye+cn,1,Qe.minY,Qe.maxY,we),ht=zt(jt,le,ye+en,ye+Jr,1,Qe.minY,Qe.maxY,we),jt=null),Nr&&(Ft=zt(Nr,le,ye-er,ye+cn,1,Qe.minY,Qe.maxY,we),It=zt(Nr,le,ye+en,ye+Jr,1,Qe.minY,Qe.maxY,we),Nr=null),g>1&&console.timeEnd("clipping"),oe.push(Dt||[],ne+1,2*ae,2*ye),oe.push(ht||[],ne+1,2*ae,2*ye+1),oe.push(Ft||[],ne+1,2*ae+1,2*ye),oe.push(It||[],ne+1,2*ae+1,2*ye+1)}}},yt.prototype.getTile=function(Z,ne,ae){var ye=this.options,Oe=ye.extent,fe=ye.debug;if(Z<0||Z>24)return null;var be=1<<Z,oe=Bt(Z,ne=(ne%be+be)%be,ae);if(this.tiles[oe])return Lt(this.tiles[oe],Oe);fe>1&&console.log("drilling down to z%d-%d-%d",Z,ne,ae);for(var we,g=Z,le=ne,Ct=ae;!we&&g>0;)g--,le=Math.floor(le/2),Ct=Math.floor(Ct/2),we=this.tiles[Bt(g,le,Ct)];return we&&we.source?(fe>1&&console.log("found parent tile z%d-%d-%d",g,le,Ct),fe>1&&console.time("drilling down"),this.splitTile(we.source,g,le,Ct,Z,ne,ae),fe>1&&console.timeEnd("drilling down"),this.tiles[oe]?Lt(this.tiles[oe],Oe):null):null};var Ke=(function(Z){function ne(ae,ye,Oe,fe){Z.call(this,ae,ye,Oe,xe),fe&&(this.loadGeoJSON=fe)}return Z&&(ne.__proto__=Z),(ne.prototype=Object.create(Z&&Z.prototype)).constructor=ne,ne.prototype.loadData=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=ae,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ne.prototype._loadData=function(){var ae=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,Oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var fe=!!(Oe&&Oe.request&&Oe.request.collectResourceTiming)&&new s.RequestPerformance(Oe.request);this.loadGeoJSON(Oe,function(be,oe){if(be||!oe)return ye(be);if(typeof oe!="object")return ye(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));(function Qe(Et,Pt){var Dt,ht=Et&&Et.type;if(ht==="FeatureCollection")for(Dt=0;Dt<Et.features.length;Dt++)Qe(Et.features[Dt],Pt);else if(ht==="GeometryCollection")for(Dt=0;Dt<Et.geometries.length;Dt++)Qe(Et.geometries[Dt],Pt);else if(ht==="Feature")Qe(Et.geometry,Pt);else if(ht==="Polygon")j(Et.coordinates,Pt);else if(ht==="MultiPolygon")for(Dt=0;Dt<Et.coordinates.length;Dt++)j(Et.coordinates[Dt],Pt);return Et})(oe,!0);try{if(Oe.filter){var we=s.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(function(Qe){return Qe.key+": "+Qe.message}).join(", "));var g=oe.features.filter(function(Qe){return we.value.evaluate({zoom:0},Qe)});oe={type:"FeatureCollection",features:g}}ae._geoJSONIndex=Oe.cluster?new Qt((function(Qe){var Et=Qe.superclusterOptions,Pt=Qe.clusterProperties;if(!Pt||!Et)return Et;for(var Dt={},ht={},Ft={accumulated:null,zoom:0},It={properties:null},jt=Object.keys(Pt),Nr=0,er=jt;Nr<er.length;Nr+=1){var en=er[Nr],cn=Pt[en],Jr=cn[0],Kr=s.createExpression(cn[1]),zr=s.createExpression(typeof Jr=="string"?[Jr,["accumulated"],["get",en]]:Jr);Dt[en]=Kr.value,ht[en]=zr.value}return Et.map=function(yi){It.properties=yi;for(var Xr={},mr=0,Be=jt;mr<Be.length;mr+=1){var Xt=Be[mr];Xr[Xt]=Dt[Xt].evaluate(Ft,It)}return Xr},Et.reduce=function(yi,Xr){It.properties=Xr;for(var mr=0,Be=jt;mr<Be.length;mr+=1){var Xt=Be[mr];Ft.accumulated=yi[Xt],yi[Xt]=ht[Xt].evaluate(Ft,It)}},Et})(Oe)).load(oe.features):(function(Qe,Et){return new yt(Qe,Et)})(oe,Oe.geojsonVtOptions)}catch(Qe){return ye(Qe)}ae.loaded={};var le={};if(fe){var Ct=fe.finish();Ct&&(le.resourceTiming={},le.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(Ct)))}ye(null,le)})}},ne.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ne.prototype.reloadTile=function(ae,ye){var Oe=this.loaded;return Oe&&Oe[ae.uid]?Z.prototype.reloadTile.call(this,ae,ye):this.loadTile(ae,ye)},ne.prototype.loadGeoJSON=function(ae,ye){if(ae.request)s.getJSON(ae.request,ye);else{if(typeof ae.data!="string")return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(ae.data))}catch{return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."))}}},ne.prototype.removeSource=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},ne.prototype.getClusterExpansionZoom=function(ae,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Oe){ye(Oe)}},ne.prototype.getClusterChildren=function(ae,ye){try{ye(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Oe){ye(Oe)}},ne.prototype.getClusterLeaves=function(ae,ye){try{ye(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Oe){ye(Oe)}},ne})(N),lt=function(Z){var ne=this;this.self=Z,this.actor=new s.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:N,geojson:Ke},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ae,ye){if(ne.workerSourceTypes[ae])throw new Error('Worker source with name "'+ae+'" already registered.');ne.workerSourceTypes[ae]=ye},this.self.registerRTLTextPlugin=function(ae){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ae.applyArabicShaping,s.plugin.processBidirectionalText=ae.processBidirectionalText,s.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}};return lt.prototype.setReferrer=function(Z,ne){this.referrer=ne},lt.prototype.setImages=function(Z,ne,ae){for(var ye in this.availableImages[Z]=ne,this.workerSources[Z]){var Oe=this.workerSources[Z][ye];for(var fe in Oe)Oe[fe].availableImages=ne}ae()},lt.prototype.setLayers=function(Z,ne,ae){this.getLayerIndex(Z).replace(ne),ae()},lt.prototype.updateLayers=function(Z,ne,ae){this.getLayerIndex(Z).update(ne.layers,ne.removedIds),ae()},lt.prototype.loadTile=function(Z,ne,ae){this.getWorkerSource(Z,ne.type,ne.source).loadTile(ne,ae)},lt.prototype.loadDEMTile=function(Z,ne,ae){this.getDEMWorkerSource(Z,ne.source).loadTile(ne,ae)},lt.prototype.reloadTile=function(Z,ne,ae){this.getWorkerSource(Z,ne.type,ne.source).reloadTile(ne,ae)},lt.prototype.abortTile=function(Z,ne,ae){this.getWorkerSource(Z,ne.type,ne.source).abortTile(ne,ae)},lt.prototype.removeTile=function(Z,ne,ae){this.getWorkerSource(Z,ne.type,ne.source).removeTile(ne,ae)},lt.prototype.removeDEMTile=function(Z,ne){this.getDEMWorkerSource(Z,ne.source).removeTile(ne)},lt.prototype.removeSource=function(Z,ne,ae){if(this.workerSources[Z]&&this.workerSources[Z][ne.type]&&this.workerSources[Z][ne.type][ne.source]){var ye=this.workerSources[Z][ne.type][ne.source];delete this.workerSources[Z][ne.type][ne.source],ye.removeSource!==void 0?ye.removeSource(ne,ae):ae()}},lt.prototype.loadWorkerSource=function(Z,ne,ae){try{this.self.importScripts(ne.url),ae()}catch(ye){ae(ye.toString())}},lt.prototype.syncRTLPluginState=function(Z,ne,ae){try{s.plugin.setState(ne);var ye=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var Oe=s.plugin.isParsed();ae(Oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),Oe)}}catch(fe){ae(fe.toString())}},lt.prototype.getAvailableImages=function(Z){var ne=this.availableImages[Z];return ne||(ne=[]),ne},lt.prototype.getLayerIndex=function(Z){var ne=this.layerIndexes[Z];return ne||(ne=this.layerIndexes[Z]=new A),ne},lt.prototype.getWorkerSource=function(Z,ne,ae){var ye=this;return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][ne]||(this.workerSources[Z][ne]={}),this.workerSources[Z][ne][ae]||(this.workerSources[Z][ne][ae]=new this.workerSourceTypes[ne]({send:function(Oe,fe,be){ye.actor.send(Oe,fe,be,Z)}},this.getLayerIndex(Z),this.getAvailableImages(Z))),this.workerSources[Z][ne][ae]},lt.prototype.getDEMWorkerSource=function(Z,ne){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][ne]||(this.demWorkerSources[Z][ne]=new V),this.demWorkerSources[Z][ne]},lt.prototype.enforceCacheSizeLimit=function(Z,ne){s.enforceCacheSizeLimit(ne)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new lt(self)),lt}),o(["./shared"],function(s){var l=s.createCommonjsModule(function(c){function d(E){return!f(E)}function f(E){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var L,F,G=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(G);try{F=new Worker(W),L=!0}catch{L=!1}return F&&F.terminate(),URL.revokeObjectURL(W),L})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var L=document.createElement("canvas");L.width=L.height=1;var F=L.getContext("2d");if(!F)return!1;var G=F.getImageData(0,0,1,1);return G&&G.width===L.width})()?(m[P=E&&E.failIfMajorPerformanceCaveat]===void 0&&(m[P]=(function(L){var F=(function(W){var te=document.createElement("canvas"),$=Object.create(d.webGLContextAttributes);return $.failIfMajorPerformanceCaveat=W,te.probablySupportsContext?te.probablySupportsContext("webgl",$)||te.probablySupportsContext("experimental-webgl",$):te.supportsContext?te.supportsContext("webgl",$)||te.supportsContext("experimental-webgl",$):te.getContext("webgl",$)||te.getContext("experimental-webgl",$)})(L);if(!F)return!1;var G=F.createShader(F.VERTEX_SHADER);return!(!G||F.isContextLost())&&(F.shaderSource(G,"void main() {}"),F.compileShader(G),F.getShaderParameter(G,F.COMPILE_STATUS)===!0)})(P)),m[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}c.exports?c.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=f);var m={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),h={create:function(c,d,f){var m=s.window.document.createElement(c);return d!==void 0&&(m.className=d),f&&f.appendChild(m),m},createNS:function(c,d){return s.window.document.createElementNS(c,d)}},A=s.window.document&&s.window.document.documentElement.style;function b(c){if(!A)return c[0];for(var d=0;d<c.length;d++)if(c[d]in A)return c[d];return c[0]}var C,S=b(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);h.disableDrag=function(){A&&S&&(C=A[S],A[S]="none")},h.enableDrag=function(){A&&S&&(A[S]=C)};var D=b(["transform","WebkitTransform"]);h.setTransform=function(c,d){c.style[D]=d};var N=!1;try{var U=Object.defineProperty({},"passive",{get:function(){N=!0}});s.window.addEventListener("test",U,U),s.window.removeEventListener("test",U,U)}catch{N=!1}h.addEventListener=function(c,d,f,m){m===void 0&&(m={}),c.addEventListener(d,f,"passive"in m&&N?m:m.capture)},h.removeEventListener=function(c,d,f,m){m===void 0&&(m={}),c.removeEventListener(d,f,"passive"in m&&N?m:m.capture)};var V=function(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",V,!0)};function j(c){var d=c.userImage;return!!(d&&d.render&&d.render())&&(c.data.replace(new Uint8Array(d.data.buffer)),!0)}h.suppressClick=function(){s.window.addEventListener("click",V,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",V,!0)},0)},h.mousePos=function(c,d){var f=c.getBoundingClientRect();return new s.Point(d.clientX-f.left-c.clientLeft,d.clientY-f.top-c.clientTop)},h.touchPos=function(c,d){for(var f=c.getBoundingClientRect(),m=[],E=0;E<d.length;E++)m.push(new s.Point(d[E].clientX-f.left-c.clientLeft,d[E].clientY-f.top-c.clientTop));return m},h.mouseButton=function(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},h.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var ee=(function(c){function d(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,E=this.requestors;m<E.length;m+=1){var P=E[m];this._notify(P.ids,P.callback)}this.requestors=[]}},d.prototype.getImage=function(f){return this.images[f]},d.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},d.prototype._validate=function(f,m){var E=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),E=!1),this._validateContent(m.content,m)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),E=!1),E},d.prototype._validateStretch=function(f,m){if(!f)return!0;for(var E=0,P=0,L=f;P<L.length;P+=1){var F=L[P];if(F[0]<E||F[1]<F[0]||m<F[1])return!1;E=F[1]}return!0},d.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},d.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},d.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(f,m){var E=!0;if(!this.isLoaded())for(var P=0,L=f;P<L.length;P+=1)this.images[L[P]]||(E=!1);this.isLoaded()||E?this._notify(f,m):this.requestors.push({ids:f,callback:m})},d.prototype._notify=function(f,m){for(var E={},P=0,L=f;P<L.length;P+=1){var F=L[P];this.images[F]||this.fire(new s.Event("styleimagemissing",{id:F}));var G=this.images[F];G?E[F]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:s.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,E)},d.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},d.prototype.getPattern=function(f){var m=this.patterns[f],E=this.getImage(f);if(!E)return null;if(m&&m.position.version===E.version)return m.position;if(m)m.position.version=E.version;else{var P={w:E.data.width+2,h:E.data.height+2,x:0,y:0},L=new s.ImagePosition(P,E);this.patterns[f]={bin:P,position:L}}return this._updatePatternAtlas(),this.patterns[f].position},d.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var E=s.potpack(f),P=E.w,L=E.h,F=this.atlasImage;for(var G in F.resize({width:P||1,height:L||1}),this.patterns){var W=this.patterns[G].bin,te=W.x+1,$=W.y+1,re=this.images[G].data,se=re.width,ve=re.height;s.RGBAImage.copy(re,F,{x:0,y:0},{x:te,y:$},{width:se,height:ve}),s.RGBAImage.copy(re,F,{x:0,y:ve-1},{x:te,y:$-1},{width:se,height:1}),s.RGBAImage.copy(re,F,{x:0,y:0},{x:te,y:$+ve},{width:se,height:1}),s.RGBAImage.copy(re,F,{x:se-1,y:0},{x:te-1,y:$},{width:1,height:ve}),s.RGBAImage.copy(re,F,{x:0,y:0},{x:te+se,y:$},{width:1,height:ve})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(f){for(var m=0,E=f;m<E.length;m+=1){var P=E[m];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var L=this.images[P];j(L)&&this.updateImage(P,L)}}},d})(s.Evented),Q=Y,X=Y,pe=1e20;function Y(c,d,f,m,E,P){this.fontSize=c||24,this.buffer=d===void 0?3:d,this.cutoff=m||.25,this.fontFamily=E||"sans-serif",this.fontWeight=P||"normal",this.radius=f||8;var L=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=L,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.d=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Int16Array(L),this.middle=Math.round(L/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ge(c,d,f,m,E,P,L){for(var F=0;F<d;F++){for(var G=0;G<f;G++)m[G]=c[G*d+F];for(ze(m,E,P,L,f),G=0;G<f;G++)c[G*d+F]=E[G]}for(G=0;G<f;G++){for(F=0;F<d;F++)m[F]=c[G*d+F];for(ze(m,E,P,L,d),F=0;F<d;F++)c[G*d+F]=Math.sqrt(E[F])}}function ze(c,d,f,m,E){f[0]=0,m[0]=-pe,m[1]=+pe;for(var P=1,L=0;P<E;P++){for(var F=(c[P]+P*P-(c[f[L]]+f[L]*f[L]))/(2*P-2*f[L]);F<=m[L];)L--,F=(c[P]+P*P-(c[f[L]]+f[L]*f[L]))/(2*P-2*f[L]);f[++L]=P,m[L]=F,m[L+1]=+pe}for(P=0,L=0;P<E;P++){for(;m[L+1]<P;)L++;d[P]=(P-f[L])*(P-f[L])+c[f[L]]}}Y.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var E=d.data[4*m+3]/255;this.gridOuter[m]=E===1?0:E===0?pe:Math.pow(Math.max(0,.5-E),2),this.gridInner[m]=E===1?pe:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Ge(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ge(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},Q.default=X;var de=function(c,d){this.requestManager=c,this.localIdeographFontFamily=d,this.entries={}};de.prototype.setURL=function(c){this.url=c},de.prototype.getGlyphs=function(c,d){var f=this,m=[];for(var E in c)for(var P=0,L=c[E];P<L.length;P+=1)m.push({stack:E,id:L[P]});s.asyncAll(m,function(F,G){var W=F.stack,te=F.id,$=f.entries[W];$||($=f.entries[W]={glyphs:{},requests:{},ranges:{}});var re=$.glyphs[te];if(re===void 0){if(re=f._tinySDF($,W,te))return $.glyphs[te]=re,void G(null,{stack:W,id:te,glyph:re});var se=Math.floor(te/256);if(256*se>65535)G(new Error("glyphs > 65535 not supported"));else if($.ranges[se])G(null,{stack:W,id:te,glyph:re});else{var ve=$.requests[se];ve||(ve=$.requests[se]=[],de.loadGlyphRange(W,se,f.url,f.requestManager,function(Pe,me){if(me){for(var Ie in me)f._doesCharSupportLocalGlyph(+Ie)||($.glyphs[+Ie]=me[+Ie]);$.ranges[se]=!0}for(var He=0,Je=ve;He<Je.length;He+=1)(0,Je[He])(Pe,me);delete $.requests[se]})),ve.push(function(Pe,me){Pe?G(Pe):me&&G(null,{stack:W,id:te,glyph:me[te]||null})})}}else G(null,{stack:W,id:te,glyph:re})},function(F,G){if(F)d(F);else if(G){for(var W={},te=0,$=G;te<$.length;te+=1){var re=$[te],se=re.stack,ve=re.id,Pe=re.glyph;(W[se]||(W[se]={}))[ve]=Pe&&{id:Pe.id,bitmap:Pe.bitmap.clone(),metrics:Pe.metrics}}d(null,W)}})},de.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](c)||s.isChar["Hangul Syllables"](c)||s.isChar.Hiragana(c)||s.isChar.Katakana(c))},de.prototype._tinySDF=function(c,d,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var E=c.tinySDF;if(!E){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),E=c.tinySDF=new de.TinySDF(24,3,8,.25,m,P)}return{id:f,bitmap:new s.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},de.loadGlyphRange=function(c,d,f,m,E){var P=256*d,L=P+255,F=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",P+"-"+L),s.ResourceType.Glyphs);s.getArrayBuffer(F,function(G,W){if(G)E(G);else if(W){for(var te={},$=0,re=s.parseGlyphPBF(W);$<re.length;$+=1){var se=re[$];te[se.id]=se}E(null,te)}})},de.TinySDF=Q;var ce=function(){this.specification=s.styleSpec.light.position};ce.prototype.possiblyEvaluate=function(c,d){return s.sphericalToCartesian(c.expression.evaluate(d))},ce.prototype.interpolate=function(c,d,f){return{x:s.number(c.x,d.x,f),y:s.number(c.y,d.y,f),z:s.number(c.z,d.z,f)}};var De=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new ce,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),J=(function(c){function d(f){c.call(this),this._transitionable=new s.Transitionable(De),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(s.validateLight,f,m))for(var E in f){var P=f[E];s.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),P):this._transitionable.setValue(E,P)}},d.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},d.prototype._validate=function(f,m,E){return(!E||E.validate!==!1)&&s.emitValidationErrors(this,f.call(s.validateStyle,s.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},d})(s.Evented),ue=function(c,d){this.width=c,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ue.prototype.getDash=function(c,d){var f=c.join(",")+String(d);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,d)),this.dashEntry[f]},ue.prototype.getDashRanges=function(c,d,f){var m=[],E=c.length%2==1?-c[c.length-1]*f:0,P=c[0]*f,L=!0;m.push({left:E,right:P,isDash:L,zeroLength:c[0]===0});for(var F=c[0],G=1;G<c.length;G++){var W=c[G];m.push({left:E=F*f,right:P=(F+=W)*f,isDash:L=!L,zeroLength:W===0})}return m},ue.prototype.addRoundDash=function(c,d,f){for(var m=d/2,E=-f;E<=f;E++)for(var P=this.width*(this.nextRow+f+E),L=0,F=c[L],G=0;G<this.width;G++){G/F.right>1&&(F=c[++L]);var W=Math.abs(G-F.left),te=Math.abs(G-F.right),$=Math.min(W,te),re=void 0,se=E/f*(m+1);if(F.isDash){var ve=m-Math.abs(se);re=Math.sqrt($*$+ve*ve)}else re=m-Math.sqrt($*$+se*se);this.data[P+G]=Math.max(0,Math.min(255,re+128))}},ue.prototype.addRegularDash=function(c){for(var d=c.length-1;d>=0;--d){var f=c[d],m=c[d+1];f.zeroLength?c.splice(d,1):m&&m.isDash===f.isDash&&(m.left=f.left,c.splice(d,1))}var E=c[0],P=c[c.length-1];E.isDash===P.isDash&&(E.left=P.left-this.width,P.right=E.right+this.width);for(var L=this.width*this.nextRow,F=0,G=c[F],W=0;W<this.width;W++){W/G.right>1&&(G=c[++F]);var te=Math.abs(W-G.left),$=Math.abs(W-G.right),re=Math.min(te,$);this.data[L+W]=Math.max(0,Math.min(255,(G.isDash?re:-re)+128))}},ue.prototype.addDash=function(c,d){var f=d?7:0,m=2*f+1;if(this.nextRow+m>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var E=0,P=0;P<c.length;P++)E+=c[P];if(E!==0){var L=this.width/E,F=this.getDashRanges(c,this.width,L);d?this.addRoundDash(F,L,f):this.addRegularDash(F)}var G={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:E};return this.nextRow+=m,this.dirty=!0,G},ue.prototype.bind=function(c){var d=c.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Ee=function c(d,f){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var m=this.workerPool.acquire(this.id),E=0;E<m.length;E++){var P=new c.Actor(m[E],f,this.id);P.name="Worker "+E,this.actors.push(P)}};function ct(c,d,f){var m=function(E,P){if(E)return f(E);if(P){var L=s.pick(s.extend(P,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(L.vectorLayers=P.vector_layers,L.vectorLayerIds=L.vectorLayers.map(function(F){return F.id})),L.tiles=d.canonicalizeTileset(L,c.url),f(null,L)}};return c.url?s.getJSON(d.transformRequest(d.normalizeSourceURL(c.url),s.ResourceType.Source),m):s.browser.frame(function(){return m(null,c)})}Ee.prototype.broadcast=function(c,d,f){s.asyncAll(this.actors,function(m,E){m.send(c,d,E)},f=f||function(){})},Ee.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ee.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Ee.Actor=s.Actor;var Ce=function(c,d,f){this.bounds=s.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=f||24};Ce.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},Ce.prototype.contains=function(c){var d=Math.pow(2,c.z),f=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*d),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=f&&c.x<E&&c.y>=m&&c.y<P};var Le=(function(c){function d(f,m,E,P){if(c.call(this),this.id=f,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(m,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ct(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new s.ErrorEvent(m)):E&&(s.extend(f,E),E.bounds&&(f.tileBounds=new Ce(E.bounds,f.minzoom,f.maxzoom)),s.postTurnstileEvent(E.tiles,f.map._requestManager._customAccessToken),s.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},d.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(E,s.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function L(F,G){return delete f.request,f.aborted?m(null):F&&F.status!==404?m(F):(G&&G.resourceTiming&&(f.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&f.setExpiryData(G),f.loadVectorData(G,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",P,L.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",P,L.bind(this)))},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d})(s.Evented),Ne=(function(c){function d(f,m,E,P){c.call(this),this.id=f,this.dispatcher=E,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},m),s.extend(this,s.pick(m,["url","scheme","tileSize"]))}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ct(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new s.ErrorEvent(m)):E&&(s.extend(f,E),E.bounds&&(f.tileBounds=new Ce(E.bounds,f.minzoom,f.maxzoom)),s.postTurnstileEvent(E.tiles),s.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return s.extend({},this._options)},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.loadTile=function(f,m){var E=this,P=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=s.getImage(this.map._requestManager.transformRequest(P,s.ResourceType.Tile),function(L,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(L)f.state="errored",m(L);else if(F){E.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var G=E.map.painter.context,W=G.gl;f.texture=E.map.painter.getTileTexture(F.width),f.texture?f.texture.update(F,{useMipmap:!0}):(f.texture=new s.Texture(G,F,W.RGBA,{useMipmap:!0}),f.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),f.state="loaded",s.cacheEntryPossiblyAdded(E.dispatcher),m(null)}})},d.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},d.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},d.prototype.hasTransition=function(){return!1},d})(s.Evented),$e=(function(c){function d(f,m,E,P){c.call(this,f,m,E,P),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(L,F){L&&(f.state="errored",m(L)),F&&(f.dem=F,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=s.getImage(this.map._requestManager.transformRequest(E,s.ResourceType.Tile),(function(L,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(L)f.state="errored",m(L);else if(F){this.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var G=s.window.ImageBitmap&&F instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?F:s.browser.getImageData(F,1),W={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:G,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",W,P.bind(this)))}}).bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},d.prototype._getNeighboringTiles=function(f){var m=f.canonical,E=Math.pow(2,m.z),P=(m.x-1+E)%E,L=m.x===0?f.wrap-1:f.wrap,F=(m.x+1+E)%E,G=m.x+1===E?f.wrap+1:f.wrap,W={};return W[new s.OverscaledTileID(f.overscaledZ,L,m.z,P,m.y).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,G,m.z,F,m.y).key]={backfilled:!1},m.y>0&&(W[new s.OverscaledTileID(f.overscaledZ,L,m.z,P,m.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,G,m.z,F,m.y-1).key]={backfilled:!1}),m.y+1<E&&(W[new s.OverscaledTileID(f.overscaledZ,L,m.z,P,m.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,G,m.z,F,m.y+1).key]={backfilled:!1}),W},d.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},d})(Ne),it=(function(c){function d(f,m,E,P){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(P),this._data=m.data,this._options=s.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var L=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*L,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*L,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:s.EXTENT,radius:(m.clusterRadius||50)*L,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new s.ErrorEvent(m));else{var E={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(E.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new s.Event("data",E))}})},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)m.fire(new s.ErrorEvent(E));else{var P={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(P.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new s.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},d.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},d.prototype.getClusterLeaves=function(f,m,E,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:E},P),this},d.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var E=s.extend({},this.workerOptions),P=this._data;typeof P=="string"?(E.request=this.map._requestManager.transformRequest(s.browser.resolveURL(P),s.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(P),this.actor.send(this.type+".loadData",E,function(L,F){m._removed||F&&F.abandoned||(m._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[m.id]&&(m._resourceTiming=F.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:E.source},null),f(L))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(f,m){var E=this,P=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(P,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(L,F){return delete f.request,f.unloadVectorData(),f.aborted?m(null):L?m(L):(f.loadVectorData(F,E.map.painter,P==="reloadTile"),m(null))})},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},d.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d})(s.Evented),ot=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dt=(function(c){function d(f,m,E,P){c.call(this),this.id=f,this.dispatcher=E,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(f,m){var E=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(P,L){E._loaded=!0,P?E.fire(new s.ErrorEvent(P)):L&&(E.image=L,f&&(E.coordinates=f),m&&m(),E._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var E=f.map(s.MercatorCoordinate.fromLngLat);this.tileID=(function(L){for(var F=1/0,G=1/0,W=-1/0,te=-1/0,$=0,re=L;$<re.length;$+=1){var se=re[$];F=Math.min(F,se.x),G=Math.min(G,se.y),W=Math.max(W,se.x),te=Math.max(te,se.y)}var ve=Math.max(W-F,te-G),Pe=Math.max(0,Math.floor(-Math.log(ve)/Math.LN2)),me=Math.pow(2,Pe);return new s.CanonicalTileID(Pe,Math.floor((F+W)/2*me),Math.floor((G+te)/2*me))})(E),this.minzoom=this.maxzoom=this.tileID.z;var P=E.map(function(L){return m.tileID.getTilePoint(L)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d})(s.Evented),Mt=(function(c){function d(f,m,E,P){c.call(this,f,m,E,P),this.roundZoom=!0,this.type="video",this.options=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var E=0,P=m.urls;E<P.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(P[E],s.ResourceType.Source).url);s.getVideo(this.urls,function(L,F){f._loaded=!0,L?f.fire(new s.ErrorEvent(L)):F&&(f.video=F,f.video.loop=!0,f.video.setAttribute("playsinline",""),f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d})(dt),St=(function(c){function d(f,m,E,P){c.call(this,f,m,E,P),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(L){return!Array.isArray(L)||L.length!==2||L.some(function(F){return typeof F!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,E=m.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(m,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var L=this.tiles[P];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var E=m[f];if(isNaN(E)||E<=0)return!0}return!1},d})(dt),st={vector:Le,raster:Ne,"raster-dem":$e,geojson:it,video:Mt,image:dt,canvas:St};function Ar(c,d){var f=s.identity([]);return s.translate(f,f,[1,1,0]),s.scale(f,f,[.5*c.width,.5*c.height,1]),s.multiply(f,f,c.calculatePosMatrix(d.toUnwrapped()))}function Qt(c,d,f,m,E,P){var L=(function(Pe,me,Ie){if(Pe)for(var He=0,Je=Pe;He<Je.length;He+=1){var et=me[Je[He]];if(et&&et.source===Ie&&et.type==="fill-extrusion")return!0}else for(var Xe in me){var Ye=me[Xe];if(Ye.source===Ie&&Ye.type==="fill-extrusion")return!0}return!1})(E&&E.layers,d,c.id),F=P.maxPitchScaleFactor(),G=c.tilesIn(m,F,L);G.sort(Zt);for(var W=[],te=0,$=G;te<$.length;te+=1){var re=$[te];W.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(d,f,c._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,E,P,F,Ar(c.transform,re.tileID))})}var se=(function(Pe){for(var me={},Ie={},He=0,Je=Pe;He<Je.length;He+=1){var et=Je[He],Xe=et.queryResults,Ye=et.wrappedTileID,pt=Ie[Ye]=Ie[Ye]||{};for(var Ot in Xe)for(var xt=Xe[Ot],Ut=pt[Ot]=pt[Ot]||{},sr=me[Ot]=me[Ot]||[],Er=0,Sr=xt;Er<Sr.length;Er+=1){var xn=Sr[Er];Ut[xn.featureIndex]||(Ut[xn.featureIndex]=!0,sr.push(xn))}}return me})(W);for(var ve in se)se[ve].forEach(function(Pe){var me=Pe.feature,Ie=c.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Ie});return se}function Zt(c,d){var f=c.tileID,m=d.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var Ht=function(c,d){this.max=c,this.onRemove=d,this.reset()};Ht.prototype.reset=function(){for(var c in this.data)for(var d=0,f=this.data[c];d<f.length;d+=1){var m=f[d];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},Ht.prototype.add=function(c,d,f){var m=this,E=c.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var P={value:d,timeout:void 0};if(f!==void 0&&(P.timeout=setTimeout(function(){m.remove(c,P)},f)),this.data[E].push(P),this.order.push(E),this.order.length>this.max){var L=this._getAndRemoveByKey(this.order[0]);L&&this.onRemove(L)}return this},Ht.prototype.has=function(c){return c.wrapped().key in this.data},Ht.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},Ht.prototype._getAndRemoveByKey=function(c){var d=this.data[c].shift();return d.timeout&&clearTimeout(d.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),d.value},Ht.prototype.getByKey=function(c){var d=this.data[c];return d?d[0].value:null},Ht.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},Ht.prototype.remove=function(c,d){if(!this.has(c))return this;var f=c.wrapped().key,m=d===void 0?0:this.data[f].indexOf(d),E=this.data[f][m];return this.data[f].splice(m,1),E.timeout&&clearTimeout(E.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(E.value),this.order.splice(this.order.indexOf(f),1),this},Ht.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Ht.prototype.filter=function(c){var d=[];for(var f in this.data)for(var m=0,E=this.data[f];m<E.length;m+=1){var P=E[m];c(P.value)||d.push(P)}for(var L=0,F=d;L<F.length;L+=1){var G=F[L];this.remove(G.value.tileID,G)}};var dr=function(c,d,f){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};dr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},dr.prototype.updateData=function(c){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},dr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Lr=function(c,d,f,m){this.length=d.length,this.attributes=f,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=c;var E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Lr.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Lr.prototype.updateData=function(c){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)},Lr.prototype.enableAttributes=function(c,d){for(var f=0;f<this.attributes.length;f++){var m=d.attributes[this.attributes[f].name];m!==void 0&&c.enableVertexAttribArray(m)}},Lr.prototype.setVertexAttribPointers=function(c,d,f){for(var m=0;m<this.attributes.length;m++){var E=this.attributes[m],P=d.attributes[E.name];P!==void 0&&c.vertexAttribPointer(P,E.components,c[ln[E.type]],!1,this.itemSize,E.offset+this.itemSize*(f||0))}},Lr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vr=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};vr.prototype.get=function(){return this.current},vr.prototype.set=function(c){},vr.prototype.getDefault=function(){return this.default},vr.prototype.setDefault=function(){this.set(this.default)};var Hn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d})(vr),_r=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},d})(vr),yr=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},d})(vr),un=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d})(vr),Rr=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},d})(vr),ci=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},d})(vr),qn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},d})(vr),mn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},d})(vr),ri=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},d})(vr),Vn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},d})(vr),Tn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},d})(vr),Yn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},d})(vr),zt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},d})(vr),gr=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},d})(vr),Mr=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return s.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d})(vr),nn=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},d})(vr),_i=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},d})(vr),Se=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},d})(vr),kt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},d})(vr),Jt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},d})(vr),cr=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},d})(vr),qe=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d})(vr),Lt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},d})(vr),ge=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d})(vr),Gt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},d})(vr),wt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},d})(vr),H=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},d})(vr),yt=(function(c){function d(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},d})(vr),Bt=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},d})(vr),xe=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},d})(vr),Ke=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},d})(vr),lt=(function(c){function d(f,m){c.call(this,f),this.context=f,this.parent=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d})(vr),Z=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},d})(lt),ne=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d})(lt),ae=function(c,d,f,m){this.context=c,this.width=d,this.height=f;var E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Z(c,E),m&&(this.depthAttachment=new ne(c,E))};ae.prototype.destroy=function(){var c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var ye=function(c,d,f){this.func=c,this.mask=d,this.range=f};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var Oe=function(c,d,f,m,E,P){this.test=c,this.ref=d,this.mask=f,this.fail=m,this.depthFail=E,this.pass=P};Oe.disabled=new Oe({func:519,mask:0},0,0,7680,7680,7680);var fe=function(c,d,f){this.blendFunction=c,this.blendColor=d,this.mask=f};fe.disabled=new fe(fe.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),fe.unblended=new fe(fe.Replace,s.Color.transparent,[!0,!0,!0,!0]),fe.alphaBlended=new fe([1,771],s.Color.transparent,[!0,!0,!0,!0]);var be=function(c,d,f){this.enable=c,this.mode=d,this.frontFace=f};be.disabled=new be(!1,1029,2305),be.backCCW=new be(!0,1029,2305);var oe=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hn(this),this.clearDepth=new _r(this),this.clearStencil=new yr(this),this.colorMask=new un(this),this.depthMask=new Rr(this),this.stencilMask=new ci(this),this.stencilFunc=new qn(this),this.stencilOp=new mn(this),this.stencilTest=new ri(this),this.depthRange=new Vn(this),this.depthTest=new Tn(this),this.depthFunc=new Yn(this),this.blend=new zt(this),this.blendFunc=new gr(this),this.blendColor=new Mr(this),this.blendEquation=new nn(this),this.cullFace=new _i(this),this.cullFaceSide=new Se(this),this.frontFace=new kt(this),this.program=new Jt(this),this.activeTexture=new cr(this),this.viewport=new qe(this),this.bindFramebuffer=new Lt(this),this.bindRenderbuffer=new ge(this),this.bindTexture=new Gt(this),this.bindVertexBuffer=new wt(this),this.bindElementBuffer=new H(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new Bt(this),this.pixelStoreUnpackPremultiplyAlpha=new xe(this),this.pixelStoreUnpackFlipY=new Ke(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(c,d){return new dr(this,c,d)},oe.prototype.createVertexBuffer=function(c,d,f){return new Lr(this,c,d,f)},oe.prototype.createRenderbuffer=function(c,d,f){var m=this.gl,E=m.createRenderbuffer();return this.bindRenderbuffer.set(E),m.renderbufferStorage(m.RENDERBUFFER,c,d,f),this.bindRenderbuffer.set(null),E},oe.prototype.createFramebuffer=function(c,d,f){return new ae(this,c,d,f)},oe.prototype.clear=function(c){var d=c.color,f=c.depth,m=this.gl,E=0;d&&(E|=m.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(E|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(E)},oe.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},oe.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(c){s.deepEqual(c.blendFunction,fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var we=(function(c){function d(f,m,E){var P=this;c.call(this),this.id=f,this.dispatcher=E,this.on("data",function(L){L.dataType==="source"&&L.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&L.dataType==="source"&&L.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=(function(L,F,G,W){var te=new st[F.type](L,F,G,W);if(te.id!==L)throw new Error("Expected Source id to be "+L+" instead of "+te.id);return s.bindAll(["load","abort","unload","serialize","prepare"],te),te})(f,m,E,this),this._tiles={},this._cache=new Ht(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},d.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},d.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},d.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[m];E.upload(f),E.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return s.values(this._tiles).map(function(f){return f.tileID}).sort(g).map(function(f){return f.key})},d.prototype.getRenderableIds=function(f){var m=this,E=[];for(var P in this._tiles)this._isIdRenderable(P,f)&&E.push(this._tiles[P]);return f?E.sort(function(L,F){var G=L.tileID,W=F.tileID,te=new s.Point(G.canonical.x,G.canonical.y)._rotate(m.transform.angle),$=new s.Point(W.canonical.x,W.canonical.y)._rotate(m.transform.angle);return G.overscaledZ-W.overscaledZ||$.y-te.y||$.x-te.x}).map(function(L){return L.tileID.key}):E.map(function(L){return L.tileID}).sort(g).map(function(L){return L.key})},d.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},d.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},d.prototype._reloadTile=function(f,m){var E=this._tiles[f];E&&(E.state!=="loading"&&(E.state=m),this._loadTile(E,this._tileLoaded.bind(this,E,f,m)))},d.prototype._tileLoaded=function(f,m,E,P){if(P)return f.state="errored",void(P.status!==404?this._source.fire(new s.ErrorEvent(P,{tile:f})):this.update(this.transform));f.timeAdded=s.browser.now(),E==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},d.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),E=0;E<m.length;E++){var P=m[E];if(f.neighboringTiles&&f.neighboringTiles[P]){var L=this.getTileByID(P);F(f,L),F(L,f)}}function F(G,W){G.needsHillshadePrepare=!0;var te=W.tileID.canonical.x-G.tileID.canonical.x,$=W.tileID.canonical.y-G.tileID.canonical.y,re=Math.pow(2,G.tileID.canonical.z),se=W.tileID.key;te===0&&$===0||Math.abs($)>1||(Math.abs(te)>1&&(Math.abs(te+re)===1?te+=re:Math.abs(te-re)===1&&(te-=re)),W.dem&&G.dem&&(G.dem.backfillBorder(W.dem,te,$),G.neighboringTiles&&G.neighboringTiles[se]&&(G.neighboringTiles[se].backfilled=!0)))}},d.prototype.getTile=function(f){return this.getTileByID(f.key)},d.prototype.getTileByID=function(f){return this._tiles[f]},d.prototype._retainLoadedChildren=function(f,m,E,P){for(var L in this._tiles){var F=this._tiles[L];if(!(P[L]||!F.hasData()||F.tileID.overscaledZ<=m||F.tileID.overscaledZ>E)){for(var G=F.tileID;F&&F.tileID.overscaledZ>m+1;){var W=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[W.key])&&F.hasData()&&(G=W)}for(var te=G;te.overscaledZ>m;)if(f[(te=te.scaledTo(te.overscaledZ-1)).key]){P[G.key]=G;break}}}},d.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var E=this._loadedParentTiles[f.key];return E&&E.tileID.overscaledZ>=m?E:null}for(var P=f.overscaledZ-1;P>=m;P--){var L=f.scaledTo(P),F=this._getLoadedTile(L);if(F)return F}},d.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},d.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,E=Math.ceil(f.height/this._source.tileSize)+1,P=Math.floor(m*E*5),L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(L)},d.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var E={};for(var P in this._tiles){var L=this._tiles[P];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+m),E[L.tileID.key]=L}for(var F in this._tiles=E,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pt){return new s.OverscaledTileID(pt.canonical.z,pt.wrap,pt.canonical.z,pt.canonical.x,pt.canonical.y)}):(E=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(pt){return m._source.hasTile(pt)}))):E=[];var P=f.coveringZoomLevel(this._source),L=Math.max(P-d.maxOverzooming,this._source.minzoom),F=Math.max(P+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(E,P);if(le(this._source.type)){for(var W={},te={},$=0,re=Object.keys(G);$<re.length;$+=1){var se=re[$],ve=G[se],Pe=this._tiles[se];if(Pe&&!(Pe.fadeEndTime&&Pe.fadeEndTime<=s.browser.now())){var me=this.findLoadedParent(ve,L);me&&(this._addTile(me.tileID),W[me.tileID.key]=me.tileID),te[se]=ve}}for(var Ie in this._retainLoadedChildren(te,P,F,G),W)G[Ie]||(this._coveredTiles[Ie]=!0,G[Ie]=W[Ie])}for(var He in G)this._tiles[He].clearFadeHold();for(var Je=0,et=s.keysDifference(this._tiles,G);Je<et.length;Je+=1){var Xe=et[Je],Ye=this._tiles[Xe];Ye.hasSymbolBuckets&&!Ye.holdingForFade()?Ye.setHoldDuration(this.map._fadeDuration):Ye.hasSymbolBuckets&&!Ye.symbolFadeFinished()||this._removeTile(Xe)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},d.prototype._updateRetainedTiles=function(f,m){for(var E={},P={},L=Math.max(m-d.maxOverzooming,this._source.minzoom),F=Math.max(m+d.maxUnderzooming,this._source.minzoom),G={},W=0,te=f;W<te.length;W+=1){var $=te[W],re=this._addTile($);E[$.key]=$,re.hasData()||m<this._source.maxzoom&&(G[$.key]=$)}this._retainLoadedChildren(G,m,F,E);for(var se=0,ve=f;se<ve.length;se+=1){var Pe=ve[se],me=this._tiles[Pe.key];if(!me.hasData()){if(m+1>this._source.maxzoom){var Ie=Pe.children(this._source.maxzoom)[0],He=this.getTile(Ie);if(He&&He.hasData()){E[Ie.key]=Ie;continue}}else{var Je=Pe.children(this._source.maxzoom);if(E[Je[0].key]&&E[Je[1].key]&&E[Je[2].key]&&E[Je[3].key])continue}for(var et=me.wasRequested(),Xe=Pe.overscaledZ-1;Xe>=L;--Xe){var Ye=Pe.scaledTo(Xe);if(P[Ye.key]||(P[Ye.key]=!0,!(me=this.getTile(Ye))&&et&&(me=this._addTile(Ye)),me&&(E[Ye.key]=Ye,et=me.wasRequested(),me.hasData())))break}}}return E},d.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],E=void 0,P=this._tiles[f].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){E=this._loadedParentTiles[P.key];break}m.push(P.key);var L=P.scaledTo(P.overscaledZ-1);if(E=this._getLoadedTile(L))break;P=L}for(var F=0,G=m;F<G.length;F+=1)this._loadedParentTiles[G[F]]=E}},d.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var E=!!m;return E||(m=new s.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,E||this._source.fire(new s.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},d.prototype._setTileReloadTimer=function(f,m){var E=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var P=m.getExpiryTimeout();P&&(this._timers[f]=setTimeout(function(){E._reloadTile(f,"expired"),delete E._timers[f]},P))},d.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},d.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},d.prototype.tilesIn=function(f,m,E){var P=this,L=[],F=this.transform;if(!F)return L;for(var G=E?F.getCameraQueryGeometry(f):f,W=f.map(function(Xe){return F.pointCoordinate(Xe)}),te=G.map(function(Xe){return F.pointCoordinate(Xe)}),$=this.getIds(),re=1/0,se=1/0,ve=-1/0,Pe=-1/0,me=0,Ie=te;me<Ie.length;me+=1){var He=Ie[me];re=Math.min(re,He.x),se=Math.min(se,He.y),ve=Math.max(ve,He.x),Pe=Math.max(Pe,He.y)}for(var Je=function(Xe){var Ye=P._tiles[$[Xe]];if(!Ye.holdingForFade()){var pt=Ye.tileID,Ot=Math.pow(2,F.zoom-Ye.tileID.overscaledZ),xt=m*Ye.queryPadding*s.EXTENT/Ye.tileSize/Ot,Ut=[pt.getTilePoint(new s.MercatorCoordinate(re,se)),pt.getTilePoint(new s.MercatorCoordinate(ve,Pe))];if(Ut[0].x-xt<s.EXTENT&&Ut[0].y-xt<s.EXTENT&&Ut[1].x+xt>=0&&Ut[1].y+xt>=0){var sr=W.map(function(Sr){return pt.getTilePoint(Sr)}),Er=te.map(function(Sr){return pt.getTilePoint(Sr)});L.push({tile:Ye,tileID:pt,queryGeometry:sr,cameraQueryGeometry:Er,scale:Ot})}}},et=0;et<$.length;et++)Je(et);return L},d.prototype.getVisibleCoordinates=function(f){for(var m=this,E=this.getRenderableIds(f).map(function(G){return m._tiles[G].tileID}),P=0,L=E;P<L.length;P+=1){var F=L[P];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return E},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(le(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=s.browser.now())return!0}return!1},d.prototype.setFeatureState=function(f,m,E){this._state.updateState(f=f||"_geojsonTileLayer",m,E)},d.prototype.removeFeatureState=function(f,m,E){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,E)},d.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},d.prototype.setDependencies=function(f,m,E){var P=this._tiles[f];P&&P.setDependencies(m,E)},d.prototype.reloadTilesForDependencies=function(f,m){for(var E in this._tiles)this._tiles[E].hasDependency(f,m)&&this._reloadTile(E,"reloading");this._cache.filter(function(P){return!P.hasDependency(f,m)})},d})(s.Evented);function g(c,d){var f=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*d.wrap)-+(d.wrap<0);return c.overscaledZ-d.overscaledZ||m-f||d.canonical.y-c.canonical.y||d.canonical.x-c.canonical.x}function le(c){return c==="raster"||c==="image"||c==="video"}function Ct(){return new s.window.Worker(O.workerUrl)}we.maxOverzooming=10,we.maxUnderzooming=3;var Qe="mapboxgl_preloaded_worker_pool",Et=function(){this.active={}};Et.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Ct);return this.active[c]=!0,this.workers.slice()},Et.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Et.prototype.isPreloaded=function(){return!!this.active[Qe]},Et.prototype.numActive=function(){return Object.keys(this.active).length};var Pt,Dt=Math.floor(s.browser.hardwareConcurrency/2);function ht(){return Pt||(Pt=new Et),Pt}function Ft(c,d){var f={};for(var m in c)m!=="ref"&&(f[m]=c[m]);return s.refProperties.forEach(function(E){E in d&&(f[E]=d[E])}),f}function It(c){c=c.slice();for(var d=Object.create(null),f=0;f<c.length;f++)d[c[f].id]=c[f];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=Ft(c[m],d[c[m].ref]));return c}Et.workerCount=Math.max(Math.min(Dt,6),1);var jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Nr(c,d,f){f.push({command:jt.addSource,args:[c,d[c]]})}function er(c,d,f){d.push({command:jt.removeSource,args:[c]}),f[c]=!0}function en(c,d,f,m){er(c,f,m),Nr(c,d,f)}function cn(c,d,f){var m;for(m in c[f])if(c[f].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(c[f][m],d[f][m]))return!1;for(m in d[f])if(d[f].hasOwnProperty(m)&&m!=="data"&&!s.deepEqual(c[f][m],d[f][m]))return!1;return!0}function Jr(c,d,f,m,E,P){var L;for(L in d=d||{},c=c||{})c.hasOwnProperty(L)&&(s.deepEqual(c[L],d[L])||f.push({command:P,args:[m,L,d[L],E]}));for(L in d)d.hasOwnProperty(L)&&!c.hasOwnProperty(L)&&(s.deepEqual(c[L],d[L])||f.push({command:P,args:[m,L,d[L],E]}))}function Kr(c){return c.id}function zr(c,d){return c[d.id]=d,c}var yi=function(c,d){this.reset(c,d)};yi.prototype.reset=function(c,d){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yi.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=s.clamp(c,0,1);for(var d=1,f=this._distances[d],m=c*this.paddedLength+this.padding;f<m&&d<this._distances.length;)f=this._distances[++d];var E=d-1,P=this._distances[E],L=f-P,F=L>0?(m-P)/L:0;return this.points[E].mult(1-F).add(this.points[d].mult(F))};var Xr=function(c,d,f){var m=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(d/f);for(var P=0;P<this.xCellCount*this.yCellCount;P++)m.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function mr(c,d,f,m,E){var P=s.create();return d?(s.scale(P,P,[1/E,1/E,1]),f||s.rotateZ(P,P,m.angle)):s.multiply(P,m.labelPlaneMatrix,c),P}function Be(c,d,f,m,E){if(d){var P=s.clone(c);return s.scale(P,P,[E,E,1]),f||s.rotateZ(P,P,-m.angle),P}return m.glCoordMatrix}function Xt(c,d){var f=[c.x,c.y,0,1];hi(f,f,d);var m=f[3];return{point:new s.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function tn(c,d){return .5+c/d*.5}function Vi(c,d){var f=c[0]/c[3],m=c[1]/c[3];return f>=-d[0]&&f<=d[0]&&m>=-d[1]&&m<=d[1]}function ya(c,d,f,m,E,P,L,F){var G=m?c.textSizeData:c.iconSizeData,W=s.evaluateSizeForZoom(G,f.transform.zoom),te=[256/f.width*2+1,256/f.height*2+1],$=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;$.clear();for(var re=c.lineVertexArray,se=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,ve=f.transform.width/f.transform.height,Pe=!1,me=0;me<se.length;me++){var Ie=se.get(me);if(Ie.hidden||Ie.writingMode===s.WritingMode.vertical&&!Pe)Fi(Ie.numGlyphs,$);else{Pe=!1;var He=[Ie.anchorX,Ie.anchorY,0,1];if(s.transformMat4(He,He,d),Vi(He,te)){var Je=tn(f.transform.cameraToCenterDistance,He[3]),et=s.evaluateSizeForFeature(G,W,Ie),Xe=L?et/Je:et*Je,Ye=new s.Point(Ie.anchorX,Ie.anchorY),pt=Xt(Ye,E).point,Ot={},xt=Te(Ie,Xe,!1,F,d,E,P,c.glyphOffsetArray,re,$,pt,Ye,Ot,ve);Pe=xt.useVertical,(xt.notEnoughRoom||Pe||xt.needsFlipping&&Te(Ie,Xe,!0,F,d,E,P,c.glyphOffsetArray,re,$,pt,Ye,Ot,ve).notEnoughRoom)&&Fi(Ie.numGlyphs,$)}else Fi(Ie.numGlyphs,$)}}m?c.text.dynamicLayoutVertexBuffer.updateData($):c.icon.dynamicLayoutVertexBuffer.updateData($)}function ui(c,d,f,m,E,P,L,F,G,W,te){var $=F.glyphStartIndex+F.numGlyphs,re=F.lineStartIndex,se=F.lineStartIndex+F.lineLength,ve=d.getoffsetX(F.glyphStartIndex),Pe=d.getoffsetX($-1),me=Jn(c*ve,f,m,E,P,L,F.segment,re,se,G,W,te);if(!me)return null;var Ie=Jn(c*Pe,f,m,E,P,L,F.segment,re,se,G,W,te);return Ie?{first:me,last:Ie}:null}function Wn(c,d,f,m){return c===s.WritingMode.horizontal&&Math.abs(f.y-d.y)>Math.abs(f.x-d.x)*m?{useVertical:!0}:(c===s.WritingMode.vertical?d.y<f.y:d.x>f.x)?{needsFlipping:!0}:null}function Te(c,d,f,m,E,P,L,F,G,W,te,$,re,se){var ve,Pe=d/24,me=c.lineOffsetX*Pe,Ie=c.lineOffsetY*Pe;if(c.numGlyphs>1){var He=c.glyphStartIndex+c.numGlyphs,Je=c.lineStartIndex,et=c.lineStartIndex+c.lineLength,Xe=ui(Pe,F,me,Ie,f,te,$,c,G,P,re);if(!Xe)return{notEnoughRoom:!0};var Ye=Xt(Xe.first.point,L).point,pt=Xt(Xe.last.point,L).point;if(m&&!f){var Ot=Wn(c.writingMode,Ye,pt,se);if(Ot)return Ot}ve=[Xe.first];for(var xt=c.glyphStartIndex+1;xt<He-1;xt++)ve.push(Jn(Pe*F.getoffsetX(xt),me,Ie,f,te,$,c.segment,Je,et,G,P,re));ve.push(Xe.last)}else{if(m&&!f){var Ut=Xt($,E).point,sr=c.lineStartIndex+c.segment+1,Er=new s.Point(G.getx(sr),G.gety(sr)),Sr=Xt(Er,E),xn=Sr.signedDistanceFromCamera>0?Sr.point:Wo($,Er,Ut,1,E),ar=Wn(c.writingMode,Ut,xn,se);if(ar)return ar}var Wr=Jn(Pe*F.getoffsetX(c.glyphStartIndex),me,Ie,f,te,$,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,G,P,re);if(!Wr)return{notEnoughRoom:!0};ve=[Wr]}for(var rn=0,Vr=ve;rn<Vr.length;rn+=1){var Gr=Vr[rn];s.addDynamicAttributes(W,Gr.point,Gr.angle)}return{}}function Wo(c,d,f,m,E){var P=Xt(c.add(c.sub(d)._unit()),E).point,L=f.sub(P);return f.add(L._mult(m/L.mag()))}function Jn(c,d,f,m,E,P,L,F,G,W,te,$){var re=m?c-d:c+d,se=re>0?1:-1,ve=0;m&&(se*=-1,ve=Math.PI),se<0&&(ve+=Math.PI);for(var Pe=se>0?F+L:F+L+1,me=E,Ie=E,He=0,Je=0,et=Math.abs(re),Xe=[];He+Je<=et;){if((Pe+=se)<F||Pe>=G)return null;if(Ie=me,Xe.push(me),(me=$[Pe])===void 0){var Ye=new s.Point(W.getx(Pe),W.gety(Pe)),pt=Xt(Ye,te);if(pt.signedDistanceFromCamera>0)me=$[Pe]=pt.point;else{var Ot=Pe-se;me=Wo(He===0?P:new s.Point(W.getx(Ot),W.gety(Ot)),Ye,Ie,et-He+1,te)}}He+=Je,Je=Ie.dist(me)}var xt=(et-He)/Je,Ut=me.sub(Ie),sr=Ut.mult(xt)._add(Ie);sr._add(Ut._unit()._perp()._mult(f*se));var Er=ve+Math.atan2(me.y-Ie.y,me.x-Ie.x);return Xe.push(sr),{point:sr,angle:Er,path:Xe}}Xr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xr.prototype.insert=function(c,d,f,m,E){this._forEachCell(d,f,m,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(E)},Xr.prototype.insertCircle=function(c,d,f,m){this._forEachCell(d-m,f-m,d+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(f),this.circles.push(m)},Xr.prototype._insertBoxCell=function(c,d,f,m,E,P){this.boxCells[E].push(P)},Xr.prototype._insertCircleCell=function(c,d,f,m,E,P){this.circleCells[E].push(P)},Xr.prototype._query=function(c,d,f,m,E,P){if(f<0||c>this.width||m<0||d>this.height)return!E&&[];var L=[];if(c<=0&&d<=0&&this.width<=f&&this.height<=m){if(E)return!0;for(var F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var G=0;G<this.circleKeys.length;G++){var W=this.circles[3*G],te=this.circles[3*G+1],$=this.circles[3*G+2];L.push({key:this.circleKeys[G],x1:W-$,y1:te-$,x2:W+$,y2:te+$})}return P?L.filter(P):L}return this._forEachCell(c,d,f,m,this._queryCell,L,{hitTest:E,seenUids:{box:{},circle:{}}},P),E?L.length>0:L},Xr.prototype._queryCircle=function(c,d,f,m,E){var P=c-f,L=c+f,F=d-f,G=d+f;if(L<0||P>this.width||G<0||F>this.height)return!m&&[];var W=[];return this._forEachCell(P,F,L,G,this._queryCellCircle,W,{hitTest:m,circle:{x:c,y:d,radius:f},seenUids:{box:{},circle:{}}},E),m?W.length>0:W},Xr.prototype.query=function(c,d,f,m,E){return this._query(c,d,f,m,!1,E)},Xr.prototype.hitTest=function(c,d,f,m,E){return this._query(c,d,f,m,!0,E)},Xr.prototype.hitTestCircle=function(c,d,f,m){return this._queryCircle(c,d,f,!0,m)},Xr.prototype._queryCell=function(c,d,f,m,E,P,L,F){var G=L.seenUids,W=this.boxCells[E];if(W!==null)for(var te=this.bboxes,$=0,re=W;$<re.length;$+=1){var se=re[$];if(!G.box[se]){G.box[se]=!0;var ve=4*se;if(c<=te[ve+2]&&d<=te[ve+3]&&f>=te[ve+0]&&m>=te[ve+1]&&(!F||F(this.boxKeys[se]))){if(L.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[se],x1:te[ve],y1:te[ve+1],x2:te[ve+2],y2:te[ve+3]})}}}var Pe=this.circleCells[E];if(Pe!==null)for(var me=this.circles,Ie=0,He=Pe;Ie<He.length;Ie+=1){var Je=He[Ie];if(!G.circle[Je]){G.circle[Je]=!0;var et=3*Je;if(this._circleAndRectCollide(me[et],me[et+1],me[et+2],c,d,f,m)&&(!F||F(this.circleKeys[Je]))){if(L.hitTest)return P.push(!0),!0;var Xe=me[et],Ye=me[et+1],pt=me[et+2];P.push({key:this.circleKeys[Je],x1:Xe-pt,y1:Ye-pt,x2:Xe+pt,y2:Ye+pt})}}}},Xr.prototype._queryCellCircle=function(c,d,f,m,E,P,L,F){var G=L.circle,W=L.seenUids,te=this.boxCells[E];if(te!==null)for(var $=this.bboxes,re=0,se=te;re<se.length;re+=1){var ve=se[re];if(!W.box[ve]){W.box[ve]=!0;var Pe=4*ve;if(this._circleAndRectCollide(G.x,G.y,G.radius,$[Pe+0],$[Pe+1],$[Pe+2],$[Pe+3])&&(!F||F(this.boxKeys[ve])))return P.push(!0),!0}}var me=this.circleCells[E];if(me!==null)for(var Ie=this.circles,He=0,Je=me;He<Je.length;He+=1){var et=Je[He];if(!W.circle[et]){W.circle[et]=!0;var Xe=3*et;if(this._circlesCollide(Ie[Xe],Ie[Xe+1],Ie[Xe+2],G.x,G.y,G.radius)&&(!F||F(this.circleKeys[et])))return P.push(!0),!0}}},Xr.prototype._forEachCell=function(c,d,f,m,E,P,L,F){for(var G=this._convertToXCellCoord(c),W=this._convertToYCellCoord(d),te=this._convertToXCellCoord(f),$=this._convertToYCellCoord(m),re=G;re<=te;re++)for(var se=W;se<=$;se++)if(E.call(this,c,d,f,m,this.xCellCount*se+re,P,L,F))return},Xr.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Xr.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Xr.prototype._circlesCollide=function(c,d,f,m,E,P){var L=m-c,F=E-d,G=f+P;return G*G>L*L+F*F},Xr.prototype._circleAndRectCollide=function(c,d,f,m,E,P,L){var F=(P-m)/2,G=Math.abs(c-(m+F));if(G>F+f)return!1;var W=(L-E)/2,te=Math.abs(d-(E+W));if(te>W+f)return!1;if(G<=F||te<=W)return!0;var $=G-F,re=te-W;return $*$+re*re<=f*f};var Jo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fi(c,d){for(var f=0;f<c;f++){var m=d.length;d.resize(m+4),d.float32.set(Jo,3*m)}}function hi(c,d,f){var m=d[0],E=d[1];return c[0]=f[0]*m+f[4]*E+f[12],c[1]=f[1]*m+f[5]*E+f[13],c[3]=f[3]*m+f[7]*E+f[15],c}var Mi=function(c,d,f){d===void 0&&(d=new Xr(c.width+200,c.height+200,25)),f===void 0&&(f=new Xr(c.width+200,c.height+200,25)),this.transform=c,this.grid=d,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function Ln(c,d,f){return d*(s.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Mi.prototype.placeCollisionBox=function(c,d,f,m,E){var P=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),L=f*P.perspectiveRatio,F=c.x1*L+P.point.x,G=c.y1*L+P.point.y,W=c.x2*L+P.point.x,te=c.y2*L+P.point.y;return!this.isInsideGrid(F,G,W,te)||!d&&this.grid.hitTest(F,G,W,te,E)?{box:[],offscreen:!1}:{box:[F,G,W,te],offscreen:this.isOffscreen(F,G,W,te)}},Mi.prototype.placeCollisionCircles=function(c,d,f,m,E,P,L,F,G,W,te,$,re){var se=[],ve=new s.Point(d.anchorX,d.anchorY),Pe=Xt(ve,P),me=tn(this.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),Ie=(W?E/me:E*me)/s.ONE_EM,He=Xt(ve,L).point,Je=ui(Ie,m,d.lineOffsetX*Ie,d.lineOffsetY*Ie,!1,He,ve,d,f,L,{}),et=!1,Xe=!1,Ye=!0;if(Je){for(var pt=.5*$*me+re,Ot=new s.Point(-100,-100),xt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),Ut=new yi,sr=Je.first,Er=Je.last,Sr=[],xn=sr.path.length-1;xn>=1;xn--)Sr.push(sr.path[xn]);for(var ar=1;ar<Er.path.length;ar++)Sr.push(Er.path[ar]);var Wr=2.5*pt;if(F){var rn=Sr.map(function(Fo){return Xt(Fo,F)});Sr=rn.some(function(Fo){return Fo.signedDistanceFromCamera<=0})?[]:rn.map(function(Fo){return Fo.point})}var Vr=[];if(Sr.length>0){for(var Gr=Sr[0].clone(),qr=Sr[0].clone(),Fr=1;Fr<Sr.length;Fr++)Gr.x=Math.min(Gr.x,Sr[Fr].x),Gr.y=Math.min(Gr.y,Sr[Fr].y),qr.x=Math.max(qr.x,Sr[Fr].x),qr.y=Math.max(qr.y,Sr[Fr].y);Vr=Gr.x>=Ot.x&&qr.x<=xt.x&&Gr.y>=Ot.y&&qr.y<=xt.y?[Sr]:qr.x<Ot.x||Gr.x>xt.x||qr.y<Ot.y||Gr.y>xt.y?[]:s.clipLine([Sr],Ot.x,Ot.y,xt.x,xt.y)}for(var Or=0,Xi=Vr;Or<Xi.length;Or+=1){var Ti;Ut.reset(Xi[Or],.25*pt),Ti=Ut.length<=.5*pt?1:Math.ceil(Ut.paddedLength/Wr)+1;for(var ys=0;ys<Ti;ys++){var ss=ys/Math.max(Ti-1,1),vi=Ut.lerp(ss),Pi=vi.x+100,co=vi.y+100;se.push(Pi,co,pt,0);var Ps=Pi-pt,Hl=co-pt,Ks=Pi+pt,oa=co+pt;if(Ye=Ye&&this.isOffscreen(Ps,Hl,Ks,oa),Xe=Xe||this.isInsideGrid(Ps,Hl,Ks,oa),!c&&this.grid.hitTestCircle(Pi,co,pt,te)&&(et=!0,!G))return{circles:[],offscreen:!1,collisionDetected:et}}}}return{circles:!G&&et||!Xe?[]:se,offscreen:Ye,collisionDetected:et}},Mi.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],f=1/0,m=1/0,E=-1/0,P=-1/0,L=0,F=c;L<F.length;L+=1){var G=F[L],W=new s.Point(G.x+100,G.y+100);f=Math.min(f,W.x),m=Math.min(m,W.y),E=Math.max(E,W.x),P=Math.max(P,W.y),d.push(W)}for(var te={},$={},re=0,se=this.grid.query(f,m,E,P).concat(this.ignoredGrid.query(f,m,E,P));re<se.length;re+=1){var ve=se[re],Pe=ve.key;if(te[Pe.bucketInstanceId]===void 0&&(te[Pe.bucketInstanceId]={}),!te[Pe.bucketInstanceId][Pe.featureIndex]){var me=[new s.Point(ve.x1,ve.y1),new s.Point(ve.x2,ve.y1),new s.Point(ve.x2,ve.y2),new s.Point(ve.x1,ve.y2)];s.polygonIntersectsPolygon(d,me)&&(te[Pe.bucketInstanceId][Pe.featureIndex]=!0,$[Pe.bucketInstanceId]===void 0&&($[Pe.bucketInstanceId]=[]),$[Pe.bucketInstanceId].push(Pe.featureIndex))}}return $},Mi.prototype.insertCollisionBox=function(c,d,f,m,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:E},c[0],c[1],c[2],c[3])},Mi.prototype.insertCollisionCircles=function(c,d,f,m,E){for(var P=d?this.ignoredGrid:this.grid,L={bucketInstanceId:f,featureIndex:m,collisionGroupID:E},F=0;F<c.length;F+=4)P.insertCircle(L,c[F],c[F+1],c[F+2])},Mi.prototype.projectAndGetPerspectiveRatio=function(c,d,f){var m=[d,f,0,1];return hi(m,m,c),{point:new s.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Mi.prototype.isOffscreen=function(c,d,f,m){return f<100||c>=this.screenRightBoundary||m<100||d>this.screenBottomBoundary},Mi.prototype.isInsideGrid=function(c,d,f,m){return f>=0&&c<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary},Mi.prototype.getViewportMatrix=function(){var c=s.identity([]);return s.translate(c,c,[-100,-100,0]),c};var gs=function(c,d,f,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):m&&f?1:0,this.placed=f};gs.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wi=function(c,d,f,m,E){this.text=new gs(c?c.text:null,d,f,E),this.icon=new gs(c?c.icon:null,d,m,E)};Wi.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Gs=function(c,d,f){this.text=c,this.icon=d,this.skipFade=f},Sn=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},bc=function(c,d,f,m,E){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=E},Ae=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Me(c,d,f,m,E){var P=s.getAnchorAlignment(c),L=-(P.horizontalAlign-.5)*d,F=-(P.verticalAlign-.5)*f,G=s.evaluateVariableOffset(c,m);return new s.Point(L+G[0]*E,F+G[1]*E)}function We(c,d,f,m,E,P){var L=c.x1,F=c.x2,G=c.y1,W=c.y2,te=c.anchorPointX,$=c.anchorPointY,re=new s.Point(d,f);return m&&re._rotate(E?P:-P),{x1:L+re.x,y1:G+re.y,x2:F+re.x,y2:W+re.y,anchorPointX:te,anchorPointY:$}}Ae.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:function(f){return f.collisionGroupID===d}}}return this.collisionGroups[c]};var vt=function(c,d,f,m){this.transform=c.clone(),this.collisionIndex=new Mi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ae(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function Vt(c,d,f,m,E){c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0)}vt.prototype.getBucketParts=function(c,d,f,m){var E=f.getBucket(d),P=f.latestFeatureIndex;if(E&&P&&d.id===E.layerIds[0]){var L=f.collisionBoxArray,F=E.layers[0].layout,G=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),W=f.tileSize/s.EXTENT,te=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),$=F.get("text-pitch-alignment")==="map",re=F.get("text-rotation-alignment")==="map",se=Ln(f,1,this.transform.zoom),ve=mr(te,$,re,this.transform,se),Pe=null;if($){var me=Be(te,$,re,this.transform,se);Pe=s.multiply([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[E.bucketInstanceId]=new bc(E.bucketInstanceId,P,E.sourceLayerIndex,E.index,f.tileID);var Ie={bucket:E,layout:F,posMatrix:te,textLabelPlaneMatrix:ve,labelToScreenMatrix:Pe,scale:G,textPixelRatio:W,holdingForFade:f.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(m)for(var He=0,Je=E.sortKeyRanges;He<Je.length;He+=1){var et=Je[He];c.push({sortKey:et.sortKey,symbolInstanceStart:et.symbolInstanceStart,symbolInstanceEnd:et.symbolInstanceEnd,parameters:Ie})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ie})}},vt.prototype.attemptAnchorPlacement=function(c,d,f,m,E,P,L,F,G,W,te,$,re,se,ve){var Pe,me=[$.textOffset0,$.textOffset1],Ie=Me(c,f,m,me,E),He=this.collisionIndex.placeCollisionBox(We(d,Ie.x,Ie.y,P,L,this.transform.angle),te,F,G,W.predicate);if(!ve||this.collisionIndex.placeCollisionBox(We(ve,Ie.x,Ie.y,P,L,this.transform.angle),te,F,G,W.predicate).box.length!==0)return He.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:me,width:f,height:m,anchor:c,textBoxScale:E,prevAnchor:Pe},this.markUsedJustification(re,c,$,se),re.allowVerticalPlacement&&(this.markUsedOrientation(re,se,$),this.placedOrientations[$.crossTileID]=se),{shift:Ie,placedGlyphBoxes:He}):void 0},vt.prototype.placeLayerBucketPart=function(c,d,f){var m=this,E=c.parameters,P=E.bucket,L=E.layout,F=E.posMatrix,G=E.textLabelPlaneMatrix,W=E.labelToScreenMatrix,te=E.textPixelRatio,$=E.holdingForFade,re=E.collisionBoxArray,se=E.partiallyEvaluatedTextSize,ve=E.collisionGroup,Pe=L.get("text-optional"),me=L.get("icon-optional"),Ie=L.get("text-allow-overlap"),He=L.get("icon-allow-overlap"),Je=L.get("text-rotation-alignment")==="map",et=L.get("text-pitch-alignment")==="map",Xe=L.get("icon-text-fit")!=="none",Ye=L.get("symbol-z-order")==="viewport-y",pt=Ie&&(He||!P.hasIconData()||me),Ot=He&&(Ie||!P.hasTextData()||Pe);!P.collisionArrays&&re&&P.deserializeCollisionBoxes(re);var xt=function(ar,Wr){if(!d[ar.crossTileID])if($)m.placements[ar.crossTileID]=new Gs(!1,!1,!1);else{var rn,Vr=!1,Gr=!1,qr=!0,Fr=null,Or={box:null,offscreen:null},Xi={box:null,offscreen:null},Ti=null,ys=null,ss=0,vi=0,Pi=0;Wr.textFeatureIndex?ss=Wr.textFeatureIndex:ar.useRuntimeCollisionCircles&&(ss=ar.featureIndex),Wr.verticalTextFeatureIndex&&(vi=Wr.verticalTextFeatureIndex);var co=Wr.textBox;if(co){var Ps=function(Bn){var To=s.WritingMode.horizontal;if(P.allowVerticalPlacement&&!Bn&&m.prevPlacement){var Xs=m.prevPlacement.placedOrientations[ar.crossTileID];Xs&&(m.placedOrientations[ar.crossTileID]=Xs,m.markUsedOrientation(P,To=Xs,ar))}return To},Hl=function(Bn,To){if(P.allowVerticalPlacement&&ar.numVerticalGlyphVertices>0&&Wr.verticalTextBox)for(var Xs=0,Fc=P.writingModes;Xs<Fc.length&&(Fc[Xs]===s.WritingMode.vertical?(Or=To(),Xi=Or):Or=Bn(),!(Or&&Or.box&&Or.box.length));Xs+=1);else Or=Bn()};if(L.get("text-variable-anchor")){var Ks=L.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[ar.crossTileID]){var oa=m.prevPlacement.variableOffsets[ar.crossTileID];Ks.indexOf(oa.anchor)>0&&(Ks=Ks.filter(function(Bn){return Bn!==oa.anchor})).unshift(oa.anchor)}var Fo=function(Bn,To,Xs){for(var Fc=Bn.x2-Bn.x1,cb=Bn.y2-Bn.y1,Hf=ar.textBoxScale,ub=Xe&&!He?To:null,Lh={box:[],offscreen:!1},om=Ie?2*Ks.length:Ks.length,Iu=0;Iu<om;++Iu){var Vf=m.attemptAnchorPlacement(Ks[Iu%Ks.length],Bn,Fc,cb,Hf,Je,et,te,F,ve,Iu>=Ks.length,ar,P,Xs,ub);if(Vf&&(Lh=Vf.placedGlyphBoxes)&&Lh.box&&Lh.box.length){Vr=!0,Fr=Vf.shift;break}}return Lh};Hl(function(){return Fo(co,Wr.iconBox,s.WritingMode.horizontal)},function(){var Bn=Wr.verticalTextBox;return P.allowVerticalPlacement&&!(Or&&Or.box&&Or.box.length)&&ar.numVerticalGlyphVertices>0&&Bn?Fo(Bn,Wr.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Or&&(Vr=Or.box,qr=Or.offscreen);var Ih=Ps(Or&&Or.box);if(!Vr&&m.prevPlacement){var Tu=m.prevPlacement.variableOffsets[ar.crossTileID];Tu&&(m.variableOffsets[ar.crossTileID]=Tu,m.markUsedJustification(P,Tu.anchor,ar,Ih))}}else{var Vl=function(Bn,To){var Xs=m.collisionIndex.placeCollisionBox(Bn,Ie,te,F,ve.predicate);return Xs&&Xs.box&&Xs.box.length&&(m.markUsedOrientation(P,To,ar),m.placedOrientations[ar.crossTileID]=To),Xs};Hl(function(){return Vl(co,s.WritingMode.horizontal)},function(){var Bn=Wr.verticalTextBox;return P.allowVerticalPlacement&&ar.numVerticalGlyphVertices>0&&Bn?Vl(Bn,s.WritingMode.vertical):{box:null,offscreen:null}}),Ps(Or&&Or.box&&Or.box.length)}}if(Vr=(rn=Or)&&rn.box&&rn.box.length>0,qr=rn&&rn.offscreen,ar.useRuntimeCollisionCircles){var Su=P.text.placedSymbolArray.get(ar.centerJustifiedTextSymbolIndex),Mh=s.evaluateSizeForFeature(P.textSizeData,se,Su),Ma=L.get("text-padding");Ti=m.collisionIndex.placeCollisionCircles(Ie,Su,P.lineVertexArray,P.glyphOffsetArray,Mh,F,G,W,f,et,ve.predicate,ar.collisionCircleDiameter,Ma),Vr=Ie||Ti.circles.length>0&&!Ti.collisionDetected,qr=qr&&Ti.offscreen}if(Wr.iconFeatureIndex&&(Pi=Wr.iconFeatureIndex),Wr.iconBox){var Ph=function(Bn){var To=Xe&&Fr?We(Bn,Fr.x,Fr.y,Je,et,m.transform.angle):Bn;return m.collisionIndex.placeCollisionBox(To,He,te,F,ve.predicate)};Gr=Xi&&Xi.box&&Xi.box.length&&Wr.verticalIconBox?(ys=Ph(Wr.verticalIconBox)).box.length>0:(ys=Ph(Wr.iconBox)).box.length>0,qr=qr&&ys.offscreen}var Pa=Pe||ar.numHorizontalGlyphVertices===0&&ar.numVerticalGlyphVertices===0,Qi=me||ar.numIconVertices===0;if(Pa||Qi?Qi?Pa||(Gr=Gr&&Vr):Vr=Gr&&Vr:Gr=Vr=Gr&&Vr,Vr&&rn&&rn.box&&m.collisionIndex.insertCollisionBox(rn.box,L.get("text-ignore-placement"),P.bucketInstanceId,Xi&&Xi.box&&vi?vi:ss,ve.ID),Gr&&ys&&m.collisionIndex.insertCollisionBox(ys.box,L.get("icon-ignore-placement"),P.bucketInstanceId,Pi,ve.ID),Ti&&(Vr&&m.collisionIndex.insertCollisionCircles(Ti.circles,L.get("text-ignore-placement"),P.bucketInstanceId,ss,ve.ID),f)){var sl=P.bucketInstanceId,Wl=m.collisionCircleArrays[sl];Wl===void 0&&(Wl=m.collisionCircleArrays[sl]=new Sn);for(var Dc=0;Dc<Ti.circles.length;Dc+=4)Wl.circles.push(Ti.circles[Dc+0]),Wl.circles.push(Ti.circles[Dc+1]),Wl.circles.push(Ti.circles[Dc+2]),Wl.circles.push(Ti.collisionDetected?1:0)}m.placements[ar.crossTileID]=new Gs(Vr||pt,Gr||Ot,qr||P.justReloaded),d[ar.crossTileID]=!0}};if(Ye)for(var Ut=P.getSortedSymbolIndexes(this.transform.angle),sr=Ut.length-1;sr>=0;--sr){var Er=Ut[sr];xt(P.symbolInstances.get(Er),P.collisionArrays[Er])}else for(var Sr=c.symbolInstanceStart;Sr<c.symbolInstanceEnd;Sr++)xt(P.symbolInstances.get(Sr),P.collisionArrays[Sr]);if(f&&P.bucketInstanceId in this.collisionCircleArrays){var xn=this.collisionCircleArrays[P.bucketInstanceId];s.invert(xn.invProjMatrix,F),xn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},vt.prototype.markUsedJustification=function(c,d,f,m){var E;E=m===s.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(d)];for(var P=0,L=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];P<L.length;P+=1){var F=L[P];F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=E>=0&&F!==E?0:f.crossTileID)}},vt.prototype.markUsedOrientation=function(c,d,f){for(var m=d===s.WritingMode.horizontal||d===s.WritingMode.horizontalOnly?d:0,E=d===s.WritingMode.vertical?d:0,P=0,L=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];P<L.length;P+=1)c.text.placedSymbolArray.get(L[P]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=E)},vt.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,f=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var m=d?d.symbolFadeChange(c):1,E=d?d.opacities:{},P=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(var F in this.placements){var G=this.placements[F],W=E[F];W?(this.opacities[F]=new Wi(W,m,G.text,G.icon),f=f||G.text!==W.text.placed||G.icon!==W.icon.placed):(this.opacities[F]=new Wi(null,m,G.text,G.icon,G.skipFade),f=f||G.text||G.icon)}for(var te in E){var $=E[te];if(!this.opacities[te]){var re=new Wi($,m,!1,!1);re.isHidden()||(this.opacities[te]=re,f=f||$.text.placed||$.icon.placed)}}for(var se in P)this.variableOffsets[se]||!this.opacities[se]||this.opacities[se].isHidden()||(this.variableOffsets[se]=P[se]);for(var ve in L)this.placedOrientations[ve]||!this.opacities[ve]||this.opacities[ve].isHidden()||(this.placedOrientations[ve]=L[ve]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)},vt.prototype.updateLayerOpacities=function(c,d){for(var f={},m=0,E=d;m<E.length;m+=1){var P=E[m],L=P.getBucket(c);L&&P.latestFeatureIndex&&c.id===L.layerIds[0]&&this.updateBucketOpacities(L,f,P.collisionBoxArray)}},vt.prototype.updateBucketOpacities=function(c,d,f){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var E=c.layers[0].layout,P=new Wi(null,0,!1,!1,!0),L=E.get("text-allow-overlap"),F=E.get("icon-allow-overlap"),G=E.get("text-variable-anchor"),W=E.get("text-rotation-alignment")==="map",te=E.get("text-pitch-alignment")==="map",$=E.get("icon-text-fit")!=="none",re=new Wi(null,0,L&&(F||!c.hasIconData()||E.get("icon-optional")),F&&(L||!c.hasTextData()||E.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var se=function(Ie,He,Je){for(var et=0;et<He/4;et++)Ie.opacityVertexArray.emplaceBack(Je)},ve=function(Ie){var He=c.symbolInstances.get(Ie),Je=He.numHorizontalGlyphVertices,et=He.numVerticalGlyphVertices,Xe=He.crossTileID,Ye=m.opacities[Xe];d[Xe]?Ye=P:Ye||(m.opacities[Xe]=Ye=re),d[Xe]=!0;var pt=He.numIconVertices>0,Ot=m.placedOrientations[He.crossTileID],xt=Ot===s.WritingMode.vertical,Ut=Ot===s.WritingMode.horizontal||Ot===s.WritingMode.horizontalOnly;if(Je>0||et>0){var sr=Ah(Ye.text);se(c.text,Je,xt?ba:sr),se(c.text,et,Ut?ba:sr);var Er=Ye.text.isHidden();[He.rightJustifiedTextSymbolIndex,He.centerJustifiedTextSymbolIndex,He.leftJustifiedTextSymbolIndex].forEach(function(Or){Or>=0&&(c.text.placedSymbolArray.get(Or).hidden=Er||xt?1:0)}),He.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(He.verticalPlacedTextSymbolIndex).hidden=Er||Ut?1:0);var Sr=m.variableOffsets[He.crossTileID];Sr&&m.markUsedJustification(c,Sr.anchor,He,Ot);var xn=m.placedOrientations[He.crossTileID];xn&&(m.markUsedJustification(c,"left",He,xn),m.markUsedOrientation(c,xn,He))}if(pt){var ar=Ah(Ye.icon),Wr=!($&&He.verticalPlacedIconSymbolIndex&&xt);He.placedIconSymbolIndex>=0&&(se(c.icon,He.numIconVertices,Wr?ar:ba),c.icon.placedSymbolArray.get(He.placedIconSymbolIndex).hidden=Ye.icon.isHidden()),He.verticalPlacedIconSymbolIndex>=0&&(se(c.icon,He.numVerticalIconVertices,Wr?ba:ar),c.icon.placedSymbolArray.get(He.verticalPlacedIconSymbolIndex).hidden=Ye.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var rn=c.collisionArrays[Ie];if(rn){var Vr=new s.Point(0,0);if(rn.textBox||rn.verticalTextBox){var Gr=!0;if(G){var qr=m.variableOffsets[Xe];qr?(Vr=Me(qr.anchor,qr.width,qr.height,qr.textOffset,qr.textBoxScale),W&&Vr._rotate(te?m.transform.angle:-m.transform.angle)):Gr=!1}rn.textBox&&Vt(c.textCollisionBox.collisionVertexArray,Ye.text.placed,!Gr||xt,Vr.x,Vr.y),rn.verticalTextBox&&Vt(c.textCollisionBox.collisionVertexArray,Ye.text.placed,!Gr||Ut,Vr.x,Vr.y)}var Fr=!!(!Ut&&rn.verticalIconBox);rn.iconBox&&Vt(c.iconCollisionBox.collisionVertexArray,Ye.icon.placed,Fr,$?Vr.x:0,$?Vr.y:0),rn.verticalIconBox&&Vt(c.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!Fr,$?Vr.x:0,$?Vr.y:0)}}},Pe=0;Pe<c.symbolInstances.length;Pe++)ve(Pe);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var me=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=me.invProjMatrix,c.placementViewportMatrix=me.viewportMatrix,c.collisionCircleArray=me.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},vt.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},vt.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},vt.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},vt.prototype.stillRecent=function(c,d){var f=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*f>c},vt.prototype.setStale=function(){this.stale=!0};var jr=Math.pow(2,25),Ir=Math.pow(2,24),Dn=Math.pow(2,17),Ts=Math.pow(2,16),cs=Math.pow(2,9),to=Math.pow(2,8),Pf=Math.pow(2,1);function Ah(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var d=c.placed?1:0,f=Math.floor(127*c.opacity);return f*jr+d*Ir+f*Dn+d*Ts+f*cs+d*to+f*Pf+d}var ba=0,vc=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};vc.prototype.continuePlacement=function(c,d,f,m,E){for(var P=this._bucketParts;this._currentTileIndex<c.length;)if(d.getBucketParts(P,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(L,F){return L.sortKey-F.sortKey}));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,E())return!0;return!1};var xc=function(c,d,f,m,E,P,L){this.placement=new vt(c,E,P,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};xc.prototype.isDone=function(){return this._done},xc.prototype.continuePlacement=function(c,d,f){for(var m=this,E=s.browser.now(),P=function(){var G=s.browser.now()-E;return!m._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var L=d[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=F)&&(!L.maxzoom||L.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new vc(L)),this._inProgressLayer.continuePlacement(f[L.source],this.placement,this._showCollisionBoxes,L,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},xc.prototype.commit=function(c){return this.placement.commit(c),this.placement};var Lf=512/s.EXTENT/2,wc=function(c,d,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<d.length;m++){var E=d.get(m),P=E.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,c)})}};wc.prototype.getScaledCoordinates=function(c,d){var f=Lf/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*s.EXTENT+c.anchorX)*f),y:Math.floor((d.canonical.y*s.EXTENT+c.anchorY)*f)}},wc.prototype.findMatches=function(c,d,f){for(var m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=0;E<c.length;E++){var P=c.get(E);if(!P.crossTileID){var L=this.indexedSymbolInstances[P.key];if(L)for(var F=this.getScaledCoordinates(P,d),G=0,W=L;G<W.length;G+=1){var te=W[G];if(Math.abs(te.coord.x-F.x)<=m&&Math.abs(te.coord.y-F.y)<=m&&!f[te.crossTileID]){f[te.crossTileID]=!0,P.crossTileID=te.crossTileID;break}}}}};var zs=function(){this.maxCrossTileID=0};zs.prototype.generate=function(){return++this.maxCrossTileID};var Ko=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ko.prototype.handleWrapJump=function(c){var d=Math.round((c-this.lng)/360);if(d!==0)for(var f in this.indexes){var m=this.indexes[f],E={};for(var P in m){var L=m[P];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),E[L.tileID.key]=L}this.indexes[f]=E}this.lng=c},Ko.prototype.addBucket=function(c,d,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<d.symbolInstances.length;m++)d.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var E=this.usedCrossTileIDs[c.overscaledZ];for(var P in this.indexes){var L=this.indexes[P];if(Number(P)>c.overscaledZ)for(var F in L){var G=L[F];G.tileID.isChildOf(c)&&G.findMatches(d.symbolInstances,c,E)}else{var W=L[c.scaledTo(Number(P)).key];W&&W.findMatches(d.symbolInstances,c,E)}}for(var te=0;te<d.symbolInstances.length;te++){var $=d.symbolInstances.get(te);$.crossTileID||($.crossTileID=f.generate(),E[$.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new wc(c,d.symbolInstances,d.bucketInstanceId),!0},Ko.prototype.removeBucketCrossTileIDs=function(c,d){for(var f in d.indexedSymbolInstances)for(var m=0,E=d.indexedSymbolInstances[f];m<E.length;m+=1)delete this.usedCrossTileIDs[c][E[m].crossTileID]},Ko.prototype.removeStaleBuckets=function(c){var d=!1;for(var f in this.indexes){var m=this.indexes[f];for(var E in m)c[m[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[E]),delete m[E],d=!0)}return d};var va=function(){this.layerIndexes={},this.crossTileIDs=new zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};va.prototype.addLayer=function(c,d,f){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Ko);var E=!1,P={};m.handleWrapJump(f);for(var L=0,F=d;L<F.length;L+=1){var G=F[L],W=G.getBucket(c);W&&c.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(G.tileID,W,this.crossTileIDs)&&(E=!0),P[W.bucketInstanceId]=!0)}return m.removeStaleBuckets(P)&&(E=!0),E},va.prototype.pruneUnusedLayers=function(c){var d={};for(var f in c.forEach(function(m){d[m]=!0}),this.layerIndexes)d[f]||delete this.layerIndexes[f]};var Ja=function(c,d){return s.emitValidationErrors(c,d&&d.filter(function(f){return f.identifier!=="source.canvas"}))},xa=s.pick(jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),bi=s.pick(jt,["setCenter","setZoom","setBearing","setPitch"]),Lo=(function(){var c={},d=s.styleSpec.$version;for(var f in s.styleSpec.$root){var m,E=s.styleSpec.$root[f];E.required&&(m=f==="version"?d:E.type==="array"?[]:{})!=null&&(c[f]=m)}return c})(),zn=(function(c){function d(f,m){var E=this;m===void 0&&(m={}),c.call(this),this.map=f,this.dispatcher=new Ee(ht(),this),this.imageManager=new ee,this.imageManager.setEventedParent(this),this.glyphManager=new de(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new ue(256,512),this.crossTileSymbolIndex=new va,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(L){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:L.pluginStatus,pluginURL:L.pluginURL},function(F,G){if(s.triggerPluginCompletionEvent(F),G&&G.every(function(te){return te}))for(var W in P.sourceCaches)P.sourceCaches[W].reload()})}),this.on("data",function(L){if(L.dataType==="source"&&L.sourceDataType==="metadata"){var F=E.sourceCaches[L.sourceId];if(F){var G=F.getSource();if(G&&G.vectorLayerIds)for(var W in E._layers){var te=E._layers[W];te.source===G.id&&E._validateLayer(te)}}}})}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.loadURL=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var P=typeof m.validate=="boolean"?m.validate:!s.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var L=this.map._requestManager.transformRequest(f,s.ResourceType.Style);this._request=s.getJSON(L,function(F,G){E._request=null,F?E.fire(new s.ErrorEvent(F)):G&&E._load(G,P)})},d.prototype.loadJSON=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){E._request=null,E._load(f,m.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Lo,!1)},d.prototype._load=function(f,m){if(!m||!Ja(this,s.validateStyle(f))){for(var E in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(E,f.sources[E],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var P=It(this.stylesheet.layers);this._order=P.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var L=0,F=P;L<F.length;L+=1){var G=F[L];(G=s.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new J(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},d.prototype._loadSprite=function(f){var m=this;this._spriteRequest=(function(E,P,L){var F,G,W,te=s.browser.devicePixelRatio>1?"@2x":"",$=s.getJSON(P.transformRequest(P.normalizeSpriteURL(E,te,".json"),s.ResourceType.SpriteJSON),function(ve,Pe){$=null,W||(W=ve,F=Pe,se())}),re=s.getImage(P.transformRequest(P.normalizeSpriteURL(E,te,".png"),s.ResourceType.SpriteImage),function(ve,Pe){re=null,W||(W=ve,G=Pe,se())});function se(){if(W)L(W);else if(F&&G){var ve=s.browser.getImageData(G),Pe={};for(var me in F){var Ie=F[me],He=Ie.width,Je=Ie.height,et=Ie.x,Xe=Ie.y,Ye=Ie.sdf,pt=Ie.pixelRatio,Ot=Ie.stretchX,xt=Ie.stretchY,Ut=Ie.content,sr=new s.RGBAImage({width:He,height:Je});s.RGBAImage.copy(ve,sr,{x:et,y:Xe},{x:0,y:0},{width:He,height:Je}),Pe[me]={data:sr,pixelRatio:pt,sdf:Ye,stretchX:Ot,stretchY:xt,content:Ut}}L(null,Pe)}}return{cancel:function(){$&&($.cancel(),$=null),re&&(re.cancel(),re=null)}}})(f,this.map._requestManager,function(E,P){if(m._spriteRequest=null,E)m.fire(new s.ErrorEvent(E));else if(P)for(var L in P)m.imageManager.addImage(L,P[L]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new s.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var E=f.sourceLayer;if(E){var P=m.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(E)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+P.id+'" as specified by style layer "'+f.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(f){for(var m=[],E=0,P=f;E<P.length;E+=1){var L=this._layers[P[E]];L.type!=="custom"&&m.push(L.serialize())}return m},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var L in(E.length||P.length)&&this._updateWorkerLayers(E,P),this._updatedSources){var F=this._updatedSources[L];F==="reload"?this._reloadSource(L):F==="clear"&&this._clearSource(L)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var W={};for(var te in this.sourceCaches){var $=this.sourceCaches[te];W[te]=$.used,$.used=!1}for(var re=0,se=this._order;re<se.length;re+=1){var ve=this._layers[se[re]];ve.recalculate(f,this._availableImages),!ve.isHidden(f.zoom)&&ve.source&&(this.sourceCaches[ve.source].used=!0)}for(var Pe in W){var me=this.sourceCaches[Pe];W[Pe]!==me.used&&me.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Pe}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new s.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},d.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(f){var m=this;if(this._checkLoaded(),Ja(this,s.validateStyle(f)))return!1;(f=s.clone$1(f)).layers=It(f.layers);var E=(function(L,F){if(!L)return[{command:jt.setStyle,args:[F]}];var G=[];try{if(!s.deepEqual(L.version,F.version))return[{command:jt.setStyle,args:[F]}];s.deepEqual(L.center,F.center)||G.push({command:jt.setCenter,args:[F.center]}),s.deepEqual(L.zoom,F.zoom)||G.push({command:jt.setZoom,args:[F.zoom]}),s.deepEqual(L.bearing,F.bearing)||G.push({command:jt.setBearing,args:[F.bearing]}),s.deepEqual(L.pitch,F.pitch)||G.push({command:jt.setPitch,args:[F.pitch]}),s.deepEqual(L.sprite,F.sprite)||G.push({command:jt.setSprite,args:[F.sprite]}),s.deepEqual(L.glyphs,F.glyphs)||G.push({command:jt.setGlyphs,args:[F.glyphs]}),s.deepEqual(L.transition,F.transition)||G.push({command:jt.setTransition,args:[F.transition]}),s.deepEqual(L.light,F.light)||G.push({command:jt.setLight,args:[F.light]});var W={},te=[];(function(re,se,ve,Pe){var me;for(me in se=se||{},re=re||{})re.hasOwnProperty(me)&&(se.hasOwnProperty(me)||er(me,ve,Pe));for(me in se)se.hasOwnProperty(me)&&(re.hasOwnProperty(me)?s.deepEqual(re[me],se[me])||(re[me].type==="geojson"&&se[me].type==="geojson"&&cn(re,se,me)?ve.push({command:jt.setGeoJSONSourceData,args:[me,se[me].data]}):en(me,se,ve,Pe)):Nr(me,se,ve))})(L.sources,F.sources,te,W);var $=[];L.layers&&L.layers.forEach(function(re){W[re.source]?G.push({command:jt.removeLayer,args:[re.id]}):$.push(re)}),G=G.concat(te),(function(re,se,ve){se=se||[];var Pe,me,Ie,He,Je,et,Xe,Ye=(re=re||[]).map(Kr),pt=se.map(Kr),Ot=re.reduce(zr,{}),xt=se.reduce(zr,{}),Ut=Ye.slice(),sr=Object.create(null);for(Pe=0,me=0;Pe<Ye.length;Pe++)xt.hasOwnProperty(Ie=Ye[Pe])?me++:(ve.push({command:jt.removeLayer,args:[Ie]}),Ut.splice(Ut.indexOf(Ie,me),1));for(Pe=0,me=0;Pe<pt.length;Pe++)Ut[Ut.length-1-Pe]!==(Ie=pt[pt.length-1-Pe])&&(Ot.hasOwnProperty(Ie)?(ve.push({command:jt.removeLayer,args:[Ie]}),Ut.splice(Ut.lastIndexOf(Ie,Ut.length-me),1)):me++,ve.push({command:jt.addLayer,args:[xt[Ie],et=Ut[Ut.length-Pe]]}),Ut.splice(Ut.length-Pe,0,Ie),sr[Ie]=!0);for(Pe=0;Pe<pt.length;Pe++)if(He=Ot[Ie=pt[Pe]],Je=xt[Ie],!sr[Ie]&&!s.deepEqual(He,Je))if(s.deepEqual(He.source,Je.source)&&s.deepEqual(He["source-layer"],Je["source-layer"])&&s.deepEqual(He.type,Je.type)){for(Xe in Jr(He.layout,Je.layout,ve,Ie,null,jt.setLayoutProperty),Jr(He.paint,Je.paint,ve,Ie,null,jt.setPaintProperty),s.deepEqual(He.filter,Je.filter)||ve.push({command:jt.setFilter,args:[Ie,Je.filter]}),s.deepEqual(He.minzoom,Je.minzoom)&&s.deepEqual(He.maxzoom,Je.maxzoom)||ve.push({command:jt.setLayerZoomRange,args:[Ie,Je.minzoom,Je.maxzoom]}),He)He.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&(Xe.indexOf("paint.")===0?Jr(He[Xe],Je[Xe],ve,Ie,Xe.slice(6),jt.setPaintProperty):s.deepEqual(He[Xe],Je[Xe])||ve.push({command:jt.setLayerProperty,args:[Ie,Xe,Je[Xe]]}));for(Xe in Je)Je.hasOwnProperty(Xe)&&!He.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&(Xe.indexOf("paint.")===0?Jr(He[Xe],Je[Xe],ve,Ie,Xe.slice(6),jt.setPaintProperty):s.deepEqual(He[Xe],Je[Xe])||ve.push({command:jt.setLayerProperty,args:[Ie,Xe,Je[Xe]]}))}else ve.push({command:jt.removeLayer,args:[Ie]}),et=Ut[Ut.lastIndexOf(Ie)+1],ve.push({command:jt.addLayer,args:[Je,et]})})($,F.layers,G)}catch(re){console.warn("Unable to compute style diff:",re),G=[{command:jt.setStyle,args:[F]}]}return G})(this.serialize(),f).filter(function(L){return!(L.command in bi)});if(E.length===0)return!1;var P=E.filter(function(L){return!(L.command in xa)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(L){return L.command}).join(", ")+".");return E.forEach(function(L){L.command!=="setTransition"&&m[L.command].apply(m,L.args)}),this.stylesheet=f,!0},d.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},d.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},d.prototype.getImage=function(f){return this.imageManager.getImage(f)},d.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},d.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(f,m,E){var P=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(s.validateStyle.source,"sources."+f,m,null,E))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var L=this.sourceCaches[f]=new we(f,m,this.dispatcher);L.style=this,L.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:L.serialize(),sourceId:f}}),L.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new s.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var E=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],E.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},d.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},d.prototype.addLayer=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=f.id;if(this.getLayer(P))this.fire(new s.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var L;if(f.type==="custom"){if(Ja(this,s.validateCustomStyleLayer(f)))return;L=s.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(P,f.source),f=s.clone$1(f),f=s.extend(f,{source:P})),this._validate(s.validateStyle.layer,"layers."+P,f,{arrayIndex:-1},E))return;L=s.createStyleLayer(f),this._validateLayer(L),L.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[L.id]=L.serialize()}var F=m?this._order.indexOf(m):this._order.length;if(m&&F===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(F,0,P),this._layerOrderChanged=!0,this._layers[P]=L,this._removedLayers[P]&&L.source&&L.type!=="custom"){var G=this._removedLayers[P];delete this._removedLayers[P],G.type!==L.type?this._updatedSources[L.source]="clear":(this._updatedSources[L.source]="reload",this.sourceCaches[L.source].pause())}this._updateLayer(L),L.onAdd&&L.onAdd(this.map)}}},d.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var E=this._order.indexOf(f);this._order.splice(E,1);var P=m?this._order.indexOf(m):this._order.length;m&&P===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(P,0,f),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var E=this._order.indexOf(f);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(f){return this._layers[f]},d.prototype.hasLayer=function(f){return f in this._layers},d.prototype.setLayerZoomRange=function(f,m,E){this._checkLoaded();var P=this.getLayer(f);P?P.minzoom===m&&P.maxzoom===E||(m!=null&&(P.minzoom=m),E!=null&&(P.maxzoom=E),this._updateLayer(P)):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=this.getLayer(f);if(P){if(!s.deepEqual(P.filter,m))return m==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(s.validateStyle.filter,"layers."+P.id+".filter",m,null,E)||(P.filter=s.clone$1(m),this._updateLayer(P)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(f){return s.clone$1(this.getLayer(f).filter)},d.prototype.setLayoutProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var L=this.getLayer(f);L?s.deepEqual(L.getLayoutProperty(m),E)||(L.setLayoutProperty(m,E,P),this._updateLayer(L)):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(f,m){var E=this.getLayer(f);if(E)return E.getLayoutProperty(m);this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var L=this.getLayer(f);L?s.deepEqual(L.getPaintProperty(m),E)||(L.setPaintProperty(m,E,P)&&this._updateLayer(L),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},d.prototype.setFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=f.sourceLayer,L=this.sourceCaches[E];if(L!==void 0){var F=L.getSource().type;F==="geojson"&&P?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||P?(f.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),L.setFeatureState(P,f.id,m)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type,F=L==="vector"?f.sourceLayer:void 0;L!=="vector"||F?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(F,f.id,m):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,E=f.sourceLayer,P=this.sourceCaches[m];if(P!==void 0){if(P.getSource().type!=="vector"||E)return f.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(E,f.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},d.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,E=function(Ot){return m._layers[Ot].type==="fill-extrusion"},P={},L=[],F=this._order.length-1;F>=0;F--){var G=this._order[F];if(E(G)){P[G]=F;for(var W=0,te=f;W<te.length;W+=1){var $=te[W][G];if($)for(var re=0,se=$;re<se.length;re+=1)L.push(se[re])}}}L.sort(function(Ot,xt){return xt.intersectionZ-Ot.intersectionZ});for(var ve=[],Pe=this._order.length-1;Pe>=0;Pe--){var me=this._order[Pe];if(E(me))for(var Ie=L.length-1;Ie>=0;Ie--){var He=L[Ie].feature;if(P[He.layer.id]<Pe)break;ve.push(He),L.pop()}else for(var Je=0,et=f;Je<et.length;Je+=1){var Xe=et[Je][me];if(Xe)for(var Ye=0,pt=Xe;Ye<pt.length;Ye+=1)ve.push(pt[Ye].feature)}}return ve},d.prototype.queryRenderedFeatures=function(f,m,E){m&&m.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var P={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var L=0,F=m.layers;L<F.length;L+=1){var G=F[L],W=this._layers[G];if(!W)return this.fire(new s.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];P[W.source]=!0}}var te=[];for(var $ in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!P[$]||te.push(Qt(this.sourceCaches[$],this._layers,this._serializedLayers,f,m,E));return this.placement&&te.push((function(re,se,ve,Pe,me,Ie,He){for(var Je={},et=Ie.queryRenderedSymbols(Pe),Xe=[],Ye=0,pt=Object.keys(et).map(Number);Ye<pt.length;Ye+=1)Xe.push(He[pt[Ye]]);Xe.sort(Zt);for(var Ot=function(){var Sr=Ut[xt],xn=Sr.featureIndex.lookupSymbolFeatures(et[Sr.bucketInstanceId],se,Sr.bucketIndex,Sr.sourceLayerIndex,me.filter,me.layers,me.availableImages,re);for(var ar in xn){var Wr=Je[ar]=Je[ar]||[],rn=xn[ar];rn.sort(function(qr,Fr){var Or=Sr.featureSortOrder;if(Or){var Xi=Or.indexOf(qr.featureIndex);return Or.indexOf(Fr.featureIndex)-Xi}return Fr.featureIndex-qr.featureIndex});for(var Vr=0,Gr=rn;Vr<Gr.length;Vr+=1)Wr.push(Gr[Vr])}},xt=0,Ut=Xe;xt<Ut.length;xt+=1)Ot();var sr=function(Sr){Je[Sr].forEach(function(xn){var ar=xn.feature,Wr=ve[re[Sr].source].getFeatureState(ar.layer["source-layer"],ar.id);ar.source=ar.layer.source,ar.layer["source-layer"]&&(ar.sourceLayer=ar.layer["source-layer"]),ar.state=Wr})};for(var Er in Je)sr(Er);return Je})(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(te)},d.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var E=this.sourceCaches[f];return E?(function(P,L){for(var F=P.getRenderableIds().map(function(se){return P.getTileByID(se)}),G=[],W={},te=0;te<F.length;te++){var $=F[te],re=$.tileID.canonical.key;W[re]||(W[re]=!0,$.querySourceFeatures(G,L))}return G})(E,m):[]},d.prototype.addSourceType=function(f,m,E){return d.getSourceType(f)?E(new Error('A source type called "'+f+'" already exists.')):(d.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},E):E(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var E=this.light.getLight(),P=!1;for(var L in f)if(!s.deepEqual(f[L],E[L])){P=!0;break}if(P){var F={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(F)}},d.prototype._validate=function(f,m,E,P,L){return L===void 0&&(L={}),(!L||L.validate!==!1)&&Ja(this,f.call(s.validateStyle,s.extend({key:m,style:this.serialize(),value:E,styleSpec:s.styleSpec},P)))},d.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},d.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},d.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},d.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},d.prototype._updatePlacement=function(f,m,E,P,L){L===void 0&&(L=!1);for(var F=!1,G=!1,W={},te=0,$=this._order;te<$.length;te+=1){var re=this._layers[$[te]];if(re.type==="symbol"){if(!W[re.source]){var se=this.sourceCaches[re.source];W[re.source]=se.getRenderableIds(!0).map(function(He){return se.getTileByID(He)}).sort(function(He,Je){return Je.tileID.overscaledZ-He.tileID.overscaledZ||(He.tileID.isLessThan(Je.tileID)?-1:1)})}var ve=this.crossTileSymbolIndex.addLayer(re,W[re.source],f.center.lng);F=F||ve}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((L=L||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),f.zoom))&&(this.pauseablePlacement=new xc(f,this._order,L,m,E,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),G=!0),F&&this.pauseablePlacement.placement.setStale()),G||F)for(var Pe=0,me=this._order;Pe<me.length;Pe+=1){var Ie=this._layers[me[Pe]];Ie.type==="symbol"&&this.placement.updateLayerOpacities(Ie,W[Ie.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},d.prototype.getImages=function(f,m,E){this.imageManager.getImages(m.icons,E),this._updateTilesForChangedImages();var P=this.sourceCaches[m.source];P&&P.setDependencies(m.tileID.key,m.type,m.icons)},d.prototype.getGlyphs=function(f,m,E){this.glyphManager.getGlyphs(m.stacks,E)},d.prototype.getResource=function(f,m,E){return s.makeRequest(m,E)},d})(s.Evented);zn.getSourceType=function(c){return st[c]},zn.setSourceType=function(c,d){st[c]=d},zn.registerForPluginStateChange=s.registerForPluginStateChange;var fi=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ka=In(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Cc=In(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),sA=In(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),oA=In(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),gh=In("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),lu=In(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ml=In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xo=In("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),mh=In("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_h=In("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),cu=In(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),xo=In(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ro=In(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),yh=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Gi=In(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ec=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),wa=In(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ca=In(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ea=In(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Xa=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ba=In(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Qa=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Za=In(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ta=In(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Rf=In(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Of=In(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function In(c,d){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=d.match(/attribute ([\w]+) ([\w]+)/g),E=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=P?P.concat(E):E,F={};return{fragmentSource:c=c.replace(f,function(G,W,te,$,re){return F[re]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
varying `+te+" "+$+" "+re+`;
#else
uniform `+te+" "+$+" u_"+re+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+re+`
    `+te+" "+$+" "+re+" = u_"+re+`;
#endif
`}),vertexSource:d=d.replace(f,function(G,W,te,$,re){var se=$==="float"?"vec2":"vec4",ve=re.match(/color/)?"color":se;return F[re]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+se+" a_"+re+`;
varying `+te+" "+$+" "+re+`;
#else
uniform `+te+" "+$+" u_"+re+`;
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = a_"+re+`;
#else
    `+te+" "+$+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = unpack_mix_"+ve+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+$+" "+re+" = u_"+re+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+te+" "+se+" a_"+re+`;
#else
uniform `+te+" "+$+" u_"+re+`;
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+$+" "+re+" = a_"+re+`;
#else
    `+te+" "+$+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+te+" "+$+" "+re+" = unpack_mix_"+ve+"(a_"+re+", u_"+re+`_t);
#else
    `+te+" "+$+" "+re+" = u_"+re+`;
#endif
`}),staticAttributes:m,staticUniforms:L}}var uu=Object.freeze({__proto__:null,prelude:Ka,background:Cc,backgroundPattern:sA,circle:oA,clippingMask:gh,heatmap:lu,heatmapTexture:Ml,collisionBox:Xo,collisionCircle:mh,debug:_h,fill:cu,fillOutline:xo,fillOutlinePattern:ro,fillPattern:yh,fillExtrusion:Gi,fillExtrusionPattern:Ec,hillshadePrepare:wa,hillshade:Ca,line:Ea,lineGradient:Xa,linePattern:Ba,lineSDF:Qa,raster:Za,symbolIcon:Ta,symbolSDF:Rf,symbolTextAndIcon:Of}),hu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Df(c){for(var d=[],f=0;f<c.length;f++)if(c[f]!==null){var m=c[f].split(" ");d.push(m.pop())}return d}hu.prototype.bind=function(c,d,f,m,E,P,L,F){this.context=c;for(var G=this.boundPaintVertexBuffers.length!==m.length,W=0;!G&&W<m.length;W++)this.boundPaintVertexBuffers[W]!==m[W]&&(G=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===f&&!G&&this.boundIndexBuffer===E&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===L&&this.boundDynamicVertexBuffer2===F?(c.bindVertexArrayOES.set(this.vao),L&&L.bind(),E&&E.dynamicDraw&&E.bind(),F&&F.bind()):this.freshBind(d,f,m,E,P,L,F)},hu.prototype.freshBind=function(c,d,f,m,E,P,L){var F,G=c.numAttributes,W=this.context,te=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=L;else{F=W.currentNumAttributes||0;for(var $=G;$<F;$++)te.disableVertexAttribArray($)}d.enableAttributes(te,c);for(var re=0,se=f;re<se.length;re+=1)se[re].enableAttributes(te,c);P&&P.enableAttributes(te,c),L&&L.enableAttributes(te,c),d.bind(),d.setVertexAttribPointers(te,c,E);for(var ve=0,Pe=f;ve<Pe.length;ve+=1){var me=Pe[ve];me.bind(),me.setVertexAttribPointers(te,c,E)}P&&(P.bind(),P.setVertexAttribPointers(te,c,E)),m&&m.bind(),L&&(L.bind(),L.setVertexAttribPointers(te,c,E)),W.currentNumAttributes=G},hu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ff=function(c,d,f,m,E,P){var L=c.gl;this.program=L.createProgram();for(var F=Df(f.staticAttributes),G=m?m.getBinderAttributes():[],W=F.concat(G),te=f.staticUniforms?Df(f.staticUniforms):[],$=m?m.getBinderUniforms():[],re=[],se=0,ve=te.concat($);se<ve.length;se+=1){var Pe=ve[se];re.indexOf(Pe)<0&&re.push(Pe)}var me=m?m.defines():[];P&&me.push("#define OVERDRAW_INSPECTOR;");var Ie=me.concat(Ka.fragmentSource,f.fragmentSource).join(`
`),He=me.concat(Ka.vertexSource,f.vertexSource).join(`
`),Je=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(Je,Ie),L.compileShader(Je),L.attachShader(this.program,Je);var et=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(et,He),L.compileShader(et),L.attachShader(this.program,et),this.attributes={};var Xe={};this.numAttributes=W.length;for(var Ye=0;Ye<this.numAttributes;Ye++)W[Ye]&&(L.bindAttribLocation(this.program,Ye,W[Ye]),this.attributes[W[Ye]]=Ye);L.linkProgram(this.program),L.deleteShader(et),L.deleteShader(Je);for(var pt=0;pt<re.length;pt++){var Ot=re[pt];if(Ot&&!Xe[Ot]){var xt=L.getUniformLocation(this.program,Ot);xt&&(Xe[Ot]=xt)}}this.fixedUniforms=E(c,Xe),this.binderUniforms=m?m.getUniforms(c,Xe):[]}}};function Pl(c,d,f){var m=1/Ln(f,1,d.transform.tileZoom),E=Math.pow(2,f.tileID.overscaledZ),P=f.tileSize*Math.pow(2,d.transform.tileZoom)/E,L=P*(f.tileID.canonical.x+f.tileID.wrap*E),F=P*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[L>>16,F>>16],u_pixel_coord_lower:[65535&L,65535&F]}}Ff.prototype.draw=function(c,d,f,m,E,P,L,F,G,W,te,$,re,se,ve,Pe){var me,Ie=c.gl;if(!this.failedToCreate){for(var He in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(m),c.setColorMode(E),c.setCullFace(P),this.fixedUniforms)this.fixedUniforms[He].set(L[He]);se&&se.setUniforms(c,this.binderUniforms,$,{zoom:re});for(var Je=(me={},me[Ie.LINES]=2,me[Ie.TRIANGLES]=3,me[Ie.LINE_STRIP]=1,me)[d],et=0,Xe=te.get();et<Xe.length;et+=1){var Ye=Xe[et],pt=Ye.vaos||(Ye.vaos={});(pt[F]||(pt[F]=new hu)).bind(c,this,G,se?se.getPaintVertexBuffers():[],W,Ye.vertexOffset,ve,Pe),Ie.drawElements(d,Ye.primitiveLength*Je,Ie.UNSIGNED_SHORT,Ye.primitiveOffset*Je*2)}}};var kf=function(c,d,f,m){var E=d.style.light,P=E.properties.get("position"),L=[P.x,P.y,P.z],F=s.create$1();E.properties.get("anchor")==="viewport"&&s.fromRotation(F,-d.transform.angle),s.transformMat3(L,L,F);var G=E.properties.get("color");return{u_matrix:c,u_lightpos:L,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+f,u_opacity:m}},Qo=function(c,d,f,m,E,P,L){return s.extend(kf(c,d,f,m),Pl(P,d,L),{u_height_factor:-Math.pow(2,E.overscaledZ)/L.tileSize/8})},Zo=function(c){return{u_matrix:c}},no=function(c,d,f,m){return s.extend(Zo(c),Pl(f,d,m))},Nf=function(c,d){return{u_matrix:c,u_world:d}},fu=function(c,d,f,m,E){return s.extend(no(c,d,f,m),{u_world:E})},du=function(c,d,f,m){var E,P,L=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var F=Ln(f,1,L.zoom);E=!0,P=[F,F]}else E=!1,P=L.pixelsToGLUnits;return{u_camera_to_center_distance:L.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(d.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:P}},$a=function(c,d,f){var m=Ln(f,1,d.zoom),E=Math.pow(2,d.zoom-f.tileID.overscaledZ),P=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[d.pixelsToGLUnits[0]/(m*E),d.pixelsToGLUnits[1]/(m*E)],u_overscale_factor:P}},bh=function(c,d,f){return{u_matrix:c,u_inv_matrix:d,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},$o=function(c,d,f){return f===void 0&&(f=1),{u_matrix:c,u_color:d,u_overlay:0,u_overlay_scale:f}},qo=function(c){return{u_matrix:c}},Bc=function(c,d,f,m){return{u_matrix:c,u_extrude_scale:Ln(d,1,f),u_intensity:m}},Rn=function(c,d,f){var m=c.transform;return{u_matrix:Uf(c,d,f),u_ratio:1/Ln(d,1,m.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Fn=function(c,d,f,m){return s.extend(Rn(c,d,f),{u_image:0,u_image_height:m})},pu=function(c,d,f,m){var E=c.transform,P=Ll(d,E);return{u_matrix:Uf(c,d,f),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Ln(d,1,E.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},aA=function(c,d,f,m,E){var P=c.lineAtlas,L=Ll(d,c.transform),F=f.layout.get("line-cap")==="round",G=P.getDash(m.from,F),W=P.getDash(m.to,F),te=G.width*E.fromScale,$=W.width*E.toScale;return s.extend(Rn(c,d,f),{u_patternscale_a:[L/te,-G.height/2],u_patternscale_b:[L/$,-W.height/2],u_sdfgamma:P.width/(256*Math.min(te,$)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:W.y,u_mix:E.t})};function Ll(c,d){return 1/Ln(c,1,d.tileZoom)}function Uf(c,d,f){return c.translatePosMatrix(d.tileID.posMatrix,d,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var lA=function(c,d,f,m,E){return{u_matrix:c,u_tl_parent:d,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(L=E.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(P=E.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Gf(E.paint.get("raster-hue-rotate"))};var P,L};function Gf(c){c*=Math.PI/180;var d=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*d-f+1)/3,(Math.sqrt(3)*d-f+1)/3]}var ts,Sa=function(c,d,f,m,E,P,L,F,G,W){var te=E.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:te.width/te.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:L,u_coord_matrix:F,u_is_text:+G,u_pitch_with_map:+m,u_texsize:W,u_texture:0}},wo=function(c,d,f,m,E,P,L,F,G,W,te){var $=E.transform;return s.extend(Sa(c,d,f,m,E,P,L,F,G,W),{u_gamma_scale:m?Math.cos($._pitch)*$.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},Au=function(c,d,f,m,E,P,L,F,G,W){return s.extend(wo(c,d,f,m,E,P,L,F,!0,G),{u_texsize_icon:W,u_texture_icon:1})},qa=function(c,d,f){return{u_matrix:c,u_opacity:d,u_color:f}},Rl=function(c,d,f,m,E,P){return s.extend((function(L,F,G,W){var te=G.imageManager.getPattern(L.from.toString()),$=G.imageManager.getPattern(L.to.toString()),re=G.imageManager.getPixelSize(),se=re.width,ve=re.height,Pe=Math.pow(2,W.tileID.overscaledZ),me=W.tileSize*Math.pow(2,G.transform.tileZoom)/Pe,Ie=me*(W.tileID.canonical.x+W.tileID.wrap*Pe),He=me*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:te.tl,u_pattern_br_a:te.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[se,ve],u_mix:F.t,u_pattern_size_a:te.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Ln(W,1,G.transform.tileZoom),u_pixel_coord_upper:[Ie>>16,He>>16],u_pixel_coord_lower:[65535&Ie,65535&He]}})(m,P,f,E),{u_matrix:c,u_opacity:d})},js={fillExtrusion:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_lightpos:new s.Uniform3f(c,d.u_lightpos),u_lightintensity:new s.Uniform1f(c,d.u_lightintensity),u_lightcolor:new s.Uniform3f(c,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,d.u_vertical_gradient),u_opacity:new s.Uniform1f(c,d.u_opacity)}},fillExtrusionPattern:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_lightpos:new s.Uniform3f(c,d.u_lightpos),u_lightintensity:new s.Uniform1f(c,d.u_lightintensity),u_lightcolor:new s.Uniform3f(c,d.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,d.u_vertical_gradient),u_height_factor:new s.Uniform1f(c,d.u_height_factor),u_image:new s.Uniform1i(c,d.u_image),u_texsize:new s.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,d.u_scale),u_fade:new s.Uniform1f(c,d.u_fade),u_opacity:new s.Uniform1f(c,d.u_opacity)}},fill:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix)}},fillPattern:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_image:new s.Uniform1i(c,d.u_image),u_texsize:new s.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,d.u_scale),u_fade:new s.Uniform1f(c,d.u_fade)}},fillOutline:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_world:new s.Uniform2f(c,d.u_world)}},fillOutlinePattern:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_world:new s.Uniform2f(c,d.u_world),u_image:new s.Uniform1i(c,d.u_image),u_texsize:new s.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,d.u_scale),u_fade:new s.Uniform1f(c,d.u_fade)}},circle:function(c,d){return{u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(c,d.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(c,d.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(c,d.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(c,d.u_matrix)}},collisionBox:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(c,d.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(c,d.u_extrude_scale),u_overscale_factor:new s.Uniform1f(c,d.u_overscale_factor)}},collisionCircle:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_inv_matrix:new s.UniformMatrix4f(c,d.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(c,d.u_viewport_size)}},debug:function(c,d){return{u_color:new s.UniformColor(c,d.u_color),u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_overlay:new s.Uniform1i(c,d.u_overlay),u_overlay_scale:new s.Uniform1f(c,d.u_overlay_scale)}},clippingMask:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix)}},heatmap:function(c,d){return{u_extrude_scale:new s.Uniform1f(c,d.u_extrude_scale),u_intensity:new s.Uniform1f(c,d.u_intensity),u_matrix:new s.UniformMatrix4f(c,d.u_matrix)}},heatmapTexture:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_world:new s.Uniform2f(c,d.u_world),u_image:new s.Uniform1i(c,d.u_image),u_color_ramp:new s.Uniform1i(c,d.u_color_ramp),u_opacity:new s.Uniform1f(c,d.u_opacity)}},hillshade:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_image:new s.Uniform1i(c,d.u_image),u_latrange:new s.Uniform2f(c,d.u_latrange),u_light:new s.Uniform2f(c,d.u_light),u_shadow:new s.UniformColor(c,d.u_shadow),u_highlight:new s.UniformColor(c,d.u_highlight),u_accent:new s.UniformColor(c,d.u_accent)}},hillshadePrepare:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_image:new s.Uniform1i(c,d.u_image),u_dimension:new s.Uniform2f(c,d.u_dimension),u_zoom:new s.Uniform1f(c,d.u_zoom),u_unpack:new s.Uniform4f(c,d.u_unpack)}},line:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_ratio:new s.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,d.u_units_to_pixels)}},lineGradient:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_ratio:new s.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,d.u_units_to_pixels),u_image:new s.Uniform1i(c,d.u_image),u_image_height:new s.Uniform1f(c,d.u_image_height)}},linePattern:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_texsize:new s.Uniform2f(c,d.u_texsize),u_ratio:new s.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_image:new s.Uniform1i(c,d.u_image),u_units_to_pixels:new s.Uniform2f(c,d.u_units_to_pixels),u_scale:new s.Uniform3f(c,d.u_scale),u_fade:new s.Uniform1f(c,d.u_fade)}},lineSDF:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_ratio:new s.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,d.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(c,d.u_patternscale_a),u_patternscale_b:new s.Uniform2f(c,d.u_patternscale_b),u_sdfgamma:new s.Uniform1f(c,d.u_sdfgamma),u_image:new s.Uniform1i(c,d.u_image),u_tex_y_a:new s.Uniform1f(c,d.u_tex_y_a),u_tex_y_b:new s.Uniform1f(c,d.u_tex_y_b),u_mix:new s.Uniform1f(c,d.u_mix)}},raster:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_tl_parent:new s.Uniform2f(c,d.u_tl_parent),u_scale_parent:new s.Uniform1f(c,d.u_scale_parent),u_buffer_scale:new s.Uniform1f(c,d.u_buffer_scale),u_fade_t:new s.Uniform1f(c,d.u_fade_t),u_opacity:new s.Uniform1f(c,d.u_opacity),u_image0:new s.Uniform1i(c,d.u_image0),u_image1:new s.Uniform1i(c,d.u_image1),u_brightness_low:new s.Uniform1f(c,d.u_brightness_low),u_brightness_high:new s.Uniform1f(c,d.u_brightness_high),u_saturation_factor:new s.Uniform1f(c,d.u_saturation_factor),u_contrast_factor:new s.Uniform1f(c,d.u_contrast_factor),u_spin_weights:new s.Uniform3f(c,d.u_spin_weights)}},symbolIcon:function(c,d){return{u_is_size_zoom_constant:new s.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,d.u_size_t),u_size:new s.Uniform1f(c,d.u_size),u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,d.u_pitch),u_rotate_symbol:new s.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,d.u_fade_change),u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new s.Uniform1i(c,d.u_is_text),u_pitch_with_map:new s.Uniform1i(c,d.u_pitch_with_map),u_texsize:new s.Uniform2f(c,d.u_texsize),u_texture:new s.Uniform1i(c,d.u_texture)}},symbolSDF:function(c,d){return{u_is_size_zoom_constant:new s.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,d.u_size_t),u_size:new s.Uniform1f(c,d.u_size),u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,d.u_pitch),u_rotate_symbol:new s.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,d.u_fade_change),u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new s.Uniform1i(c,d.u_is_text),u_pitch_with_map:new s.Uniform1i(c,d.u_pitch_with_map),u_texsize:new s.Uniform2f(c,d.u_texsize),u_texture:new s.Uniform1i(c,d.u_texture),u_gamma_scale:new s.Uniform1f(c,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,d.u_is_halo)}},symbolTextAndIcon:function(c,d){return{u_is_size_zoom_constant:new s.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,d.u_size_t),u_size:new s.Uniform1f(c,d.u_size),u_camera_to_center_distance:new s.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,d.u_pitch),u_rotate_symbol:new s.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,d.u_fade_change),u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new s.Uniform1i(c,d.u_is_text),u_pitch_with_map:new s.Uniform1i(c,d.u_pitch_with_map),u_texsize:new s.Uniform2f(c,d.u_texsize),u_texsize_icon:new s.Uniform2f(c,d.u_texsize_icon),u_texture:new s.Uniform1i(c,d.u_texture),u_texture_icon:new s.Uniform1i(c,d.u_texture_icon),u_gamma_scale:new s.Uniform1f(c,d.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,d.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,d.u_is_halo)}},background:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_opacity:new s.Uniform1f(c,d.u_opacity),u_color:new s.UniformColor(c,d.u_color)}},backgroundPattern:function(c,d){return{u_matrix:new s.UniformMatrix4f(c,d.u_matrix),u_opacity:new s.Uniform1f(c,d.u_opacity),u_image:new s.Uniform1i(c,d.u_image),u_pattern_tl_a:new s.Uniform2f(c,d.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(c,d.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(c,d.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(c,d.u_pattern_br_b),u_texsize:new s.Uniform2f(c,d.u_texsize),u_mix:new s.Uniform1f(c,d.u_mix),u_pattern_size_a:new s.Uniform2f(c,d.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(c,d.u_pattern_size_b),u_scale_a:new s.Uniform1f(c,d.u_scale_a),u_scale_b:new s.Uniform1f(c,d.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,d.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(c,d.u_tile_units_to_pixels)}}};function Ya(c,d,f,m,E,P,L){for(var F=c.context,G=F.gl,W=c.useProgram("collisionBox"),te=[],$=0,re=0,se=0;se<m.length;se++){var ve=m[se],Pe=d.getTile(ve),me=Pe.getBucket(f);if(me){var Ie=ve.posMatrix;E[0]===0&&E[1]===0||(Ie=c.translatePosMatrix(ve.posMatrix,Pe,E,P));var He=L?me.textCollisionBox:me.iconCollisionBox,Je=me.collisionCircleArray;if(Je.length>0){var et=s.create(),Xe=Ie;s.mul(et,me.placementInvProjMatrix,c.transform.glCoordMatrix),s.mul(et,et,me.placementViewportMatrix),te.push({circleArray:Je,circleOffset:re,transform:Xe,invTransform:et}),re=$+=Je.length/4}He&&W.draw(F,G.LINES,ye.disabled,Oe.disabled,c.colorModeForRenderPass(),be.disabled,$a(Ie,c.transform,Pe),f.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,c.transform.zoom,null,null,He.collisionVertexBuffer)}}if(L&&te.length){var Ye=c.useProgram("collisionCircle"),pt=new s.StructArrayLayout2f1f2i16;pt.resize(4*$),pt._trim();for(var Ot=0,xt=0,Ut=te;xt<Ut.length;xt+=1)for(var sr=Ut[xt],Er=0;Er<sr.circleArray.length/4;Er++){var Sr=4*Er,xn=sr.circleArray[Sr+0],ar=sr.circleArray[Sr+1],Wr=sr.circleArray[Sr+2],rn=sr.circleArray[Sr+3];pt.emplace(Ot++,xn,ar,Wr,rn,0),pt.emplace(Ot++,xn,ar,Wr,rn,1),pt.emplace(Ot++,xn,ar,Wr,rn,2),pt.emplace(Ot++,xn,ar,Wr,rn,3)}(!ts||ts.length<2*$)&&(ts=(function(Ti){var ys=2*Ti,ss=new s.StructArrayLayout3ui6;ss.resize(ys),ss._trim();for(var vi=0;vi<ys;vi++){var Pi=6*vi;ss.uint16[Pi+0]=4*vi+0,ss.uint16[Pi+1]=4*vi+1,ss.uint16[Pi+2]=4*vi+2,ss.uint16[Pi+3]=4*vi+2,ss.uint16[Pi+4]=4*vi+3,ss.uint16[Pi+5]=4*vi+0}return ss})($));for(var Vr=F.createIndexBuffer(ts,!0),Gr=F.createVertexBuffer(pt,s.collisionCircleLayout.members,!0),qr=0,Fr=te;qr<Fr.length;qr+=1){var Or=Fr[qr],Xi=bh(Or.transform,Or.invTransform,c.transform);Ye.draw(F,G.TRIANGLES,ye.disabled,Oe.disabled,c.colorModeForRenderPass(),be.disabled,Xi,f.id,Gr,Vr,s.SegmentVector.simpleSegment(0,2*Or.circleOffset,Or.circleArray.length,Or.circleArray.length/2),null,c.transform.zoom,null,null,null)}Gr.destroy(),Vr.destroy()}}var Hs=s.identity(new Float32Array(16));function el(c,d,f,m,E,P){var L=s.getAnchorAlignment(c),F=-(L.horizontalAlign-.5)*d,G=-(L.verticalAlign-.5)*f,W=s.evaluateVariableOffset(c,m);return new s.Point((F/E+W[0])*P,(G/E+W[1])*P)}function Ol(c,d,f,m,E,P,L,F,G,W,te){var $=c.text.placedSymbolArray,re=c.text.dynamicLayoutVertexArray,se=c.icon.dynamicLayoutVertexArray,ve={};re.clear();for(var Pe=0;Pe<$.length;Pe++){var me=$.get(Pe),Ie=me.hidden||!me.crossTileID||c.allowVerticalPlacement&&!me.placedOrientation?null:m[me.crossTileID];if(Ie){var He=new s.Point(me.anchorX,me.anchorY),Je=Xt(He,f?F:L),et=tn(P.cameraToCenterDistance,Je.signedDistanceFromCamera),Xe=E.evaluateSizeForFeature(c.textSizeData,W,me)*et/s.ONE_EM;f&&(Xe*=c.tilePixelRatio/G);for(var Ye=el(Ie.anchor,Ie.width,Ie.height,Ie.textOffset,Ie.textBoxScale,Xe),pt=f?Xt(He.add(Ye),L).point:Je.point.add(d?Ye.rotate(-P.angle):Ye),Ot=c.allowVerticalPlacement&&me.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,xt=0;xt<me.numGlyphs;xt++)s.addDynamicAttributes(re,pt,Ot);te&&me.associatedIconIndex>=0&&(ve[me.associatedIconIndex]={shiftedAnchor:pt,angle:Ot})}else Fi(me.numGlyphs,re)}if(te){se.clear();for(var Ut=c.icon.placedSymbolArray,sr=0;sr<Ut.length;sr++){var Er=Ut.get(sr);if(Er.hidden)Fi(Er.numGlyphs,se);else{var Sr=ve[sr];if(Sr)for(var xn=0;xn<Er.numGlyphs;xn++)s.addDynamicAttributes(se,Sr.shiftedAnchor,Sr.angle);else Fi(Er.numGlyphs,se)}}c.icon.dynamicLayoutVertexBuffer.updateData(se)}c.text.dynamicLayoutVertexBuffer.updateData(re)}function Dl(c,d,f){return f.iconsInText&&d?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function tl(c,d,f,m,E,P,L,F,G,W,te,$){for(var re=c.context,se=re.gl,ve=c.transform,Pe=F==="map",me=G==="map",Ie=Pe&&f.layout.get("symbol-placement")!=="point",He=Pe&&!me&&!Ie,Je=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,et=!1,Xe=c.depthModeForSublayer(0,ye.ReadOnly),Ye=f.layout.get("text-variable-anchor"),pt=[],Ot=0,xt=m;Ot<xt.length;Ot+=1){var Ut=xt[Ot],sr=d.getTile(Ut),Er=sr.getBucket(f);if(Er){var Sr=E?Er.text:Er.icon;if(Sr&&Sr.segments.get().length){var xn=Sr.programConfigurations.get(f.id),ar=E||Er.sdfIcons,Wr=E?Er.textSizeData:Er.iconSizeData,rn=me||ve.pitch!==0,Vr=c.useProgram(Dl(ar,E,Er),xn),Gr=s.evaluateSizeForZoom(Wr,ve.zoom),qr=void 0,Fr=[0,0],Or=void 0,Xi=void 0,Ti=null,ys=void 0;if(E)Or=sr.glyphAtlasTexture,Xi=se.LINEAR,qr=sr.glyphAtlasTexture.size,Er.iconsInText&&(Fr=sr.imageAtlasTexture.size,Ti=sr.imageAtlasTexture,ys=rn||c.options.rotating||c.options.zooming||Wr.kind==="composite"||Wr.kind==="camera"?se.LINEAR:se.NEAREST);else{var ss=f.layout.get("icon-size").constantOr(0)!==1||Er.iconsNeedLinear;Or=sr.imageAtlasTexture,Xi=ar||c.options.rotating||c.options.zooming||ss||rn?se.LINEAR:se.NEAREST,qr=sr.imageAtlasTexture.size}var vi=Ln(sr,1,c.transform.zoom),Pi=mr(Ut.posMatrix,me,Pe,c.transform,vi),co=Be(Ut.posMatrix,me,Pe,c.transform,vi),Ps=Ye&&Er.hasTextData(),Hl=f.layout.get("icon-text-fit")!=="none"&&Ps&&Er.hasIconData();Ie&&ya(Er,Ut.posMatrix,c,E,Pi,co,me,W);var Ks=c.translatePosMatrix(Ut.posMatrix,sr,P,L),oa=Ie||E&&Ye||Hl?Hs:Pi,Fo=c.translatePosMatrix(co,sr,P,L,!0),Ih=ar&&f.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Tu={program:Vr,buffers:Sr,uniformValues:ar?Er.iconsInText?Au(Wr.kind,Gr,He,me,c,Ks,oa,Fo,qr,Fr):wo(Wr.kind,Gr,He,me,c,Ks,oa,Fo,E,qr):Sa(Wr.kind,Gr,He,me,c,Ks,oa,Fo,E,qr),atlasTexture:Or,atlasTextureIcon:Ti,atlasInterpolation:Xi,atlasInterpolationIcon:ys,isSDF:ar,hasHalo:Ih};if(Je&&Er.canOverlap){et=!0;for(var Vl=0,Su=Sr.segments.get();Vl<Su.length;Vl+=1){var Mh=Su[Vl];pt.push({segments:new s.SegmentVector([Mh]),sortKey:Mh.sortKey,state:Tu})}}else pt.push({segments:Sr.segments,sortKey:0,state:Tu})}}}et&&pt.sort(function(Wl,Dc){return Wl.sortKey-Dc.sortKey});for(var Ma=0,Ph=pt;Ma<Ph.length;Ma+=1){var Pa=Ph[Ma],Qi=Pa.state;if(re.activeTexture.set(se.TEXTURE0),Qi.atlasTexture.bind(Qi.atlasInterpolation,se.CLAMP_TO_EDGE),Qi.atlasTextureIcon&&(re.activeTexture.set(se.TEXTURE1),Qi.atlasTextureIcon&&Qi.atlasTextureIcon.bind(Qi.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),Qi.isSDF){var sl=Qi.uniformValues;Qi.hasHalo&&(sl.u_is_halo=1,Fl(Qi.buffers,Pa.segments,f,c,Qi.program,Xe,te,$,sl)),sl.u_is_halo=0}Fl(Qi.buffers,Pa.segments,f,c,Qi.program,Xe,te,$,Qi.uniformValues)}}function Fl(c,d,f,m,E,P,L,F,G){var W=m.context;E.draw(W,W.gl.TRIANGLES,P,L,F,be.disabled,G,f.id,c.layoutVertexBuffer,c.indexBuffer,d,f.paint,m.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function gu(c,d,f,m,E,P,L){var F,G,W,te,$,re=c.context.gl,se=f.paint.get("fill-pattern"),ve=se&&se.constantOr(1),Pe=f.getCrossfadeParameters();L?(G=ve&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=re.LINES):(G=ve?"fillPattern":"fill",F=re.TRIANGLES);for(var me=0,Ie=m;me<Ie.length;me+=1){var He=Ie[me],Je=d.getTile(He);if(!ve||Je.patternsLoaded()){var et=Je.getBucket(f);if(et){var Xe=et.programConfigurations.get(f.id),Ye=c.useProgram(G,Xe);ve&&(c.context.activeTexture.set(re.TEXTURE0),Je.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Xe.updatePaintBuffers(Pe));var pt=se.constantOr(null);if(pt&&Je.imageAtlas){var Ot=Je.imageAtlas,xt=Ot.patternPositions[pt.to.toString()],Ut=Ot.patternPositions[pt.from.toString()];xt&&Ut&&Xe.setConstantPatternPositions(xt,Ut)}var sr=c.translatePosMatrix(He.posMatrix,Je,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(L){te=et.indexBuffer2,$=et.segments2;var Er=[re.drawingBufferWidth,re.drawingBufferHeight];W=G==="fillOutlinePattern"&&ve?fu(sr,c,Pe,Je,Er):Nf(sr,Er)}else te=et.indexBuffer,$=et.segments,W=ve?no(sr,c,Pe,Je):Zo(sr);Ye.draw(c.context,F,E,c.stencilModeForClipping(He),P,be.disabled,W,f.id,et.layoutVertexBuffer,te,$,f.paint,c.transform.zoom,Xe)}}}}function Tc(c,d,f,m,E,P,L){for(var F=c.context,G=F.gl,W=f.paint.get("fill-extrusion-pattern"),te=W.constantOr(1),$=f.getCrossfadeParameters(),re=f.paint.get("fill-extrusion-opacity"),se=0,ve=m;se<ve.length;se+=1){var Pe=ve[se],me=d.getTile(Pe),Ie=me.getBucket(f);if(Ie){var He=Ie.programConfigurations.get(f.id),Je=c.useProgram(te?"fillExtrusionPattern":"fillExtrusion",He);te&&(c.context.activeTexture.set(G.TEXTURE0),me.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),He.updatePaintBuffers($));var et=W.constantOr(null);if(et&&me.imageAtlas){var Xe=me.imageAtlas,Ye=Xe.patternPositions[et.to.toString()],pt=Xe.patternPositions[et.from.toString()];Ye&&pt&&He.setConstantPatternPositions(Ye,pt)}var Ot=c.translatePosMatrix(Pe.posMatrix,me,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),xt=f.paint.get("fill-extrusion-vertical-gradient"),Ut=te?Qo(Ot,c,xt,re,Pe,$,me):kf(Ot,c,xt,re);Je.draw(F,F.gl.TRIANGLES,E,P,L,be.backCCW,Ut,f.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,f.paint,c.transform.zoom,He)}}}function mu(c,d,f,m,E,P){var L=c.context,F=L.gl,G=d.fbo;if(G){var W=c.useProgram("hillshade");L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.colorAttachment.get());var te=(function($,re,se){var ve=se.paint.get("hillshade-shadow-color"),Pe=se.paint.get("hillshade-highlight-color"),me=se.paint.get("hillshade-accent-color"),Ie=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=$.transform.angle);var He,Je,et,Xe=!$.options.moving;return{u_matrix:$.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:(He=re.tileID,Je=Math.pow(2,He.canonical.z),et=He.canonical.y,[new s.MercatorCoordinate(0,et/Je).toLngLat().lat,new s.MercatorCoordinate(0,(et+1)/Je).toLngLat().lat]),u_light:[se.paint.get("hillshade-exaggeration"),Ie],u_shadow:ve,u_highlight:Pe,u_accent:me}})(c,d,f);W.draw(L,F.TRIANGLES,m,E,P,be.disabled,te,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function cA(c,d,f,m,E,P){var L=c.context,F=L.gl,G=d.dem;if(G&&G.data){var W=G.dim,te=G.stride,$=G.getPixels();if(L.activeTexture.set(F.TEXTURE1),L.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||c.getTileTexture(te),d.demTexture){var re=d.demTexture;re.update($,{premultiply:!1}),re.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new s.Texture(L,$,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);L.activeTexture.set(F.TEXTURE0);var se=d.fbo;if(!se){var ve=new s.Texture(L,{width:W,height:W,data:null},F.RGBA);ve.bind(F.LINEAR,F.CLAMP_TO_EDGE),(se=d.fbo=L.createFramebuffer(W,W,!0)).colorAttachment.set(ve.texture)}L.bindFramebuffer.set(se.framebuffer),L.viewport.set([0,0,W,W]),c.useProgram("hillshadePrepare").draw(L,F.TRIANGLES,m,E,P,be.disabled,(function(Pe,me){var Ie=me.stride,He=s.create();return s.ortho(He,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(He,He,[0,-s.EXTENT,0]),{u_matrix:He,u_image:1,u_dimension:[Ie,Ie],u_zoom:Pe.overscaledZ,u_unpack:me.getUnpackVector()}})(d.tileID,G),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Sc(c,d,f,m,E){var P=m.paint.get("raster-fade-duration");if(P>0){var L=s.browser.now(),F=(L-c.timeAdded)/P,G=d?(L-d.timeAdded)/P:-1,W=f.getSource(),te=E.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),$=!d||Math.abs(d.tileID.overscaledZ-te)>Math.abs(c.tileID.overscaledZ-te),re=$&&c.refreshedUponExpiration?1:s.clamp($?F:1-G,0,1);return c.refreshedUponExpiration&&F>=1&&(c.refreshedUponExpiration=!1),d?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}var _u=new s.Color(1,0,0,1),kl=new s.Color(0,1,0,1),rl=new s.Color(0,0,1,1),yu=new s.Color(1,0,1,1),nl=new s.Color(0,1,1,1);function vh(c,d,f,m){Ic(c,0,d+f/2,c.transform.width,f,m)}function xh(c,d,f,m){Ic(c,d-f/2,0,f,c.transform.height,m)}function Ic(c,d,f,m,E,P){var L=c.context,F=L.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*s.browser.devicePixelRatio,f*s.browser.devicePixelRatio,m*s.browser.devicePixelRatio,E*s.browser.devicePixelRatio),L.clear({color:P}),F.disable(F.SCISSOR_TEST)}function zf(c,d,f){var m=c.context,E=m.gl,P=f.posMatrix,L=c.useProgram("debug"),F=ye.disabled,G=Oe.disabled,W=c.colorModeForRenderPass();m.activeTexture.set(E.TEXTURE0),c.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),L.draw(m,E.LINE_STRIP,F,G,W,be.disabled,$o(P,s.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var te=d.getTileByID(f.key).latestRawTileData,$=Math.floor((te&&te.byteLength||0)/1024),re=d.getTile(f).tileSize,se=512/Math.min(re,512)*(f.overscaledZ/c.transform.zoom)*.5,ve=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ve+=" => "+f.overscaledZ),(function(Pe,me){Pe.initDebugOverlayCanvas();var Ie=Pe.debugOverlayCanvas,He=Pe.context.gl,Je=Pe.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Ie.width,Ie.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(me,5,5),Je.strokeText(me,5,5),Pe.debugOverlayTexture.update(Ie),Pe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)})(c,ve+" "+$+"kb"),L.draw(m,E.TRIANGLES,F,G,fe.alphaBlended,be.disabled,$o(P,s.Color.transparent,se),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var il={symbol:function(c,d,f,m,E){if(c.renderPass==="translucent"){var P=Oe.disabled,L=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&(function(F,G,W,te,$,re,se){for(var ve=G.transform,Pe=$==="map",me=re==="map",Ie=0,He=F;Ie<He.length;Ie+=1){var Je=He[Ie],et=te.getTile(Je),Xe=et.getBucket(W);if(Xe&&Xe.text&&Xe.text.segments.get().length){var Ye=s.evaluateSizeForZoom(Xe.textSizeData,ve.zoom),pt=Ln(et,1,G.transform.zoom),Ot=mr(Je.posMatrix,me,Pe,G.transform,pt),xt=W.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData();if(Ye){var Ut=Math.pow(2,ve.zoom-et.tileID.overscaledZ);Ol(Xe,Pe,me,se,s.symbolSize,ve,Ot,Je.posMatrix,Ut,Ye,xt)}}}})(m,c,f,d,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),E),f.paint.get("icon-opacity").constantOr(1)!==0&&tl(c,d,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),P,L),f.paint.get("text-opacity").constantOr(1)!==0&&tl(c,d,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),P,L),d.map.showCollisionBoxes&&(Ya(c,d,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Ya(c,d,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,d,f,m){if(c.renderPass==="translucent"){var E=f.paint.get("circle-opacity"),P=f.paint.get("circle-stroke-width"),L=f.paint.get("circle-stroke-opacity"),F=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||P.constantOr(1)!==0&&L.constantOr(1)!==0){for(var G=c.context,W=G.gl,te=c.depthModeForSublayer(0,ye.ReadOnly),$=Oe.disabled,re=c.colorModeForRenderPass(),se=[],ve=0;ve<m.length;ve++){var Pe=m[ve],me=d.getTile(Pe),Ie=me.getBucket(f);if(Ie){var He=Ie.programConfigurations.get(f.id),Je={programConfiguration:He,program:c.useProgram("circle",He),layoutVertexBuffer:Ie.layoutVertexBuffer,indexBuffer:Ie.indexBuffer,uniformValues:du(c,Pe,me,f)};if(F)for(var et=0,Xe=Ie.segments.get();et<Xe.length;et+=1){var Ye=Xe[et];se.push({segments:new s.SegmentVector([Ye]),sortKey:Ye.sortKey,state:Je})}else se.push({segments:Ie.segments,sortKey:0,state:Je})}}F&&se.sort(function(sr,Er){return sr.sortKey-Er.sortKey});for(var pt=0,Ot=se;pt<Ot.length;pt+=1){var xt=Ot[pt],Ut=xt.state;Ut.program.draw(G,W.TRIANGLES,te,$,re,be.disabled,Ut.uniformValues,f.id,Ut.layoutVertexBuffer,Ut.indexBuffer,xt.segments,f.paint,c.transform.zoom,Ut.programConfiguration)}}}},heatmap:function(c,d,f,m){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var E=c.context,P=E.gl,L=Oe.disabled,F=new fe([P.ONE,P.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(se,ve,Pe){var me=se.gl;se.activeTexture.set(me.TEXTURE1),se.viewport.set([0,0,ve.width/4,ve.height/4]);var Ie=Pe.heatmapFbo;if(Ie)me.bindTexture(me.TEXTURE_2D,Ie.colorAttachment.get()),se.bindFramebuffer.set(Ie.framebuffer);else{var He=me.createTexture();me.bindTexture(me.TEXTURE_2D,He),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Ie=Pe.heatmapFbo=se.createFramebuffer(ve.width/4,ve.height/4,!1),(function(Je,et,Xe,Ye){var pt=Je.gl;pt.texImage2D(pt.TEXTURE_2D,0,pt.RGBA,et.width/4,et.height/4,0,pt.RGBA,Je.extRenderToTextureHalfFloat?Je.extTextureHalfFloat.HALF_FLOAT_OES:pt.UNSIGNED_BYTE,null),Ye.colorAttachment.set(Xe)})(se,ve,He,Ie)}})(E,c,f),E.clear({color:s.Color.transparent});for(var G=0;G<m.length;G++){var W=m[G];if(!d.hasRenderableParent(W)){var te=d.getTile(W),$=te.getBucket(f);if($){var re=$.programConfigurations.get(f.id);c.useProgram("heatmap",re).draw(E,P.TRIANGLES,ye.disabled,L,F,be.disabled,Bc(W.posMatrix,te,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,f.paint,c.transform.zoom,re)}}}E.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),(function(se,ve){var Pe=se.context,me=Pe.gl,Ie=ve.heatmapFbo;if(Ie){Pe.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Ie.colorAttachment.get()),Pe.activeTexture.set(me.TEXTURE1);var He=ve.colorRampTexture;He||(He=ve.colorRampTexture=new s.Texture(Pe,ve.colorRamp,me.RGBA)),He.bind(me.LINEAR,me.CLAMP_TO_EDGE),se.useProgram("heatmapTexture").draw(Pe,me.TRIANGLES,ye.disabled,Oe.disabled,se.colorModeForRenderPass(),be.disabled,(function(Je,et,Xe,Ye){var pt=s.create();s.ortho(pt,0,Je.width,Je.height,0,0,1);var Ot=Je.context.gl;return{u_matrix:pt,u_world:[Ot.drawingBufferWidth,Ot.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:et.paint.get("heatmap-opacity")}})(se,ve),ve.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments,ve.paint,se.transform.zoom)}})(c,f))},line:function(c,d,f,m){if(c.renderPass==="translucent"){var E=f.paint.get("line-opacity"),P=f.paint.get("line-width");if(E.constantOr(1)!==0&&P.constantOr(1)!==0)for(var L=c.depthModeForSublayer(0,ye.ReadOnly),F=c.colorModeForRenderPass(),G=f.paint.get("line-dasharray"),W=f.paint.get("line-pattern"),te=W.constantOr(1),$=f.paint.get("line-gradient"),re=f.getCrossfadeParameters(),se=te?"linePattern":G?"lineSDF":$?"lineGradient":"line",ve=c.context,Pe=ve.gl,me=!0,Ie=0,He=m;Ie<He.length;Ie+=1){var Je=He[Ie],et=d.getTile(Je);if(!te||et.patternsLoaded()){var Xe=et.getBucket(f);if(Xe){var Ye=Xe.programConfigurations.get(f.id),pt=c.context.program.get(),Ot=c.useProgram(se,Ye),xt=me||Ot.program!==pt,Ut=W.constantOr(null);if(Ut&&et.imageAtlas){var sr=et.imageAtlas,Er=sr.patternPositions[Ut.to.toString()],Sr=sr.patternPositions[Ut.from.toString()];Er&&Sr&&Ye.setConstantPatternPositions(Er,Sr)}var xn=te?pu(c,et,f,re):G?aA(c,et,f,G,re):$?Fn(c,et,f,Xe.lineClipsArray.length):Rn(c,et,f);if(te)ve.activeTexture.set(Pe.TEXTURE0),et.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),Ye.updatePaintBuffers(re);else if(G&&(xt||c.lineAtlas.dirty))ve.activeTexture.set(Pe.TEXTURE0),c.lineAtlas.bind(ve);else if($){var ar=Xe.gradients[f.id],Wr=ar.texture;if(f.gradientVersion!==ar.version){var rn=256;if(f.stepInterpolant){var Vr=d.getSource().maxzoom,Gr=Je.canonical.z===Vr?Math.ceil(1<<c.transform.maxZoom-Je.canonical.z):1;rn=s.clamp(s.nextPowerOfTwo(Xe.maxLineLength/s.EXTENT*1024*Gr),256,ve.maxTextureSize)}ar.gradient=s.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:rn,image:ar.gradient||void 0,clips:Xe.lineClipsArray}),ar.texture?ar.texture.update(ar.gradient):ar.texture=new s.Texture(ve,ar.gradient,Pe.RGBA),ar.version=f.gradientVersion,Wr=ar.texture}ve.activeTexture.set(Pe.TEXTURE0),Wr.bind(f.stepInterpolant?Pe.NEAREST:Pe.LINEAR,Pe.CLAMP_TO_EDGE)}Ot.draw(ve,Pe.TRIANGLES,L,c.stencilModeForClipping(Je),F,be.disabled,xn,f.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,f.paint,c.transform.zoom,Ye,Xe.layoutVertexBuffer2),me=!1}}}}},fill:function(c,d,f,m){var E=f.paint.get("fill-color"),P=f.paint.get("fill-opacity");if(P.constantOr(1)!==0){var L=c.colorModeForRenderPass(),F=f.paint.get("fill-pattern"),G=c.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(s.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===G){var W=c.depthModeForSublayer(1,c.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);gu(c,d,f,m,W,L,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var te=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);gu(c,d,f,m,te,L,!0)}}},"fill-extrusion":function(c,d,f,m){var E=f.paint.get("fill-extrusion-opacity");if(E!==0&&c.renderPass==="translucent"){var P=new ye(c.context.gl.LEQUAL,ye.ReadWrite,c.depthRangeFor3D);if(E!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Tc(c,d,f,m,P,Oe.disabled,fe.disabled),Tc(c,d,f,m,P,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var L=c.colorModeForRenderPass();Tc(c,d,f,m,P,Oe.disabled,L)}}},hillshade:function(c,d,f,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var E=c.context,P=c.depthModeForSublayer(0,ye.ReadOnly),L=c.colorModeForRenderPass(),F=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],G=F[0],W=0,te=F[1];W<te.length;W+=1){var $=te[W],re=d.getTile($);re.needsHillshadePrepare&&c.renderPass==="offscreen"?cA(c,re,f,P,Oe.disabled,L):c.renderPass==="translucent"&&mu(c,re,f,P,G[$.overscaledZ],L)}E.viewport.set([0,0,c.width,c.height])}},raster:function(c,d,f,m){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var E=c.context,P=E.gl,L=d.getSource(),F=c.useProgram("raster"),G=c.colorModeForRenderPass(),W=L instanceof dt?[{},m]:c.stencilConfigForOverlap(m),te=W[0],$=W[1],re=$[$.length-1].overscaledZ,se=!c.options.moving,ve=0,Pe=$;ve<Pe.length;ve+=1){var me=Pe[ve],Ie=c.depthModeForSublayer(me.overscaledZ-re,f.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,P.LESS),He=d.getTile(me),Je=c.transform.calculatePosMatrix(me.toUnwrapped(),se);He.registerFadeDuration(f.paint.get("raster-fade-duration"));var et=d.findLoadedParent(me,0),Xe=Sc(He,et,d,f,c.transform),Ye=void 0,pt=void 0,Ot=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;E.activeTexture.set(P.TEXTURE0),He.texture.bind(Ot,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(P.TEXTURE1),et?(et.texture.bind(Ot,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Ye=Math.pow(2,et.tileID.overscaledZ-He.tileID.overscaledZ),pt=[He.tileID.canonical.x*Ye%1,He.tileID.canonical.y*Ye%1]):He.texture.bind(Ot,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var xt=lA(Je,pt||[0,0],Ye||1,Xe,f);L instanceof dt?F.draw(E,P.TRIANGLES,Ie,Oe.disabled,G,be.disabled,xt,f.id,L.boundsBuffer,c.quadTriangleIndexBuffer,L.boundsSegments):F.draw(E,P.TRIANGLES,Ie,te[me.overscaledZ],G,be.disabled,xt,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,d,f){var m=f.paint.get("background-color"),E=f.paint.get("background-opacity");if(E!==0){var P=c.context,L=P.gl,F=c.transform,G=F.tileSize,W=f.paint.get("background-pattern");if(!c.isPatternMissing(W)){var te=!W&&m.a===1&&E===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===te){var $=Oe.disabled,re=c.depthModeForSublayer(0,te==="opaque"?ye.ReadWrite:ye.ReadOnly),se=c.colorModeForRenderPass(),ve=c.useProgram(W?"backgroundPattern":"background"),Pe=F.coveringTiles({tileSize:G});W&&(P.activeTexture.set(L.TEXTURE0),c.imageManager.bind(c.context));for(var me=f.getCrossfadeParameters(),Ie=0,He=Pe;Ie<He.length;Ie+=1){var Je=He[Ie],et=c.transform.calculatePosMatrix(Je.toUnwrapped()),Xe=W?Rl(et,E,c,W,{tileID:Je,tileSize:G},me):qa(et,E,m);ve.draw(P,L.TRIANGLES,re,$,se,be.disabled,Xe,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,d,f){for(var m=0;m<f.length;m++)zf(c,d,f[m])},custom:function(c,d,f){var m=c.context,E=f.implementation;if(c.renderPass==="offscreen"){var P=E.prerender;P&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),P.call(E,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(Oe.disabled);var L=E.renderingMode==="3d"?new ye(c.context.gl.LEQUAL,ye.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ye.ReadOnly);m.setDepthMode(L),E.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Kn=function(c,d){this.context=new oe(c),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=we.maxUnderzooming+we.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new va,this.gpuTimers={}};Kn.prototype.resize=function(c,d){if(this.width=c*s.browser.devicePixelRatio,this.height=d*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},Kn.prototype.setup=function(){var c=this.context,d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,fi.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=c.createVertexBuffer(f,fi.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var m=new s.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,ot.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var E=new s.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(E,fi.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var P=new s.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(P);var L=new s.StructArrayLayout3ui6;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(L),this.emptyTexture=new s.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Oe({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Kn.prototype.clearStencil=function(){var c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=s.create();s.ortho(f,0,this.width,this.height,0,0,1),s.scale(f,f,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,d.TRIANGLES,ye.disabled,this.stencilClearMode,fe.disabled,be.disabled,qo(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Kn.prototype._renderTileClippingMasks=function(c,d){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&d&&d.length){this.currentStencilSource=c.source;var f=this.context,m=f.gl;this.nextStencilID+d.length>256&&this.clearStencil(),f.setColorMode(fe.disabled),f.setDepthMode(ye.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,L=d;P<L.length;P+=1){var F=L[P],G=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;E.draw(f,m.TRIANGLES,ye.disabled,new Oe({func:m.ALWAYS,mask:0},G,255,m.KEEP,m.KEEP,m.REPLACE),fe.disabled,be.disabled,qo(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Kn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,d=this.context.gl;return new Oe({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)},Kn.prototype.stencilModeForClipping=function(c){var d=this.context.gl;return new Oe({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)},Kn.prototype.stencilConfigForOverlap=function(c){var d,f=this.context.gl,m=c.sort(function(G,W){return W.overscaledZ-G.overscaledZ}),E=m[m.length-1].overscaledZ,P=m[0].overscaledZ-E+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var L={},F=0;F<P;F++)L[F+E]=new Oe({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=P,[L,m]}return[(d={},d[E]=Oe.disabled,d),m]},Kn.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new fe([c.CONSTANT_COLOR,c.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fe.unblended:fe.alphaBlended},Kn.prototype.depthModeForSublayer=function(c,d,f){if(!this.opaquePassEnabledForLayer())return ye.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new ye(f||this.context.gl.LEQUAL,d,[m,m])},Kn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Kn.prototype.render=function(c,d){var f=this;this.style=c,this.options=d,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var m=this.style._order,E=this.style.sourceCaches;for(var P in E){var L=E[P];L.used&&L.prepare(this.context)}var F,G,W={},te={},$={};for(var re in E){var se=E[re];W[re]=se.getVisibleCoordinates(),te[re]=W[re].slice().reverse(),$[re]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var ve=0;ve<m.length;ve++)if(this.style._layers[m[ve]].is3D()){this.opaquePassCutoff=ve;break}this.renderPass="offscreen";for(var Pe=0,me=m;Pe<me.length;Pe+=1){var Ie=this.style._layers[me[Pe]];if(Ie.hasOffscreenPass()&&!Ie.isHidden(this.transform.zoom)){var He=te[Ie.source];(Ie.type==="custom"||He.length)&&this.renderLayer(this,E[Ie.source],Ie,He)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Je=this.style._layers[m[this.currentLayer]],et=E[Je.source],Xe=W[Je.source];this._renderTileClippingMasks(Je,Xe),this.renderLayer(this,et,Je,Xe)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var Ye=this.style._layers[m[this.currentLayer]],pt=E[Ye.source],Ot=(Ye.type==="symbol"?$:te)[Ye.source];this._renderTileClippingMasks(Ye,W[Ye.source]),this.renderLayer(this,pt,Ye,Ot)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(xt){xt.source&&!xt.isHidden(f.transform.zoom)&&(xt.source!==(G&&G.id)&&(G=f.style.sourceCaches[xt.source]),(!F||F.getSource().maxzoom<G.getSource().maxzoom)&&(F=G))}),F&&il.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&(function(xt){var Ut=xt.transform.padding;vh(xt,xt.transform.height-(Ut.top||0),3,_u),vh(xt,Ut.bottom||0,3,kl),xh(xt,Ut.left||0,3,rl),xh(xt,xt.transform.width-(Ut.right||0),3,yu);var sr=xt.transform.centerPoint;(function(Er,Sr,xn,ar){Ic(Er,Sr-1,xn-10,2,20,ar),Ic(Er,Sr-10,xn-1,20,2,ar)})(xt,sr.x,xt.transform.height-sr.y,nl)})(this),this.context.setDefault()},Kn.prototype.renderLayer=function(c,d,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),il[f.type](c,d,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Kn.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var d=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),f.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,f.query)}},Kn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Kn.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Kn.prototype.queryGpuTimers=function(c){var d={};for(var f in c){var m=c[f],E=this.context.extTimerQuery,P=E.getQueryObjectEXT(m.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(m.query),d[f]=P}return d},Kn.prototype.translatePosMatrix=function(c,d,f,m,E){if(!f[0]&&!f[1])return c;var P=E?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(P){var L=Math.sin(P),F=Math.cos(P);f=[f[0]*F-f[1]*L,f[0]*L+f[1]*F]}var G=[E?f[0]:Ln(d,f[0],this.transform.zoom),E?f[1]:Ln(d,f[1],this.transform.zoom),0],W=new Float32Array(16);return s.translate(W,c,G),W},Kn.prototype.saveTileTexture=function(c){var d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]},Kn.prototype.getTileTexture=function(c){var d=this._tileTextures[c];return d&&d.length>0?d.pop():null},Kn.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var d=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!d||!f},Kn.prototype.useProgram=function(c,d){this.cache=this.cache||{};var f=""+c+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Ff(this.context,c,uu[c],d,js[c],this._showOverdrawInspector)),this.cache[f]},Kn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Kn.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Kn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Kn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var bu=function(c,d){this.points=c,this.planes=d};bu.fromInvProjectionMatrix=function(c,d,f){var m=Math.pow(2,f),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(L){return s.transformMat4([],L,c)}).map(function(L){return s.scale$1([],L,1/L[3]/d*m)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(L){var F=s.sub([],E[L[0]],E[L[1]]),G=s.sub([],E[L[2]],E[L[1]]),W=s.normalize([],s.cross([],F,G)),te=-s.dot(W,E[L[1]]);return W.concat(te)});return new bu(E,P)};var Yo=function(c,d){this.min=c,this.max=d,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};Yo.prototype.quadrant=function(c){for(var d=[c%2==0,c<2],f=s.clone$2(this.min),m=s.clone$2(this.max),E=0;E<d.length;E++)f[E]=d[E]?this.min[E]:this.center[E],m[E]=d[E]?this.center[E]:this.max[E];return m[2]=this.max[2],new Yo(f,m)},Yo.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Yo.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Yo.prototype.intersects=function(c){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<c.planes.length;m++){for(var E=c.planes[m],P=0,L=0;L<d.length;L++)P+=s.dot$1(E,d[L])>=0;if(P===0)return 0;P!==d.length&&(f=!1)}if(f)return 2;for(var F=0;F<3;F++){for(var G=Number.MAX_VALUE,W=-Number.MAX_VALUE,te=0;te<c.points.length;te++){var $=c.points[te][F]-this.min[F];G=Math.min(G,$),W=Math.max(W,$)}if(W<0||G>this.max[F]-this.min[F])return 0}return 1};var ea=function(c,d,f,m){if(c===void 0&&(c=0),d===void 0&&(d=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(d)||d<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=f,this.right=m};ea.prototype.interpolate=function(c,d,f){return d.top!=null&&c.top!=null&&(this.top=s.number(c.top,d.top,f)),d.bottom!=null&&c.bottom!=null&&(this.bottom=s.number(c.bottom,d.bottom,f)),d.left!=null&&c.left!=null&&(this.left=s.number(c.left,d.left,f)),d.right!=null&&c.right!=null&&(this.right=s.number(c.right,d.right,f)),this},ea.prototype.getCenter=function(c,d){var f=s.clamp((this.left+c-this.right)/2,0,c),m=s.clamp((this.top+d-this.bottom)/2,0,d);return new s.Point(f,m)},ea.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},ea.prototype.clone=function(){return new ea(this.top,this.bottom,this.left,this.right)},ea.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var hn=function(c,d,f,m,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ea,this._posMatrixCache={},this._alignedPosMatrixCache={}},kn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};hn.prototype.clone=function(){var c=new hn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},kn.minZoom.get=function(){return this._minZoom},kn.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},kn.maxZoom.get=function(){return this._maxZoom},kn.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},kn.minPitch.get=function(){return this._minPitch},kn.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},kn.maxPitch.get=function(){return this._maxPitch},kn.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},kn.renderWorldCopies.get=function(){return this._renderWorldCopies},kn.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},kn.worldSize.get=function(){return this.tileSize*this.scale},kn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},kn.size.get=function(){return new s.Point(this.width,this.height)},kn.bearing.get=function(){return-this.angle/Math.PI*180},kn.bearing.set=function(c){var d=-s.wrap(c,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},kn.pitch.get=function(){return this._pitch/Math.PI*180},kn.pitch.set=function(c){var d=s.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},kn.fov.get=function(){return this._fov/Math.PI*180},kn.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},kn.zoom.get=function(){return this._zoom},kn.zoom.set=function(c){var d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},kn.center.get=function(){return this._center},kn.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},kn.padding.get=function(){return this._edgeInsets.toJSON()},kn.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},kn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},hn.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},hn.prototype.interpolatePadding=function(c,d,f){this._unmodified=!1,this._edgeInsets.interpolate(c,d,f),this._constrain(),this._calcMatrices()},hn.prototype.coveringZoomLevel=function(c){var d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)},hn.prototype.getVisibleUnwrappedCoordinates=function(c){var d=[new s.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new s.Point(0,0)),m=this.pointCoordinate(new s.Point(this.width,0)),E=this.pointCoordinate(new s.Point(this.width,this.height)),P=this.pointCoordinate(new s.Point(0,this.height)),L=Math.floor(Math.min(f.x,m.x,E.x,P.x)),F=Math.floor(Math.max(f.x,m.x,E.x,P.x)),G=L-1;G<=F+1;G++)G!==0&&d.push(new s.UnwrappedTileID(G,c));return d},hn.prototype.coveringTiles=function(c){var d=this.coveringZoomLevel(c),f=d;if(c.minzoom!==void 0&&d<c.minzoom)return[];c.maxzoom!==void 0&&d>c.maxzoom&&(d=c.maxzoom);var m=s.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,d),P=[E*m.x,E*m.y,0],L=bu.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var G=function(xt){return{aabb:new Yo([xt*E,0,0],[(xt+1)*E,E,0]),zoom:0,x:0,y:0,wrap:xt,fullyVisible:!1}},W=[],te=[],$=d,re=c.reparseOverscaled?f:d;if(this._renderWorldCopies)for(var se=1;se<=3;se++)W.push(G(-se)),W.push(G(se));for(W.push(G(0));W.length>0;){var ve=W.pop(),Pe=ve.x,me=ve.y,Ie=ve.fullyVisible;if(!Ie){var He=ve.aabb.intersects(L);if(He===0)continue;Ie=He===2}var Je=ve.aabb.distanceX(P),et=ve.aabb.distanceY(P),Xe=Math.max(Math.abs(Je),Math.abs(et));if(ve.zoom===$||Xe>3+(1<<$-ve.zoom)-2&&ve.zoom>=F)te.push({tileID:new s.OverscaledTileID(ve.zoom===$?re:ve.zoom,ve.wrap,ve.zoom,Pe,me),distanceSq:s.sqrLen([P[0]-.5-Pe,P[1]-.5-me])});else for(var Ye=0;Ye<4;Ye++){var pt=(Pe<<1)+Ye%2,Ot=(me<<1)+(Ye>>1);W.push({aabb:ve.aabb.quadrant(Ye),zoom:ve.zoom+1,x:pt,y:Ot,wrap:ve.wrap,fullyVisible:Ie})}}return te.sort(function(xt,Ut){return xt.distanceSq-Ut.distanceSq}).map(function(xt){return xt.tileID})},hn.prototype.resize=function(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()},kn.unmodified.get=function(){return this._unmodified},hn.prototype.zoomScale=function(c){return Math.pow(2,c)},hn.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},hn.prototype.project=function(c){var d=s.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(c.lng)*this.worldSize,s.mercatorYfromLat(d)*this.worldSize)},hn.prototype.unproject=function(c){return new s.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},kn.point.get=function(){return this.project(this.center)},hn.prototype.setLocationAtPoint=function(c,d){var f=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(c),P=new s.MercatorCoordinate(E.x-(f.x-m.x),E.y-(f.y-m.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},hn.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},hn.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},hn.prototype.locationCoordinate=function(c){return s.MercatorCoordinate.fromLngLat(c)},hn.prototype.coordinateLocation=function(c){return c.toLngLat()},hn.prototype.pointCoordinate=function(c){var d=[c.x,c.y,0,1],f=[c.x,c.y,1,1];s.transformMat4(d,d,this.pixelMatrixInverse),s.transformMat4(f,f,this.pixelMatrixInverse);var m=d[3],E=f[3],P=d[1]/m,L=f[1]/E,F=d[2]/m,G=f[2]/E,W=F===G?0:(0-F)/(G-F);return new s.MercatorCoordinate(s.number(d[0]/m,f[0]/E,W)/this.worldSize,s.number(P,L,W)/this.worldSize)},hn.prototype.coordinatePoint=function(c){var d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix),new s.Point(d[0]/d[3],d[1]/d[3])},hn.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},hn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},hn.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},hn.prototype.calculatePosMatrix=function(c,d){d===void 0&&(d=!1);var f=c.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var E=c.canonical,P=this.worldSize/this.zoomScale(E.z),L=E.x+Math.pow(2,E.z)*c.wrap,F=s.identity(new Float64Array(16));return s.translate(F,F,[L*P,E.y*P,0]),s.scale(F,F,[P/s.EXTENT,P/s.EXTENT,1]),s.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),m[f]=new Float32Array(F),m[f]},hn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},hn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,d,f,m,E=-90,P=90,L=-180,F=180,G=this.size,W=this._unmodified;if(this.latRange){var te=this.latRange;E=s.mercatorYfromLat(te[1])*this.worldSize,c=(P=s.mercatorYfromLat(te[0])*this.worldSize)-E<G.y?G.y/(P-E):0}if(this.lngRange){var $=this.lngRange;L=s.mercatorXfromLng($[0])*this.worldSize,d=(F=s.mercatorXfromLng($[1])*this.worldSize)-L<G.x?G.x/(F-L):0}var re=this.point,se=Math.max(d||0,c||0);if(se)return this.center=this.unproject(new s.Point(d?(F+L)/2:re.x,c?(P+E)/2:re.y)),this.zoom+=this.scaleZoom(se),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var ve=re.y,Pe=G.y/2;ve-Pe<E&&(m=E+Pe),ve+Pe>P&&(m=P-Pe)}if(this.lngRange){var me=re.x,Ie=G.x/2;me-Ie<L&&(f=L+Ie),me+Ie>F&&(f=F-Ie)}f===void 0&&m===void 0||(this.center=this.unproject(new s.Point(f!==void 0?f:re.x,m!==void 0?m:re.y))),this._unmodified=W,this._constraining=!1}},hn.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-d-f,.01,Math.PI-.01)),E=this.point,P=E.x,L=E.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),G=this.height/50,W=new Float64Array(16);s.perspective(W,this._fov,this.width/this.height,G,F),W[8]=2*-c.x/this.width,W[9]=2*c.y/this.height,s.scale(W,W,[1,-1,1]),s.translate(W,W,[0,0,-this.cameraToCenterDistance]),s.rotateX(W,W,this._pitch),s.rotateZ(W,W,this.angle),s.translate(W,W,[-P,-L,0]),this.mercatorMatrix=s.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),s.scale(W,W,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=s.invert([],this.projMatrix);var te=this.width%2/2,$=this.height%2/2,re=Math.cos(this.angle),se=Math.sin(this.angle),ve=P-Math.round(P)+re*te+se*$,Pe=L-Math.round(L)+re*$+se*te,me=new Float64Array(W);if(s.translate(me,me,[ve>.5?ve-1:ve,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=me,W=s.create(),s.scale(W,W,[this.width/2,-this.height/2,1]),s.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=s.create(),s.scale(W,W,[1,-1,1]),s.translate(W,W,[-1,-1,0]),s.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},hn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new s.Point(0,0)),d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},hn.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,c))},hn.prototype.getCameraQueryGeometry=function(c){var d=this.getCameraPoint();if(c.length===1)return[c[0],d];for(var f=d.x,m=d.y,E=d.x,P=d.y,L=0,F=c;L<F.length;L+=1){var G=F[L];f=Math.min(f,G.x),m=Math.min(m,G.y),E=Math.max(E,G.x),P=Math.max(P,G.y)}return[new s.Point(f,m),new s.Point(E,m),new s.Point(E,P),new s.Point(f,P),new s.Point(f,m)]},Object.defineProperties(hn.prototype,kn);var Vs=function(c){var d,f,m,E;this._hashName=c&&encodeURIComponent(c),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),f=!1,m=null,E=function(){m=null,f&&(d(),m=setTimeout(E,300),f=!1)},function(){return f=!0,m||E(),m})};Vs.prototype.addTo=function(c){return this._map=c,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Vs.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Vs.prototype.getHashString=function(c){var d=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,m),P=Math.round(d.lng*E)/E,L=Math.round(d.lat*E)/E,F=this._map.getBearing(),G=this._map.getPitch(),W="";if(W+=c?"/"+P+"/"+L+"/"+f:f+"/"+L+"/"+P,(F||G)&&(W+="/"+Math.round(10*F)/10),G&&(W+="/"+Math.round(G)),this._hashName){var te=this._hashName,$=!1,re=s.window.location.hash.slice(1).split("&").map(function(se){var ve=se.split("=")[0];return ve===te?($=!0,ve+"="+W):se}).filter(function(se){return se});return $||re.push(te+"="+W),"#"+re.join("&")}return"#"+W},Vs.prototype._getCurrentHash=function(){var c,d=this,f=s.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===d._hashName&&(c=m)}),(c&&c[1]||"").split("/")):f.split("/")},Vs.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:d,pitch:+(c[4]||0)}),!0}return!1},Vs.prototype._updateHashUnthrottled=function(){var c=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,c)}catch{}};var Mc={linearity:.3,easing:s.bezier(0,0,.3,1)},Nl=s.extend({deceleration:2500,maxSpeed:1400},Mc),Pc=s.extend({deceleration:20,maxSpeed:1400},Mc),uA=s.extend({deceleration:1e3,maxSpeed:360},Mc),hA=s.extend({deceleration:1e3,maxSpeed:90},Mc),Ul=function(c){this._map=c,this.clear()};function Lc(c,d){(!c.duration||c.duration<d.duration)&&(c.duration=d.duration,c.easing=d.easing)}function Ro(c,d,f){var m=f.maxSpeed,E=f.linearity,P=f.deceleration,L=s.clamp(c*E/(d/1e3),-m,m),F=Math.abs(L)/(P*E);return{easing:f.easing,duration:1e3*F,amount:L*(F/2)}}Ul.prototype.clear=function(){this._inertiaBuffer=[]},Ul.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:c})},Ul.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,d=s.browser.now();c.length>0&&d-c[0].time>160;)c.shift()},Ul.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var E=m[f].settings;d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,L={};if(d.pan.mag()){var F=Ro(d.pan.mag(),P,s.extend({},Nl,c||{}));L.offset=d.pan.mult(F.amount/d.pan.mag()),L.center=this._map.transform.center,Lc(L,F)}if(d.zoom){var G=Ro(d.zoom,P,Pc);L.zoom=this._map.transform.zoom+G.amount,Lc(L,G)}if(d.bearing){var W=Ro(d.bearing,P,uA);L.bearing=this._map.transform.bearing+s.clamp(W.amount,-179,179),Lc(L,W)}if(d.pitch){var te=Ro(d.pitch,P,hA);L.pitch=this._map.transform.pitch+te.amount,Lc(L,te)}if(L.zoom||L.bearing){var $=d.pinchAround===void 0?d.around:d.pinchAround;L.around=$?this._map.unproject($):this._map.getCenter()}return this.clear(),s.extend(L,{noMoveStart:!0})}};var Nn=(function(c){function d(m,E,P,L){L===void 0&&(L={});var F=h.mousePos(E.getCanvasContainer(),P),G=E.unproject(F);c.call(this,m,s.extend({point:F,lngLat:G,originalEvent:P},L)),this._defaultPrevented=!1,this.target=E}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d})(s.Event),Gl=(function(c){function d(m,E,P){var L=m==="touchend"?P.changedTouches:P.touches,F=h.touchPos(E.getCanvasContainer(),L),G=F.map(function($){return E.unproject($)}),W=F.reduce(function($,re,se,ve){return $.add(re.div(ve.length))},new s.Point(0,0)),te=E.unproject(W);c.call(this,m,{points:F,point:W,lngLats:G,lngLat:te,originalEvent:P}),this._defaultPrevented=!1}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d})(s.Event),jf=(function(c){function d(m,E,P){c.call(this,m,{originalEvent:P}),this._defaultPrevented=!1}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d})(s.Event),Ei=function(c,d){this._map=c,this._clickTolerance=d.clickTolerance};Ei.prototype.reset=function(){delete this._mousedownPos},Ei.prototype.wheel=function(c){return this._firePreventable(new jf(c.type,this._map,c))},Ei.prototype.mousedown=function(c,d){return this._mousedownPos=d,this._firePreventable(new Nn(c.type,this._map,c))},Ei.prototype.mouseup=function(c){this._map.fire(new Nn(c.type,this._map,c))},Ei.prototype.click=function(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Nn(c.type,this._map,c))},Ei.prototype.dblclick=function(c){return this._firePreventable(new Nn(c.type,this._map,c))},Ei.prototype.mouseover=function(c){this._map.fire(new Nn(c.type,this._map,c))},Ei.prototype.mouseout=function(c){this._map.fire(new Nn(c.type,this._map,c))},Ei.prototype.touchstart=function(c){return this._firePreventable(new Gl(c.type,this._map,c))},Ei.prototype.touchmove=function(c){this._map.fire(new Gl(c.type,this._map,c))},Ei.prototype.touchend=function(c){this._map.fire(new Gl(c.type,this._map,c))},Ei.prototype.touchcancel=function(c){this._map.fire(new Gl(c.type,this._map,c))},Ei.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Ei.prototype.isEnabled=function(){return!0},Ei.prototype.isActive=function(){return!1},Ei.prototype.enable=function(){},Ei.prototype.disable=function(){};var or=function(c){this._map=c};or.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},or.prototype.mousemove=function(c){this._map.fire(new Nn(c.type,this._map,c))},or.prototype.mousedown=function(){this._delayContextMenu=!0},or.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},or.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Nn(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},or.prototype.isEnabled=function(){return!0},or.prototype.isActive=function(){return!1},or.prototype.enable=function(){},or.prototype.disable=function(){};var Ss=function(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1};function vu(c,d){for(var f={},m=0;m<c.length;m++)f[c[m].identifier]=d[m];return f}Ss.prototype.isEnabled=function(){return!!this._enabled},Ss.prototype.isActive=function(){return!!this._active},Ss.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ss.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ss.prototype.mousedown=function(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(h.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},Ss.prototype.mousemoveWindow=function(c,d){if(this._active){var f=d;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=h.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var E=Math.min(m.x,f.x),P=Math.max(m.x,f.x),L=Math.min(m.y,f.y),F=Math.max(m.y,f.y);h.setTransform(this._box,"translate("+E+"px,"+L+"px)"),this._box.style.width=P-E+"px",this._box.style.height=F-L+"px"}}},Ss.prototype.mouseupWindow=function(c,d){var f=this;if(this._active&&c.button===0){var m=this._startPos,E=d;if(this.reset(),h.suppressClick(),m.x!==E.x||m.y!==E.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(P){return P.fitScreenCoordinates(m,E,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Ss.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Ss.prototype.blur=function(){this.reset()},Ss.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(h.remove(this._box),this._box=null),h.enableDrag(),delete this._startPos,delete this._lastPos},Ss.prototype._fireEvent=function(c,d){return this._map.fire(new s.Event(c,{originalEvent:d}))};var Ws=function(c){this.reset(),this.numTouches=c.numTouches};Ws.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ws.prototype.touchstart=function(c,d,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=(function(m){for(var E=new s.Point(0,0),P=0,L=m;P<L.length;P+=1)E._add(L[P]);return E.div(m.length)})(d),this.touches=vu(f,d)))},Ws.prototype.touchmove=function(c,d,f){if(!this.aborted&&this.centroid){var m=vu(f,d);for(var E in this.touches){var P=m[E];(!P||P.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Ws.prototype.touchend=function(c,d,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var io=function(c){this.singleTap=new Ws(c),this.numTaps=c.numTaps,this.reset()};io.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},io.prototype.touchstart=function(c,d,f){this.singleTap.touchstart(c,d,f)},io.prototype.touchmove=function(c,d,f){this.singleTap.touchmove(c,d,f)},io.prototype.touchend=function(c,d,f){var m=this.singleTap.touchend(c,d,f);if(m){var E=c.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(m)<30;if(E&&P||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var ms=function(){this._zoomIn=new io({numTouches:1,numTaps:2}),this._zoomOut=new io({numTouches:2,numTaps:1}),this.reset()};ms.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ms.prototype.touchstart=function(c,d,f){this._zoomIn.touchstart(c,d,f),this._zoomOut.touchstart(c,d,f)},ms.prototype.touchmove=function(c,d,f){this._zoomIn.touchmove(c,d,f),this._zoomOut.touchmove(c,d,f)},ms.prototype.touchend=function(c,d,f){var m=this,E=this._zoomIn.touchend(c,d,f),P=this._zoomOut.touchend(c,d,f);return E?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(E)},{originalEvent:c})}}):P?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(P)},{originalEvent:c})}}):void 0},ms.prototype.touchcancel=function(){this.reset()},ms.prototype.enable=function(){this._enabled=!0},ms.prototype.disable=function(){this._enabled=!1,this.reset()},ms.prototype.isEnabled=function(){return this._enabled},ms.prototype.isActive=function(){return this._active};var wh={0:1,2:2},qt=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};qt.prototype.blur=function(){this.reset()},qt.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qt.prototype._correctButton=function(c,d){return!1},qt.prototype._move=function(c,d){return{}},qt.prototype.mousedown=function(c,d){if(!this._lastPoint){var f=h.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=d,this._eventButton=f)}},qt.prototype.mousemoveWindow=function(c,d){var f=this._lastPoint;if(f){if(c.preventDefault(),(function(m,E){var P=wh[E];return m.buttons===void 0||(m.buttons&P)!==P})(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(f,d)}},qt.prototype.mouseupWindow=function(c){this._lastPoint&&h.mouseButton(c)===this._eventButton&&(this._moved&&h.suppressClick(),this.reset())},qt.prototype.enable=function(){this._enabled=!0},qt.prototype.disable=function(){this._enabled=!1,this.reset()},qt.prototype.isEnabled=function(){return this._enabled},qt.prototype.isActive=function(){return this._active};var Ch=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.mousedown=function(f,m){c.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},d.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},d})(qt),xu=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=.8*(m.x-f.x);if(E)return this._active=!0,{bearingDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d})(qt),Eh=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=-.5*(m.y-f.y);if(E)return this._active=!0,{pitchDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d})(qt),so=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};so.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},so.prototype.touchstart=function(c,d,f){return this._calculateTransform(c,d,f)},so.prototype.touchmove=function(c,d,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,d,f)},so.prototype.touchend=function(c,d,f){this._calculateTransform(c,d,f),this._active&&f.length<this._minTouches&&this.reset()},so.prototype.touchcancel=function(){this.reset()},so.prototype._calculateTransform=function(c,d,f){f.length>0&&(this._active=!0);var m=vu(f,d),E=new s.Point(0,0),P=new s.Point(0,0),L=0;for(var F in m){var G=m[F],W=this._touches[F];W&&(E._add(G),P._add(G.sub(W)),L++,m[F]=G)}if(this._touches=m,!(L<this._minTouches)&&P.mag()){var te=P.div(L);if(this._sum._add(te),!(this._sum.mag()<this._clickTolerance))return{around:E.div(L),panDelta:te}}},so.prototype.enable=function(){this._enabled=!0},so.prototype.disable=function(){this._enabled=!1,this.reset()},so.prototype.isEnabled=function(){return this._enabled},so.prototype.isActive=function(){return this._active};var Is=function(){this.reset()};function wu(c,d,f){for(var m=0;m<c.length;m++)if(c[m].identifier===f)return d[m]}function Cu(c,d){return Math.log(c/d)/Math.LN2}Is.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Is.prototype._start=function(c){},Is.prototype._move=function(c,d,f){return{}},Is.prototype.touchstart=function(c,d,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([d[0],d[1]]))},Is.prototype.touchmove=function(c,d,f){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,E=m[1],P=wu(f,d,m[0]),L=wu(f,d,E);if(P&&L){var F=this._aroundCenter?null:P.add(L).div(2);return this._move([P,L],F,c)}}},Is.prototype.touchend=function(c,d,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,E=m[1],P=wu(f,d,m[0]),L=wu(f,d,E);P&&L||(this._active&&h.suppressClick(),this.reset())}},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var Ms=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Cu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cu(this._distance,E),pinchAround:m}},d})(Is);function ta(c,d){return 180*c.angleWith(d)/Math.PI}var Bh=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ta(this._vector,E),pinchAround:m}},d.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,E=ta(f,this._startVector);return Math.abs(E)<m},d})(Is);function zl(c){return Math.abs(c.y)>Math.abs(c.x)}var Bi=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(f){this._lastPoints=f,zl(f[0].sub(f[1]))&&(this._valid=!1)},d.prototype._move=function(f,m,E){var P=f[0].sub(this._lastPoints[0]),L=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,L,E.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(P.y+L.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(f,m,E){if(this._valid!==void 0)return this._valid;var P=f.mag()>=2,L=m.mag()>=2;if(P||L){if(!P||!L)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var F=f.y>0==m.y>0;return zl(f)&&zl(m)&&F}},d})(Is),Th={panStep:100,bearingStep:15,pitchStep:10},Co=function(){var c=Th;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function rs(c){return c*(2-c)}Co.prototype.blur=function(){this.reset()},Co.prototype.reset=function(){this._active=!1},Co.prototype.keydown=function(c){var d=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,m=0,E=0,P=0,L=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),P=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),P=1);break;case 38:c.shiftKey?E=1:(c.preventDefault(),L=-1);break;case 40:c.shiftKey?E=-1:(c.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(m=0,E=0),{cameraAnimation:function(F){var G=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:rs,zoom:f?Math.round(G)+f*(c.shiftKey?2:1):G,bearing:F.getBearing()+m*d._bearingStep,pitch:F.getPitch()+E*d._pitchStep,offset:[-P*d._panStep,-L*d._panStep],center:F.getCenter()},{originalEvent:c})}}}},Co.prototype.enable=function(){this._enabled=!0},Co.prototype.disable=function(){this._enabled=!1,this.reset()},Co.prototype.isEnabled=function(){return this._enabled},Co.prototype.isActive=function(){return this._active},Co.prototype.disableRotation=function(){this._rotationDisabled=!0},Co.prototype.enableRotation=function(){this._rotationDisabled=!1};var Hr=function(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};Hr.prototype.setZoomRate=function(c){this._defaultZoomRate=c},Hr.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},Hr.prototype.isEnabled=function(){return!!this._enabled},Hr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Hr.prototype.isZooming=function(){return!!this._zooming},Hr.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},Hr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Hr.prototype.wheel=function(c){if(this.isEnabled()){var d=c.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=s.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}},Hr.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},Hr.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=h.mousePos(this._el,c);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Hr.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var E=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(E*m))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,L=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,G=this._easing,W=!1;if(this._type==="wheel"&&F&&G){var te=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),$=G(te);P=s.number(F,L,$),te<1?this._frameId||(this._frameId=!0):W=!0}else P=L,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:P-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Hr.prototype._smoothOutEasing=function(c){var d=s.ease;if(this._prevEase){var f=this._prevEase,m=(s.browser.now()-f.start)/f.duration,E=f.easing(m+.01)-f.easing(m),P=.27/Math.sqrt(E*E+1e-4)*.01,L=Math.sqrt(.0729-P*P);d=s.bezier(P,L,.25,1)}return this._prevEase={start:s.browser.now(),duration:c,easing:d},d},Hr.prototype.blur=function(){this.reset()},Hr.prototype.reset=function(){this._active=!1};var Oo=function(c,d){this._clickZoom=c,this._tapZoom=d};Oo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Oo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Oo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Oo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var oo=function(){this.reset()};oo.prototype.reset=function(){this._active=!1},oo.prototype.blur=function(){this.reset()},oo.prototype.dblclick=function(c,d){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(d)},{originalEvent:c})}}},oo.prototype.enable=function(){this._enabled=!0},oo.prototype.disable=function(){this._enabled=!1,this.reset()},oo.prototype.isEnabled=function(){return this._enabled},oo.prototype.isActive=function(){return this._active};var Ji=function(){this._tap=new io({numTouches:1,numTaps:1}),this.reset()};Ji.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ji.prototype.touchstart=function(c,d,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=d[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,d,f))},Ji.prototype.touchmove=function(c,d,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=d[0],E=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,d,f)},Ji.prototype.touchend=function(c,d,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,d,f)&&(this._tapTime=c.timeStamp)},Ji.prototype.touchcancel=function(){this.reset()},Ji.prototype.enable=function(){this._enabled=!0},Ji.prototype.disable=function(){this._enabled=!1,this.reset()},Ji.prototype.isEnabled=function(){return this._enabled},Ji.prototype.isActive=function(){return this._active};var Ia=function(c,d,f){this._el=c,this._mousePan=d,this._touchPan=f};Ia.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ia.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ia.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ia.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ra=function(c,d,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=f};ra.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ra.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ra.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ra.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ao=function(c,d,f,m){this._el=c,this._touchZoom=d,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};ao.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ao.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ao.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ao.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ao.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ao.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ns=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Rc=(function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d})(s.Event);function xr(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var ur=function(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ul(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),s.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[s.window,"blur",void 0]];for(var m=0,E=this._listeners;m<E.length;m+=1){var P=E[m],L=P[0];h.addEventListener(L,P[1],L===s.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};ur.prototype.destroy=function(){for(var c=0,d=this._listeners;c<d.length;c+=1){var f=d[c],m=f[0];h.removeEventListener(m,f[1],m===s.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},ur.prototype._addDefaultHandlers=function(c){var d=this._map,f=d.getCanvasContainer();this._add("mapEvent",new Ei(d,c));var m=d.boxZoom=new Ss(d,c);this._add("boxZoom",m);var E=new ms,P=new oo;d.doubleClickZoom=new Oo(P,E),this._add("tapZoom",E),this._add("clickZoom",P);var L=new Ji;this._add("tapDragZoom",L);var F=d.touchPitch=new Bi;this._add("touchPitch",F);var G=new xu(c),W=new Eh(c);d.dragRotate=new ra(c,G,W),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var te=new Ch(c),$=new so(c);d.dragPan=new Ia(f,te,$),this._add("mousePan",te),this._add("touchPan",$,["touchZoom","touchRotate"]);var re=new Bh,se=new Ms;d.touchZoomRotate=new ao(f,se,re,L),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]);var ve=d.scrollZoom=new Hr(d,this);this._add("scrollZoom",ve,["mousePan"]);var Pe=d.keyboard=new Co;this._add("keyboard",Pe),this._add("blockableMapEvent",new or(d));for(var me=0,Ie=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];me<Ie.length;me+=1){var He=Ie[me];c.interactive&&c[He]&&d[He].enable(c[He])}},ur.prototype._add=function(c,d,f){this._handlers.push({handlerName:c,handler:d,allowed:f}),this._handlersById[c]=d},ur.prototype.stop=function(c){if(!this._updatingCamera){for(var d=0,f=this._handlers;d<f.length;d+=1)f[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},ur.prototype.isActive=function(){for(var c=0,d=this._handlers;c<d.length;c+=1)if(d[c].handler.isActive())return!0;return!1},ur.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ur.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ur.prototype.isMoving=function(){return!!ns(this._eventsInProgress)||this.isZooming()},ur.prototype._blockedByActive=function(c,d,f){for(var m in c)if(m!==f&&(!d||d.indexOf(m)<0))return!0;return!1},ur.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},ur.prototype._getMapTouches=function(c){for(var d=[],f=0,m=c;f<m.length;f+=1){var E=m[f];this._el.contains(E.target)&&d.push(E)}return d},ur.prototype.handleEvent=function(c,d){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},E={},P={},L=c.touches?this._getMapTouches(c.touches):void 0,F=L?h.touchPos(this._el,L):h.mousePos(this._el,c),G=0,W=this._handlers;G<W.length;G+=1){var te=W[G],$=te.handlerName,re=te.handler,se=te.allowed;if(re.isEnabled()){var ve=void 0;this._blockedByActive(P,se,$)?re.reset():re[d||c.type]&&(ve=re[d||c.type](c,F,L),this.mergeHandlerResult(m,E,ve,$,f),ve&&ve.needsRenderFrame&&this._triggerRenderFrame()),(ve||re.isActive())&&(P[$]=re)}}var Pe={};for(var me in this._previousActiveHandlers)P[me]||(Pe[me]=f);this._previousActiveHandlers=P,(Object.keys(Pe).length||xr(m))&&(this._changes.push([m,E,Pe]),this._triggerRenderFrame()),(Object.keys(P).length||xr(m))&&this._map._stop(!0),this._updatingCamera=!1;var Ie=m.cameraAnimation;Ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ie(this._map))},ur.prototype.mergeHandlerResult=function(c,d,f,m,E){if(f){s.extend(c,f);var P={handlerName:m,originalEvent:f.originalEvent||E};f.zoomDelta!==void 0&&(d.zoom=P),f.panDelta!==void 0&&(d.drag=P),f.pitchDelta!==void 0&&(d.pitch=P),f.bearingDelta!==void 0&&(d.rotate=P)}},ur.prototype._applyChanges=function(){for(var c={},d={},f={},m=0,E=this._changes;m<E.length;m+=1){var P=E[m],L=P[0],F=P[1],G=P[2];L.panDelta&&(c.panDelta=(c.panDelta||new s.Point(0,0))._add(L.panDelta)),L.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+L.zoomDelta),L.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+L.bearingDelta),L.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+L.pitchDelta),L.around!==void 0&&(c.around=L.around),L.pinchAround!==void 0&&(c.pinchAround=L.pinchAround),L.noInertia&&(c.noInertia=L.noInertia),s.extend(d,F),s.extend(f,G)}this._updateMapTransform(c,d,f),this._changes=[]},ur.prototype._updateMapTransform=function(c,d,f){var m=this._map,E=m.transform;if(!xr(c))return this._fireEvents(d,f,!0);var P=c.panDelta,L=c.zoomDelta,F=c.bearingDelta,G=c.pitchDelta,W=c.around,te=c.pinchAround;te!==void 0&&(W=te),m._stop(!0),W=W||m.transform.centerPoint;var $=E.pointLocation(P?W.sub(P):W);F&&(E.bearing+=F),G&&(E.pitch+=G),L&&(E.zoom+=L),E.setLocationAtPoint($,W),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,f,!0)},ur.prototype._fireEvents=function(c,d,f){var m=this,E=ns(this._eventsInProgress),P=ns(c),L={};for(var F in c)this._eventsInProgress[F]||(L[F+"start"]=c[F].originalEvent),this._eventsInProgress[F]=c[F];for(var G in!E&&P&&this._fireEvent("movestart",P.originalEvent),L)this._fireEvent(G,L[G]);for(var W in P&&this._fireEvent("move",P.originalEvent),c)this._fireEvent(W,c[W].originalEvent);var te,$={};for(var re in this._eventsInProgress){var se=this._eventsInProgress[re],ve=se.handlerName,Pe=se.originalEvent;this._handlersById[ve].isActive()||(delete this._eventsInProgress[re],$[re+"end"]=te=d[ve]||Pe)}for(var me in $)this._fireEvent(me,$[me]);var Ie=ns(this._eventsInProgress);if(f&&(E||P)&&!Ie){this._updatingCamera=!0;var He=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Je=function(et){return et!==0&&-m._bearingSnap<et&&et<m._bearingSnap};He?(Je(He.bearing||this._map.getBearing())&&(He.bearing=0),this._map.easeTo(He,{originalEvent:te})):(this._map.fire(new s.Event("moveend",{originalEvent:te})),Je(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ur.prototype._fireEvent=function(c,d){this._map.fire(new s.Event(c,d?{originalEvent:d}:{}))},ur.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete c._frameId,c.handleEvent(new Rc("renderFrame",{timeStamp:d})),c._applyChanges()})},ur.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Eu=(function(c){function d(f,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},d.prototype.panBy=function(f,m,E){return f=s.Point.convert(f).mult(-1),this.panTo(this.transform.center,s.extend({offset:f},m),E)},d.prototype.panTo=function(f,m,E){return this.easeTo(s.extend({center:f},m),E)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},d.prototype.zoomTo=function(f,m,E){return this.easeTo(s.extend({zoom:f},m),E)},d.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},d.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},d.prototype.rotateTo=function(f,m,E){return this.easeTo(s.extend({bearing:f},m),E)},d.prototype.resetNorth=function(f,m){return this.rotateTo(0,s.extend({duration:1e3},f),m),this},d.prototype.resetNorthPitch=function(f,m){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},f),m),this},d.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},d.prototype.cameraForBounds=function(f,m){f=s.LngLatBounds.convert(f);var E=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),E,m)},d.prototype._cameraForBoxAndBearing=function(f,m,E,P){var L={top:0,bottom:0,right:0,left:0};if(typeof(P=s.extend({padding:L,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var F=P.padding;P.padding={top:F,bottom:F,right:F,left:F}}P.padding=s.extend(L,P.padding);var G=this.transform,W=G.padding,te=G.project(s.LngLat.convert(f)),$=G.project(s.LngLat.convert(m)),re=te.rotate(-E*Math.PI/180),se=$.rotate(-E*Math.PI/180),ve=new s.Point(Math.max(re.x,se.x),Math.max(re.y,se.y)),Pe=new s.Point(Math.min(re.x,se.x),Math.min(re.y,se.y)),me=ve.sub(Pe),Ie=(G.width-(W.left+W.right+P.padding.left+P.padding.right))/me.x,He=(G.height-(W.top+W.bottom+P.padding.top+P.padding.bottom))/me.y;if(!(He<0||Ie<0)){var Je=Math.min(G.scaleZoom(G.scale*Math.min(Ie,He)),P.maxZoom),et=typeof P.offset.x=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset),Xe=new s.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(E*Math.PI/180),Ye=et.add(Xe).mult(G.scale/G.zoomScale(Je));return{center:G.unproject(te.add($).div(2).sub(Ye)),zoom:Je,bearing:E}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(f,m,E){return this._fitInternal(this.cameraForBounds(f,m),m,E)},d.prototype.fitScreenCoordinates=function(f,m,E,P,L){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(f)),this.transform.pointLocation(s.Point.convert(m)),E,P),P,L)},d.prototype._fitInternal=function(f,m,E){return f?(delete(m=s.extend(f,m)).padding,m.linear?this.easeTo(m,E):this.flyTo(m,E)):this},d.prototype.jumpTo=function(f,m){this.stop();var E=this.transform,P=!1,L=!1,F=!1;return"zoom"in f&&E.zoom!==+f.zoom&&(P=!0,E.zoom=+f.zoom),f.center!==void 0&&(E.center=s.LngLat.convert(f.center)),"bearing"in f&&E.bearing!==+f.bearing&&(L=!0,E.bearing=+f.bearing),"pitch"in f&&E.pitch!==+f.pitch&&(F=!0,E.pitch=+f.pitch),f.padding==null||E.isPaddingEqual(f.padding)||(E.padding=f.padding),this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),P&&this.fire(new s.Event("zoomstart",m)).fire(new s.Event("zoom",m)).fire(new s.Event("zoomend",m)),L&&this.fire(new s.Event("rotatestart",m)).fire(new s.Event("rotate",m)).fire(new s.Event("rotateend",m)),F&&this.fire(new s.Event("pitchstart",m)).fire(new s.Event("pitch",m)).fire(new s.Event("pitchend",m)),this.fire(new s.Event("moveend",m))},d.prototype.easeTo=function(f,m){var E=this;this._stop(!1,f.easeId),((f=s.extend({offset:[0,0],duration:500,easing:s.ease},f)).animate===!1||!f.essential&&s.browser.prefersReducedMotion)&&(f.duration=0);var P=this.transform,L=this.getZoom(),F=this.getBearing(),G=this.getPitch(),W=this.getPadding(),te="zoom"in f?+f.zoom:L,$="bearing"in f?this._normalizeBearing(f.bearing,F):F,re="pitch"in f?+f.pitch:G,se="padding"in f?f.padding:P.padding,ve=s.Point.convert(f.offset),Pe=P.centerPoint.add(ve),me=P.pointLocation(Pe),Ie=s.LngLat.convert(f.center||me);this._normalizeCenter(Ie);var He,Je,et=P.project(me),Xe=P.project(Ie).sub(et),Ye=P.zoomScale(te-L);f.around&&(He=s.LngLat.convert(f.around),Je=P.locationPoint(He));var pt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||te!==L,this._rotating=this._rotating||F!==$,this._pitching=this._pitching||re!==G,this._padding=!P.isPaddingEqual(se),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,pt),this._ease(function(Ot){if(E._zooming&&(P.zoom=s.number(L,te,Ot)),E._rotating&&(P.bearing=s.number(F,$,Ot)),E._pitching&&(P.pitch=s.number(G,re,Ot)),E._padding&&(P.interpolatePadding(W,se,Ot),Pe=P.centerPoint.add(ve)),He)P.setLocationAtPoint(He,Je);else{var xt=P.zoomScale(P.zoom-L),Ut=te>L?Math.min(2,Ye):Math.max(.5,Ye),sr=Math.pow(Ut,1-Ot),Er=P.unproject(et.add(Xe.mult(Ot*sr)).mult(xt));P.setLocationAtPoint(P.renderWorldCopies?Er.wrap():Er,Pe)}E._fireMoveEvents(m)},function(Ot){E._afterEase(m,Ot)},f),this},d.prototype._prepareEase=function(f,m,E){E===void 0&&(E={}),this._moving=!0,m||E.moving||this.fire(new s.Event("movestart",f)),this._zooming&&!E.zooming&&this.fire(new s.Event("zoomstart",f)),this._rotating&&!E.rotating&&this.fire(new s.Event("rotatestart",f)),this._pitching&&!E.pitching&&this.fire(new s.Event("pitchstart",f))},d.prototype._fireMoveEvents=function(f){this.fire(new s.Event("move",f)),this._zooming&&this.fire(new s.Event("zoom",f)),this._rotating&&this.fire(new s.Event("rotate",f)),this._pitching&&this.fire(new s.Event("pitch",f))},d.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var E=this._zooming,P=this._rotating,L=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new s.Event("zoomend",f)),P&&this.fire(new s.Event("rotateend",f)),L&&this.fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f))}},d.prototype.flyTo=function(f,m){var E=this;if(!f.essential&&s.browser.prefersReducedMotion){var P=s.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,m)}this.stop(),f=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},f);var L=this.transform,F=this.getZoom(),G=this.getBearing(),W=this.getPitch(),te=this.getPadding(),$="zoom"in f?s.clamp(+f.zoom,L.minZoom,L.maxZoom):F,re="bearing"in f?this._normalizeBearing(f.bearing,G):G,se="pitch"in f?+f.pitch:W,ve="padding"in f?f.padding:L.padding,Pe=L.zoomScale($-F),me=s.Point.convert(f.offset),Ie=L.centerPoint.add(me),He=L.pointLocation(Ie),Je=s.LngLat.convert(f.center||He);this._normalizeCenter(Je);var et=L.project(He),Xe=L.project(Je).sub(et),Ye=f.curve,pt=Math.max(L.width,L.height),Ot=pt/Pe,xt=Xe.mag();if("minZoom"in f){var Ut=s.clamp(Math.min(f.minZoom,F,$),L.minZoom,L.maxZoom),sr=pt/L.zoomScale(Ut-F);Ye=Math.sqrt(sr/xt*2)}var Er=Ye*Ye;function Sr(Fr){var Or=(Ot*Ot-pt*pt+(Fr?-1:1)*Er*Er*xt*xt)/(2*(Fr?Ot:pt)*Er*xt);return Math.log(Math.sqrt(Or*Or+1)-Or)}function xn(Fr){return(Math.exp(Fr)-Math.exp(-Fr))/2}function ar(Fr){return(Math.exp(Fr)+Math.exp(-Fr))/2}var Wr=Sr(0),rn=function(Fr){return ar(Wr)/ar(Wr+Ye*Fr)},Vr=function(Fr){return pt*((ar(Wr)*(xn(Or=Wr+Ye*Fr)/ar(Or))-xn(Wr))/Er)/xt;var Or},Gr=(Sr(1)-Wr)/Ye;if(Math.abs(xt)<1e-6||!isFinite(Gr)){if(Math.abs(pt-Ot)<1e-6)return this.easeTo(f,m);var qr=Ot<pt?-1:1;Gr=Math.abs(Math.log(Ot/pt))/Ye,Vr=function(){return 0},rn=function(Fr){return Math.exp(qr*Ye*Fr)}}return f.duration="duration"in f?+f.duration:1e3*Gr/("screenSpeed"in f?+f.screenSpeed/Ye:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=G!==re,this._pitching=se!==W,this._padding=!L.isPaddingEqual(ve),this._prepareEase(m,!1),this._ease(function(Fr){var Or=Fr*Gr,Xi=1/rn(Or);L.zoom=Fr===1?$:F+L.scaleZoom(Xi),E._rotating&&(L.bearing=s.number(G,re,Fr)),E._pitching&&(L.pitch=s.number(W,se,Fr)),E._padding&&(L.interpolatePadding(te,ve,Fr),Ie=L.centerPoint.add(me));var Ti=Fr===1?Je:L.unproject(et.add(Xe.mult(Vr(Or))).mult(Xi));L.setLocationAtPoint(L.renderWorldCopies?Ti.wrap():Ti,Ie),E._fireMoveEvents(m)},function(){return E._afterEase(m)},f),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,m)}if(!f){var P=this.handlers;P&&P.stop(!1)}return this},d.prototype._ease=function(f,m,E){E.animate===!1||E.duration===0?(f(1),m()):(this._easeStart=s.browser.now(),this._easeOptions=E,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var f=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(f,m){f=s.wrap(f,-180,180);var E=Math.abs(f-m);return Math.abs(f-360-m)<E&&(f-=360),Math.abs(f+360-m)<E&&(f+=360),f},d.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var E=f.lng-m.center.lng;f.lng+=E>180?-360:E<-180?360:0}},d})(s.Evented),us=function(c){c===void 0&&(c={}),this.options=c,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};us.prototype.getDefaultPosition=function(){return"bottom-right"},us.prototype.onAdd=function(c){var d=this.options&&this.options.compact;return this._map=c,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=h.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=h.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},us.prototype.onRemove=function(){h.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},us.prototype._setElementTitle=function(c,d){var f=this._map._getUIString("AttributionControl."+d);c.title=f,c.setAttribute("aria-label",f)},us.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},us.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(c){var f=d.reduce(function(m,E,P){return E.value&&(m+=E.key+"="+E.value+(P<d.length-1?"&":"")),m},"?");c.href=s.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},us.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},us.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var f=this._map.style.sourceCaches;for(var m in f){var E=f[m];if(E.used){var P=E.getSource();P.attribution&&c.indexOf(P.attribution)<0&&c.push(P.attribution)}}c.sort(function(F,G){return F.length-G.length});var L=(c=c.filter(function(F,G){for(var W=G+1;W<c.length;W++)if(c[W].indexOf(F)>=0)return!1;return!0})).join(" | ");L!==this._attribHTML&&(this._attribHTML=L,c.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},us.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ki=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};Ki.prototype.onAdd=function(c){this._map=c,this._container=h.create("div","mapboxgl-ctrl");var d=h.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ki.prototype.onRemove=function(){h.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ki.prototype.getDefaultPosition=function(){return"bottom-left"},Ki.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ki.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var d in c)if(c[d].getSource().mapbox_logo)return!0;return!1}},Ki.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Xn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Xn.prototype.add=function(c){var d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d},Xn.prototype.remove=function(c){for(var d=this._currentlyRunning,f=0,m=d?this._queue.concat(d):this._queue;f<m.length;f+=1){var E=m[f];if(E.id===c)return void(E.cancelled=!0)}},Xn.prototype.run=function(c){c===void 0&&(c=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=d;f<m.length;f+=1){var E=m[f];if(!E.cancelled&&(E.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Xn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ur={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},lo=s.window.HTMLImageElement,An=s.window.HTMLElement,Qr=s.window.ImageBitmap,ki={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bu=(function(c){function d(m){var E=this;if((m=s.extend({},ki,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new hn(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,P,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Xn,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Ur,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new s.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=s.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof An))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ur(this,m),this._hash=m.hash&&new Vs(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new us({customAttribution:m.customAttribution})),this.addControl(new Ki,m.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(L){E._update(L.dataType==="style"),E.fire(new s.Event(L.dataType+"data",L))}),this.on("dataloading",function(L){E.fire(new s.Event(L.dataType+"dataloading",L))})}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(m,E){if(E===void 0&&(E=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=m.onAdd(this);this._controls.push(m);var L=this._controlPositions[E];return E.indexOf("bottom")!==-1?L.insertBefore(P,L.firstChild):L.appendChild(P),this},d.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(m);return E>-1&&this._controls.splice(E,1),m.onRemove(this),this},d.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},d.prototype.resize=function(m){var E=this._containerDimensions(),P=E[0],L=E[1];if(P===this.transform.width&&L===this.transform.height)return this;this._resizeCanvas(P,L),this.transform.resize(P,L),this.painter.resize(P,L);var F=!this._moving;return F&&this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),this.fire(new s.Event("resize",m)),F&&this.fire(new s.Event("moveend",m)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(s.LngLatBounds.convert(m)),this._update()},d.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},d.prototype.project=function(m){return this.transform.locationPoint(s.LngLat.convert(m))},d.prototype.unproject=function(m){return this.transform.pointLocation(s.Point.convert(m))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(m,E,P){var L,F=this;if(m==="mouseenter"||m==="mouseover"){var G=!1;return{layer:E,listener:P,delegates:{mousemove:function(te){var $=F.getLayer(E)?F.queryRenderedFeatures(te.point,{layers:[E]}):[];$.length?G||(G=!0,P.call(F,new Nn(m,F,te.originalEvent,{features:$}))):G=!1},mouseout:function(){G=!1}}}}if(m==="mouseleave"||m==="mouseout"){var W=!1;return{layer:E,listener:P,delegates:{mousemove:function(te){(F.getLayer(E)?F.queryRenderedFeatures(te.point,{layers:[E]}):[]).length?W=!0:W&&(W=!1,P.call(F,new Nn(m,F,te.originalEvent)))},mouseout:function(te){W&&(W=!1,P.call(F,new Nn(m,F,te.originalEvent)))}}}}return{layer:E,listener:P,delegates:(L={},L[m]=function(te){var $=F.getLayer(E)?F.queryRenderedFeatures(te.point,{layers:[E]}):[];$.length&&(te.features=$,P.call(F,te),delete te.features)},L)}},d.prototype.on=function(m,E,P){if(P===void 0)return c.prototype.on.call(this,m,E);var L=this._createDelegatedListener(m,E,P);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(L),L.delegates)this.on(F,L.delegates[F]);return this},d.prototype.once=function(m,E,P){if(P===void 0)return c.prototype.once.call(this,m,E);var L=this._createDelegatedListener(m,E,P);for(var F in L.delegates)this.once(F,L.delegates[F]);return this},d.prototype.off=function(m,E,P){var L=this;return P===void 0?c.prototype.off.call(this,m,E):(this._delegatedListeners&&this._delegatedListeners[m]&&(function(F){for(var G=F[m],W=0;W<G.length;W++){var te=G[W];if(te.layer===E&&te.listener===P){for(var $ in te.delegates)L.off($,te.delegates[$]);return G.splice(W,1),L}}})(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(m,E){if(!this.style)return[];var P;if(E!==void 0||m===void 0||m instanceof s.Point||Array.isArray(m)||(E=m,m=void 0),E=E||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof m[0]=="number")P=[s.Point.convert(m)];else{var L=s.Point.convert(m[0]),F=s.Point.convert(m[1]);P=[L,new s.Point(F.x,L.y),F,new s.Point(L.x,F.y),L]}return this.style.queryRenderedFeatures(P,E,this.transform)},d.prototype.querySourceFeatures=function(m,E){return this.style.querySourceFeatures(m,E)},d.prototype.setStyle=function(m,E){return(E=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(m,E))},d.prototype._getUIString=function(m){var E=this._locale[m];if(E==null)throw new Error("Missing UI string '"+m+"'");return E},d.prototype._updateStyle=function(m,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new zn(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new zn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(m,E){var P=this;if(typeof m=="string"){var L=this._requestManager.normalizeStyleURL(m),F=this._requestManager.transformRequest(L,s.ResourceType.Style);s.getJSON(F,function(G,W){G?P.fire(new s.ErrorEvent(G)):W&&P._updateDiff(W,E)})}else typeof m=="object"&&this._updateDiff(m,E)},d.prototype._updateDiff=function(m,E){try{this.style.setState(m)&&this._update(!0)}catch(P){s.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(m,E)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(m,E){return this._lazyInitEmptyStyle(),this.style.addSource(m,E),this._update(!0)},d.prototype.isSourceLoaded=function(m){var E=this.style&&this.style.sourceCaches[m];if(E!==void 0)return E.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},d.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var E in m){var P=m[E]._tiles;for(var L in P){var F=P[L];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(m,E,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,E,P)},d.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},d.prototype.getSource=function(m){return this.style.getSource(m)},d.prototype.addImage=function(m,E,P){P===void 0&&(P={});var L=P.pixelRatio;L===void 0&&(L=1);var F=P.sdf;F===void 0&&(F=!1);var G=P.stretchX,W=P.stretchY,te=P.content;if(this._lazyInitEmptyStyle(),E instanceof lo||Qr&&E instanceof Qr){var $=s.browser.getImageData(E);this.style.addImage(m,{data:new s.RGBAImage({width:$.width,height:$.height},$.data),pixelRatio:L,stretchX:G,stretchY:W,content:te,sdf:F,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var re=E;this.style.addImage(m,{data:new s.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:L,stretchX:G,stretchY:W,content:te,sdf:F,version:0,userImage:re}),re.onAdd&&re.onAdd(this,m)}},d.prototype.updateImage=function(m,E){var P=this.style.getImage(m);if(!P)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var L=E instanceof lo||Qr&&E instanceof Qr?s.browser.getImageData(E):E,F=L.width,G=L.height,W=L.data;return F===void 0||G===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==P.data.width||G!==P.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(W,!(E instanceof lo||Qr&&E instanceof Qr)),void this.style.updateImage(m,P))},d.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(m){this.style.removeImage(m)},d.prototype.loadImage=function(m,E){s.getImage(this._requestManager.transformRequest(m,s.ResourceType.Image),E)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(m,E){return this._lazyInitEmptyStyle(),this.style.addLayer(m,E),this._update(!0)},d.prototype.moveLayer=function(m,E){return this.style.moveLayer(m,E),this._update(!0)},d.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},d.prototype.getLayer=function(m){return this.style.getLayer(m)},d.prototype.setLayerZoomRange=function(m,E,P){return this.style.setLayerZoomRange(m,E,P),this._update(!0)},d.prototype.setFilter=function(m,E,P){return P===void 0&&(P={}),this.style.setFilter(m,E,P),this._update(!0)},d.prototype.getFilter=function(m){return this.style.getFilter(m)},d.prototype.setPaintProperty=function(m,E,P,L){return L===void 0&&(L={}),this.style.setPaintProperty(m,E,P,L),this._update(!0)},d.prototype.getPaintProperty=function(m,E){return this.style.getPaintProperty(m,E)},d.prototype.setLayoutProperty=function(m,E,P,L){return L===void 0&&(L={}),this.style.setLayoutProperty(m,E,P,L),this._update(!0)},d.prototype.getLayoutProperty=function(m,E){return this.style.getLayoutProperty(m,E)},d.prototype.setLight=function(m,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(m,E),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(m,E){return this.style.setFeatureState(m,E),this._update()},d.prototype.removeFeatureState=function(m,E){return this.style.removeFeatureState(m,E),this._update()},d.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var m=0,E=0;return this._container&&(m=this._container.clientWidth||400,E=this._container.clientHeight||300),[m,E]},d.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=h.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=h.create("div","mapboxgl-canvas-container",m);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=h.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var L=this._controlContainer=h.create("div","mapboxgl-control-container",m),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){F[G]=h.create("div","mapboxgl-ctrl-"+G,L)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(m,E){var P=s.browser.devicePixelRatio||1;this._canvas.width=P*m,this._canvas.height=P*E,this._canvas.style.width=m+"px",this._canvas.style.height=E+"px"},d.prototype._setupPainter=function(){var m=s.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);E?(this.painter=new Kn(E,this.transform),s.webpSupported.testSupport(E)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:m}))},d.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:m}))},d.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},d.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},d.prototype._render=function(m){var E,P=this,L=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,E),L=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,te=s.browser.now();this.style.zoomHistory.update(W,te);var $=new s.EvaluationParameters(W,{now:te,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=$.crossFadingFactor();re===1&&re===this._crossFadingFactor||(G=!0,this._crossFadingFactor=re),this.style.update($)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var se=s.browser.now()-L;F.endQueryEXT(F.TIME_ELAPSED_EXT,E),setTimeout(function(){var me=F.getQueryObjectEXT(E,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(E),P.fire(new s.Event("gpu-timing-frame",{cpuTime:se,gpuTime:me}))},50)}if(this.listens("gpu-timing-layer")){var ve=this.painter.collectGpuTimers();setTimeout(function(){var me=P.painter.queryGpuTimers(ve);P.fire(new s.Event("gpu-timing-layer",{layerTimes:me}))},50)}var Pe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Pe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||Pe||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,E=this._controls;m<E.length;m+=1)E[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Js(this._canvasContainer),Js(this._controlContainer),Js(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},d.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(E){m._frame=null,m._render(E)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},d.prototype._setCacheLimits=function(m,E){s.setCacheLimits(m,E)},f.version.get=function(){return s.version},Object.defineProperties(d.prototype,f),d})(Eu);function Js(c){c.parentNode&&c.parentNode.removeChild(c)}var Sh={showCompass:!0,showZoom:!0,visualizePitch:!1},di=function(c){var d=this;this.options=s.extend({},Sh,c),this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return d._map.zoomIn({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return d._map.zoomOut({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:f}):d._map.resetNorth({},{originalEvent:f})}),this._compassIcon=h.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};di.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),d=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},di.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},di.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new is(this._map,this._compass,this.options.visualizePitch)),this._container},di.prototype.onRemove=function(){h.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},di.prototype._createButton=function(c,d){var f=h.create("button",c,this._container);return f.type="button",f.addEventListener("click",d),f},di.prototype._setButtonTitle=function(c,d){var f=this._map._getUIString("NavigationControl."+d);c.title=f,c.setAttribute("aria-label",f)};var is=function(c,d,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new xu({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new Eh({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener(d,"mousedown",this.mousedown),h.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),h.addEventListener(d,"touchmove",this.touchmove),h.addEventListener(d,"touchend",this.touchend),h.addEventListener(d,"touchcancel",this.reset)};function Eo(c,d,f){if(c=new s.LngLat(c.lng,c.lat),d){var m=new s.LngLat(c.lng-360,c.lat),E=new s.LngLat(c.lng+360,c.lat),P=f.locationPoint(c).distSqr(d);f.locationPoint(m).distSqr(d)<P?c=m:f.locationPoint(E).distSqr(d)<P&&(c=E)}for(;Math.abs(c.lng-f.center.lng)>180;){var L=f.locationPoint(c);if(L.x>=0&&L.y>=0&&L.x<=f.width&&L.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}is.prototype.down=function(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),h.disableDrag()},is.prototype.move=function(c,d){var f=this.map,m=this.mouseRotate.mousemoveWindow(c,d);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(c,d);E&&E.pitchDelta&&f.setPitch(f.getPitch()+E.pitchDelta)}},is.prototype.off=function(){var c=this.element;h.removeEventListener(c,"mousedown",this.mousedown),h.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),h.removeEventListener(c,"touchmove",this.touchmove),h.removeEventListener(c,"touchend",this.touchend),h.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},is.prototype.offTemp=function(){h.enableDrag(),h.removeEventListener(s.window,"mousemove",this.mousemove),h.removeEventListener(s.window,"mouseup",this.mouseup)},is.prototype.mousedown=function(c){this.down(s.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),h.mousePos(this.element,c)),h.addEventListener(s.window,"mousemove",this.mousemove),h.addEventListener(s.window,"mouseup",this.mouseup)},is.prototype.mousemove=function(c){this.move(c,h.mousePos(this.element,c))},is.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},is.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=h.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},is.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=h.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},is.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},is.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Bo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Kt(c,d,f){var m=c.classList;for(var E in Bo)m.remove("mapboxgl-"+f+"-anchor-"+E);m.add("mapboxgl-"+f+"-anchor-"+d)}var tr,jl=(function(c){function d(f,m){if(c.call(this),(f instanceof s.window.HTMLElement||m)&&(f=s.extend({element:f},m)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=s.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=h.create("div"),this._element.setAttribute("aria-label","Map marker");var E=h.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var P=h.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var L=h.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill-rule","nonzero");var F=h.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var G=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<W.length;G+=1){var te=W[G],$=h.createNS("http://www.w3.org/2000/svg","ellipse");$.setAttributeNS(null,"opacity","0.04"),$.setAttributeNS(null,"cx","10.5"),$.setAttributeNS(null,"cy","5.80029008"),$.setAttributeNS(null,"rx",te.rx),$.setAttributeNS(null,"ry",te.ry),F.appendChild($)}var re=h.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"fill",this._color);var se=h.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),re.appendChild(se);var ve=h.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"opacity","0.25"),ve.setAttributeNS(null,"fill","#000000");var Pe=h.createNS("http://www.w3.org/2000/svg","path");Pe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ve.appendChild(Pe);var me=h.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");var Ie=h.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");var He=h.createNS("http://www.w3.org/2000/svg","circle");He.setAttributeNS(null,"fill","#000000"),He.setAttributeNS(null,"opacity","0.25"),He.setAttributeNS(null,"cx","5.5"),He.setAttributeNS(null,"cy","5.5"),He.setAttributeNS(null,"r","5.4999962");var Je=h.createNS("http://www.w3.org/2000/svg","circle");Je.setAttributeNS(null,"fill","#FFFFFF"),Je.setAttributeNS(null,"cx","5.5"),Je.setAttributeNS(null,"cy","5.5"),Je.setAttributeNS(null,"r","5.4999962"),Ie.appendChild(He),Ie.appendChild(Je),L.appendChild(F),L.appendChild(re),L.appendChild(ve),L.appendChild(me),L.appendChild(Ie),E.appendChild(L),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=s.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(et){et.preventDefault()}),this._element.addEventListener("mousedown",function(et){et.preventDefault()}),Kt(this._element,this._anchor,"marker"),this._popup=null}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),h.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(f){var m=f.code,E=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&E!==32&&E!==13||this.togglePopup()},d.prototype._onMapClick=function(f){var m=f.originalEvent.target,E=this._element;this._popup&&(m===E||E.contains(m))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},d.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),h.setTransform(this._element,Bo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+m)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(f){return this._offset=s.Point.convert(f),this._update(),this},d.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d})(s.Evented),Oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},na=0,Do=!1,ia=(function(c){function d(f){c.call(this),this.options=s.extend({},Oc,f),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.onAdd=function(f){var m;return this._map=f,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,tr!==void 0?m(tr):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(E){m(tr=E.state!=="denied")}):m(tr=!!s.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),h.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,na=0,Do=!1},d.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),E=f.coords;return m&&(E.longitude<m.getWest()||E.longitude>m.getEast()||E.latitude<m.getSouth()||E.latitude>m.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",f)),this._finish()}},d.prototype._updateCamera=function(f){var m=new s.LngLat(f.coords.longitude,f.coords.latitude),E=f.coords.accuracy,P=this._map.getBearing(),L=s.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(E),L,{geolocateSource:!0})},d.prototype._updateMarker=function(f){if(f){var m=new s.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),E=this._map.unproject([1,f]),P=m.distanceTo(E),L=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=L+"px",this._circleElement.style.height=L+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Do)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",f)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(L){return L.preventDefault()}),this._geolocateButton=h.create("button","mapboxgl-ctrl-geolocate",this._container),h.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new jl(this._dotElement),this._circleElement=h.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(L){L.geolocateSource||m._watchState!=="ACTIVE_LOCK"||L.originalEvent&&L.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new s.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":na--,Do=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++na>1?(f={maximumAge:6e5,timeout:0},Do=!0):(f=this.options.positionOptions,Do=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d})(s.Evented),sa={maxWidth:100,unit:"metric"},_s=function(c){this.options=s.extend({},sa,c),s.bindAll(["_onMove","setUnit"],this)};function y(c,d,f){var m=f&&f.maxWidth||100,E=c._container.clientHeight/2,P=c.unproject([0,E]),L=c.unproject([m,E]),F=P.distanceTo(L);if(f&&f.unit==="imperial"){var G=3.2808*F;G>5280?_(d,m,G/5280,c._getUIString("ScaleControl.Miles")):_(d,m,G,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?_(d,m,F/1852,c._getUIString("ScaleControl.NauticalMiles")):F>=1e3?_(d,m,F/1e3,c._getUIString("ScaleControl.Kilometers")):_(d,m,F,c._getUIString("ScaleControl.Meters"))}function _(c,d,f,m){var E,P,L,F=(E=f,(P=Math.pow(10,(""+Math.floor(E)).length-1))*(L=(L=E/P)>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:(function(G){var W=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*W)/W})(L)));c.style.width=d*(F/f)+"px",c.innerHTML=F+"&nbsp;"+m}_s.prototype.getDefaultPosition=function(){return"bottom-left"},_s.prototype._onMove=function(){y(this._map,this._container,this.options)},_s.prototype.onAdd=function(c){return this._map=c,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},_s.prototype.onRemove=function(){h.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},_s.prototype.setUnit=function(c){this.options.unit=c,y(this._map,this._container,this.options)};var v=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};v.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},v.prototype.onRemove=function(){h.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},v.prototype._setupUI=function(){var c=this._fullscreenButton=h.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);h.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},v.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},v.prototype._isFullscreen=function(){return this._fullscreen},v.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},v.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=(function(c){function d(f){c.call(this),this.options=s.extend(Object.create(w),f),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&h.remove(this._content),this._container&&(h.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(f){return this.setDOMContent(s.window.document.createTextNode(f))},d.prototype.setHTML=function(f){var m,E=s.window.document.createDocumentFragment(),P=s.window.document.createElement("body");for(P.innerHTML=f;m=P.firstChild;)E.appendChild(m);return this.setDOMContent(E)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},d.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=h.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},d.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},d.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},d.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=h.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(f){this._update(f.point)},d.prototype._onMouseMove=function(f){this._update(f.point)},d.prototype._onDrag=function(f){this._update(f.point)},d.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=h.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=h.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function($){return m._container.classList.add($)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Eo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var E=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),P=this.options.anchor,L=(function $(re){if(re){if(typeof re=="number"){var se=Math.round(Math.sqrt(.5*Math.pow(re,2)));return{center:new s.Point(0,0),top:new s.Point(0,re),"top-left":new s.Point(se,se),"top-right":new s.Point(-se,se),bottom:new s.Point(0,-re),"bottom-left":new s.Point(se,-se),"bottom-right":new s.Point(-se,-se),left:new s.Point(re,0),right:new s.Point(-re,0)}}if(re instanceof s.Point||Array.isArray(re)){var ve=s.Point.convert(re);return{center:ve,top:ve,"top-left":ve,"top-right":ve,bottom:ve,"bottom-left":ve,"bottom-right":ve,left:ve,right:ve}}return{center:s.Point.convert(re.center||[0,0]),top:s.Point.convert(re.top||[0,0]),"top-left":s.Point.convert(re["top-left"]||[0,0]),"top-right":s.Point.convert(re["top-right"]||[0,0]),bottom:s.Point.convert(re.bottom||[0,0]),"bottom-left":s.Point.convert(re["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(re["bottom-right"]||[0,0]),left:s.Point.convert(re.left||[0,0]),right:s.Point.convert(re.right||[0,0])}}return $(new s.Point(0,0))})(this.options.offset);if(!P){var F,G=this._container.offsetWidth,W=this._container.offsetHeight;F=E.y+L.bottom.y<W?["top"]:E.y>this._map.transform.height-W?["bottom"]:[],E.x<G/2?F.push("left"):E.x>this._map.transform.width-G/2&&F.push("right"),P=F.length===0?"bottom":F.join("-")}var te=E.add(L[P]).round();h.setTransform(this._container,Bo[P]+" translate("+te.x+"px,"+te.y+"px)"),Kt(this._container,P,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(T);f&&f.focus()}},d.prototype._onClose=function(){this.remove()},d})(s.Evented),O={version:s.version,supported:l,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:Bu,NavigationControl:di,GeolocateControl:ia,AttributionControl:us,ScaleControl:_s,FullscreenControl:v,Popup:M,Marker:jl,Style:zn,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){ht().acquire(Qe)},clearPrewarmedResources:function(){var c=Pt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Qe),Pt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Et.workerCount},set workerCount(c){Et.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){s.clearTileCache(c)},workerUrl:""};return O}),i})})(ux)),ux.exports}var Kse=Jse();const pc=bf(Kse);var Xse=1e-7;function hx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function r8(t,e){if(t===e)return!0;if(hx(t)&&hx(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(!r8(t[r],e[r]))return!1;return!0}return Math.abs(t-e)<=Xse}function o0(t,e,r){return Math.max(e,Math.min(r,t))}function U_(t,e,r){return hx(t)?t.map(function(n,i){return U_(n,e[i],r)}):r*e+(1-r)*t}function Al(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}function WI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function JI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?WI(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):WI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Yh={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},zv={pitch:0,bearing:0,altitude:1.5},KI=5,Qse=1.2,Ep=(function(){function t(e){var r=e.width,n=e.height,i=e.latitude,o=e.longitude,s=e.zoom,l=e.bearing,h=l===void 0?zv.bearing:l,A=e.pitch,b=A===void 0?zv.pitch:A,C=e.altitude,S=C===void 0?zv.altitude:C,D=e.maxZoom,N=D===void 0?Yh.maxZoom:D,U=e.minZoom,V=U===void 0?Yh.minZoom:U,j=e.maxPitch,ee=j===void 0?Yh.maxPitch:j,Q=e.minPitch,X=Q===void 0?Yh.minPitch:Q,pe=e.transitionDuration,Y=e.transitionEasing,Ge=e.transitionInterpolator,ze=e.transitionInterruption,de=e.startPanLngLat,ce=e.startZoomLngLat,De=e.startRotatePos,J=e.startBearing,ue=e.startPitch,Ee=e.startZoom;hh(this,t),Al(Number.isFinite(r),"`width` must be supplied"),Al(Number.isFinite(n),"`height` must be supplied"),Al(Number.isFinite(o),"`longitude` must be supplied"),Al(Number.isFinite(i),"`latitude` must be supplied"),Al(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:h,pitch:b,altitude:S,maxZoom:N,minZoom:V,maxPitch:ee,minPitch:X,transitionDuration:pe,transitionEasing:Y,transitionInterpolator:Ge,transitionInterruption:ze}),this._state={startPanLngLat:de,startZoomLngLat:ce,startRotatePos:De,startBearing:J,startPitch:ue,startZoom:Ee}}return uh(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(e){var r=e.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(r)})}},{key:"pan",value:function(e){var r=e.pos,n=e.startPos,i=this._state.startPanLngLat||this._unproject(n);if(!i)return this;var o=this._calculateNewLngLat({startPanLngLat:i,pos:r}),s=As(o,2),l=s[0],h=s[1];return this._getUpdatedMapState({longitude:l,latitude:h})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(e){var r=e.pos;return this._getUpdatedMapState({startRotatePos:r,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(e){var r=e.pos,n=e.deltaAngleX,i=n===void 0?0:n,o=e.deltaAngleY,s=o===void 0?0:o,l=this._state,h=l.startRotatePos,A=l.startBearing,b=l.startPitch;if(!Number.isFinite(A)||!Number.isFinite(b))return this;var C;return r?C=this._calculateNewPitchAndBearing(JI(JI({},this._getRotationParams(r,h)),{},{startBearing:A,startPitch:b})):C={bearing:A+i,pitch:b+s},this._getUpdatedMapState(C)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(e){var r=e.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(r),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(e){var r=e.pos,n=e.startPos,i=e.scale;Al(i>0,"`scale` must be a positive number");var o=this._state,s=o.startZoom,l=o.startZoomLngLat;Number.isFinite(s)||(s=this._viewportProps.zoom,l=this._unproject(n)||this._unproject(r)),Al(l,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var h=this._calculateNewZoom({scale:i,startZoom:s||0}),A=new hc(Object.assign({},this._viewportProps,{zoom:h})),b=A.getMapCenterByLngLatPosition({lngLat:l,pos:r}),C=As(b,2),S=C[0],D=C[1];return this._getUpdatedMapState({zoom:h,longitude:S,latitude:D})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(e){return new t(Object.assign({},this._viewportProps,this._state,e))}},{key:"_applyConstraints",value:function(e){var r=e.maxZoom,n=e.minZoom,i=e.zoom;e.zoom=o0(i,n,r);var o=e.maxPitch,s=e.minPitch,l=e.pitch;return e.pitch=o0(l,s,o),Object.assign(e,Fse(e)),e}},{key:"_unproject",value:function(e){var r=new hc(this._viewportProps);return e&&r.unproject(e)}},{key:"_calculateNewLngLat",value:function(e){var r=e.startPanLngLat,n=e.pos,i=new hc(this._viewportProps);return i.getMapCenterByLngLatPosition({lngLat:r,pos:n})}},{key:"_calculateNewZoom",value:function(e){var r=e.scale,n=e.startZoom,i=this._viewportProps,o=i.maxZoom,s=i.minZoom,l=n+Math.log2(r);return o0(l,s,o)}},{key:"_calculateNewPitchAndBearing",value:function(e){var r=e.deltaScaleX,n=e.deltaScaleY,i=e.startBearing,o=e.startPitch;n=o0(n,-1,1);var s=this._viewportProps,l=s.minPitch,h=s.maxPitch,A=i+180*r,b=o;return n>0?b=o+n*(h-o):n<0&&(b=o-n*(l-o)),{pitch:b,bearing:A}}},{key:"_getRotationParams",value:function(e,r){var n=e[0]-r[0],i=e[1]-r[1],o=e[1],s=r[1],l=this._viewportProps,h=l.width,A=l.height,b=n/h,C=0;return i>0?Math.abs(A-s)>KI&&(C=i/(s-A)*Qse):i<0&&s>KI&&(C=1-o/s),C=Math.min(1,Math.max(-1,C)),{deltaScaleX:b,deltaScaleY:C}}}]),t})();function Zse(t){return t[0].toLowerCase()+t.slice(1)}function $se(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yh;for(var r in e){var n=r.slice(0,3),i=Zse(r.slice(3));if(n==="min"&&t[i]<e[r]||n==="max"&&t[i]>e[r])return!1}return!0}function XI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function QI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?XI(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):XI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Bf=Tt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),OC=Bf.Provider;function qse(t){var e=t.value,r=t.children,n=Tt.useState(null),i=As(n,2),o=i[0],s=i[1],l=Tt.useContext(Bf);return e=QI(QI({setMap:s},l),{},{map:l&&l.map||o},e),Tt.createElement(OC,{value:e},r)}Bf.Provider=qse;var fx=typeof window<"u"?Tt.useLayoutEffect:Tt.useEffect;function ZI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function pl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ZI(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ZI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Yse="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",n8="A valid API access token is required to use Mapbox data";function eoe(){}function i8(t){var e=t.props,r=t.width,n=t.height;return new hc(pl(pl(pl({},e),e.viewState),{},{width:r,height:n}))}var toe=401,$I={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},roe=Object.assign({},qh.propTypes,{width:At.oneOfType([At.number,At.string]),height:At.oneOfType([At.number,At.string]),onResize:At.func,disableTokenWarning:At.bool,visible:At.bool,className:At.string,style:At.object,visibilityConstraints:At.object}),noe=Object.assign({},qh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:eoe,className:"",style:null,visibilityConstraints:Yh});function ioe(){var t={position:"absolute",left:0,top:0};return Tt.createElement("div",{key:"warning",id:"no-token-warning",style:t},Tt.createElement("h3",{key:"header"},n8),Tt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Tt.createElement("a",{key:"link",href:Yse},"Note on Map Tokens"))}function soe(t){return{getMap:function(){return t.current&&t.current.getMap()},queryRenderedFeatures:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.current&&t.current.getMap();return n&&n.queryRenderedFeatures(e,r)}}}var eu=Tt.forwardRef(function(t,e){var r=Tt.useState(!0),n=As(r,2),i=n[0],o=n[1],s=Tt.useState({width:0,height:0}),l=As(s,2),h=l[0],A=l[1],b=Tt.useRef(null),C=Tt.useRef(null),S=Tt.useRef(null),D=Tt.useRef(null),N=Tt.useContext(Bf);fx(function(){if(eu.supported()){var ce=new qh(pl(pl(pl({},t),h),{},{mapboxgl:pc,container:C.current,onError:function(J){var ue=J.error&&J.error.status||J.status;ue===toe&&i&&(console.error(n8),o(!1)),t.onError(J)}}));b.current=ce,N&&N.setMap&&N.setMap(ce.getMap());var De=new hU(function(J){if(J[0].contentRect){var ue=J[0].contentRect,Ee=ue.width,ct=ue.height;A({width:Ee,height:ct}),t.onResize({width:Ee,height:ct})}});return De.observe(S.current),function(){ce.finalize(),b.current=null,De.disconnect()}}},[]),fx(function(){b.current&&b.current.setProps(pl(pl({},t),h))});var U=b.current&&b.current.getMap();Tt.useImperativeHandle(e,function(){return soe(b)},[]);var V=Tt.useCallback(function(ce){var De=ce.target;De===D.current&&De.scrollTo(0,0)},[]),j=U&&Tt.createElement(OC,{value:pl(pl({},N),{},{viewport:N.viewport||i8(pl({map:U,props:t},h)),map:U,container:N.container||S.current})},Tt.createElement("div",{key:"map-overlays",className:"overlays",ref:D,style:$I,onScroll:V},t.children)),ee=t.className,Q=t.width,X=t.height,pe=t.style,Y=t.visibilityConstraints,Ge=Object.assign({position:"relative"},pe,{width:Q,height:X}),ze=t.visible&&$se(t.viewState||t,Y),de=Object.assign({},$I,{visibility:ze?"inherit":"hidden"});return Tt.createElement("div",{key:"map-container",ref:S,style:Ge},Tt.createElement("div",{key:"map-mapbox",ref:C,style:de,className:ee}),j,!i&&!t.disableTokenWarning&&Tt.createElement(ioe,null))});eu.supported=function(){return pc&&pc.supported()},eu.propTypes=roe,eu.defaultProps=noe;function ooe(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=aoe(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){r=t[Symbol.iterator]()},n:function(){var h=r.next();return o=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function aoe(t,e){if(t){if(typeof t=="string")return qI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qI(t,e)}}function qI(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var s8=(function(){function t(){hh(this,t),Cr(this,"propNames",[])}return uh(t,[{key:"arePropsEqual",value:function(e,r){var n=ooe(this.propNames||[]),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;if(!r8(e[o],r[o]))return!1}}catch(s){n.e(s)}finally{n.f()}return!0}},{key:"initializeProps",value:function(e,r){return{start:e,end:r}}},{key:"interpolateProps",value:function(e,r,n){Al(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(e,r){return r.transitionDuration}}]),t})(),loe={longitude:1,bearing:1};function G_(t){return Number.isFinite(t)||Array.isArray(t)}function coe(t){return t in loe}function dx(t,e,r){return coe(t)&&Math.abs(r-e)>180&&(r=r<0?r+360:r-360),r}function jv(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=uoe(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){r=t[Symbol.iterator]()},n:function(){var h=r.next();return o=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function uoe(t,e){if(t){if(typeof t=="string")return YI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return YI(t,e)}}function YI(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function hoe(t){var e=foe();return function(){var r=Pp(t),n;if(e){var i=Pp(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return bw(this,n)}}function foe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var doe=["longitude","latitude","zoom","bearing","pitch"],poe=["latitude","longitude","zoom","width","height"],eM=["bearing","pitch"],Aoe={speed:1.2,curve:1.414};(function(t){yw(r,t);var e=hoe(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hh(this,r),n=e.call(this),Cr(zu(n),"propNames",doe),n.props=Object.assign({},Aoe,i),n}return uh(r,[{key:"initializeProps",value:function(n,i){var o={},s={},l=jv(poe),h;try{for(l.s();!(h=l.n()).done;){var A=h.value,b=n[A],C=i[A];Al(G_(b)&&G_(C),"".concat(A," must be supplied for transition")),o[A]=b,s[A]=dx(A,b,C)}}catch(j){l.e(j)}finally{l.f()}var S=jv(eM),D;try{for(S.s();!(D=S.n()).done;){var N=D.value,U=n[N]||0,V=i[N]||0;o[N]=U,s[N]=dx(N,U,V)}}catch(j){S.e(j)}finally{S.f()}return{start:o,end:s}}},{key:"interpolateProps",value:function(n,i,o){var s=Nse(n,i,o,this.props),l=jv(eM),h;try{for(l.s();!(h=l.n()).done;){var A=h.value;s[A]=U_(n[A],i[A],o)}}catch(b){l.e(b)}finally{l.f()}return s}},{key:"getDuration",value:function(n,i){var o=i.transitionDuration;return o==="auto"&&(o=Use(n,i,this.props)),o}}]),r})(s8);function tM(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=goe(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,l;return{s:function(){r=t[Symbol.iterator]()},n:function(){var h=r.next();return o=h.done,h},e:function(h){s=!0,l=h},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function goe(t,e){if(t){if(typeof t=="string")return rM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rM(t,e)}}function rM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function moe(t){var e=_oe();return function(){var r=Pp(t),n;if(e){var i=Pp(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return bw(this,n)}}function _oe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var yoe=["longitude","latitude","zoom","bearing","pitch"],Ag=(function(t){yw(r,t);var e=moe(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hh(this,r),n=e.call(this),Array.isArray(i)&&(i={transitionProps:i}),n.propNames=i.transitionProps||yoe,i.around&&(n.around=i.around),n}return uh(r,[{key:"initializeProps",value:function(n,i){var o={},s={};if(this.around){o.around=this.around;var l=new hc(n).unproject(this.around);Object.assign(s,i,{around:new hc(i).project(l),aroundLngLat:l})}var h=tM(this.propNames),A;try{for(h.s();!(A=h.n()).done;){var b=A.value,C=n[b],S=i[b];Al(G_(C)&&G_(S),"".concat(b," must be supplied for transition")),o[b]=C,s[b]=dx(b,C,S)}}catch(D){h.e(D)}finally{h.f()}return{start:o,end:s}}},{key:"interpolateProps",value:function(n,i,o){var s={},l=tM(this.propNames),h;try{for(l.s();!(h=l.n()).done;){var A=h.value;s[A]=U_(n[A],i[A],o)}}catch(N){l.e(N)}finally{l.f()}if(i.around){var b=new hc(Object.assign({},i,s)).getMapCenterByLngLatPosition({lngLat:i.aroundLngLat,pos:U_(n.around,i.around,o)}),C=As(b,2),S=C[0],D=C[1];s.longitude=S,s.latitude=D}return s}}]),r})(s8),gg=function(){};function boe(t,e){var r=t(e);return function(n){return 1/(1-r)*(t(n*(1-e)+e)-r)}}var mg={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},voe={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new Ag,transitionInterruption:mg.BREAK,onTransitionStart:gg,onTransitionInterrupt:gg,onTransitionEnd:gg},DC=(function(){function t(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hh(this,t),Cr(this,"_animationFrame",null),Cr(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=r.onViewportChange||gg,this.onStateChange=r.onStateChange||gg,this.time=r.getTime||Date.now}return uh(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(e){var r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){var n=Object.assign({},r),i=Object.assign({},e);if(this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this.state.interruption===mg.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===mg.UPDATE)){var o=this.time(),s=(o-this.state.startTime)/this.state.duration;i.transitionDuration=this.state.duration-(o-this.state.startTime),i.transitionEasing=boe(this.state.easing,s),i.transitionInterpolator=n.transitionInterpolator}return i.onTransitionStart(),this._triggerTransition(n,i),!0}return this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(e){var r=e.transitionDuration,n=e.transitionInterpolator;return(r>0||r==="auto")&&!!n}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(e,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(e,r){return e?this._isTransitionInProgress()?this.state.interruption===mg.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0:!0}},{key:"_triggerTransition",value:function(e,r){Al(this._isTransitionEnabled(r)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=r.transitionInterpolator,i=n.getDuration?n.getDuration(e,r):r.transitionDuration;if(i!==0){var o=r.transitionInterpolator.initializeProps(e,r),s={inTransition:!0,isZooming:e.zoom!==r.zoom,isPanning:e.longitude!==r.longitude||e.latitude!==r.latitude,isRotating:e.bearing!==r.bearing||e.pitch!==r.pitch};this.state={duration:i,easing:r.transitionEasing,interpolator:r.transitionInterpolator,interruption:r.transitionInterruption,startTime:this.time(),startProps:o.start,endProps:o.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(s)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var e=this.time(),r=this.state,n=r.startTime,i=r.duration,o=r.easing,s=r.interpolator,l=r.startProps,h=r.endProps,A=!1,b=(e-n)/i;b>=1&&(b=1,A=!0),b=o(b);var C=s.interpolateProps(l,h,b),S=new Ep(Object.assign({},this.props,C));this.state.propsInTransition=S.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),A&&(this._endTransition(),this.props.onTransitionEnd())}}]),t})();Cr(DC,"defaultProps",voe);var nM={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */var iM;function xoe(){return iM||(iM=1,(function(t){(function(e,r,n,i){var o=["","webkit","Moz","MS","ms","o"],s=r.createElement("div"),l="function",h=Math.round,A=Math.abs,b=Date.now;function C(Ae,Me,We){return setTimeout(Q(Ae,We),Me)}function S(Ae,Me,We){return Array.isArray(Ae)?(D(Ae,We[Me],We),!0):!1}function D(Ae,Me,We){var vt;if(Ae)if(Ae.forEach)Ae.forEach(Me,We);else if(Ae.length!==i)for(vt=0;vt<Ae.length;)Me.call(We,Ae[vt],vt,Ae),vt++;else for(vt in Ae)Ae.hasOwnProperty(vt)&&Me.call(We,Ae[vt],vt,Ae)}function N(Ae,Me,We){var vt="DEPRECATED METHOD: "+Me+`
`+We+` AT 
`;return function(){var Vt=new Error("get-stack-trace"),jr=Vt&&Vt.stack?Vt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ir=e.console&&(e.console.warn||e.console.log);return Ir&&Ir.call(e.console,vt,jr),Ae.apply(this,arguments)}}var U;typeof Object.assign!="function"?U=function(Ae){if(Ae===i||Ae===null)throw new TypeError("Cannot convert undefined or null to object");for(var Me=Object(Ae),We=1;We<arguments.length;We++){var vt=arguments[We];if(vt!==i&&vt!==null)for(var Vt in vt)vt.hasOwnProperty(Vt)&&(Me[Vt]=vt[Vt])}return Me}:U=Object.assign;var V=N(function(Ae,Me,We){for(var vt=Object.keys(Me),Vt=0;Vt<vt.length;)(!We||We&&Ae[vt[Vt]]===i)&&(Ae[vt[Vt]]=Me[vt[Vt]]),Vt++;return Ae},"extend","Use `assign`."),j=N(function(Ae,Me){return V(Ae,Me,!0)},"merge","Use `assign`.");function ee(Ae,Me,We){var vt=Me.prototype,Vt;Vt=Ae.prototype=Object.create(vt),Vt.constructor=Ae,Vt._super=vt,We&&U(Vt,We)}function Q(Ae,Me){return function(){return Ae.apply(Me,arguments)}}function X(Ae,Me){return typeof Ae==l?Ae.apply(Me&&Me[0]||i,Me):Ae}function pe(Ae,Me){return Ae===i?Me:Ae}function Y(Ae,Me,We){D(ce(Me),function(vt){Ae.addEventListener(vt,We,!1)})}function Ge(Ae,Me,We){D(ce(Me),function(vt){Ae.removeEventListener(vt,We,!1)})}function ze(Ae,Me){for(;Ae;){if(Ae==Me)return!0;Ae=Ae.parentNode}return!1}function de(Ae,Me){return Ae.indexOf(Me)>-1}function ce(Ae){return Ae.trim().split(/\s+/g)}function De(Ae,Me,We){if(Ae.indexOf&&!We)return Ae.indexOf(Me);for(var vt=0;vt<Ae.length;){if(We&&Ae[vt][We]==Me||!We&&Ae[vt]===Me)return vt;vt++}return-1}function J(Ae){return Array.prototype.slice.call(Ae,0)}function ue(Ae,Me,We){for(var vt=[],Vt=[],jr=0;jr<Ae.length;){var Ir=Ae[jr][Me];De(Vt,Ir)<0&&vt.push(Ae[jr]),Vt[jr]=Ir,jr++}return vt=vt.sort(function(Dn,Ts){return Dn[Me]>Ts[Me]}),vt}function Ee(Ae,Me){for(var We,vt,Vt=Me[0].toUpperCase()+Me.slice(1),jr=0;jr<o.length;){if(We=o[jr],vt=We?We+Vt:Me,vt in Ae)return vt;jr++}return i}var ct=1;function Ce(){return ct++}function Le(Ae){var Me=Ae.ownerDocument||Ae;return Me.defaultView||Me.parentWindow||e}var Ne=/mobile|tablet|ip(ad|hone|od)|android/i,$e="ontouchstart"in e,it=Ee(e,"PointerEvent")!==i,ot=$e&&Ne.test(navigator.userAgent),dt="touch",Mt="pen",St="mouse",st="kinect",Ar=25,Qt=1,Zt=2,Ht=4,dr=8,ln=1,Lr=2,vr=4,Hn=8,_r=16,yr=Lr|vr,un=Hn|_r,Rr=yr|un,ci=["x","y"],qn=["clientX","clientY"];function mn(Ae,Me){var We=this;this.manager=Ae,this.callback=Me,this.element=Ae.element,this.target=Ae.options.inputTarget,this.domHandler=function(vt){X(Ae.options.enable,[Ae])&&We.handler(vt)},this.init()}mn.prototype={handler:function(){},init:function(){this.evEl&&Y(this.element,this.evEl,this.domHandler),this.evTarget&&Y(this.target,this.evTarget,this.domHandler),this.evWin&&Y(Le(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ge(this.element,this.evEl,this.domHandler),this.evTarget&&Ge(this.target,this.evTarget,this.domHandler),this.evWin&&Ge(Le(this.element),this.evWin,this.domHandler)}};function ri(Ae){var Me,We=Ae.options.inputClass;return We?Me=We:it?Me=xe:ot?Me=fe:$e?Me=g:Me=Gt,new Me(Ae,Vn)}function Vn(Ae,Me,We){var vt=We.pointers.length,Vt=We.changedPointers.length,jr=Me&Qt&&vt-Vt===0,Ir=Me&(Ht|dr)&&vt-Vt===0;We.isFirst=!!jr,We.isFinal=!!Ir,jr&&(Ae.session={}),We.eventType=Me,Tn(Ae,We),Ae.emit("hammer.input",We),Ae.recognize(We),Ae.session.prevInput=We}function Tn(Ae,Me){var We=Ae.session,vt=Me.pointers,Vt=vt.length;We.firstInput||(We.firstInput=gr(Me)),Vt>1&&!We.firstMultiple?We.firstMultiple=gr(Me):Vt===1&&(We.firstMultiple=!1);var jr=We.firstInput,Ir=We.firstMultiple,Dn=Ir?Ir.center:jr.center,Ts=Me.center=Mr(vt);Me.timeStamp=b(),Me.deltaTime=Me.timeStamp-jr.timeStamp,Me.angle=kt(Dn,Ts),Me.distance=Se(Dn,Ts),Yn(We,Me),Me.offsetDirection=_i(Me.deltaX,Me.deltaY);var cs=nn(Me.deltaTime,Me.deltaX,Me.deltaY);Me.overallVelocityX=cs.x,Me.overallVelocityY=cs.y,Me.overallVelocity=A(cs.x)>A(cs.y)?cs.x:cs.y,Me.scale=Ir?cr(Ir.pointers,vt):1,Me.rotation=Ir?Jt(Ir.pointers,vt):0,Me.maxPointers=We.prevInput?Me.pointers.length>We.prevInput.maxPointers?Me.pointers.length:We.prevInput.maxPointers:Me.pointers.length,zt(We,Me);var to=Ae.element;ze(Me.srcEvent.target,to)&&(to=Me.srcEvent.target),Me.target=to}function Yn(Ae,Me){var We=Me.center,vt=Ae.offsetDelta||{},Vt=Ae.prevDelta||{},jr=Ae.prevInput||{};(Me.eventType===Qt||jr.eventType===Ht)&&(Vt=Ae.prevDelta={x:jr.deltaX||0,y:jr.deltaY||0},vt=Ae.offsetDelta={x:We.x,y:We.y}),Me.deltaX=Vt.x+(We.x-vt.x),Me.deltaY=Vt.y+(We.y-vt.y)}function zt(Ae,Me){var We=Ae.lastInterval||Me,vt=Me.timeStamp-We.timeStamp,Vt,jr,Ir,Dn;if(Me.eventType!=dr&&(vt>Ar||We.velocity===i)){var Ts=Me.deltaX-We.deltaX,cs=Me.deltaY-We.deltaY,to=nn(vt,Ts,cs);jr=to.x,Ir=to.y,Vt=A(to.x)>A(to.y)?to.x:to.y,Dn=_i(Ts,cs),Ae.lastInterval=Me}else Vt=We.velocity,jr=We.velocityX,Ir=We.velocityY,Dn=We.direction;Me.velocity=Vt,Me.velocityX=jr,Me.velocityY=Ir,Me.direction=Dn}function gr(Ae){for(var Me=[],We=0;We<Ae.pointers.length;)Me[We]={clientX:h(Ae.pointers[We].clientX),clientY:h(Ae.pointers[We].clientY)},We++;return{timeStamp:b(),pointers:Me,center:Mr(Me),deltaX:Ae.deltaX,deltaY:Ae.deltaY}}function Mr(Ae){var Me=Ae.length;if(Me===1)return{x:h(Ae[0].clientX),y:h(Ae[0].clientY)};for(var We=0,vt=0,Vt=0;Vt<Me;)We+=Ae[Vt].clientX,vt+=Ae[Vt].clientY,Vt++;return{x:h(We/Me),y:h(vt/Me)}}function nn(Ae,Me,We){return{x:Me/Ae||0,y:We/Ae||0}}function _i(Ae,Me){return Ae===Me?ln:A(Ae)>=A(Me)?Ae<0?Lr:vr:Me<0?Hn:_r}function Se(Ae,Me,We){We||(We=ci);var vt=Me[We[0]]-Ae[We[0]],Vt=Me[We[1]]-Ae[We[1]];return Math.sqrt(vt*vt+Vt*Vt)}function kt(Ae,Me,We){We||(We=ci);var vt=Me[We[0]]-Ae[We[0]],Vt=Me[We[1]]-Ae[We[1]];return Math.atan2(Vt,vt)*180/Math.PI}function Jt(Ae,Me){return kt(Me[1],Me[0],qn)+kt(Ae[1],Ae[0],qn)}function cr(Ae,Me){return Se(Me[0],Me[1],qn)/Se(Ae[0],Ae[1],qn)}var qe={mousedown:Qt,mousemove:Zt,mouseup:Ht},Lt="mousedown",ge="mousemove mouseup";function Gt(){this.evEl=Lt,this.evWin=ge,this.pressed=!1,mn.apply(this,arguments)}ee(Gt,mn,{handler:function(Ae){var Me=qe[Ae.type];Me&Qt&&Ae.button===0&&(this.pressed=!0),Me&Zt&&Ae.which!==1&&(Me=Ht),this.pressed&&(Me&Ht&&(this.pressed=!1),this.callback(this.manager,Me,{pointers:[Ae],changedPointers:[Ae],pointerType:St,srcEvent:Ae}))}});var wt={pointerdown:Qt,pointermove:Zt,pointerup:Ht,pointercancel:dr,pointerout:dr},H={2:dt,3:Mt,4:St,5:st},yt="pointerdown",Bt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(yt="MSPointerDown",Bt="MSPointerMove MSPointerUp MSPointerCancel");function xe(){this.evEl=yt,this.evWin=Bt,mn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ee(xe,mn,{handler:function(Ae){var Me=this.store,We=!1,vt=Ae.type.toLowerCase().replace("ms",""),Vt=wt[vt],jr=H[Ae.pointerType]||Ae.pointerType,Ir=jr==dt,Dn=De(Me,Ae.pointerId,"pointerId");Vt&Qt&&(Ae.button===0||Ir)?Dn<0&&(Me.push(Ae),Dn=Me.length-1):Vt&(Ht|dr)&&(We=!0),!(Dn<0)&&(Me[Dn]=Ae,this.callback(this.manager,Vt,{pointers:Me,changedPointers:[Ae],pointerType:jr,srcEvent:Ae}),We&&Me.splice(Dn,1))}});var Ke={touchstart:Qt,touchmove:Zt,touchend:Ht,touchcancel:dr},lt="touchstart",Z="touchstart touchmove touchend touchcancel";function ne(){this.evTarget=lt,this.evWin=Z,this.started=!1,mn.apply(this,arguments)}ee(ne,mn,{handler:function(Ae){var Me=Ke[Ae.type];if(Me===Qt&&(this.started=!0),!!this.started){var We=ae.call(this,Ae,Me);Me&(Ht|dr)&&We[0].length-We[1].length===0&&(this.started=!1),this.callback(this.manager,Me,{pointers:We[0],changedPointers:We[1],pointerType:dt,srcEvent:Ae})}}});function ae(Ae,Me){var We=J(Ae.touches),vt=J(Ae.changedTouches);return Me&(Ht|dr)&&(We=ue(We.concat(vt),"identifier")),[We,vt]}var ye={touchstart:Qt,touchmove:Zt,touchend:Ht,touchcancel:dr},Oe="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=Oe,this.targetIds={},mn.apply(this,arguments)}ee(fe,mn,{handler:function(Ae){var Me=ye[Ae.type],We=be.call(this,Ae,Me);We&&this.callback(this.manager,Me,{pointers:We[0],changedPointers:We[1],pointerType:dt,srcEvent:Ae})}});function be(Ae,Me){var We=J(Ae.touches),vt=this.targetIds;if(Me&(Qt|Zt)&&We.length===1)return vt[We[0].identifier]=!0,[We,We];var Vt,jr,Ir=J(Ae.changedTouches),Dn=[],Ts=this.target;if(jr=We.filter(function(cs){return ze(cs.target,Ts)}),Me===Qt)for(Vt=0;Vt<jr.length;)vt[jr[Vt].identifier]=!0,Vt++;for(Vt=0;Vt<Ir.length;)vt[Ir[Vt].identifier]&&Dn.push(Ir[Vt]),Me&(Ht|dr)&&delete vt[Ir[Vt].identifier],Vt++;if(Dn.length)return[ue(jr.concat(Dn),"identifier"),Dn]}var oe=2500,we=25;function g(){mn.apply(this,arguments);var Ae=Q(this.handler,this);this.touch=new fe(this.manager,Ae),this.mouse=new Gt(this.manager,Ae),this.primaryTouch=null,this.lastTouches=[]}ee(g,mn,{handler:function(Ae,Me,We){var vt=We.pointerType==dt,Vt=We.pointerType==St;if(!(Vt&&We.sourceCapabilities&&We.sourceCapabilities.firesTouchEvents)){if(vt)le.call(this,Me,We);else if(Vt&&Qe.call(this,We))return;this.callback(Ae,Me,We)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function le(Ae,Me){Ae&Qt?(this.primaryTouch=Me.changedPointers[0].identifier,Ct.call(this,Me)):Ae&(Ht|dr)&&Ct.call(this,Me)}function Ct(Ae){var Me=Ae.changedPointers[0];if(Me.identifier===this.primaryTouch){var We={x:Me.clientX,y:Me.clientY};this.lastTouches.push(We);var vt=this.lastTouches,Vt=function(){var jr=vt.indexOf(We);jr>-1&&vt.splice(jr,1)};setTimeout(Vt,oe)}}function Qe(Ae){for(var Me=Ae.srcEvent.clientX,We=Ae.srcEvent.clientY,vt=0;vt<this.lastTouches.length;vt++){var Vt=this.lastTouches[vt],jr=Math.abs(Me-Vt.x),Ir=Math.abs(We-Vt.y);if(jr<=we&&Ir<=we)return!0}return!1}var Et=Ee(s.style,"touchAction"),Pt=Et!==i,Dt="compute",ht="auto",Ft="manipulation",It="none",jt="pan-x",Nr="pan-y",er=Jr();function en(Ae,Me){this.manager=Ae,this.set(Me)}en.prototype={set:function(Ae){Ae==Dt&&(Ae=this.compute()),Pt&&this.manager.element.style&&er[Ae]&&(this.manager.element.style[Et]=Ae),this.actions=Ae.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ae=[];return D(this.manager.recognizers,function(Me){X(Me.options.enable,[Me])&&(Ae=Ae.concat(Me.getTouchAction()))}),cn(Ae.join(" "))},preventDefaults:function(Ae){var Me=Ae.srcEvent,We=Ae.offsetDirection;if(this.manager.session.prevented){Me.preventDefault();return}var vt=this.actions,Vt=de(vt,It)&&!er[It],jr=de(vt,Nr)&&!er[Nr],Ir=de(vt,jt)&&!er[jt];if(Vt){var Dn=Ae.pointers.length===1,Ts=Ae.distance<2,cs=Ae.deltaTime<250;if(Dn&&Ts&&cs)return}if(!(Ir&&jr)&&(Vt||jr&&We&yr||Ir&&We&un))return this.preventSrc(Me)},preventSrc:function(Ae){this.manager.session.prevented=!0,Ae.preventDefault()}};function cn(Ae){if(de(Ae,It))return It;var Me=de(Ae,jt),We=de(Ae,Nr);return Me&&We?It:Me||We?Me?jt:Nr:de(Ae,Ft)?Ft:ht}function Jr(){if(!Pt)return!1;var Ae={},Me=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(We){Ae[We]=Me?e.CSS.supports("touch-action",We):!0}),Ae}var Kr=1,zr=2,yi=4,Xr=8,mr=Xr,Be=16,Xt=32;function tn(Ae){this.options=U({},this.defaults,Ae||{}),this.id=Ce(),this.manager=null,this.options.enable=pe(this.options.enable,!0),this.state=Kr,this.simultaneous={},this.requireFail=[]}tn.prototype={defaults:{},set:function(Ae){return U(this.options,Ae),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ae){if(S(Ae,"recognizeWith",this))return this;var Me=this.simultaneous;return Ae=ui(Ae,this),Me[Ae.id]||(Me[Ae.id]=Ae,Ae.recognizeWith(this)),this},dropRecognizeWith:function(Ae){return S(Ae,"dropRecognizeWith",this)?this:(Ae=ui(Ae,this),delete this.simultaneous[Ae.id],this)},requireFailure:function(Ae){if(S(Ae,"requireFailure",this))return this;var Me=this.requireFail;return Ae=ui(Ae,this),De(Me,Ae)===-1&&(Me.push(Ae),Ae.requireFailure(this)),this},dropRequireFailure:function(Ae){if(S(Ae,"dropRequireFailure",this))return this;Ae=ui(Ae,this);var Me=De(this.requireFail,Ae);return Me>-1&&this.requireFail.splice(Me,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ae){return!!this.simultaneous[Ae.id]},emit:function(Ae){var Me=this,We=this.state;function vt(Vt){Me.manager.emit(Vt,Ae)}We<Xr&&vt(Me.options.event+Vi(We)),vt(Me.options.event),Ae.additionalEvent&&vt(Ae.additionalEvent),We>=Xr&&vt(Me.options.event+Vi(We))},tryEmit:function(Ae){if(this.canEmit())return this.emit(Ae);this.state=Xt},canEmit:function(){for(var Ae=0;Ae<this.requireFail.length;){if(!(this.requireFail[Ae].state&(Xt|Kr)))return!1;Ae++}return!0},recognize:function(Ae){var Me=U({},Ae);if(!X(this.options.enable,[this,Me])){this.reset(),this.state=Xt;return}this.state&(mr|Be|Xt)&&(this.state=Kr),this.state=this.process(Me),this.state&(zr|yi|Xr|Be)&&this.tryEmit(Me)},process:function(Ae){},getTouchAction:function(){},reset:function(){}};function Vi(Ae){return Ae&Be?"cancel":Ae&Xr?"end":Ae&yi?"move":Ae&zr?"start":""}function ya(Ae){return Ae==_r?"down":Ae==Hn?"up":Ae==Lr?"left":Ae==vr?"right":""}function ui(Ae,Me){var We=Me.manager;return We?We.get(Ae):Ae}function Wn(){tn.apply(this,arguments)}ee(Wn,tn,{defaults:{pointers:1},attrTest:function(Ae){var Me=this.options.pointers;return Me===0||Ae.pointers.length===Me},process:function(Ae){var Me=this.state,We=Ae.eventType,vt=Me&(zr|yi),Vt=this.attrTest(Ae);return vt&&(We&dr||!Vt)?Me|Be:vt||Vt?We&Ht?Me|Xr:Me&zr?Me|yi:zr:Xt}});function Te(){Wn.apply(this,arguments),this.pX=null,this.pY=null}ee(Te,Wn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rr},getTouchAction:function(){var Ae=this.options.direction,Me=[];return Ae&yr&&Me.push(Nr),Ae&un&&Me.push(jt),Me},directionTest:function(Ae){var Me=this.options,We=!0,vt=Ae.distance,Vt=Ae.direction,jr=Ae.deltaX,Ir=Ae.deltaY;return Vt&Me.direction||(Me.direction&yr?(Vt=jr===0?ln:jr<0?Lr:vr,We=jr!=this.pX,vt=Math.abs(Ae.deltaX)):(Vt=Ir===0?ln:Ir<0?Hn:_r,We=Ir!=this.pY,vt=Math.abs(Ae.deltaY))),Ae.direction=Vt,We&&vt>Me.threshold&&Vt&Me.direction},attrTest:function(Ae){return Wn.prototype.attrTest.call(this,Ae)&&(this.state&zr||!(this.state&zr)&&this.directionTest(Ae))},emit:function(Ae){this.pX=Ae.deltaX,this.pY=Ae.deltaY;var Me=ya(Ae.direction);Me&&(Ae.additionalEvent=this.options.event+Me),this._super.emit.call(this,Ae)}});function Wo(){Wn.apply(this,arguments)}ee(Wo,Wn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[It]},attrTest:function(Ae){return this._super.attrTest.call(this,Ae)&&(Math.abs(Ae.scale-1)>this.options.threshold||this.state&zr)},emit:function(Ae){if(Ae.scale!==1){var Me=Ae.scale<1?"in":"out";Ae.additionalEvent=this.options.event+Me}this._super.emit.call(this,Ae)}});function Jn(){tn.apply(this,arguments),this._timer=null,this._input=null}ee(Jn,tn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ht]},process:function(Ae){var Me=this.options,We=Ae.pointers.length===Me.pointers,vt=Ae.distance<Me.threshold,Vt=Ae.deltaTime>Me.time;if(this._input=Ae,!vt||!We||Ae.eventType&(Ht|dr)&&!Vt)this.reset();else if(Ae.eventType&Qt)this.reset(),this._timer=C(function(){this.state=mr,this.tryEmit()},Me.time,this);else if(Ae.eventType&Ht)return mr;return Xt},reset:function(){clearTimeout(this._timer)},emit:function(Ae){this.state===mr&&(Ae&&Ae.eventType&Ht?this.manager.emit(this.options.event+"up",Ae):(this._input.timeStamp=b(),this.manager.emit(this.options.event,this._input)))}});function Jo(){Wn.apply(this,arguments)}ee(Jo,Wn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[It]},attrTest:function(Ae){return this._super.attrTest.call(this,Ae)&&(Math.abs(Ae.rotation)>this.options.threshold||this.state&zr)}});function Fi(){Wn.apply(this,arguments)}ee(Fi,Wn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:yr|un,pointers:1},getTouchAction:function(){return Te.prototype.getTouchAction.call(this)},attrTest:function(Ae){var Me=this.options.direction,We;return Me&(yr|un)?We=Ae.overallVelocity:Me&yr?We=Ae.overallVelocityX:Me&un&&(We=Ae.overallVelocityY),this._super.attrTest.call(this,Ae)&&Me&Ae.offsetDirection&&Ae.distance>this.options.threshold&&Ae.maxPointers==this.options.pointers&&A(We)>this.options.velocity&&Ae.eventType&Ht},emit:function(Ae){var Me=ya(Ae.offsetDirection);Me&&this.manager.emit(this.options.event+Me,Ae),this.manager.emit(this.options.event,Ae)}});function hi(){tn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ee(hi,tn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ft]},process:function(Ae){var Me=this.options,We=Ae.pointers.length===Me.pointers,vt=Ae.distance<Me.threshold,Vt=Ae.deltaTime<Me.time;if(this.reset(),Ae.eventType&Qt&&this.count===0)return this.failTimeout();if(vt&&Vt&&We){if(Ae.eventType!=Ht)return this.failTimeout();var jr=this.pTime?Ae.timeStamp-this.pTime<Me.interval:!0,Ir=!this.pCenter||Se(this.pCenter,Ae.center)<Me.posThreshold;this.pTime=Ae.timeStamp,this.pCenter=Ae.center,!Ir||!jr?this.count=1:this.count+=1,this._input=Ae;var Dn=this.count%Me.taps;if(Dn===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=mr,this.tryEmit()},Me.interval,this),zr):mr}return Xt},failTimeout:function(){return this._timer=C(function(){this.state=Xt},this.options.interval,this),Xt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==mr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Mi(Ae,Me){return Me=Me||{},Me.recognizers=pe(Me.recognizers,Mi.defaults.preset),new Wi(Ae,Me)}Mi.VERSION="2.0.7",Mi.defaults={domEvents:!1,touchAction:Dt,enable:!0,inputTarget:null,inputClass:null,preset:[[Jo,{enable:!1}],[Wo,{enable:!1},["rotate"]],[Fi,{direction:yr}],[Te,{direction:yr},["swipe"]],[hi],[hi,{event:"doubletap",taps:2},["tap"]],[Jn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ln=1,gs=2;function Wi(Ae,Me){this.options=U({},Mi.defaults,Me||{}),this.options.inputTarget=this.options.inputTarget||Ae,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ae,this.input=ri(this),this.touchAction=new en(this,this.options.touchAction),Gs(this,!0),D(this.options.recognizers,function(We){var vt=this.add(new We[0](We[1]));We[2]&&vt.recognizeWith(We[2]),We[3]&&vt.requireFailure(We[3])},this)}Wi.prototype={set:function(Ae){return U(this.options,Ae),Ae.touchAction&&this.touchAction.update(),Ae.inputTarget&&(this.input.destroy(),this.input.target=Ae.inputTarget,this.input.init()),this},stop:function(Ae){this.session.stopped=Ae?gs:Ln},recognize:function(Ae){var Me=this.session;if(!Me.stopped){this.touchAction.preventDefaults(Ae);var We,vt=this.recognizers,Vt=Me.curRecognizer;(!Vt||Vt&&Vt.state&mr)&&(Vt=Me.curRecognizer=null);for(var jr=0;jr<vt.length;)We=vt[jr],Me.stopped!==gs&&(!Vt||We==Vt||We.canRecognizeWith(Vt))?We.recognize(Ae):We.reset(),!Vt&&We.state&(zr|yi|Xr)&&(Vt=Me.curRecognizer=We),jr++}},get:function(Ae){if(Ae instanceof tn)return Ae;for(var Me=this.recognizers,We=0;We<Me.length;We++)if(Me[We].options.event==Ae)return Me[We];return null},add:function(Ae){if(S(Ae,"add",this))return this;var Me=this.get(Ae.options.event);return Me&&this.remove(Me),this.recognizers.push(Ae),Ae.manager=this,this.touchAction.update(),Ae},remove:function(Ae){if(S(Ae,"remove",this))return this;if(Ae=this.get(Ae),Ae){var Me=this.recognizers,We=De(Me,Ae);We!==-1&&(Me.splice(We,1),this.touchAction.update())}return this},on:function(Ae,Me){if(Ae!==i&&Me!==i){var We=this.handlers;return D(ce(Ae),function(vt){We[vt]=We[vt]||[],We[vt].push(Me)}),this}},off:function(Ae,Me){if(Ae!==i){var We=this.handlers;return D(ce(Ae),function(vt){Me?We[vt]&&We[vt].splice(De(We[vt],Me),1):delete We[vt]}),this}},emit:function(Ae,Me){this.options.domEvents&&Sn(Ae,Me);var We=this.handlers[Ae]&&this.handlers[Ae].slice();if(!(!We||!We.length)){Me.type=Ae,Me.preventDefault=function(){Me.srcEvent.preventDefault()};for(var vt=0;vt<We.length;)We[vt](Me),vt++}},destroy:function(){this.element&&Gs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Gs(Ae,Me){var We=Ae.element;if(We.style){var vt;D(Ae.options.cssProps,function(Vt,jr){vt=Ee(We.style,jr),Me?(Ae.oldCssProps[vt]=We.style[vt],We.style[vt]=Vt):We.style[vt]=Ae.oldCssProps[vt]||""}),Me||(Ae.oldCssProps={})}}function Sn(Ae,Me){var We=r.createEvent("Event");We.initEvent(Ae,!0,!0),We.gesture=Me,Me.target.dispatchEvent(We)}U(Mi,{INPUT_START:Qt,INPUT_MOVE:Zt,INPUT_END:Ht,INPUT_CANCEL:dr,STATE_POSSIBLE:Kr,STATE_BEGAN:zr,STATE_CHANGED:yi,STATE_ENDED:Xr,STATE_RECOGNIZED:mr,STATE_CANCELLED:Be,STATE_FAILED:Xt,DIRECTION_NONE:ln,DIRECTION_LEFT:Lr,DIRECTION_RIGHT:vr,DIRECTION_UP:Hn,DIRECTION_DOWN:_r,DIRECTION_HORIZONTAL:yr,DIRECTION_VERTICAL:un,DIRECTION_ALL:Rr,Manager:Wi,Input:mn,TouchAction:en,TouchInput:fe,MouseInput:Gt,PointerEventInput:xe,TouchMouseInput:g,SingleTouchInput:ne,Recognizer:tn,AttrRecognizer:Wn,Tap:hi,Pan:Te,Swipe:Fi,Pinch:Wo,Rotate:Jo,Press:Jn,on:Y,off:Ge,each:D,merge:j,extend:V,assign:U,inherit:ee,bindFn:Q,prefixed:Ee});var bc=typeof e<"u"?e:typeof self<"u"?self:{};bc.Hammer=Mi,t.exports?t.exports=Mi:e[n]=Mi})(window,document,"Hammer")})(nM)),nM.exports}var Lg=xoe();const woe=bf(Lg),ec=bU({__proto__:null,default:woe},[Lg]),o8=1,a8=2,px=4,Coe={mousedown:o8,mousemove:a8,mouseup:px};function Eoe(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}function Boe(t){const e=t.prototype.handler;t.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(Eoe(n,i=>i.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function Toe(t){t.prototype.handler=function(e){let r=Coe[e.type];r&o8&&e.button>=0&&(this.pressed=!0),r&a8&&e.which===0&&(r=px),this.pressed&&(r&px&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}Boe(Lg.PointerEventInput),Toe(Lg.MouseInput);const Soe=Lg.Manager;class Gy{constructor(e,r,n){this.element=e,this.callback=r,this.options={enable:!0,...n}}}const Ioe=ec?[[ec.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ec.Rotate,{enable:!1}],[ec.Pinch,{enable:!1}],[ec.Swipe,{enable:!1}],[ec.Pan,{threshold:0,enable:!1}],[ec.Press,{enable:!1}],[ec.Tap,{event:"doubletap",taps:2,enable:!1}],[ec.Tap,{event:"anytap",enable:!1}],[ec.Tap,{enable:!1}]]:null,sM={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Moe={doubletap:["tap"]},Poe={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},FC={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Loe={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},oM={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Roe=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",pp=typeof window<"u"?window:global;let Ax=!1;try{const t={get passive(){return Ax=!0,!0}};pp.addEventListener("test",null,t),pp.removeEventListener("test",null)}catch{Ax=!1}const Ooe=Roe.indexOf("firefox")!==-1,{WHEEL_EVENTS:Doe}=FC,aM="wheel",lM=4.000244140625,Foe=40,koe=.25;class Noe extends Gy{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;pp.WheelEvent&&(Ooe&&i.deltaMode===pp.WheelEvent.DOM_DELTA_PIXEL&&(o/=pp.devicePixelRatio),i.deltaMode===pp.WheelEvent.DOM_DELTA_LINE&&(o*=Foe)),o!==0&&o%lM===0&&(o=Math.floor(o/lM)),i.shiftKey&&o&&(o=o*koe),this.callback({type:aM,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(Doe),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Ax?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===aM&&(this.options.enable=r)}}const{MOUSE_EVENTS:Uoe}=FC,cM="pointermove",uM="pointerover",hM="pointerout",fM="pointerenter",dM="pointerleave";class Goe extends Gy{constructor(e,r,n){super(e,r,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(Uoe),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===cM&&(this.enableMoveEvent=r),e===uM&&(this.enableOverEvent=r),e===hM&&(this.enableOutEvent=r),e===fM&&(this.enableEnterEvent=r),e===dM&&(this.enableLeaveEvent=r)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(uM,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(hM,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(fM,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(dM,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(cM,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:zoe}=FC,pM="keydown",AM="keyup";class joe extends Gy{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:pM,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:AM,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(zoe),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===pM&&(this.enableDownEvent=r),e===AM&&(this.enableUpEvent=r)}}const gM="contextmenu";class Hoe extends Gy{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:gM,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e===gM&&(this.options.enable=r)}}const gx=1,z_=2,mx=4,Voe={pointerdown:gx,pointermove:z_,pointerup:mx,mousedown:gx,mousemove:z_,mouseup:mx},Woe=1,Joe=2,Koe=3,Xoe=0,Qoe=1,Zoe=2,$oe=1,qoe=2,Yoe=4;function eae(t){const e=Voe[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n,which:i}=t.srcEvent;let o=!1,s=!1,l=!1;return e===mx||e===z_&&!Number.isFinite(r)?(o=i===Woe,s=i===Joe,l=i===Koe):e===z_?(o=!!(r&$oe),s=!!(r&Yoe),l=!!(r&qoe)):e===gx&&(o=n===Xoe,s=n===Qoe,l=n===Zoe),{leftButton:o,middleButton:s,rightButton:l}}function tae(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/o};return{center:r,offsetCenter:s}}const Hv={srcElement:"root",priority:0};class rae{constructor(e){this.handleEvent=r=>{if(this.isEmpty())return;const n=this._normalizeEvent(r);let i=r.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,o=!1){const{handlers:s,handlersByElement:l}=this;let h=Hv;typeof n=="string"||n&&n.addEventListener?h={...Hv,srcElement:n}:n&&(h={...Hv,...n});let A=l.get(h.srcElement);A||(A=[],l.set(h.srcElement,A));const b={type:e,handler:r,srcElement:h.srcElement,priority:h.priority};i&&(b.once=!0),o&&(b.passive=!0),s.push(b),this._active=this._active||!b.passive;let C=A.length-1;for(;C>=0&&!(A[C].priority>=b.priority);)C--;A.splice(C+1,0,b)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===r){n.splice(o,1);const l=i.get(s.srcElement);l.splice(l.indexOf(s),1),l.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},l=[];for(let h=0;h<n.length;h++){const{type:A,handler:b,once:C}=n[h];if(b({...e,type:A,stopPropagation:o,stopImmediatePropagation:s}),C&&l.push(n[h]),i)break}for(let h=0;h<l.length;h++){const{type:A,handler:b}=l[h];this.remove(A,b)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...eae(e),...tae(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const nae={events:null,recognizers:null,recognizerOptions:{},Manager:Soe,touchAction:"none",tabIndex:0};class iae{constructor(e=null,r){this._onBasicInput=i=>{const{srcEvent:o}=i,s=Poe[o.type];s&&this.manager.emit(s,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...nae,...r},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:r}=this,n=r.Manager;this.manager=new n(e,{touchAction:r.touchAction,recognizers:r.recognizers||Ioe}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(sM).forEach(i=>{const o=this.manager.get(i);o&&sM[i].forEach(s=>{o.recognizeWith(s)})});for(const i in r.recognizerOptions){const o=this.manager.get(i);if(o){const s=r.recognizerOptions[i];delete s.enable,o.set(s)}}this.wheelInput=new Noe(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Goe(e,this._onOtherEvent,{enable:!1}),this.keyInput=new joe(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Hoe(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==r){i.set({enable:r});const o=Moe[e];o&&!this.options.recognizers&&o.forEach(s=>{const l=n.get(s);r?(l.requireFailure(e),i.dropRequireFailure(s)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,r),this.moveInput.enableEventType(e,r),this.keyInput.enableEventType(e,r),this.contextmenuInput.enableEventType(e,r)}_addEventHandler(e,r,n,i,o){if(typeof e!="string"){n=r;for(const b in e)this._addEventHandler(b,e[b],n,i,o);return}const{manager:s,events:l}=this,h=oM[e]||e;let A=l.get(h);A||(A=new rae(this),l.set(h,A),A.recognizerName=Loe[h]||h,s&&s.on(h,A.handleEvent)),A.add(e,r,n,i,o),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const s in e)this._removeEventHandler(s,e[s]);return}const{events:n}=this,i=oM[e]||e,o=n.get(i);if(o&&(o.remove(e,r),o.isEmpty())){const{recognizerName:s}=o;let l=!1;for(const h of n.values())if(h.recognizerName===s&&!h.isEmpty()){l=!0;break}l||this._toggleRecognizer(s,!1)}}}function mM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Mo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?mM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var jh={transitionDuration:0},Wc={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new Ag,transitionInterruption:mg.BREAK},a0=300,l0=function(t){return 1-(1-t)*(1-t)},Dd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},l8=(function(){function t(){var e=this;hh(this,t),Cr(this,"events",[]),Cr(this,"scrollZoom",!0),Cr(this,"dragPan",!0),Cr(this,"dragRotate",!0),Cr(this,"doubleClickZoom",!0),Cr(this,"touchZoom",!0),Cr(this,"touchRotate",!1),Cr(this,"keyboard",!0),Cr(this,"_interactionState",{isDragging:!1}),Cr(this,"_events",{}),Cr(this,"_setInteractionState",function(r){Object.assign(e._interactionState,r),e.onStateChange&&e.onStateChange(e._interactionState)}),Cr(this,"_onTransition",function(r,n){e.onViewportChange(r,e._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new DC({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return uh(t,[{key:"handleEvent",value:function(e){this.mapState=this.getMapState();var r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return r?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"getCenter",value:function(e){var r=e.offsetCenter,n=r.x,i=r.y;return[n,i]}},{key:"isFunctionKeyPressed",value:function(e){var r=e.srcEvent;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}},{key:"blockEvents",value:function(e){var r=this,n=setTimeout(function(){r._eventStartBlocked===n&&(r._eventStartBlocked=null)},e);this._eventStartBlocked=n}},{key:"updateViewport",value:function(e,r,n){var i=this.mapState instanceof Ep?this.mapState.getViewportProps():this.mapState,o=Mo(Mo({},e.getViewportProps()),r),s=Object.keys(o).some(function(l){return i[l]!==o[l]});this._state=e.getState(),this._setInteractionState(n),s&&this.onViewportChange(o,this._interactionState,i)}},{key:"getMapState",value:function(e){return new Ep(Mo(Mo(Mo({},this.mapStateProps),this._state),e))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(e){var r=e.onViewportChange,n=e.onStateChange,i=e.eventManager,o=i===void 0?this.eventManager:i,s=e.isInteractive,l=s===void 0?!0:s,h=e.scrollZoom,A=h===void 0?this.scrollZoom:h,b=e.dragPan,C=b===void 0?this.dragPan:b,S=e.dragRotate,D=S===void 0?this.dragRotate:S,N=e.doubleClickZoom,U=N===void 0?this.doubleClickZoom:N,V=e.touchZoom,j=V===void 0?this.touchZoom:V,ee=e.touchRotate,Q=ee===void 0?this.touchRotate:ee,X=e.keyboard,pe=X===void 0?this.keyboard:X;this.onViewportChange=r,this.onStateChange=n;var Y=this.mapStateProps||{},Ge=Y.height!==e.height||Y.width!==e.width;this.mapStateProps=e,Ge&&(this.mapState=Y,this.updateViewport(new Ep(e))),this._transitionManager.processViewportChange(e),this.eventManager!==o&&(this.eventManager=o,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(Dd.WHEEL,l&&!!A),this.toggleEvents(Dd.PAN,l&&!!(C||D)),this.toggleEvents(Dd.PINCH,l&&!!(j||Q)),this.toggleEvents(Dd.TRIPLE_PAN,l&&!!Q),this.toggleEvents(Dd.DOUBLE_TAP,l&&!!U),this.toggleEvents(Dd.KEYBOARD,l&&!!pe),this.scrollZoom=A,this.dragPan=C,this.dragRotate=D,this.doubleClickZoom=U,this.touchZoom=j,this.touchRotate=Q,this.keyboard=pe}},{key:"toggleEvents",value:function(e,r){var n=this;this.eventManager&&e.forEach(function(i){n._events[i]!==r&&(n._events[i]=r,r?n.eventManager.on(i,n.handleEvent):n.eventManager.off(i,n.handleEvent))})}},{key:"_onPanStart",value:function(e){var r=this.getCenter(e);this._panRotate=this.isFunctionKeyPressed(e)||e.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:r}):this.mapState.panStart({pos:r});return this.updateViewport(n,jh,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isDragging()?this._panRotate?this._onPanRotate(e):this._onPanMove(e):!1}},{key:"_onPanEnd",value:function(e){return this.isDragging()?this._panRotate?this._onPanRotateEnd(e):this._onPanMoveEnd(e):!1}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var r=this.getCenter(e),n=this.mapState.pan({pos:r});return this.updateViewport(n,jh,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){if(this.dragPan){var r=this.dragPan.inertia,n=r===void 0?a0:r;if(n&&e.velocity){var i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.mapState.pan({pos:o}).panEnd();return this.updateViewport(s,Mo(Mo({},Wc),{},{transitionDuration:n,transitionEasing:l0}),{isDragging:!1,isPanning:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var r=this.getCenter(e),n=this.mapState.rotate({pos:r});return this.updateViewport(n,jh,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){if(this.dragRotate){var r=this.dragRotate.inertia,n=r===void 0?a0:r;if(n&&e.velocity){var i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.mapState.rotate({pos:o}).rotateEnd();return this.updateViewport(s,Mo(Mo({},Wc),{},{transitionDuration:n,transitionEasing:l0}),{isDragging:!1,isRotating:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;var r=this.scrollZoom,n=r.speed,i=n===void 0?.01:n,o=r.smooth,s=o===void 0?!1:o;e.preventDefault();var l=this.getCenter(e),h=e.delta,A=2/(1+Math.exp(-Math.abs(h*i)));h<0&&A!==0&&(A=1/A);var b=this.mapState.zoom({pos:l,scale:A});return b.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(b,Mo(Mo({},Wc),{},{transitionInterpolator:new Ag({around:l}),transitionDuration:s?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(e){var r=this.getCenter(e),n=this.mapState.zoomStart({pos:r}).rotateStart({pos:r});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(n,jh,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var r=this.mapState;if(this.touchZoom){var n=e.scale,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){var o=e.rotation;r=r.rotate({deltaAngleX:this._startPinchRotation-o})}return this.updateViewport(r,jh,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;if(this.touchZoom){var r=this.touchZoom.inertia,n=r===void 0?a0:r,i=this._lastPinchEvent;if(n&&i&&e.scale!==i.scale){var o=this.getCenter(e),s=this.mapState.rotateEnd(),l=Math.log2(e.scale),h=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),A=Math.pow(2,l+h*n/2);return s=s.zoom({pos:o,scale:A}).zoomEnd(),this.updateViewport(s,Mo(Mo({},Wc),{},{transitionInterpolator:new Ag({around:o}),transitionDuration:n,transitionEasing:l0}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(n),!0}}var b=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(b,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(e){var r=this.getCenter(e),n=this.mapState.rotateStart({pos:r});return this.updateViewport(n,jh,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.isDragging()||!this.touchRotate)return!1;var r=this.getCenter(e);r[0]-=e.deltaX;var n=this.mapState.rotate({pos:r});return this.updateViewport(n,jh,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;if(this.touchRotate){var r=this.touchRotate.inertia,n=r===void 0?a0:r;if(n&&e.velocityY){var i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*n/2],s=this.mapState.rotate({pos:o});return this.updateViewport(s,Mo(Mo({},Wc),{},{transitionDuration:n,transitionEasing:l0}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var l=this.mapState.rotateEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var r=this.getCenter(e),n=this.isFunctionKeyPressed(e),i=this.mapState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,Object.assign({},Wc,{transitionInterpolator:new Ag({around:r})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var r=this.isFunctionKeyPressed(e),n=this.keyboard,i=n.zoomSpeed,o=i===void 0?2:i,s=n.moveSpeed,l=s===void 0?100:s,h=n.rotateSpeedX,A=h===void 0?15:h,b=n.rotateSpeedY,C=b===void 0?10:b,S=this.mapStateProps,D;switch(e.srcEvent.keyCode){case 189:r?D=this.getMapState({zoom:S.zoom-Math.log2(o)-1}):D=this.getMapState({zoom:S.zoom-Math.log2(o)});break;case 187:r?D=this.getMapState({zoom:S.zoom+Math.log2(o)+1}):D=this.getMapState({zoom:S.zoom+Math.log2(o)});break;case 37:r?D=this.getMapState({bearing:S.bearing-A}):D=this.mapState.pan({pos:[l,0],startPos:[0,0]});break;case 39:r?D=this.getMapState({bearing:S.bearing+A}):D=this.mapState.pan({pos:[-l,0],startPos:[0,0]});break;case 38:r?D=this.getMapState({pitch:S.pitch+C}):D=this.mapState.pan({pos:[0,l],startPos:[0,0]});break;case 40:r?D=this.getMapState({pitch:S.pitch-C}):D=this.mapState.pan({pos:[0,-l],startPos:[0,0]});break;default:return!1}return this.updateViewport(D,Wc)}}]),t})();function _M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Hc(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_M(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_M(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var sae=Object.assign({},eu.propTypes,{maxZoom:At.number,minZoom:At.number,maxPitch:At.number,minPitch:At.number,onViewStateChange:At.func,onViewportChange:At.func,onInteractionStateChange:At.func,transitionDuration:At.oneOfType([At.number,At.string]),transitionInterpolator:At.object,transitionInterruption:At.number,transitionEasing:At.func,onTransitionStart:At.func,onTransitionInterrupt:At.func,onTransitionEnd:At.func,scrollZoom:At.oneOfType([At.bool,At.object]),dragPan:At.oneOfType([At.bool,At.object]),dragRotate:At.oneOfType([At.bool,At.object]),doubleClickZoom:At.bool,touchZoom:At.oneOfType([At.bool,At.object]),touchRotate:At.oneOfType([At.bool,At.object]),keyboard:At.oneOfType([At.bool,At.object]),onHover:At.func,onClick:At.func,onDblClick:At.func,onContextMenu:At.func,onMouseDown:At.func,onMouseMove:At.func,onMouseUp:At.func,onTouchStart:At.func,onTouchMove:At.func,onTouchEnd:At.func,onMouseEnter:At.func,onMouseLeave:At.func,onMouseOut:At.func,onWheel:At.func,touchAction:At.string,eventRecognizerOptions:At.object,clickRadius:At.number,interactiveLayerIds:At.array,getCursor:At.func,controller:At.instanceOf(l8)}),oae=function(t){var e=t.isDragging,r=t.isHovering;return e?"grabbing":r?"pointer":"grab"},aae=Object.assign({},eu.defaultProps,Yh,DC.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(t){return t.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:oae});function kC(t){if(t.lngLat||!t.offsetCenter)return t;var e=t.offsetCenter,r=e.x,n=e.y;if(!Number.isFinite(r)||!Number.isFinite(n))return t;var i=[r,n];return t.point=i,t.lngLat=this.viewport.unproject(i),t}function c8(t){var e=this.map;if(!e||!t)return null;var r={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(r.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(n?[[t[0]-n,t[1]+n],[t[0]+n,t[1]-n]]:t,r)}catch{return null}}function qc(t,e){var r=this.props[t];r&&r(kC.call(this,e))}function lae(t){qc.call(this,t.pointerType==="touch"?"onTouchStart":"onMouseDown",t)}function cae(t){qc.call(this,t.pointerType==="touch"?"onTouchEnd":"onMouseUp",t)}function uae(t){if(qc.call(this,t.pointerType==="touch"?"onTouchMove":"onMouseMove",t),!this.state.isDragging){var e=this.props,r=e.onHover,n=e.interactiveLayerIds,i;t=kC.call(this,t),(n||r)&&(i=c8.call(this,t.point));var o=!!(n&&i&&i.length>0),s=o&&!this.state.isHovering,l=!o&&this.state.isHovering;(r||s)&&(t.features=i,r&&r(t)),s&&qc.call(this,"onMouseEnter",t),l&&qc.call(this,"onMouseLeave",t),(s||l)&&this.setState({isHovering:o})}}function yM(t){var e=this.props,r=e.onClick,n=e.onNativeClick,i=e.onDblClick,o=e.doubleClickZoom,s=[],l=i||o;switch(t.type){case"anyclick":s.push(n),l||s.push(r);break;case"click":l&&s.push(r);break}s=s.filter(Boolean),s.length&&(t=kC.call(this,t),t.features=c8.call(this,t.point),s.forEach(function(h){return h(t)}))}function hae(t){return{getMap:t.current&&t.current.getMap,queryRenderedFeatures:t.current&&t.current.queryRenderedFeatures}}var Vv=Tt.forwardRef(function(t,e){var r=Tt.useContext(Bf),n=Tt.useMemo(function(){return t.controller||new l8},[]),i=Tt.useMemo(function(){return new iae(null,{touchAction:t.touchAction,recognizerOptions:t.eventRecognizerOptions})},[]),o=Tt.useRef(null),s=Tt.useRef(null),l=Tt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),h=l.current;h.props=t,h.map=s.current&&s.current.getMap(),h.setState=function(Y){h.state=Hc(Hc({},h.state),Y),o.current.style.cursor=t.getCursor(h.state)};var A=!0,b,C,S=function(Y,Ge,ze){if(A){b=[Y,Ge,ze];return}var de=h.props,ce=de.onViewStateChange,De=de.onViewportChange;ce&&ce({viewState:Y,interactionState:Ge,oldViewState:ze}),De&&De(Y,Ge,ze)};Tt.useImperativeHandle(e,function(){return hae(s)},[]);var D=Tt.useMemo(function(){return Hc(Hc({},r),{},{eventManager:i,container:r.container||o.current})},[r,o.current]);D.onViewportChange=S,D.viewport=r.viewport||i8(h),h.viewport=D.viewport;var N=function(Y){var Ge=Y.isDragging,ze=Ge===void 0?!1:Ge;if(ze!==h.state.isDragging&&h.setState({isDragging:ze}),A){C=Y;return}var de=h.props.onInteractionStateChange;de&&de(Y)},U=function(){h.width&&h.height&&n.setOptions(Hc(Hc(Hc({},h.props),h.props.viewState),{},{isInteractive:!!(h.props.onViewStateChange||h.props.onViewportChange),onViewportChange:S,onStateChange:N,eventManager:i,width:h.width,height:h.height}))},V=function(Y){var Ge=Y.width,ze=Y.height;h.width=Ge,h.height=ze,U(),h.props.onResize({width:Ge,height:ze})};Tt.useEffect(function(){return i.setElement(o.current),i.on({pointerdown:lae.bind(h),pointermove:uae.bind(h),pointerup:cae.bind(h),pointerleave:qc.bind(h,"onMouseOut"),click:yM.bind(h),anyclick:yM.bind(h),dblclick:qc.bind(h,"onDblClick"),wheel:qc.bind(h,"onWheel"),contextmenu:qc.bind(h,"onContextMenu")}),function(){i.destroy()}},[]),fx(function(){b&&S.apply(void 0,fU(b)),C&&N(C)}),U();var j=t.width,ee=t.height,Q=t.style,X=t.getCursor,pe=Tt.useMemo(function(){return Hc(Hc({position:"relative"},Q),{},{width:j,height:ee,cursor:X(h.state)})},[Q,j,ee,X,h.state]);return(!b||!h._child)&&(h._child=Tt.createElement(OC,{value:D},Tt.createElement("div",{key:"event-canvas",ref:o,style:pe},Tt.createElement(eu,KR({},t,{width:"100%",height:"100%",style:null,onResize:V,ref:s}))))),A=!1,h._child});Vv.supported=eu.supported,Vv.propTypes=sae,Vv.defaultProps=aae,At.string.isRequired;var fae=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];At.oneOf(fae).isRequired;var fh={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},Bl={captureScroll:At.bool,captureDrag:At.bool,captureClick:At.bool,captureDoubleClick:At.bool,capturePointerMove:At.bool};function dae(t){var e=t.containerRef.current,r=t.context.eventManager;if(!(!e||!r)){var n={wheel:function(i){var o=t.props;o.captureScroll&&i.stopPropagation(),o.onScroll&&o.onScroll(i,t)},panstart:function(i){var o=t.props;o.captureDrag&&i.stopPropagation(),o.onDragStart&&o.onDragStart(i,t)},anyclick:function(i){var o=t.props;o.captureClick&&i.stopPropagation(),o.onNativeClick&&o.onNativeClick(i,t)},click:function(i){var o=t.props;o.captureClick&&i.stopPropagation(),o.onClick&&o.onClick(i,t)},dblclick:function(i){var o=t.props;o.captureDoubleClick&&i.stopPropagation(),o.onDoubleClick&&o.onDoubleClick(i,t)},pointermove:function(i){var o=t.props;o.capturePointerMove&&i.stopPropagation(),o.onPointerMove&&o.onPointerMove(i,t)}};return r.watch(n,e),function(){r.off(n)}}}function dh(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Tt.useContext(Bf),r=Tt.useRef(null),n=Tt.useRef({props:t,state:{},context:e,containerRef:r}),i=n.current;return i.props=t,i.context=e,Tt.useEffect(function(){return dae(i)},[e.eventManager]),i}function pae(t){var e=Aae();return function(){var r=Pp(t),n;if(e){var i=Pp(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return bw(this,n)}}function Aae(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function gae(t){var e=t.instance,r=dh(t),n=r.context,i=r.containerRef;return e._context=n,e._containerRef=i,e._render()}var bM=(function(t){yw(r,t);var e=pae(r);function r(){var n;hh(this,r);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=e.call.apply(e,[this].concat(o)),Cr(zu(n),"_context",{}),Cr(zu(n),"_containerRef",Tt.createRef()),Cr(zu(n),"_onScroll",function(l){}),Cr(zu(n),"_onDragStart",function(l){}),Cr(zu(n),"_onDblClick",function(l){}),Cr(zu(n),"_onClick",function(l){}),Cr(zu(n),"_onPointerMove",function(l){}),n}return uh(r,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Tt.createElement(gae,KR({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),r})(Tt.PureComponent);Cr(bM,"propTypes",Bl),Cr(bM,"defaultProps",fh);function vM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function xM(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var mae=Object.assign({},Bl,{draggable:At.bool,onDrag:At.func,onDragEnd:At.func,onDragStart:At.func,offsetLeft:At.number,offsetTop:At.number}),_ae=Object.assign({},fh,{draggable:!1,offsetLeft:0,offsetTop:0});function u8(t){var e=t.offsetCenter,r=e.x,n=e.y;return[r,n]}function yae(t,e){var r=t.center,n=r.x,i=r.y;if(e){var o=e.getBoundingClientRect();return[o.left-n,o.top-i]}return null}function NC(t,e,r,n){var i=t[0]+e[0]-r.offsetLeft,o=t[1]+e[1]-r.offsetTop;return n.viewport.unproject([i,o])}function bae(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context,s=e.containerRef,l=r.draggable;if(l){t.stopPropagation();var h=u8(t),A=yae(t,s.current);if(i.setDragPos(h),i.setDragOffset(A),n.onDragStart&&A){var b=Object.assign({},t);b.lngLat=NC(h,A,r,o),n.onDragStart(b)}}}function vae(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context;t.stopPropagation();var s=u8(t);i.setDragPos(s);var l=i.dragOffset;if(n.onDrag&&l){var h=Object.assign({},t);h.lngLat=NC(s,l,r,o),n.onDrag(h)}}function xae(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context;t.stopPropagation();var s=i.dragPos,l=i.dragOffset;if(i.setDragPos(null),i.setDragOffset(null),n.onDragEnd&&s&&l){var h=Object.assign({},t);h.lngLat=NC(s,l,r,o),n.onDragEnd(h)}}function wae(t,e){var r=e.state;t.stopPropagation(),r.setDragPos(null),r.setDragOffset(null)}function Cae(t){var e=t.context.eventManager;if(!(!e||!t.state.dragPos)){var r={panmove:function(n){return vae(n,t)},panend:function(n){return xae(n,t)},pancancel:function(n){return wae(n,t)}};return e.watch(r),function(){e.off(r)}}}function Eae(t){var e=Tt.useState(null),r=As(e,2),n=r[0],i=r[1],o=Tt.useState(null),s=As(o,2),l=s[0],h=s[1],A=dh(xM(xM({},t),{},{onDragStart:bae}));return A.callbacks=t,A.state.dragPos=n,A.state.setDragPos=i,A.state.dragOffset=l,A.state.setDragOffset=h,Tt.useEffect(function(){return Cae(A)},[A.context.eventManager,!!n]),A}var wM=typeof window<"u"&&window.devicePixelRatio||1,Rg=function(t){return Math.round(t*wM)/wM},CM=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(t===null)return e;var n=r==="x"?t.offsetWidth:t.offsetHeight;return Rg(e/100*n)/n*100};function EM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Bae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?EM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):EM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Tae=Object.assign({},mae,{className:At.string,longitude:At.number.isRequired,latitude:At.number.isRequired,style:At.object}),Sae=Object.assign({},_ae,{className:""});function Iae(t){var e=t.props,r=t.state,n=t.context,i=e.longitude,o=e.latitude,s=e.offsetLeft,l=e.offsetTop,h=r.dragPos,A=r.dragOffset;if(h&&A)return[h[0]+A[0],h[1]+A[1]];var b=n.viewport.project([i,o]),C=As(b,2),S=C[0],D=C[1];return S+=s,D+=l,[S,D]}function Wv(t){var e=Eae(t),r=e.state,n=e.containerRef,i=t.children,o=t.className,s=t.draggable,l=t.style,h=r.dragPos,A=Iae(e),b=As(A,2),C=b[0],S=b[1],D="translate(".concat(Rg(C),"px, ").concat(Rg(S),"px)"),N=s?h?"grabbing":"grab":"auto",U=Tt.useMemo(function(){var j=Bae({position:"absolute",left:0,top:0,transform:D,cursor:N},l);return Tt.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:e.containerRef,style:j},i)},[i,o]),V=n.current;return V&&(V.style.transform=D,V.style.cursor=N),U}Wv.defaultProps=Sae,Wv.propTypes=Tae,Tt.memo(Wv);var Og={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Mae=Object.keys(Og);function Pae(t){var e=t.x,r=t.y,n=t.width,i=t.height,o=t.selfWidth,s=t.selfHeight,l=t.anchor,h=t.padding,A=h===void 0?0:h,b=Og[l],C=b.x,S=b.y,D=r-S*s,N=D+s,U=Math.max(0,A-D)+Math.max(0,N-i+A);if(U>0){var V=S,j=U;for(S=0;S<=1;S+=.5)D=r-S*s,N=D+s,U=Math.max(0,A-D)+Math.max(0,N-i+A),U<j&&(j=U,V=S);S=V}var ee=.5;S===.5&&(C=Math.floor(C),ee=1);var Q=e-C*o,X=Q+o,pe=Math.max(0,A-Q)+Math.max(0,X-n+A);if(pe>0){var Y=C,Ge=pe;for(C=0;C<=1;C+=ee)Q=e-C*o,X=Q+o,pe=Math.max(0,A-Q)+Math.max(0,X-n+A),pe<Ge&&(Ge=pe,Y=C);C=Y}return Mae.find(function(ze){var de=Og[ze];return de.x===C&&de.y===S})||l}var Lae=Object.assign({},Bl,{className:At.string,longitude:At.number.isRequired,latitude:At.number.isRequired,altitude:At.number,offsetLeft:At.number,offsetTop:At.number,tipSize:At.number,closeButton:At.bool,closeOnClick:At.bool,anchor:At.oneOf(Object.keys(Og)),dynamicPosition:At.bool,sortByDepth:At.bool,onClose:At.func}),Rae=Object.assign({},fh,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function Oae(t,e,r,n){var i=As(n,2),o=i[0],s=i[1],l=t.anchor,h=t.dynamicPosition,A=t.tipSize;return r&&h?Pae({x:o,y:s,anchor:l,padding:A,width:e.width,height:e.height,selfWidth:r.clientWidth,selfHeight:r.clientHeight}):l}function Dae(t,e,r,n,i){var o=As(n,3),s=o[0],l=o[1],h=o[2],A=t.offsetLeft,b=t.offsetTop,C=t.sortByDepth,S=Og[i],D=s+A,N=l+b,U=CM(r,-S.x*100),V=CM(r,-S.y*100,"y"),j={position:"absolute",transform:`
      translate(`.concat(U,"%, ").concat(V,`%)
      translate(`).concat(Rg(D),"px, ").concat(Rg(N),`px)
    `),display:void 0,zIndex:void 0};return C&&(h>1||h<-1||s<0||s>e.width||l<0||l>e.height?j.display="none":j.zIndex=Math.floor((1-h)/2*1e5)),j}function Jv(t){var e=Tt.useRef(null),r=dh(t),n=r.context,i=r.containerRef,o=Tt.useState(!1),s=As(o,2),l=s[1];Tt.useEffect(function(){l(!0)},[e.current]),Tt.useEffect(function(){if(n.eventManager&&t.closeOnClick){var X=function(){return r.props.onClose()};return n.eventManager.on("anyclick",X),function(){n.eventManager.off("anyclick",X)}}},[n.eventManager,t.closeOnClick]);var h=n.viewport,A=t.className,b=t.longitude,C=t.latitude,S=t.altitude,D=t.tipSize,N=t.closeButton,U=t.children,V=h.project([b,C,S]),j=Oae(t,h,e.current,V),ee=Dae(t,h,i.current,V,j),Q=Tt.useCallback(function(X){r.props.onClose();var pe=r.context.eventManager;pe&&pe.once("click",function(Y){return Y.stopPropagation()},X.target)},[]);return Tt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(j," ").concat(A),style:ee,ref:i},Tt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:D}}),Tt.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},N&&Tt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:Q},""),U))}Jv.propTypes=Lae,Jv.defaultProps=Rae,Tt.memo(Jv);function BM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Fae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?BM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):BM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var kae=Object.assign({},Bl,{toggleLabel:At.string,className:At.string,style:At.object,compact:At.bool,customAttribution:At.oneOfType([At.string,At.arrayOf(At.string)])}),Nae=Object.assign({},fh,{className:"",toggleLabel:"Toggle Attribution"});function Uae(t,e,r,n){var i=new pc.AttributionControl(t);return i._map=e,i._container=r,i._innerContainer=n,i._updateAttributions(),i._updateEditLink(),e.on("styledata",i._updateData),e.on("sourcedata",i._updateData),i}function Gae(t){t._map.off("styledata",t._updateData),t._map.off("sourcedata",t._updateData)}function Kv(t){var e=dh(t),r=e.context,n=e.containerRef,i=Tt.useRef(null),o=Tt.useState(!1),s=As(o,2),l=s[0],h=s[1];Tt.useEffect(function(){var S;return r.map&&(S=Uae({customAttribution:t.customAttribution},r.map,n.current,i.current)),function(){return S&&Gae(S)}},[r.map]);var A=t.compact===void 0?r.viewport.width<=640:t.compact;Tt.useEffect(function(){!A&&l&&h(!1)},[A]);var b=Tt.useCallback(function(){return h(function(S){return!S})},[]),C=Tt.useMemo(function(){return Fae({position:"absolute"},t.style)},[t.style]);return Tt.createElement("div",{style:C,className:t.className},Tt.createElement("div",{ref:n,"aria-pressed":l,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(A?"mapboxgl-compact":""," ").concat(l?"mapboxgl-compact-show":"")},Tt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:t.toggleLabel,onClick:b}),Tt.createElement("div",{ref:i,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}Kv.propTypes=kae,Kv.defaultProps=Nae,Tt.memo(Kv);function TM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?TM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):TM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var jae=Object.assign({},Bl,{className:At.string,style:At.object,container:At.object,label:At.string}),Hae=Object.assign({},fh,{className:"",container:null,label:"Toggle fullscreen"});function Xv(t){var e=dh(t),r=e.context,n=e.containerRef,i=Tt.useState(!1),o=As(i,2),s=o[0],l=o[1],h=Tt.useState(!1),A=As(h,2),b=A[0],C=A[1],S=Tt.useState(null),D=As(S,2),N=D[0],U=D[1];Tt.useEffect(function(){var pe=new pc.FullscreenControl;U(pe),C(pe._checkFullscreenSupport());var Y=function(){var Ge=!pe._fullscreen;pe._fullscreen=Ge,l(Ge)};return Qc.addEventListener(pe._fullscreenchange,Y),function(){Qc.removeEventListener(pe._fullscreenchange,Y)}},[]);var V=function(){N&&(N._container=t.container||r.container,N._onClickFullscreen())},j=Tt.useMemo(function(){return zae({position:"absolute"},t.style)},[t.style]);if(!b)return null;var ee=t.className,Q=t.label,X=s?"shrink":"fullscreen";return Tt.createElement("div",{style:j,className:ee},Tt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Tt.createElement("button",{key:X,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(X),type:"button",title:Q,onClick:V},Tt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Xv.propTypes=jae,Xv.defaultProps=Hae,Tt.memo(Xv);var Fd;function Vae(){return Fd!==void 0?Promise.resolve(Fd):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(t){return Fd=t.state!=="denied",Fd}):(Fd=!!window.navigator.geolocation,Promise.resolve(Fd))}function SM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Wae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?SM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):SM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var IM=function(){},Jae=Object.assign({},Bl,{className:At.string,style:At.object,label:At.string,disabledLabel:At.string,auto:At.bool,positionOptions:At.object,fitBoundsOptions:At.object,trackUserLocation:At.bool,showUserLocation:At.bool,showAccuracyCircle:At.bool,showUserHeading:At.bool,onViewStateChange:At.func,onViewportChange:At.func,onGeolocate:At.func}),Kae=Object.assign({},fh,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function Xae(t){var e=new pc.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=e.toBounds(r);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function Qae(t,e,r){var n=new pc.GeolocateControl(e);n._container=Qc.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=t.map,n._geolocateButton=r;var i=t.eventManager;return n.options.trackUserLocation&&i&&i.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",r.classList.add("mapboxgl-ctrl-geolocate-background"),r.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",e.onGeolocate),n}function Zae(t,e){var r=e.context,n=e.props,i=Xae(t),o=r.viewport.fitBounds(i,n.fitBoundsOptions),s=o.longitude,l=o.latitude,h=o.zoom,A=Object.assign({},r.viewport,{longitude:s,latitude:l,zoom:h}),b=new Ep(A),C=Object.assign({},b.getViewportProps(),Wc),S=n.onViewportChange||r.onViewportChange||IM,D=n.onViewStateChange||r.onViewStateChange||IM;D({viewState:C}),S(C)}function Qv(t){var e=dh(t),r=e.context,n=e.containerRef,i=Tt.useRef(null),o=Tt.useState(null),s=As(o,2),l=s[0],h=s[1],A=Tt.useState(!1),b=As(A,2),C=b[0],S=b[1];Tt.useEffect(function(){var Q;return r.map&&Vae().then(function(X){S(X),i.current&&(Q=Qae(r,t,i.current),Q._updateCamera=function(pe){return Zae(pe,e)},h(Q))}),function(){Q&&Q._clearWatch()}},[r.map]);var D=Tt.useCallback(function(){l&&(l.options=e.props,l.trigger())},[l]);Tt.useEffect(function(){t.auto&&D()},[l,t.auto]),Tt.useEffect(function(){l&&l._onZoom()},[r.viewport.zoom]);var N=t.className,U=t.label,V=t.disabledLabel,j=t.trackUserLocation,ee=Tt.useMemo(function(){return Wae({position:"absolute"},t.style)},[t.style]);return Tt.createElement("div",{style:ee,className:N},Tt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Tt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:i,disabled:!C,"aria-pressed":!j,type:"button",title:C?U:V,"aria-label":C?U:V,onClick:D},Tt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Qv.propTypes=Jae,Qv.defaultProps=Kae,Tt.memo(Qv);function $ae(t,e){for(var r=(t||"").split(".").map(Number),n=e.split(".").map(Number),i=0;i<3;i++){var o=r[i]||0,s=n[i]||0;if(o<s)return-1;if(o>s)return 1}return 0}function MM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function qae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?MM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var PM=function(){},Yae=Object.assign({},Bl,{className:At.string,style:At.object,onViewStateChange:At.func,onViewportChange:At.func,showCompass:At.bool,showZoom:At.bool,zoomInLabel:At.string,zoomOutLabel:At.string,compassLabel:At.string}),ele=Object.assign({},fh,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),tle=1,_x=2;function rle(t){return $ae(t,"1.6.0")>=0?_x:tle}function Zv(t,e,r){var n=t.viewport,i=new Ep(Object.assign({},n,r)),o=Object.assign({},i.getViewportProps(),Wc),s=e.onViewportChange||t.onViewportChange||PM,l=e.onViewStateChange||t.onViewStateChange||PM;l({viewState:o}),s(o)}function $v(t,e,r,n){return Tt.createElement("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:r},n||Tt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function nle(t){var e=Tt.useMemo(function(){return t.map?rle(t.map.version):_x},[t.map]),r=t.viewport.bearing,n={transform:"rotate(".concat(-r,"deg)")};return e===_x?Tt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Tt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function yx(t){var e=dh(t),r=e.context,n=e.containerRef,i=function(){Zv(r,t,{zoom:r.viewport.zoom+1})},o=function(){Zv(r,t,{zoom:r.viewport.zoom-1})},s=function(){Zv(r,t,{bearing:0,pitch:0})},l=t.className,h=t.showCompass,A=t.showZoom,b=t.zoomInLabel,C=t.zoomOutLabel,S=t.compassLabel,D=Tt.useMemo(function(){return qae({position:"absolute"},t.style)},[t.style]);return Tt.createElement("div",{style:D,className:l},Tt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},A&&$v("zoom-in",b,i),A&&$v("zoom-out",C,o),h&&$v("compass",S,s,nle(r))))}yx.propTypes=Yae,yx.defaultProps=ele;const ile=Tt.memo(yx);function LM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function sle(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?LM(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LM(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var ole=Object.assign({},Bl,{className:At.string,style:At.object,maxWidth:At.number,unit:At.oneOf(["imperial","metric","nautical"])}),ale=Object.assign({},fh,{className:"",maxWidth:100,unit:"metric"});function qv(t){var e=dh(t),r=e.context,n=e.containerRef,i=Tt.useState(null),o=As(i,2),s=o[0],l=o[1];Tt.useEffect(function(){if(r.map){var A=new pc.ScaleControl;A._map=r.map,A._container=n.current,l(A)}},[r.map]),s&&(s.options=t,s._onMove&&s._onMove());var h=Tt.useMemo(function(){return sle({position:"absolute"},t.style)},[t.style]);return Tt.createElement("div",{style:h,className:t.className},Tt.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}qv.propTypes=ole,qv.defaultProps=ale,Tt.memo(qv),Object.assign({},Bl,{redraw:At.func.isRequired}),Object.assign({},Bl,{redraw:At.func.isRequired,style:At.object}),Object.assign({},Bl,{redraw:At.func.isRequired,style:At.object}),pc&&pc.setRTLTextPlugin;const lle=()=>rc.jsx(rc.Fragment,{}),RM=JR("div",{target:"e1az0zs51"})(({height:t})=>({position:"relative",height:t,width:"100%"}),""),cle=JR("div",{target:"e1az0zs50"})(({theme:t})=>({position:"absolute",right:"2.625rem",top:t.spacing.md,zIndex:t.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:t.colors.bgColor},"button:not(:disabled)":{background:t.colors.bgColor,width:t.iconSizes.twoXL,height:t.iconSizes.twoXL,"& + button":{borderTopColor:t.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:t.iconSizes.twoXL,"&:hover":{backgroundColor:t.colors.darkenedBgMix25}},"& span":{filter:WR(t)?"":"invert(100%)"}}}),""),ule=({container:t,element:e,heightFallback:r="auto",isFullScreen:n,shouldUseContainerWidth:i,widthFallback:o="auto"})=>{const s=Tt.useMemo(()=>i||n?"100%":e.width||t.width||o,[t.width,e.width,n,i,o]),l=Tt.useMemo(()=>n&&t.height?t.height:e.height||t.height||r,[n,e.height,t.height,r]);return{width:s,height:l}},OM=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,hle={name:"arc",vs:OM,fs:OM,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},fle=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dle=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,j_=[0,0,0,255],ple={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:j_},getTargetColor:{type:"accessor",value:j_},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Dg extends Es{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:fle,fs:dle,modules:[Fs,_a,hle]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:j_},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:j_},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,wrapLongitude:l,numSegments:h}=this.props,A={numSegments:h,widthUnits:Po[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,useShortestPath:l},b=this.state.model;b.shaderInputs.setProps({arc:A}),b.setVertexCount(h*2),b.draw(this.context.renderPass)}_getModel(){return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}Dg.layerName="ArcLayer",Dg.defaultProps=ple;const Ale=new Uint32Array([0,2,1,0,3,2]),gle=new Float32Array([0,1,0,0,1,0,1,1]);function mle(t,e){if(!e)return _le(t);const r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(r/e)+1,o=Math.ceil(n/e)+1,s=(i-1)*(o-1)*6,l=new Uint32Array(s),h=new Float32Array(i*o*2),A=new Float64Array(i*o*3);let b=0,C=0;for(let S=0;S<i;S++){const D=S/(i-1);for(let N=0;N<o;N++){const U=N/(o-1),V=yle(t,D,U);A[b*3+0]=V[0],A[b*3+1]=V[1],A[b*3+2]=V[2]||0,h[b*2+0]=D,h[b*2+1]=1-U,S>0&&N>0&&(l[C++]=b-o,l[C++]=b-o-1,l[C++]=b-1,l[C++]=b-o,l[C++]=b-1,l[C++]=b),b++}}return{vertexCount:s,positions:A,indices:l,texCoords:h}}function _le(t){const e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:Ale,texCoords:gle}}function yle(t,e,r){return El(El(t[0],t[1],r),El(t[3],t[2],r),e)}const DM=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,ble={name:"bitmap",vs:DM,fs:DM,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},vle=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,xle=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,wle=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${xle}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Cle={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Yr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class H_ extends Es{getShaders(){return super.getShaders({vs:vle,fs:wle,modules:[Fs,_a,ble]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const r=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:n}){const i=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==r.bounds){const o=this.state.mesh,s=this._createMesh();this.state.model.setVertexCount(s.vertexCount);for(const l in s)o&&o[l]!==s[l]&&i.invalidate(l);this.setState({mesh:s,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:r}=this.props,n=e.info;if(!n.color||!r)return n.bitmap=null,n;const{width:i,height:o}=r;n.index=0;const s=Ele(n.color);return n.bitmap={size:{width:i,height:o},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*o)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let r=e;return FM(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),mle(r,this.context.viewport.resolution)}_getModel(){return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:r}=e,{model:n,coordinateConversion:i,bounds:o,disablePicking:s}=this.state,{image:l,desaturate:h,transparentColor:A,tintColor:b}=this.props;if(!(r.picking.isActive&&s)&&l&&n){const C={bitmapTexture:l,bounds:o,coordinateConversion:i,desaturate:h,tintColor:b.slice(0,3).map(S=>S/255),transparentColor:A.map(S=>S/255)};n.shaderInputs.setProps({bitmap:C}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:r,DEFAULT:n}=Yr;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:o}=this.props;if(!FM(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?e:r;if(i=i===e?e:r,i===e&&s===r)return{coordinateConversion:-1,bounds:o};if(i===r&&s===e){const l=ru([o[0],o[1]]),h=ru([o[2],o[3]]);return{coordinateConversion:1,bounds:[l[0],l[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}H_.layerName="BitmapLayer",H_.defaultProps=Cle;function Ele(t){const[e,r,n]=t,i=(n&240)/256,o=(n&15)/16;return[(e+o)/256,(r+i)/256]}function FM(t){return Number.isFinite(t[0])}const kM=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,Ble={name:"icon",vs:kM,fs:kM,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Tle=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Sle=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ile=1024,Mle=4,NM=()=>{},UM={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ple={x:0,y:0,width:0,height:0};function Lle(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Rle(t,e,r,n){const i=Math.min(r/e.width,n/e.height),o=Math.floor(e.width*i),s=Math.floor(e.height*i);return i===1?{image:e,width:o,height:s}:(t.canvas.height=s,t.canvas.width=o,t.clearRect(0,0,o,s),t.drawImage(e,0,0,e.width,e.height,0,0,o,s),{image:t.canvas,width:o,height:s})}function Fg(t){return t&&(t.id||t.url)}function Ole(t,e,r,n){const{width:i,height:o,device:s}=t,l=s.createTexture({format:"rgba8unorm",width:e,height:r,sampler:n,mipmaps:!0}),h=s.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:t,destinationTexture:l,width:i,height:o}),h.finish(),t.destroy(),l}function GM(t,e,r){for(let n=0;n<e.length;n++){const{icon:i,xOffset:o}=e[n],s=Fg(i);t[s]={...i,x:o,y:r}}}function Dle({icons:t,buffer:e,mapping:r={},xOffset:n=0,yOffset:i=0,rowHeight:o=0,canvasWidth:s}){let l=[];for(let h=0;h<t.length;h++){const A=t[h],b=Fg(A);if(!r[b]){const{height:C,width:S}=A;n+S+e>s&&(GM(r,l,i),n=0,i=o+i+e,o=0,l=[]),l.push({icon:A,xOffset:n}),n=n+S+e,o=Math.max(o,C)}}return l.length>0&&GM(r,l,i),{mapping:r,rowHeight:o,xOffset:n,yOffset:i,canvasWidth:s,canvasHeight:Lle(o+i+e)}}function Fle(t,e,r){if(!t||!e)return null;r=r||{};const n={},{iterable:i,objectInfo:o}=yc(t);for(const s of i){o.index++;const l=e(s,o),h=Fg(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!n[h]&&(!r[h]||l.url!==r[h].url)&&(n[h]={...l,source:s,sourceIndex:o.index})}return n}class kle{constructor(e,{onUpdate:r=NM,onError:n=NM}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Mle,this._canvasWidth=Ile,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const r=this._autoPacking?Fg(e):e;return this._mapping[r]||Ple}setProps({loadOptions:e,autoPacking:r,iconAtlas:n,iconMapping:i,textureParameters:o}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(Fle(e,r,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:o,yOffset:s,rowHeight:l,canvasHeight:h}=Dle({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=i,this._xOffset=o,this._yOffset=s,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||UM,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Ole(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||UM)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const r=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,eA(n.url,this._loadOptions).then(i=>{const o=Fg(n),s=this._mapping[o],{x:l,y:h,width:A,height:b}=s,{image:C,width:S,height:D}=Rle(r,i,A,b);this._texture?.copyExternalImage({image:C,x:l+(A-S)/2,y:h+(b-D)/2,width:S,height:D}),s.width=S,s.height=D,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const h8=[0,0,0,255],Nle={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:h8},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class zp extends Es{getShaders(){return super.getShaders({vs:Tle,fs:Sle,modules:[Fs,_a,Ble]})}initializeState(){this.state={iconManager:new kle(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:h8},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:l,data:h,getIcon:A,textureParameters:b}=r,{iconManager:C}=this.state;if(typeof s=="string")return;const S=s||this.internalState.isAsyncPropLoading("iconAtlas");C.setProps({loadOptions:r.loadOptions,autoPacking:!S,iconAtlas:s,iconMapping:S?l:null,textureParameters:b}),S?n.iconMapping!==r.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&C.packIcons(h,A),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:r,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:o,billboard:s,alphaCutoff:l}=this.props,{iconManager:h}=this.state,A=h.getTexture();if(A){const b=this.state.model,C={iconsTexture:A,iconsTextureDim:[A.width,A.height],sizeUnits:Po[o],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:l};b.shaderInputs.setProps({icon:C}),b.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const r=this.getCurrentLayer()?.props.onIconError;r?r(e):$r.error(e.error.message)()}getInstanceOffset(e){const{width:r,height:n,anchorX:i=r/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(e);return[r/2-i,n/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:r,y:n,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[r,n,i,o]}}zp.defaultProps=Nle,zp.layerName="IconLayer";const Ule=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,zM=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Gle={name:"line",source:Ule,vs:zM,fs:zM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},zle=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,jle=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Hle=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vle=[0,0,0,255],Wle={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Vle},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class V_ extends Es{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:jle,fs:Hle,source:zle,modules:[Fs,_a,Gle]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,l=this.state.model,h={widthUnits:Po[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0};l.shaderInputs.setProps({line:h}),l.draw(this.context.renderPass),s&&(l.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}V_.layerName="LineLayer",V_.defaultProps=Wle;const jM=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,Jle={name:"pointCloud",vs:jM,fs:jM,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},Kle=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Xle=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,f8=[0,0,0,255],d8=[0,0,1],Qle={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:d8},getColor:{type:"accessor",value:f8},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Zle(t){const{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:n,value:i}=r.COLOR_0;r.instanceColors={size:n,type:"unorm8",value:i}}}class kg extends Es{getShaders(){return super.getShaders({vs:Kle,fs:Xle,modules:[Fs,By,_a,Jle]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:d8},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:f8}})}updateState(e){const{changeFlags:r,props:n}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&Zle(n.data)}draw({uniforms:e}){const{pointSize:r,sizeUnits:n}=this.props,i=this.state.model,o={sizeUnits:Po[n],radiusPixels:r};i.shaderInputs.setProps({pointCloud:o}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}kg.layerName="PointCloudLayer",kg.defaultProps=Qle;const HM=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,$le={name:"scatterplot",vs:HM,fs:HM,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},qle=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Yle=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ece=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,VM=[0,0,0,255],tce={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:VM},getLineColor:{type:"accessor",value:VM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Ng extends Es{getShaders(){return super.getShaders({vs:qle,fs:Yle,source:ece,modules:[Fs,_a,$le]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:l,billboard:h,antialiasing:A,lineWidthUnits:b,lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:D}=this.props,N={stroked:s,filled:l,billboard:h,antialiasing:A,radiusUnits:Po[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:Po[b],lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:D},U=this.state.model;U.shaderInputs.setProps({scatterplot:N}),U.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Ng.defaultProps=tce,Ng.layerName="ScatterplotLayer";const UC={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function GC(t,e,r={}){return rce(t,r)!==e?(ice(t,r),!0):!1}function rce(t,e={}){return Math.sign(nce(t,e))}const WM={x:0,y:1,z:2};function nce(t,e={}){const{start:r=0,end:n=t.length,plane:i="xy"}=e,o=e.size||2;let s=0;const l=WM[i[0]],h=WM[i[1]];for(let A=r,b=n-o;A<n;A+=o)s+=(t[A+l]-t[b+l])*(t[A+h]+t[b+h]),b=A;return s/2}function ice(t,e){const{start:r=0,end:n=t.length,size:i=2}=e,o=(n-r)/i,s=Math.floor(o/2);for(let l=0;l<s;++l){const h=r+l*i,A=r+(o-1-l)*i;for(let b=0;b<i;++b){const C=t[h+b];t[h+b]=t[A+b],t[A+b]=C}}}function Cl(t,e){const r=e.length,n=t.length;if(n>0){let i=!0;for(let o=0;o<r;o++)if(t[n-r+o]!==e[o]){i=!1;break}if(i)return!1}for(let i=0;i<r;i++)t[n+i]=e[i];return!0}function bx(t,e){const r=e.length;for(let n=0;n<r;n++)t[n]=e[n]}function Ug(t,e,r,n,i=[]){const o=n+e*r;for(let s=0;s<r;s++)i[s]=t[o+s];return i}function vx(t,e,r,n,i=[]){let o,s;if(r&8)o=(n[3]-t[1])/(e[1]-t[1]),s=3;else if(r&4)o=(n[1]-t[1])/(e[1]-t[1]),s=1;else if(r&2)o=(n[2]-t[0])/(e[0]-t[0]),s=2;else if(r&1)o=(n[0]-t[0])/(e[0]-t[0]),s=0;else return null;for(let l=0;l<t.length;l++)i[l]=(s&1)===l?n[s]:o*(e[l]-t[l])+t[l];return i}function K0(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function p8(t,e){const{size:r=2,broken:n=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:l=t.length}=e||{},h=(l-s)/r;let A=[];const b=[A],C=Ug(t,0,r,s);let S,D;const N=g8(C,i,o,[]),U=[];Cl(A,C);for(let V=1;V<h;V++){for(S=Ug(t,V,r,s,S),D=K0(S,N);D;){vx(C,S,D,N,U);const j=K0(U,N);j&&(vx(C,U,j,N,U),D=j),Cl(A,U),bx(C,U),oce(N,i,D),n&&A.length>r&&(A=[],b.push(A),Cl(A,C)),D=K0(S,N)}Cl(A,S),bx(C,S)}return n?b:b[0]}const JM=0,sce=1;function A8(t,e=null,r){if(!t.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:s=!1}=r||{},l=[],h=[{pos:t,types:s?new Array(t.length/n).fill(sce):null,holes:e||[]}],A=[[],[]];let b=[];for(;h.length;){const{pos:C,types:S,holes:D}=h.shift();ace(C,n,D[0]||C.length,A),b=g8(A[0],i,o,b);const N=K0(A[1],b);if(N){let U=KM(C,S,n,0,D[0]||C.length,b,N);const V={pos:U[0].pos,types:U[0].types,holes:[]},j={pos:U[1].pos,types:U[1].types,holes:[]};h.push(V,j);for(let ee=0;ee<D.length;ee++)U=KM(C,S,n,D[ee],D[ee+1]||C.length,b,N),U[0]&&(V.holes.push(V.pos.length),V.pos=c0(V.pos,U[0].pos),s&&(V.types=c0(V.types,U[0].types))),U[1]&&(j.holes.push(j.pos.length),j.pos=c0(j.pos,U[1].pos),s&&(j.types=c0(j.types,U[1].types)))}else{const U={positions:C};s&&(U.edgeTypes=S),D.length&&(U.holeIndices=D),l.push(U)}}return l}function KM(t,e,r,n,i,o,s){const l=(i-n)/r,h=[],A=[],b=[],C=[],S=[];let D,N,U;const V=Ug(t,l-1,r,n);let j=Math.sign(s&8?V[1]-o[3]:V[0]-o[2]),ee=e&&e[l-1],Q=0,X=0;for(let pe=0;pe<l;pe++)D=Ug(t,pe,r,n,D),N=Math.sign(s&8?D[1]-o[3]:D[0]-o[2]),U=e&&e[n/r+pe],N&&j&&j!==N&&(vx(V,D,s,o,S),Cl(h,S)&&b.push(ee),Cl(A,S)&&C.push(ee)),N<=0?(Cl(h,D)&&b.push(U),Q-=N):b.length&&(b[b.length-1]=JM),N>=0?(Cl(A,D)&&C.push(U),X+=N):C.length&&(C[C.length-1]=JM),bx(V,D),j=N,ee=U;return[Q?{pos:h,types:e&&b}:null,X?{pos:A,types:e&&C}:null]}function g8(t,e,r,n){const i=Math.floor((t[0]-r[0])/e)*e+r[0],o=Math.floor((t[1]-r[1])/e)*e+r[1];return n[0]=i,n[1]=o,n[2]=i+e,n[3]=o+e,n}function oce(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function ace(t,e,r,n){let i=1/0,o=-1/0,s=1/0,l=-1/0;for(let h=0;h<r;h+=e){const A=t[h],b=t[h+1];i=A<i?A:i,o=A>o?A:o,s=b<s?b:s,l=b>l?b:l}return n[0][0]=i,n[0][1]=s,n[1][0]=o,n[1][1]=l,n}function c0(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}const lce=85.051129;function cce(t,e){const{size:r=2,startIndex:n=0,endIndex:i=t.length,normalize:o=!0}=e||{},s=t.slice(n,i);m8(s,r,0,i-n);const l=p8(s,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const h of l)_8(h,r);return l}function uce(t,e=null,r){const{size:n=2,normalize:i=!0,edgeTypes:o=!1}=r||{};e=e||[];const s=[],l=[];let h=0,A=0;for(let C=0;C<=e.length;C++){const S=e[C]||t.length,D=A,N=hce(t,n,h,S);for(let U=N;U<S;U++)s[A++]=t[U];for(let U=h;U<N;U++)s[A++]=t[U];m8(s,n,D,A),fce(s,n,D,A,r?.maxLatitude),h=S,l[C]=A}l.pop();const b=A8(s,l,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const C of b)_8(C.positions,n);return b}function hce(t,e,r,n){let i=-1,o=-1;for(let s=r+1;s<n;s+=e){const l=Math.abs(t[s]);l>i&&(i=l,o=s-1)}return o}function fce(t,e,r,n,i=lce){const o=t[r],s=t[n-e];if(Math.abs(o-s)>180){const l=Ug(t,0,e,r);l[0]+=Math.round((s-o)/360)*360,Cl(t,l),l[1]=Math.sign(l[1])*i,Cl(t,l),l[0]=o,Cl(t,l)}}function m8(t,e,r,n){let i=t[0],o;for(let s=r;s<n;s+=e){o=t[s];const l=o-i;(l>180||l<-180)&&(o-=Math.round(l/360)*360),t[s]=i=o}}function _8(t,e){let r;const n=t.length/e;for(let o=0;o<n&&(r=t[o*e],(r+180)%360===0);o++);const i=-Math.round(r/360)*360;if(i!==0)for(let o=0;o<n;o++)t[o*e]+=i}class dce extends eo{constructor(e){const{indices:r,attributes:n}=pce(e);super({...e,indices:r,attributes:n})}}function pce(t){const{radius:e,height:r=1,nradial:n=10}=t;let{vertices:i}=t;i&&($r.assert(i.length>=n),i=i.flatMap(D=>[D[0],D[1]]),GC(i,UC.COUNTER_CLOCKWISE));const o=r>0,s=n+1,l=o?s*3+1:n,h=Math.PI*2/n,A=new Uint16Array(o?n*3*2:0),b=new Float32Array(l*3),C=new Float32Array(l*3);let S=0;if(o){for(let D=0;D<s;D++){const N=D*h,U=D%n,V=Math.sin(N),j=Math.cos(N);for(let ee=0;ee<2;ee++)b[S+0]=i?i[U*2]:j*e,b[S+1]=i?i[U*2+1]:V*e,b[S+2]=(1/2-ee)*r,C[S+0]=i?i[U*2]:j,C[S+1]=i?i[U*2+1]:V,S+=3}b[S+0]=b[S-3],b[S+1]=b[S-2],b[S+2]=b[S-1],S+=3}for(let D=o?0:1;D<s;D++){const N=Math.floor(D/2)*Math.sign(.5-D%2),U=N*h,V=(N+n)%n,j=Math.sin(U),ee=Math.cos(U);b[S+0]=i?i[V*2]:ee*e,b[S+1]=i?i[V*2+1]:j*e,b[S+2]=r/2,C[S+2]=1,S+=3}if(o){let D=0;for(let N=0;N<n;N++)A[D++]=N*2+0,A[D++]=N*2+2,A[D++]=N*2+0,A[D++]=N*2+1,A[D++]=N*2+1,A[D++]=N*2+3}return{indices:A,attributes:{POSITION:{size:3,value:b},NORMAL:{size:3,value:C}}}}const XM=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,Ace={name:"column",vs:XM,fs:XM,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},gce=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,mce=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,W_=[0,0,0,255],_ce={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:W_},getLineColor:{type:"accessor",value:W_},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Ac extends Es{getShaders(){const e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:gce,fs:mce,defines:e,modules:[Fs,r?iC:By,_a,Ace]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:W_},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:W_},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=i.extensionsChanged||r.flatShading!==n.flatShading;o&&(this.state.models?.forEach(l=>l.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||r.diskResolution!==n.diskResolution||r.vertices!==n.vertices||(r.extruded||r.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(r)}getGeometry(e,r,n){const i=new dce({radius:1,height:n?2:0,vertices:r,nradial:e});let o=0;if(r)for(let s=0;s<e;s++){const l=r[s],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]);o+=h/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),i}_getModels(){const e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),n=new Di(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),i=new Di(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:r,extruded:n,stroked:i}){const o=this.getGeometry(e,r,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,l=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),l.setGeometry(o),l.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:r,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:l,extruded:h,filled:A,stroked:b,wireframe:C,offset:S,coverage:D,radius:N,angle:U}=this.props,V=this.state.fillModel,j=this.state.wireframeModel,{fillVertexCount:ee,edgeDistance:Q}=this.state,X={radius:N,angle:U/180*Math.PI,offset:S,extruded:h,stroked:b,coverage:D,elevationScale:l,edgeDistance:Q,radiusUnits:Po[s],widthUnits:Po[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o};h&&C&&(j.shaderInputs.setProps({column:{...X,isStroke:!0}}),j.draw(this.context.renderPass)),A&&(V.setVertexCount(ee),V.shaderInputs.setProps({column:{...X,isStroke:!1}}),V.draw(this.context.renderPass)),!h&&b&&(V.setVertexCount(ee*2/3),V.shaderInputs.setProps({column:{...X,isStroke:!0}}),V.draw(this.context.renderPass))}}Ac.layerName="ColumnLayer",Ac.defaultProps=_ce;const yce={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let xx=class extends Ac{_updateGeometry(){const t=new l6;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{elevationScale:e,extruded:r,offset:n,coverage:i,cellSize:o,angle:s,radiusUnits:l}=this.props,h=this.state.fillModel,A={radius:o/2,radiusUnits:Po[l],angle:s,offset:n,extruded:r,stroked:!1,coverage:i,elevationScale:e,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};h.shaderInputs.setProps({column:A}),h.draw(this.context.renderPass)}};xx.layerName="GridCellLayer",xx.defaultProps=yce;function bce(t,e,r,n){let i;if(Array.isArray(t[0])){const o=t.length*e;i=new Array(o);for(let s=0;s<t.length;s++)for(let l=0;l<e;l++)i[s*e+l]=t[s][l]||0}else i=t;return r?p8(i,{size:e,gridResolution:r}):n?cce(i,{size:e}):i}const vce=1,xce=2,Yv=4;class wce extends H6{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?bce(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(QM(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&QM(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:s}=r;n.fill(0,o,o+s),i?(n[o]=Yv,n[o+s-2]=Yv):(n[o]+=vce,n[o+s-2]+=xce),n[o+s-1]=Yv}_updatePositions(e,r){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:o}=r,s=new Array(3);for(let l=i,h=0;h<o;l++,h++)this.getPointOnPath(e,h,s),n[l*3]=s[0],n[l*3+1]=s[1],n[l*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,n=[]){const{positionSize:i}=this;r*i>=e.length&&(r+=1-e.length/i);const o=r*i;return n[0]=e[o],n[1]=e[o+1],n[2]=i===3&&e[o+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:r}=this,n=e.length-r;return e[0]===e[n]&&e[1]===e[n+1]&&(r===2||e[2]===e[n+2])}}function QM(t){return Array.isArray(t[0])}const ZM=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Cce={name:"path",vs:ZM,fs:ZM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Ece=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Bce=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,y8=[0,0,0,255],Tce={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:y8},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},e1={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class nh extends Es{getShaders(){return super.getShaders({vs:Ece,fs:Bce,modules:[Fs,_a,Cce]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:e1,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:e1,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:e1,defaultValue:y8},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:r,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:r,n)}}),this.setState({pathTesselator:new wce({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:r,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,s=r.data.attributes||{};o.updateGeometry({data:r.data,geometryBuffer:s.getPath,buffers:s,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(o=>o.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:r,capRounded:n,billboard:i,miterLimit:o,widthUnits:s,widthScale:l,widthMinPixels:h,widthMaxPixels:A}=this.props,b=this.state.model,C={jointType:Number(r),capType:Number(n),billboard:i,widthUnits:Po[s],widthScale:l,miterLimit:o,widthMinPixels:h,widthMaxPixels:A};b.shaderInputs.setProps({path:C}),b.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}}nh.defaultProps=Tce,nh.layerName="PathLayer";var u0={exports:{}},$M;function Sce(){if($M)return u0.exports;$M=1,u0.exports=t,u0.exports.default=t;function t(Ce,Le,Ne){Ne=Ne||2;var $e=Le&&Le.length,it=$e?Le[0]*Ne:Ce.length,ot=e(Ce,0,it,Ne,!0),dt=[];if(!ot||ot.next===ot.prev)return dt;var Mt,St,st,Ar,Qt,Zt,Ht;if($e&&(ot=h(Ce,Le,ot,Ne)),Ce.length>80*Ne){Mt=st=Ce[0],St=Ar=Ce[1];for(var dr=Ne;dr<it;dr+=Ne)Qt=Ce[dr],Zt=Ce[dr+1],Qt<Mt&&(Mt=Qt),Zt<St&&(St=Zt),Qt>st&&(st=Qt),Zt>Ar&&(Ar=Zt);Ht=Math.max(st-Mt,Ar-St),Ht=Ht!==0?32767/Ht:0}return n(ot,dt,Ne,Mt,St,Ht,0),dt}function e(Ce,Le,Ne,$e,it){var ot,dt;if(it===ct(Ce,Le,Ne,$e)>0)for(ot=Le;ot<Ne;ot+=$e)dt=J(ot,Ce[ot],Ce[ot+1],dt);else for(ot=Ne-$e;ot>=Le;ot-=$e)dt=J(ot,Ce[ot],Ce[ot+1],dt);return dt&&X(dt,dt.next)&&(ue(dt),dt=dt.next),dt}function r(Ce,Le){if(!Ce)return Ce;Le||(Le=Ce);var Ne=Ce,$e;do if($e=!1,!Ne.steiner&&(X(Ne,Ne.next)||Q(Ne.prev,Ne,Ne.next)===0)){if(ue(Ne),Ne=Le=Ne.prev,Ne===Ne.next)break;$e=!0}else Ne=Ne.next;while($e||Ne!==Le);return Le}function n(Ce,Le,Ne,$e,it,ot,dt){if(Ce){!dt&&ot&&D(Ce,$e,it,ot);for(var Mt=Ce,St,st;Ce.prev!==Ce.next;){if(St=Ce.prev,st=Ce.next,ot?o(Ce,$e,it,ot):i(Ce)){Le.push(St.i/Ne|0),Le.push(Ce.i/Ne|0),Le.push(st.i/Ne|0),ue(Ce),Ce=st.next,Mt=st.next;continue}if(Ce=st,Ce===Mt){dt?dt===1?(Ce=s(r(Ce),Le,Ne),n(Ce,Le,Ne,$e,it,ot,2)):dt===2&&l(Ce,Le,Ne,$e,it,ot):n(r(Ce),Le,Ne,$e,it,ot,1);break}}}}function i(Ce){var Le=Ce.prev,Ne=Ce,$e=Ce.next;if(Q(Le,Ne,$e)>=0)return!1;for(var it=Le.x,ot=Ne.x,dt=$e.x,Mt=Le.y,St=Ne.y,st=$e.y,Ar=it<ot?it<dt?it:dt:ot<dt?ot:dt,Qt=Mt<St?Mt<st?Mt:st:St<st?St:st,Zt=it>ot?it>dt?it:dt:ot>dt?ot:dt,Ht=Mt>St?Mt>st?Mt:st:St>st?St:st,dr=$e.next;dr!==Le;){if(dr.x>=Ar&&dr.x<=Zt&&dr.y>=Qt&&dr.y<=Ht&&j(it,Mt,ot,St,dt,st,dr.x,dr.y)&&Q(dr.prev,dr,dr.next)>=0)return!1;dr=dr.next}return!0}function o(Ce,Le,Ne,$e){var it=Ce.prev,ot=Ce,dt=Ce.next;if(Q(it,ot,dt)>=0)return!1;for(var Mt=it.x,St=ot.x,st=dt.x,Ar=it.y,Qt=ot.y,Zt=dt.y,Ht=Mt<St?Mt<st?Mt:st:St<st?St:st,dr=Ar<Qt?Ar<Zt?Ar:Zt:Qt<Zt?Qt:Zt,ln=Mt>St?Mt>st?Mt:st:St>st?St:st,Lr=Ar>Qt?Ar>Zt?Ar:Zt:Qt>Zt?Qt:Zt,vr=U(Ht,dr,Le,Ne,$e),Hn=U(ln,Lr,Le,Ne,$e),_r=Ce.prevZ,yr=Ce.nextZ;_r&&_r.z>=vr&&yr&&yr.z<=Hn;){if(_r.x>=Ht&&_r.x<=ln&&_r.y>=dr&&_r.y<=Lr&&_r!==it&&_r!==dt&&j(Mt,Ar,St,Qt,st,Zt,_r.x,_r.y)&&Q(_r.prev,_r,_r.next)>=0||(_r=_r.prevZ,yr.x>=Ht&&yr.x<=ln&&yr.y>=dr&&yr.y<=Lr&&yr!==it&&yr!==dt&&j(Mt,Ar,St,Qt,st,Zt,yr.x,yr.y)&&Q(yr.prev,yr,yr.next)>=0))return!1;yr=yr.nextZ}for(;_r&&_r.z>=vr;){if(_r.x>=Ht&&_r.x<=ln&&_r.y>=dr&&_r.y<=Lr&&_r!==it&&_r!==dt&&j(Mt,Ar,St,Qt,st,Zt,_r.x,_r.y)&&Q(_r.prev,_r,_r.next)>=0)return!1;_r=_r.prevZ}for(;yr&&yr.z<=Hn;){if(yr.x>=Ht&&yr.x<=ln&&yr.y>=dr&&yr.y<=Lr&&yr!==it&&yr!==dt&&j(Mt,Ar,St,Qt,st,Zt,yr.x,yr.y)&&Q(yr.prev,yr,yr.next)>=0)return!1;yr=yr.nextZ}return!0}function s(Ce,Le,Ne){var $e=Ce;do{var it=$e.prev,ot=$e.next.next;!X(it,ot)&&pe(it,$e,$e.next,ot)&&de(it,ot)&&de(ot,it)&&(Le.push(it.i/Ne|0),Le.push($e.i/Ne|0),Le.push(ot.i/Ne|0),ue($e),ue($e.next),$e=Ce=ot),$e=$e.next}while($e!==Ce);return r($e)}function l(Ce,Le,Ne,$e,it,ot){var dt=Ce;do{for(var Mt=dt.next.next;Mt!==dt.prev;){if(dt.i!==Mt.i&&ee(dt,Mt)){var St=De(dt,Mt);dt=r(dt,dt.next),St=r(St,St.next),n(dt,Le,Ne,$e,it,ot,0),n(St,Le,Ne,$e,it,ot,0);return}Mt=Mt.next}dt=dt.next}while(dt!==Ce)}function h(Ce,Le,Ne,$e){var it=[],ot,dt,Mt,St,st;for(ot=0,dt=Le.length;ot<dt;ot++)Mt=Le[ot]*$e,St=ot<dt-1?Le[ot+1]*$e:Ce.length,st=e(Ce,Mt,St,$e,!1),st===st.next&&(st.steiner=!0),it.push(V(st));for(it.sort(A),ot=0;ot<it.length;ot++)Ne=b(it[ot],Ne);return Ne}function A(Ce,Le){return Ce.x-Le.x}function b(Ce,Le){var Ne=C(Ce,Le);if(!Ne)return Le;var $e=De(Ne,Ce);return r($e,$e.next),r(Ne,Ne.next)}function C(Ce,Le){var Ne=Le,$e=Ce.x,it=Ce.y,ot=-1/0,dt;do{if(it<=Ne.y&&it>=Ne.next.y&&Ne.next.y!==Ne.y){var Mt=Ne.x+(it-Ne.y)*(Ne.next.x-Ne.x)/(Ne.next.y-Ne.y);if(Mt<=$e&&Mt>ot&&(ot=Mt,dt=Ne.x<Ne.next.x?Ne:Ne.next,Mt===$e))return dt}Ne=Ne.next}while(Ne!==Le);if(!dt)return null;var St=dt,st=dt.x,Ar=dt.y,Qt=1/0,Zt;Ne=dt;do $e>=Ne.x&&Ne.x>=st&&$e!==Ne.x&&j(it<Ar?$e:ot,it,st,Ar,it<Ar?ot:$e,it,Ne.x,Ne.y)&&(Zt=Math.abs(it-Ne.y)/($e-Ne.x),de(Ne,Ce)&&(Zt<Qt||Zt===Qt&&(Ne.x>dt.x||Ne.x===dt.x&&S(dt,Ne)))&&(dt=Ne,Qt=Zt)),Ne=Ne.next;while(Ne!==St);return dt}function S(Ce,Le){return Q(Ce.prev,Ce,Le.prev)<0&&Q(Le.next,Ce,Ce.next)<0}function D(Ce,Le,Ne,$e){var it=Ce;do it.z===0&&(it.z=U(it.x,it.y,Le,Ne,$e)),it.prevZ=it.prev,it.nextZ=it.next,it=it.next;while(it!==Ce);it.prevZ.nextZ=null,it.prevZ=null,N(it)}function N(Ce){var Le,Ne,$e,it,ot,dt,Mt,St,st=1;do{for(Ne=Ce,Ce=null,ot=null,dt=0;Ne;){for(dt++,$e=Ne,Mt=0,Le=0;Le<st&&(Mt++,$e=$e.nextZ,!!$e);Le++);for(St=st;Mt>0||St>0&&$e;)Mt!==0&&(St===0||!$e||Ne.z<=$e.z)?(it=Ne,Ne=Ne.nextZ,Mt--):(it=$e,$e=$e.nextZ,St--),ot?ot.nextZ=it:Ce=it,it.prevZ=ot,ot=it;Ne=$e}ot.nextZ=null,st*=2}while(dt>1);return Ce}function U(Ce,Le,Ne,$e,it){return Ce=(Ce-Ne)*it|0,Le=(Le-$e)*it|0,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,Le=(Le|Le<<8)&16711935,Le=(Le|Le<<4)&252645135,Le=(Le|Le<<2)&858993459,Le=(Le|Le<<1)&1431655765,Ce|Le<<1}function V(Ce){var Le=Ce,Ne=Ce;do(Le.x<Ne.x||Le.x===Ne.x&&Le.y<Ne.y)&&(Ne=Le),Le=Le.next;while(Le!==Ce);return Ne}function j(Ce,Le,Ne,$e,it,ot,dt,Mt){return(it-dt)*(Le-Mt)>=(Ce-dt)*(ot-Mt)&&(Ce-dt)*($e-Mt)>=(Ne-dt)*(Le-Mt)&&(Ne-dt)*(ot-Mt)>=(it-dt)*($e-Mt)}function ee(Ce,Le){return Ce.next.i!==Le.i&&Ce.prev.i!==Le.i&&!ze(Ce,Le)&&(de(Ce,Le)&&de(Le,Ce)&&ce(Ce,Le)&&(Q(Ce.prev,Ce,Le.prev)||Q(Ce,Le.prev,Le))||X(Ce,Le)&&Q(Ce.prev,Ce,Ce.next)>0&&Q(Le.prev,Le,Le.next)>0)}function Q(Ce,Le,Ne){return(Le.y-Ce.y)*(Ne.x-Le.x)-(Le.x-Ce.x)*(Ne.y-Le.y)}function X(Ce,Le){return Ce.x===Le.x&&Ce.y===Le.y}function pe(Ce,Le,Ne,$e){var it=Ge(Q(Ce,Le,Ne)),ot=Ge(Q(Ce,Le,$e)),dt=Ge(Q(Ne,$e,Ce)),Mt=Ge(Q(Ne,$e,Le));return!!(it!==ot&&dt!==Mt||it===0&&Y(Ce,Ne,Le)||ot===0&&Y(Ce,$e,Le)||dt===0&&Y(Ne,Ce,$e)||Mt===0&&Y(Ne,Le,$e))}function Y(Ce,Le,Ne){return Le.x<=Math.max(Ce.x,Ne.x)&&Le.x>=Math.min(Ce.x,Ne.x)&&Le.y<=Math.max(Ce.y,Ne.y)&&Le.y>=Math.min(Ce.y,Ne.y)}function Ge(Ce){return Ce>0?1:Ce<0?-1:0}function ze(Ce,Le){var Ne=Ce;do{if(Ne.i!==Ce.i&&Ne.next.i!==Ce.i&&Ne.i!==Le.i&&Ne.next.i!==Le.i&&pe(Ne,Ne.next,Ce,Le))return!0;Ne=Ne.next}while(Ne!==Ce);return!1}function de(Ce,Le){return Q(Ce.prev,Ce,Ce.next)<0?Q(Ce,Le,Ce.next)>=0&&Q(Ce,Ce.prev,Le)>=0:Q(Ce,Le,Ce.prev)<0||Q(Ce,Ce.next,Le)<0}function ce(Ce,Le){var Ne=Ce,$e=!1,it=(Ce.x+Le.x)/2,ot=(Ce.y+Le.y)/2;do Ne.y>ot!=Ne.next.y>ot&&Ne.next.y!==Ne.y&&it<(Ne.next.x-Ne.x)*(ot-Ne.y)/(Ne.next.y-Ne.y)+Ne.x&&($e=!$e),Ne=Ne.next;while(Ne!==Ce);return $e}function De(Ce,Le){var Ne=new Ee(Ce.i,Ce.x,Ce.y),$e=new Ee(Le.i,Le.x,Le.y),it=Ce.next,ot=Le.prev;return Ce.next=Le,Le.prev=Ce,Ne.next=it,it.prev=Ne,$e.next=Ne,Ne.prev=$e,ot.next=$e,$e.prev=ot,$e}function J(Ce,Le,Ne,$e){var it=new Ee(Ce,Le,Ne);return $e?(it.next=$e.next,it.prev=$e,$e.next.prev=it,$e.next=it):(it.prev=it,it.next=it),it}function ue(Ce){Ce.next.prev=Ce.prev,Ce.prev.next=Ce.next,Ce.prevZ&&(Ce.prevZ.nextZ=Ce.nextZ),Ce.nextZ&&(Ce.nextZ.prevZ=Ce.prevZ)}function Ee(Ce,Le,Ne){this.i=Ce,this.x=Le,this.y=Ne,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(Ce,Le,Ne,$e){var it=Le&&Le.length,ot=it?Le[0]*Ne:Ce.length,dt=Math.abs(ct(Ce,0,ot,Ne));if(it)for(var Mt=0,St=Le.length;Mt<St;Mt++){var st=Le[Mt]*Ne,Ar=Mt<St-1?Le[Mt+1]*Ne:Ce.length;dt-=Math.abs(ct(Ce,st,Ar,Ne))}var Qt=0;for(Mt=0;Mt<$e.length;Mt+=3){var Zt=$e[Mt]*Ne,Ht=$e[Mt+1]*Ne,dr=$e[Mt+2]*Ne;Qt+=Math.abs((Ce[Zt]-Ce[dr])*(Ce[Ht+1]-Ce[Zt+1])-(Ce[Zt]-Ce[Ht])*(Ce[dr+1]-Ce[Zt+1]))}return dt===0&&Qt===0?0:Math.abs((Qt-dt)/dt)};function ct(Ce,Le,Ne,$e){for(var it=0,ot=Le,dt=Ne-$e;ot<Ne;ot+=$e)it+=(Ce[dt]-Ce[ot])*(Ce[ot+1]+Ce[dt+1]),dt=ot;return it}return t.flatten=function(Ce){for(var Le=Ce[0][0].length,Ne={vertices:[],holes:[],dimensions:Le},$e=0,it=0;it<Ce.length;it++){for(var ot=0;ot<Ce[it].length;ot++)for(var dt=0;dt<Le;dt++)Ne.vertices.push(Ce[it][ot][dt]);it>0&&($e+=Ce[it-1].length,Ne.holes.push($e))}return Ne},u0.exports}var Ice=Sce();const b8=bf(Ice),h0=UC.CLOCKWISE,qM=UC.COUNTER_CLOCKWISE,Ku={};function Mce(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function eg(t){return"positions"in t?t.positions:t}function X0(t){return"holeIndices"in t?t.holeIndices:null}function Pce(t){return Array.isArray(t[0])}function Lce(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Rce(t){const e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Oce(t,e,r,n){for(let i=0;i<e;i++)if(t[r+i]!==t[n-e+i])return!1;return!0}function YM(t,e,r,n,i){let o=e;const s=r.length;for(let l=0;l<s;l++)for(let h=0;h<n;h++)t[o++]=r[l][h]||0;if(!Rce(r))for(let l=0;l<n;l++)t[o++]=r[0][l]||0;return Ku.start=e,Ku.end=o,Ku.size=n,GC(t,i,Ku),o}function eP(t,e,r,n,i=0,o,s){o=o||r.length;const l=o-i;if(l<=0)return e;let h=e;for(let A=0;A<l;A++)t[h++]=r[i+A];if(!Oce(r,n,i,o))for(let A=0;A<n;A++)t[h++]=r[i+A];return Ku.start=e,Ku.end=h,Ku.size=n,GC(t,s,Ku),h}function v8(t,e){Mce(t);const r=[],n=[];if("positions"in t){const{positions:i,holeIndices:o}=t;if(o){let s=0;for(let l=0;l<=o.length;l++)s=eP(r,s,i,e,o[l-1],o[l],l===0?h0:qM),n.push(s);return n.pop(),{positions:r,holeIndices:n}}t=i}if(!Pce(t))return eP(r,0,t,e,0,r.length,h0),r;if(!Lce(t)){let i=0;for(const[o,s]of t.entries())i=YM(r,i,s,e,o===0?h0:qM),n.push(i);return n.pop(),{positions:r,holeIndices:n}}return YM(r,0,t,e,h0),r}function t1(t,e,r){const n=t.length/3;let i=0;for(let o=0;o<n;o++){const s=(o+1)%n;i+=t[o*3+e]*t[s*3+r],i-=t[s*3+e]*t[o*3+r]}return Math.abs(i/2)}function tP(t,e,r,n){const i=t.length/3;for(let o=0;o<i;o++){const s=o*3,l=t[s+0],h=t[s+1],A=t[s+2];t[s+e]=l,t[s+r]=h,t[s+n]=A}}function Dce(t,e,r,n){let i=X0(t);i&&(i=i.map(l=>l/e));let o=eg(t);const s=n&&e===3;if(r){const l=o.length;o=o.slice();const h=[];for(let A=0;A<l;A+=e){h[0]=o[A],h[1]=o[A+1],s&&(h[2]=o[A+2]);const b=r(h);o[A]=b[0],o[A+1]=b[1],s&&(o[A+2]=b[2])}}if(s){const l=t1(o,0,1),h=t1(o,0,2),A=t1(o,1,2);if(!l&&!h&&!A)return[];l>h&&l>A||(h>A?(r||(o=o.slice()),tP(o,0,2,1)):(r||(o=o.slice()),tP(o,2,0,1)))}return b8(o,i,e)}class Fce extends H6{constructor(e){const{fp64:r,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);const r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const r=v8(e,this.positionSize);return this.opts.resolution?A8(eg(r),X0(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?uce(eg(r),X0(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(rP(e)){let r=0;for(const n of e)r+=this.getGeometrySize(n);return r}return eg(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&rP(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{const n=e;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:n,indexStart:i}){const{attributes:o,indexStarts:s,typedArrayManager:l}=this;let h=o.indices;if(!h||!e)return;let A=i;const b=Dce(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=l.allocate(h,i+b.length,{copy:!0});for(let C=0;C<b.length;C++)h[A++]=b[C]+n;s[r+1]=i+b.length,o.indices=h}_updatePositions(e,{vertexStart:r,geometrySize:n}){const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const s=eg(e);for(let l=r,h=0;h<n;l++,h++){const A=s[h*o],b=s[h*o+1],C=o>2?s[h*o+2]:0;i[l*3]=A,i[l*3+1]=b,i[l*3+2]=C}}_updateVertexValid(e,{vertexStart:r,geometrySize:n}){const{positionSize:i}=this,o=this.attributes.vertexValid,s=e&&X0(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,r):o.fill(1,r,r+n),s)for(let l=0;l<s.length;l++)o[r+s[l]/i-1]=0;o[r+n-1]=0}}function rP(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const nP=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,kce={name:"solidPolygon",vs:nP,fs:nP,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},x8=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Nce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${x8}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Uce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${x8}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Gce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,J_=[0,0,0,255],zce={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:J_},getLineColor:{type:"accessor",value:J_},material:!0},f0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class ih extends Es{getShaders(e){return super.getShaders({vs:e==="top"?Nce:Uce,fs:Gce,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Fs,By,_a,kce]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&r===Yr.DEFAULT&&(r=Yr.LNGLAT);let i;r===Yr.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Fce({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:f0,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:f0,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:f0,accessor:"getFillColor",defaultValue:J_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:f0,accessor:"getLineColor",defaultValue:J_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:h,target:A})=>this.encodePickingColor(l&&l.__source?l.__source.index:h,A)}})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(o=>o.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:r,filled:n,wireframe:i,elevationScale:o}=this.props,{topModel:s,sideModel:l,wireframeModel:h,polygonTesselator:A}=this.state,b={extruded:!!r,elevationScale:o,isWireframe:!1};h&&i&&(h.setInstanceCount(A.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...b,isWireframe:!0}}),h.draw(this.context.renderPass)),l&&n&&(l.setInstanceCount(A.instanceCount-1),l.shaderInputs.setProps({solidPolygon:b}),l.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(A.vertexCount),s.shaderInputs.setProps({solidPolygon:b}),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager();(i.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(s=>s.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:i}=this.state,o=e.data.attributes||{};i.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:r,extruded:n}=this.props;let i,o,s;if(r){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Di(this.context.device,{...l,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Di(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:l,geometry:new eo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Di(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:l,geometry:new eo({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,i].filter(Boolean),topModel:i,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){const{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}ih.defaultProps=zce,ih.layerName="SolidPolygonLayer";function w8({data:t,getIndex:e,dataRange:r,replace:n}){const{startRow:i=0,endRow:o=1/0}=r,s=t.length;let l=s,h=s;for(let C=0;C<s;C++){const S=e(t[C]);if(l>C&&S>=i&&(l=C),S>=o){h=C;break}}let A=l;const b=h-l!==n.length?t.slice(h):void 0;for(let C=0;C<n.length;C++)t[A++]=n[C];if(b){for(let C=0;C<b.length;C++)t[A++]=b[C];t.length=A}return{startRow:l,endRow:l+n.length}}const C8=[0,0,0,255],jce=[0,0,0,255],Hce={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:jce},getLineColor:{type:"accessor",value:C8},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class sh extends Bs{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&$r.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){const n=this.state.paths.slice(),i=e.dataChanged.map(o=>w8({data:n,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:n,pathsDiff:i})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:r,getPolygon:n,positionFormat:i,_normalize:o}=this.props,s=[],l=i==="XY"?2:3,{startRow:h,endRow:A}=e,{iterable:b,objectInfo:C}=yc(r,h,A);for(const S of b){C.index++;let D=n(S,C);o&&(D=v8(D,l));const{holeIndices:N}=D,U=D.positions||D;if(N)for(let V=0;V<=N.length;V++){const j=U.slice(N[V-1]||0,N[V]||U.length);s.push(this.getSubLayerRow({path:j},S,C.index))}else s.push(this.getSubLayerRow({path:U},S,C.index))}return s}renderLayers(){const{data:e,_dataDiff:r,stroked:n,filled:i,extruded:o,wireframe:s,_normalize:l,_windingOrder:h,elevationScale:A,transitions:b,positionFormat:C}=this.props,{lineWidthUnits:S,lineWidthScale:D,lineWidthMinPixels:N,lineWidthMaxPixels:U,lineJointRounded:V,lineMiterLimit:j,lineDashJustified:ee}=this.props,{getFillColor:Q,getLineColor:X,getLineWidth:pe,getLineDashArray:Y,getElevation:Ge,getPolygon:ze,updateTriggers:de,material:ce}=this.props,{paths:De,pathsDiff:J}=this.state,ue=this.getSubLayerClass("fill",ih),Ee=this.getSubLayerClass("stroke",nh),ct=this.shouldRenderSubLayer("fill",De)&&new ue({_dataDiff:r,extruded:o,elevationScale:A,filled:i,wireframe:s,_normalize:l,_windingOrder:h,getElevation:Ge,getFillColor:Q,getLineColor:o&&s?X:C8,material:ce,transitions:b},this.getSubLayerProps({id:"fill",updateTriggers:de&&{getPolygon:de.getPolygon,getElevation:de.getElevation,getFillColor:de.getFillColor,lineColors:o&&s,getLineColor:de.getLineColor}}),{data:e,positionFormat:C,getPolygon:ze}),Ce=!o&&n&&this.shouldRenderSubLayer("stroke",De)&&new Ee({_dataDiff:J&&(()=>J),widthUnits:S,widthScale:D,widthMinPixels:N,widthMaxPixels:U,jointRounded:V,miterLimit:j,dashJustified:ee,_pathType:"loop",transitions:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getPath:b.getPolygon},getColor:this.getSubLayerAccessor(X),getWidth:this.getSubLayerAccessor(pe),getDashArray:this.getSubLayerAccessor(Y)},this.getSubLayerProps({id:"stroke",updateTriggers:de&&{getWidth:de.getLineWidth,getColor:de.getLineColor,getDashArray:de.getLineDashArray}}),{data:De,positionFormat:C,getPath:Le=>Le.path});return[!o&&ct,Ce,o&&ct]}}sh.layerName="PolygonLayer",sh.defaultProps=Hce;function Vce(t,e){if(!t)return null;const r="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[r];return r!==-1?Wce(t,n,r):null}function Wce(t,e,r){const n={properties:{...t.properties[e]}};for(const i in t.numericProps)n.properties[i]=t.numericProps[i].value[r];return n}function Jce(t,e){const r={points:null,lines:null,polygons:null};for(const n in r){const i=t[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(i.length*4);const o=[];for(let s=0;s<i.length;s++)e(i[s],o),r[n][s*4+0]=o[0],r[n][s*4+1]=o[1],r[n][s*4+2]=o[2],r[n][s*4+3]=255}return r}const iP=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Kce={name:"sdf",vs:iP,fs:iP,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Xce=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,r1=192/256,sP=[],Qce={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class K_ extends zp{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,Kce],fs:Xce}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:r,target:n})=>this.encodePickingColor(r,n)}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;let{outlineColor:i}=r;i!==n.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!r.sdf&&r.outlineWidth&&$r.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:r,smoothing:n,outlineWidth:i}=this.props,{outlineColor:o}=this.state,s=i?Math.max(n,r1*(1-i)):-1,l=this.state.model,h={buffer:r1,outlineBuffer:s,gamma:n,enabled:!!r,outlineColor:o};if(l.shaderInputs.setProps({sdf:h}),super.draw(e),r&&i){const{iconManager:A}=this.state;A.getTexture()&&(l.shaderInputs.setProps({sdf:{...h,outlineBuffer:r1}}),l.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):sP}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):sP}}K_.defaultProps=Qce,K_.layerName="MultiIconLayer";const _g=1e20;class Zce{constructor({fontSize:e=24,buffer:r=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:l="normal"}={}){this.buffer=r,this.cutoff=i,this.radius=n;const h=this.size=e+r*4,A=this._createCanvas(h),b=this.ctx=A.getContext("2d",{willReadFrequently:!0});b.font=`${l} ${s} ${e}px ${o}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){const{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(e),l=Math.ceil(n),h=0,A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),b=Math.min(this.size-this.buffer,l+Math.ceil(i)),C=A+2*this.buffer,S=b+2*this.buffer,D=Math.max(C*S,0),N=new Uint8ClampedArray(D),U={data:N,width:C,height:S,glyphWidth:A,glyphHeight:b,glyphTop:l,glyphLeft:h,glyphAdvance:r};if(A===0||b===0)return U;const{ctx:V,buffer:j,gridInner:ee,gridOuter:Q}=this;V.clearRect(j,j,A,b),V.fillText(e,j,j+l);const X=V.getImageData(j,j,A,b);Q.fill(_g,0,D),ee.fill(0,0,D);for(let pe=0;pe<b;pe++)for(let Y=0;Y<A;Y++){const Ge=X.data[4*(pe*A+Y)+3]/255;if(Ge===0)continue;const ze=(pe+j)*C+Y+j;if(Ge===1)Q[ze]=0,ee[ze]=_g;else{const de=.5-Ge;Q[ze]=de>0?de*de:0,ee[ze]=de<0?de*de:0}}oP(Q,0,0,C,S,C,this.f,this.v,this.z),oP(ee,j,j,A,b,C,this.f,this.v,this.z);for(let pe=0;pe<D;pe++){const Y=Math.sqrt(Q[pe])-Math.sqrt(ee[pe]);N[pe]=Math.round(255-255*(Y/this.radius+this.cutoff))}return U}}function oP(t,e,r,n,i,o,s,l,h){for(let A=e;A<e+n;A++)aP(t,r*o+A,o,i,s,l,h);for(let A=r;A<r+i;A++)aP(t,A*o+e,1,n,s,l,h)}function aP(t,e,r,n,i,o,s){o[0]=0,s[0]=-_g,s[1]=_g,i[0]=t[e];for(let l=1,h=0,A=0;l<n;l++){i[l]=t[e+l*r];const b=l*l;do{const C=o[h];A=(i[l]-i[C]+b-C*C)/(l-C)/2}while(A<=s[h]&&--h>-1);h++,o[h]=l,s[h]=A,s[h+1]=_g}for(let l=0,h=0;l<n;l++){for(;s[h+1]<l;)h++;const A=o[h],b=l-A;t[e+l*r]=i[A]+b*b}}const $ce=32,qce=[];function Yce(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function eue({characterSet:t,getFontWidth:e,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:s=0,yOffset:l=0}){let h=0,A=s;const b=r+n*2;for(const C of t)if(!o[C]){const S=e(C);A+S+n*2>i&&(A=0,h++),o[C]={x:A+n,y:l+h*b+n,width:S,height:b,layoutWidth:S,layoutHeight:r},A+=S+n*2}return{mapping:o,xOffset:A,yOffset:l+h*b,canvasHeight:Yce(l+(h+1)*b)}}function E8(t,e,r,n){let i=0;for(let o=e;o<r;o++){const s=t[o];i+=n[s]?.layoutWidth||0}return i}function B8(t,e,r,n,i,o){let s=e,l=0;for(let h=e;h<r;h++){const A=E8(t,h,h+1,i);l+A>n&&(s<h&&o.push(h),s=h,l=0),l+=A}return l}function tue(t,e,r,n,i,o){let s=e,l=e,h=e,A=0;for(let b=e;b<r;b++)if((t[b]===" "||t[b+1]===" "||b+1===r)&&(h=b+1),h>l){let C=E8(t,l,h,i);A+C>n&&(s<l&&(o.push(l),s=l,A=0),C>n&&(C=B8(t,l,h,n,i,o),s=o[o.length-1])),l=h,A+=C}return A}function rue(t,e,r,n,i=0,o){o===void 0&&(o=t.length);const s=[];return e==="break-all"?B8(t,i,o,r,n,s):tue(t,i,o,r,n,s),s}function nue(t,e,r,n,i,o){let s=0,l=0;for(let h=e;h<r;h++){const A=t[h],b=n[A];b?(l||(l=b.layoutHeight),i[h]=s+b.layoutWidth/2,s+=b.layoutWidth):($r.warn(`Missing character: ${A} (${A.codePointAt(0)})`)(),i[h]=s,s+=$ce)}o[0]=s,o[1]=l}function iue(t,e,r,n,i){const o=Array.from(t),s=o.length,l=new Array(s),h=new Array(s),A=new Array(s),b=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,C=[0,0],S=[0,0];let D=0,N=0,U=0;for(let V=0;V<=s;V++){const j=o[V];if((j===`
`||V===s)&&(U=V),U>N){const ee=b?rue(o,r,n,i,N,U):qce;for(let Q=0;Q<=ee.length;Q++){const X=Q===0?N:ee[Q-1],pe=Q<ee.length?ee[Q]:U;nue(o,X,pe,i,l,S);for(let Y=X;Y<pe;Y++){l[Y]-S[0]/2;const Ge=o[Y],ze=i[Ge]?.layoutOffsetY||0;h[Y]=D+S[1]/2+ze,A[Y]=S[0]}D=D+S[1]*e,C[0]=Math.max(C[0],S[0])}N=U}j===`
`&&(l[N]=0,h[N]=0,A[N]=0,N++)}return C[1]=D,{x:l,y:h,rowWidth:A,size:C}}function sue({value:t,length:e,stride:r,offset:n,startIndices:i,characterSet:o}){const s=t.BYTES_PER_ELEMENT,l=r?r/s:1,h=n?n/s:0,A=i[e]||Math.ceil((t.length-h)/l),b=o&&new Set,C=new Array(e);let S=t;if(l>1||h>0){const D=t.constructor;S=new D(A);for(let N=0;N<A;N++)S[N]=t[N*l+h]}for(let D=0;D<e;D++){const N=i[D],U=i[D+1]||A,V=S.subarray(N,U);C[D]=String.fromCodePoint.apply(null,V),b&&V.forEach(b.add,b)}if(b)for(const D of b)o.add(String.fromCodePoint(D));return{texts:C,characterCount:A}}class T8{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}}function oue(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Bp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:oue(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},lP=1024,cP=.9,uP=1.2,S8=3;let X_=new T8(S8);function aue(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);const n=X_.get(t);if(!n)return r;for(const i in n.mapping)r.has(i)&&r.delete(i);return r}function lue(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function hP(t,e,r,n){t.font=`${n} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function cue(t){$r.assert(Number.isFinite(t)&&t>=S8,"Invalid cache limit"),X_=new T8(t)}class uue{constructor(){this.props={...Bp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:r}=this.props;return(e*uP+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const r=aue(this._key,this.props.characterSet),n=X_.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(r,n);this._atlas=i,X_.set(this._key,i)}_generateFontAtlas(e,r){const{fontFamily:n,fontWeight:i,fontSize:o,buffer:s,sdf:l,radius:h,cutoff:A}=this.props;let b=r&&r.data;b||(b=document.createElement("canvas"),b.width=lP);const C=b.getContext("2d",{willReadFrequently:!0});hP(C,n,o,i);const{mapping:S,canvasHeight:D,xOffset:N,yOffset:U}=eue({getFontWidth:V=>C.measureText(V).width,fontHeight:o*uP,buffer:s,characterSet:e,maxCanvasWidth:lP,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(b.height!==D){const V=C.getImageData(0,0,b.width,b.height);b.height=D,C.putImageData(V,0,0)}if(hP(C,n,o,i),l){const V=new Zce({fontSize:o,buffer:s,radius:h,cutoff:A,fontFamily:n,fontWeight:`${i}`});for(const j of e){const{data:ee,width:Q,height:X,glyphTop:pe}=V.draw(j);S[j].width=Q,S[j].layoutOffsetY=o*cP-pe;const Y=C.createImageData(Q,X);lue(ee,Y),C.putImageData(Y,S[j].x,S[j].y)}}else for(const V of e)C.fillText(V,S[V].x,S[V].y+s+o*cP);return{xOffset:N,yOffset:U,mapping:S,data:b,width:b.width,height:b.height}}_getKey(){const{fontFamily:e,fontWeight:r,fontSize:n,buffer:i,sdf:o,radius:s,cutoff:l}=this.props;return o?`${e} ${r} ${n} ${i} ${s} ${l}`:`${e} ${r} ${n} ${i}`}}const fP=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,hue={name:"textBackground",vs:fP,fs:fP,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},fue=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,due=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pue={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Gg extends Es{getShaders(){return super.getShaders({vs:fue,fs:due,modules:[Fs,_a,hue]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:r,sizeScale:n,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:l}=this.props;let{padding:h,borderRadius:A}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),Array.isArray(A)||(A=[A,A,A,A]);const b=this.state.model,C={billboard:r,stroked:!!l,borderRadius:A,padding:h,sizeUnits:Po[i],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s};b.shaderInputs.setProps({textBackground:C}),b.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Gg.defaultProps=pue,Gg.layerName="TextBackgroundLayer";const dP={start:1,middle:0,end:-1},pP={top:1,center:0,bottom:-1},n1=[0,0,0,255],Aue=1,gue={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:n1},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Bp.characterSet},fontFamily:Bp.fontFamily,fontWeight:Bp.fontWeight,lineHeight:Aue,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:n1},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:n1},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Af extends Bs{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[n,i]}=this.transformParagraph(e,r);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,i/=o;const{getTextAnchor:s,getAlignmentBaseline:l}=this.props,h=dP[typeof s=="function"?s(e,r):s],A=pP[typeof l=="function"?l(e,r):l];return[(h-1)*n/2,(A-1)*i/2,n,i]},this.getIconOffsets=(e,r)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:o,y:s,rowWidth:l,size:[h,A]}=this.transformParagraph(e,r),b=dP[typeof n=="function"?n(e,r):n],C=pP[typeof i=="function"?i(e,r):i],S=o.length,D=new Array(S*2);let N=0;for(let U=0;U<S;U++){const V=(1-b)*(h-l[U])/2;D[N++]=(b-1)*h/2+V+o[U],D[N++]=(C-1)*A/2+s[U]}return D}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new uue},this.props.maxWidth>0&&$r.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:r,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:r,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const l in s)if(s[l]!==i.props[l])return i.setProps(s),!0;return!1}_updateText(){const{data:e,characterSet:r}=this.props,n=e.attributes?.getText;let{getText:i}=this.props,o=e.startIndices,s;const l=r==="auto"&&new Set;if(n&&o){const{texts:h,characterCount:A}=sue({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:l});s=A,i=(b,{index:C})=>h[C]}else{const{iterable:h,objectInfo:A}=yc(e);o=[0],s=0;for(const b of h){A.index++;const C=Array.from(i(b,A)||"");l&&C.forEach(l.add,l),s+=C.length,o.push(s)}}this.setState({getText:i,startIndices:o,numInstances:s,characterSet:l||r})}transformParagraph(e,r){const{fontAtlasManager:n}=this.state,i=n.mapping,o=this.state.getText,{wordBreak:s,lineHeight:l,maxWidth:h}=this.props,A=o(e,r)||"";return iue(A,l,s,h*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:r,getText:n,fontAtlasManager:{scale:i,atlas:o,mapping:s},styleVersion:l}=this.state,{data:h,_dataDiff:A,getPosition:b,getColor:C,getSize:S,getAngle:D,getPixelOffset:N,getBackgroundColor:U,getBorderColor:V,getBorderWidth:j,backgroundBorderRadius:ee,backgroundPadding:Q,background:X,billboard:pe,fontSettings:Y,outlineWidth:Ge,outlineColor:ze,sizeScale:de,sizeUnits:ce,sizeMinPixels:De,sizeMaxPixels:J,transitions:ue,updateTriggers:Ee}=this.props,ct=this.getSubLayerClass("characters",K_),Ce=this.getSubLayerClass("background",Gg);return[X&&new Ce({getFillColor:U,getLineColor:V,getLineWidth:j,borderRadius:ee,padding:Q,getPosition:b,getSize:S,getAngle:D,getPixelOffset:N,billboard:pe,sizeScale:de,sizeUnits:ce,sizeMinPixels:De,sizeMaxPixels:J,transitions:ue&&{getPosition:ue.getPosition,getAngle:ue.getAngle,getSize:ue.getSize,getFillColor:ue.getBackgroundColor,getLineColor:ue.getBorderColor,getLineWidth:ue.getBorderWidth,getPixelOffset:ue.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getSize:Ee.getSize,getFillColor:Ee.getBackgroundColor,getLineColor:Ee.getBorderColor,getLineWidth:Ee.getBorderWidth,getPixelOffset:Ee.getPixelOffset,getBoundingRect:{getText:Ee.getText,getTextAnchor:Ee.getTextAnchor,getAlignmentBaseline:Ee.getAlignmentBaseline,styleVersion:l}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:A,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new ct({sdf:Y.sdf,smoothing:Number.isFinite(Y.smoothing)?Y.smoothing:Bp.smoothing,outlineWidth:Ge/(Y.radius||Bp.radius),outlineColor:ze,iconAtlas:o,iconMapping:s,getPosition:b,getColor:C,getSize:S,getAngle:D,getPixelOffset:N,billboard:pe,sizeScale:de*i,sizeUnits:ce,sizeMinPixels:De*i,sizeMaxPixels:J*i,transitions:ue&&{getPosition:ue.getPosition,getAngle:ue.getAngle,getColor:ue.getColor,getSize:ue.getSize,getPixelOffset:ue.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ee.getText,getPosition:Ee.getPosition,getAngle:Ee.getAngle,getColor:Ee.getColor,getSize:Ee.getSize,getPixelOffset:Ee.getPixelOffset,getIconOffsets:{getTextAnchor:Ee.getTextAnchor,getAlignmentBaseline:Ee.getAlignmentBaseline,styleVersion:l}}}),{data:h,_dataDiff:A,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){cue(e)}}Af.defaultProps=gue,Af.layerName="TextLayer";const Q0={circle:{type:Ng,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:zp,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Af,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Z0={type:nh,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},wx={type:ih,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function zA({type:t,props:e}){const r={};for(const n in e)r[n]=t.defaultProps[e[n]];return r}function i1(t,e){const{transitions:r,updateTriggers:n}=t.props,i={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(const o in e){const s=e[o];let l=t.props[o];o.startsWith("get")&&(l=t.getSubLayerAccessor(l),i.updateTriggers[s]=n[o],r&&(i.transitions[s]=r[o])),i[s]=l}return i}function mue(t){if(Array.isArray(t))return t;switch($r.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return $r.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function AP(t,e,r={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=t.length}=r;for(let s=i;s<o;s++){const l=t[s],{geometry:h}=l;if(h)if(h.type==="GeometryCollection"){$r.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:A}=h;for(let b=0;b<A.length;b++){const C=A[b];gP(C,n,e,l,s)}}else gP(h,n,e,l,s)}return n}function gP(t,e,r,n,i){const{type:o,coordinates:s}=t,{pointFeatures:l,lineFeatures:h,polygonFeatures:A,polygonOutlineFeatures:b}=e;if(!yue(o,s)){$r.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":l.push(r({geometry:t},n,i));break;case"MultiPoint":s.forEach(C=>{l.push(r({geometry:{type:"Point",coordinates:C}},n,i))});break;case"LineString":h.push(r({geometry:t},n,i));break;case"MultiLineString":s.forEach(C=>{h.push(r({geometry:{type:"LineString",coordinates:C}},n,i))});break;case"Polygon":A.push(r({geometry:t},n,i)),s.forEach(C=>{b.push(r({geometry:{type:"LineString",coordinates:C}},n,i))});break;case"MultiPolygon":s.forEach(C=>{A.push(r({geometry:{type:"Polygon",coordinates:C}},n,i)),C.forEach(S=>{b.push(r({geometry:{type:"LineString",coordinates:S}},n,i))})});break}}const _ue={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function yue(t,e){let r=_ue[t];for($r.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function I8(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function d0(t){return t.geometry.coordinates}function bue(t,e){const r=I8(),{pointFeatures:n,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:s}=t;return r.points.data=n,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=d0,r.lines.data=i,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=d0,r.polygons.data=o,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=d0,r.polygonsOutline.data=s,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=d0,r}function vue(t,e){const r=I8(),{points:n,lines:i,polygons:o}=t,s=Jce(t,e);return r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:s.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines._pathType="open",r.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygons._normalize=!1,o.triangles&&(r.polygons.data.attributes.indices=o.triangles.value),r.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygonsOutline._pathType="open",r}const xue=["points","linestrings","polygons"],wue={...zA(Q0.circle),...zA(Q0.icon),...zA(Q0.text),...zA(Z0),...zA(wx),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class nu extends Bs{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){const n=vue(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:r}){const n=mue(e.data),i=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(r.dataChanged)){const h=this.state.features;for(const A in h)o[A]=h[A].slice(),s[A]=[];for(const A of r.dataChanged){const b=AP(n,i,A);for(const C in h)s[C].push(w8({data:o[C],getIndex:S=>S.__source.index,dataRange:A,replace:b[C]}))}}else o=AP(n,i);const l=bue(o,s);this.setState({features:o,featuresDiff:s,layerProps:l})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n,sourceLayer:i}=r;return r.featureType=xue.find(o=>i.id.startsWith(`${this.id}-${o}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(e){const r=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(r)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:r}=this.props,{layerProps:n}=this.state,i="polygons-fill",o=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,wx.type);if(o){const s=i1(this,wx.props),l=e&&r;return l||delete s.getLineColor,s.updateTriggers.lineColors=l,new o(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:r}=this.props,{layerProps:n}=this.state,i="polygons-stroke",o="linestrings",s=!e&&r&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,Z0.type),l=this.shouldRenderSubLayer(o,n.lines?.data)&&this.getSubLayerClass(o,Z0.type);if(s||l){const h=i1(this,Z0.props);return[s&&new s(h,this.getSubLayerProps({id:i,updateTriggers:h.updateTriggers}),n.polygonsOutline),l&&new l(h,this.getSubLayerProps({id:o,updateTriggers:h.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:r,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=r.points.data.findIndex(l=>l.__source.index===i));const o=new Set(e.split("+")),s=[];for(const l of o){const h=`points-${l}`,A=Q0[l],b=A&&this.shouldRenderSubLayer(h,r.points?.data)&&this.getSubLayerClass(h,A.type);if(b){const C=i1(this,A.props);let S=r.points;if(l==="text"&&n){const{instancePickingColors:D,...N}=S.data.attributes;S={...S,data:{...S.data,attributes:N}}}s.push(new b(C,this.getSubLayerProps({id:h,updateTriggers:C.updateTriggers,highlightedObjectIndex:i}),S))}}return s}renderLayers(){const{extruded:e}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&r,n,i,e&&r]}getSubLayerAccessor(e){const{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:o,index:s}=i,l=Vce(o,s);return e(l,i)}}}nu.layerName="GeoJsonLayer",nu.defaultProps=wue;const Cue=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:Dg,BitmapLayer:H_,ColumnLayer:Ac,GeoJsonLayer:nu,GridCellLayer:xx,IconLayer:zp,LineLayer:V_,PathLayer:nh,PointCloudLayer:kg,PolygonLayer:sh,ScatterplotLayer:Ng,SolidPolygonLayer:ih,TextLayer:Af,_MultiIconLayer:K_,_TextBackgroundLayer:Gg},Symbol.toStringTag,{value:"Module"}));function Eue(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function Cx(t){if(Array.isArray(t))return t.map(e=>Cx(e));if(t&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[Eue(r)]=Cx(n);return e}return t}var s1={},mP={},_P;function zC(){return _P||(_P=1,(function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+e+"]["+r+"]*",i=new RegExp("^"+n+"$"),o=function(l,h){const A=[];let b=h.exec(l);for(;b;){const C=[];C.startIndex=h.lastIndex-b[0].length;const S=b.length;for(let D=0;D<S;D++)C.push(b[D]);A.push(C),b=h.exec(l)}return A},s=function(l){const h=i.exec(l);return!(h===null||typeof h>"u")};t.isExist=function(l){return typeof l<"u"},t.isEmptyObject=function(l){return Object.keys(l).length===0},t.merge=function(l,h,A){if(h){const b=Object.keys(h),C=b.length;for(let S=0;S<C;S++)A==="strict"?l[b[S]]=[h[b[S]]]:l[b[S]]=h[b[S]]}},t.getValue=function(l){return t.isExist(l)?l:""},t.isName=s,t.getAllMatches=o,t.nameRegexp=n})(mP)),mP}var yP;function M8(){if(yP)return s1;yP=1;const t=zC(),e={allowBooleanAttributes:!1,unpairedTags:[]};s1.validate=function(j,ee){ee=Object.assign({},e,ee);const Q=[];let X=!1,pe=!1;j[0]==="\uFEFF"&&(j=j.substr(1));for(let Y=0;Y<j.length;Y++)if(j[Y]==="<"&&j[Y+1]==="?"){if(Y+=2,Y=n(j,Y),Y.err)return Y}else if(j[Y]==="<"){let Ge=Y;if(Y++,j[Y]==="!"){Y=i(j,Y);continue}else{let ze=!1;j[Y]==="/"&&(ze=!0,Y++);let de="";for(;Y<j.length&&j[Y]!==">"&&j[Y]!==" "&&j[Y]!=="	"&&j[Y]!==`
`&&j[Y]!=="\r";Y++)de+=j[Y];if(de=de.trim(),de[de.length-1]==="/"&&(de=de.substring(0,de.length-1),Y--),!N(de)){let J;return de.trim().length===0?J="Invalid space after '<'.":J="Tag '"+de+"' is an invalid name.",S("InvalidTag",J,U(j,Y))}const ce=l(j,Y);if(ce===!1)return S("InvalidAttr","Attributes for '"+de+"' have open quote.",U(j,Y));let De=ce.value;if(Y=ce.index,De[De.length-1]==="/"){const J=Y-De.length;De=De.substring(0,De.length-1);const ue=A(De,ee);if(ue===!0)X=!0;else return S(ue.err.code,ue.err.msg,U(j,J+ue.err.line))}else if(ze)if(ce.tagClosed){if(De.trim().length>0)return S("InvalidTag","Closing tag '"+de+"' can't have attributes or invalid starting.",U(j,Ge));if(Q.length===0)return S("InvalidTag","Closing tag '"+de+"' has not been opened.",U(j,Ge));{const J=Q.pop();if(de!==J.tagName){let ue=U(j,J.tagStartPos);return S("InvalidTag","Expected closing tag '"+J.tagName+"' (opened in line "+ue.line+", col "+ue.col+") instead of closing tag '"+de+"'.",U(j,Ge))}Q.length==0&&(pe=!0)}}else return S("InvalidTag","Closing tag '"+de+"' doesn't have proper closing.",U(j,Y));else{const J=A(De,ee);if(J!==!0)return S(J.err.code,J.err.msg,U(j,Y-De.length+J.err.line));if(pe===!0)return S("InvalidXml","Multiple possible root nodes found.",U(j,Y));ee.unpairedTags.indexOf(de)!==-1||Q.push({tagName:de,tagStartPos:Ge}),X=!0}for(Y++;Y<j.length;Y++)if(j[Y]==="<")if(j[Y+1]==="!"){Y++,Y=i(j,Y);continue}else if(j[Y+1]==="?"){if(Y=n(j,++Y),Y.err)return Y}else break;else if(j[Y]==="&"){const J=C(j,Y);if(J==-1)return S("InvalidChar","char '&' is not expected.",U(j,Y));Y=J}else if(pe===!0&&!r(j[Y]))return S("InvalidXml","Extra text at the end",U(j,Y));j[Y]==="<"&&Y--}}else{if(r(j[Y]))continue;return S("InvalidChar","char '"+j[Y]+"' is not expected.",U(j,Y))}if(X){if(Q.length==1)return S("InvalidTag","Unclosed tag '"+Q[0].tagName+"'.",U(j,Q[0].tagStartPos));if(Q.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(Q.map(Y=>Y.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function r(j){return j===" "||j==="	"||j===`
`||j==="\r"}function n(j,ee){const Q=ee;for(;ee<j.length;ee++)if(j[ee]=="?"||j[ee]==" "){const X=j.substr(Q,ee-Q);if(ee>5&&X==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",U(j,ee));if(j[ee]=="?"&&j[ee+1]==">"){ee++;break}else continue}return ee}function i(j,ee){if(j.length>ee+5&&j[ee+1]==="-"&&j[ee+2]==="-"){for(ee+=3;ee<j.length;ee++)if(j[ee]==="-"&&j[ee+1]==="-"&&j[ee+2]===">"){ee+=2;break}}else if(j.length>ee+8&&j[ee+1]==="D"&&j[ee+2]==="O"&&j[ee+3]==="C"&&j[ee+4]==="T"&&j[ee+5]==="Y"&&j[ee+6]==="P"&&j[ee+7]==="E"){let Q=1;for(ee+=8;ee<j.length;ee++)if(j[ee]==="<")Q++;else if(j[ee]===">"&&(Q--,Q===0))break}else if(j.length>ee+9&&j[ee+1]==="["&&j[ee+2]==="C"&&j[ee+3]==="D"&&j[ee+4]==="A"&&j[ee+5]==="T"&&j[ee+6]==="A"&&j[ee+7]==="["){for(ee+=8;ee<j.length;ee++)if(j[ee]==="]"&&j[ee+1]==="]"&&j[ee+2]===">"){ee+=2;break}}return ee}const o='"',s="'";function l(j,ee){let Q="",X="",pe=!1;for(;ee<j.length;ee++){if(j[ee]===o||j[ee]===s)X===""?X=j[ee]:X!==j[ee]||(X="");else if(j[ee]===">"&&X===""){pe=!0;break}Q+=j[ee]}return X!==""?!1:{value:Q,index:ee,tagClosed:pe}}const h=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function A(j,ee){const Q=t.getAllMatches(j,h),X={};for(let pe=0;pe<Q.length;pe++){if(Q[pe][1].length===0)return S("InvalidAttr","Attribute '"+Q[pe][2]+"' has no space in starting.",V(Q[pe]));if(Q[pe][3]!==void 0&&Q[pe][4]===void 0)return S("InvalidAttr","Attribute '"+Q[pe][2]+"' is without value.",V(Q[pe]));if(Q[pe][3]===void 0&&!ee.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+Q[pe][2]+"' is not allowed.",V(Q[pe]));const Y=Q[pe][2];if(!D(Y))return S("InvalidAttr","Attribute '"+Y+"' is an invalid name.",V(Q[pe]));if(!X.hasOwnProperty(Y))X[Y]=1;else return S("InvalidAttr","Attribute '"+Y+"' is repeated.",V(Q[pe]))}return!0}function b(j,ee){let Q=/\d/;for(j[ee]==="x"&&(ee++,Q=/[\da-fA-F]/);ee<j.length;ee++){if(j[ee]===";")return ee;if(!j[ee].match(Q))break}return-1}function C(j,ee){if(ee++,j[ee]===";")return-1;if(j[ee]==="#")return ee++,b(j,ee);let Q=0;for(;ee<j.length;ee++,Q++)if(!(j[ee].match(/\w/)&&Q<20)){if(j[ee]===";")break;return-1}return ee}function S(j,ee,Q){return{err:{code:j,msg:ee,line:Q.line||Q,col:Q.col}}}function D(j){return t.isName(j)}function N(j){return t.isName(j)}function U(j,ee){const Q=j.substring(0,ee).split(/\r?\n/);return{line:Q.length,col:Q[Q.length-1].length+1}}function V(j){return j.startIndex+j[1].length}return s1}var p0={},bP;function Bue(){if(bP)return p0;bP=1;const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,n){return n},attributeValueProcessor:function(r,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,n,i){return r}},e=function(r){return Object.assign({},t,r)};return p0.buildOptions=e,p0.defaultOptions=t,p0}var o1,vP;function Tue(){if(vP)return o1;vP=1;class t{constructor(r){this.tagname=r,this.child=[],this[":@"]={}}add(r,n){r==="__proto__"&&(r="#__proto__"),this.child.push({[r]:n})}addChild(r){r.tagname==="__proto__"&&(r.tagname="#__proto__"),r[":@"]&&Object.keys(r[":@"]).length>0?this.child.push({[r.tagname]:r.child,":@":r[":@"]}):this.child.push({[r.tagname]:r.child})}}return o1=t,o1}var a1,xP;function Sue(){if(xP)return a1;xP=1;const t=zC();function e(A,b){const C={};if(A[b+3]==="O"&&A[b+4]==="C"&&A[b+5]==="T"&&A[b+6]==="Y"&&A[b+7]==="P"&&A[b+8]==="E"){b=b+9;let S=1,D=!1,N=!1,U="";for(;b<A.length;b++)if(A[b]==="<"&&!N){if(D&&i(A,b))b+=7,[entityName,val,b]=r(A,b+1),val.indexOf("&")===-1&&(C[h(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(D&&o(A,b))b+=8;else if(D&&s(A,b))b+=8;else if(D&&l(A,b))b+=9;else if(n)N=!0;else throw new Error("Invalid DOCTYPE");S++,U=""}else if(A[b]===">"){if(N?A[b-1]==="-"&&A[b-2]==="-"&&(N=!1,S--):S--,S===0)break}else A[b]==="["?D=!0:U+=A[b];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:C,i:b}}function r(A,b){let C="";for(;b<A.length&&A[b]!=="'"&&A[b]!=='"';b++)C+=A[b];if(C=C.trim(),C.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=A[b++];let D="";for(;b<A.length&&A[b]!==S;b++)D+=A[b];return[C,D,b]}function n(A,b){return A[b+1]==="!"&&A[b+2]==="-"&&A[b+3]==="-"}function i(A,b){return A[b+1]==="!"&&A[b+2]==="E"&&A[b+3]==="N"&&A[b+4]==="T"&&A[b+5]==="I"&&A[b+6]==="T"&&A[b+7]==="Y"}function o(A,b){return A[b+1]==="!"&&A[b+2]==="E"&&A[b+3]==="L"&&A[b+4]==="E"&&A[b+5]==="M"&&A[b+6]==="E"&&A[b+7]==="N"&&A[b+8]==="T"}function s(A,b){return A[b+1]==="!"&&A[b+2]==="A"&&A[b+3]==="T"&&A[b+4]==="T"&&A[b+5]==="L"&&A[b+6]==="I"&&A[b+7]==="S"&&A[b+8]==="T"}function l(A,b){return A[b+1]==="!"&&A[b+2]==="N"&&A[b+3]==="O"&&A[b+4]==="T"&&A[b+5]==="A"&&A[b+6]==="T"&&A[b+7]==="I"&&A[b+8]==="O"&&A[b+9]==="N"}function h(A){if(t.isName(A))return A;throw new Error(`Invalid entity name ${A}`)}return a1=e,a1}var l1,wP;function Iue(){if(wP)return l1;wP=1;const t=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const r={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(o,s={}){if(s=Object.assign({},r,s),!o||typeof o!="string")return o;let l=o.trim();if(s.skipLike!==void 0&&s.skipLike.test(l))return o;if(s.hex&&t.test(l))return Number.parseInt(l,16);{const h=e.exec(l);if(h){const A=h[1],b=h[2];let C=i(h[3]);const S=h[4]||h[6];if(!s.leadingZeros&&b.length>0&&A&&l[2]!=="."||!s.leadingZeros&&b.length>0&&!A&&l[1]!==".")return o;{const D=Number(l),N=""+D;return N.search(/[eE]/)!==-1||S?s.eNotation?D:o:l.indexOf(".")!==-1?N==="0"&&C===""||N===C||A&&N==="-"+C?D:o:b?C===N||A+C===N?D:o:l===N||l===A+N?D:o}}else return o}}function i(o){return o&&o.indexOf(".")!==-1&&(o=o.replace(/0+$/,""),o==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o}return l1=n,l1}var c1,CP;function Mue(){if(CP)return c1;CP=1;const t=zC(),e=Tue(),r=Sue(),n=Iue();class i{constructor(pe){this.options=pe,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(Y,Ge)=>String.fromCharCode(Number.parseInt(Ge,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(Y,Ge)=>String.fromCharCode(Number.parseInt(Ge,16))}},this.addExternalEntities=o,this.parseXml=b,this.parseTextData=s,this.resolveNameSpace=l,this.buildAttributesMap=A,this.isItStopNode=N,this.replaceEntitiesValue=S,this.readStopNodeData=ee,this.saveTextToParentTag=D,this.addChild=C}}function o(X){const pe=Object.keys(X);for(let Y=0;Y<pe.length;Y++){const Ge=pe[Y];this.lastEntities[Ge]={regex:new RegExp("&"+Ge+";","g"),val:X[Ge]}}}function s(X,pe,Y,Ge,ze,de,ce){if(X!==void 0&&(this.options.trimValues&&!Ge&&(X=X.trim()),X.length>0)){ce||(X=this.replaceEntitiesValue(X));const De=this.options.tagValueProcessor(pe,X,Y,ze,de);return De==null?X:typeof De!=typeof X||De!==X?De:this.options.trimValues?Q(X,this.options.parseTagValue,this.options.numberParseOptions):X.trim()===X?Q(X,this.options.parseTagValue,this.options.numberParseOptions):X}}function l(X){if(this.options.removeNSPrefix){const pe=X.split(":"),Y=X.charAt(0)==="/"?"/":"";if(pe[0]==="xmlns")return"";pe.length===2&&(X=Y+pe[1])}return X}const h=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function A(X,pe,Y){if(!this.options.ignoreAttributes&&typeof X=="string"){const Ge=t.getAllMatches(X,h),ze=Ge.length,de={};for(let ce=0;ce<ze;ce++){const De=this.resolveNameSpace(Ge[ce][1]);let J=Ge[ce][4],ue=this.options.attributeNamePrefix+De;if(De.length)if(this.options.transformAttributeName&&(ue=this.options.transformAttributeName(ue)),ue==="__proto__"&&(ue="#__proto__"),J!==void 0){this.options.trimValues&&(J=J.trim()),J=this.replaceEntitiesValue(J);const Ee=this.options.attributeValueProcessor(De,J,pe);Ee==null?de[ue]=J:typeof Ee!=typeof J||Ee!==J?de[ue]=Ee:de[ue]=Q(J,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(de[ue]=!0)}if(!Object.keys(de).length)return;if(this.options.attributesGroupName){const ce={};return ce[this.options.attributesGroupName]=de,ce}return de}}const b=function(X){X=X.replace(/\r\n?/g,`
`);const pe=new e("!xml");let Y=pe,Ge="",ze="";for(let de=0;de<X.length;de++)if(X[de]==="<")if(X[de+1]==="/"){const ce=V(X,">",de,"Closing Tag is not closed.");let De=X.substring(de+2,ce).trim();if(this.options.removeNSPrefix){const Ee=De.indexOf(":");Ee!==-1&&(De=De.substr(Ee+1))}this.options.transformTagName&&(De=this.options.transformTagName(De)),Y&&(Ge=this.saveTextToParentTag(Ge,Y,ze));const J=ze.substring(ze.lastIndexOf(".")+1);if(De&&this.options.unpairedTags.indexOf(De)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${De}>`);let ue=0;J&&this.options.unpairedTags.indexOf(J)!==-1?(ue=ze.lastIndexOf(".",ze.lastIndexOf(".")-1),this.tagsNodeStack.pop()):ue=ze.lastIndexOf("."),ze=ze.substring(0,ue),Y=this.tagsNodeStack.pop(),Ge="",de=ce}else if(X[de+1]==="?"){let ce=j(X,de,!1,"?>");if(!ce)throw new Error("Pi Tag is not closed.");if(Ge=this.saveTextToParentTag(Ge,Y,ze),!(this.options.ignoreDeclaration&&ce.tagName==="?xml"||this.options.ignorePiTags)){const De=new e(ce.tagName);De.add(this.options.textNodeName,""),ce.tagName!==ce.tagExp&&ce.attrExpPresent&&(De[":@"]=this.buildAttributesMap(ce.tagExp,ze,ce.tagName)),this.addChild(Y,De,ze)}de=ce.closeIndex+1}else if(X.substr(de+1,3)==="!--"){const ce=V(X,"-->",de+4,"Comment is not closed.");if(this.options.commentPropName){const De=X.substring(de+4,ce-2);Ge=this.saveTextToParentTag(Ge,Y,ze),Y.add(this.options.commentPropName,[{[this.options.textNodeName]:De}])}de=ce}else if(X.substr(de+1,2)==="!D"){const ce=r(X,de);this.docTypeEntities=ce.entities,de=ce.i}else if(X.substr(de+1,2)==="!["){const ce=V(X,"]]>",de,"CDATA is not closed.")-2,De=X.substring(de+9,ce);Ge=this.saveTextToParentTag(Ge,Y,ze);let J=this.parseTextData(De,Y.tagname,ze,!0,!1,!0,!0);J==null&&(J=""),this.options.cdataPropName?Y.add(this.options.cdataPropName,[{[this.options.textNodeName]:De}]):Y.add(this.options.textNodeName,J),de=ce+2}else{let ce=j(X,de,this.options.removeNSPrefix),De=ce.tagName;const J=ce.rawTagName;let ue=ce.tagExp,Ee=ce.attrExpPresent,ct=ce.closeIndex;this.options.transformTagName&&(De=this.options.transformTagName(De)),Y&&Ge&&Y.tagname!=="!xml"&&(Ge=this.saveTextToParentTag(Ge,Y,ze,!1));const Ce=Y;if(Ce&&this.options.unpairedTags.indexOf(Ce.tagname)!==-1&&(Y=this.tagsNodeStack.pop(),ze=ze.substring(0,ze.lastIndexOf("."))),De!==pe.tagname&&(ze+=ze?"."+De:De),this.isItStopNode(this.options.stopNodes,ze,De)){let Le="";if(ue.length>0&&ue.lastIndexOf("/")===ue.length-1)De[De.length-1]==="/"?(De=De.substr(0,De.length-1),ze=ze.substr(0,ze.length-1),ue=De):ue=ue.substr(0,ue.length-1),de=ce.closeIndex;else if(this.options.unpairedTags.indexOf(De)!==-1)de=ce.closeIndex;else{const $e=this.readStopNodeData(X,J,ct+1);if(!$e)throw new Error(`Unexpected end of ${J}`);de=$e.i,Le=$e.tagContent}const Ne=new e(De);De!==ue&&Ee&&(Ne[":@"]=this.buildAttributesMap(ue,ze,De)),Le&&(Le=this.parseTextData(Le,De,ze,!0,Ee,!0,!0)),ze=ze.substr(0,ze.lastIndexOf(".")),Ne.add(this.options.textNodeName,Le),this.addChild(Y,Ne,ze)}else{if(ue.length>0&&ue.lastIndexOf("/")===ue.length-1){De[De.length-1]==="/"?(De=De.substr(0,De.length-1),ze=ze.substr(0,ze.length-1),ue=De):ue=ue.substr(0,ue.length-1),this.options.transformTagName&&(De=this.options.transformTagName(De));const Le=new e(De);De!==ue&&Ee&&(Le[":@"]=this.buildAttributesMap(ue,ze,De)),this.addChild(Y,Le,ze),ze=ze.substr(0,ze.lastIndexOf("."))}else{const Le=new e(De);this.tagsNodeStack.push(Y),De!==ue&&Ee&&(Le[":@"]=this.buildAttributesMap(ue,ze,De)),this.addChild(Y,Le,ze),Y=Le}Ge="",de=ct}}else Ge+=X[de];return pe.child};function C(X,pe,Y){const Ge=this.options.updateTag(pe.tagname,Y,pe[":@"]);Ge===!1||(typeof Ge=="string"&&(pe.tagname=Ge),X.addChild(pe))}const S=function(X){if(this.options.processEntities){for(let pe in this.docTypeEntities){const Y=this.docTypeEntities[pe];X=X.replace(Y.regx,Y.val)}for(let pe in this.lastEntities){const Y=this.lastEntities[pe];X=X.replace(Y.regex,Y.val)}if(this.options.htmlEntities)for(let pe in this.htmlEntities){const Y=this.htmlEntities[pe];X=X.replace(Y.regex,Y.val)}X=X.replace(this.ampEntity.regex,this.ampEntity.val)}return X};function D(X,pe,Y,Ge){return X&&(Ge===void 0&&(Ge=Object.keys(pe.child).length===0),X=this.parseTextData(X,pe.tagname,Y,!1,pe[":@"]?Object.keys(pe[":@"]).length!==0:!1,Ge),X!==void 0&&X!==""&&pe.add(this.options.textNodeName,X),X=""),X}function N(X,pe,Y){const Ge="*."+Y;for(const ze in X){const de=X[ze];if(Ge===de||pe===de)return!0}return!1}function U(X,pe,Y=">"){let Ge,ze="";for(let de=pe;de<X.length;de++){let ce=X[de];if(Ge)ce===Ge&&(Ge="");else if(ce==='"'||ce==="'")Ge=ce;else if(ce===Y[0])if(Y[1]){if(X[de+1]===Y[1])return{data:ze,index:de}}else return{data:ze,index:de};else ce==="	"&&(ce=" ");ze+=ce}}function V(X,pe,Y,Ge){const ze=X.indexOf(pe,Y);if(ze===-1)throw new Error(Ge);return ze+pe.length-1}function j(X,pe,Y,Ge=">"){const ze=U(X,pe+1,Ge);if(!ze)return;let de=ze.data;const ce=ze.index,De=de.search(/\s/);let J=de,ue=!0;De!==-1&&(J=de.substring(0,De),de=de.substring(De+1).trimStart());const Ee=J;if(Y){const ct=J.indexOf(":");ct!==-1&&(J=J.substr(ct+1),ue=J!==ze.data.substr(ct+1))}return{tagName:J,tagExp:de,closeIndex:ce,attrExpPresent:ue,rawTagName:Ee}}function ee(X,pe,Y){const Ge=Y;let ze=1;for(;Y<X.length;Y++)if(X[Y]==="<")if(X[Y+1]==="/"){const de=V(X,">",Y,`${pe} is not closed`);if(X.substring(Y+2,de).trim()===pe&&(ze--,ze===0))return{tagContent:X.substring(Ge,Y),i:de};Y=de}else if(X[Y+1]==="?")Y=V(X,"?>",Y+1,"StopNode is not closed.");else if(X.substr(Y+1,3)==="!--")Y=V(X,"-->",Y+3,"StopNode is not closed.");else if(X.substr(Y+1,2)==="![")Y=V(X,"]]>",Y,"StopNode is not closed.")-2;else{const de=j(X,Y,">");de&&((de&&de.tagName)===pe&&de.tagExp[de.tagExp.length-1]!=="/"&&ze++,Y=de.closeIndex)}}function Q(X,pe,Y){if(pe&&typeof X=="string"){const Ge=X.trim();return Ge==="true"?!0:Ge==="false"?!1:n(X,Y)}else return t.isExist(X)?X:""}return c1=i,c1}var u1={},EP;function Pue(){if(EP)return u1;EP=1;function t(o,s){return e(o,s)}function e(o,s,l){let h;const A={};for(let b=0;b<o.length;b++){const C=o[b],S=r(C);let D="";if(l===void 0?D=S:D=l+"."+S,S===s.textNodeName)h===void 0?h=C[S]:h+=""+C[S];else{if(S===void 0)continue;if(C[S]){let N=e(C[S],s,D);const U=i(N,s);C[":@"]?n(N,C[":@"],D,s):Object.keys(N).length===1&&N[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?N=N[s.textNodeName]:Object.keys(N).length===0&&(s.alwaysCreateTextNode?N[s.textNodeName]="":N=""),A[S]!==void 0&&A.hasOwnProperty(S)?(Array.isArray(A[S])||(A[S]=[A[S]]),A[S].push(N)):s.isArray(S,D,U)?A[S]=[N]:A[S]=N}}}return typeof h=="string"?h.length>0&&(A[s.textNodeName]=h):h!==void 0&&(A[s.textNodeName]=h),A}function r(o){const s=Object.keys(o);for(let l=0;l<s.length;l++){const h=s[l];if(h!==":@")return h}}function n(o,s,l,h){if(s){const A=Object.keys(s),b=A.length;for(let C=0;C<b;C++){const S=A[C];h.isArray(S,l+"."+S,!0,!0)?o[S]=[s[S]]:o[S]=s[S]}}}function i(o,s){const{textNodeName:l}=s,h=Object.keys(o).length;return!!(h===0||h===1&&(o[l]||typeof o[l]=="boolean"||o[l]===0))}return u1.prettify=t,u1}var h1,BP;function Lue(){if(BP)return h1;BP=1;const{buildOptions:t}=Bue(),e=Mue(),{prettify:r}=Pue(),n=M8();class i{constructor(s){this.externalEntities={},this.options=t(s)}parse(s,l){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(l){l===!0&&(l={});const b=n.validate(s,l);if(b!==!0)throw Error(`${b.err.msg}:${b.err.line}:${b.err.col}`)}const h=new e(this.options);h.addExternalEntities(this.externalEntities);const A=h.parseXml(s);return this.options.preserveOrder||A===void 0?A:r(A,this.options)}addEntity(s,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=l}}return h1=i,h1}var f1,TP;function Rue(){if(TP)return f1;TP=1;const t=`
`;function e(l,h){let A="";return h.format&&h.indentBy.length>0&&(A=t),r(l,h,"",A)}function r(l,h,A,b){let C="",S=!1;for(let D=0;D<l.length;D++){const N=l[D],U=n(N);if(U===void 0)continue;let V="";if(A.length===0?V=U:V=`${A}.${U}`,U===h.textNodeName){let pe=N[U];o(V,h)||(pe=h.tagValueProcessor(U,pe),pe=s(pe,h)),S&&(C+=b),C+=pe,S=!1;continue}else if(U===h.cdataPropName){S&&(C+=b),C+=`<![CDATA[${N[U][0][h.textNodeName]}]]>`,S=!1;continue}else if(U===h.commentPropName){C+=b+`<!--${N[U][0][h.textNodeName]}-->`,S=!0;continue}else if(U[0]==="?"){const pe=i(N[":@"],h),Y=U==="?xml"?"":b;let Ge=N[U][0][h.textNodeName];Ge=Ge.length!==0?" "+Ge:"",C+=Y+`<${U}${Ge}${pe}?>`,S=!0;continue}let j=b;j!==""&&(j+=h.indentBy);const ee=i(N[":@"],h),Q=b+`<${U}${ee}`,X=r(N[U],h,V,j);h.unpairedTags.indexOf(U)!==-1?h.suppressUnpairedNode?C+=Q+">":C+=Q+"/>":(!X||X.length===0)&&h.suppressEmptyNode?C+=Q+"/>":X&&X.endsWith(">")?C+=Q+`>${X}${b}</${U}>`:(C+=Q+">",X&&b!==""&&(X.includes("/>")||X.includes("</"))?C+=b+h.indentBy+X+b:C+=X,C+=`</${U}>`),S=!0}return C}function n(l){const h=Object.keys(l);for(let A=0;A<h.length;A++){const b=h[A];if(l.hasOwnProperty(b)&&b!==":@")return b}}function i(l,h){let A="";if(l&&!h.ignoreAttributes)for(let b in l){if(!l.hasOwnProperty(b))continue;let C=h.attributeValueProcessor(b,l[b]);C=s(C,h),C===!0&&h.suppressBooleanAttributes?A+=` ${b.substr(h.attributeNamePrefix.length)}`:A+=` ${b.substr(h.attributeNamePrefix.length)}="${C}"`}return A}function o(l,h){l=l.substr(0,l.length-h.textNodeName.length-1);let A=l.substr(l.lastIndexOf(".")+1);for(let b in h.stopNodes)if(h.stopNodes[b]===l||h.stopNodes[b]==="*."+A)return!0;return!1}function s(l,h){if(l&&l.length>0&&h.processEntities)for(let A=0;A<h.entities.length;A++){const b=h.entities[A];l=l.replace(b.regex,b.val)}return l}return f1=e,f1}var d1,SP;function Oue(){if(SP)return d1;SP=1;const t=Rue(),e={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,l){return l},attributeValueProcessor:function(s,l){return l},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function r(s){this.options=Object.assign({},e,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=o),this.processTextOrObjNode=n,this.options.format?(this.indentate=i,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}r.prototype.build=function(s){return this.options.preserveOrder?t(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)},r.prototype.j2x=function(s,l){let h="",A="";for(let b in s)if(Object.prototype.hasOwnProperty.call(s,b))if(typeof s[b]>"u")this.isAttribute(b)&&(A+="");else if(s[b]===null)this.isAttribute(b)?A+="":b[0]==="?"?A+=this.indentate(l)+"<"+b+"?"+this.tagEndChar:A+=this.indentate(l)+"<"+b+"/"+this.tagEndChar;else if(s[b]instanceof Date)A+=this.buildTextValNode(s[b],b,"",l);else if(typeof s[b]!="object"){const C=this.isAttribute(b);if(C)h+=this.buildAttrPairStr(C,""+s[b]);else if(b===this.options.textNodeName){let S=this.options.tagValueProcessor(b,""+s[b]);A+=this.replaceEntitiesValue(S)}else A+=this.buildTextValNode(s[b],b,"",l)}else if(Array.isArray(s[b])){const C=s[b].length;let S="",D="";for(let N=0;N<C;N++){const U=s[b][N];if(!(typeof U>"u"))if(U===null)b[0]==="?"?A+=this.indentate(l)+"<"+b+"?"+this.tagEndChar:A+=this.indentate(l)+"<"+b+"/"+this.tagEndChar;else if(typeof U=="object")if(this.options.oneListGroup){const V=this.j2x(U,l+1);S+=V.val,this.options.attributesGroupName&&U.hasOwnProperty(this.options.attributesGroupName)&&(D+=V.attrStr)}else S+=this.processTextOrObjNode(U,b,l);else if(this.options.oneListGroup){let V=this.options.tagValueProcessor(b,U);V=this.replaceEntitiesValue(V),S+=V}else S+=this.buildTextValNode(U,b,"",l)}this.options.oneListGroup&&(S=this.buildObjectNode(S,b,D,l)),A+=S}else if(this.options.attributesGroupName&&b===this.options.attributesGroupName){const C=Object.keys(s[b]),S=C.length;for(let D=0;D<S;D++)h+=this.buildAttrPairStr(C[D],""+s[b][C[D]])}else A+=this.processTextOrObjNode(s[b],b,l);return{attrStr:h,val:A}},r.prototype.buildAttrPairStr=function(s,l){return l=this.options.attributeValueProcessor(s,""+l),l=this.replaceEntitiesValue(l),this.options.suppressBooleanAttributes&&l==="true"?" "+s:" "+s+'="'+l+'"'};function n(s,l,h){const A=this.j2x(s,h+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],l,A.attrStr,h):this.buildObjectNode(A.val,l,A.attrStr,h)}r.prototype.buildObjectNode=function(s,l,h,A){if(s==="")return l[0]==="?"?this.indentate(A)+"<"+l+h+"?"+this.tagEndChar:this.indentate(A)+"<"+l+h+this.closeTag(l)+this.tagEndChar;{let b="</"+l+this.tagEndChar,C="";return l[0]==="?"&&(C="?",b=""),(h||h==="")&&s.indexOf("<")===-1?this.indentate(A)+"<"+l+h+C+">"+s+b:this.options.commentPropName!==!1&&l===this.options.commentPropName&&C.length===0?this.indentate(A)+`<!--${s}-->`+this.newLine:this.indentate(A)+"<"+l+h+C+this.tagEndChar+s+this.indentate(A)+b}},r.prototype.closeTag=function(s){let l="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(l="/"):this.options.suppressEmptyNode?l="/":l=`></${s}`,l},r.prototype.buildTextValNode=function(s,l,h,A){if(this.options.cdataPropName!==!1&&l===this.options.cdataPropName)return this.indentate(A)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&l===this.options.commentPropName)return this.indentate(A)+`<!--${s}-->`+this.newLine;if(l[0]==="?")return this.indentate(A)+"<"+l+h+"?"+this.tagEndChar;{let b=this.options.tagValueProcessor(l,s);return b=this.replaceEntitiesValue(b),b===""?this.indentate(A)+"<"+l+h+this.closeTag(l)+this.tagEndChar:this.indentate(A)+"<"+l+h+">"+b+"</"+l+this.tagEndChar}},r.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let l=0;l<this.options.entities.length;l++){const h=this.options.entities[l];s=s.replace(h.regex,h.val)}return s};function i(s){return this.options.indentBy.repeat(s)}function o(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}return d1=r,d1}var p1,IP;function Due(){if(IP)return p1;IP=1;const t=M8(),e=Lue(),r=Oue();return p1={XMLParser:e,XMLValidator:t,XMLBuilder:r},p1}var Fue=Due();function MP(t,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);const r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(i,o,s,l)=>!!e?.arrayPaths?.some(h=>o===h),...e?._fastXML},n=kue(t,r);return e?.uncapitalizeKeys?Cx(n):n}function kue(t,e){return new Fue.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}const Nue="4.3.1",jp={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Nue,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Uue,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>MP(new TextDecoder().decode(t),{...jp.options.xml,...e?.xml}),parseTextSync:(t,e)=>MP(t,{...jp.options.xml,...e?.xml})};function Uue(t){return t.startsWith("<?xml")}async function Tf(t,e,r,n){return n._parse(t,e,r,n)}function Ai(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const P8=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),PP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);PP&&parseFloat(PP[1]);function Gue(t,e){return L8(t||{},e)}function L8(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=L8(n[i]||{},e[i],r+1):n[i]=e[i];return n}function zue(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function jue(t){return globalThis.loaders?.modules?.[t]||null}function Hue(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const Vue=Hue();function Wue(t,e){if(!t)throw new Error("loaders.gl assertion failed.")}const Yg=typeof process!="object"||String(process)!=="[object process]"||process.browser,jC=typeof importScripts=="function",LP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);LP&&parseFloat(LP[1]);const A1={};async function cf(t,e=null,r={},n=null){return e&&(t=Jue(t,e,r,n)),A1[t]=A1[t]||Kue(t),await A1[t]}function Jue(t,e,r={},n=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const i=r.modules||{};return i[n]?i[n]:Yg?r.CDN?(Wue(r.CDN.startsWith("http")),`${r.CDN}/${e}@${Vue}/dist/libs/${n}`):jC?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function Kue(t){if(t.endsWith("wasm"))return await Que(t);if(!Yg)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(jC)return importScripts(t);const e=await Zue(t);return Xue(e,t)}function Xue(t,e){if(!Yg){const{requireFromString:n}=globalThis.loaders||{};return n?.(t,e)}if(jC)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function Que(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Yg||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function Zue(t){const{readFileAsText:e}=globalThis.loaders||{};return Yg||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function $ue(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?RP(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?RP(t,0,e):""}function RP(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function R8(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${$ue(t)}"`)}}function em(t,e,r){const n=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function au(t,e){return Ai(t>=0),Ai(e>0),t+(e-1)&-4}function O8(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const i=t.byteOffset,o=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,o)}return e.set(n,r),r+au(n.byteLength,4)}const que="Queued Requests",Yue="Active Requests",ehe="Cancelled Requests",the="Queued Requests Ever",rhe="Active Requests Ever",nhe={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class D8{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...nhe,...e},this.stats=new Y6({id:this.props.id}),this.stats.get(que),this.stats.get(Yue),this.stats.get(ehe),this.stats.get(the),this.stats.get(rhe)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:r},i=new Promise(o=>(n.resolve=o,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:r,resolve:n}=e;let i=!1;const o=()=>{i||(i=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let r=0;r<e.length;++r){const n=e[r];this._updateRequest(n)||(e.splice(r,1),this.requestMap.delete(n.handle),r--)}e.sort((r,n)=>r.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function ihe(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function F8(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function she(...t){const e=[];for(let o=0;o<t.length;o++)e[o]=t[o];let r="",n=!1,i;for(let o=e.length-1;o>=-1&&!n;o--){let s;o>=0?s=e[o]:(i===void 0&&(i=ihe()),s=i),s.length!==0&&(r=`${s}/${r}`,n=s.charCodeAt(0)===tg)}return r=ohe(r,!n),n?`/${r}`:r.length>0?r:"."}const tg=47,g1=46;function ohe(t,e){let r="",n=-1,i=0,o,s=!1;for(let l=0;l<=t.length;++l){if(l<t.length)o=t.charCodeAt(l);else{if(o===tg)break;o=tg}if(o===tg){if(!(n===l-1||i===1))if(n!==l-1&&i===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==g1||r.charCodeAt(r.length-2)!==g1){if(r.length>2){const h=r.length-1;let A=h;for(;A>=0&&r.charCodeAt(A)!==tg;--A);if(A!==h){r=A===-1?"":r.slice(0,A),n=l,i=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=l,i=0,s=!1;continue}}e&&(r.length>0?r+="/..":r="..",s=!0)}else{const h=t.slice(n+1,l);r.length>0?r+=`/${h}`:r=h,s=!1}n=l,i=0}else o===g1&&i!==-1?++i:i=-1}return r}class ahe{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=lhe(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){const r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}}function lhe(t){const e=t?.fetch;if(e&&typeof e=="function")return(n,i)=>e(n,i);const r=t?.fetch;return r&&typeof r!="function"?n=>fetch(n,r):n=>fetch(n)}class HC extends ahe{static type="template";static testURL=e=>!1}function che(t,e){const r=jp.parseTextSync?.(t,e),n=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof n=="string"?n:n.value||n.code||"Unknown error"}const uhe="4.3.1",$0={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:uhe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:hhe,options:{wms:{throwOnError:!1}},parse:async(t,e)=>m1(new TextDecoder().decode(t),e),parseSync:(t,e)=>m1(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>m1(t,e)};function hhe(t){return t.startsWith("<?xml")}function m1(t,e){const r={...$0.options.wms,...e?.wms},n=che(t,r),i=r.minimalErrors?n:`WMS Service error: ${n}`;if(r.throwOnError)throw new Error(i);return i}function Hp(t){return Array.isArray(t)?t:t?[t]:[]}function zy(t){const e=Hp(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function A0(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function _1(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function Tp(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function OP(t,e){const r=jp.parseTextSync?.(t,e),n=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,i=fhe(n);if(e?.inheritedLayerProps)for(const o of i.layers)N8(o,null);return e?.includeRawJSON&&(i.json=n),e?.includeXMLText&&(i.xml=t),i}function fhe(t){const e={version:String(t.version||""),name:String(t.Service?.Name||"unnamed"),title:t.Service?.Title?String(t.Service?.Title):void 0,abstract:t.Service?.Abstract?String(t.Service?.Abstract):void 0,keywords:zy(t.Service?.KeywordList?.Keyword),fees:t.Service?.Fees?JSON.stringify(t.Service?.Fees):void 0,accessConstraints:t.Service?.AccessConstraints?JSON.stringify(t.Service?.AccessConstraints):void 0,layerLimit:_1(t.Service?.LayerLimit),maxWidth:_1(t.Service?.maxWidth),maxHeight:_1(t.Service?.maxHeight),layers:[],requests:dhe(t.Capability?.Request),exceptions:phe(t.Exception)},r=Hp(t.Capability?.Layer);for(const n of r)e.layers.push(k8(n));for(const[n,i]of Object.entries(e))i===void 0&&delete e[n];return e}function dhe(t){const e={};for(const[r,n]of Object.entries(t||{})){const i=zy(n?.Format);e[r]={mimeTypes:i}}return e}function phe(t){if(Hp(t?.Format).length>0)return{mimeTypes:zy(t)}}function k8(t){const e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:zy(t.KeywordList?.Keyword)},r=t?.CRS||t?.SRS;r&&Array.isArray(r)&&r.every(h=>typeof h=="string")&&(e.crs=r);let n=t?.EX_GeographicBoundingBox&&Ahe(t?.EX_GeographicBoundingBox);n&&(e.geographicBoundingBox=n),n=t?.LatLonBoundingBox&&ghe(t?.LatLonBoundingBox),n&&(e.geographicBoundingBox=n);const i=t?.BoundingBox&&mhe(t?.BoundingBox);i&&i.length>0&&(e.boundingBoxes=i);const o=Hp(t?.Dimension).map(h=>yhe(h));o.length&&(e.dimensions=o),t?.opaque&&(e.opaque=Tp(t?.opaque)),t?.cascaded&&(e.cascaded=Tp(t?.cascaded)),t?.queryable&&(e.queryable=Tp(t?.queryable));const s=Hp(t?.Layer),l=[];for(const h of s)l.push(k8(h));l.length>0&&(e.layers=l);for(const[h,A]of Object.entries(e))A===void 0&&delete e[h];return e}function Ahe(t){const{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:n,southBoundLatitude:i}=t;return[[e,i],[n,r]]}function ghe(t){const{minx:e,miny:r,maxx:n,maxy:i}=t;return[[e,r],[n,i]]}function mhe(t){return Hp(t).map(e=>_he(e))}function _he(t){const{CRS:e,SRS:r,minx:n,miny:i,maxx:o,maxy:s,resx:l,resy:h}=t,A={crs:e||r,boundingBox:[[A0(n),A0(i)],[A0(o),A0(s)]]};return l&&(A.xResolution=l),h&&(A.yResolution=h),A}function yhe(t){const{name:e,units:r,value:n}=t,i={name:e,units:r,extent:n};return t.unitSymbol&&(i.unitSymbol=t.unitSymbol),t.default&&(i.defaultValue=t.default),t.multipleValues&&(i.multipleValues=Tp(t.multipleValues)),t.nearestValue&&(i.nearestValue=Tp(t.nearestValue)),t.current&&(i.current=Tp(t.current)),i}function N8(t,e){e?.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!t.crs&&(t.crs=[...e.crs]),e?.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(const r of t.layers||[])N8(r,t)}const bhe="4.3.1",VC={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:bhe,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:vhe,options:{wms:{}},parse:async(t,e)=>OP(new TextDecoder().decode(t),e?.wms),parseTextSync:(t,e)=>OP(t,e?.wms)};function vhe(t){return t.startsWith("<?xml")}function DP(t,e){const r=(jp.parseTextSync?.(t,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(r)?r:[r]).map(n=>xhe(n))}}function xhe(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const whe={...VC,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>DP(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>DP(t,e)};function FP(t,e){return jp.parseTextSync?.(t,e)}const Che={...VC,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>FP(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>FP(t,e)},Ehe="4.3.1",Bhe=globalThis.loaders?.parseImageNode,Ex=typeof Image<"u",Bx=typeof ImageBitmap<"u",The=!!Bhe,Tx=P8?!0:The;function She(t){switch(t){case"auto":return Bx||Ex||Tx;case"imagebitmap":return Bx;case"image":return Ex;case"data":return Tx;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Ihe(){if(Bx)return"imagebitmap";if(Ex)return"image";if(Tx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Mhe(t){const e=Phe(t);if(!e)throw new Error("Not an image");return e}function WC(t){switch(Mhe(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Phe(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Lhe=/^data:image\/svg\+xml/,Rhe=/\.svg((\?|#).*)?$/;function JC(t){return t&&(Lhe.test(t)||Rhe.test(t))}function Ohe(t,e){if(JC(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return U8(t,e)}function U8(t,e){if(JC(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function G8(t,e,r){const n=Ohe(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Dhe(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function Dhe(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Fhe={};let kP=!0;async function khe(t,e,r){let n;JC(r)?n=await G8(t,e,r):n=U8(t,r);const i=e&&e.imagebitmap;return await Nhe(n,i)}async function Nhe(t,e=null){if((Uhe(e)||!kP)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),kP=!1}return await createImageBitmap(t)}function Uhe(t){for(const e in t||Fhe)return!1;return!0}function Ghe(t){return!Vhe(t,"ftyp",4)||(t[8]&96)===0?null:zhe(t)}function zhe(t){switch(jhe(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function jhe(t,e,r){return String.fromCharCode(...t.slice(e,r))}function Hhe(t){return[...t].map(e=>e.charCodeAt(0))}function Vhe(t,e,r=0){const n=Hhe(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const oc=!1,yg=!0;function jy(t){const e=tm(t);return Jhe(e)||Qhe(e)||Khe(e)||Xhe(e)||Whe(e)}function Whe(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=Ghe(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function Jhe(t){const e=tm(t);return e.byteLength>=24&&e.getUint32(0,oc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,oc),height:e.getUint32(20,oc)}:null}function Khe(t){const e=tm(t);return e.byteLength>=10&&e.getUint32(0,oc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,yg),height:e.getUint16(8,yg)}:null}function Xhe(t){const e=tm(t);return e.byteLength>=14&&e.getUint16(0,oc)===16973&&e.getUint32(2,yg)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,yg),height:e.getUint32(22,yg)}:null}function Qhe(t){const e=tm(t);if(!(e.byteLength>=3&&e.getUint16(0,oc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=Zhe();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,oc);if(n.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,oc),width:e.getUint16(i+7,oc)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,oc)}return null}function Zhe(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function tm(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function $he(t,e){const{mimeType:r}=jy(t)||{},n=globalThis.loaders?.parseImageNode;return Ai(n),await n(t,r)}async function qhe(t,e,r){e=e||{};const n=(e.image||{}).type||"auto",{url:i}=r||{},o=Yhe(n);let s;switch(o){case"imagebitmap":s=await khe(t,e,i);break;case"image":s=await G8(t,e,i);break;case"data":s=await $he(t);break;default:Ai(!1)}return n==="data"&&(s=WC(s)),s}function Yhe(t){switch(t){case"auto":case"data":return Ihe();default:return She(t),t}}const efe=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],tfe=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],rfe={image:{type:"auto",decode:!0}},Q_={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Ehe,mimeTypes:tfe,extensions:efe,parse:qhe,tests:[t=>!!jy(new DataView(t))],options:rfe},y1={};function z8(t){if(y1[t]===void 0){const e=P8?ife(t):nfe(t);y1[t]=e}return y1[t]}function nfe(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function ife(t){switch(t){case"image/avif":case"image/webp":return sfe(t);default:return!0}}function sfe(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const ofe={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("wms"),createDataSource:(t,e)=>new afe(t,e)};class afe extends HC{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e,r){super(r),this.url=e,this.data=e,this.substituteCRS84=r.wms?.substituteCRS84??r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters,...r.wms?.wmsParameters},this.vendorParameters=r.wms?.vendorParameters||r.vendorParameters||{}}async getMetadata(){const e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){const{boundingBox:r,bbox:n,...i}=e,o={bbox:r?[...r[0],...r[1]]:n,...i};return await this.getMap(o)}normalizeMetadata(e){return e}async getCapabilities(e,r){const n=this.getCapabilitiesURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);const s=await VC.parse(o,this.loadOptions);return this.capabilities=s,s}async getMap(e,r){const n=this.getMapURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await Q_.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(e,r){const n=this.getFeatureInfoURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),await whe.parse(o,this.loadOptions)}async getFeatureInfoText(e,r){const n=this.getFeatureInfoURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),new TextDecoder().decode(o)}async describeLayer(e,r){const n=this.describeLayerURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),await Che.parse(o,this.loadOptions)}async getLegendGraphic(e,r){const n=this.getLegendGraphicURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await Q_.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",n,r)}getMapURL(e,r){e=this._getWMS130Parameters(e);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",n,r)}getFeatureInfoURL(e,r){e=this._getWMS130Parameters(e);const{boundingBox:n,bbox:i}=e;e.bbox=n?[...n[0],...n[1]]:i;const o={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",o,r)}describeLayerURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",n,r)}getLegendGraphicURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",n,r)}_parseWMSUrl(e){const[r,n]=e.split("?"),i=n.split("&"),o={};for(const s of i){const[l,h]=s.split("=");o[l]=h}return{url:r,parameters:o}}_getWMSUrl(e,r,n){let i=this.url,o=!0;const s={service:"WMS",version:r.version,request:e,...r,...this.vendorParameters,...n},l=["transparent","time","elevation"];for(const[h,A]of Object.entries(s))(!l.includes(h)||A)&&(i+=o?"?":"&",o=!1,i+=this._getURLParameter(h,A,r));return encodeURI(i)}_getWMS130Parameters(e){const r={...e};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(e,r,n){switch(e){case"crs":n.version!=="1.3.0"?e="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":n.version==="1.3.0"&&(e="crs");break;case"bbox":const i=this._flipBoundingBox(r,n);i&&(r=i);break;case"x":n.version==="1.3.0"&&(e="i");break;case"y":n.version==="1.3.0"&&(e="j");break}return e=e.toUpperCase(),Array.isArray(r)?`${e}=${r.join(",")}`:`${e}=${r?String(r):""}`}_flipBoundingBox(e,r){if(!Array.isArray(e)||e.length!==4)return null;const n=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),i=e;return n?[i[1],i[0],i[3],i[2]]:i}async _fetchArrayBuffer(e){const r=await this.fetch(e),n=await r.arrayBuffer();return this._checkResponse(r,n),n}_checkResponse(e,r){const n=e.headers["content-type"];if(!e.ok||$0.mimeTypes.includes(n)){const i=Gue(this.loadOptions,{wms:{throwOnError:!0}}),o=$0.parseSync?.(r,i);throw new Error(o)}}_parseError(e){const r=$0.parseSync?.(e,this.loadOptions);return new Error(r)}}const lfe={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("ImageServer"),createDataSource:(t,e)=>new cfe(t,e)};class cfe extends HC{url;data;constructor(e,r){super(r),this.url=e,this.data=e}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.url}?f=pjson`}exportImageURL(e){const r=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,n=`size=${e.width},${e.height}`,i={...e,bbox:r,size:n};return delete i.width,delete i.height,this.getUrl("exportImage",i)}getUrl(e,r,n){let i=`${this.url}/${e}`,o=!0;for(const[s,l]of Object.entries(r))i+=o?"?":"&",o=!1,Array.isArray(l)?i+=`${s.toUpperCase()}=${l.join(",")}`:i+=`${s.toUpperCase()}=${l?String(l):""}`;return i}async checkResponse(e){if(!e.ok)throw new Error("error")}}const ufe=[ofe,lfe];function hfe(t,e=ufe){const{type:r="auto"}=t,n=r==="auto"?dfe(t.url,e):ffe(r,e);if(!n)throw new Error("Not a valid image source type");return n.createDataSource(t.url,t)}function ffe(t,e){for(const r of e)if(r.type===t)return r;return null}function dfe(t,e){for(const r of e)if(r.testURL&&r.testURL(t))return r;return null}const NP=6378137*Math.PI;function UP(t){const e=ru(t);return e[0]=(e[0]/256-1)*NP,e[1]=(e[1]/256-1)*NP,e}const pfe={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}};class Sx extends Bs{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:n}){const{viewport:i}=this.context;e.dataChanged||r.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(i,"image source changed"),0)):es(r.layers,n.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(i,"viewport changed")):this.debounce(()=>this.loadImage(i,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:r,lastRequestParameters:n}=this.state;return r&&new H_({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?Yr.LNGLAT:Yr.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){const{lastRequestParameters:n}=this.state;return n?await this.state.imageSource.getFeatureInfoText?.({...n,query_layers:n.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof HC)return e.data;if(typeof e.data=="string")return hfe({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:e}=this.state;try{this.state.loadCounter++;const r=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(e,r){const{layers:n,serviceType:i}=this.props;if(i==="wms"&&n.length===0)return;const o=e.getBounds(),{width:s,height:l}=e,h=this.getRequestId();let{srs:A}=this.props;A==="auto"&&(A=e.resolution?"EPSG:4326":"EPSG:3857");const b={width:s,height:l,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:n,crs:A};if(A==="EPSG:3857"){const C=UP([o[0],o[1]]),S=UP([o[2],o[3]]);b.boundingBox=[C,S]}try{this.state.loadCounter++,this.props.onImageLoadStart(h);const C=await this.state.imageSource.getImage(b);this.state.lastRequestId<h&&(this.getCurrentLayer()?.props.onImageLoad(h),this.setState({image:C,bounds:o,lastRequestParameters:b,lastRequestId:h}))}catch(C){this.raiseError(C,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(h,C)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}}Sx.layerName="WMSLayer",Sx.defaultProps=pfe;const Afe={getHeight:{type:"accessor",value:0},greatCircle:!0};class Ix extends Dg{}Ix.layerName="GreatCircleLayer",Ix.defaultProps=Afe;const gfe={...sh.defaultProps};class oh extends Bs{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:r,wireframe:n,filled:i,stroked:o,lineWidthUnits:s,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:b,lineMiterLimit:C,lineDashJustified:S,getElevation:D,getFillColor:N,getLineColor:U,getLineWidth:V}=this.props,{updateTriggers:j,material:ee,transitions:Q}=this.props,X=this.getSubLayerClass("cell",sh),{updateTriggers:pe,...Y}=this.indexToBounds()||{};return new X({filled:i,wireframe:n,extruded:r,elevationScale:e,stroked:o,lineWidthUnits:s,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:b,lineMiterLimit:C,lineDashJustified:S,material:ee,transitions:Q,getElevation:D,getFillColor:N,getLineColor:U,getLineWidth:V},this.getSubLayerProps({id:"cell",updateTriggers:j&&{...pe,getElevation:j.getElevation,getFillColor:j.getFillColor,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}),Y)}}oh.layerName="GeoCellLayer",oh.defaultProps=gfe;function mfe(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Mx={exports:{}},_fe=Mx.exports,GP;function yfe(){return GP||(GP=1,(function(t){/**
* @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
* Released under the Apache License, Version 2.0
* see: https://github.com/dcodeIO/long.js for details
*/(function(e,r){typeof mfe=="function"&&t&&t.exports?t.exports=r():(e.dcodeIO=e.dcodeIO||{}).Long=r()})(_fe,function(){function e(ce,De,J){this.low=ce|0,this.high=De|0,this.unsigned=!!J}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function r(ce){return(ce&&ce.__isLong__)===!0}e.isLong=r;var n={},i={};function o(ce,De){var J,ue,Ee;return De?(ce>>>=0,(Ee=0<=ce&&ce<256)&&(ue=i[ce],ue)?ue:(J=l(ce,(ce|0)<0?-1:0,!0),Ee&&(i[ce]=J),J)):(ce|=0,(Ee=-128<=ce&&ce<128)&&(ue=n[ce],ue)?ue:(J=l(ce,ce<0?-1:0,!1),Ee&&(n[ce]=J),J))}e.fromInt=o;function s(ce,De){if(isNaN(ce)||!isFinite(ce))return De?ee:j;if(De){if(ce<0)return ee;if(ce>=N)return Ge}else{if(ce<=-U)return ze;if(ce+1>=U)return Y}return ce<0?s(-ce,De).neg():l(ce%D|0,ce/D|0,De)}e.fromNumber=s;function l(ce,De,J){return new e(ce,De,J)}e.fromBits=l;var h=Math.pow;function A(ce,De,J){if(ce.length===0)throw Error("empty string");if(ce==="NaN"||ce==="Infinity"||ce==="+Infinity"||ce==="-Infinity")return j;if(typeof De=="number"?(J=De,De=!1):De=!!De,J=J||10,J<2||36<J)throw RangeError("radix");var ue;if((ue=ce.indexOf("-"))>0)throw Error("interior hyphen");if(ue===0)return A(ce.substring(1),De,J).neg();for(var Ee=s(h(J,8)),ct=j,Ce=0;Ce<ce.length;Ce+=8){var Le=Math.min(8,ce.length-Ce),Ne=parseInt(ce.substring(Ce,Ce+Le),J);if(Le<8){var $e=s(h(J,Le));ct=ct.mul($e).add(s(Ne))}else ct=ct.mul(Ee),ct=ct.add(s(Ne))}return ct.unsigned=De,ct}e.fromString=A;function b(ce){return ce instanceof e?ce:typeof ce=="number"?s(ce):typeof ce=="string"?A(ce):l(ce.low,ce.high,ce.unsigned)}e.fromValue=b;var C=65536,S=1<<24,D=C*C,N=D*D,U=N/2,V=o(S),j=o(0);e.ZERO=j;var ee=o(0,!0);e.UZERO=ee;var Q=o(1);e.ONE=Q;var X=o(1,!0);e.UONE=X;var pe=o(-1);e.NEG_ONE=pe;var Y=l(-1,2147483647,!1);e.MAX_VALUE=Y;var Ge=l(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Ge;var ze=l(0,-2147483648,!1);e.MIN_VALUE=ze;var de=e.prototype;return de.toInt=function(){return this.unsigned?this.low>>>0:this.low},de.toNumber=function(){return this.unsigned?(this.high>>>0)*D+(this.low>>>0):this.high*D+(this.low>>>0)},de.toString=function(ce){if(ce=ce||10,ce<2||36<ce)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ze)){var De=s(ce),J=this.div(De),ue=J.mul(De).sub(this);return J.toString(ce)+ue.toInt().toString(ce)}else return"-"+this.neg().toString(ce);for(var Ee=s(h(ce,6),this.unsigned),ct=this,Ce="";;){var Le=ct.div(Ee),Ne=ct.sub(Le.mul(Ee)).toInt()>>>0,$e=Ne.toString(ce);if(ct=Le,ct.isZero())return $e+Ce;for(;$e.length<6;)$e="0"+$e;Ce=""+$e+Ce}},de.getHighBits=function(){return this.high},de.getHighBitsUnsigned=function(){return this.high>>>0},de.getLowBits=function(){return this.low},de.getLowBitsUnsigned=function(){return this.low>>>0},de.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ze)?64:this.neg().getNumBitsAbs();for(var ce=this.high!=0?this.high:this.low,De=31;De>0&&(ce&1<<De)==0;De--);return this.high!=0?De+33:De+1},de.isZero=function(){return this.high===0&&this.low===0},de.isNegative=function(){return!this.unsigned&&this.high<0},de.isPositive=function(){return this.unsigned||this.high>=0},de.isOdd=function(){return(this.low&1)===1},de.isEven=function(){return(this.low&1)===0},de.equals=function(ce){return r(ce)||(ce=b(ce)),this.unsigned!==ce.unsigned&&this.high>>>31===1&&ce.high>>>31===1?!1:this.high===ce.high&&this.low===ce.low},de.eq=de.equals,de.notEquals=function(ce){return!this.eq(ce)},de.neq=de.notEquals,de.lessThan=function(ce){return this.comp(ce)<0},de.lt=de.lessThan,de.lessThanOrEqual=function(ce){return this.comp(ce)<=0},de.lte=de.lessThanOrEqual,de.greaterThan=function(ce){return this.comp(ce)>0},de.gt=de.greaterThan,de.greaterThanOrEqual=function(ce){return this.comp(ce)>=0},de.gte=de.greaterThanOrEqual,de.compare=function(ce){if(r(ce)||(ce=b(ce)),this.eq(ce))return 0;var De=this.isNegative(),J=ce.isNegative();return De&&!J?-1:!De&&J?1:this.unsigned?ce.high>>>0>this.high>>>0||ce.high===this.high&&ce.low>>>0>this.low>>>0?-1:1:this.sub(ce).isNegative()?-1:1},de.comp=de.compare,de.negate=function(){return!this.unsigned&&this.eq(ze)?ze:this.not().add(Q)},de.neg=de.negate,de.add=function(ce){r(ce)||(ce=b(ce));var De=this.high>>>16,J=this.high&65535,ue=this.low>>>16,Ee=this.low&65535,ct=ce.high>>>16,Ce=ce.high&65535,Le=ce.low>>>16,Ne=ce.low&65535,$e=0,it=0,ot=0,dt=0;return dt+=Ee+Ne,ot+=dt>>>16,dt&=65535,ot+=ue+Le,it+=ot>>>16,ot&=65535,it+=J+Ce,$e+=it>>>16,it&=65535,$e+=De+ct,$e&=65535,l(ot<<16|dt,$e<<16|it,this.unsigned)},de.subtract=function(ce){return r(ce)||(ce=b(ce)),this.add(ce.neg())},de.sub=de.subtract,de.multiply=function(ce){if(this.isZero()||(r(ce)||(ce=b(ce)),ce.isZero()))return j;if(this.eq(ze))return ce.isOdd()?ze:j;if(ce.eq(ze))return this.isOdd()?ze:j;if(this.isNegative())return ce.isNegative()?this.neg().mul(ce.neg()):this.neg().mul(ce).neg();if(ce.isNegative())return this.mul(ce.neg()).neg();if(this.lt(V)&&ce.lt(V))return s(this.toNumber()*ce.toNumber(),this.unsigned);var De=this.high>>>16,J=this.high&65535,ue=this.low>>>16,Ee=this.low&65535,ct=ce.high>>>16,Ce=ce.high&65535,Le=ce.low>>>16,Ne=ce.low&65535,$e=0,it=0,ot=0,dt=0;return dt+=Ee*Ne,ot+=dt>>>16,dt&=65535,ot+=ue*Ne,it+=ot>>>16,ot&=65535,ot+=Ee*Le,it+=ot>>>16,ot&=65535,it+=J*Ne,$e+=it>>>16,it&=65535,it+=ue*Le,$e+=it>>>16,it&=65535,it+=Ee*Ce,$e+=it>>>16,it&=65535,$e+=De*Ne+J*Le+ue*Ce+Ee*ct,$e&=65535,l(ot<<16|dt,$e<<16|it,this.unsigned)},de.mul=de.multiply,de.divide=function(ce){if(r(ce)||(ce=b(ce)),ce.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?ee:j;var De,J,ue;if(this.unsigned){if(ce.unsigned||(ce=ce.toUnsigned()),ce.gt(this))return ee;if(ce.gt(this.shru(1)))return X;ue=ee}else{if(this.eq(ze)){if(ce.eq(Q)||ce.eq(pe))return ze;if(ce.eq(ze))return Q;var Ee=this.shr(1);return De=Ee.div(ce).shl(1),De.eq(j)?ce.isNegative()?Q:pe:(J=this.sub(ce.mul(De)),ue=De.add(J.div(ce)),ue)}else if(ce.eq(ze))return this.unsigned?ee:j;if(this.isNegative())return ce.isNegative()?this.neg().div(ce.neg()):this.neg().div(ce).neg();if(ce.isNegative())return this.div(ce.neg()).neg();ue=j}for(J=this;J.gte(ce);){De=Math.max(1,Math.floor(J.toNumber()/ce.toNumber()));for(var ct=Math.ceil(Math.log(De)/Math.LN2),Ce=ct<=48?1:h(2,ct-48),Le=s(De),Ne=Le.mul(ce);Ne.isNegative()||Ne.gt(J);)De-=Ce,Le=s(De,this.unsigned),Ne=Le.mul(ce);Le.isZero()&&(Le=Q),ue=ue.add(Le),J=J.sub(Ne)}return ue},de.div=de.divide,de.modulo=function(ce){return r(ce)||(ce=b(ce)),this.sub(this.div(ce).mul(ce))},de.mod=de.modulo,de.not=function(){return l(~this.low,~this.high,this.unsigned)},de.and=function(ce){return r(ce)||(ce=b(ce)),l(this.low&ce.low,this.high&ce.high,this.unsigned)},de.or=function(ce){return r(ce)||(ce=b(ce)),l(this.low|ce.low,this.high|ce.high,this.unsigned)},de.xor=function(ce){return r(ce)||(ce=b(ce)),l(this.low^ce.low,this.high^ce.high,this.unsigned)},de.shiftLeft=function(ce){return r(ce)&&(ce=ce.toInt()),(ce&=63)===0?this:ce<32?l(this.low<<ce,this.high<<ce|this.low>>>32-ce,this.unsigned):l(0,this.low<<ce-32,this.unsigned)},de.shl=de.shiftLeft,de.shiftRight=function(ce){return r(ce)&&(ce=ce.toInt()),(ce&=63)===0?this:ce<32?l(this.low>>>ce|this.high<<32-ce,this.high>>ce,this.unsigned):l(this.high>>ce-32,this.high>=0?0:-1,this.unsigned)},de.shr=de.shiftRight,de.shiftRightUnsigned=function(ce){if(r(ce)&&(ce=ce.toInt()),ce&=63,ce===0)return this;var De=this.high;if(ce<32){var J=this.low;return l(J>>>ce|De<<32-ce,De>>>ce,this.unsigned)}else return ce===32?l(De,0,this.unsigned):l(De>>>ce-32,0,this.unsigned)},de.shru=de.shiftRightUnsigned,de.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},de.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},de.toBytes=function(ce){return ce?this.toBytesLE():this.toBytesBE()},de.toBytesLE=function(){var ce=this.high,De=this.low;return[De&255,De>>>8&255,De>>>16&255,De>>>24&255,ce&255,ce>>>8&255,ce>>>16&255,ce>>>24&255]},de.toBytesBE=function(){var ce=this.high,De=this.low;return[ce>>>24&255,ce>>>16&255,ce>>>8&255,ce&255,De>>>24&255,De>>>16&255,De>>>8&255,De&255]},e})})(Mx)),Mx.exports}var bfe=yfe();const q0=bf(bfe),vfe=3,xfe=30,wfe=2*xfe+1,zP=180/Math.PI;function Cfe(t,e,r){const n=1<<e;return[(t[0]+r[0])/n,(t[1]+r[1])/n]}function jP(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function Efe(t){return[jP(t[0]),jP(t[1])]}function Bfe(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function Tfe([t,e,r]){const n=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*zP,n*zP]}function Sfe(t){let e=q0.fromString(t,!0,10).toString(2);for(;e.length<vfe+wfe;)e="0"+e;const r=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,r),o=i.length/2,s=q0.fromString(n,!0,2).toString(10);let l=q0.fromString(i,!0,2).toString(4);for(;l.length<o;)l="0"+l;return`${s}/${l}`}function Ife(t,e,r,n){if(n===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Mfe(t){const e=t.split("/"),r=parseInt(e[0],10),n=e[1],i=n.length,o=[0,0];let s;for(let l=i-1;l>=0;l--){s=i-l;const h=n[l];let A=0,b=0;h==="1"?b=1:h==="2"?(A=1,b=1):h==="3"&&(A=1);const C=Math.pow(2,s-1);Ife(C,o,A,b),o[0]+=C*A,o[1]+=C*b}if(r%2===1){const l=o[0];o[0]=o[1],o[1]=l}return{face:r,ij:o,level:s}}function Pfe(t){const e=t.padEnd(16,"0");return q0.fromString(e,16)}const Lfe=100;function Rfe({face:t,ij:e,level:r}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Lfe*Math.pow(2,-r))),o=new Float64Array(4*i*2+2);let s=0,l=0;for(let h=0;h<4;h++){const A=n[h].slice(0),b=n[h+1],C=(b[0]-A[0])/i,S=(b[1]-A[1])/i;for(let D=0;D<i;D++){A[0]+=C,A[1]+=S;const N=Cfe(e,r,A),U=Efe(N),V=Bfe(t,U),j=Tfe(V);Math.abs(j[1])>89.999&&(j[0]=l);const ee=j[0]-l;j[0]+=ee>180?-360:ee<-180?360:0,o[s++]=j[0],o[s++]=j[1],l=j[0]}}return o[s++]=o[0],o[s++]=o[1],o}function Ofe(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=Pfe(t)}return Sfe(t.toString())}function Dfe(t){const e=Ofe(t),r=Mfe(e);return Rfe(r)}const Ffe={getS2Token:{type:"accessor",value:t=>t.token}};class Z_ extends oh{indexToBounds(){const{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>Dfe(r(n,i))}}}Z_.layerName="S2Layer",Z_.defaultProps=Ffe;const b1=512;function kfe(t,e){let r=0,n=0,i=1<<t.length;const o=i/b1;for(let s=0;s<t.length;s++){i>>=1;const l=parseInt(t[s]);l%2&&(r|=i),l>1&&(n|=i)}return[[r/o,b1-n/o],[(r+e)/o,b1-(n+e)/o]]}function Nfe(t,e=1){const[r,n]=kfe(t,e),[i,o]=dc(r),[s,l]=dc(n);return[s,o,s,l,i,l,i,o,s,o]}const Ufe={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class $_ extends oh{indexToBounds(){const{data:e,extruded:r,getQuadkey:n}=this.props,i=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>Nfe(n(o,s),i),updateTriggers:{getPolygon:i}}}}$_.layerName="QuadkeyLayer",$_.defaultProps=Ufe;class j8{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:n,onError:i}){const{index:o,id:s,bbox:l,userData:h,zoom:A}=this,b=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,S=await r.scheduleRequest(this,U=>U.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let D=null,N;try{D=await e({index:o,id:s,bbox:l,userData:h,zoom:A,signal:C})}catch(U){N=U||!0}finally{S.done()}if(b===this._loaderId){if(this._loader=void 0,this.content=D,this._isCancelled&&!D){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,N?i(N,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const yo={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},HP=new ft,Gfe=new ft;class KC{constructor(e=[0,0,0],r=[0,0,0],n){n=n||HP.copy(e).add(r).scale(.5),this.center=new ft(n),this.halfDiagonal=new ft(r).subtract(this.center),this.minimum=new ft(e),this.maximum=new ft(r)}clone(){return new KC(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:r}=this,n=Gfe.from(e.normal),i=r.x*Math.abs(n.x)+r.y*Math.abs(n.y)+r.z*Math.abs(n.z),o=this.center.dot(n)+e.distance;return o-i>0?yo.INSIDE:o+i<0?yo.OUTSIDE:yo.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=HP.from(e).subtract(this.center),{halfDiagonal:n}=this;let i=0,o;return o=Math.abs(r.x)-n.x,o>0&&(i+=o*o),o=Math.abs(r.y)-n.y,o>0&&(i+=o*o),o=Math.abs(r.z)-n.z,o>0&&(i+=o*o),i}}const jA=new ft,VP=new ft;class rm{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new ft,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=jA.from(r),this.center=new ft().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new rm(this.center,this.radius)}union(e){const r=this.center,n=this.radius,i=e.center,o=e.radius,s=jA.copy(i).subtract(r),l=s.magnitude();if(n>=l+o)return this.clone();if(o>=l+n)return e.clone();const h=(n+l+o)*.5;return VP.copy(s).scale((-n+h)/l).add(r),this.center.copy(VP),this.radius=h,this}expand(e){const r=jA.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const r=uV(jA,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){const r=this.distanceTo(e);return r*r}distanceTo(e){const r=jA.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const r=this.center,n=this.radius,i=e.normal.dot(r)+e.distance;return i<-n?yo.OUTSIDE:i<n?yo.INTERSECTING:yo.INSIDE}}const zfe=new ft,jfe=new ft,g0=new ft,m0=new ft,_0=new ft,Hfe=new ft,Vfe=new ft,Vc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class nm{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new ft().from(e),this.halfAxes=new gi(r)}get halfSize(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ft(e).len(),new ft(r).len(),new ft(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ft(e).normalize(),o=new ft(r).normalize(),s=new ft(n).normalize();return new Eg().fromMatrix3(new gi([...i,...o,...s]))}fromCenterHalfSizeQuaternion(e,r,n){const i=new Eg(n),o=new gi().fromQuaternion(i);return o[0]=o[0]*r[0],o[1]=o[1]*r[0],o[2]=o[2]*r[0],o[3]=o[3]*r[1],o[4]=o[4]*r[1],o[5]=o[5]*r[1],o[6]=o[6]*r[2],o[7]=o[7]*r[2],o[8]=o[8]*r[2],this.center=new ft().from(e),this.halfAxes=o,this}clone(){return new nm(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new rm){const r=this.halfAxes,n=r.getColumn(0,g0),i=r.getColumn(1,m0),o=r.getColumn(2,_0),s=zfe.copy(n).add(i).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const r=this.center,n=e.normal,i=this.halfAxes,o=n.x,s=n.y,l=n.z,h=Math.abs(o*i[Vc.COLUMN0ROW0]+s*i[Vc.COLUMN0ROW1]+l*i[Vc.COLUMN0ROW2])+Math.abs(o*i[Vc.COLUMN1ROW0]+s*i[Vc.COLUMN1ROW1]+l*i[Vc.COLUMN1ROW2])+Math.abs(o*i[Vc.COLUMN2ROW0]+s*i[Vc.COLUMN2ROW1]+l*i[Vc.COLUMN2ROW2]),A=n.dot(r)+e.distance;return A<=-h?yo.OUTSIDE:A>=h?yo.INSIDE:yo.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=jfe.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,g0),o=n.getColumn(1,m0),s=n.getColumn(2,_0),l=i.magnitude(),h=o.magnitude(),A=s.magnitude();i.normalize(),o.normalize(),s.normalize();let b=0,C;return C=Math.abs(r.dot(i))-l,C>0&&(b+=C*C),C=Math.abs(r.dot(o))-h,C>0&&(b+=C*C),C=Math.abs(r.dot(s))-A,C>0&&(b+=C*C),b}computePlaneDistances(e,r,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,l=this.halfAxes,h=l.getColumn(0,g0),A=l.getColumn(1,m0),b=l.getColumn(2,_0),C=Hfe.copy(h).add(A).add(b).add(s),S=Vfe.copy(C).subtract(e);let D=r.dot(S);return i=Math.min(D,i),o=Math.max(D,o),C.copy(s).add(h).add(A).subtract(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),C.copy(s).add(h).subtract(A).add(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),C.copy(s).add(h).subtract(A).subtract(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(C).subtract(h).add(A).add(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(C).subtract(h).add(A).subtract(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(C).subtract(h).subtract(A).add(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),s.copy(C).subtract(h).subtract(A).subtract(b),S.copy(C).subtract(e),D=r.dot(S),i=Math.min(D,i),o=Math.max(D,o),n[0]=i,n[1]=o,n}transform(e){this.center.transformAsPoint(e);const r=this.halfAxes.getColumn(0,g0);r.transformAsPoint(e);const n=this.halfAxes.getColumn(1,m0);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,_0);return i.transformAsPoint(e),this.halfAxes=new gi([...r,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const WP=new ft,JP=new ft;class _l{constructor(e=[0,0,1],r=0){this.normal=new ft,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return yl(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=WP.from(e),this.normal.from(r).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,r,n,i){return this.normal.set(e,r,n),yl(ma(this.normal.len(),1)),this.distance=i,this}clone(){return new _l(this.normal,this.distance)}equals(e){return ma(this.distance,e.distance)&&ma(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const r=JP.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,r)}projectPointOntoPlane(e,r=[0,0,0]){const n=WP.from(e),i=this.getPointDistance(n),o=JP.copy(this.normal).scale(i);return n.subtract(o).to(r)}}const KP=[new ft([1,0,0]),new ft([0,1,0]),new ft([0,0,1])],XP=new ft,Wfe=new ft;class pa{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*KP.length;const r=e.center,n=e.radius;let i=0;for(const o of KP){let s=this.planes[i],l=this.planes[i+1];s||(s=this.planes[i]=new _l),l||(l=this.planes[i+1]=new _l);const h=XP.copy(o).scale(-n).add(r);s.fromPointNormal(h,o);const A=XP.copy(o).scale(n).add(r),b=Wfe.copy(o).negate();l.fromPointNormal(A,b),i+=2}return this}computeVisibility(e){let r=yo.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case yo.OUTSIDE:return yo.OUTSIDE;case yo.INTERSECTING:r=yo.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(e,r){if(yl(Number.isFinite(r),"parentPlaneMask is required."),r===pa.MASK_OUTSIDE||r===pa.MASK_INSIDE)return r;let n=pa.MASK_INSIDE;const i=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&(r&s)===0)continue;const l=i[o],h=e.intersectPlane(l);if(h===yo.OUTSIDE)return pa.MASK_OUTSIDE;h===yo.INTERSECTING&&(n|=s)}return n}}pa.MASK_OUTSIDE=4294967295,pa.MASK_INSIDE=0,pa.MASK_INDETERMINATE=2147483647,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft;const tc=new gi,Jfe=new gi,Kfe=new gi,y0=new gi,QP=new gi;function Xfe(t,e={}){const r=QV,n=10;let i=0,o=0;const s=Jfe,l=Kfe;s.identity(),l.copy(t);const h=r*Qfe(l);for(;o<n&&Zfe(l)>h;)$fe(l,y0),QP.copy(y0).transpose(),l.multiplyRight(y0),l.multiplyLeft(QP),s.multiplyRight(y0),++i>2&&(++o,i=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function Qfe(t){let e=0;for(let r=0;r<9;++r){const n=t[r];e+=n*n}return Math.sqrt(e)}const Px=[1,0,0],Lx=[2,2,1];function Zfe(t){let e=0;for(let r=0;r<3;++r){const n=t[tc.getElementIndex(Lx[r],Px[r])];e+=2*n*n}return Math.sqrt(e)}function $fe(t,e){const r=RD;let n=0,i=1;for(let A=0;A<3;++A){const b=Math.abs(t[tc.getElementIndex(Lx[A],Px[A])]);b>n&&(i=A,n=b)}const o=Px[i],s=Lx[i];let l=1,h=0;if(Math.abs(t[tc.getElementIndex(s,o)])>r){const A=t[tc.getElementIndex(s,s)],b=t[tc.getElementIndex(o,o)],C=t[tc.getElementIndex(s,o)],S=(A-b)/2/C;let D;S<0?D=-1/(-S+Math.sqrt(1+S*S)):D=1/(S+Math.sqrt(1+S*S)),l=1/Math.sqrt(1+D*D),h=D*l}return gi.IDENTITY.to(e),e[tc.getElementIndex(o,o)]=e[tc.getElementIndex(s,s)]=l,e[tc.getElementIndex(s,o)]=h,e[tc.getElementIndex(o,s)]=-h,e}const Uu=new ft,qfe=new ft,Yfe=new ft,ede=new ft,tde=new ft,rde=new gi,nde={diagonal:new gi,unitary:new gi};function H8(t,e=new nm){if(!t||t.length===0)return e.halfAxes=new gi([0,0,0,0,0,0,0,0,0]),e.center=new ft,e;const r=t.length,n=new ft(0,0,0);for(const de of t)n.add(de);const i=1/r;n.multiplyByScalar(i);let o=0,s=0,l=0,h=0,A=0,b=0;for(const de of t){const ce=Uu.copy(de).subtract(n);o+=ce.x*ce.x,s+=ce.x*ce.y,l+=ce.x*ce.z,h+=ce.y*ce.y,A+=ce.y*ce.z,b+=ce.z*ce.z}o*=i,s*=i,l*=i,h*=i,A*=i,b*=i;const C=rde;C[0]=o,C[1]=s,C[2]=l,C[3]=s,C[4]=h,C[5]=A,C[6]=l,C[7]=A,C[8]=b;const{unitary:S}=Xfe(C,nde),D=e.halfAxes.copy(S);let N=D.getColumn(0,Yfe),U=D.getColumn(1,ede),V=D.getColumn(2,tde),j=-Number.MAX_VALUE,ee=-Number.MAX_VALUE,Q=-Number.MAX_VALUE,X=Number.MAX_VALUE,pe=Number.MAX_VALUE,Y=Number.MAX_VALUE;for(const de of t)Uu.copy(de),j=Math.max(Uu.dot(N),j),ee=Math.max(Uu.dot(U),ee),Q=Math.max(Uu.dot(V),Q),X=Math.min(Uu.dot(N),X),pe=Math.min(Uu.dot(U),pe),Y=Math.min(Uu.dot(V),Y);N=N.multiplyByScalar(.5*(X+j)),U=U.multiplyByScalar(.5*(pe+ee)),V=V.multiplyByScalar(.5*(Y+Q)),e.center.copy(N).add(U).add(V);const Ge=qfe.set(j-X,ee-pe,Q-Y).multiplyByScalar(.5),ze=new gi([Ge[0],0,0,0,Ge[1],0,0,0,Ge[2]]);return e.halfAxes.multiplyRight(ze),e}const Ap=512,ZP=3,V8=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],W8=V8.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),ide=W8.concat([[.25,.5],[.75,.5]]);class gp{constructor(e,r,n){this.x=e,this.y=r,this.z=n}get children(){if(!this._children){const e=this.x*2,r=this.y*2,n=this.z+1;this._children=[new gp(e,r,n),new gp(e,r+1,n),new gp(e+1,r,n),new gp(e+1,r+1,n)]}return this._children}update(e){const{viewport:r,cullingVolume:n,elevationBounds:i,minZ:o,maxZ:s,bounds:l,offset:h,project:A}=e,b=this.getBoundingVolume(i,h,A);if(l&&!this.insideBounds(l)||n.computeVisibility(b)<0)return!1;if(!this.childVisible){let{z:C}=this;if(C<s&&C>=o){const S=b.distanceTo(r.cameraPosition)*r.scale/r.height;C+=Math.floor(Math.log2(S))}if(C>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const C of this.children)C.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const r of this._children)r.getSelected(e);return e}insideBounds([e,r,n,i]){const o=Math.pow(2,this.z),s=Ap/o;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>r}getBoundingVolume(e,r,n){if(n){const h=this.z<1?ide:this.z<2?W8:V8,A=[];for(const b of h){const C=Ox(this.x+b[0],this.y+b[1],this.z);C[2]=e[0],A.push(n(C)),e[0]!==e[1]&&(C[2]=e[1],A.push(n(C)))}return H8(A)}const i=Math.pow(2,this.z),o=Ap/i,s=this.x*o+r*Ap,l=Ap-(this.y+1)*o;return new KC([s,l,e[0]],[s+o,l+o,e[1]])}}function sde(t,e,r,n){const i=t instanceof xq&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map(({normal:D,distance:N})=>new _l(D.clone().negate(),N)),s=new pa(o),l=t.distanceScales.unitsPerMeter[2],h=r&&r[0]*l||0,A=r&&r[1]*l||0,b=t instanceof Sg&&t.pitch<=60?e:0;if(n){const[D,N,U,V]=n,j=ru([D,V]),ee=ru([U,N]);n=[j[0],Ap-j[1],ee[0],Ap-ee[1]]}const C=new gp(0,0,0),S={viewport:t,project:i,cullingVolume:s,elevationBounds:[h,A],minZ:b,maxZ:e,bounds:n,offset:0};if(C.update(S),t instanceof Sg&&t.subViewports&&t.subViewports.length>1){for(S.offset=-1;C.update(S)&&!(--S.offset<-ZP););for(S.offset=1;C.update(S)&&!(++S.offset>ZP););}return C.getSelected()}const iu=512,ode=[-1/0,-1/0,1/0,1/0],q_={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}};function J8(t,e){const r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(n=>n[0])),Math.min(...r.map(n=>n[1])),Math.max(...r.map(n=>n[0])),Math.max(...r.map(n=>n[1]))]}function ade(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function gf(t,e){if(!t||!t.length)return null;const{index:r,id:n}=e;if(Array.isArray(t)){const o=ade(n)%t.length;t=t[o]}let i=t;for(const o of Object.keys(r)){const s=new RegExp(`{${o}}`,"g");i=i.replace(s,String(r[o]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),i}function lde(t,e,r){let n;return n=t.getBounds(),t.isGeospatial?[Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.min(n[2],r[2]),Math.min(n[3],r[3])]:[Math.max(Math.min(n[0],r[2]),r[0]),Math.max(Math.min(n[1],r[3]),r[1]),Math.min(Math.max(n[2],r[0]),r[2]),Math.min(Math.max(n[3],r[1]),r[3])]}function cde({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(n=>Rx(n,e||0,r))}function Rx(t,e,r){if(!Array.isArray(e)){const o=r.x-t.x,s=r.y-t.y,{width:l,height:h}=r,A={targetZ:e},b=t.unproject([o,s],A),C=t.unproject([o+l,s],A),S=t.unproject([o,s+h],A),D=t.unproject([o+l,s+h],A);return[Math.min(b[0],C[0],S[0],D[0]),Math.min(b[1],C[1],S[1],D[1]),Math.max(b[0],C[0],S[0],D[0]),Math.max(b[1],C[1],S[1],D[1])]}const n=Rx(t,e[0],r),i=Rx(t,e[1],r);return[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[2],i[2]),Math.max(n[3],i[3])]}function ude(t,e,r){return r?J8(t,r).map(n=>n*e/iu):t.map(n=>n*e/iu)}function XC(t,e){return Math.pow(2,t)*iu/e}function Ox(t,e,r){const n=XC(r,iu),i=t/n*360-180,o=Math.PI-2*Math.PI*e/n,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[i,s]}function $P(t,e,r,n){const i=XC(r,n);return[t/i*iu,e/i*iu]}function hde(t,e,r,n,i=iu){if(t.isGeospatial){const[A,b]=Ox(e,r,n),[C,S]=Ox(e+1,r+1,n);return{west:A,north:b,east:C,south:S}}const[o,s]=$P(e,r,n,i),[l,h]=$P(e+1,r+1,n,i);return{left:o,top:s,right:l,bottom:h}}function fde(t,e,r,n,i){const o=lde(t,null,n),s=XC(e,r),[l,h,A,b]=ude(o,s,i),C=[];for(let S=Math.floor(l);S<A;S++)for(let D=Math.floor(h);D<b;D++)C.push({x:S,y:D,z:e});return C}function dde({viewport:t,maxZoom:e,minZoom:r,zRange:n,extent:i,tileSize:o=iu,modelMatrix:s,modelMatrixInverse:l,zoomOffset:h=0}){let A=t.isGeospatial?Math.round(t.zoom+Math.log2(iu/o))+h:Math.ceil(t.zoom)+h;if(typeof r=="number"&&Number.isFinite(r)&&A<r){if(!i)return[];A=r}typeof e=="number"&&Number.isFinite(e)&&A>e&&(A=e);let b=i;return s&&l&&i&&!t.isGeospatial&&(b=J8(i,s)),t.isGeospatial?sde(t,A,n,i):fde(t,A,o,b||ode,l)}function pde(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function Ade(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function gde(t){let e={},r;return n=>{for(const i in n)if(!mde(n[i],e[i])){r=t(n),e=n;break}return r}}function mde(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}const qP=1,Hy=2,_de="never",yde="no-overlap",QC="best-available",bde=5,vde={[QC]:wde,[yde]:Cde,[_de]:()=>{}},xde={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Vy{constructor(e){this._getCullBounds=gde(cde),this.opts={...xde,...e},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new D8({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new bn,this._modelMatrixInverse=new bn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new bn(n):new bn,o=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!ma(this._zRange,r)||o){o&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=r;const l=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:i}=e;for(const[o,s,l,h]of n){let A;if("west"in i)A=i.west<l&&i.east>o&&i.south<h&&i.north>s;else{const b=Math.min(i.top,i.bottom),C=Math.max(i.top,i.bottom);A=i.left<l&&i.right>o&&b<h&&C>s}if(A)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:n,zRange:i,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:l,extent:h,zoomOffset:A}=this.opts;return dde({viewport:e,maxZoom:r,minZoom:n,zRange:i,tileSize:l,extent:h,modelMatrix:o,modelMatrixInverse:s,zoomOffset:A})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:r}=this.opts;return{bbox:hde(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){const r=Math.floor(e.x/2),n=Math.floor(e.y/2),i=e.z-1;return{x:r,y:n,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||QC,r=new Array(this._cache.size);let n=0;for(const i of this._cache.values())r[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:vde[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(r[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,r=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,!i.isSelected&&!i.isVisible&&r.push(i));for(;e>0&&n>e&&r.length>0;)r.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const r of e.values())r.parent=null,r.children&&(r.children.length=0);for(const r of e.values()){const n=this._getNearestAncestor(r);r.parent=n,n?.children&&n.children.push(r)}}_resizeCache(){const{_cache:e,opts:r}=this,n=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:bde*this.selectedTiles.length),i=r.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>i){for(const[o,s]of e)if(!s.isVisible&&!s.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?s.byteLength:0,e.delete(o),this.opts.onTileUnload?.(s)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,s)=>o.zoom-s.zoom),this._dirty=!1)}_getTile(e,r){const n=this.getTileId(e);let i=this._cache.get(n),o=!1;return!i&&r?(i=new j8(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),o=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(o=!0),i&&o&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:r=0}=this;let n=e.index;for(;this.getTileZoom(n)>r;){n=this.getParentIndex(n);const i=this._getTile(n);if(i)return i}return null}}function wde(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!K8(e)&&ZC(e);for(const e of t)e.isVisible=!!(e.state&Hy)}function Cde(t){for(const r of t)r.state=0;for(const r of t)r.isSelected&&K8(r);const e=Array.from(t).sort((r,n)=>r.zoom-n.zoom);for(const r of e)if(r.isVisible=!!(r.state&Hy),r.children&&(r.isVisible||r.state&qP))for(const n of r.children)n.state=qP;else r.isSelected&&ZC(r)}function K8(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Hy,!0;e=e.parent}return!1}function ZC(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Hy:ZC(e)}const Ede={TilesetClass:Vy,data:{type:"data",value:[]},dataComparator:q_.equal,renderSubLayers:{type:"function",value:t=>new nu(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:QC,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class su extends Bs{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?n&&(r.setOptions(this._getTilesetOptions()),i?r.reloadAll():r.tiles.forEach(o=>{o.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:r,maxCacheByteSize:n,refinementStrategy:i,extent:o,maxZoom:s,minZoom:l,maxRequests:h,debounceTime:A,zoomOffset:b}=this.props;return{maxCacheSize:r,maxCacheByteSize:n,maxZoom:s,minZoom:l,tileSize:e,refinementStrategy:i,extent:o,maxRequests:h,debounceTime:A,zoomOffset:b,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:r,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:r,modelMatrix:n}),{isLoaded:o}=e,s=this.state.isLoaded!==o,l=this.state.frameNumber!==i;o&&(s||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:i}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:r,getTileData:n,fetch:i}=this.props,{signal:o}=e;return e.url=typeof r=="string"||Array.isArray(r)?gf(r,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const r=e.sourceLayer,n=r.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=r,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(n=>e.layers[0].props[n]!==r[n])&&(e.layers=e.layers.map(n=>n.clone(r)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=My(n,Boolean).map(i=>i.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,r)}}su.defaultProps=Ede,su.layerName="TileLayer";const YP=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,Bde={name:"trips",vs:YP,fs:YP,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},Tde={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class Y_ extends nh{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,Bde],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:r,trailLength:n,currentTime:i}=this.props,o={fadeTrail:r,trailLength:n,currentTime:i};this.state.model.shaderInputs.setProps({trips:o}),super.draw(e)}}Y_.layerName="TripsLayer",Y_.defaultProps=Tde;var kr=(function(t){t=t||{};var e=typeof t<"u"?t:{},r={},n;for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);var i="";function o(fe){return e.locateFile?e.locateFile(fe,i):i+fe}var s;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",s=function(fe,be,oe){var we=new XMLHttpRequest;we.open("GET",fe,!0),we.responseType="arraybuffer",we.onload=function(){if(we.status==200||we.status==0&&we.response){be(we.response);return}var g=Lt(fe);if(g){be(g.buffer);return}oe()},we.onerror=oe,we.send(null)};var l=e.print||console.log.bind(console),h=e.printErr||console.warn.bind(console);for(n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);r=null,e.arguments&&e.arguments;var A=0,b=function(fe){A=fe},C=function(){return A},S=8;function D(fe,be,oe,we){switch(oe=oe||"i8",oe.charAt(oe.length-1)==="*"&&(oe="i32"),oe){case"i1":J[fe>>0]=be;break;case"i8":J[fe>>0]=be;break;case"i16":Ee[fe>>1]=be;break;case"i32":ct[fe>>2]=be;break;case"i64":Yn=[be>>>0,(Tn=be,+vr(Tn)>=1?Tn>0?(yr(+_r(Tn/4294967296),4294967295)|0)>>>0:~~+Hn((Tn-+(~~Tn>>>0))/4294967296)>>>0:0)],ct[fe>>2]=Yn[0],ct[fe+4>>2]=Yn[1];break;case"float":Ce[fe>>2]=be;break;case"double":Le[fe>>3]=be;break;default:Oe("invalid type for setValue: "+oe)}}function N(fe,be,oe){switch(be=be||"i8",be.charAt(be.length-1)==="*"&&(be="i32"),be){case"i1":return J[fe>>0];case"i8":return J[fe>>0];case"i16":return Ee[fe>>1];case"i32":return ct[fe>>2];case"i64":return ct[fe>>2];case"float":return Ce[fe>>2];case"double":return Le[fe>>3];default:Oe("invalid type for getValue: "+be)}return null}var U=!1;function V(fe,be){fe||Oe("Assertion failed: "+be)}function j(fe){var be=e["_"+fe];return V(be,"Cannot call unknown function "+fe+", make sure it is exported"),be}function ee(fe,be,oe,we,g){var le={string:function(It){var jt=0;if(It!=null&&It!==0){var Nr=(It.length<<2)+1;jt=yt(Nr),ze(It,jt,Nr)}return jt},array:function(It){var jt=yt(It.length);return de(It,jt),jt}};function Ct(It){return be==="string"?Y(It):be==="boolean"?!!It:It}var Qe=j(fe),Et=[],Pt=0;if(we)for(var Dt=0;Dt<we.length;Dt++){var ht=le[oe[Dt]];ht?(Pt===0&&(Pt=xe()),Et[Dt]=ht(we[Dt])):Et[Dt]=we[Dt]}var Ft=Qe.apply(null,Et);return Ft=Ct(Ft),Pt!==0&&Bt(Pt),Ft}function Q(fe,be,oe,we){oe=oe||[];var g=oe.every(function(Ct){return Ct==="number"}),le=be!=="string";return le&&g&&!we?j(fe):function(){return ee(fe,be,oe,arguments)}}var X=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function pe(fe,be,oe){for(var we=be+oe,g=be;fe[g]&&!(g>=we);)++g;if(g-be>16&&fe.subarray&&X)return X.decode(fe.subarray(be,g));for(var le="";be<g;){var Ct=fe[be++];if(!(Ct&128)){le+=String.fromCharCode(Ct);continue}var Qe=fe[be++]&63;if((Ct&224)==192){le+=String.fromCharCode((Ct&31)<<6|Qe);continue}var Et=fe[be++]&63;if((Ct&240)==224?Ct=(Ct&15)<<12|Qe<<6|Et:Ct=(Ct&7)<<18|Qe<<12|Et<<6|fe[be++]&63,Ct<65536)le+=String.fromCharCode(Ct);else{var Pt=Ct-65536;le+=String.fromCharCode(55296|Pt>>10,56320|Pt&1023)}}return le}function Y(fe,be){return fe?pe(ue,fe,be):""}function Ge(fe,be,oe,we){if(!(we>0))return 0;for(var g=oe,le=oe+we-1,Ct=0;Ct<fe.length;++Ct){var Qe=fe.charCodeAt(Ct);if(Qe>=55296&&Qe<=57343){var Et=fe.charCodeAt(++Ct);Qe=65536+((Qe&1023)<<10)|Et&1023}if(Qe<=127){if(oe>=le)break;be[oe++]=Qe}else if(Qe<=2047){if(oe+1>=le)break;be[oe++]=192|Qe>>6,be[oe++]=128|Qe&63}else if(Qe<=65535){if(oe+2>=le)break;be[oe++]=224|Qe>>12,be[oe++]=128|Qe>>6&63,be[oe++]=128|Qe&63}else{if(oe+3>=le)break;be[oe++]=240|Qe>>18,be[oe++]=128|Qe>>12&63,be[oe++]=128|Qe>>6&63,be[oe++]=128|Qe&63}}return be[oe]=0,oe-g}function ze(fe,be,oe){return Ge(fe,ue,be,oe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function de(fe,be){J.set(fe,be)}function ce(fe,be){return fe%be>0&&(fe+=be-fe%be),fe}var De,J,ue,Ee,ct,Ce,Le;function Ne(fe){De=fe,e.HEAP8=J=new Int8Array(fe),e.HEAP16=Ee=new Int16Array(fe),e.HEAP32=ct=new Int32Array(fe),e.HEAPU8=ue=new Uint8Array(fe),e.HEAPU16=new Uint16Array(fe),e.HEAPU32=new Uint32Array(fe),e.HEAPF32=Ce=new Float32Array(fe),e.HEAPF64=Le=new Float64Array(fe)}var $e=5267040,it=24128,ot=e.TOTAL_MEMORY||33554432;e.buffer?De=e.buffer:De=new ArrayBuffer(ot),ot=De.byteLength,Ne(De),ct[it>>2]=$e;function dt(fe){for(;fe.length>0;){var be=fe.shift();if(typeof be=="function"){be();continue}var oe=be.func;typeof oe=="number"?be.arg===void 0?e.dynCall_v(oe):e.dynCall_vi(oe,be.arg):oe(be.arg===void 0?null:be.arg)}}var Mt=[],St=[],st=[],Ar=[];function Qt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)ln(e.preRun.shift());dt(Mt)}function Zt(){dt(St)}function Ht(){dt(st)}function dr(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Lr(e.postRun.shift());dt(Ar)}function ln(fe){Mt.unshift(fe)}function Lr(fe){Ar.unshift(fe)}var vr=Math.abs,Hn=Math.ceil,_r=Math.floor,yr=Math.min,un=0,Rr=null;function ci(fe){un++,e.monitorRunDependencies&&e.monitorRunDependencies(un)}function qn(fe){if(un--,e.monitorRunDependencies&&e.monitorRunDependencies(un),un==0&&Rr){var be=Rr;Rr=null,be()}}e.preloadedImages={},e.preloadedAudios={};var mn=null,ri="data:application/octet-stream;base64,";function Vn(fe){return String.prototype.startsWith?fe.startsWith(ri):fe.indexOf(ri)===0}var Tn,Yn;mn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var zt=24144;function gr(fe,be,oe,we){Oe("Assertion failed: "+Y(fe)+", at: "+[be?Y(be):"unknown filename",oe,we?Y(we):"unknown function"])}function Mr(){return J.length}function nn(fe,be,oe){ue.set(ue.subarray(be,be+oe),fe)}function _i(fe){return e.___errno_location&&(ct[e.___errno_location()>>2]=fe),fe}function Se(fe){Oe("OOM")}function kt(fe){try{var be=new ArrayBuffer(fe);return be.byteLength!=fe?void 0:(new Int8Array(be).set(J),H(be),Ne(be),1)}catch{}}function Jt(fe){var be=Mr(),oe=16777216,we=2147483648-oe;if(fe>we)return!1;for(var g=16777216,le=Math.max(be,g);le<fe;)le<=536870912?le=ce(2*le,oe):le=Math.min(ce((3*le+2147483648)/4,oe),we);var Ct=kt(le);return!!Ct}var cr=typeof atob=="function"?atob:function(fe){var be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",oe="",we,g,le,Ct,Qe,Et,Pt,Dt=0;fe=fe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ct=be.indexOf(fe.charAt(Dt++)),Qe=be.indexOf(fe.charAt(Dt++)),Et=be.indexOf(fe.charAt(Dt++)),Pt=be.indexOf(fe.charAt(Dt++)),we=Ct<<2|Qe>>4,g=(Qe&15)<<4|Et>>2,le=(Et&3)<<6|Pt,oe=oe+String.fromCharCode(we),Et!==64&&(oe=oe+String.fromCharCode(g)),Pt!==64&&(oe=oe+String.fromCharCode(le));while(Dt<fe.length);return oe};function qe(fe){try{for(var be=cr(fe),oe=new Uint8Array(be.length),we=0;we<be.length;++we)oe[we]=be.charCodeAt(we);return oe}catch{throw new Error("Converting base64 string to bytes failed.")}}function Lt(fe){if(Vn(fe))return qe(fe.slice(ri.length))}var ge={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Gt={b,c:C,d:gr,e:_i,f:Mr,g:nn,h:Jt,i:Se,o:zt,p:it},wt=(function(fe,be,oe){"almost asm";var we=new fe.Int8Array(oe),g=new fe.Int32Array(oe);new fe.Uint8Array(oe),new fe.Float32Array(oe);var le=new fe.Float64Array(oe),Ct=be.o|0,Qe=be.p|0,Et=fe.Math.floor,Pt=fe.Math.abs,Dt=fe.Math.sqrt,ht=fe.Math.pow,Ft=fe.Math.cos,It=fe.Math.sin,jt=fe.Math.tan,Nr=fe.Math.acos,er=fe.Math.asin,en=fe.Math.atan,cn=fe.Math.atan2,Jr=fe.Math.ceil,Kr=fe.Math.imul,zr=fe.Math.min,yi=fe.Math.max,Xr=fe.Math.clz32,mr=be.b,Be=be.c,Xt=be.d,tn=be.e,Vi=be.f,ya=be.g,ui=be.h,Wn=be.i,Te=24160;function Wo(y){return we=new Int8Array(y),g=new Int32Array(y),le=new Float64Array(y),oe=y,!0}function Jn(y){y=y|0;var _=0;return _=Te,Te=Te+y|0,Te=Te+15&-16,_|0}function Jo(){return Te|0}function Fi(y){y=y|0,Te=y}function hi(y,_){y=y|0,Te=y}function Mi(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;return(y|0)<0?(_=2,_|0):(y|0)>13780509?(_=Yo(15,_)|0,_|0):(v=((y|0)<0)<<31>>31,T=di(y|0,v|0,3,0)|0,w=Be()|0,v=An(y|0,v|0,1,0)|0,v=di(T|0,w|0,v|0,Be()|0)|0,v=An(v|0,Be()|0,1,0)|0,y=Be()|0,g[_>>2]=v,g[_+4>>2]=y,_=0,_|0)}function Ln(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,gs(y,_,v,w,0)|0}function gs(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0;if(d=Te,Te=Te+16|0,O=d,!(Wi(y,_,v,w,T)|0))return w=0,Te=d,w|0;do if((v|0)>=0){if((v|0)>13780509){if(M=Yo(15,O)|0,M|0)break;c=O,O=g[c>>2]|0,c=g[c+4>>2]|0}else M=((v|0)<0)<<31>>31,f=di(v|0,M|0,3,0)|0,c=Be()|0,M=An(v|0,M|0,1,0)|0,M=di(f|0,c|0,M|0,Be()|0)|0,M=An(M|0,Be()|0,1,0)|0,c=Be()|0,g[O>>2]=M,g[O+4>>2]=c,O=M;if(ia(w|0,0,O<<3|0)|0,T|0){ia(T|0,0,O<<2|0)|0,M=Gs(y,_,v,w,T,O,c,0)|0;break}M=lo(O,4)|0,M?(f=Gs(y,_,v,w,M,O,c,0)|0,Ur(M),M=f):M=13}else M=2;while(!1);return f=M,Te=d,f|0}function Wi(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0;if(G=Te,Te=Te+16|0,L=G,F=G+8|0,P=L,g[P>>2]=y,g[P+4>>2]=_,(v|0)<0)return F=2,Te=G,F|0;if(M=w,g[M>>2]=y,g[M+4>>2]=_,M=(T|0)!=0,M&&(g[T>>2]=0),Rn(y,_)|0)return F=9,Te=G,F|0;g[F>>2]=0;e:do if((v|0)>=1)if(M)for(m=1,f=0,E=0,P=1,M=y;;){if(!(f|E)){if(M=Sn(M,_,4,F,L)|0,M|0)break e;if(_=L,M=g[_>>2]|0,_=g[_+4>>2]|0,Rn(M,_)|0){M=9;break e}}if(M=Sn(M,_,g[22384+(E<<2)>>2]|0,F,L)|0,M|0)break e;if(_=L,M=g[_>>2]|0,_=g[_+4>>2]|0,y=w+(m<<3)|0,g[y>>2]=M,g[y+4>>2]=_,g[T+(m<<2)>>2]=P,y=f+1|0,O=(y|0)==(P|0),c=E+1|0,d=(c|0)==6,Rn(M,_)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else m=m+1|0,f=O?0:y,E=O?d?0:c:E}else for(m=1,f=0,E=0,P=1,M=y;;){if(!(f|E)){if(M=Sn(M,_,4,F,L)|0,M|0)break e;if(_=L,M=g[_>>2]|0,_=g[_+4>>2]|0,Rn(M,_)|0){M=9;break e}}if(M=Sn(M,_,g[22384+(E<<2)>>2]|0,F,L)|0,M|0)break e;if(_=L,M=g[_>>2]|0,_=g[_+4>>2]|0,y=w+(m<<3)|0,g[y>>2]=M,g[y+4>>2]=_,y=f+1|0,O=(y|0)==(P|0),c=E+1|0,d=(c|0)==6,Rn(M,_)|0){M=9;break e}if(P=P+(d&O&1)|0,(P|0)>(v|0)){M=0;break}else m=m+1|0,f=O?0:y,E=O?d?0:c:E}else M=0;while(!1);return F=M,Te=G,F|0}function Gs(y,_,v,w,T,M,O,c){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,M=M|0,O=O|0,c=c|0;var d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0;if(G=Te,Te=Te+16|0,L=G+8|0,F=G,d=Eo(y|0,_|0,M|0,O|0)|0,m=Be()|0,E=w+(d<<3)|0,W=E,te=g[W>>2]|0,W=g[W+4>>2]|0,f=(te|0)==(y|0)&(W|0)==(_|0),!((te|0)==0&(W|0)==0|f))do d=An(d|0,m|0,1,0)|0,d=is(d|0,Be()|0,M|0,O|0)|0,m=Be()|0,E=w+(d<<3)|0,te=E,W=g[te>>2]|0,te=g[te+4>>2]|0,f=(W|0)==(y|0)&(te|0)==(_|0);while(!((W|0)==0&(te|0)==0|f));if(d=T+(d<<2)|0,f&&(g[d>>2]|0)<=(c|0)||(te=E,g[te>>2]=y,g[te+4>>2]=_,g[d>>2]=c,(c|0)>=(v|0)))return te=0,Te=G,te|0;switch(f=c+1|0,g[L>>2]=0,d=Sn(y,_,2,L,F)|0,d|0){case 9:{P=9;break}case 0:{d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d||(P=9);break}}e:do if((P|0)==9){switch(g[L>>2]=0,d=Sn(y,_,3,L,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d|0)break e;break}default:break e}switch(g[L>>2]=0,d=Sn(y,_,1,L,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d|0)break e;break}default:break e}switch(g[L>>2]=0,d=Sn(y,_,5,L,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d|0)break e;break}default:break e}switch(g[L>>2]=0,d=Sn(y,_,4,L,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d|0)break e;break}default:break e}switch(g[L>>2]=0,d=Sn(y,_,6,L,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Gs(g[d>>2]|0,g[d+4>>2]|0,v,w,T,M,O,f)|0,d|0)break e;break}default:break e}return te=0,Te=G,te|0}while(!1);return te=d,Te=G,te|0}function Sn(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0;if(v>>>0>6)return T=1,T|0;if(E=(g[w>>2]|0)%6|0,g[w>>2]=E,(E|0)>0){M=0;do v=xo(v)|0,M=M+1|0;while((M|0)<(g[w>>2]|0))}if(E=Kt(y|0,_|0,45)|0,Be()|0,m=E&127,m>>>0>121)return T=5,T|0;d=ts(y,_)|0,M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15;e:do if(!M)f=8;else{for(;;){if(O=(15-M|0)*3|0,c=Kt(y|0,_|0,O|0)|0,Be()|0,c=c&7,(c|0)==7){_=5;break}if(F=(js(M)|0)==0,M=M+-1|0,P=tr(7,0,O|0)|0,_=_&~(Be()|0),L=tr(g[(F?432:16)+(c*28|0)+(v<<2)>>2]|0,0,O|0)|0,O=Be()|0,v=g[(F?640:224)+(c*28|0)+(v<<2)>>2]|0,y=L|y&~P,_=O|_,!v){v=0;break e}if(!M){f=8;break e}}return _|0}while(!1);(f|0)==8&&(F=g[848+(m*28|0)+(v<<2)>>2]|0,L=tr(F|0,0,45)|0,y=L|y,_=Be()|0|_&-1040385,v=g[4272+(m*28|0)+(v<<2)>>2]|0,(F&127|0)==127&&(F=tr(g[848+(m*28|0)+20>>2]|0,0,45)|0,_=Be()|0|_&-1040385,v=g[4272+(m*28|0)+20>>2]|0,y=wo(F|y,_)|0,_=Be()|0,g[w>>2]=(g[w>>2]|0)+1)),c=Kt(y|0,_|0,45)|0,Be()|0,c=c&127;e:do if(Ir(c)|0){t:do if((ts(y,_)|0)==1){if((m|0)!=(c|0))if(Ah(c,g[7696+(m*28|0)>>2]|0)|0){y=qa(y,_)|0,O=1,_=Be()|0;break}else Xt(23313,22416,436,22424);switch(d|0){case 3:{y=wo(y,_)|0,_=Be()|0,g[w>>2]=(g[w>>2]|0)+1,O=0;break t}case 5:{y=qa(y,_)|0,_=Be()|0,g[w>>2]=(g[w>>2]|0)+5,O=0;break t}case 0:return F=9,F|0;default:return F=1,F|0}}else O=0;while(!1);if((v|0)>0){M=0;do y=Sa(y,_)|0,_=Be()|0,M=M+1|0;while((M|0)!=(v|0))}if((m|0)!=(c|0)){if(!(Dn(c)|0)){if((O|0)!=0|(ts(y,_)|0)!=5)break;g[w>>2]=(g[w>>2]|0)+1;break}switch(E&127){case 8:case 118:break e}(ts(y,_)|0)!=3&&(g[w>>2]=(g[w>>2]|0)+1)}}else if((v|0)>0){M=0;do y=wo(y,_)|0,_=Be()|0,M=M+1|0;while((M|0)!=(v|0))}while(!1);return g[w>>2]=((g[w>>2]|0)+v|0)%6|0,F=T,g[F>>2]=y,g[F+4>>2]=_,F=0,F|0}function bc(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;for(c=Te,Te=Te+16|0,M=c,O=c+8|0,T=(Rn(y,_)|0)==0,T=T?1:2;;){if(g[O>>2]=0,f=(Sn(y,_,T,O,M)|0)==0,d=M,f&((g[d>>2]|0)==(v|0)?(g[d+4>>2]|0)==(w|0):0)){y=4;break}if(T=T+1|0,T>>>0>=7){T=7,y=4;break}}return(y|0)==4?(Te=c,T|0):0}function Ae(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0;if(F=Te,Te=Te+16|0,P=F,L=F+8|0,E=P,g[E>>2]=y,g[E+4>>2]=_,!v)return L=w,g[L>>2]=y,g[L+4>>2]=_,L=0,Te=F,L|0;g[L>>2]=0;e:do if(Rn(y,_)|0)y=9;else{if(M=(v|0)>0,M){T=0,E=y;do{if(y=Sn(E,_,4,L,P)|0,y|0)break e;if(_=P,E=g[_>>2]|0,_=g[_+4>>2]|0,T=T+1|0,Rn(E,_)|0){y=9;break e}}while((T|0)<(v|0));if(m=w,g[m>>2]=E,g[m+4>>2]=_,m=v+-1|0,M){f=0,y=1;do{if(T=22384+(f<<2)|0,(f|0)==5)for(O=g[T>>2]|0,M=0,T=y;;){if(y=P,y=Sn(g[y>>2]|0,g[y+4>>2]|0,O,L,P)|0,y|0)break e;if((M|0)!=(m|0))if(d=P,c=g[d>>2]|0,d=g[d+4>>2]|0,y=w+(T<<3)|0,g[y>>2]=c,g[y+4>>2]=d,!(Rn(c,d)|0))y=T+1|0;else{y=9;break e}else y=T;if(M=M+1|0,(M|0)>=(v|0))break;T=y}else for(O=P,d=g[T>>2]|0,c=0,T=y,M=g[O>>2]|0,O=g[O+4>>2]|0;;){if(y=Sn(M,O,d,L,P)|0,y|0)break e;if(O=P,M=g[O>>2]|0,O=g[O+4>>2]|0,y=w+(T<<3)|0,g[y>>2]=M,g[y+4>>2]=O,y=T+1|0,Rn(M,O)|0){y=9;break e}if(c=c+1|0,(c|0)>=(v|0))break;T=y}f=f+1|0}while(f>>>0<6);y=P,O=E,T=g[y>>2]|0,M=_,y=g[y+4>>2]|0}else O=E,T=E,M=_,y=_}else O=w,g[O>>2]=y,g[O+4>>2]=_,O=y,T=y,M=_,y=_;y=(O|0)==(T|0)&(M|0)==(y|0)?0:9}while(!1);return L=y,Te=F,L|0}function Me(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;if(c=Te,Te=Te+48|0,T=c+16|0,M=c+8|0,O=c,v|0)return O=15,Te=c,O|0;if(f=y,d=g[f+4>>2]|0,v=M,g[v>>2]=g[f>>2],g[v+4>>2]=d,ms(M,T),_=Ko(T,_,O)|0,!_){if(v=g[M>>2]|0,M=g[y+8>>2]|0,(M|0)>0){T=g[y+12>>2]|0,_=0;do v=(g[T+(_<<3)>>2]|0)+v|0,_=_+1|0;while((_|0)<(M|0))}_=O,T=g[_>>2]|0,_=g[_+4>>2]|0,M=((v|0)<0)<<31>>31,(_|0)<(M|0)|(_|0)==(M|0)&T>>>0<v>>>0?(_=O,g[_>>2]=v,g[_+4>>2]=M,_=M):v=T,d=An(v|0,_|0,12,0)|0,f=Be()|0,_=O,g[_>>2]=d,g[_+4>>2]=f,_=w,g[_>>2]=d,g[_+4>>2]=f,_=0}return f=_,Te=c,f|0}function We(y,_,v,w,T,M,O){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,M=M|0,O=O|0;var c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0,He=0,Je=0,et=0,Xe=0,Ye=0,pt=0,Ot=0,xt=0,Ut=0,sr=0,Er=0;if(Ot=Te,Te=Te+64|0,et=Ot+48|0,Xe=Ot+32|0,Ye=Ot+24|0,ve=Ot+8|0,Pe=Ot,d=g[y>>2]|0,(d|0)<=0)return pt=0,Te=Ot,pt|0;for(me=y+4|0,Ie=et+8|0,He=Xe+8|0,Je=ve+8|0,c=0,re=0;;){f=g[me>>2]|0,$=f+(re<<4)|0,g[et>>2]=g[$>>2],g[et+4>>2]=g[$+4>>2],g[et+8>>2]=g[$+8>>2],g[et+12>>2]=g[$+12>>2],(re|0)==(d+-1|0)?(g[Xe>>2]=g[f>>2],g[Xe+4>>2]=g[f+4>>2],g[Xe+8>>2]=g[f+8>>2],g[Xe+12>>2]=g[f+12>>2]):($=f+(re+1<<4)|0,g[Xe>>2]=g[$>>2],g[Xe+4>>2]=g[$+4>>2],g[Xe+8>>2]=g[$+8>>2],g[Xe+12>>2]=g[$+12>>2]),d=va(et,Xe,w,Ye)|0;e:do if(d)f=0,c=d;else if(f=Ye,d=g[f>>2]|0,f=g[f+4>>2]|0,(f|0)>0|(f|0)==0&d>>>0>0){te=0,$=0;t:for(;;){if(Er=+le[et>>3],W=Qr(d|0,f|0,te|0,$|0)|0,sr=+(W>>>0)+4294967296*+(Be()|0),xt=+(d>>>0)+4294967296*+(f|0),Ut=+(te>>>0)+4294967296*+($|0),le[ve>>3]=Er*sr/xt+ +le[Xe>>3]*Ut/xt,le[Je>>3]=+le[Ie>>3]*sr/xt+ +le[He>>3]*Ut/xt,d=Ya(ve,w,Pe)|0,d|0){c=d;break}W=Pe,G=g[W>>2]|0,W=g[W+4>>2]|0,P=Eo(G|0,W|0,_|0,v|0)|0,m=Be()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0;r:do if((f|0)==0&(E|0)==0)se=d,pt=16;else for(L=0,F=0;;){if((L|0)>(v|0)|(L|0)==(v|0)&F>>>0>_>>>0){c=1;break t}if((f|0)==(G|0)&(E|0)==(W|0))break r;if(d=An(P|0,m|0,1,0)|0,P=is(d|0,Be()|0,_|0,v|0)|0,m=Be()|0,F=An(F|0,L|0,1,0)|0,L=Be()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0,(f|0)==0&(E|0)==0){se=d,pt=16;break}}while(!1);if((pt|0)==16&&(pt=0,!((G|0)==0&(W|0)==0))&&(F=se,g[F>>2]=G,g[F+4>>2]=W,F=M+(g[T>>2]<<3)|0,g[F>>2]=G,g[F+4>>2]=W,F=T,F=An(g[F>>2]|0,g[F+4>>2]|0,1,0)|0,G=Be()|0,W=T,g[W>>2]=F,g[W+4>>2]=G),te=An(te|0,$|0,1,0)|0,$=Be()|0,f=Ye,d=g[f>>2]|0,f=g[f+4>>2]|0,!((f|0)>($|0)|(f|0)==($|0)&d>>>0>te>>>0)){f=1;break e}}f=0}else f=1;while(!1);if(re=re+1|0,!f){pt=21;break}if(d=g[y>>2]|0,(re|0)>=(d|0)){c=0,pt=21;break}}return(pt|0)==21?(Te=Ot,c|0):0}function vt(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0,He=0,Je=0,et=0,Xe=0,Ye=0,pt=0,Ot=0,xt=0,Ut=0,sr=0;if(sr=Te,Te=Te+112|0,pt=sr+80|0,d=sr+72|0,Ot=sr,xt=sr+56|0,v|0)return Ut=15,Te=sr,Ut|0;if(f=y+8|0,Ut=Xn((g[f>>2]<<5)+32|0)|0,!Ut)return Ut=13,Te=sr,Ut|0;if(wh(y,Ut),Xe=y,Ye=g[Xe+4>>2]|0,v=d,g[v>>2]=g[Xe>>2],g[v+4>>2]=Ye,ms(d,pt),v=Ko(pt,_,Ot)|0,v)Xe=0,Ye=0;else{if(v=g[d>>2]|0,M=g[f>>2]|0,(M|0)>0){O=g[y+12>>2]|0,T=0;do v=(g[O+(T<<3)>>2]|0)+v|0,T=T+1|0;while((T|0)!=(M|0));T=v}else T=v;v=Ot,M=g[v>>2]|0,v=g[v+4>>2]|0,O=((T|0)<0)<<31>>31,(v|0)<(O|0)|(v|0)==(O|0)&M>>>0<T>>>0?(v=Ot,g[v>>2]=T,g[v+4>>2]=O,v=O):T=M,Xe=An(T|0,v|0,12,0)|0,Ye=Be()|0,v=Ot,g[v>>2]=Xe,g[v+4>>2]=Ye,v=0}if(v|0)return Ur(Ut),Ut=v,Te=sr,Ut|0;if(T=lo(Xe,8)|0,!T)return Ur(Ut),Ut=13,Te=sr,Ut|0;if(c=lo(Xe,8)|0,!c)return Ur(Ut),Ur(T),Ut=13,Te=sr,Ut|0;Je=pt,g[Je>>2]=0,g[Je+4>>2]=0,Je=y,et=g[Je+4>>2]|0,v=d,g[v>>2]=g[Je>>2],g[v+4>>2]=et,v=We(d,Xe,Ye,_,pt,T,c)|0;e:do if(v)Ur(T),Ur(c),Ur(Ut);else{t:do if((g[f>>2]|0)>0){for(O=y+12|0,M=0;v=We((g[O>>2]|0)+(M<<3)|0,Xe,Ye,_,pt,T,c)|0,M=M+1|0,!(v|0);)if((M|0)>=(g[f>>2]|0))break t;Ur(T),Ur(c),Ur(Ut);break e}while(!1);(Ye|0)>0|(Ye|0)==0&Xe>>>0>0&&ia(c|0,0,Xe<<3|0)|0,et=pt,Je=g[et+4>>2]|0;t:do if((Je|0)>0|(Je|0)==0&(g[et>>2]|0)>>>0>0){me=T,Ie=c,He=T,Je=c,et=T,v=T,se=T,ve=c,Pe=c,T=c;r:for(;;){for(W=0,te=0,$=0,re=0,M=0,O=0;;){c=Ot,d=c+56|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));if(_=me+(W<<3)|0,f=g[_>>2]|0,_=g[_+4>>2]|0,Wi(f,_,1,Ot,0)|0){c=Ot,d=c+56|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));c=lo(7,4)|0,c|0&&(Gs(f,_,1,Ot,c,7,0,0)|0,Ur(c))}for(G=0;;){F=Ot+(G<<3)|0,L=g[F>>2]|0,F=g[F+4>>2]|0;n:do if((L|0)==0&(F|0)==0)c=M,d=O;else{if(m=Eo(L|0,F|0,Xe|0,Ye|0)|0,f=Be()|0,c=w+(m<<3)|0,_=c,d=g[_>>2]|0,_=g[_+4>>2]|0,!((d|0)==0&(_|0)==0)){E=0,P=0;do{if((E|0)>(Ye|0)|(E|0)==(Ye|0)&P>>>0>Xe>>>0)break r;if((d|0)==(L|0)&(_|0)==(F|0)){c=M,d=O;break n}c=An(m|0,f|0,1,0)|0,m=is(c|0,Be()|0,Xe|0,Ye|0)|0,f=Be()|0,P=An(P|0,E|0,1,0)|0,E=Be()|0,c=w+(m<<3)|0,_=c,d=g[_>>2]|0,_=g[_+4>>2]|0}while(!((d|0)==0&(_|0)==0))}(L|0)==0&(F|0)==0?(c=M,d=O):(Ol(L,F,xt)|0,qt(y,Ut,xt)|0&&(P=An(M|0,O|0,1,0)|0,O=Be()|0,E=c,g[E>>2]=L,g[E+4>>2]=F,M=Ie+(M<<3)|0,g[M>>2]=L,g[M+4>>2]=F,M=P),c=M,d=O)}while(!1);if(G=G+1|0,G>>>0>=7)break;M=c,O=d}if(W=An(W|0,te|0,1,0)|0,te=Be()|0,$=An($|0,re|0,1,0)|0,re=Be()|0,O=pt,M=g[O>>2]|0,O=g[O+4>>2]|0,(re|0)<(O|0)|(re|0)==(O|0)&$>>>0<M>>>0)M=c,O=d;else break}if((O|0)>0|(O|0)==0&M>>>0>0){M=0,O=0;do re=me+(M<<3)|0,g[re>>2]=0,g[re+4>>2]=0,M=An(M|0,O|0,1,0)|0,O=Be()|0,re=pt,$=g[re+4>>2]|0;while((O|0)<($|0)|((O|0)==($|0)?M>>>0<(g[re>>2]|0)>>>0:0))}if(re=pt,g[re>>2]=c,g[re+4>>2]=d,(d|0)>0|(d|0)==0&c>>>0>0)G=T,W=Pe,te=et,$=ve,re=Ie,T=se,Pe=v,ve=He,se=G,v=W,et=Je,Je=te,He=$,Ie=me,me=re;else break t}Ur(He),Ur(Je),Ur(Ut),v=1;break e}else v=c;while(!1);Ur(Ut),Ur(T),Ur(v),v=0}while(!1);return Ut=v,Te=sr,Ut|0}function Vt(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(m=Te,Te=Te+176|0,d=m,(_|0)<1)return Ia(v,0,0),f=0,Te=m,f|0;for(c=y,c=Kt(g[c>>2]|0,g[c+4>>2]|0,52)|0,Be()|0,Ia(v,(_|0)>6?_:6,c&15),c=0;w=y+(c<<3)|0,w=Dl(g[w>>2]|0,g[w+4>>2]|0,d)|0,!(w|0);){if(w=g[d>>2]|0,(w|0)>0){O=0;do M=d+8+(O<<4)|0,O=O+1|0,w=d+8+(((O|0)%(w|0)|0)<<4)|0,T=xr(v,w,M)|0,T?ns(v,T)|0:Rc(v,M,w)|0,w=g[d>>2]|0;while((O|0)<(w|0))}if(c=c+1|0,(c|0)>=(_|0)){w=0,f=13;break}}return(f|0)==13?(Te=m,w|0):(ra(v),f=w,Te=m,f|0)}function jr(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;if(M=Te,Te=Te+32|0,w=M,T=M+16|0,y=Vt(y,_,T)|0,y|0)return v=y,Te=M,v|0;if(g[v>>2]=0,g[v+4>>2]=0,g[v+8>>2]=0,y=ao(T)|0,y|0)do{_=uA(v)|0;do hA(_,y)|0,O=y+16|0,g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],g[w+12>>2]=g[O+12>>2],ns(T,y)|0,y=ur(T,w)|0;while((y|0)!=0);y=ao(T)|0}while((y|0)!=0);return ra(T),y=Lc(v)|0,y?(Ul(v),O=y,Te=M,O|0):(O=0,Te=M,O|0)}function Ir(y){return y=y|0,y>>>0>121?(y=0,y|0):(y=g[7696+(y*28|0)+16>>2]|0,y|0)}function Dn(y){return y=y|0,(y|0)==4|(y|0)==117|0}function Ts(y){return y=y|0,g[11120+((g[y>>2]|0)*216|0)+((g[y+4>>2]|0)*72|0)+((g[y+8>>2]|0)*24|0)+(g[y+12>>2]<<3)>>2]|0}function cs(y){return y=y|0,g[11120+((g[y>>2]|0)*216|0)+((g[y+4>>2]|0)*72|0)+((g[y+8>>2]|0)*24|0)+(g[y+12>>2]<<3)+4>>2]|0}function to(y,_){y=y|0,_=_|0,y=7696+(y*28|0)|0,g[_>>2]=g[y>>2],g[_+4>>2]=g[y+4>>2],g[_+8>>2]=g[y+8>>2],g[_+12>>2]=g[y+12>>2]}function Pf(y,_){y=y|0,_=_|0;var v=0,w=0;if(_>>>0>20)return _=-1,_|0;do if((g[11120+(_*216|0)>>2]|0)!=(y|0))if((g[11120+(_*216|0)+8>>2]|0)!=(y|0))if((g[11120+(_*216|0)+16>>2]|0)!=(y|0))if((g[11120+(_*216|0)+24>>2]|0)!=(y|0))if((g[11120+(_*216|0)+32>>2]|0)!=(y|0))if((g[11120+(_*216|0)+40>>2]|0)!=(y|0))if((g[11120+(_*216|0)+48>>2]|0)!=(y|0))if((g[11120+(_*216|0)+56>>2]|0)!=(y|0))if((g[11120+(_*216|0)+64>>2]|0)!=(y|0))if((g[11120+(_*216|0)+72>>2]|0)!=(y|0))if((g[11120+(_*216|0)+80>>2]|0)!=(y|0))if((g[11120+(_*216|0)+88>>2]|0)!=(y|0))if((g[11120+(_*216|0)+96>>2]|0)!=(y|0))if((g[11120+(_*216|0)+104>>2]|0)!=(y|0))if((g[11120+(_*216|0)+112>>2]|0)!=(y|0))if((g[11120+(_*216|0)+120>>2]|0)!=(y|0))if((g[11120+(_*216|0)+128>>2]|0)!=(y|0))if((g[11120+(_*216|0)+136>>2]|0)==(y|0))y=2,v=1,w=2;else{if((g[11120+(_*216|0)+144>>2]|0)==(y|0)){y=0,v=2,w=0;break}if((g[11120+(_*216|0)+152>>2]|0)==(y|0)){y=0,v=2,w=1;break}if((g[11120+(_*216|0)+160>>2]|0)==(y|0)){y=0,v=2,w=2;break}if((g[11120+(_*216|0)+168>>2]|0)==(y|0)){y=1,v=2,w=0;break}if((g[11120+(_*216|0)+176>>2]|0)==(y|0)){y=1,v=2,w=1;break}if((g[11120+(_*216|0)+184>>2]|0)==(y|0)){y=1,v=2,w=2;break}if((g[11120+(_*216|0)+192>>2]|0)==(y|0)){y=2,v=2,w=0;break}if((g[11120+(_*216|0)+200>>2]|0)==(y|0)){y=2,v=2,w=1;break}if((g[11120+(_*216|0)+208>>2]|0)==(y|0)){y=2,v=2,w=2;break}else y=-1;return y|0}else y=2,v=1,w=1;else y=2,v=1,w=0;else y=1,v=1,w=2;else y=1,v=1,w=1;else y=1,v=1,w=0;else y=0,v=1,w=2;else y=0,v=1,w=1;else y=0,v=1,w=0;else y=2,v=0,w=2;else y=2,v=0,w=1;else y=2,v=0,w=0;else y=1,v=0,w=2;else y=1,v=0,w=1;else y=1,v=0,w=0;else y=0,v=0,w=2;else y=0,v=0,w=1;else y=0,v=0,w=0;while(!1);return _=g[11120+(_*216|0)+(v*72|0)+(y*24|0)+(w<<3)+4>>2]|0,_|0}function Ah(y,_){return y=y|0,_=_|0,(g[7696+(y*28|0)+20>>2]|0)==(_|0)?(_=1,_|0):(_=(g[7696+(y*28|0)+24>>2]|0)==(_|0),_|0)}function ba(y,_){return y=y|0,_=_|0,g[848+(y*28|0)+(_<<2)>>2]|0}function vc(y,_){return y=y|0,_=_|0,(g[848+(y*28|0)>>2]|0)==(_|0)?(_=0,_|0):(g[848+(y*28|0)+4>>2]|0)==(_|0)?(_=1,_|0):(g[848+(y*28|0)+8>>2]|0)==(_|0)?(_=2,_|0):(g[848+(y*28|0)+12>>2]|0)==(_|0)?(_=3,_|0):(g[848+(y*28|0)+16>>2]|0)==(_|0)?(_=4,_|0):(g[848+(y*28|0)+20>>2]|0)==(_|0)?(_=5,_|0):((g[848+(y*28|0)+24>>2]|0)==(_|0)?6:7)|0}function xc(){return 122}function Lf(y){y=y|0;var _=0,v=0,w=0;_=0;do tr(_|0,0,45)|0,w=Be()|0|134225919,v=y+(_<<3)|0,g[v>>2]=-1,g[v+4>>2]=w,_=_+1|0;while((_|0)!=122);return 0}function wc(y){return y=y|0,+le[y+16>>3]<+le[y+24>>3]|0}function zs(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;return v=+le[_>>3],!(v>=+le[y+8>>3])||!(v<=+le[y>>3])?(_=0,_|0):(w=+le[y+16>>3],v=+le[y+24>>3],T=+le[_+8>>3],_=T>=v,y=T<=w&1,w<v?_&&(y=1):_||(y=0),_=(y|0)!=0,_|0)}function Ko(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0;F=Te,Te=Te+288|0,m=F+264|0,E=F+96|0,f=F,c=f,d=c+96|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));return _=Tc(_,f)|0,_|0?(L=_,Te=F,L|0):(d=f,f=g[d>>2]|0,d=g[d+4>>2]|0,Ol(f,d,m)|0,Dl(f,d,E)|0,O=+nl(m,E+8|0),le[m>>3]=+le[y>>3],d=m+8|0,le[d>>3]=+le[y+16>>3],le[E>>3]=+le[y+8>>3],f=E+8|0,le[f>>3]=+le[y+24>>3],T=+nl(m,E),W=+le[d>>3]-+le[f>>3],M=+Pt(+W),G=+le[m>>3]-+le[E>>3],w=+Pt(+G),!(W==0|G==0)&&(W=+jl(+M,+w),W=+Jr(+(T*T/+Oc(+(W/+Oc(+M,+w)),3)/(O*(O*2.59807621135)*.8))),le[Ct>>3]=W,P=~~W>>>0,L=+Pt(W)>=1?W>0?~~+zr(+Et(W/4294967296),4294967295)>>>0:~~+Jr((W-+(~~W>>>0))/4294967296)>>>0:0,(g[Ct+4>>2]&2146435072|0)!=2146435072)?(E=(P|0)==0&(L|0)==0,_=v,g[_>>2]=E?1:P,g[_+4>>2]=E?0:L,_=0):_=1,L=_,Te=F,L|0)}function va(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0;f=Te,Te=Te+288|0,O=f+264|0,c=f+96|0,d=f,T=d,M=T+96|0;do g[T>>2]=0,T=T+4|0;while((T|0)<(M|0));return v=Tc(v,d)|0,v|0?(w=v,Te=f,w|0):(v=d,T=g[v>>2]|0,v=g[v+4>>2]|0,Ol(T,v,O)|0,Dl(T,v,c)|0,m=+nl(O,c+8|0),m=+Jr(+(+nl(y,_)/(m*2))),le[Ct>>3]=m,v=~~m>>>0,T=+Pt(m)>=1?m>0?~~+zr(+Et(m/4294967296),4294967295)>>>0:~~+Jr((m-+(~~m>>>0))/4294967296)>>>0:0,(g[Ct+4>>2]&2146435072|0)==2146435072?(w=1,Te=f,w|0):(d=(v|0)==0&(T|0)==0,g[w>>2]=d?1:v,g[w+4>>2]=d?0:T,w=0,Te=f,w|0))}function Ja(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0,g[y>>2]=_,g[y+4>>2]=v,g[y+8>>2]=w}function xa(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;E=_+8|0,g[E>>2]=0,d=+le[y>>3],O=+Pt(+d),f=+le[y+8>>3],c=+Pt(+f)/.8660254037844386,O=O+c*.5,v=~~O,y=~~c,O=O-+(v|0),c=c-+(y|0);do if(O<.5)if(O<.3333333333333333)if(g[_>>2]=v,c<(O+1)*.5){g[_+4>>2]=y;break}else{y=y+1|0,g[_+4>>2]=y;break}else if(P=1-O,y=(!(c<P)&1)+y|0,g[_+4>>2]=y,P<=c&c<O*2){v=v+1|0,g[_>>2]=v;break}else{g[_>>2]=v;break}else{if(!(O<.6666666666666666))if(v=v+1|0,g[_>>2]=v,c<O*.5){g[_+4>>2]=y;break}else{y=y+1|0,g[_+4>>2]=y;break}if(c<1-O){if(g[_+4>>2]=y,O*2+-1<c){g[_>>2]=v;break}}else y=y+1|0,g[_+4>>2]=y;v=v+1|0,g[_>>2]=v}while(!1);do if(d<0)if(y&1){m=(y+1|0)/2|0,m=Qr(v|0,((v|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-((+(m>>>0)+4294967296*+(Be()|0))*2+1)),g[_>>2]=v;break}else{m=(y|0)/2|0,m=Qr(v|0,((v|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-(+(m>>>0)+4294967296*+(Be()|0))*2),g[_>>2]=v;break}while(!1);m=_+4|0,f<0&&(v=v-((y<<1|1|0)/2|0)|0,g[_>>2]=v,y=0-y|0,g[m>>2]=y),w=y-v|0,(v|0)<0?(T=0-v|0,g[m>>2]=w,g[E>>2]=T,g[_>>2]=0,y=w,v=0):T=0,(y|0)<0&&(v=v-y|0,g[_>>2]=v,T=T-y|0,g[E>>2]=T,g[m>>2]=0,y=0),M=v-T|0,w=y-T|0,(T|0)<0&&(g[_>>2]=M,g[m>>2]=w,g[E>>2]=0,y=w,v=M,T=0),w=(y|0)<(v|0)?y:v,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[_>>2]=v-w,g[m>>2]=y-w,g[E>>2]=T-w)}function bi(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0;_=g[y>>2]|0,O=y+4|0,v=g[O>>2]|0,(_|0)<0&&(v=v-_|0,g[O>>2]=v,M=y+8|0,g[M>>2]=(g[M>>2]|0)-_,g[y>>2]=0,_=0),(v|0)<0?(_=_-v|0,g[y>>2]=_,M=y+8|0,T=(g[M>>2]|0)-v|0,g[M>>2]=T,g[O>>2]=0,v=0):(T=y+8|0,M=T,T=g[T>>2]|0),(T|0)<0&&(_=_-T|0,g[y>>2]=_,v=v-T|0,g[O>>2]=v,g[M>>2]=0,T=0),w=(v|0)<(_|0)?v:_,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[y>>2]=_-w,g[O>>2]=v-w,g[M>>2]=T-w)}function Lo(y,_){y=y|0,_=_|0;var v=0,w=0;w=g[y+8>>2]|0,v=+((g[y+4>>2]|0)-w|0),le[_>>3]=+((g[y>>2]|0)-w|0)-v*.5,le[_+8>>3]=v*.8660254037844386}function zn(y,_,v){y=y|0,_=_|0,v=v|0,g[v>>2]=(g[_>>2]|0)+(g[y>>2]|0),g[v+4>>2]=(g[_+4>>2]|0)+(g[y+4>>2]|0),g[v+8>>2]=(g[_+8>>2]|0)+(g[y+8>>2]|0)}function fi(y,_,v){y=y|0,_=_|0,v=v|0,g[v>>2]=(g[y>>2]|0)-(g[_>>2]|0),g[v+4>>2]=(g[y+4>>2]|0)-(g[_+4>>2]|0),g[v+8>>2]=(g[y+8>>2]|0)-(g[_+8>>2]|0)}function Ka(y,_){y=y|0,_=_|0;var v=0,w=0;v=Kr(g[y>>2]|0,_)|0,g[y>>2]=v,v=y+4|0,w=Kr(g[v>>2]|0,_)|0,g[v>>2]=w,y=y+8|0,_=Kr(g[y>>2]|0,_)|0,g[y>>2]=_}function Cc(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;O=g[y>>2]|0,c=(O|0)<0,w=(g[y+4>>2]|0)-(c?O:0)|0,M=(w|0)<0,T=(M?0-w|0:0)+((g[y+8>>2]|0)-(c?O:0))|0,v=(T|0)<0,y=v?0:T,_=(M?0:w)-(v?T:0)|0,T=(c?0:O)-(M?w:0)-(v?T:0)|0,v=(_|0)<(T|0)?_:T,v=(y|0)<(v|0)?y:v,w=(v|0)>0,y=y-(w?v:0)|0,_=_-(w?v:0)|0;e:do switch(T-(w?v:0)|0){case 0:switch(_|0){case 0:return c=(y|0)==0?0:(y|0)==1?1:7,c|0;case 1:return c=(y|0)==0?2:(y|0)==1?3:7,c|0;default:break e}case 1:switch(_|0){case 0:return c=(y|0)==0?4:(y|0)==1?5:7,c|0;case 1:{if(!y)y=6;else break e;return y|0}default:break e}}while(!1);return c=7,c|0}function sA(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;O=y+8|0,T=g[O>>2]|0,M=(g[y>>2]|0)-T|0,c=y+4|0,T=(g[c>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return c=1,c|0;if(_=M*3|0,(T|0)>0){if((2147483647-T|0)<(T|0))return c=1,c|0}else if((-2147483648-T|0)>(T|0))return c=1,c|0;if(w=T<<1,(M|0)>-1){if((_|-2147483648|0)>=(T|0))return c=1,c|0}else if((_^-2147483648|0)<(T|0))return c=1,c|0;if(v){if((2147483647-M|0)<(w|0))_=1;else{v=w;break}return _|0}else{if((-2147483648-M|0)>(w|0))_=1;else{v=w;break}return _|0}}else v=T<<1,_=M*3|0;while(!1);w=Ki(+(_-T|0)/7)|0,g[y>>2]=w,T=Ki(+(v+M|0)/7)|0,g[c>>2]=T,g[O>>2]=0,v=(T|0)<(w|0),_=v?w:T,v=v?T:w;do if((v|0)<0){if((_|0)>0){if((_|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-_|0)>=(v|0)))break;Xt(23313,22444,355,22455)}if((v|0)==-2147483648|(-2147483648-_|0)>(v|0)&&Xt(23313,22444,355,22455),(_|0)>-1){if((_|-2147483648|0)<(v|0))break;Xt(23313,22444,355,22455)}else{if((_^-2147483648|0)>=(v|0))break;Xt(23313,22444,355,22455)}}while(!1);return _=T-w|0,(w|0)<0?(v=0-w|0,g[c>>2]=_,g[O>>2]=v,g[y>>2]=0,w=0):(_=T,v=0),(_|0)<0&&(w=w-_|0,g[y>>2]=w,v=v-_|0,g[O>>2]=v,g[c>>2]=0,_=0),M=w-v|0,T=_-v|0,(v|0)<0?(g[y>>2]=M,g[c>>2]=T,g[O>>2]=0,_=T,T=M,v=0):T=w,w=(_|0)<(T|0)?_:T,w=(v|0)<(w|0)?v:w,(w|0)<=0?(c=0,c|0):(g[y>>2]=T-w,g[c>>2]=_-w,g[O>>2]=v-w,c=0,c|0)}function oA(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;O=y+8|0,T=g[O>>2]|0,M=(g[y>>2]|0)-T|0,c=y+4|0,T=(g[c>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0))return c=1,c|0;if(_=M<<1,(T|0)>0){if((2147483647-T|0)<(T|0)||(2147483647-(T<<1)|0)<(T|0))return c=1,c|0}else if((-2147483648-T|0)>(T|0)||(-2147483648-(T<<1)|0)>(T|0))return c=1,c|0;if(w=T*3|0,v){if((2147483647-_|0)<(T|0))return c=1,c|0}else if((-2147483648-_|0)>(T|0))return c=1,c|0;if((T|0)>-1){if((w|-2147483648|0)<(M|0)){v=w;break}else _=1;return _|0}else{if((w^-2147483648|0)<(M|0))_=1;else{v=w;break}return _|0}}else v=T*3|0,_=M<<1;while(!1);w=Ki(+(_+T|0)/7)|0,g[y>>2]=w,T=Ki(+(v-M|0)/7)|0,g[c>>2]=T,g[O>>2]=0,v=(T|0)<(w|0),_=v?w:T,v=v?T:w;do if((v|0)<0){if((_|0)>0){if((_|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-_|0)>=(v|0)))break;Xt(23313,22444,404,22469)}if((v|0)==-2147483648|(-2147483648-_|0)>(v|0)&&Xt(23313,22444,404,22469),(_|0)>-1){if((_|-2147483648|0)<(v|0))break;Xt(23313,22444,404,22469)}else{if((_^-2147483648|0)>=(v|0))break;Xt(23313,22444,404,22469)}}while(!1);return _=T-w|0,(w|0)<0?(v=0-w|0,g[c>>2]=_,g[O>>2]=v,g[y>>2]=0,w=0):(_=T,v=0),(_|0)<0&&(w=w-_|0,g[y>>2]=w,v=v-_|0,g[O>>2]=v,g[c>>2]=0,_=0),M=w-v|0,T=_-v|0,(v|0)<0?(g[y>>2]=M,g[c>>2]=T,g[O>>2]=0,_=T,T=M,v=0):T=w,w=(_|0)<(T|0)?_:T,w=(v|0)<(w|0)?v:w,(w|0)<=0?(c=0,c|0):(g[y>>2]=T-w,g[c>>2]=_-w,g[O>>2]=v-w,c=0,c|0)}function gh(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;O=y+8|0,v=g[O>>2]|0,_=(g[y>>2]|0)-v|0,c=y+4|0,v=(g[c>>2]|0)-v|0,w=Ki(+((_*3|0)-v|0)/7)|0,g[y>>2]=w,_=Ki(+((v<<1)+_|0)/7)|0,g[c>>2]=_,g[O>>2]=0,v=_-w|0,(w|0)<0?(M=0-w|0,g[c>>2]=v,g[O>>2]=M,g[y>>2]=0,_=v,w=0,v=M):v=0,(_|0)<0&&(w=w-_|0,g[y>>2]=w,v=v-_|0,g[O>>2]=v,g[c>>2]=0,_=0),M=w-v|0,T=_-v|0,(v|0)<0?(g[y>>2]=M,g[c>>2]=T,g[O>>2]=0,_=T,T=M,v=0):T=w,w=(_|0)<(T|0)?_:T,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(g[y>>2]=T-w,g[c>>2]=_-w,g[O>>2]=v-w)}function lu(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;O=y+8|0,v=g[O>>2]|0,_=(g[y>>2]|0)-v|0,c=y+4|0,v=(g[c>>2]|0)-v|0,w=Ki(+((_<<1)+v|0)/7)|0,g[y>>2]=w,_=Ki(+((v*3|0)-_|0)/7)|0,g[c>>2]=_,g[O>>2]=0,v=_-w|0,(w|0)<0?(M=0-w|0,g[c>>2]=v,g[O>>2]=M,g[y>>2]=0,_=v,w=0,v=M):v=0,(_|0)<0&&(w=w-_|0,g[y>>2]=w,v=v-_|0,g[O>>2]=v,g[c>>2]=0,_=0),M=w-v|0,T=_-v|0,(v|0)<0?(g[y>>2]=M,g[c>>2]=T,g[O>>2]=0,_=T,T=M,v=0):T=w,w=(_|0)<(T|0)?_:T,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(g[y>>2]=T-w,g[c>>2]=_-w,g[O>>2]=v-w)}function Ml(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;_=g[y>>2]|0,O=y+4|0,v=g[O>>2]|0,c=y+8|0,w=g[c>>2]|0,T=v+(_*3|0)|0,g[y>>2]=T,v=w+(v*3|0)|0,g[O>>2]=v,_=(w*3|0)+_|0,g[c>>2]=_,w=v-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=w,g[c>>2]=_,g[y>>2]=0,v=w,w=0):w=T,(v|0)<0&&(w=w-v|0,g[y>>2]=w,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=w-_|0,T=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,_=0):T=v,v=(T|0)<(w|0)?T:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=w-v,g[O>>2]=T-v,g[c>>2]=_-v)}function Xo(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;T=g[y>>2]|0,O=y+4|0,_=g[O>>2]|0,c=y+8|0,v=g[c>>2]|0,w=(_*3|0)+T|0,T=v+(T*3|0)|0,g[y>>2]=T,g[O>>2]=w,_=(v*3|0)+_|0,g[c>>2]=_,v=w-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=v,g[c>>2]=_,g[y>>2]=0,T=0):v=w,(v|0)<0&&(T=T-v|0,g[y>>2]=T,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=T-_|0,w=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=w,g[c>>2]=0,T=M,_=0):w=v,v=(w|0)<(T|0)?w:T,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=T-v,g[O>>2]=w-v,g[c>>2]=_-v)}function mh(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0;(_+-1|0)>>>0>=6||(T=(g[15440+(_*12|0)>>2]|0)+(g[y>>2]|0)|0,g[y>>2]=T,c=y+4|0,w=(g[15440+(_*12|0)+4>>2]|0)+(g[c>>2]|0)|0,g[c>>2]=w,O=y+8|0,_=(g[15440+(_*12|0)+8>>2]|0)+(g[O>>2]|0)|0,g[O>>2]=_,v=w-T|0,(T|0)<0?(_=_-T|0,g[c>>2]=v,g[O>>2]=_,g[y>>2]=0,w=0):(v=w,w=T),(v|0)<0&&(w=w-v|0,g[y>>2]=w,_=_-v|0,g[O>>2]=_,g[c>>2]=0,v=0),M=w-_|0,T=v-_|0,(_|0)<0?(g[y>>2]=M,g[c>>2]=T,g[O>>2]=0,w=M,_=0):T=v,v=(T|0)<(w|0)?T:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=w-v,g[c>>2]=T-v,g[O>>2]=_-v))}function _h(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;T=g[y>>2]|0,O=y+4|0,_=g[O>>2]|0,c=y+8|0,v=g[c>>2]|0,w=_+T|0,T=v+T|0,g[y>>2]=T,g[O>>2]=w,_=v+_|0,g[c>>2]=_,v=w-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=v,g[c>>2]=_,g[y>>2]=0,w=0):(v=w,w=T),(v|0)<0&&(w=w-v|0,g[y>>2]=w,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=w-_|0,T=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,_=0):T=v,v=(T|0)<(w|0)?T:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=w-v,g[O>>2]=T-v,g[c>>2]=_-v)}function cu(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;_=g[y>>2]|0,O=y+4|0,w=g[O>>2]|0,c=y+8|0,v=g[c>>2]|0,T=w+_|0,g[y>>2]=T,w=v+w|0,g[O>>2]=w,_=v+_|0,g[c>>2]=_,v=w-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=v,g[c>>2]=_,g[y>>2]=0,w=0):(v=w,w=T),(v|0)<0&&(w=w-v|0,g[y>>2]=w,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=w-_|0,T=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,_=0):T=v,v=(T|0)<(w|0)?T:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=w-v,g[O>>2]=T-v,g[c>>2]=_-v)}function xo(y){switch(y=y|0,y|0){case 1:{y=5;break}case 5:{y=4;break}case 4:{y=6;break}case 6:{y=2;break}case 2:{y=3;break}case 3:{y=1;break}}return y|0}function ro(y){switch(y=y|0,y|0){case 1:{y=3;break}case 3:{y=2;break}case 2:{y=6;break}case 6:{y=4;break}case 4:{y=5;break}case 5:{y=1;break}}return y|0}function yh(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;_=g[y>>2]|0,O=y+4|0,v=g[O>>2]|0,c=y+8|0,w=g[c>>2]|0,T=v+(_<<1)|0,g[y>>2]=T,v=w+(v<<1)|0,g[O>>2]=v,_=(w<<1)+_|0,g[c>>2]=_,w=v-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=w,g[c>>2]=_,g[y>>2]=0,v=w,w=0):w=T,(v|0)<0&&(w=w-v|0,g[y>>2]=w,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=w-_|0,T=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,_=0):T=v,v=(T|0)<(w|0)?T:w,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=w-v,g[O>>2]=T-v,g[c>>2]=_-v)}function Gi(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;T=g[y>>2]|0,O=y+4|0,_=g[O>>2]|0,c=y+8|0,v=g[c>>2]|0,w=(_<<1)+T|0,T=v+(T<<1)|0,g[y>>2]=T,g[O>>2]=w,_=(v<<1)+_|0,g[c>>2]=_,v=w-T|0,(T|0)<0?(_=_-T|0,g[O>>2]=v,g[c>>2]=_,g[y>>2]=0,T=0):v=w,(v|0)<0&&(T=T-v|0,g[y>>2]=T,_=_-v|0,g[c>>2]=_,g[O>>2]=0,v=0),M=T-_|0,w=v-_|0,(_|0)<0?(g[y>>2]=M,g[O>>2]=w,g[c>>2]=0,T=M,_=0):w=v,v=(w|0)<(T|0)?w:T,v=(_|0)<(v|0)?_:v,!((v|0)<=0)&&(g[y>>2]=T-v,g[O>>2]=w-v,g[c>>2]=_-v)}function Ec(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0;return O=(g[y>>2]|0)-(g[_>>2]|0)|0,c=(O|0)<0,w=(g[y+4>>2]|0)-(g[_+4>>2]|0)-(c?O:0)|0,M=(w|0)<0,T=(c?0-O|0:0)+(g[y+8>>2]|0)-(g[_+8>>2]|0)+(M?0-w|0:0)|0,y=(T|0)<0,_=y?0:T,v=(M?0:w)-(y?T:0)|0,T=(c?0:O)-(M?w:0)-(y?T:0)|0,y=(v|0)<(T|0)?v:T,y=(_|0)<(y|0)?_:y,w=(y|0)>0,_=_-(w?y:0)|0,v=v-(w?y:0)|0,y=T-(w?y:0)|0,y=(y|0)>-1?y:0-y|0,v=(v|0)>-1?v:0-v|0,_=(_|0)>-1?_:0-_|0,_=(v|0)>(_|0)?v:_,((y|0)>(_|0)?y:_)|0}function wa(y,_){y=y|0,_=_|0;var v=0;v=g[y+8>>2]|0,g[_>>2]=(g[y>>2]|0)-v,g[_+4>>2]=(g[y+4>>2]|0)-v}function Ca(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0;w=g[y>>2]|0,g[_>>2]=w,T=g[y+4>>2]|0,O=_+4|0,g[O>>2]=T,c=_+8|0,g[c>>2]=0,v=(T|0)<(w|0),y=v?w:T,v=v?T:w;do if((v|0)<0){if((y|0)>0){if((y|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-y|0)>=(v|0)))break;return y=1,y|0}if((v|0)==-2147483648|(-2147483648-y|0)>(v|0))return _=1,_|0;if((y|0)>-1){if((y|-2147483648|0)<(v|0))break;return y=1,y|0}else{if((y^-2147483648|0)<(v|0))y=1;else break;return y|0}}while(!1);return y=T-w|0,(w|0)<0?(v=0-w|0,g[O>>2]=y,g[c>>2]=v,g[_>>2]=0,w=0):(y=T,v=0),(y|0)<0&&(w=w-y|0,g[_>>2]=w,v=v-y|0,g[c>>2]=v,g[O>>2]=0,y=0),M=w-v|0,T=y-v|0,(v|0)<0?(g[_>>2]=M,g[O>>2]=T,g[c>>2]=0,y=T,T=M,v=0):T=w,w=(y|0)<(T|0)?y:T,w=(v|0)<(w|0)?v:w,(w|0)<=0?(_=0,_|0):(g[_>>2]=T-w,g[O>>2]=y-w,g[c>>2]=v-w,_=0,_|0)}function Ea(y){y=y|0;var _=0,v=0,w=0,T=0;_=y+8|0,T=g[_>>2]|0,v=T-(g[y>>2]|0)|0,g[y>>2]=v,w=y+4|0,y=(g[w>>2]|0)-T|0,g[w>>2]=y,g[_>>2]=0-(y+v)}function Xa(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;v=g[y>>2]|0,_=0-v|0,g[y>>2]=_,O=y+8|0,g[O>>2]=0,c=y+4|0,w=g[c>>2]|0,T=w+v|0,(v|0)>0?(g[c>>2]=T,g[O>>2]=v,g[y>>2]=0,_=0,w=T):v=0,(w|0)<0?(M=_-w|0,g[y>>2]=M,v=v-w|0,g[O>>2]=v,g[c>>2]=0,T=M-v|0,_=0-v|0,(v|0)<0?(g[y>>2]=T,g[c>>2]=_,g[O>>2]=0,w=_,v=0):(w=0,T=M)):T=_,_=(w|0)<(T|0)?w:T,_=(v|0)<(_|0)?v:_,!((_|0)<=0)&&(g[y>>2]=T-_,g[c>>2]=w-_,g[O>>2]=v-_)}function Ba(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0;if(E=Te,Te=Te+64|0,m=E,c=E+56|0,!(!0&(_&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return T=5,Te=E,T|0;if((y|0)==(v|0)&(_|0)==(w|0))return g[T>>2]=0,T=0,Te=E,T|0;if(O=Kt(y|0,_|0,52)|0,Be()|0,O=O&15,f=Kt(v|0,w|0,52)|0,Be()|0,(O|0)!=(f&15|0))return T=12,Te=E,T|0;if(M=O+-1|0,O>>>0>1){qo(y,_,M,m)|0,qo(v,w,M,c)|0,f=m,d=g[f>>2]|0,f=g[f+4>>2]|0;e:do if((d|0)==(g[c>>2]|0)&&(f|0)==(g[c+4>>2]|0)){O=(O^15)*3|0,M=Kt(y|0,_|0,O|0)|0,Be()|0,M=M&7,O=Kt(v|0,w|0,O|0)|0,Be()|0,O=O&7;do if((M|0)==0|(O|0)==0)g[T>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(O|0)==1&&Rn(d,f)|0){M=5;break}if((g[15536+(M<<2)>>2]|0)!=(O|0)&&(g[15568+(M<<2)>>2]|0)!=(O|0))break e;g[T>>2]=1,M=0}while(!1);return T=M,Te=E,T|0}while(!1)}M=m,O=M+56|0;do g[M>>2]=0,M=M+4|0;while((M|0)<(O|0));return Ln(y,_,1,m)|0,_=m,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0))&&(_=m+8|0,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0)))&&(_=m+16|0,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0)))&&(_=m+24|0,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0)))&&(_=m+32|0,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0)))&&(_=m+40|0,!((g[_>>2]|0)==(v|0)&&(g[_+4>>2]|0)==(w|0)))?(M=m+48|0,M=((g[M>>2]|0)==(v|0)?(g[M+4>>2]|0)==(w|0):0)&1):M=1,g[T>>2]=M,T=0,Te=E,T|0}function Qa(y,_,v,w,T){return y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,v=bc(y,_,v,w)|0,(v|0)==7?(T=11,T|0):(w=tr(v|0,0,56)|0,_=_&-2130706433|(Be()|0)|268435456,g[T>>2]=y|w,g[T+4>>2]=_,T=0,T|0)}function Za(y,_,v){return y=y|0,_=_|0,v=v|0,!0&(_&2013265920|0)==268435456?(g[v>>2]=y,g[v+4>>2]=_&-2130706433|134217728,v=0,v|0):(v=6,v|0)}function Ta(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;return T=Te,Te=Te+16|0,w=T,g[w>>2]=0,!0&(_&2013265920|0)==268435456?(M=Kt(y|0,_|0,56)|0,Be()|0,w=Sn(y,_&-2130706433|134217728,M&7,w,v)|0,Te=T,w|0):(w=6,Te=T,w|0)}function Rf(y,_){y=y|0,_=_|0;var v=0;switch(v=Kt(y|0,_|0,56)|0,Be()|0,v&7){case 0:case 7:return v=0,v|0}return v=_&-2130706433|134217728,!(!0&(_&2013265920|0)==268435456)||!0&(_&117440512|0)==16777216&(Rn(y,v)|0)!=0?(v=0,v|0):(v=$o(y,v)|0,v|0)}function Of(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;return T=Te,Te=Te+16|0,w=T,!0&(_&2013265920|0)==268435456?(M=_&-2130706433|134217728,O=v,g[O>>2]=y,g[O+4>>2]=M,g[w>>2]=0,_=Kt(y|0,_|0,56)|0,Be()|0,w=Sn(y,M,_&7,w,v+8|0)|0,Te=T,w|0):(w=6,Te=T,w|0)}function In(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0;return T=(Rn(y,_)|0)==0,_=_&-2130706433,w=v,g[w>>2]=T?y:0,g[w+4>>2]=T?_|285212672:0,w=v+8|0,g[w>>2]=y,g[w+4>>2]=_|301989888,w=v+16|0,g[w>>2]=y,g[w+4>>2]=_|318767104,w=v+24|0,g[w>>2]=y,g[w+4>>2]=_|335544320,w=v+32|0,g[w>>2]=y,g[w+4>>2]=_|352321536,v=v+40|0,g[v>>2]=y,g[v+4>>2]=_|369098752,0}function uu(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;return O=Te,Te=Te+16|0,T=O,M=_&-2130706433|134217728,!0&(_&2013265920|0)==268435456?(w=Kt(y|0,_|0,56)|0,Be()|0,w=Co(y,M,w&7)|0,(w|0)==-1?(g[v>>2]=0,M=6,Te=O,M|0):(el(y,M,T)|0&&Xt(23313,22484,282,22499),_=Kt(y|0,_|0,52)|0,Be()|0,_=_&15,Rn(y,M)|0?Qo(T,_,w,2,v):fu(T,_,w,2,v),M=0,Te=O,M|0)):(M=6,Te=O,M|0)}function hu(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0;w=Te,Te=Te+16|0,T=w,Df(y,_,v,T),xa(T,v+4|0),Te=w}function Df(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0;if(c=Te,Te=Te+16|0,d=c,Ff(y,v,d),M=+Nr(+(1-+le[d>>3]*.5)),M<1e-16){g[w>>2]=0,g[w+4>>2]=0,g[w+8>>2]=0,g[w+12>>2]=0,Te=c;return}if(d=g[v>>2]|0,T=+le[15920+(d*24|0)>>3],T=+kl(T-+kl(+xh(15600+(d<<4)|0,y))),js(_)|0?O=+kl(T+-.3334731722518321):O=T,T=+jt(+M)/.381966011250105,(_|0)>0){y=0;do T=T*2.6457513110645907,y=y+1|0;while((y|0)!=(_|0))}M=+Ft(+O)*T,le[w>>3]=M,O=+It(+O)*T,le[w+8>>3]=O,Te=c}function Ff(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;if(M=Te,Te=Te+32|0,T=M,Th(y,T),g[_>>2]=0,le[v>>3]=5,w=+Bi(16400,T),w<+le[v>>3]&&(g[_>>2]=0,le[v>>3]=w),w=+Bi(16424,T),w<+le[v>>3]&&(g[_>>2]=1,le[v>>3]=w),w=+Bi(16448,T),w<+le[v>>3]&&(g[_>>2]=2,le[v>>3]=w),w=+Bi(16472,T),w<+le[v>>3]&&(g[_>>2]=3,le[v>>3]=w),w=+Bi(16496,T),w<+le[v>>3]&&(g[_>>2]=4,le[v>>3]=w),w=+Bi(16520,T),w<+le[v>>3]&&(g[_>>2]=5,le[v>>3]=w),w=+Bi(16544,T),w<+le[v>>3]&&(g[_>>2]=6,le[v>>3]=w),w=+Bi(16568,T),w<+le[v>>3]&&(g[_>>2]=7,le[v>>3]=w),w=+Bi(16592,T),w<+le[v>>3]&&(g[_>>2]=8,le[v>>3]=w),w=+Bi(16616,T),w<+le[v>>3]&&(g[_>>2]=9,le[v>>3]=w),w=+Bi(16640,T),w<+le[v>>3]&&(g[_>>2]=10,le[v>>3]=w),w=+Bi(16664,T),w<+le[v>>3]&&(g[_>>2]=11,le[v>>3]=w),w=+Bi(16688,T),w<+le[v>>3]&&(g[_>>2]=12,le[v>>3]=w),w=+Bi(16712,T),w<+le[v>>3]&&(g[_>>2]=13,le[v>>3]=w),w=+Bi(16736,T),w<+le[v>>3]&&(g[_>>2]=14,le[v>>3]=w),w=+Bi(16760,T),w<+le[v>>3]&&(g[_>>2]=15,le[v>>3]=w),w=+Bi(16784,T),w<+le[v>>3]&&(g[_>>2]=16,le[v>>3]=w),w=+Bi(16808,T),w<+le[v>>3]&&(g[_>>2]=17,le[v>>3]=w),w=+Bi(16832,T),w<+le[v>>3]&&(g[_>>2]=18,le[v>>3]=w),w=+Bi(16856,T),!(w<+le[v>>3])){Te=M;return}g[_>>2]=19,le[v>>3]=w,Te=M}function Pl(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0;if(M=+ta(y),M<1e-16){_=15600+(_<<4)|0,g[T>>2]=g[_>>2],g[T+4>>2]=g[_+4>>2],g[T+8>>2]=g[_+8>>2],g[T+12>>2]=g[_+12>>2];return}if(O=+cn(+ +le[y+8>>3],+ +le[y>>3]),(v|0)>0){y=0;do M=M/2.6457513110645907,y=y+1|0;while((y|0)!=(v|0))}w?(M=M/3,v=(js(v)|0)==0,M=+en(+((v?M:M/2.6457513110645907)*.381966011250105))):(M=+en(+(M*.381966011250105)),js(v)|0&&(O=+kl(O+.3334731722518321))),Ic(15600+(_<<4)|0,+kl(+le[15920+(_*24|0)>>3]-O),M,T)}function kf(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0;w=Te,Te=Te+16|0,T=w,Lo(y+4|0,T),Pl(T,g[y>>2]|0,_,0,v),Te=w}function Qo(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0,He=0,Je=0,et=0,Xe=0,Ye=0,pt=0,Ot=0,xt=0;if(pt=Te,Te=Te+272|0,M=pt+256|0,$=pt+240|0,et=pt,Xe=pt+224|0,Ye=pt+208|0,re=pt+176|0,se=pt+160|0,ve=pt+192|0,Pe=pt+144|0,me=pt+128|0,Ie=pt+112|0,He=pt+96|0,Je=pt+80|0,g[M>>2]=_,g[$>>2]=g[y>>2],g[$+4>>2]=g[y+4>>2],g[$+8>>2]=g[y+8>>2],g[$+12>>2]=g[y+12>>2],Zo($,M,et),g[T>>2]=0,$=w+v+((w|0)==5&1)|0,($|0)<=(v|0)){Te=pt;return}d=g[M>>2]|0,f=Xe+4|0,m=re+4|0,E=v+5|0,P=16880+(d<<2)|0,L=16960+(d<<2)|0,F=me+8|0,G=Ie+8|0,W=He+8|0,te=Ye+4|0,c=v;e:for(;;){O=et+(((c|0)%5|0)<<4)|0,g[Ye>>2]=g[O>>2],g[Ye+4>>2]=g[O+4>>2],g[Ye+8>>2]=g[O+8>>2],g[Ye+12>>2]=g[O+12>>2];do;while((no(Ye,d,0,1)|0)==2);if((c|0)>(v|0)&(js(_)|0)!=0){if(g[re>>2]=g[Ye>>2],g[re+4>>2]=g[Ye+4>>2],g[re+8>>2]=g[Ye+8>>2],g[re+12>>2]=g[Ye+12>>2],Lo(f,se),w=g[re>>2]|0,M=g[17040+(w*80|0)+(g[Xe>>2]<<2)>>2]|0,g[re>>2]=g[18640+(w*80|0)+(M*20|0)>>2],O=g[18640+(w*80|0)+(M*20|0)+16>>2]|0,(O|0)>0){y=0;do _h(m),y=y+1|0;while((y|0)<(O|0))}switch(O=18640+(w*80|0)+(M*20|0)+4|0,g[ve>>2]=g[O>>2],g[ve+4>>2]=g[O+4>>2],g[ve+8>>2]=g[O+8>>2],Ka(ve,(g[P>>2]|0)*3|0),zn(m,ve,m),bi(m),Lo(m,Pe),Ot=+(g[L>>2]|0),le[me>>3]=Ot*3,le[F>>3]=0,xt=Ot*-1.5,le[Ie>>3]=xt,le[G>>3]=Ot*2.598076211353316,le[He>>3]=xt,le[W>>3]=Ot*-2.598076211353316,g[17040+((g[re>>2]|0)*80|0)+(g[Ye>>2]<<2)>>2]|0){case 1:{y=Ie,w=me;break}case 3:{y=He,w=Ie;break}case 2:{y=me,w=He;break}default:{y=12;break e}}Bh(se,Pe,w,y,Je),Pl(Je,g[re>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1}if((c|0)<(E|0)&&(Lo(te,re),Pl(re,g[Ye>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),g[Xe>>2]=g[Ye>>2],g[Xe+4>>2]=g[Ye+4>>2],g[Xe+8>>2]=g[Ye+8>>2],g[Xe+12>>2]=g[Ye+12>>2],c=c+1|0,(c|0)>=($|0)){y=3;break}}if((y|0)==3){Te=pt;return}else(y|0)==12&&Xt(22522,22569,571,22579)}function Zo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0;d=Te,Te=Te+128|0,w=d+64|0,T=d,M=w,O=20240,c=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));M=T,O=20304,c=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));c=(js(g[_>>2]|0)|0)==0,w=c?w:T,T=y+4|0,yh(T),Gi(T),js(g[_>>2]|0)|0&&(Xo(T),g[_>>2]=(g[_>>2]|0)+1),g[v>>2]=g[y>>2],_=v+4|0,zn(T,w,_),bi(_),g[v+16>>2]=g[y>>2],_=v+20|0,zn(T,w+12|0,_),bi(_),g[v+32>>2]=g[y>>2],_=v+36|0,zn(T,w+24|0,_),bi(_),g[v+48>>2]=g[y>>2],_=v+52|0,zn(T,w+36|0,_),bi(_),g[v+64>>2]=g[y>>2],v=v+68|0,zn(T,w+48|0,v),bi(v),Te=d}function no(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0;if(F=Te,Te=Te+32|0,P=F+12|0,c=F,L=y+4|0,E=g[16960+(_<<2)>>2]|0,m=(w|0)!=0,E=m?E*3|0:E,T=g[L>>2]|0,f=y+8|0,O=g[f>>2]|0,m){if(M=y+12|0,w=g[M>>2]|0,T=O+T+w|0,(T|0)==(E|0))return L=1,Te=F,L|0;d=M}else d=y+12|0,w=g[d>>2]|0,T=O+T+w|0;if((T|0)<=(E|0))return L=0,Te=F,L|0;do if((w|0)>0){if(w=g[y>>2]|0,(O|0)>0){M=18640+(w*80|0)+60|0,w=y;break}w=18640+(w*80|0)+40|0,v?(Ja(P,E,0,0),fi(L,P,c),cu(c),zn(c,P,L),M=w,w=y):(M=w,w=y)}else M=18640+((g[y>>2]|0)*80|0)+20|0,w=y;while(!1);if(g[w>>2]=g[M>>2],T=M+16|0,(g[T>>2]|0)>0){w=0;do _h(L),w=w+1|0;while((w|0)<(g[T>>2]|0))}return y=M+4|0,g[P>>2]=g[y>>2],g[P+4>>2]=g[y+4>>2],g[P+8>>2]=g[y+8>>2],_=g[16880+(_<<2)>>2]|0,Ka(P,m?_*3|0:_),zn(L,P,L),bi(L),m?w=((g[f>>2]|0)+(g[L>>2]|0)+(g[d>>2]|0)|0)==(E|0)?1:2:w=2,L=w,Te=F,L|0}function Nf(y,_){y=y|0,_=_|0;var v=0;do v=no(y,_,0,1)|0;while((v|0)==2);return v|0}function fu(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0,He=0,Je=0,et=0;if(He=Te,Te=Te+240|0,M=He+224|0,ve=He+208|0,Pe=He,me=He+192|0,Ie=He+176|0,W=He+160|0,te=He+144|0,$=He+128|0,re=He+112|0,se=He+96|0,g[M>>2]=_,g[ve>>2]=g[y>>2],g[ve+4>>2]=g[y+4>>2],g[ve+8>>2]=g[y+8>>2],g[ve+12>>2]=g[y+12>>2],du(ve,M,Pe),g[T>>2]=0,G=w+v+((w|0)==6&1)|0,(G|0)<=(v|0)){Te=He;return}d=g[M>>2]|0,f=v+6|0,m=16960+(d<<2)|0,E=te+8|0,P=$+8|0,L=re+8|0,F=me+4|0,O=0,c=v,w=-1;e:for(;;){if(M=(c|0)%6|0,y=Pe+(M<<4)|0,g[me>>2]=g[y>>2],g[me+4>>2]=g[y+4>>2],g[me+8>>2]=g[y+8>>2],g[me+12>>2]=g[y+12>>2],y=O,O=no(me,d,0,1)|0,(c|0)>(v|0)&(js(_)|0)!=0&&(y|0)!=1&&(g[me>>2]|0)!=(w|0)){switch(Lo(Pe+(((M+5|0)%6|0)<<4)+4|0,Ie),Lo(Pe+(M<<4)+4|0,W),Je=+(g[m>>2]|0),le[te>>3]=Je*3,le[E>>3]=0,et=Je*-1.5,le[$>>3]=et,le[P>>3]=Je*2.598076211353316,le[re>>3]=et,le[L>>3]=Je*-2.598076211353316,M=g[ve>>2]|0,g[17040+(M*80|0)+(((w|0)==(M|0)?g[me>>2]|0:w)<<2)>>2]|0){case 1:{y=$,w=te;break}case 3:{y=re,w=$;break}case 2:{y=te,w=re;break}default:{y=8;break e}}Bh(Ie,W,w,y,se),!(zl(Ie,se)|0)&&!(zl(W,se)|0)&&(Pl(se,g[ve>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1)}if((c|0)<(f|0)&&(Lo(F,Ie),Pl(Ie,g[me>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),c=c+1|0,(c|0)>=(G|0)){y=3;break}else w=g[me>>2]|0}if((y|0)==3){Te=He;return}else(y|0)==8&&Xt(22606,22569,736,22651)}function du(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0;d=Te,Te=Te+160|0,w=d+80|0,T=d,M=w,O=20368,c=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));M=T,O=20448,c=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));c=(js(g[_>>2]|0)|0)==0,w=c?w:T,T=y+4|0,yh(T),Gi(T),js(g[_>>2]|0)|0&&(Xo(T),g[_>>2]=(g[_>>2]|0)+1),g[v>>2]=g[y>>2],_=v+4|0,zn(T,w,_),bi(_),g[v+16>>2]=g[y>>2],_=v+20|0,zn(T,w+12|0,_),bi(_),g[v+32>>2]=g[y>>2],_=v+36|0,zn(T,w+24|0,_),bi(_),g[v+48>>2]=g[y>>2],_=v+52|0,zn(T,w+36|0,_),bi(_),g[v+64>>2]=g[y>>2],_=v+68|0,zn(T,w+48|0,_),bi(_),g[v+80>>2]=g[y>>2],v=v+84|0,zn(T,w+60|0,v),bi(v),Te=d}function $a(y,_){return y=y|0,_=_|0,_=Kt(y|0,_|0,52)|0,Be()|0,_&15|0}function bh(y,_){return y=y|0,_=_|0,_=Kt(y|0,_|0,45)|0,Be()|0,_&127|0}function $o(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0;if(!(!0&(_&-16777216|0)==134217728)||(O=Kt(y|0,_|0,45)|0,Be()|0,O=O&127,O>>>0>121))return _=0,_|0;v=Kt(y|0,_|0,52)|0,Be()|0,v=v&15;do if(v|0){for(T=1,w=0;;){if(M=Kt(y|0,_|0,(15-T|0)*3|0)|0,Be()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(Ir(O)|0)!=0){c=0,w=13;break}else w=1;if((M|0)==7){c=0,w=13;break}if(T>>>0<v>>>0)T=T+1|0;else{w=9;break}}if((w|0)==9){if((v|0)==15)c=1;else break;return c|0}else if((w|0)==13)return c|0}while(!1);for(;;){if(c=Kt(y|0,_|0,(14-v|0)*3|0)|0,Be()|0,!((c&7|0)==7&!0)){c=0,w=13;break}if(v>>>0<14)v=v+1|0;else{c=1,w=13;break}}return(w|0)==13?c|0:0}function qo(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0;if(M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15,v>>>0>15)return w=4,w|0;if((M|0)<(v|0))return w=12,w|0;if((M|0)==(v|0))return g[w>>2]=y,g[w+4>>2]=_,w=0,w|0;if(T=tr(v|0,0,52)|0,T=T|y,y=Be()|0|_&-15728641,(M|0)>(v|0))do _=tr(7,0,(14-v|0)*3|0)|0,v=v+1|0,T=_|T,y=Be()|0|y;while((v|0)<(M|0));return g[w>>2]=T,g[w+4>>2]=y,w=0,w|0}function Bc(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0;if(M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15,!((v|0)<16&(M|0)<=(v|0)))return w=4,w|0;T=v-M|0,v=Kt(y|0,_|0,45)|0,Be()|0;e:do if(!(Ir(v&127)|0))v=Ws(7,0,T,((T|0)<0)<<31>>31)|0,T=Be()|0;else{t:do if(M|0){for(v=1;O=tr(7,0,(15-v|0)*3|0)|0,!!((O&y|0)==0&((Be()|0)&_|0)==0);)if(v>>>0<M>>>0)v=v+1|0;else break t;v=Ws(7,0,T,((T|0)<0)<<31>>31)|0,T=Be()|0;break e}while(!1);v=Ws(7,0,T,((T|0)<0)<<31>>31)|0,v=di(v|0,Be()|0,5,0)|0,v=An(v|0,Be()|0,-5,-1)|0,v=Js(v|0,Be()|0,6,0)|0,v=An(v|0,Be()|0,1,0)|0,T=Be()|0}while(!1);return O=w,g[O>>2]=v,g[O+4>>2]=T,O=0,O|0}function Rn(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;if(T=Kt(y|0,_|0,45)|0,Be()|0,!(Ir(T&127)|0))return T=0,T|0;T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15;e:do if(!T)v=0;else for(w=1;;){if(v=Kt(y|0,_|0,(15-w|0)*3|0)|0,Be()|0,v=v&7,v|0)break e;if(w>>>0<T>>>0)w=w+1|0;else{v=0;break}}while(!1);return T=(v|0)==0&1,T|0}function Fn(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0;if(O=Te,Te=Te+16|0,M=O,Sc(M,y,_,v),_=M,y=g[_>>2]|0,_=g[_+4>>2]|0,(y|0)==0&(_|0)==0)return Te=O,0;T=0,v=0;do c=w+(T<<3)|0,g[c>>2]=y,g[c+4>>2]=_,T=An(T|0,v|0,1,0)|0,v=Be()|0,_u(M),c=M,y=g[c>>2]|0,_=g[c+4>>2]|0;while(!((y|0)==0&(_|0)==0));return Te=O,0}function pu(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,(w|0)<(v|0)?(v=_,w=y,mr(v|0),w|0):(v=tr(-1,-1,((w-v|0)*3|0)+3|0)|0,w=tr(~v|0,~(Be()|0)|0,(15-w|0)*3|0)|0,v=~(Be()|0)&_,w=~w&y,mr(v|0),w|0)}function aA(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0;return T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15,(v|0)<16&(T|0)<=(v|0)?((T|0)<(v|0)&&(T=tr(-1,-1,((v+-1-T|0)*3|0)+3|0)|0,T=tr(~T|0,~(Be()|0)|0,(15-v|0)*3|0)|0,_=~(Be()|0)&_,y=~T&y),T=tr(v|0,0,52)|0,v=_&-15728641|(Be()|0),g[w>>2]=y|T,g[w+4>>2]=v,w=0,w|0):(w=4,w|0)}function Ll(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0;if((v|0)==0&(w|0)==0)return me=0,me|0;if(T=y,M=g[T>>2]|0,T=g[T+4>>2]|0,!0&(T&15728640|0)==0){if(!((w|0)>0|(w|0)==0&v>>>0>0)||(me=_,g[me>>2]=M,g[me+4>>2]=T,(v|0)==1&(w|0)==0))return me=0,me|0;T=1;do ve=y+(T<<3)|0,Pe=g[ve+4>>2]|0,me=_+(T<<3)|0,g[me>>2]=g[ve>>2],g[me+4>>2]=Pe,T=T+1|0;while(0<(w|0)|(w|0)==0&T>>>0<v>>>0);return T=0,T|0}if(se=v<<3,Pe=Xn(se)|0,!Pe)return me=13,me|0;if(Do(Pe|0,y|0,se|0)|0,ve=lo(v,8)|0,!ve)return Ur(Pe),me=13,me|0;e:do if(v|0){t:for(;;){T=Pe,te=g[T>>2]|0,T=g[T+4>>2]|0,$=Kt(te|0,T|0,52)|0,Be()|0,$=$&15,re=$+-1|0,W=(v|0)>0;r:do if(($|0)!=0&W){if(L=((v|0)<0)<<31>>31,F=tr(re|0,0,52)|0,G=Be()|0,re>>>0>15){if(!((te|0)==0&(T|0)==0)){me=17;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(v|0))break r;if(w=Pe+(M<<3)|0,G=g[w>>2]|0,w=g[w+4>>2]|0,!((G|0)==0&(w|0)==0)){T=w,me=17;break t}}}for(M=0,y=te,w=T;;){if(!((y|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){me=22;break t}if(c=Kt(y|0,w|0,52)|0,Be()|0,c=c&15,(c|0)<(re|0)){T=12,me=28;break t}if((c|0)!=(re|0)&&(y=y|F,w=w&-15728641|G,c>>>0>=$>>>0)){O=re;do P=tr(7,0,(14-O|0)*3|0)|0,O=O+1|0,y=P|y,w=Be()|0|w;while(O>>>0<c>>>0)}if(O=Eo(y|0,w|0,v|0,L|0)|0,Be()|0,f=ve+(O<<3)|0,c=f,d=g[c>>2]|0,c=g[c+4>>2]|0,(d|0)==0&(c|0)==0)O=f;else for(P=0;;){if((P|0)>(v|0)){me=32;break t}if((d|0)==(y|0)&(c&-117440513|0)==(w|0)){m=Kt(d|0,c|0,56)|0,Be()|0,m=m&7,E=m+1|0,Ie=Kt(d|0,c|0,45)|0,Be()|0;n:do if(!(Ir(Ie&127)|0))c=7;else{if(d=Kt(d|0,c|0,52)|0,Be()|0,d=d&15,!d){c=6;break}for(c=1;;){if(Ie=tr(7,0,(15-c|0)*3|0)|0,!((Ie&y|0)==0&((Be()|0)&w|0)==0)){c=7;break n}if(c>>>0<d>>>0)c=c+1|0;else{c=6;break}}}while(!1);if((m+2|0)>>>0>c>>>0){me=42;break t}Ie=tr(E|0,0,56)|0,w=Be()|0|w&-117440513,E=f,g[E>>2]=0,g[E+4>>2]=0,y=Ie|y}else O=(O+1|0)%(v|0)|0;if(f=ve+(O<<3)|0,c=f,d=g[c>>2]|0,c=g[c+4>>2]|0,(d|0)==0&(c|0)==0){O=f;break}else P=P+1|0}Ie=O,g[Ie>>2]=y,g[Ie+4>>2]=w}if(M=M+1|0,(M|0)>=(v|0))break r;w=Pe+(M<<3)|0,y=g[w>>2]|0,w=g[w+4>>2]|0}}while(!1);if((v+5|0)>>>0<11){me=85;break}if(G=lo((v|0)/6|0,8)|0,!G){me=49;break}r:do if(W){P=0,E=0;do{if(c=ve+(P<<3)|0,w=c,M=g[w>>2]|0,w=g[w+4>>2]|0,!((M|0)==0&(w|0)==0)){d=Kt(M|0,w|0,56)|0,Be()|0,d=d&7,y=d+1|0,f=w&-117440513,Ie=Kt(M|0,w|0,45)|0,Be()|0;n:do if(Ir(Ie&127)|0){if(m=Kt(M|0,w|0,52)|0,Be()|0,m=m&15,m|0)for(O=1;;){if(Ie=tr(7,0,(15-O|0)*3|0)|0,!((M&Ie|0)==0&(f&(Be()|0)|0)==0))break n;if(O>>>0<m>>>0)O=O+1|0;else break}w=tr(y|0,0,56)|0,M=w|M,w=Be()|0|f,y=c,g[y>>2]=M,g[y+4>>2]=w,y=d+2|0}while(!1);(y|0)==7&&(Ie=G+(E<<3)|0,g[Ie>>2]=M,g[Ie+4>>2]=w&-117440513,E=E+1|0)}P=P+1|0}while((P|0)!=(v|0));if(W){if(P=((v|0)<0)<<31>>31,L=tr(re|0,0,52)|0,F=Be()|0,re>>>0>15){if(!((te|0)==0&(T|0)==0)){T=4,me=84;break t}for(T=0;;){if(T=T+1|0,(T|0)>=(v|0)){M=0,T=E;break r}if(Ie=Pe+(T<<3)|0,!((g[Ie>>2]|0)==0&(g[Ie+4>>2]|0)==0)){T=4,me=84;break t}}}for(m=0,M=0,f=te;;){do if(!((f|0)==0&(T|0)==0)){if(c=Kt(f|0,T|0,52)|0,Be()|0,c=c&15,(c|0)<(re|0)){T=12,me=84;break t}do if((c|0)==(re|0))w=f,c=T;else{if(w=f|L,y=T&-15728641|F,c>>>0<$>>>0){c=y;break}O=re;do Ie=tr(7,0,(14-O|0)*3|0)|0,O=O+1|0,w=Ie|w,y=Be()|0|y;while(O>>>0<c>>>0);c=y}while(!1);for(O=Eo(w|0,c|0,v|0,P|0)|0,Be()|0,y=0;;){if((y|0)>(v|0)){me=77;break t}if(Ie=ve+(O<<3)|0,d=g[Ie+4>>2]|0,(d&-117440513|0)==(c|0)&&(g[Ie>>2]|0)==(w|0)){me=79;break}if(O=(O+1|0)%(v|0)|0,Ie=ve+(O<<3)|0,(g[Ie>>2]|0)==(w|0)&&(g[Ie+4>>2]|0)==(c|0))break;y=y+1|0}if((me|0)==79&&(me=0,!0&(d&117440512|0)==100663296))break;Ie=_+(M<<3)|0,g[Ie>>2]=f,g[Ie+4>>2]=T,M=M+1|0}while(!1);if(T=m+1|0,(T|0)>=(v|0)){T=E;break r}Ie=Pe+(T<<3)|0,m=T,f=g[Ie>>2]|0,T=g[Ie+4>>2]|0}}else M=0,T=E}else M=0,T=0;while(!1);if(ia(ve|0,0,se|0)|0,Do(Pe|0,G|0,T<<3|0)|0,Ur(G),T)_=_+(M<<3)|0,v=T;else break e}if((me|0)==17)!0&(T&117440512|0)==0?(T=4,me=28):me=22;else if((me|0)==32)Xt(23313,22674,362,22684);else{if((me|0)==42)return Ur(Pe),Ur(ve),Ie=10,Ie|0;if((me|0)==49)return Ur(Pe),Ur(ve),Ie=13,Ie|0;if((me|0)==77)Xt(23313,22674,462,22684);else{if((me|0)==84)return Ur(G),Ur(Pe),Ur(ve),Ie=T,Ie|0;if((me|0)==85){Do(_|0,Pe|0,v<<3|0)|0;break}}}if((me|0)==22)return Ur(Pe),Ur(ve),Ie=5,Ie|0;if((me|0)==28)return Ur(Pe),Ur(ve),Ie=T,Ie|0}while(!1);return Ur(Pe),Ur(ve),Ie=0,Ie|0}function Uf(y,_,v,w,T,M,O){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,M=M|0,O=O|0;var c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0;if(G=Te,Te=Te+16|0,F=G,!((v|0)>0|(v|0)==0&_>>>0>0))return F=0,Te=G,F|0;if((O|0)>=16)return F=12,Te=G,F|0;P=0,L=0,E=0,c=0;e:for(;;){if(f=y+(P<<3)|0,d=g[f>>2]|0,f=g[f+4>>2]|0,m=Kt(d|0,f|0,52)|0,Be()|0,(m&15|0)>(O|0)){c=12,d=11;break}if(Sc(F,d,f,O),m=F,f=g[m>>2]|0,m=g[m+4>>2]|0,(f|0)==0&(m|0)==0)d=E;else{d=E;do{if(!((c|0)<(M|0)|(c|0)==(M|0)&d>>>0<T>>>0)){d=10;break e}E=w+(d<<3)|0,g[E>>2]=f,g[E+4>>2]=m,d=An(d|0,c|0,1,0)|0,c=Be()|0,_u(F),E=F,f=g[E>>2]|0,m=g[E+4>>2]|0}while(!((f|0)==0&(m|0)==0))}if(P=An(P|0,L|0,1,0)|0,L=Be()|0,(L|0)<(v|0)|(L|0)==(v|0)&P>>>0<_>>>0)E=d;else{c=0,d=11;break}}return(d|0)==10?(F=14,Te=G,F|0):(d|0)==11?(Te=G,c|0):0}function lA(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;P=Te,Te=Te+16|0,E=P;e:do if((v|0)>0|(v|0)==0&_>>>0>0){for(f=0,O=0,M=0,m=0;;){if(d=y+(f<<3)|0,c=g[d>>2]|0,d=g[d+4>>2]|0,!((c|0)==0&(d|0)==0)&&(d=(Bc(c,d,w,E)|0)==0,c=E,O=An(g[c>>2]|0,g[c+4>>2]|0,O|0,M|0)|0,M=Be()|0,!d)){M=12;break}if(f=An(f|0,m|0,1,0)|0,m=Be()|0,!((m|0)<(v|0)|(m|0)==(v|0)&f>>>0<_>>>0))break e}return Te=P,M|0}else O=0,M=0;while(!1);return g[T>>2]=O,g[T+4>>2]=M,T=0,Te=P,T|0}function Gf(y,_){return y=y|0,_=_|0,_=Kt(y|0,_|0,52)|0,Be()|0,_&1|0}function ts(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;if(T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15,!T)return T=0,T|0;for(w=1;;){if(v=Kt(y|0,_|0,(15-w|0)*3|0)|0,Be()|0,v=v&7,v|0){w=5;break}if(w>>>0<T>>>0)w=w+1|0;else{v=0,w=5;break}}return(w|0)==5?v|0:0}function Sa(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0;if(d=Kt(y|0,_|0,52)|0,Be()|0,d=d&15,!d)return c=_,d=y,mr(c|0),d|0;for(c=1,v=0;;){M=(15-c|0)*3|0,w=tr(7,0,M|0)|0,T=Be()|0,O=Kt(y|0,_|0,M|0)|0,Be()|0,M=tr(xo(O&7)|0,0,M|0)|0,O=Be()|0,y=M|y&~w,_=O|_&~T;e:do if(!v)if((M&w|0)==0&(O&T|0)==0)v=0;else if(w=Kt(y|0,_|0,52)|0,Be()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=Kt(y|0,_|0,(15-v|0)*3|0)|0,Be()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(O=(15-v|0)*3|0,T=Kt(y|0,_|0,O|0)|0,Be()|0,M=tr(7,0,O|0)|0,_=_&~(Be()|0),O=tr(xo(T&7)|0,0,O|0)|0,y=y&~M|O,_=_|(Be()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(c>>>0<d>>>0)c=c+1|0;else break}return mr(_|0),y|0}function wo(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0;if(w=Kt(y|0,_|0,52)|0,Be()|0,w=w&15,!w)return v=_,w=y,mr(v|0),w|0;for(v=1;M=(15-v|0)*3|0,O=Kt(y|0,_|0,M|0)|0,Be()|0,T=tr(7,0,M|0)|0,_=_&~(Be()|0),M=tr(xo(O&7)|0,0,M|0)|0,y=M|y&~T,_=Be()|0|_,v>>>0<w>>>0;)v=v+1|0;return mr(_|0),y|0}function Au(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0;if(d=Kt(y|0,_|0,52)|0,Be()|0,d=d&15,!d)return c=_,d=y,mr(c|0),d|0;for(c=1,v=0;;){M=(15-c|0)*3|0,w=tr(7,0,M|0)|0,T=Be()|0,O=Kt(y|0,_|0,M|0)|0,Be()|0,M=tr(ro(O&7)|0,0,M|0)|0,O=Be()|0,y=M|y&~w,_=O|_&~T;e:do if(!v)if((M&w|0)==0&(O&T|0)==0)v=0;else if(w=Kt(y|0,_|0,52)|0,Be()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(O=Kt(y|0,_|0,(15-v|0)*3|0)|0,Be()|0,O&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(T=(15-v|0)*3|0,M=tr(7,0,T|0)|0,O=_&~(Be()|0),_=Kt(y|0,_|0,T|0)|0,Be()|0,_=tr(ro(_&7)|0,0,T|0)|0,y=y&~M|_,_=O|(Be()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(c>>>0<d>>>0)c=c+1|0;else break}return mr(_|0),y|0}function qa(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0;if(w=Kt(y|0,_|0,52)|0,Be()|0,w=w&15,!w)return v=_,w=y,mr(v|0),w|0;for(v=1;O=(15-v|0)*3|0,M=tr(7,0,O|0)|0,T=_&~(Be()|0),_=Kt(y|0,_|0,O|0)|0,Be()|0,_=tr(ro(_&7)|0,0,O|0)|0,y=_|y&~M,_=Be()|0|T,v>>>0<w>>>0;)v=v+1|0;return mr(_|0),y|0}function Rl(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(d=Te,Te=Te+64|0,c=d+40|0,w=d+24|0,T=d+12|0,M=d,tr(_|0,0,52)|0,v=Be()|0|134225919,!_)return(g[y+4>>2]|0)>2||(g[y+8>>2]|0)>2||(g[y+12>>2]|0)>2?(O=0,c=0,mr(O|0),Te=d,c|0):(tr(Ts(y)|0,0,45)|0,O=Be()|0|v,c=-1,mr(O|0),Te=d,c|0);if(g[c>>2]=g[y>>2],g[c+4>>2]=g[y+4>>2],g[c+8>>2]=g[y+8>>2],g[c+12>>2]=g[y+12>>2],O=c+4|0,(_|0)>0)for(y=-1;g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],_&1?(gh(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Ml(T)):(lu(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Xo(T)),fi(w,T,M),bi(M),m=(15-_|0)*3|0,f=tr(7,0,m|0)|0,v=v&~(Be()|0),m=tr(Cc(M)|0,0,m|0)|0,y=m|y&~f,v=Be()|0|v,(_|0)>1;)_=_+-1|0;else y=-1;e:do if((g[O>>2]|0)<=2&&(g[c+8>>2]|0)<=2&&(g[c+12>>2]|0)<=2){if(w=Ts(c)|0,_=tr(w|0,0,45)|0,_=_|y,y=Be()|0|v&-1040385,M=cs(c)|0,!(Ir(w)|0)){if((M|0)<=0)break;for(T=0;;){if(w=Kt(_|0,y|0,52)|0,Be()|0,w=w&15,w)for(v=1;m=(15-v|0)*3|0,c=Kt(_|0,y|0,m|0)|0,Be()|0,f=tr(7,0,m|0)|0,y=y&~(Be()|0),m=tr(xo(c&7)|0,0,m|0)|0,_=_&~f|m,y=y|(Be()|0),v>>>0<w>>>0;)v=v+1|0;if(T=T+1|0,(T|0)==(M|0))break e}}T=Kt(_|0,y|0,52)|0,Be()|0,T=T&15;t:do if(T){v=1;r:for(;;){switch(m=Kt(_|0,y|0,(15-v|0)*3|0)|0,Be()|0,m&7){case 1:break r;case 0:break;default:break t}if(v>>>0<T>>>0)v=v+1|0;else break t}if(Ah(w,g[c>>2]|0)|0)for(v=1;c=(15-v|0)*3|0,f=tr(7,0,c|0)|0,m=y&~(Be()|0),y=Kt(_|0,y|0,c|0)|0,Be()|0,y=tr(ro(y&7)|0,0,c|0)|0,_=_&~f|y,y=m|(Be()|0),v>>>0<T>>>0;)v=v+1|0;else for(v=1;m=(15-v|0)*3|0,c=Kt(_|0,y|0,m|0)|0,Be()|0,f=tr(7,0,m|0)|0,y=y&~(Be()|0),m=tr(xo(c&7)|0,0,m|0)|0,_=_&~f|m,y=y|(Be()|0),v>>>0<T>>>0;)v=v+1|0}while(!1);if((M|0)>0){v=0;do _=Sa(_,y)|0,y=Be()|0,v=v+1|0;while((v|0)!=(M|0))}}else _=0,y=0;while(!1);return f=y,m=_,mr(f|0),Te=d,m|0}function js(y){return y=y|0,(y|0)%2|0|0}function Ya(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0;return T=Te,Te=Te+16|0,w=T,_>>>0>15?(w=4,Te=T,w|0):(g[y+4>>2]&2146435072|0)==2146435072||(g[y+8+4>>2]&2146435072|0)==2146435072?(w=3,Te=T,w|0):(hu(y,_,w),_=Rl(w,_)|0,w=Be()|0,g[v>>2]=_,g[v+4>>2]=w,(_|0)==0&(w|0)==0&&Xt(23313,22674,786,22697),w=0,Te=T,w|0)}function Hs(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;if(T=v+4|0,M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15,O=Kt(y|0,_|0,45)|0,Be()|0,w=(M|0)==0,Ir(O&127)|0){if(w)return O=1,O|0;w=1}else{if(w)return O=0,O|0;(g[T>>2]|0)==0&&(g[v+8>>2]|0)==0?w=(g[v+12>>2]|0)!=0&1:w=1}for(v=1;v&1?Ml(T):Xo(T),O=Kt(y|0,_|0,(15-v|0)*3|0)|0,Be()|0,mh(T,O&7),v>>>0<M>>>0;)v=v+1|0;return w|0}function el(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(m=Te,Te=Te+16|0,d=m,f=Kt(y|0,_|0,45)|0,Be()|0,f=f&127,f>>>0>121)return g[v>>2]=0,g[v+4>>2]=0,g[v+8>>2]=0,g[v+12>>2]=0,f=5,Te=m,f|0;e:do if((Ir(f)|0)!=0&&(M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15,(M|0)!=0)){w=1;t:for(;;){switch(c=Kt(y|0,_|0,(15-w|0)*3|0)|0,Be()|0,c&7){case 5:break t;case 0:break;default:{w=_;break e}}if(w>>>0<M>>>0)w=w+1|0;else{w=_;break e}}for(T=1,w=_;_=(15-T|0)*3|0,O=tr(7,0,_|0)|0,c=w&~(Be()|0),w=Kt(y|0,w|0,_|0)|0,Be()|0,w=tr(ro(w&7)|0,0,_|0)|0,y=y&~O|w,w=c|(Be()|0),T>>>0<M>>>0;)T=T+1|0}else w=_;while(!1);if(c=7696+(f*28|0)|0,g[v>>2]=g[c>>2],g[v+4>>2]=g[c+4>>2],g[v+8>>2]=g[c+8>>2],g[v+12>>2]=g[c+12>>2],!(Hs(y,w,v)|0))return f=0,Te=m,f|0;if(O=v+4|0,g[d>>2]=g[O>>2],g[d+4>>2]=g[O+4>>2],g[d+8>>2]=g[O+8>>2],M=Kt(y|0,w|0,52)|0,Be()|0,c=M&15,M&1?(Xo(O),M=c+1|0):M=c,!(Ir(f)|0))w=0;else{e:do if(!c)w=0;else for(_=1;;){if(T=Kt(y|0,w|0,(15-_|0)*3|0)|0,Be()|0,T=T&7,T|0){w=T;break e}if(_>>>0<c>>>0)_=_+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(no(v,M,w,0)|0))(M|0)!=(c|0)&&(g[O>>2]=g[d>>2],g[O+4>>2]=g[d+4>>2],g[O+8>>2]=g[d+8>>2]);else{if(Ir(f)|0)do;while((no(v,M,0,0)|0)!=0);(M|0)!=(c|0)&&lu(O)}return f=0,Te=m,f|0}function Ol(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;return M=Te,Te=Te+16|0,w=M,T=el(y,_,w)|0,T|0?(Te=M,T|0):(T=Kt(y|0,_|0,52)|0,Be()|0,kf(w,T&15,v),T=0,Te=M,T|0)}function Dl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0;if(O=Te,Te=Te+16|0,M=O,w=el(y,_,M)|0,w|0)return M=w,Te=O,M|0;w=Kt(y|0,_|0,45)|0,Be()|0,w=(Ir(w&127)|0)==0,T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15;e:do if(!w){if(T|0)for(w=1;;){if(c=tr(7,0,(15-w|0)*3|0)|0,!((c&y|0)==0&((Be()|0)&_|0)==0))break e;if(w>>>0<T>>>0)w=w+1|0;else break}return Qo(M,T,0,5,v),c=0,Te=O,c|0}while(!1);return fu(M,T,0,6,v),c=0,Te=O,c|0}function tl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;if(T=Kt(y|0,_|0,45)|0,Be()|0,!(Ir(T&127)|0))return T=2,g[v>>2]=T,0;if(T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15,!T)return T=5,g[v>>2]=T,0;for(w=1;;){if(M=tr(7,0,(15-w|0)*3|0)|0,!((M&y|0)==0&((Be()|0)&_|0)==0)){w=2,y=6;break}if(w>>>0<T>>>0)w=w+1|0;else{w=5,y=6;break}}return(y|0)==6&&(g[v>>2]=w),0}function Fl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0;E=Te,Te=Te+128|0,f=E+112|0,M=E+96|0,m=E,T=Kt(y|0,_|0,52)|0,Be()|0,c=T&15,g[f>>2]=c,O=Kt(y|0,_|0,45)|0,Be()|0,O=O&127;e:do if(Ir(O)|0){if(c|0)for(w=1;;){if(d=tr(7,0,(15-w|0)*3|0)|0,!((d&y|0)==0&((Be()|0)&_|0)==0)){T=0;break e}if(w>>>0<c>>>0)w=w+1|0;else break}if(T&1)T=1;else return d=tr(c+1|0,0,52)|0,m=Be()|0|_&-15728641,f=tr(7,0,(14-c|0)*3|0)|0,m=Fl((d|y)&~f,m&~(Be()|0),v)|0,Te=E,m|0}else T=0;while(!1);if(w=el(y,_,M)|0,!w){T?(Zo(M,f,m),d=5):(du(M,f,m),d=6);e:do if(Ir(O)|0)if(!c)y=5;else for(w=1;;){if(O=tr(7,0,(15-w|0)*3|0)|0,!((O&y|0)==0&((Be()|0)&_|0)==0)){y=2;break e}if(w>>>0<c>>>0)w=w+1|0;else{y=5;break}}else y=2;while(!1);ia(v|0,-1,y<<2|0)|0;e:do if(T)for(M=0;;){if(O=m+(M<<4)|0,Nf(O,g[f>>2]|0)|0,O=g[O>>2]|0,c=g[v>>2]|0,(c|0)==-1|(c|0)==(O|0))w=v;else{T=0;do{if(T=T+1|0,T>>>0>=y>>>0){w=1;break e}w=v+(T<<2)|0,c=g[w>>2]|0}while(!((c|0)==-1|(c|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}else for(M=0;;){if(O=m+(M<<4)|0,no(O,g[f>>2]|0,0,1)|0,O=g[O>>2]|0,c=g[v>>2]|0,(c|0)==-1|(c|0)==(O|0))w=v;else{T=0;do{if(T=T+1|0,T>>>0>=y>>>0){w=1;break e}w=v+(T<<2)|0,c=g[w>>2]|0}while(!((c|0)==-1|(c|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}while(!1)}return m=w,Te=E,m|0}function gu(){return 12}function Tc(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0;if(y>>>0>15)return c=4,c|0;if(tr(y|0,0,52)|0,c=Be()|0|134225919,!y){v=0,w=0;do Ir(w)|0&&(tr(w|0,0,45)|0,O=c|(Be()|0),y=_+(v<<3)|0,g[y>>2]=-1,g[y+4>>2]=O,v=v+1|0),w=w+1|0;while((w|0)!=122);return v=0,v|0}v=0,O=0;do{if(Ir(O)|0){for(tr(O|0,0,45)|0,w=1,T=-1,M=c|(Be()|0);d=tr(7,0,(15-w|0)*3|0)|0,T=T&~d,M=M&~(Be()|0),(w|0)!=(y|0);)w=w+1|0;d=_+(v<<3)|0,g[d>>2]=T,g[d+4>>2]=M,v=v+1|0}O=O+1|0}while((O|0)!=122);return v=0,v|0}function mu(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0;if($=Te,Te=Te+16|0,W=$,te=Kt(y|0,_|0,52)|0,Be()|0,te=te&15,v>>>0>15)return te=4,Te=$,te|0;if((te|0)<(v|0))return te=12,Te=$,te|0;if((te|0)!=(v|0))if(M=tr(v|0,0,52)|0,M=M|y,c=Be()|0|_&-15728641,(te|0)>(v|0)){d=v;do G=tr(7,0,(14-d|0)*3|0)|0,d=d+1|0,M=G|M,c=Be()|0|c;while((d|0)<(te|0));G=M}else G=M;else G=y,c=_;F=Kt(G|0,c|0,45)|0,Be()|0;e:do if(Ir(F&127)|0){if(d=Kt(G|0,c|0,52)|0,Be()|0,d=d&15,d|0)for(M=1;;){if(F=tr(7,0,(15-M|0)*3|0)|0,!((F&G|0)==0&((Be()|0)&c|0)==0)){f=33;break e}if(M>>>0<d>>>0)M=M+1|0;else break}if(F=w,g[F>>2]=0,g[F+4>>2]=0,(te|0)>(v|0)){for(F=_&-15728641,L=te;;){if(P=L,L=L+-1|0,L>>>0>15|(te|0)<(L|0)){f=19;break}if((te|0)!=(L|0))if(M=tr(L|0,0,52)|0,M=M|y,d=Be()|0|F,(te|0)<(P|0))E=M;else{f=L;do E=tr(7,0,(14-f|0)*3|0)|0,f=f+1|0,M=E|M,d=Be()|0|d;while((f|0)<(te|0));E=M}else E=y,d=_;if(m=Kt(E|0,d|0,45)|0,Be()|0,!(Ir(m&127)|0))M=0;else{m=Kt(E|0,d|0,52)|0,Be()|0,m=m&15;t:do if(!m)M=0;else for(f=1;;){if(M=Kt(E|0,d|0,(15-f|0)*3|0)|0,Be()|0,M=M&7,M|0)break t;if(f>>>0<m>>>0)f=f+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(d=Kt(y|0,_|0,(15-P|0)*3|0)|0,Be()|0,d=d&7,(d|0)==7){T=5,f=42;break}if(M=(M|0)!=0,(d|0)==1&M){T=5,f=42;break}if(E=d+(((d|0)!=0&M)<<31>>31)|0,E|0&&(f=te-P|0,f=Ws(7,0,f,((f|0)<0)<<31>>31)|0,m=Be()|0,M?(M=di(f|0,m|0,5,0)|0,M=An(M|0,Be()|0,-5,-1)|0,M=Js(M|0,Be()|0,6,0)|0,M=An(M|0,Be()|0,1,0)|0,d=Be()|0):(M=f,d=m),P=E+-1|0,P=di(f|0,m|0,P|0,((P|0)<0)<<31>>31|0)|0,P=An(M|0,d|0,P|0,Be()|0)|0,E=Be()|0,m=w,m=An(P|0,E|0,g[m>>2]|0,g[m+4>>2]|0)|0,E=Be()|0,P=w,g[P>>2]=m,g[P+4>>2]=E),(L|0)<=(v|0)){f=37;break}}if((f|0)==19)Xt(23313,22674,1099,22710);else if((f|0)==37){O=w,T=g[O+4>>2]|0,O=g[O>>2]|0;break}else if((f|0)==42)return Te=$,T|0}else T=0,O=0}else f=33;while(!1);e:do if((f|0)==33)if(F=w,g[F>>2]=0,g[F+4>>2]=0,(te|0)>(v|0)){for(M=te;;){if(T=Kt(y|0,_|0,(15-M|0)*3|0)|0,Be()|0,T=T&7,(T|0)==7){T=5;break}if(O=te-M|0,O=Ws(7,0,O,((O|0)<0)<<31>>31)|0,T=di(O|0,Be()|0,T|0,0)|0,O=Be()|0,F=w,O=An(g[F>>2]|0,g[F+4>>2]|0,T|0,O|0)|0,T=Be()|0,F=w,g[F>>2]=O,g[F+4>>2]=T,M=M+-1|0,(M|0)<=(v|0))break e}return Te=$,T|0}else T=0,O=0;while(!1);return Bc(G,c,te,W)|0&&Xt(23313,22674,1063,22725),te=W,W=g[te+4>>2]|0,((T|0)>-1|(T|0)==-1&O>>>0>4294967295)&((W|0)>(T|0)|((W|0)==(T|0)?(g[te>>2]|0)>>>0>O>>>0:0))?(te=0,Te=$,te|0):(Xt(23313,22674,1139,22710),0)}function cA(y,_,v,w,T,M){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,M=M|0;var O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0;if(E=Te,Te=Te+16|0,O=E,T>>>0>15)return M=4,Te=E,M|0;if(c=Kt(v|0,w|0,52)|0,Be()|0,c=c&15,(c|0)>(T|0))return M=12,Te=E,M|0;if(Bc(v,w,T,O)|0&&Xt(23313,22674,1063,22725),m=O,f=g[m+4>>2]|0,!(((_|0)>-1|(_|0)==-1&y>>>0>4294967295)&((f|0)>(_|0)|((f|0)==(_|0)?(g[m>>2]|0)>>>0>y>>>0:0))))return M=2,Te=E,M|0;m=T-c|0,T=tr(T|0,0,52)|0,d=Be()|0|w&-15728641,f=M,g[f>>2]=T|v,g[f+4>>2]=d,f=Kt(v|0,w|0,45)|0,Be()|0;e:do if(Ir(f&127)|0){if(c|0)for(O=1;;){if(f=tr(7,0,(15-O|0)*3|0)|0,!((f&v|0)==0&((Be()|0)&w|0)==0))break e;if(O>>>0<c>>>0)O=O+1|0;else break}if((m|0)<1)return M=0,Te=E,M|0;for(f=c^15,w=-1,d=1,O=1;;){c=m-d|0,c=Ws(7,0,c,((c|0)<0)<<31>>31)|0,v=Be()|0;do if(O)if(O=di(c|0,v|0,5,0)|0,O=An(O|0,Be()|0,-5,-1)|0,O=Js(O|0,Be()|0,6,0)|0,T=Be()|0,(_|0)>(T|0)|(_|0)==(T|0)&y>>>0>O>>>0){_=An(y|0,_|0,-1,-1)|0,_=Qr(_|0,Be()|0,O|0,T|0)|0,O=Be()|0,P=M,F=g[P>>2]|0,P=g[P+4>>2]|0,G=(f+w|0)*3|0,L=tr(7,0,G|0)|0,P=P&~(Be()|0),w=Js(_|0,O|0,c|0,v|0)|0,y=Be()|0,T=An(w|0,y|0,2,0)|0,G=tr(T|0,Be()|0,G|0)|0,P=Be()|0|P,T=M,g[T>>2]=G|F&~L,g[T+4>>2]=P,y=di(w|0,y|0,c|0,v|0)|0,y=Qr(_|0,O|0,y|0,Be()|0)|0,O=0,_=Be()|0;break}else{G=M,L=g[G>>2]|0,G=g[G+4>>2]|0,F=tr(7,0,(f+w|0)*3|0)|0,G=G&~(Be()|0),O=M,g[O>>2]=L&~F,g[O+4>>2]=G,O=1;break}else L=M,T=g[L>>2]|0,L=g[L+4>>2]|0,w=(f+w|0)*3|0,P=tr(7,0,w|0)|0,L=L&~(Be()|0),G=Js(y|0,_|0,c|0,v|0)|0,O=Be()|0,w=tr(G|0,O|0,w|0)|0,L=Be()|0|L,F=M,g[F>>2]=w|T&~P,g[F+4>>2]=L,O=di(G|0,O|0,c|0,v|0)|0,y=Qr(y|0,_|0,O|0,Be()|0)|0,O=0,_=Be()|0;while(!1);if((m|0)>(d|0))w=~d,d=d+1|0;else{_=0;break}}return Te=E,_|0}while(!1);if((m|0)<1)return G=0,Te=E,G|0;for(T=c^15,O=1;;)if(F=m-O|0,F=Ws(7,0,F,((F|0)<0)<<31>>31)|0,G=Be()|0,d=M,v=g[d>>2]|0,d=g[d+4>>2]|0,c=(T-O|0)*3|0,w=tr(7,0,c|0)|0,d=d&~(Be()|0),P=Js(y|0,_|0,F|0,G|0)|0,L=Be()|0,c=tr(P|0,L|0,c|0)|0,d=Be()|0|d,f=M,g[f>>2]=c|v&~w,g[f+4>>2]=d,G=di(P|0,L|0,F|0,G|0)|0,y=Qr(y|0,_|0,G|0,Be()|0)|0,_=Be()|0,(m|0)<=(O|0)){_=0;break}else O=O+1|0;return Te=E,_|0}function Sc(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0;T=Kt(_|0,v|0,52)|0,Be()|0,T=T&15,(_|0)==0&(v|0)==0|((w|0)>15|(T|0)>(w|0))?(w=-1,T=-1,_=0,v=0):(M=pu(_,v,T+1|0,w)|0,v=(Be()|0)&-15728641,_=tr(w|0,0,52)|0,_=M|_,v=v|(Be()|0),M=(Rn(_,v)|0)==0,w=M?-1:w),M=y,g[M>>2]=_,g[M+4>>2]=v,g[y+8>>2]=T,g[y+12>>2]=w}function _u(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0;if(v=y,_=g[v>>2]|0,v=g[v+4>>2]|0,!((_|0)==0&(v|0)==0)&&(w=Kt(_|0,v|0,52)|0,Be()|0,w=w&15,c=tr(1,0,(w^15)*3|0)|0,_=An(c|0,Be()|0,_|0,v|0)|0,v=Be()|0,c=y,g[c>>2]=_,g[c+4>>2]=v,c=y+8|0,O=g[c>>2]|0,!((w|0)<(O|0)))){for(d=y+12|0,M=w;;){if((M|0)==(O|0)){w=5;break}if(f=(M|0)==(g[d>>2]|0),T=(15-M|0)*3|0,w=Kt(_|0,v|0,T|0)|0,Be()|0,w=w&7,f&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(f=tr(1,0,T|0)|0,_=An(_|0,v|0,f|0,Be()|0)|0,v=Be()|0,f=y,g[f>>2]=_,g[f+4>>2]=v,(M|0)>(O|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){f=y,g[f>>2]=0,g[f+4>>2]=0,g[c>>2]=-1,g[d>>2]=-1;return}else if((w|0)==7){O=tr(1,0,T|0)|0,O=An(_|0,v|0,O|0,Be()|0)|0,c=Be()|0,f=y,g[f>>2]=O,g[f+4>>2]=c,g[d>>2]=M+-1;return}else if((w|0)==10)return}}function kl(y){y=+y;var _=0;return _=y<0?y+6.283185307179586:y,+(y>=6.283185307179586?_+-6.283185307179586:_)}function rl(y,_){return y=y|0,_=_|0,+Pt(+(+le[y>>3]-+le[_>>3]))<17453292519943298e-27?(_=+Pt(+(+le[y+8>>3]-+le[_+8>>3]))<17453292519943298e-27,_|0):(_=0,_|0)}function yu(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;return T=+le[_>>3],w=+le[y>>3],M=+It(+((T-w)*.5)),v=+It(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ft(+T)*+Ft(+w)*v),+(+cn(+ +Dt(+v),+ +Dt(+(1-v)))*2)}function nl(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;return T=+le[_>>3],w=+le[y>>3],M=+It(+((T-w)*.5)),v=+It(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ft(+T)*+Ft(+w)*v),+(+cn(+ +Dt(+v),+ +Dt(+(1-v)))*2*6371.007180918475)}function vh(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;return T=+le[_>>3],w=+le[y>>3],M=+It(+((T-w)*.5)),v=+It(+((+le[_+8>>3]-+le[y+8>>3])*.5)),v=M*M+v*(+Ft(+T)*+Ft(+w)*v),+(+cn(+ +Dt(+v),+ +Dt(+(1-v)))*2*6371.007180918475*1e3)}function xh(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0;return M=+le[_>>3],w=+Ft(+M),T=+le[_+8>>3]-+le[y+8>>3],O=w*+It(+T),v=+le[y>>3],+ +cn(+O,+(+It(+M)*+Ft(+v)-+Ft(+T)*(w*+It(+v))))}function Ic(y,_,v,w){y=y|0,_=+_,v=+v,w=w|0;var T=0,M=0,O=0,c=0;if(v<1e-16){g[w>>2]=g[y>>2],g[w+4>>2]=g[y+4>>2],g[w+8>>2]=g[y+8>>2],g[w+12>>2]=g[y+12>>2];return}M=_<0?_+6.283185307179586:_,M=_>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)_=+le[y>>3]+v,le[w>>3]=_,T=w;else{if(T=+Pt(+(M+-3.141592653589793))<1e-16,_=+le[y>>3],T){_=_-v,le[w>>3]=_,T=w;break}if(O=+Ft(+v),v=+It(+v),_=O*+It(+_)+ +Ft(+M)*(v*+Ft(+_)),_=_>1?1:_,_=+er(+(_<-1?-1:_)),le[w>>3]=_,+Pt(+(_+-1.5707963267948966))<1e-16){le[w>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+Pt(+(_+1.5707963267948966))<1e-16){le[w>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(c=+Ft(+_),M=v*+It(+M)/c,v=+le[y>>3],_=(O-+It(+_)*+It(+v))/+Ft(+v)/c,O=M>1?1:M,_=_>1?1:_,_=+le[y+8>>3]+ +cn(+(O<-1?-1:O),+(_<-1?-1:_)),_>3.141592653589793)do _=_+-6.283185307179586;while(_>3.141592653589793);if(_<-3.141592653589793)do _=_+6.283185307179586;while(_<-3.141592653589793);le[w+8>>3]=_;return}while(!1);if(+Pt(+(_+-1.5707963267948966))<1e-16){le[T>>3]=1.5707963267948966,le[w+8>>3]=0;return}if(+Pt(+(_+1.5707963267948966))<1e-16){le[T>>3]=-1.5707963267948966,le[w+8>>3]=0;return}if(_=+le[y+8>>3],_>3.141592653589793)do _=_+-6.283185307179586;while(_>3.141592653589793);if(_<-3.141592653589793)do _=_+6.283185307179586;while(_<-3.141592653589793);le[w+8>>3]=_}function zf(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20528+(y<<3)>>3],_=0,_|0)}function il(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20656+(y<<3)>>3],_=0,_|0)}function Kn(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20784+(y<<3)>>3],_=0,_|0)}function bu(y,_){return y=y|0,_=_|0,y>>>0>15?(_=4,_|0):(le[_>>3]=+le[20912+(y<<3)>>3],_=0,_|0)}function Yo(y,_){y=y|0,_=_|0;var v=0;return y>>>0>15?(_=4,_|0):(v=Ws(7,0,y,((y|0)<0)<<31>>31)|0,v=di(v|0,Be()|0,120,0)|0,y=Be()|0,g[_>>2]=v|2,g[_+4>>2]=y,_=0,_|0)}function ea(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;return P=+le[_>>3],m=+le[y>>3],d=+It(+((P-m)*.5)),M=+le[_+8>>3],f=+le[y+8>>3],O=+It(+((M-f)*.5)),c=+Ft(+m),E=+Ft(+P),O=d*d+O*(E*c*O),O=+cn(+ +Dt(+O),+ +Dt(+(1-O)))*2,d=+le[v>>3],P=+It(+((d-P)*.5)),w=+le[v+8>>3],M=+It(+((w-M)*.5)),T=+Ft(+d),M=P*P+M*(E*T*M),M=+cn(+ +Dt(+M),+ +Dt(+(1-M)))*2,d=+It(+((m-d)*.5)),w=+It(+((f-w)*.5)),w=d*d+w*(c*T*w),w=+cn(+ +Dt(+w),+ +Dt(+(1-w)))*2,T=(O+M+w)*.5,+(+en(+ +Dt(+(+jt(+(T*.5))*+jt(+((T-O)*.5))*+jt(+((T-M)*.5))*+jt(+((T-w)*.5)))))*4)}function hn(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0;if(c=Te,Te=Te+192|0,M=c+168|0,O=c,T=Ol(y,_,M)|0,T|0)return v=T,Te=c,v|0;if(Dl(y,_,O)|0&&Xt(23313,22742,386,22751),_=g[O>>2]|0,(_|0)>0){if(w=+ea(O+8|0,O+8+(((_|0)!=1&1)<<4)|0,M)+0,(_|0)!=1){y=1;do T=y,y=y+1|0,w=w+ +ea(O+8+(T<<4)|0,O+8+(((y|0)%(_|0)|0)<<4)|0,M);while((y|0)<(_|0))}}else w=0;return le[v>>3]=w,v=0,Te=c,v|0}function kn(y,_,v){return y=y|0,_=_|0,v=v|0,y=hn(y,_,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475),y|0}function Vs(y,_,v){return y=y|0,_=_|0,v=v|0,y=hn(y,_,v)|0,y|0||(le[v>>3]=+le[v>>3]*6371.007180918475*6371.007180918475*1e3*1e3),y|0}function Mc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Te,Te=Te+176|0,O=c,y=uu(y,_,O)|0,y|0)return O=y,Te=c,O|0;if(le[v>>3]=0,y=g[O>>2]|0,(y|0)<=1)return O=0,Te=c,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],T=+le[O+16>>3],M=0;do y=y+1|0,f=w,w=+le[O+8+(y<<4)>>3],m=+It(+((w-f)*.5)),d=T,T=+le[O+8+(y<<4)+8>>3],d=+It(+((T-d)*.5)),d=m*m+d*(+Ft(+w)*+Ft(+f)*d),M=M+ +cn(+ +Dt(+d),+ +Dt(+(1-d)))*2;while((y|0)<(_|0));return le[v>>3]=M,O=0,Te=c,O|0}function Nl(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Te,Te=Te+176|0,O=c,y=uu(y,_,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,le[v>>3]=M,Te=c,O|0;if(le[v>>3]=0,y=g[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,le[v>>3]=M,Te=c,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],T=+le[O+16>>3],M=0;do y=y+1|0,f=w,w=+le[O+8+(y<<4)>>3],m=+It(+((w-f)*.5)),d=T,T=+le[O+8+(y<<4)+8>>3],d=+It(+((T-d)*.5)),d=m*m+d*(+Ft(+f)*+Ft(+w)*d),M=M+ +cn(+ +Dt(+d),+ +Dt(+(1-d)))*2;while((y|0)!=(_|0));return le[v>>3]=M,O=0,m=M,m=m*6371.007180918475,le[v>>3]=m,Te=c,O|0}function Pc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Te,Te=Te+176|0,O=c,y=uu(y,_,O)|0,y|0)return O=y,M=+le[v>>3],M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Te=c,O|0;if(le[v>>3]=0,y=g[O>>2]|0,(y|0)<=1)return O=0,M=0,M=M*6371.007180918475,M=M*1e3,le[v>>3]=M,Te=c,O|0;_=y+-1|0,y=0,w=+le[O+8>>3],T=+le[O+16>>3],M=0;do y=y+1|0,f=w,w=+le[O+8+(y<<4)>>3],m=+It(+((w-f)*.5)),d=T,T=+le[O+8+(y<<4)+8>>3],d=+It(+((T-d)*.5)),d=m*m+d*(+Ft(+f)*+Ft(+w)*d),M=M+ +cn(+ +Dt(+d),+ +Dt(+(1-d)))*2;while((y|0)!=(_|0));return le[v>>3]=M,O=0,m=M,m=m*6371.007180918475,m=m*1e3,le[v>>3]=m,Te=c,O|0}function uA(y){y=y|0;var _=0,v=0,w=0;return _=lo(1,12)|0,_||Xt(22832,22787,49,22845),v=y+4|0,w=g[v>>2]|0,w|0?(w=w+8|0,g[w>>2]=_,g[v>>2]=_,_|0):(g[y>>2]|0&&Xt(22862,22787,61,22885),w=y,g[w>>2]=_,g[v>>2]=_,_|0)}function hA(y,_){y=y|0,_=_|0;var v=0,w=0;return w=Xn(24)|0,w||Xt(22899,22787,78,22913),g[w>>2]=g[_>>2],g[w+4>>2]=g[_+4>>2],g[w+8>>2]=g[_+8>>2],g[w+12>>2]=g[_+12>>2],g[w+16>>2]=0,_=y+4|0,v=g[_>>2]|0,v|0?(g[v+16>>2]=w,g[_>>2]=w,w|0):(g[y>>2]|0&&Xt(22928,22787,82,22913),g[y>>2]=w,g[_>>2]=w,w|0)}function Ul(y){y=y|0;var _=0,v=0,w=0,T=0;if(y)for(w=1;;){if(_=g[y>>2]|0,_|0)do{if(v=g[_>>2]|0,v|0)do T=v,v=g[v+16>>2]|0,Ur(T);while((v|0)!=0);T=_,_=g[_+8>>2]|0,Ur(T)}while((_|0)!=0);if(_=y,y=g[y+8>>2]|0,w||Ur(_),y)w=0;else break}}function Lc(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0,He=0,Je=0,et=0,Xe=0,Ye=0,pt=0,Ot=0,xt=0;if(T=y+8|0,g[T>>2]|0)return xt=1,xt|0;if(w=g[y>>2]|0,!w)return xt=0,xt|0;_=w,v=0;do v=v+1|0,_=g[_+8>>2]|0;while((_|0)!=0);if(v>>>0<2)return xt=0,xt|0;pt=Xn(v<<2)|0,pt||Xt(22948,22787,317,22967),Ye=Xn(v<<5)|0,Ye||Xt(22989,22787,321,22967),g[y>>2]=0,Pe=y+4|0,g[Pe>>2]=0,g[T>>2]=0,v=0,Xe=0,ve=0,E=0;e:for(;;){if(m=g[w>>2]|0,m){M=0,O=m;do{if(d=+le[O+8>>3],_=O,O=g[O+16>>2]|0,f=(O|0)==0,T=f?m:O,c=+le[T+8>>3],+Pt(+(d-c))>3.141592653589793){xt=14;break}M=M+(c-d)*(+le[_>>3]+ +le[T>>3])}while(!f);if((xt|0)==14){xt=0,M=0,_=m;do se=+le[_+8>>3],et=_+16|0,Je=g[et>>2]|0,Je=(Je|0)==0?m:Je,re=+le[Je+8>>3],M=M+(+le[_>>3]+ +le[Je>>3])*((re<0?re+6.283185307179586:re)-(se<0?se+6.283185307179586:se)),_=g[((_|0)==0?w:et)>>2]|0;while((_|0)!=0)}M>0?(g[pt+(Xe<<2)>>2]=w,Xe=Xe+1|0,T=ve,_=E):xt=19}else xt=19;if((xt|0)==19){xt=0;do if(v){if(_=v+8|0,g[_>>2]|0){xt=21;break e}if(v=lo(1,12)|0,!v){xt=23;break e}g[_>>2]=v,T=v+4|0,O=v,_=E}else if(E){T=Pe,O=E+8|0,_=w,v=y;break}else if(g[y>>2]|0){xt=27;break e}else{T=Pe,O=y,_=w,v=y;break}while(!1);if(g[O>>2]=w,g[T>>2]=w,O=Ye+(ve<<5)|0,f=g[w>>2]|0,f){for(m=Ye+(ve<<5)+8|0,le[m>>3]=17976931348623157e292,E=Ye+(ve<<5)+24|0,le[E>>3]=17976931348623157e292,le[O>>3]=-17976931348623157e292,P=Ye+(ve<<5)+16|0,le[P>>3]=-17976931348623157e292,te=17976931348623157e292,$=-17976931348623157e292,T=0,L=f,d=17976931348623157e292,G=17976931348623157e292,W=-17976931348623157e292,c=-17976931348623157e292;M=+le[L>>3],se=+le[L+8>>3],L=g[L+16>>2]|0,F=(L|0)==0,re=+le[(F?f:L)+8>>3],M<d&&(le[m>>3]=M,d=M),se<G&&(le[E>>3]=se,G=se),M>W?le[O>>3]=M:M=W,se>c&&(le[P>>3]=se,c=se),te=se>0&se<te?se:te,$=se<0&se>$?se:$,T=T|+Pt(+(se-re))>3.141592653589793,!F;)W=M;T&&(le[P>>3]=$,le[E>>3]=te)}else g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[O+12>>2]=0,g[O+16>>2]=0,g[O+20>>2]=0,g[O+24>>2]=0,g[O+28>>2]=0;T=ve+1|0}if(et=w+8|0,w=g[et>>2]|0,g[et>>2]=0,w)ve=T,E=_;else{xt=45;break}}if((xt|0)==21)Xt(22765,22787,35,22799);else if((xt|0)==23)Xt(22819,22787,37,22799);else if((xt|0)==27)Xt(22862,22787,61,22885);else if((xt|0)==45){e:do if((Xe|0)>0){for(et=(T|0)==0,He=T<<2,Je=(y|0)==0,Ie=0,_=0;;){if(me=g[pt+(Ie<<2)>>2]|0,et)xt=73;else{if(ve=Xn(He)|0,!ve){xt=50;break}if(Pe=Xn(He)|0,!Pe){xt=52;break}t:do if(Je)v=0;else{for(T=0,v=0,O=y;w=Ye+(T<<5)|0,Ro(g[O>>2]|0,w,g[me>>2]|0)|0?(g[ve+(v<<2)>>2]=O,g[Pe+(v<<2)>>2]=w,F=v+1|0):F=v,O=g[O+8>>2]|0,O;)T=T+1|0,v=F;if((F|0)>0)if(w=g[ve>>2]|0,(F|0)==1)v=w;else for(P=0,L=-1,v=w,E=w;;){for(f=g[E>>2]|0,w=0,O=0;T=g[g[ve+(O<<2)>>2]>>2]|0,(T|0)==(f|0)?m=w:m=w+((Ro(T,g[Pe+(O<<2)>>2]|0,g[f>>2]|0)|0)&1)|0,O=O+1|0,(O|0)!=(F|0);)w=m;if(T=(m|0)>(L|0),v=T?E:v,w=P+1|0,(w|0)==(F|0))break t;P=w,L=T?m:L,E=g[ve+(w<<2)>>2]|0}else v=0}while(!1);if(Ur(ve),Ur(Pe),v){if(T=v+4|0,w=g[T>>2]|0,w)v=w+8|0;else if(g[v>>2]|0){xt=70;break}g[v>>2]=me,g[T>>2]=me}else xt=73}if((xt|0)==73){if(xt=0,_=g[me>>2]|0,_|0)do Pe=_,_=g[_+16>>2]|0,Ur(Pe);while((_|0)!=0);Ur(me),_=1}if(Ie=Ie+1|0,(Ie|0)>=(Xe|0)){Ot=_;break e}}(xt|0)==50?Xt(23004,22787,249,23023):(xt|0)==52?Xt(23042,22787,252,23023):(xt|0)==70&&Xt(22862,22787,61,22885)}else Ot=0;while(!1);return Ur(pt),Ur(Ye),xt=Ot,xt|0}return 0}function Ro(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(!(zs(_,v)|0)||(_=wc(_)|0,w=+le[v>>3],T=+le[v+8>>3],T=_&T<0?T+6.283185307179586:T,y=g[y>>2]|0,!y))return y=0,y|0;if(_){_=0,f=T,v=y;e:for(;;){for(;O=+le[v>>3],T=+le[v+8>>3],v=v+16|0,m=g[v>>2]|0,m=(m|0)==0?y:m,M=+le[m>>3],c=+le[m+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=g[v>>2]|0,!v){v=22;break e}if(c=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,f=c==f|O==f?f+-2220446049250313e-31:f,d=c+(O-c)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>f&&(_=_^1),v=g[v>>2]|0,!v){v=22;break}}if((v|0)==22)return _|0}else{_=0,f=T,v=y;e:for(;;){for(;O=+le[v>>3],T=+le[v+8>>3],v=v+16|0,m=g[v>>2]|0,m=(m|0)==0?y:m,M=+le[m>>3],c=+le[m+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=g[v>>2]|0,!v){v=22;break e}if(f=O==f|T==f?f+-2220446049250313e-31:f,O+(T-O)*((w-M)/(d-M))>f&&(_=_^1),v=g[v>>2]|0,!v){v=22;break}}if((v|0)==22)return _|0}return 0}function Nn(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0;if($=Te,Te=Te+32|0,te=$+16|0,W=$,M=Kt(y|0,_|0,52)|0,Be()|0,M=M&15,L=Kt(v|0,w|0,52)|0,Be()|0,(M|0)!=(L&15|0))return te=12,Te=$,te|0;if(f=Kt(y|0,_|0,45)|0,Be()|0,f=f&127,m=Kt(v|0,w|0,45)|0,Be()|0,m=m&127,f>>>0>121|m>>>0>121)return te=5,Te=$,te|0;if(L=(f|0)!=(m|0),L){if(c=vc(f,m)|0,(c|0)==7)return te=1,Te=$,te|0;d=vc(m,f)|0,(d|0)==7?Xt(23066,23090,161,23100):(F=c,O=d)}else F=0,O=0;E=Ir(f)|0,P=Ir(m)|0,g[te>>2]=0,g[te+4>>2]=0,g[te+8>>2]=0,g[te+12>>2]=0;do if(F){if(m=g[4272+(f*28|0)+(F<<2)>>2]|0,c=(m|0)>0,P)if(c){f=0,d=v,c=w;do d=Au(d,c)|0,c=Be()|0,O=ro(O)|0,(O|0)==1&&(O=ro(1)|0),f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=c}else m=O,f=v,d=w;else if(c){f=0,d=v,c=w;do d=qa(d,c)|0,c=Be()|0,O=ro(O)|0,f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=c}else m=O,f=v,d=w;if(Hs(f,d,te)|0,L||Xt(23115,23090,191,23100),c=(E|0)!=0,O=(P|0)!=0,c&O&&Xt(23142,23090,192,23100),c){if(O=ts(y,_)|0,(O|0)==7){M=5;break}if(we[21872+(O*7|0)+F>>0]|0){M=1;break}d=g[21040+(O*28|0)+(F<<2)>>2]|0,f=d}else if(O){if(O=ts(f,d)|0,(O|0)==7){M=5;break}if(we[21872+(O*7|0)+m>>0]|0){M=1;break}f=0,d=g[21040+(m*28|0)+(O<<2)>>2]|0}else f=0,d=0;if((f|d|0)<0)M=5;else{if((d|0)>0){c=te+4|0,O=0;do cu(c),O=O+1|0;while((O|0)!=(d|0))}if(g[W>>2]=0,g[W+4>>2]=0,g[W+8>>2]=0,mh(W,F),M|0)for(;js(M)|0?Ml(W):Xo(W),(M|0)>1;)M=M+-1|0;if((f|0)>0){M=0;do cu(W),M=M+1|0;while((M|0)!=(f|0))}G=te+4|0,zn(G,W,G),bi(G),G=51}}else if(Hs(v,w,te)|0,(E|0)!=0&(P|0)!=0)if((m|0)!=(f|0)&&Xt(23173,23090,261,23100),O=ts(y,_)|0,M=ts(v,w)|0,(O|0)==7|(M|0)==7)M=5;else if(we[21872+(O*7|0)+M>>0]|0)M=1;else if(O=g[21040+(O*28|0)+(M<<2)>>2]|0,(O|0)>0){c=te+4|0,M=0;do cu(c),M=M+1|0;while((M|0)!=(O|0));G=51}else G=51;else G=51;while(!1);return(G|0)==51&&(M=te+4|0,g[T>>2]=g[M>>2],g[T+4>>2]=g[M+4>>2],g[T+8>>2]=g[M+8>>2],M=0),te=M,Te=$,te|0}function Gl(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0;if(G=Te,Te=Te+48|0,f=G+36|0,O=G+24|0,c=G+12|0,d=G,T=Kt(y|0,_|0,52)|0,Be()|0,T=T&15,P=Kt(y|0,_|0,45)|0,Be()|0,P=P&127,P>>>0>121)return w=5,Te=G,w|0;if(m=Ir(P)|0,tr(T|0,0,52)|0,W=Be()|0|134225919,M=w,g[M>>2]=-1,g[M+4>>2]=W,!T)return T=Cc(v)|0,(T|0)==7||(T=ba(P,T)|0,(T|0)==127)?(W=1,Te=G,W|0):(L=tr(T|0,0,45)|0,F=Be()|0,P=w,F=g[P+4>>2]&-1040385|F,W=w,g[W>>2]=g[P>>2]|L,g[W+4>>2]=F,W=0,Te=G,W|0);for(g[f>>2]=g[v>>2],g[f+4>>2]=g[v+4>>2],g[f+8>>2]=g[v+8>>2],v=T;;){if(M=v,v=v+-1|0,g[O>>2]=g[f>>2],g[O+4>>2]=g[f+4>>2],g[O+8>>2]=g[f+8>>2],js(M)|0){if(T=sA(f)|0,T|0){v=13;break}g[c>>2]=g[f>>2],g[c+4>>2]=g[f+4>>2],g[c+8>>2]=g[f+8>>2],Ml(c)}else{if(T=oA(f)|0,T|0){v=13;break}g[c>>2]=g[f>>2],g[c+4>>2]=g[f+4>>2],g[c+8>>2]=g[f+8>>2],Xo(c)}if(fi(O,c,d),bi(d),T=w,$=g[T>>2]|0,T=g[T+4>>2]|0,re=(15-M|0)*3|0,te=tr(7,0,re|0)|0,T=T&~(Be()|0),re=tr(Cc(d)|0,0,re|0)|0,T=Be()|0|T,W=w,g[W>>2]=re|$&~te,g[W+4>>2]=T,(M|0)<=1){v=14;break}}e:do if((v|0)!=13&&(v|0)==14)if((g[f>>2]|0)<=1&&(g[f+4>>2]|0)<=1&&(g[f+8>>2]|0)<=1){v=Cc(f)|0,T=ba(P,v)|0,(T|0)==127?d=0:d=Ir(T)|0;t:do if(v){if(m){if(T=ts(y,_)|0,(T|0)==7){T=5;break e}if(M=g[21248+(T*28|0)+(v<<2)>>2]|0,(M|0)>0){T=v,v=0;do T=xo(T)|0,v=v+1|0;while((v|0)!=(M|0))}else T=v;if((T|0)==1){T=9;break e}v=ba(P,T)|0,(v|0)==127&&Xt(23200,23090,411,23230),Ir(v)|0?Xt(23245,23090,412,23230):(F=v,L=M,E=T)}else F=T,L=0,E=v;if(c=g[4272+(P*28|0)+(E<<2)>>2]|0,(c|0)<=-1&&Xt(23276,23090,419,23230),!d){if((L|0)<0){T=5;break e}if(L|0){M=w,T=0,v=g[M>>2]|0,M=g[M+4>>2]|0;do v=wo(v,M)|0,M=Be()|0,re=w,g[re>>2]=v,g[re+4>>2]=M,T=T+1|0;while((T|0)<(L|0))}if((c|0)<=0){T=F,v=58;break}for(M=w,T=0,v=g[M>>2]|0,M=g[M+4>>2]|0;;)if(v=wo(v,M)|0,M=Be()|0,re=w,g[re>>2]=v,g[re+4>>2]=M,T=T+1|0,(T|0)==(c|0)){T=F,v=58;break t}}if(O=vc(F,P)|0,(O|0)==7&&Xt(23066,23090,428,23230),T=w,v=g[T>>2]|0,T=g[T+4>>2]|0,(c|0)>0){M=0;do v=wo(v,T)|0,T=Be()|0,re=w,g[re>>2]=v,g[re+4>>2]=T,M=M+1|0;while((M|0)!=(c|0))}if(T=ts(v,T)|0,(T|0)==7&&Xt(23313,23090,440,23230),v=Dn(F)|0,v=g[(v?21664:21456)+(O*28|0)+(T<<2)>>2]|0,(v|0)<0&&Xt(23313,23090,454,23230),!v)T=F,v=58;else{O=w,T=0,M=g[O>>2]|0,O=g[O+4>>2]|0;do M=Sa(M,O)|0,O=Be()|0,re=w,g[re>>2]=M,g[re+4>>2]=O,T=T+1|0;while((T|0)<(v|0));T=F,v=58}}else if((m|0)!=0&(d|0)!=0){if(v=ts(y,_)|0,M=w,M=ts(g[M>>2]|0,g[M+4>>2]|0)|0,(v|0)==7|(M|0)==7){T=5;break e}if(M=g[21248+(v*28|0)+(M<<2)>>2]|0,(M|0)<0){T=5;break e}if(!M)v=59;else{c=w,v=0,O=g[c>>2]|0,c=g[c+4>>2]|0;do O=wo(O,c)|0,c=Be()|0,re=w,g[re>>2]=O,g[re+4>>2]=c,v=v+1|0;while((v|0)<(M|0));v=58}}else v=58;while(!1);if((v|0)==58&&d&&(v=59),(v|0)==59&&(re=w,(ts(g[re>>2]|0,g[re+4>>2]|0)|0)==1)){T=9;break}re=w,te=g[re>>2]|0,re=g[re+4>>2]&-1040385,$=tr(T|0,0,45)|0,re=re|(Be()|0),T=w,g[T>>2]=te|$,g[T+4>>2]=re,T=0}else T=1;while(!1);return re=T,Te=G,re|0}function jf(y,_,v,w,T,M){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0,M=M|0;var O=0,c=0;return c=Te,Te=Te+16|0,O=c,T?y=15:(y=Nn(y,_,v,w,O)|0,y||(wa(O,M),y=0)),Te=c,y|0}function Ei(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0;return O=Te,Te=Te+16|0,M=O,w?v=15:(v=Ca(v,M)|0,v||(v=Gl(y,_,M,T)|0)),Te=O,v|0}function or(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0;return d=Te,Te=Te+32|0,O=d+12|0,c=d,M=Nn(y,_,y,_,O)|0,M|0?(c=M,Te=d,c|0):(y=Nn(y,_,v,w,c)|0,y|0?(c=y,Te=d,c|0):(O=Ec(O,c)|0,c=T,g[c>>2]=O,g[c+4>>2]=((O|0)<0)<<31>>31,c=0,Te=d,c|0))}function Ss(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0;return d=Te,Te=Te+32|0,O=d+12|0,c=d,M=Nn(y,_,y,_,O)|0,!M&&(M=Nn(y,_,v,w,c)|0,!M)?(w=Ec(O,c)|0,w=An(w|0,((w|0)<0)<<31>>31|0,1,0)|0,O=Be()|0,c=T,g[c>>2]=w,g[c+4>>2]=O,c=0,Te=d,c|0):(c=M,Te=d,c|0)}function vu(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0,Ie=0;if(me=Te,Te=Te+48|0,O=me+24|0,c=me+12|0,Pe=me,M=Nn(y,_,y,_,O)|0,!M&&(M=Nn(y,_,v,w,c)|0,!M)){se=Ec(O,c)|0,ve=((se|0)<0)<<31>>31,g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[c>>2]=0,g[c+4>>2]=0,g[c+8>>2]=0,Nn(y,_,y,_,O)|0&&Xt(23313,23090,691,23299),Nn(y,_,v,w,c)|0&&Xt(23313,23090,696,23299),Ea(O),Ea(c),se?(E=g[O>>2]|0,F=+(se|0),te=O+4|0,P=g[te>>2]|0,$=O+8|0,L=g[$>>2]|0,re=O,w=E,M=P,v=L,G=+((g[c>>2]|0)-E|0)/F,W=+((g[c+4>>2]|0)-P|0)/F,F=+((g[c+8>>2]|0)-L|0)/F):(M=O+4|0,v=O+8|0,te=M,$=v,re=O,w=g[O>>2]|0,M=g[M>>2]|0,v=g[v>>2]|0,G=0,W=0,F=0),g[Pe>>2]=w,L=Pe+4|0,g[L>>2]=M,P=Pe+8|0,g[P>>2]=v;e:do if((se|0)<0)M=0;else for(m=0,E=0,M=w;;){f=+(E>>>0)+4294967296*+(m|0),Ie=G*f+ +(M|0),d=W*f+ +(g[te>>2]|0),f=F*f+ +(g[$>>2]|0),v=~~+na(+Ie),O=~~+na(+d),M=~~+na(+f),Ie=+Pt(+(+(v|0)-Ie)),d=+Pt(+(+(O|0)-d)),f=+Pt(+(+(M|0)-f));do if(Ie>d&Ie>f)v=0-(O+M)|0,w=O;else if(c=0-v|0,d>f){w=c-M|0;break}else{w=O,M=c-O|0;break}while(!1);if(g[Pe>>2]=v,g[L>>2]=w,g[P>>2]=M,Xa(Pe),M=Gl(y,_,Pe,T+(E<<3)|0)|0,M|0)break e;if(!((m|0)<(ve|0)|(m|0)==(ve|0)&E>>>0<se>>>0)){M=0;break e}M=An(E|0,m|0,1,0)|0,c=Be()|0,m=c,E=M,M=g[re>>2]|0}while(!1);return Pe=M,Te=me,Pe|0}return Pe=M,Te=me,Pe|0}function Ws(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0;if((v|0)==0&(w|0)==0)return T=0,M=1,mr(T|0),M|0;M=y,T=_,y=1,_=0;do O=(v&1|0)==0&!0,y=di((O?1:M)|0,(O?0:T)|0,y|0,_|0)|0,_=Be()|0,v=Bo(v|0,w|0,1)|0,w=Be()|0,M=di(M|0,T|0,M|0,T|0)|0,T=Be()|0;while(!((v|0)==0&(w|0)==0));return mr(_|0),y|0}function io(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;if(!(zs(_,v)|0)||(_=wc(_)|0,w=+le[v>>3],T=+le[v+8>>3],T=_&T<0?T+6.283185307179586:T,P=g[y>>2]|0,(P|0)<=0))return P=0,P|0;if(E=g[y+4>>2]|0,_){_=0,m=T,v=-1,y=0;e:for(;;){for(f=y;O=+le[E+(f<<4)>>3],T=+le[E+(f<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[E+(y<<4)>>3],c=+le[E+(y<<4)+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=f+1|0,(v|0)>=(P|0)){v=22;break e}else y=f,f=v,v=y;if(c=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,m=c==m|O==m?m+-2220446049250313e-31:m,d=c+(O-c)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>m&&(_=_^1),y=f+1|0,(y|0)>=(P|0)){v=22;break}else v=f}if((v|0)==22)return _|0}else{_=0,m=T,v=-1,y=0;e:for(;;){for(f=y;O=+le[E+(f<<4)>>3],T=+le[E+(f<<4)+8>>3],y=(v+2|0)%(P|0)|0,M=+le[E+(y<<4)>>3],c=+le[E+(y<<4)+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(v=f+1|0,(v|0)>=(P|0)){v=22;break e}else y=f,f=v,v=y;if(m=O==m|T==m?m+-2220446049250313e-31:m,O+(T-O)*((w-M)/(d-M))>m&&(_=_^1),y=f+1|0,(y|0)>=(P|0)){v=22;break}else v=f}if((v|0)==22)return _|0}return 0}function ms(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0;if(F=g[y>>2]|0,!F){g[_>>2]=0,g[_+4>>2]=0,g[_+8>>2]=0,g[_+12>>2]=0,g[_+16>>2]=0,g[_+20>>2]=0,g[_+24>>2]=0,g[_+28>>2]=0;return}if(G=_+8|0,le[G>>3]=17976931348623157e292,W=_+24|0,le[W>>3]=17976931348623157e292,le[_>>3]=-17976931348623157e292,te=_+16|0,le[te>>3]=-17976931348623157e292,!((F|0)<=0)){for(P=g[y+4>>2]|0,f=17976931348623157e292,m=-17976931348623157e292,E=0,y=-1,M=17976931348623157e292,O=17976931348623157e292,d=-17976931348623157e292,w=-17976931348623157e292,L=0;v=+le[P+(L<<4)>>3],c=+le[P+(L<<4)+8>>3],y=y+2|0,T=+le[P+(((y|0)==(F|0)?0:y)<<4)+8>>3],v<M&&(le[G>>3]=v,M=v),c<O&&(le[W>>3]=c,O=c),v>d?le[_>>3]=v:v=d,c>w&&(le[te>>3]=c,w=c),f=c>0&c<f?c:f,m=c<0&c>m?c:m,E=E|+Pt(+(c-T))>3.141592653589793,y=L+1|0,(y|0)!=(F|0);)$=L,d=v,L=y,y=$;E&&(le[te>>3]=m,le[W>>3]=f)}}function wh(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0,Pe=0,me=0;if(F=g[y>>2]|0,F){if(G=_+8|0,le[G>>3]=17976931348623157e292,W=_+24|0,le[W>>3]=17976931348623157e292,le[_>>3]=-17976931348623157e292,te=_+16|0,le[te>>3]=-17976931348623157e292,(F|0)>0){for(T=g[y+4>>2]|0,P=17976931348623157e292,L=-17976931348623157e292,w=0,v=-1,d=17976931348623157e292,f=17976931348623157e292,E=-17976931348623157e292,O=-17976931348623157e292,$=0;M=+le[T+($<<4)>>3],m=+le[T+($<<4)+8>>3],Pe=v+2|0,c=+le[T+(((Pe|0)==(F|0)?0:Pe)<<4)+8>>3],M<d&&(le[G>>3]=M,d=M),m<f&&(le[W>>3]=m,f=m),M>E?le[_>>3]=M:M=E,m>O&&(le[te>>3]=m,O=m),P=m>0&m<P?m:P,L=m<0&m>L?m:L,w=w|+Pt(+(m-c))>3.141592653589793,v=$+1|0,(v|0)!=(F|0);)Pe=$,E=M,$=v,v=Pe;w&&(le[te>>3]=L,le[W>>3]=P)}}else g[_>>2]=0,g[_+4>>2]=0,g[_+8>>2]=0,g[_+12>>2]=0,g[_+16>>2]=0,g[_+20>>2]=0,g[_+24>>2]=0,g[_+28>>2]=0;if(Pe=y+8|0,v=g[Pe>>2]|0,!((v|0)<=0)){ve=y+12|0,se=0;do if(T=g[ve>>2]|0,w=se,se=se+1|0,W=_+(se<<5)|0,te=g[T+(w<<3)>>2]|0,te){if($=_+(se<<5)+8|0,le[$>>3]=17976931348623157e292,y=_+(se<<5)+24|0,le[y>>3]=17976931348623157e292,le[W>>3]=-17976931348623157e292,re=_+(se<<5)+16|0,le[re>>3]=-17976931348623157e292,(te|0)>0){for(F=g[T+(w<<3)+4>>2]|0,P=17976931348623157e292,L=-17976931348623157e292,T=0,w=-1,G=0,d=17976931348623157e292,f=17976931348623157e292,m=-17976931348623157e292,O=-17976931348623157e292;M=+le[F+(G<<4)>>3],E=+le[F+(G<<4)+8>>3],w=w+2|0,c=+le[F+(((w|0)==(te|0)?0:w)<<4)+8>>3],M<d&&(le[$>>3]=M,d=M),E<f&&(le[y>>3]=E,f=E),M>m?le[W>>3]=M:M=m,E>O&&(le[re>>3]=E,O=E),P=E>0&E<P?E:P,L=E<0&E>L?E:L,T=T|+Pt(+(E-c))>3.141592653589793,w=G+1|0,(w|0)!=(te|0);)me=G,G=w,m=M,w=me;T&&(le[re>>3]=L,le[y>>3]=P)}}else g[W>>2]=0,g[W+4>>2]=0,g[W+8>>2]=0,g[W+12>>2]=0,g[W+16>>2]=0,g[W+20>>2]=0,g[W+24>>2]=0,g[W+28>>2]=0,v=g[Pe>>2]|0;while((se|0)<(v|0))}}function qt(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;if(!(io(y,_,v)|0))return T=0,T|0;if(T=y+8|0,(g[T>>2]|0)<=0)return T=1,T|0;for(w=y+12|0,y=0;;){if(M=y,y=y+1|0,io((g[w>>2]|0)+(M<<3)|0,_+(y<<5)|0,v)|0){y=0,w=6;break}if((y|0)>=(g[T>>2]|0)){y=1,w=6;break}}return(w|0)==6?y|0:0}function Ch(){return 8}function xu(){return 16}function Eh(){return 168}function so(){return 8}function Is(){return 16}function wu(){return 12}function Cu(){return 8}function Ms(y){return y=y|0,+(+((g[y>>2]|0)>>>0)+4294967296*+(g[y+4>>2]|0))}function ta(y){y=y|0;var _=0,v=0;return v=+le[y>>3],_=+le[y+8>>3],+ +Dt(+(v*v+_*_))}function Bh(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;f=+le[y>>3],d=+le[_>>3]-f,c=+le[y+8>>3],O=+le[_+8>>3]-c,E=+le[v>>3],M=+le[w>>3]-E,P=+le[v+8>>3],m=+le[w+8>>3]-P,M=(M*(c-P)-(f-E)*m)/(d*m-O*M),le[T>>3]=f+d*M,le[T+8>>3]=c+O*M}function zl(y,_){return y=y|0,_=_|0,+Pt(+(+le[y>>3]-+le[_>>3]))<11920928955078125e-23?(_=+Pt(+(+le[y+8>>3]-+le[_+8>>3]))<11920928955078125e-23,_|0):(_=0,_|0)}function Bi(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;return T=+le[y>>3]-+le[_>>3],w=+le[y+8>>3]-+le[_+8>>3],v=+le[y+16>>3]-+le[_+16>>3],+(T*T+w*w+v*v)}function Th(y,_){y=y|0,_=_|0;var v=0,w=0,T=0;v=+le[y>>3],w=+Ft(+v),v=+It(+v),le[_+16>>3]=v,v=+le[y+8>>3],T=w*+Ft(+v),le[_>>3]=T,v=w*+It(+v),le[_+8>>3]=v}function Co(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;if(M=Te,Te=Te+16|0,T=M,w=Rn(y,_)|0,(v+-1|0)>>>0>5||(w=(w|0)!=0,(v|0)==1&w))return T=-1,Te=M,T|0;do if(rs(y,_,T)|0)w=-1;else if(w){w=((g[21936+(v<<2)>>2]|0)+5-(g[T>>2]|0)|0)%5|0;break}else{w=((g[21968+(v<<2)>>2]|0)+6-(g[T>>2]|0)|0)%6|0;break}while(!1);return T=w,Te=M,T|0}function rs(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0;if(f=Te,Te=Te+32|0,O=f+16|0,c=f,w=el(y,_,O)|0,w|0)return v=w,Te=f,v|0;M=bh(y,_)|0,d=ts(y,_)|0,to(M,c),w=Pf(M,g[O>>2]|0)|0;e:do if(Ir(M)|0){do switch(M|0){case 4:{y=0;break}case 14:{y=1;break}case 24:{y=2;break}case 38:{y=3;break}case 49:{y=4;break}case 58:{y=5;break}case 63:{y=6;break}case 72:{y=7;break}case 83:{y=8;break}case 97:{y=9;break}case 107:{y=10;break}case 117:{y=11;break}default:{w=1;break e}}while(!1);if(T=g[22e3+(y*24|0)+8>>2]|0,_=g[22e3+(y*24|0)+16>>2]|0,y=g[O>>2]|0,(y|0)!=(g[c>>2]|0)&&(c=Dn(M)|0,y=g[O>>2]|0,c|(y|0)==(_|0)&&(w=(w+1|0)%6|0)),(d|0)==3&(y|0)==(_|0)){w=(w+5|0)%6|0,T=22;break}(d|0)==5&(y|0)==(T|0)&&(w=(w+1|0)%6|0),T=22}else T=22;while(!1);return(T|0)==22&&(g[v>>2]=w,w=0),v=w,Te=f,v|0}function Hr(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0;if(re=Te,Te=Te+32|0,$=re+24|0,W=re+20|0,F=re+8|0,L=re+16|0,P=re,d=(Rn(y,_)|0)==0,d=d?6:5,m=Kt(y|0,_|0,52)|0,Be()|0,m=m&15,d>>>0<=v>>>0)return w=2,Te=re,w|0;E=(m|0)==0,!E&&(G=tr(7,0,(m^15)*3|0)|0,(G&y|0)==0&((Be()|0)&_|0)==0)?T=v:M=4;e:do if((M|0)==4){if(T=(Rn(y,_)|0)!=0,((T?4:5)|0)<(v|0)||rs(y,_,$)|0||(M=(g[$>>2]|0)+v|0,T?T=22288+(((M|0)%5|0)<<2)|0:T=22320+(((M|0)%6|0)<<2)|0,G=g[T>>2]|0,(G|0)==7))return w=1,Te=re,w|0;g[W>>2]=0,T=Sn(y,_,G,W,F)|0;do if(!T){if(c=F,f=g[c>>2]|0,c=g[c+4>>2]|0,O=c>>>0<_>>>0|(c|0)==(_|0)&f>>>0<y>>>0,M=O?f:y,O=O?c:_,!E&&(E=tr(7,0,(m^15)*3|0)|0,(f&E|0)==0&(c&(Be()|0)|0)==0))T=v;else{if(c=(v+-1+d|0)%(d|0)|0,T=Rn(y,_)|0,(c|0)<0&&Xt(23313,23315,245,23324),d=(T|0)!=0,((d?4:5)|0)<(c|0)&&Xt(23313,23315,245,23324),rs(y,_,$)|0&&Xt(23313,23315,245,23324),T=(g[$>>2]|0)+c|0,d?T=22288+(((T|0)%5|0)<<2)|0:T=22320+(((T|0)%6|0)<<2)|0,c=g[T>>2]|0,(c|0)==7&&Xt(23313,23315,245,23324),g[L>>2]=0,T=Sn(y,_,c,L,P)|0,T|0)break;f=P,d=g[f>>2]|0,f=g[f+4>>2]|0;do if(f>>>0<O>>>0|(f|0)==(O|0)&d>>>0<M>>>0){if(Rn(d,f)|0?M=bc(d,f,y,_)|0:M=g[22384+((((g[L>>2]|0)+(g[22352+(c<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Rn(d,f)|0,(M+-1|0)>>>0>5){T=-1,M=d,O=f;break}if(T=(T|0)!=0,(M|0)==1&T){T=-1,M=d,O=f;break}do if(rs(d,f,$)|0)T=-1;else if(T){T=((g[21936+(M<<2)>>2]|0)+5-(g[$>>2]|0)|0)%5|0;break}else{T=((g[21968+(M<<2)>>2]|0)+6-(g[$>>2]|0)|0)%6|0;break}while(!1);M=d,O=f}else T=v;while(!1);c=F,f=g[c>>2]|0,c=g[c+4>>2]|0}if((M|0)==(f|0)&(O|0)==(c|0)){if(d=(Rn(f,c)|0)!=0,d?y=bc(f,c,y,_)|0:y=g[22384+((((g[W>>2]|0)+(g[22352+(G<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Rn(f,c)|0,(y+-1|0)>>>0<=5&&(te=(T|0)!=0,!((y|0)==1&te)))do if(rs(f,c,$)|0)T=-1;else if(te){T=((g[21936+(y<<2)>>2]|0)+5-(g[$>>2]|0)|0)%5|0;break}else{T=((g[21968+(y<<2)>>2]|0)+6-(g[$>>2]|0)|0)%6|0;break}while(!1);else T=-1;T=T+1|0,T=(T|0)==6|d&(T|0)==5?0:T}_=O,y=M;break e}while(!1);return w=T,Te=re,w|0}while(!1);return te=tr(T|0,0,56)|0,$=Be()|0|_&-2130706433|536870912,g[w>>2]=te|y,g[w+4>>2]=$,w=0,Te=re,w|0}function Oo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;return M=(Rn(y,_)|0)==0,w=Hr(y,_,0,v)|0,T=(w|0)==0,M?!T||(w=Hr(y,_,1,v+8|0)|0,w|0)||(w=Hr(y,_,2,v+16|0)|0,w|0)||(w=Hr(y,_,3,v+24|0)|0,w|0)||(w=Hr(y,_,4,v+32|0)|0,w)?(M=w,M|0):Hr(y,_,5,v+40|0)|0:!T||(w=Hr(y,_,1,v+8|0)|0,w|0)||(w=Hr(y,_,2,v+16|0)|0,w|0)||(w=Hr(y,_,3,v+24|0)|0,w|0)||(w=Hr(y,_,4,v+32|0)|0,w|0)?(M=w,M|0):(M=v+40|0,g[M>>2]=0,g[M+4>>2]=0,M=0,M|0)}function oo(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0,c=0,d=0;return d=Te,Te=Te+192|0,T=d,M=d+168|0,O=Kt(y|0,_|0,56)|0,Be()|0,O=O&7,c=_&-2130706433|134217728,w=el(y,c,M)|0,w|0?(c=w,Te=d,c|0):(_=Kt(y|0,_|0,52)|0,Be()|0,_=_&15,Rn(y,c)|0?Qo(M,_,O,1,T):fu(M,_,O,1,T),c=T+8|0,g[v>>2]=g[c>>2],g[v+4>>2]=g[c+4>>2],g[v+8>>2]=g[c+8>>2],g[v+12>>2]=g[c+12>>2],c=0,Te=d,c|0)}function Ji(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;return T=Te,Te=Te+16|0,v=T,!(!0&(_&2013265920|0)==536870912)||(w=_&-2130706433|134217728,!($o(y,w)|0))?(w=0,Te=T,w|0):(M=Kt(y|0,_|0,56)|0,Be()|0,M=(Hr(y,w,M&7,v)|0)==0,w=v,w=M&((g[w>>2]|0)==(y|0)?(g[w+4>>2]|0)==(_|0):0)&1,Te=T,w|0)}function Ia(y,_,v){y=y|0,_=_|0,v=v|0;var w=0;(_|0)>0?(w=lo(_,4)|0,g[y>>2]=w,w||Xt(23337,23360,40,23374)):g[y>>2]=0,g[y+4>>2]=_,g[y+8>>2]=0,g[y+12>>2]=v}function ra(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0;T=y+4|0,M=y+12|0,O=y+8|0;e:for(;;){for(v=g[T>>2]|0,_=0;;){if((_|0)>=(v|0))break e;if(w=g[y>>2]|0,c=g[w+(_<<2)>>2]|0,!c)_=_+1|0;else break}_=w+(~~(+Pt(+(+ht(10,+ +(15-(g[M>>2]|0)|0))*(+le[c>>3]+ +le[c+8>>3])))%+(v|0))>>>0<<2)|0,v=g[_>>2]|0;t:do if(v|0){if(w=c+32|0,(v|0)==(c|0))g[_>>2]=g[w>>2];else{if(v=v+32|0,_=g[v>>2]|0,!_)break;for(;(_|0)!=(c|0);)if(v=_+32|0,_=g[v>>2]|0,!_)break t;g[v>>2]=g[w>>2]}Ur(c),g[O>>2]=(g[O>>2]|0)+-1}while(!1)}Ur(g[y>>2]|0)}function ao(y){y=y|0;var _=0,v=0,w=0;for(w=g[y+4>>2]|0,v=0;;){if((v|0)>=(w|0)){_=0,v=4;break}if(_=g[(g[y>>2]|0)+(v<<2)>>2]|0,!_)v=v+1|0;else{v=4;break}}return(v|0)==4?_|0:0}function ns(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;if(v=~~(+Pt(+(+ht(10,+ +(15-(g[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(g[y+4>>2]|0))>>>0,v=(g[y>>2]|0)+(v<<2)|0,w=g[v>>2]|0,!w)return M=1,M|0;M=_+32|0;do if((w|0)!=(_|0)){if(v=g[w+32>>2]|0,!v)return M=1,M|0;for(T=v;;){if((T|0)==(_|0)){T=8;break}if(v=g[T+32>>2]|0,v)w=T,T=v;else{v=1,T=10;break}}if((T|0)==8){g[w+32>>2]=g[M>>2];break}else if((T|0)==10)return v|0}else g[v>>2]=g[M>>2];while(!1);return Ur(_),M=y+8|0,g[M>>2]=(g[M>>2]|0)+-1,M=0,M|0}function Rc(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;M=Xn(40)|0,M||Xt(23390,23360,98,23403),g[M>>2]=g[_>>2],g[M+4>>2]=g[_+4>>2],g[M+8>>2]=g[_+8>>2],g[M+12>>2]=g[_+12>>2],T=M+16|0,g[T>>2]=g[v>>2],g[T+4>>2]=g[v+4>>2],g[T+8>>2]=g[v+8>>2],g[T+12>>2]=g[v+12>>2],g[M+32>>2]=0,T=~~(+Pt(+(+ht(10,+ +(15-(g[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(g[y+4>>2]|0))>>>0,T=(g[y>>2]|0)+(T<<2)|0,w=g[T>>2]|0;do if(!w)g[T>>2]=M;else{for(;!(rl(w,_)|0&&rl(w+16|0,v)|0);)if(T=g[w+32>>2]|0,w=(T|0)==0?w:T,!(g[w+32>>2]|0)){O=10;break}if((O|0)==10){g[w+32>>2]=M;break}return Ur(M),O=w,O|0}while(!1);return O=y+8|0,g[O>>2]=(g[O>>2]|0)+1,O=M,O|0}function xr(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0;if(T=~~(+Pt(+(+ht(10,+ +(15-(g[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(g[y+4>>2]|0))>>>0,T=g[(g[y>>2]|0)+(T<<2)>>2]|0,!T)return v=0,v|0;if(!v){for(y=T;;){if(rl(y,_)|0){w=10;break}if(y=g[y+32>>2]|0,!y){y=0,w=10;break}}if((w|0)==10)return y|0}for(y=T;;){if(rl(y,_)|0&&rl(y+16|0,v)|0){w=10;break}if(y=g[y+32>>2]|0,!y){y=0,w=10;break}}return(w|0)==10?y|0:0}function ur(y,_){y=y|0,_=_|0;var v=0;if(v=~~(+Pt(+(+ht(10,+ +(15-(g[y+12>>2]|0)|0))*(+le[_>>3]+ +le[_+8>>3])))%+(g[y+4>>2]|0))>>>0,y=g[(g[y>>2]|0)+(v<<2)>>2]|0,!y)return v=0,v|0;for(;;){if(rl(y,_)|0){_=5;break}if(y=g[y+32>>2]|0,!y){y=0,_=5;break}}return(_|0)==5?y|0:0}function Eu(){return 23424}function us(y){return y=+y,+ +sa(+y)}function Ki(y){return y=+y,~~+us(y)|0}function Xn(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0,G=0,W=0,te=0,$=0,re=0,se=0,ve=0;ve=Te,Te=Te+16|0,P=ve;do if(y>>>0<245){if(f=y>>>0<11?16:y+11&-8,y=f>>>3,E=g[5857]|0,v=E>>>y,v&3|0)return _=(v&1^1)+y|0,y=23468+(_<<1<<2)|0,v=y+8|0,w=g[v>>2]|0,T=w+8|0,M=g[T>>2]|0,(M|0)==(y|0)?g[5857]=E&~(1<<_):(g[M+12>>2]=y,g[v>>2]=M),se=_<<3,g[w+4>>2]=se|3,se=w+se+4|0,g[se>>2]=g[se>>2]|1,se=T,Te=ve,se|0;if(m=g[5859]|0,f>>>0>m>>>0){if(v|0)return _=2<<y,_=v<<y&(_|0-_),_=(_&0-_)+-1|0,c=_>>>12&16,_=_>>>c,v=_>>>5&8,_=_>>>v,M=_>>>2&4,_=_>>>M,y=_>>>1&2,_=_>>>y,w=_>>>1&1,w=(v|c|M|y|w)+(_>>>w)|0,_=23468+(w<<1<<2)|0,y=_+8|0,M=g[y>>2]|0,c=M+8|0,v=g[c>>2]|0,(v|0)==(_|0)?(y=E&~(1<<w),g[5857]=y):(g[v+12>>2]=_,g[y>>2]=v,y=E),se=w<<3,O=se-f|0,g[M+4>>2]=f|3,T=M+f|0,g[T+4>>2]=O|1,g[M+se>>2]=O,m|0&&(w=g[5862]|0,_=m>>>3,v=23468+(_<<1<<2)|0,_=1<<_,y&_?(y=v+8|0,_=g[y>>2]|0):(g[5857]=y|_,_=v,y=v+8|0),g[y>>2]=w,g[_+12>>2]=w,g[w+8>>2]=_,g[w+12>>2]=v),g[5859]=O,g[5862]=T,se=c,Te=ve,se|0;if(M=g[5858]|0,M){for(v=(M&0-M)+-1|0,T=v>>>12&16,v=v>>>T,w=v>>>5&8,v=v>>>w,O=v>>>2&4,v=v>>>O,c=v>>>1&2,v=v>>>c,d=v>>>1&1,d=g[23732+((w|T|O|c|d)+(v>>>d)<<2)>>2]|0,v=d,c=d,d=(g[d+4>>2]&-8)-f|0;y=g[v+16>>2]|0,!(!y&&(y=g[v+20>>2]|0,!y));)O=(g[y+4>>2]&-8)-f|0,T=O>>>0<d>>>0,v=y,c=T?y:c,d=T?O:d;if(O=c+f|0,O>>>0>c>>>0){T=g[c+24>>2]|0,_=g[c+12>>2]|0;do if((_|0)==(c|0)){if(y=c+20|0,_=g[y>>2]|0,!_&&(y=c+16|0,_=g[y>>2]|0,!_)){v=0;break}for(;;)if(w=_+20|0,v=g[w>>2]|0,v)_=v,y=w;else if(w=_+16|0,v=g[w>>2]|0,v)_=v,y=w;else break;g[y>>2]=0,v=_}else v=g[c+8>>2]|0,g[v+12>>2]=_,g[_+8>>2]=v,v=_;while(!1);do if(T|0){if(_=g[c+28>>2]|0,y=23732+(_<<2)|0,(c|0)==(g[y>>2]|0)){if(g[y>>2]=v,!v){g[5858]=M&~(1<<_);break}}else if(se=T+16|0,g[((g[se>>2]|0)==(c|0)?se:T+20|0)>>2]=v,!v)break;g[v+24>>2]=T,_=g[c+16>>2]|0,_|0&&(g[v+16>>2]=_,g[_+24>>2]=v),_=g[c+20>>2]|0,_|0&&(g[v+20>>2]=_,g[_+24>>2]=v)}while(!1);return d>>>0<16?(se=d+f|0,g[c+4>>2]=se|3,se=c+se+4|0,g[se>>2]=g[se>>2]|1):(g[c+4>>2]=f|3,g[O+4>>2]=d|1,g[O+d>>2]=d,m|0&&(w=g[5862]|0,_=m>>>3,v=23468+(_<<1<<2)|0,_=1<<_,_&E?(y=v+8|0,_=g[y>>2]|0):(g[5857]=_|E,_=v,y=v+8|0),g[y>>2]=w,g[_+12>>2]=w,g[w+8>>2]=_,g[w+12>>2]=v),g[5859]=d,g[5862]=O),se=c+8|0,Te=ve,se|0}else E=f}else E=f}else E=f}else if(y>>>0<=4294967231)if(y=y+11|0,f=y&-8,w=g[5858]|0,w){T=0-f|0,y=y>>>8,y?f>>>0>16777215?d=31:(E=(y+1048320|0)>>>16&8,G=y<<E,c=(G+520192|0)>>>16&4,G=G<<c,d=(G+245760|0)>>>16&2,d=14-(c|E|d)+(G<<d>>>15)|0,d=f>>>(d+7|0)&1|d<<1):d=0,v=g[23732+(d<<2)>>2]|0;e:do if(!v)v=0,y=0,G=61;else for(y=0,c=f<<((d|0)==31?0:25-(d>>>1)|0),M=0;;){if(O=(g[v+4>>2]&-8)-f|0,O>>>0<T>>>0)if(O)y=v,T=O;else{y=v,T=0,G=65;break e}if(G=g[v+20>>2]|0,v=g[v+16+(c>>>31<<2)>>2]|0,M=(G|0)==0|(G|0)==(v|0)?M:G,v)c=c<<1;else{v=M,G=61;break}}while(!1);if((G|0)==61){if((v|0)==0&(y|0)==0){if(y=2<<d,y=(y|0-y)&w,!y){E=f;break}E=(y&0-y)+-1|0,O=E>>>12&16,E=E>>>O,M=E>>>5&8,E=E>>>M,c=E>>>2&4,E=E>>>c,d=E>>>1&2,E=E>>>d,v=E>>>1&1,y=0,v=g[23732+((M|O|c|d|v)+(E>>>v)<<2)>>2]|0}v?G=65:(c=y,O=T)}if((G|0)==65)for(M=v;;)if(E=(g[M+4>>2]&-8)-f|0,v=E>>>0<T>>>0,T=v?E:T,y=v?M:y,v=g[M+16>>2]|0,v||(v=g[M+20>>2]|0),v)M=v;else{c=y,O=T;break}if((c|0)!=0&&O>>>0<((g[5859]|0)-f|0)>>>0&&(m=c+f|0,m>>>0>c>>>0)){M=g[c+24>>2]|0,_=g[c+12>>2]|0;do if((_|0)==(c|0)){if(y=c+20|0,_=g[y>>2]|0,!_&&(y=c+16|0,_=g[y>>2]|0,!_)){_=0;break}for(;;)if(T=_+20|0,v=g[T>>2]|0,v)_=v,y=T;else if(T=_+16|0,v=g[T>>2]|0,v)_=v,y=T;else break;g[y>>2]=0}else se=g[c+8>>2]|0,g[se+12>>2]=_,g[_+8>>2]=se;while(!1);do if(M){if(y=g[c+28>>2]|0,v=23732+(y<<2)|0,(c|0)==(g[v>>2]|0)){if(g[v>>2]=_,!_){w=w&~(1<<y),g[5858]=w;break}}else if(se=M+16|0,g[((g[se>>2]|0)==(c|0)?se:M+20|0)>>2]=_,!_)break;g[_+24>>2]=M,y=g[c+16>>2]|0,y|0&&(g[_+16>>2]=y,g[y+24>>2]=_),y=g[c+20>>2]|0,y&&(g[_+20>>2]=y,g[y+24>>2]=_)}while(!1);e:do if(O>>>0<16)se=O+f|0,g[c+4>>2]=se|3,se=c+se+4|0,g[se>>2]=g[se>>2]|1;else{if(g[c+4>>2]=f|3,g[m+4>>2]=O|1,g[m+O>>2]=O,_=O>>>3,O>>>0<256){v=23468+(_<<1<<2)|0,y=g[5857]|0,_=1<<_,y&_?(y=v+8|0,_=g[y>>2]|0):(g[5857]=y|_,_=v,y=v+8|0),g[y>>2]=m,g[_+12>>2]=m,g[m+8>>2]=_,g[m+12>>2]=v;break}if(_=O>>>8,_?O>>>0>16777215?v=31:(re=(_+1048320|0)>>>16&8,se=_<<re,$=(se+520192|0)>>>16&4,se=se<<$,v=(se+245760|0)>>>16&2,v=14-($|re|v)+(se<<v>>>15)|0,v=O>>>(v+7|0)&1|v<<1):v=0,_=23732+(v<<2)|0,g[m+28>>2]=v,y=m+16|0,g[y+4>>2]=0,g[y>>2]=0,y=1<<v,!(w&y)){g[5858]=w|y,g[_>>2]=m,g[m+24>>2]=_,g[m+12>>2]=m,g[m+8>>2]=m;break}_=g[_>>2]|0;t:do if((g[_+4>>2]&-8|0)!=(O|0)){for(w=O<<((v|0)==31?0:25-(v>>>1)|0);v=_+16+(w>>>31<<2)|0,y=g[v>>2]|0,!!y;)if((g[y+4>>2]&-8|0)==(O|0)){_=y;break t}else w=w<<1,_=y;g[v>>2]=m,g[m+24>>2]=_,g[m+12>>2]=m,g[m+8>>2]=m;break e}while(!1);re=_+8|0,se=g[re>>2]|0,g[se+12>>2]=m,g[re>>2]=m,g[m+8>>2]=se,g[m+12>>2]=_,g[m+24>>2]=0}while(!1);return se=c+8|0,Te=ve,se|0}else E=f}else E=f;else E=-1;while(!1);if(v=g[5859]|0,v>>>0>=E>>>0)return _=v-E|0,y=g[5862]|0,_>>>0>15?(se=y+E|0,g[5862]=se,g[5859]=_,g[se+4>>2]=_|1,g[y+v>>2]=_,g[y+4>>2]=E|3):(g[5859]=0,g[5862]=0,g[y+4>>2]=v|3,se=y+v+4|0,g[se>>2]=g[se>>2]|1),se=y+8|0,Te=ve,se|0;if(O=g[5860]|0,O>>>0>E>>>0)return $=O-E|0,g[5860]=$,se=g[5863]|0,re=se+E|0,g[5863]=re,g[re+4>>2]=$|1,g[se+4>>2]=E|3,se=se+8|0,Te=ve,se|0;if(g[5975]|0?y=g[5977]|0:(g[5977]=4096,g[5976]=4096,g[5978]=-1,g[5979]=-1,g[5980]=0,g[5968]=0,g[5975]=P&-16^1431655768,y=4096),c=E+48|0,d=E+47|0,M=y+d|0,T=0-y|0,f=M&T,f>>>0<=E>>>0||(y=g[5967]|0,y|0&&(m=g[5965]|0,P=m+f|0,P>>>0<=m>>>0|P>>>0>y>>>0)))return se=0,Te=ve,se|0;e:do if(g[5968]&4)_=0,G=143;else{v=g[5863]|0;t:do if(v){for(w=23876;P=g[w>>2]|0,!(P>>>0<=v>>>0&&(P+(g[w+4>>2]|0)|0)>>>0>v>>>0);)if(y=g[w+8>>2]|0,y)w=y;else{G=128;break t}if(_=M-O&T,_>>>0<2147483647)if(y=_s(_|0)|0,(y|0)==((g[w>>2]|0)+(g[w+4>>2]|0)|0)){if((y|0)!=-1){O=_,M=y,G=145;break e}}else w=y,G=136;else _=0}else G=128;while(!1);do if((G|0)==128)if(v=_s(0)|0,(v|0)!=-1&&(_=v,L=g[5976]|0,F=L+-1|0,_=((F&_|0)==0?0:(F+_&0-L)-_|0)+f|0,L=g[5965]|0,F=_+L|0,_>>>0>E>>>0&_>>>0<2147483647)){if(P=g[5967]|0,P|0&&F>>>0<=L>>>0|F>>>0>P>>>0){_=0;break}if(y=_s(_|0)|0,(y|0)==(v|0)){O=_,M=v,G=145;break e}else w=y,G=136}else _=0;while(!1);do if((G|0)==136){if(v=0-_|0,!(c>>>0>_>>>0&(_>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){_=0;break}else{O=_,M=w,G=145;break e}if(y=g[5977]|0,y=d-_+y&0-y,y>>>0>=2147483647){O=_,M=w,G=145;break e}if((_s(y|0)|0)==-1){_s(v|0)|0,_=0;break}else{O=y+_|0,M=w,G=145;break e}}while(!1);g[5968]=g[5968]|4,G=143}while(!1);if((G|0)==143&&f>>>0<2147483647&&($=_s(f|0)|0,F=_s(0)|0,W=F-$|0,te=W>>>0>(E+40|0)>>>0,!(($|0)==-1|te^1|$>>>0<F>>>0&(($|0)!=-1&(F|0)!=-1)^1))&&(O=te?W:_,M=$,G=145),(G|0)==145){_=(g[5965]|0)+O|0,g[5965]=_,_>>>0>(g[5966]|0)>>>0&&(g[5966]=_),d=g[5863]|0;e:do if(d){for(_=23876;;){if(y=g[_>>2]|0,v=g[_+4>>2]|0,(M|0)==(y+v|0)){G=154;break}if(w=g[_+8>>2]|0,w)_=w;else break}if((G|0)==154&&(re=_+4|0,(g[_+12>>2]&8|0)==0)&&M>>>0>d>>>0&y>>>0<=d>>>0){g[re>>2]=v+O,se=(g[5860]|0)+O|0,$=d+8|0,$=($&7|0)==0?0:0-$&7,re=d+$|0,$=se-$|0,g[5863]=re,g[5860]=$,g[re+4>>2]=$|1,g[d+se+4>>2]=40,g[5864]=g[5979];break}for(M>>>0<(g[5861]|0)>>>0&&(g[5861]=M),v=M+O|0,_=23876;;){if((g[_>>2]|0)==(v|0)){G=162;break}if(y=g[_+8>>2]|0,y)_=y;else break}if((G|0)==162&&(g[_+12>>2]&8|0)==0){g[_>>2]=M,m=_+4|0,g[m>>2]=(g[m>>2]|0)+O,m=M+8|0,m=M+((m&7|0)==0?0:0-m&7)|0,_=v+8|0,_=v+((_&7|0)==0?0:0-_&7)|0,f=m+E|0,c=_-m-E|0,g[m+4>>2]=E|3;t:do if((d|0)==(_|0))se=(g[5860]|0)+c|0,g[5860]=se,g[5863]=f,g[f+4>>2]=se|1;else{if((g[5862]|0)==(_|0)){se=(g[5859]|0)+c|0,g[5859]=se,g[5862]=f,g[f+4>>2]=se|1,g[f+se>>2]=se;break}if(y=g[_+4>>2]|0,(y&3|0)==1){O=y&-8,w=y>>>3;r:do if(y>>>0<256)if(y=g[_+8>>2]|0,v=g[_+12>>2]|0,(v|0)==(y|0)){g[5857]=g[5857]&~(1<<w);break}else{g[y+12>>2]=v,g[v+8>>2]=y;break}else{M=g[_+24>>2]|0,y=g[_+12>>2]|0;do if((y|0)==(_|0)){if(v=_+16|0,w=v+4|0,y=g[w>>2]|0,y)v=w;else if(y=g[v>>2]|0,!y){y=0;break}for(;;)if(T=y+20|0,w=g[T>>2]|0,w)y=w,v=T;else if(T=y+16|0,w=g[T>>2]|0,w)y=w,v=T;else break;g[v>>2]=0}else se=g[_+8>>2]|0,g[se+12>>2]=y,g[y+8>>2]=se;while(!1);if(!M)break;v=g[_+28>>2]|0,w=23732+(v<<2)|0;do if((g[w>>2]|0)!=(_|0)){if(se=M+16|0,g[((g[se>>2]|0)==(_|0)?se:M+20|0)>>2]=y,!y)break r}else{if(g[w>>2]=y,y|0)break;g[5858]=g[5858]&~(1<<v);break r}while(!1);if(g[y+24>>2]=M,v=_+16|0,w=g[v>>2]|0,w|0&&(g[y+16>>2]=w,g[w+24>>2]=y),v=g[v+4>>2]|0,!v)break;g[y+20>>2]=v,g[v+24>>2]=y}while(!1);_=_+O|0,T=O+c|0}else T=c;if(_=_+4|0,g[_>>2]=g[_>>2]&-2,g[f+4>>2]=T|1,g[f+T>>2]=T,_=T>>>3,T>>>0<256){v=23468+(_<<1<<2)|0,y=g[5857]|0,_=1<<_,y&_?(y=v+8|0,_=g[y>>2]|0):(g[5857]=y|_,_=v,y=v+8|0),g[y>>2]=f,g[_+12>>2]=f,g[f+8>>2]=_,g[f+12>>2]=v;break}_=T>>>8;do if(!_)w=0;else{if(T>>>0>16777215){w=31;break}re=(_+1048320|0)>>>16&8,se=_<<re,$=(se+520192|0)>>>16&4,se=se<<$,w=(se+245760|0)>>>16&2,w=14-($|re|w)+(se<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1}while(!1);if(_=23732+(w<<2)|0,g[f+28>>2]=w,y=f+16|0,g[y+4>>2]=0,g[y>>2]=0,y=g[5858]|0,v=1<<w,!(y&v)){g[5858]=y|v,g[_>>2]=f,g[f+24>>2]=_,g[f+12>>2]=f,g[f+8>>2]=f;break}_=g[_>>2]|0;r:do if((g[_+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);v=_+16+(w>>>31<<2)|0,y=g[v>>2]|0,!!y;)if((g[y+4>>2]&-8|0)==(T|0)){_=y;break r}else w=w<<1,_=y;g[v>>2]=f,g[f+24>>2]=_,g[f+12>>2]=f,g[f+8>>2]=f;break t}while(!1);re=_+8|0,se=g[re>>2]|0,g[se+12>>2]=f,g[re>>2]=f,g[f+8>>2]=se,g[f+12>>2]=_,g[f+24>>2]=0}while(!1);return se=m+8|0,Te=ve,se|0}for(_=23876;y=g[_>>2]|0,!(y>>>0<=d>>>0&&(se=y+(g[_+4>>2]|0)|0,se>>>0>d>>>0));)_=g[_+8>>2]|0;T=se+-47|0,y=T+8|0,y=T+((y&7|0)==0?0:0-y&7)|0,T=d+16|0,y=y>>>0<T>>>0?d:y,_=y+8|0,v=O+-40|0,$=M+8|0,$=($&7|0)==0?0:0-$&7,re=M+$|0,$=v-$|0,g[5863]=re,g[5860]=$,g[re+4>>2]=$|1,g[M+v+4>>2]=40,g[5864]=g[5979],v=y+4|0,g[v>>2]=27,g[_>>2]=g[5969],g[_+4>>2]=g[5970],g[_+8>>2]=g[5971],g[_+12>>2]=g[5972],g[5969]=M,g[5970]=O,g[5972]=0,g[5971]=_,_=y+24|0;do re=_,_=_+4|0,g[_>>2]=7;while((re+8|0)>>>0<se>>>0);if((y|0)!=(d|0)){if(M=y-d|0,g[v>>2]=g[v>>2]&-2,g[d+4>>2]=M|1,g[y>>2]=M,_=M>>>3,M>>>0<256){v=23468+(_<<1<<2)|0,y=g[5857]|0,_=1<<_,y&_?(y=v+8|0,_=g[y>>2]|0):(g[5857]=y|_,_=v,y=v+8|0),g[y>>2]=d,g[_+12>>2]=d,g[d+8>>2]=_,g[d+12>>2]=v;break}if(_=M>>>8,_?M>>>0>16777215?w=31:(re=(_+1048320|0)>>>16&8,se=_<<re,$=(se+520192|0)>>>16&4,se=se<<$,w=(se+245760|0)>>>16&2,w=14-($|re|w)+(se<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,v=23732+(w<<2)|0,g[d+28>>2]=w,g[d+20>>2]=0,g[T>>2]=0,_=g[5858]|0,y=1<<w,!(_&y)){g[5858]=_|y,g[v>>2]=d,g[d+24>>2]=v,g[d+12>>2]=d,g[d+8>>2]=d;break}_=g[v>>2]|0;t:do if((g[_+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);v=_+16+(w>>>31<<2)|0,y=g[v>>2]|0,!!y;)if((g[y+4>>2]&-8|0)==(M|0)){_=y;break t}else w=w<<1,_=y;g[v>>2]=d,g[d+24>>2]=_,g[d+12>>2]=d,g[d+8>>2]=d;break e}while(!1);re=_+8|0,se=g[re>>2]|0,g[se+12>>2]=d,g[re>>2]=d,g[d+8>>2]=se,g[d+12>>2]=_,g[d+24>>2]=0}}else se=g[5861]|0,(se|0)==0|M>>>0<se>>>0&&(g[5861]=M),g[5969]=M,g[5970]=O,g[5972]=0,g[5866]=g[5975],g[5865]=-1,g[5870]=23468,g[5869]=23468,g[5872]=23476,g[5871]=23476,g[5874]=23484,g[5873]=23484,g[5876]=23492,g[5875]=23492,g[5878]=23500,g[5877]=23500,g[5880]=23508,g[5879]=23508,g[5882]=23516,g[5881]=23516,g[5884]=23524,g[5883]=23524,g[5886]=23532,g[5885]=23532,g[5888]=23540,g[5887]=23540,g[5890]=23548,g[5889]=23548,g[5892]=23556,g[5891]=23556,g[5894]=23564,g[5893]=23564,g[5896]=23572,g[5895]=23572,g[5898]=23580,g[5897]=23580,g[5900]=23588,g[5899]=23588,g[5902]=23596,g[5901]=23596,g[5904]=23604,g[5903]=23604,g[5906]=23612,g[5905]=23612,g[5908]=23620,g[5907]=23620,g[5910]=23628,g[5909]=23628,g[5912]=23636,g[5911]=23636,g[5914]=23644,g[5913]=23644,g[5916]=23652,g[5915]=23652,g[5918]=23660,g[5917]=23660,g[5920]=23668,g[5919]=23668,g[5922]=23676,g[5921]=23676,g[5924]=23684,g[5923]=23684,g[5926]=23692,g[5925]=23692,g[5928]=23700,g[5927]=23700,g[5930]=23708,g[5929]=23708,g[5932]=23716,g[5931]=23716,se=O+-40|0,$=M+8|0,$=($&7|0)==0?0:0-$&7,re=M+$|0,$=se-$|0,g[5863]=re,g[5860]=$,g[re+4>>2]=$|1,g[M+se+4>>2]=40,g[5864]=g[5979];while(!1);if(_=g[5860]|0,_>>>0>E>>>0)return $=_-E|0,g[5860]=$,se=g[5863]|0,re=se+E|0,g[5863]=re,g[re+4>>2]=$|1,g[se+4>>2]=E|3,se=se+8|0,Te=ve,se|0}return se=Eu()|0,g[se>>2]=12,se=0,Te=ve,se|0}function Ur(y){y=y|0;var _=0,v=0,w=0,T=0,M=0,O=0,c=0,d=0;if(y){v=y+-8|0,T=g[5861]|0,y=g[y+-4>>2]|0,_=y&-8,d=v+_|0;do if(y&1)c=v,O=v;else{if(w=g[v>>2]|0,!(y&3)||(O=v+(0-w)|0,M=w+_|0,O>>>0<T>>>0))return;if((g[5862]|0)==(O|0)){if(y=d+4|0,_=g[y>>2]|0,(_&3|0)!=3){c=O,_=M;break}g[5859]=M,g[y>>2]=_&-2,g[O+4>>2]=M|1,g[O+M>>2]=M;return}if(v=w>>>3,w>>>0<256)if(y=g[O+8>>2]|0,_=g[O+12>>2]|0,(_|0)==(y|0)){g[5857]=g[5857]&~(1<<v),c=O,_=M;break}else{g[y+12>>2]=_,g[_+8>>2]=y,c=O,_=M;break}T=g[O+24>>2]|0,y=g[O+12>>2]|0;do if((y|0)==(O|0)){if(_=O+16|0,v=_+4|0,y=g[v>>2]|0,y)_=v;else if(y=g[_>>2]|0,!y){y=0;break}for(;;)if(w=y+20|0,v=g[w>>2]|0,v)y=v,_=w;else if(w=y+16|0,v=g[w>>2]|0,v)y=v,_=w;else break;g[_>>2]=0}else c=g[O+8>>2]|0,g[c+12>>2]=y,g[y+8>>2]=c;while(!1);if(T){if(_=g[O+28>>2]|0,v=23732+(_<<2)|0,(g[v>>2]|0)==(O|0)){if(g[v>>2]=y,!y){g[5858]=g[5858]&~(1<<_),c=O,_=M;break}}else if(c=T+16|0,g[((g[c>>2]|0)==(O|0)?c:T+20|0)>>2]=y,!y){c=O,_=M;break}g[y+24>>2]=T,_=O+16|0,v=g[_>>2]|0,v|0&&(g[y+16>>2]=v,g[v+24>>2]=y),_=g[_+4>>2]|0,_?(g[y+20>>2]=_,g[_+24>>2]=y,c=O,_=M):(c=O,_=M)}else c=O,_=M}while(!1);if(!(O>>>0>=d>>>0)&&(y=d+4|0,w=g[y>>2]|0,!!(w&1))){if(w&2)g[y>>2]=w&-2,g[c+4>>2]=_|1,g[O+_>>2]=_,T=_;else{if((g[5863]|0)==(d|0)){if(d=(g[5860]|0)+_|0,g[5860]=d,g[5863]=c,g[c+4>>2]=d|1,(c|0)!=(g[5862]|0))return;g[5862]=0,g[5859]=0;return}if((g[5862]|0)==(d|0)){d=(g[5859]|0)+_|0,g[5859]=d,g[5862]=O,g[c+4>>2]=d|1,g[O+d>>2]=d;return}T=(w&-8)+_|0,v=w>>>3;do if(w>>>0<256)if(_=g[d+8>>2]|0,y=g[d+12>>2]|0,(y|0)==(_|0)){g[5857]=g[5857]&~(1<<v);break}else{g[_+12>>2]=y,g[y+8>>2]=_;break}else{M=g[d+24>>2]|0,y=g[d+12>>2]|0;do if((y|0)==(d|0)){if(_=d+16|0,v=_+4|0,y=g[v>>2]|0,y)_=v;else if(y=g[_>>2]|0,!y){v=0;break}for(;;)if(w=y+20|0,v=g[w>>2]|0,v)y=v,_=w;else if(w=y+16|0,v=g[w>>2]|0,v)y=v,_=w;else break;g[_>>2]=0,v=y}else v=g[d+8>>2]|0,g[v+12>>2]=y,g[y+8>>2]=v,v=y;while(!1);if(M|0){if(y=g[d+28>>2]|0,_=23732+(y<<2)|0,(g[_>>2]|0)==(d|0)){if(g[_>>2]=v,!v){g[5858]=g[5858]&~(1<<y);break}}else if(w=M+16|0,g[((g[w>>2]|0)==(d|0)?w:M+20|0)>>2]=v,!v)break;g[v+24>>2]=M,y=d+16|0,_=g[y>>2]|0,_|0&&(g[v+16>>2]=_,g[_+24>>2]=v),y=g[y+4>>2]|0,y|0&&(g[v+20>>2]=y,g[y+24>>2]=v)}}while(!1);if(g[c+4>>2]=T|1,g[O+T>>2]=T,(c|0)==(g[5862]|0)){g[5859]=T;return}}if(y=T>>>3,T>>>0<256){v=23468+(y<<1<<2)|0,_=g[5857]|0,y=1<<y,_&y?(_=v+8|0,y=g[_>>2]|0):(g[5857]=_|y,y=v,_=v+8|0),g[_>>2]=c,g[y+12>>2]=c,g[c+8>>2]=y,g[c+12>>2]=v;return}y=T>>>8,y?T>>>0>16777215?w=31:(O=(y+1048320|0)>>>16&8,d=y<<O,M=(d+520192|0)>>>16&4,d=d<<M,w=(d+245760|0)>>>16&2,w=14-(M|O|w)+(d<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1):w=0,y=23732+(w<<2)|0,g[c+28>>2]=w,g[c+20>>2]=0,g[c+16>>2]=0,_=g[5858]|0,v=1<<w;e:do if(!(_&v))g[5858]=_|v,g[y>>2]=c,g[c+24>>2]=y,g[c+12>>2]=c,g[c+8>>2]=c;else{y=g[y>>2]|0;t:do if((g[y+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);v=y+16+(w>>>31<<2)|0,_=g[v>>2]|0,!!_;)if((g[_+4>>2]&-8|0)==(T|0)){y=_;break t}else w=w<<1,y=_;g[v>>2]=c,g[c+24>>2]=y,g[c+12>>2]=c,g[c+8>>2]=c;break e}while(!1);O=y+8|0,d=g[O>>2]|0,g[d+12>>2]=c,g[O>>2]=c,g[c+8>>2]=d,g[c+12>>2]=y,g[c+24>>2]=0}while(!1);if(d=(g[5865]|0)+-1|0,g[5865]=d,!(d|0)){for(y=23884;y=g[y>>2]|0,y;)y=y+8|0;g[5865]=-1}}}}function lo(y,_){y=y|0,_=_|0;var v=0;return y?(v=Kr(_,y)|0,(_|y)>>>0>65535&&(v=((v>>>0)/(y>>>0)|0|0)==(_|0)?v:-1)):v=0,y=Xn(v)|0,!y||!(g[y+-4>>2]&3)||ia(y|0,0,v|0)|0,y|0}function An(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,v=y+v>>>0,mr(_+w+(v>>>0<y>>>0|0)>>>0|0),v|0|0}function Qr(y,_,v,w){return y=y|0,_=_|0,v=v|0,w=w|0,w=_-w-(v>>>0>y>>>0|0)>>>0,mr(w|0),y-v>>>0|0|0}function ki(y){return y=y|0,(y?31-(Xr(y^y-1)|0)|0:32)|0}function Bu(y,_,v,w,T){y=y|0,_=_|0,v=v|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,L=0,F=0;if(m=y,d=_,f=d,O=v,P=w,c=P,!f)return M=(T|0)!=0,c?M?(g[T>>2]=y|0,g[T+4>>2]=_&0,P=0,T=0,mr(P|0),T|0):(P=0,T=0,mr(P|0),T|0):(M&&(g[T>>2]=(m>>>0)%(O>>>0),g[T+4>>2]=0),P=0,T=(m>>>0)/(O>>>0)>>>0,mr(P|0),T|0);M=(c|0)==0;do if(O){if(!M){if(M=(Xr(c|0)|0)-(Xr(f|0)|0)|0,M>>>0<=31){E=M+1|0,c=31-M|0,_=M-31>>31,O=E,y=m>>>(E>>>0)&_|f<<c,_=f>>>(E>>>0)&_,M=0,c=m<<c;break}return T?(g[T>>2]=y|0,g[T+4>>2]=d|_&0,P=0,T=0,mr(P|0),T|0):(P=0,T=0,mr(P|0),T|0)}if(M=O-1|0,M&O|0){c=(Xr(O|0)|0)+33-(Xr(f|0)|0)|0,F=64-c|0,E=32-c|0,d=E>>31,L=c-32|0,_=L>>31,O=c,y=E-1>>31&f>>>(L>>>0)|(f<<E|m>>>(c>>>0))&_,_=_&f>>>(c>>>0),M=m<<F&d,c=(f<<F|m>>>(L>>>0))&d|m<<E&c-33>>31;break}return T|0&&(g[T>>2]=M&m,g[T+4>>2]=0),(O|0)==1?(L=d|_&0,F=y|0|0,mr(L|0),F|0):(F=ki(O|0)|0,L=f>>>(F>>>0)|0,F=f<<32-F|m>>>(F>>>0)|0,mr(L|0),F|0)}else{if(M)return T|0&&(g[T>>2]=(f>>>0)%(O>>>0),g[T+4>>2]=0),L=0,F=(f>>>0)/(O>>>0)>>>0,mr(L|0),F|0;if(!m)return T|0&&(g[T>>2]=0,g[T+4>>2]=(f>>>0)%(c>>>0)),L=0,F=(f>>>0)/(c>>>0)>>>0,mr(L|0),F|0;if(M=c-1|0,!(M&c))return T|0&&(g[T>>2]=y|0,g[T+4>>2]=M&f|_&0),L=0,F=f>>>((ki(c|0)|0)>>>0),mr(L|0),F|0;if(M=(Xr(c|0)|0)-(Xr(f|0)|0)|0,M>>>0<=30){_=M+1|0,c=31-M|0,O=_,y=f<<c|m>>>(_>>>0),_=f>>>(_>>>0),M=0,c=m<<c;break}return T?(g[T>>2]=y|0,g[T+4>>2]=d|_&0,L=0,F=0,mr(L|0),F|0):(L=0,F=0,mr(L|0),F|0)}while(!1);if(!O)f=c,d=0,c=0;else{E=v|0|0,m=P|w&0,f=An(E|0,m|0,-1,-1)|0,v=Be()|0,d=c,c=0;do w=d,d=M>>>31|d<<1,M=c|M<<1,w=y<<1|w>>>31|0,P=y>>>31|_<<1|0,Qr(f|0,v|0,w|0,P|0)|0,F=Be()|0,L=F>>31|((F|0)<0?-1:0)<<1,c=L&1,y=Qr(w|0,P|0,L&E|0,(((F|0)<0?-1:0)>>31|((F|0)<0?-1:0)<<1)&m|0)|0,_=Be()|0,O=O-1|0;while((O|0)!=0);f=d,d=0}return O=0,T|0&&(g[T>>2]=y,g[T+4>>2]=_),L=(M|0)>>>31|(f|O)<<1|(O<<1|M>>>31)&0|d,F=(M<<1|0)&-2|c,mr(L|0),F|0}function Js(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;return f=_>>31|((_|0)<0?-1:0)<<1,d=((_|0)<0?-1:0)>>31|((_|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,T=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,c=Qr(f^y|0,d^_|0,f|0,d|0)|0,O=Be()|0,y=M^f,_=T^d,Qr((Bu(c,O,Qr(M^v|0,T^w|0,M|0,T|0)|0,Be()|0,0)|0)^y|0,(Be()|0)^_|0,y|0,_|0)|0}function Sh(y,_){y=y|0,_=_|0;var v=0,w=0,T=0,M=0;return M=y&65535,T=_&65535,v=Kr(T,M)|0,w=y>>>16,y=(v>>>16)+(Kr(T,w)|0)|0,T=_>>>16,_=Kr(T,M)|0,mr((y>>>16)+(Kr(T,w)|0)+(((y&65535)+_|0)>>>16)|0),y+_<<16|v&65535|0|0}function di(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0;return T=y,M=v,v=Sh(T,M)|0,y=Be()|0,mr((Kr(_,M)|0)+(Kr(w,T)|0)+y|y&0|0),v|0|0|0}function is(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;return T=Te,Te=Te+16|0,c=T|0,O=_>>31|((_|0)<0?-1:0)<<1,M=((_|0)<0?-1:0)>>31|((_|0)<0?-1:0)<<1,f=w>>31|((w|0)<0?-1:0)<<1,d=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,y=Qr(O^y|0,M^_|0,O|0,M|0)|0,_=Be()|0,Bu(y,_,Qr(f^v|0,d^w|0,f|0,d|0)|0,Be()|0,c)|0,w=Qr(g[c>>2]^O|0,g[c+4>>2]^M|0,O|0,M|0)|0,v=Be()|0,Te=T,mr(v|0),w|0}function Eo(y,_,v,w){y=y|0,_=_|0,v=v|0,w=w|0;var T=0,M=0;return M=Te,Te=Te+16|0,T=M|0,Bu(y,_,v,w,T)|0,Te=M,mr(g[T+4>>2]|0),g[T>>2]|0|0}function Bo(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(mr(_>>v|0),y>>>v|(_&(1<<v)-1)<<32-v):(mr(((_|0)<0?-1:0)|0),_>>v-32|0)}function Kt(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(mr(_>>>v|0),y>>>v|(_&(1<<v)-1)<<32-v):(mr(0),_>>>v-32|0)}function tr(y,_,v){return y=y|0,_=_|0,v=v|0,(v|0)<32?(mr(_<<v|(y&(1<<v)-1<<32-v)>>>32-v|0),y<<v):(mr(y<<v-32|0),0)}function jl(y,_){return y=+y,_=+_,y!=y?+_:_!=_?+y:+yi(+y,+_)}function Oc(y,_){return y=+y,_=+_,y!=y?+_:_!=_?+y:+zr(+y,+_)}function na(y){return y=+y,y>=0?+Et(y+.5):+Jr(y-.5)}function Do(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0;if((v|0)>=8192)return ya(y|0,_|0,v|0)|0,y|0;if(M=y|0,T=y+v|0,(y&3)==(_&3)){for(;y&3;){if(!v)return M|0;we[y>>0]=we[_>>0]|0,y=y+1|0,_=_+1|0,v=v-1|0}for(v=T&-4|0,w=v-64|0;(y|0)<=(w|0);)g[y>>2]=g[_>>2],g[y+4>>2]=g[_+4>>2],g[y+8>>2]=g[_+8>>2],g[y+12>>2]=g[_+12>>2],g[y+16>>2]=g[_+16>>2],g[y+20>>2]=g[_+20>>2],g[y+24>>2]=g[_+24>>2],g[y+28>>2]=g[_+28>>2],g[y+32>>2]=g[_+32>>2],g[y+36>>2]=g[_+36>>2],g[y+40>>2]=g[_+40>>2],g[y+44>>2]=g[_+44>>2],g[y+48>>2]=g[_+48>>2],g[y+52>>2]=g[_+52>>2],g[y+56>>2]=g[_+56>>2],g[y+60>>2]=g[_+60>>2],y=y+64|0,_=_+64|0;for(;(y|0)<(v|0);)g[y>>2]=g[_>>2],y=y+4|0,_=_+4|0}else for(v=T-4|0;(y|0)<(v|0);)we[y>>0]=we[_>>0]|0,we[y+1>>0]=we[_+1>>0]|0,we[y+2>>0]=we[_+2>>0]|0,we[y+3>>0]=we[_+3>>0]|0,y=y+4|0,_=_+4|0;for(;(y|0)<(T|0);)we[y>>0]=we[_>>0]|0,y=y+1|0,_=_+1|0;return M|0}function ia(y,_,v){y=y|0,_=_|0,v=v|0;var w=0,T=0,M=0,O=0;if(M=y+v|0,_=_&255,(v|0)>=67){for(;y&3;)we[y>>0]=_,y=y+1|0;for(w=M&-4|0,O=_|_<<8|_<<16|_<<24,T=w-64|0;(y|0)<=(T|0);)g[y>>2]=O,g[y+4>>2]=O,g[y+8>>2]=O,g[y+12>>2]=O,g[y+16>>2]=O,g[y+20>>2]=O,g[y+24>>2]=O,g[y+28>>2]=O,g[y+32>>2]=O,g[y+36>>2]=O,g[y+40>>2]=O,g[y+44>>2]=O,g[y+48>>2]=O,g[y+52>>2]=O,g[y+56>>2]=O,g[y+60>>2]=O,y=y+64|0;for(;(y|0)<(w|0);)g[y>>2]=O,y=y+4|0}for(;(y|0)<(M|0);)we[y>>0]=_,y=y+1|0;return M-v|0}function sa(y){return y=+y,y>=0?+Et(y+.5):+Jr(y-.5)}function _s(y){y=y|0;var _=0,v=0,w=0;return w=Vi()|0,v=g[Qe>>2]|0,_=v+y|0,(y|0)>0&(_|0)<(v|0)|(_|0)<0?(Wn(_|0)|0,tn(12),-1):(_|0)>(w|0)&&!(ui(_|0)|0)?(tn(12),-1):(g[Qe>>2]=_,v|0)}return{___divdi3:Js,___muldi3:di,___remdi3:is,___uremdi3:Eo,_areNeighborCells:Ba,_bitshift64Ashr:Bo,_bitshift64Lshr:Kt,_bitshift64Shl:tr,_calloc:lo,_cellAreaKm2:kn,_cellAreaM2:Vs,_cellAreaRads2:hn,_cellToBoundary:Dl,_cellToCenterChild:aA,_cellToChildPos:mu,_cellToChildren:Fn,_cellToChildrenSize:Bc,_cellToLatLng:Ol,_cellToLocalIj:jf,_cellToParent:qo,_cellToVertex:Hr,_cellToVertexes:Oo,_cellsToDirectedEdge:Qa,_cellsToLinkedMultiPolygon:jr,_childPosToCell:cA,_compactCells:Ll,_destroyLinkedMultiPolygon:Ul,_directedEdgeToBoundary:uu,_directedEdgeToCells:Of,_edgeLengthKm:Nl,_edgeLengthM:Pc,_edgeLengthRads:Mc,_emscripten_replace_memory:Wo,_free:Ur,_getBaseCellNumber:bh,_getDirectedEdgeDestination:Ta,_getDirectedEdgeOrigin:Za,_getHexagonAreaAvgKm2:zf,_getHexagonAreaAvgM2:il,_getHexagonEdgeLengthAvgKm:Kn,_getHexagonEdgeLengthAvgM:bu,_getIcosahedronFaces:Fl,_getNumCells:Yo,_getPentagons:Tc,_getRes0Cells:Lf,_getResolution:$a,_greatCircleDistanceKm:nl,_greatCircleDistanceM:vh,_greatCircleDistanceRads:yu,_gridDisk:Ln,_gridDiskDistances:gs,_gridDistance:or,_gridPathCells:vu,_gridPathCellsSize:Ss,_gridRingUnsafe:Ae,_i64Add:An,_i64Subtract:Qr,_isPentagon:Rn,_isResClassIII:Gf,_isValidCell:$o,_isValidDirectedEdge:Rf,_isValidVertex:Ji,_latLngToCell:Ya,_llvm_maxnum_f64:jl,_llvm_minnum_f64:Oc,_llvm_round_f64:na,_localIjToCell:Ei,_malloc:Xn,_maxFaceCount:tl,_maxGridDiskSize:Mi,_maxPolygonToCellsSize:Me,_memcpy:Do,_memset:ia,_originToDirectedEdges:In,_pentagonCount:gu,_polygonToCells:vt,_readInt64AsDoubleFromPointer:Ms,_res0CellCount:xc,_round:sa,_sbrk:_s,_sizeOfCellBoundary:Eh,_sizeOfCoordIJ:Cu,_sizeOfGeoLoop:so,_sizeOfGeoPolygon:Is,_sizeOfH3Index:Ch,_sizeOfLatLng:xu,_sizeOfLinkedGeoPolygon:wu,_uncompactCells:Uf,_uncompactCellsSize:lA,_vertexToLatLng:oo,establishStackSpace:hi,stackAlloc:Jn,stackRestore:Fi,stackSave:Jo}})(ge,Gt,De);e.___divdi3=wt.___divdi3,e.___muldi3=wt.___muldi3,e.___remdi3=wt.___remdi3,e.___uremdi3=wt.___uremdi3,e._areNeighborCells=wt._areNeighborCells,e._bitshift64Ashr=wt._bitshift64Ashr,e._bitshift64Lshr=wt._bitshift64Lshr,e._bitshift64Shl=wt._bitshift64Shl,e._calloc=wt._calloc,e._cellAreaKm2=wt._cellAreaKm2,e._cellAreaM2=wt._cellAreaM2,e._cellAreaRads2=wt._cellAreaRads2,e._cellToBoundary=wt._cellToBoundary,e._cellToCenterChild=wt._cellToCenterChild,e._cellToChildPos=wt._cellToChildPos,e._cellToChildren=wt._cellToChildren,e._cellToChildrenSize=wt._cellToChildrenSize,e._cellToLatLng=wt._cellToLatLng,e._cellToLocalIj=wt._cellToLocalIj,e._cellToParent=wt._cellToParent,e._cellToVertex=wt._cellToVertex,e._cellToVertexes=wt._cellToVertexes,e._cellsToDirectedEdge=wt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=wt._cellsToLinkedMultiPolygon,e._childPosToCell=wt._childPosToCell,e._compactCells=wt._compactCells,e._destroyLinkedMultiPolygon=wt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=wt._directedEdgeToBoundary,e._directedEdgeToCells=wt._directedEdgeToCells,e._edgeLengthKm=wt._edgeLengthKm,e._edgeLengthM=wt._edgeLengthM,e._edgeLengthRads=wt._edgeLengthRads;var H=e._emscripten_replace_memory=wt._emscripten_replace_memory;e._free=wt._free,e._getBaseCellNumber=wt._getBaseCellNumber,e._getDirectedEdgeDestination=wt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=wt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=wt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=wt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=wt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=wt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=wt._getIcosahedronFaces,e._getNumCells=wt._getNumCells,e._getPentagons=wt._getPentagons,e._getRes0Cells=wt._getRes0Cells,e._getResolution=wt._getResolution,e._greatCircleDistanceKm=wt._greatCircleDistanceKm,e._greatCircleDistanceM=wt._greatCircleDistanceM,e._greatCircleDistanceRads=wt._greatCircleDistanceRads,e._gridDisk=wt._gridDisk,e._gridDiskDistances=wt._gridDiskDistances,e._gridDistance=wt._gridDistance,e._gridPathCells=wt._gridPathCells,e._gridPathCellsSize=wt._gridPathCellsSize,e._gridRingUnsafe=wt._gridRingUnsafe,e._i64Add=wt._i64Add,e._i64Subtract=wt._i64Subtract,e._isPentagon=wt._isPentagon,e._isResClassIII=wt._isResClassIII,e._isValidCell=wt._isValidCell,e._isValidDirectedEdge=wt._isValidDirectedEdge,e._isValidVertex=wt._isValidVertex,e._latLngToCell=wt._latLngToCell,e._llvm_maxnum_f64=wt._llvm_maxnum_f64,e._llvm_minnum_f64=wt._llvm_minnum_f64,e._llvm_round_f64=wt._llvm_round_f64,e._localIjToCell=wt._localIjToCell,e._malloc=wt._malloc,e._maxFaceCount=wt._maxFaceCount,e._maxGridDiskSize=wt._maxGridDiskSize,e._maxPolygonToCellsSize=wt._maxPolygonToCellsSize,e._memcpy=wt._memcpy,e._memset=wt._memset,e._originToDirectedEdges=wt._originToDirectedEdges,e._pentagonCount=wt._pentagonCount,e._polygonToCells=wt._polygonToCells,e._readInt64AsDoubleFromPointer=wt._readInt64AsDoubleFromPointer,e._res0CellCount=wt._res0CellCount,e._round=wt._round,e._sbrk=wt._sbrk,e._sizeOfCellBoundary=wt._sizeOfCellBoundary,e._sizeOfCoordIJ=wt._sizeOfCoordIJ,e._sizeOfGeoLoop=wt._sizeOfGeoLoop,e._sizeOfGeoPolygon=wt._sizeOfGeoPolygon,e._sizeOfH3Index=wt._sizeOfH3Index,e._sizeOfLatLng=wt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=wt._sizeOfLinkedGeoPolygon,e._uncompactCells=wt._uncompactCells,e._uncompactCellsSize=wt._uncompactCellsSize,e._vertexToLatLng=wt._vertexToLatLng,e.establishStackSpace=wt.establishStackSpace;var yt=e.stackAlloc=wt.stackAlloc,Bt=e.stackRestore=wt.stackRestore,xe=e.stackSave=wt.stackSave;if(e.asm=wt,e.cwrap=Q,e.setValue=D,e.getValue=N,mn){Vn(mn)||(mn=o(mn));{ci();var Ke=function(fe){fe.byteLength&&(fe=new Uint8Array(fe)),ue.set(fe,S),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,qn()},lt=function(){s(mn,Ke,function(){throw"could not load memory initializer "+mn})},Z=Lt(mn);if(Z)Ke(Z.buffer);else if(e.memoryInitializerRequest){var ne=function(){var fe=e.memoryInitializerRequest,be=fe.response;if(fe.status!==200&&fe.status!==0){var oe=Lt(e.memoryInitializerRequestURL);if(oe)be=oe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+fe.status+", retrying "+mn),lt();return}}Ke(be)};e.memoryInitializerRequest.response?setTimeout(ne,0):e.memoryInitializerRequest.addEventListener("load",ne)}else lt()}}var ae;Rr=function fe(){ae||ye(),ae||(Rr=fe)};function ye(fe){if(un>0||(Qt(),un>0))return;function be(){ae||(ae=!0,!U&&(Zt(),Ht(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),dr()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),be()},1)):be()}e.run=ye;function Oe(fe){throw e.onAbort&&e.onAbort(fe),fe+="",l(fe),h(fe),U=!0,"abort("+fe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Oe,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ye(),t})(typeof kr=="object"?kr:{}),_n="number",an=_n,HA=_n,dn=_n,pn=_n,Ao=_n,Pr=_n,Sde=[["sizeOfH3Index",_n],["sizeOfLatLng",_n],["sizeOfCellBoundary",_n],["sizeOfGeoLoop",_n],["sizeOfGeoPolygon",_n],["sizeOfLinkedGeoPolygon",_n],["sizeOfCoordIJ",_n],["readInt64AsDoubleFromPointer",_n],["isValidCell",HA,[dn,pn]],["latLngToCell",an,[_n,_n,Ao,Pr]],["cellToLatLng",an,[dn,pn,Pr]],["cellToBoundary",an,[dn,pn,Pr]],["maxGridDiskSize",an,[_n,Pr]],["gridDisk",an,[dn,pn,_n,Pr]],["gridDiskDistances",an,[dn,pn,_n,Pr,Pr]],["gridRingUnsafe",an,[dn,pn,_n,Pr]],["maxPolygonToCellsSize",an,[Pr,Ao,_n,Pr]],["polygonToCells",an,[Pr,Ao,_n,Pr]],["cellsToLinkedMultiPolygon",an,[Pr,_n,Pr]],["destroyLinkedMultiPolygon",null,[Pr]],["compactCells",an,[Pr,Pr,_n,_n]],["uncompactCells",an,[Pr,_n,_n,Pr,_n,Ao]],["uncompactCellsSize",an,[Pr,_n,_n,Ao,Pr]],["isPentagon",HA,[dn,pn]],["isResClassIII",HA,[dn,pn]],["getBaseCellNumber",_n,[dn,pn]],["getResolution",_n,[dn,pn]],["maxFaceCount",an,[dn,pn,Pr]],["getIcosahedronFaces",an,[dn,pn,Pr]],["cellToParent",an,[dn,pn,Ao,Pr]],["cellToChildren",an,[dn,pn,Ao,Pr]],["cellToCenterChild",an,[dn,pn,Ao,Pr]],["cellToChildrenSize",an,[dn,pn,Ao,Pr]],["cellToChildPos",an,[dn,pn,Ao,Pr]],["childPosToCell",an,[_n,_n,dn,pn,Ao,Pr]],["areNeighborCells",an,[dn,pn,dn,pn,Pr]],["cellsToDirectedEdge",an,[dn,pn,dn,pn,Pr]],["getDirectedEdgeOrigin",an,[dn,pn,Pr]],["getDirectedEdgeDestination",an,[dn,pn,Pr]],["isValidDirectedEdge",HA,[dn,pn]],["directedEdgeToCells",an,[dn,pn,Pr]],["originToDirectedEdges",an,[dn,pn,Pr]],["directedEdgeToBoundary",an,[dn,pn,Pr]],["gridDistance",an,[dn,pn,dn,pn,Pr]],["gridPathCells",an,[dn,pn,dn,pn,Pr]],["gridPathCellsSize",an,[dn,pn,dn,pn,Pr]],["cellToLocalIj",an,[dn,pn,dn,pn,_n,Pr]],["localIjToCell",an,[dn,pn,Pr,_n,Pr]],["getHexagonAreaAvgM2",an,[Ao,Pr]],["getHexagonAreaAvgKm2",an,[Ao,Pr]],["getHexagonEdgeLengthAvgM",an,[Ao,Pr]],["getHexagonEdgeLengthAvgKm",an,[Ao,Pr]],["greatCircleDistanceM",_n,[Pr,Pr]],["greatCircleDistanceKm",_n,[Pr,Pr]],["greatCircleDistanceRads",_n,[Pr,Pr]],["cellAreaM2",an,[dn,pn,Pr]],["cellAreaKm2",an,[dn,pn,Pr]],["cellAreaRads2",an,[dn,pn,Pr]],["edgeLengthM",an,[dn,pn,Pr]],["edgeLengthKm",an,[dn,pn,Pr]],["edgeLengthRads",an,[dn,pn,Pr]],["getNumCells",an,[Ao,Pr]],["getRes0Cells",an,[Pr]],["res0CellCount",_n],["getPentagons",an,[_n,Pr]],["pentagonCount",_n],["cellToVertex",an,[dn,pn,_n,Pr]],["cellToVertexes",an,[dn,pn,Pr]],["vertexToLatLng",an,[dn,pn,Pr]],["isValidVertex",HA,[dn,pn]]],Ide=0,Mde=1,Pde=2,Lde=3,X8=4,Rde=5,Ode=6,Dde=7,Fde=8,kde=9,Nde=10,Ude=11,Gde=12,zde=13,jde=14,Hde=15,$s={};$s[Ide]="Success",$s[Mde]="The operation failed but a more specific error is not available",$s[Pde]="Argument was outside of acceptable range",$s[Lde]="Latitude or longitude arguments were outside of acceptable range",$s[X8]="Resolution argument was outside of acceptable range",$s[Rde]="Cell argument was not valid",$s[Ode]="Directed edge argument was not valid",$s[Dde]="Undirected edge argument was not valid",$s[Fde]="Vertex argument was not valid",$s[kde]="Pentagon distortion was encountered",$s[Nde]="Duplicate input",$s[Ude]="Cell arguments were not neighbors",$s[Gde]="Cell arguments had incompatible resolutions",$s[zde]="Memory allocation failed",$s[jde]="Bounds of provided memory were insufficient",$s[Hde]="Mode or flags argument was not valid";var $C=1e3,Q8=1001,Z8=1002,Y0={};Y0[$C]="Unknown unit",Y0[Q8]="Array length out of bounds",Y0[Z8]="Got unexpected null value for H3 index";var Vde="Unknown error";function $8(t,e,r){var n=r&&"value"in r,i=new Error((t[e]||Vde)+" (code: "+e+(n?", value: "+r.value:"")+")");return i.code=e,i}function q8(t,e){var r=arguments.length===2?{value:e}:{};return $8($s,t,r)}function Wy(t,e){var r=arguments.length===2?{value:e}:{};return $8(Y0,t,r)}function vo(t){if(t!==0)throw q8(t)}var li={};Sde.forEach(function(t){li[t[0]]=kr.cwrap.apply(kr,t)});var mp=16,Vp=4,e4=4,gc=8,qC=8,ah=li.sizeOfH3Index(),YC=li.sizeOfLatLng(),Wde=li.sizeOfCellBoundary(),Jde=li.sizeOfGeoPolygon(),bg=li.sizeOfGeoLoop(),Kde=li.sizeOfLinkedGeoPolygon();li.sizeOfCoordIJ();var Sp={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function Y8(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw q8(X8,t);return t}function ek(t){if(!t)throw Wy(Z8);return t}var Xde=Math.pow(2,32)-1;function tk(t){if(t>Xde)throw Wy(Q8,t);return t}var Qde=/[^0-9a-fA-F]/;function Il(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||Qde.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),mp),r=parseInt(t.substring(t.length-8),mp);return[r,e]}function t4(t){if(t>=0)return t.toString(mp);t=t&2147483647;var e=rk(8,t.toString(mp)),r=(parseInt(e[0],mp)+8).toString(mp);return e=r+e.substring(1),e}function Zde(t,e){return t4(e)+rk(8,t4(t))}function rk(t,e){for(var r=t-e.length,n="",i=0;i<r;i++)n+="0";return n=n+e,n}function r4(t,e,r){for(var n=t.length,i=kr._calloc(n,YC),o=r?1:0,s=r?0:1,l=0;l<n*2;l+=2)kr.HEAPF64.set([t[l/2][o],t[l/2][s]].map(ak),i/gc+l);return kr.HEAPU32.set([n,i],e/Vp),e}function $de(t,e){var r=t.length-1,n=kr._calloc(Jde),i=0,o=i+bg,s=o+Vp;r4(t[0],n+i,e);var l;if(r>0){l=kr._calloc(r,bg);for(var h=0;h<r;h++)r4(t[h+1],l+bg*h,e)}return kr.setValue(n+o,r,"i32"),kr.setValue(n+s,l,"i32"),n}function qde(t){var e=0,r=e+bg,n=r+Vp,i=Vp;kr._free(kr.getValue(t+e+i,"i8*"));var o=kr.getValue(t+r,"i32");if(o>0){for(var s=kr.getValue(t+n,"i32"),l=0;l<o;l++)kr._free(kr.getValue(s+bg*l+i,"i8*"));kr._free(s)}kr._free(t)}function eE(t,e){e===void 0&&(e=0);var r=kr.getValue(t+ah*e,"i32"),n=kr.getValue(t+ah*e+Vp,"i32");return n?Zde(r,n):null}function nk(t,e){return e===void 0&&(e=0),kr.getValue(t+gc*e,"double")}function tE(t){return li.readInt64AsDoubleFromPointer(t)}function Yde(t,e,r){kr.HEAPU32.set(Il(t),e/Vp+2*r)}function rE(t,e){for(var r=[],n=0;n<e;n++){var i=eE(t,n);i!==null&&r.push(i)}return r}function epe(t,e){for(var r=e.length,n=0;n<r;n++)Yde(e[n],t,n)}function ey(t){return fpe(kr.getValue(t,"double"))}function ik(t){return[ey(t),ey(t+gc)]}function sk(t){return[ey(t+gc),ey(t)]}function tpe(t,e,r){for(var n=kr.getValue(t,"i32"),i=t+gc,o=[],s=e?sk:ik,l=0;l<n*2;l+=2)o.push(s(i+gc*l));return r&&o.push(o[0]),o}function rpe(t,e){for(var r=[],n=sk,i,o,s,l;t;){for(r.push(i=[]),o=kr.getValue(t,"i8*");o;){for(i.push(s=[]),l=kr.getValue(o,"i8*");l;)s.push(n(l)),l=kr.getValue(l+gc*2,"i8*");s.push(s[0]),o=kr.getValue(o+e4*2,"i8*")}t=kr.getValue(t+e4*2,"i8*")}return r}function npe(t){var e=Il(t),r=e[0],n=e[1];return!!li.isPentagon(r,n)}function ty(t){var e=Il(t),r=e[0],n=e[1];return li.isValidCell(r,n)?li.getResolution(r,n):-1}function nE(t,e,r){var n=kr._malloc(YC);kr.HEAPF64.set([t,e].map(ak),n/gc);var i=kr._malloc(ah);try{return vo(li.latLngToCell(n,r,i)),ek(eE(i))}finally{kr._free(i),kr._free(n)}}function iE(t){var e=kr._malloc(YC),r=Il(t),n=r[0],i=r[1];try{return vo(li.cellToLatLng(n,i,e)),ik(e)}finally{kr._free(e)}}function ok(t,e){var r=kr._malloc(Wde),n=Il(t),i=n[0],o=n[1];try{return vo(li.cellToBoundary(i,o,r)),tpe(r,e,e)}finally{kr._free(r)}}function ipe(t,e){var r=Il(t),n=r[0],i=r[1],o=kr._malloc(ah);try{return vo(li.cellToParent(n,i,e,o)),ek(eE(o))}finally{kr._free(o)}}function spe(t,e){var r=Il(t),n=r[0],i=r[1],o=kr._malloc(qC);try{vo(li.maxGridDiskSize(e,o));var s=tk(tE(o)),l=kr._calloc(s,ah);try{return vo(li.gridDisk(n,i,e,l)),rE(l,s)}finally{kr._free(l)}}finally{kr._free(o)}}function ope(t,e,r){if(Y8(e),r=!!r,t.length===0||t[0].length===0)return[];var n=typeof t[0][0]=="number"?[t]:t,i=$de(n,r),o=kr._malloc(qC);try{vo(li.maxPolygonToCellsSize(i,e,0,o));var s=tk(tE(o)),l=kr._calloc(s,ah);try{return vo(li.polygonToCells(i,e,0,l)),rE(l,s)}finally{kr._free(l)}}finally{kr._free(o),qde(i)}}function ape(t,e){if(!t||!t.length)return[];var r=t.length,n=kr._calloc(r,ah);epe(n,t);var i=kr._calloc(Kde);try{return vo(li.cellsToLinkedMultiPolygon(n,r,i)),rpe(i,e)}finally{li.destroyLinkedMultiPolygon(i),kr._free(i),kr._free(n)}}function lpe(t){var e=Il(t),r=e[0],n=e[1],i=6,o=kr._calloc(i,ah);try{return vo(li.originToDirectedEdges(r,n,o)),rE(o,i)}finally{kr._free(o)}}function cpe(t,e){var r=Il(t),n=r[0],i=r[1],o=Il(e),s=o[0],l=o[1],h=kr._malloc(qC);try{return vo(li.gridDistance(n,i,s,l,h)),tE(h)}finally{kr._free(h)}}function upe(t,e){var r=Il(t),n=r[0],i=r[1],o=kr._malloc(gc);try{switch(e){case Sp.m:vo(li.edgeLengthM(n,i,o));break;case Sp.km:vo(li.edgeLengthKm(n,i,o));break;case Sp.rads:vo(li.edgeLengthRads(n,i,o));break;default:throw Wy($C,e)}return nk(o)}finally{kr._free(o)}}function hpe(t,e){Y8(t);var r=kr._malloc(gc);try{switch(e){case Sp.m:vo(li.getHexagonEdgeLengthAvgM(t,r));break;case Sp.km:vo(li.getHexagonEdgeLengthAvgKm(t,r));break;default:throw Wy($C,e)}return nk(r)}finally{kr._free(r)}}function ak(t){return t*Math.PI/180}function fpe(t){return t*180/Math.PI}function sE(t,e){e=e===void 0?t[0][0]:e;for(const r of t){const n=r[0]-e;n>180?r[0]-=360:n<-180&&(r[0]+=360)}}function dpe(t,e,r){const[n,i]=iE(t),o=e.length;sE(e,i);const s=e[0]===e[o-1]?o-1:o;for(let l=0;l<s;l++)e[l][0]=El(i,e[l][0],r),e[l][1]=El(n,e[l][1],r)}function ppe(t,e,r){const n=t(e,r),[i,o]=iE(n);return[o,i]}function n4(t,e=1){const r=ok(t,!0);return e!==1?dpe(t,r,e):sE(r),r}function Ape(t){const e=new Float64Array(t.length*2);let r=0;for(const n of t)e[r++]=n[0],e[r++]=n[1];return e}const gpe=10;function mpe(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}const _pe={...sh.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class fc extends Bs{initializeState(){fc._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,n=!1;const{iterable:i,objectInfo:o}=yc(this.props.data);for(const s of i){o.index++;const l=this.props.getHexagon(s,o),h=ty(l);if(e<0){if(e=h,!this.props.highPrecision)break}else if(e!==h){n=!0;break}if(npe(l)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?hpe(e,"km"):0,hasMultipleRes:n,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:r,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return!!i?.resolution||n||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:r,edgeLengthKM:n,centerHex:i}=this.state;if(r<0)return;const o=this.props.centerHexagon||nE(e.latitude,e.longitude,r);if(i===o)return;if(i)try{if(cpe(i,o)*n<gpe)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let l=n4(o);const[h,A]=iE(o),[b,C]=e.projectFlat([A,h]);l=l.map(S=>{const D=e.projectFlat(S);return[(D[0]-b)/s[0],(D[1]-C)/s[1]]}),this.setState({centerHex:o,vertices:l})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:r,coverage:n,extruded:i,wireframe:o,stroked:s,filled:l,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:b,lineWidthMaxPixels:C,getFillColor:S,getElevation:D,getLineColor:N,getLineWidth:U,transitions:V,updateTriggers:j}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:o,stroked:s,filled:l,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:b,lineWidthMaxPixels:C,material:r,getElevation:D,getFillColor:S,getLineColor:N,getLineWidth:U,transitions:V,updateTriggers:{getFillColor:j.getFillColor,getElevation:j.getElevation,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:r,updateTriggers:n,coverage:i}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",sh),s=this._getForwardProps();return s.updateTriggers.getPolygon=mpe(n.getHexagon,i),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(l,h)=>{const A=r(l,h);return Ape(n4(A,i))}})}_renderColumnLayer(){const{data:e,getHexagon:r,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Ac),o=this._getForwardProps();return o.updateTriggers.getPosition=n.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:ppe.bind(null,r)})}}fc.defaultProps=_pe,fc.layerName="H3HexagonLayer",fc._checkH3Lib=()=>{};const ype={getHexagons:{type:"accessor",value:t=>t.hexagons}};class ry extends oh{initializeState(){fc._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){const{data:n,getHexagons:i}=e,o=[],{iterable:s,objectInfo:l}=yc(n);for(const h of s){l.index++;const A=i(h,l),b=ape(A,!0);for(const C of b){for(const S of C)sE(S);o.push(this.getSubLayerRow({polygon:C},h,l.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:r,getLineColor:n,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(i)}}}ry.layerName="H3ClusterLayer",ry.defaultProps=ype;const v1=Math.PI/180,b0=new Float32Array(16),i4=new Float32Array(12);function s4(t,e,r){const n=e[0]*v1,i=e[1]*v1,o=e[2]*v1,s=Math.sin(o),l=Math.sin(n),h=Math.sin(i),A=Math.cos(o),b=Math.cos(n),C=Math.cos(i),S=r[0],D=r[1],N=r[2];t[0]=S*C*b,t[1]=S*h*b,t[2]=S*-l,t[3]=D*(-h*A+C*l*s),t[4]=D*(C*A+h*l*s),t[5]=D*b*s,t[6]=N*(h*s+C*l*A),t[7]=N*(-C*s+h*l*A),t[8]=N*b*A}function o4(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const lk={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:n,getOrientation:i,getScale:o,getTranslation:s,getTransformMatrix:l}=this.props,h=Array.isArray(l),A=h&&l.length===16,b=Array.isArray(o),C=Array.isArray(i),S=Array.isArray(s),D=A||!h&&!!l(n[0]);D?t.constant=A:t.constant=C&&b&&S;const N=t.value;if(t.constant){let U;D?(b0.set(l),U=o4(b0)):(U=i4,s4(U,i,o),U.set(s,9)),t.value=new Float32Array(U)}else{let U=e*t.size;const{iterable:V,objectInfo:j}=yc(n,e,r);for(const ee of V){j.index++;let Q;if(D)b0.set(A?l:l(ee,j)),Q=o4(b0);else{Q=i4;const X=C?i:i(ee,j),pe=b?o:o(ee,j);s4(Q,X,pe),Q.set(S?s:s(ee,j),9)}N[U++]=Q[0],N[U++]=Q[1],N[U++]=Q[2],N[U++]=Q[3],N[U++]=Q[4],N[U++]=Q[5],N[U++]=Q[6],N[U++]=Q[7],N[U++]=Q[8],N[U++]=Q[9],N[U++]=Q[10],N[U++]=Q[11]}}}};function ck(t,e){return e===Yr.CARTESIAN||e===Yr.METER_OFFSETS||e===Yr.DEFAULT&&!t.isGeospatial}const a4=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,bpe={name:"simpleMesh",vs:a4,fs:a4,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},vpe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xpe=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function wpe(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function uk(t){let e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const l=t.POSITION?t.POSITION.value:[],h=l&&l.length;for(let A=0;A<h;A+=3){const b=l[A],C=l[A+1],S=l[A+2];e=b<e?b:e,r=C<r?C:r,n=S<n?S:n,i=b>i?b:i,o=C>o?C:o,s=S>s?S:s}return[[e,r,n],[i,o,s]]}function Cpe(t,e,r){const n=wpe(e.value),i=r||Epe(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Epe(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}function x1(t){const e=t.positions||t.POSITION;$r.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let n=t.COLOR_0||t.colors;n||(n={size:3,value:new Float32Array(r*3).fill(1)});let i=t.NORMAL||t.normals;i||(i={size:3,value:new Float32Array(r*3).fill(0)});let o=t.TEXCOORD_0||t.texCoords;return o||(o={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:o}}function l4(t){return t instanceof eo?(t.attributes=x1(t.attributes),t):t.attributes?new eo({...t,topology:"triangle-list",attributes:x1(t.attributes)}):new eo({topology:"triangle-list",attributes:x1(t)})}const Bpe=[0,0,0,255],Tpe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Bpe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class mf extends Es{getShaders(){return super.getShaders({vs:vpe,fs:xpe,modules:[Fs,iC,_a,bpe]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){const{attributes:n}=l4(r);n.POSITION=n.POSITION||n.positions,e=uk(n)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:lk}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e;if(r.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const o=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==n.texture&&r.texture instanceof oi&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:l}=this.props,h={sizeScale:o,composeModelMatrix:!l||ck(n,s),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:h}),r.draw(i)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const r=new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:l4(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,o={sampler:n||i,hasTexture:!!n};return r.shaderInputs.setProps({simpleMesh:o}),r}setTexture(e){const{emptyTexture:r,model:n}=this.state;if(n){const i={sampler:e||r,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}mf.defaultProps=Tpe,mf.layerName="SimpleMeshLayer";var bl;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(bl||(bl={}));function hk(t,e,r,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:o}=n;return o&&(i.bindings.pbr_diffuseEnvSampler=o.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=o.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=o.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(i.defines.HAS_NORMALS=1),r.TANGENT&&n?.useTangents&&(i.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(i.defines.HAS_UV=1),n?.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n?.lights&&(i.defines.USE_LIGHTS=1),e&&Spe(t,e,i),i}function Spe(t,e,r){if(r.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&Ipe(t,e.pbrMetallicRoughness,r),e.normalTexture){vg(t,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);const{scale:n=1}=e.normalTexture;r.uniforms.normalScale=n}if(e.occlusionTexture){vg(t,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);const{strength:n=1}=e.occlusionTexture;r.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(vg(t,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=n;break;case"BLEND":Yt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=bl.FUNC_ADD,r.glParameters.blendFunc=[bl.SRC_ALPHA,bl.ONE_MINUS_SRC_ALPHA,bl.ONE,bl.ONE_MINUS_SRC_ALPHA];break}}function Ipe(t,e,r){e.baseColorTexture&&vg(t,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&vg(t,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:n=1,roughnessFactor:i=1}=e;r.uniforms.metallicRoughnessValues=[n,i]}function vg(t,e,r,n=null,i){const o=e?.texture?.sampler?.parameters||{},s=e.texture.source.image;let l,h={};s.compressed?(l=s,h={[bl.TEXTURE_MIN_FILTER]:s.data.length>1?bl.LINEAR_MIPMAP_NEAREST:bl.LINEAR}):l={data:s};const A=t.createTexture({id:e.uniformName||e.id,parameters:{...o,...h},pixelStore:{[bl.UNPACK_FLIP_Y_WEBGL]:!1},...l});i.bindings[r]=A,n&&(i.defines[n]=1),i.generatedTextures.push(A)}const Mpe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ppe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Lpe{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:i,path:o})=>{Upe(r,n,i,o),Dpe(i,i._node)})}}class Rpe{animations;constructor(e){this.animations=e.animations.map((r,n)=>{const i=r.name||`Animation-${n}`,o=r.samplers.map(({input:l,interpolation:h="LINEAR",output:A})=>({input:c4(e.accessors[l]),interpolation:h,output:c4(e.accessors[A])})),s=r.channels.map(({sampler:l,target:h})=>({sampler:o[l],target:e.nodes[h.node],path:h.path}));return new Lpe({name:i,channels:s})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}}function c4(t){if(!t._animation){const e=Ppe[t.componentType],r=Mpe[t.type],n=r*t.count,{buffer:i,byteOffset:o}=t.bufferView.data,s=new e(i,o+(t.byteOffset||0),n);if(r===1)t._animation=Array.from(s);else{const l=[];for(let h=0;h<s.length;h+=r)l.push(Array.from(s.slice(h,h+r)));t._animation=l}}return t._animation}const Ope=new bn;function Dpe(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const r=Ope.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}const w1=new Eg;function Fpe(t,e,r,n,i){if(e==="rotation"){w1.slerp({start:r,target:n,ratio:i});for(let o=0;o<w1.length;o++)t[e][o]=w1[o]}else for(let o=0;o<r.length;o++)t[e][o]=i*n[o]+(1-i)*r[o]}function kpe(t,e,{p0:r,outTangent0:n,inTangent1:i,p1:o,tDiff:s,ratio:l}){for(let h=0;h<t[e].length;h++){const A=n[h]*s,b=i[h]*s;t[e][h]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*r[h]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*A+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[h]+(Math.pow(l,3)-Math.pow(l,2))*b}}function Npe(t,e,r){for(let n=0;n<r.length;n++)t[e][n]=r[n]}function Upe(t,{input:e,interpolation:r,output:n},i,o){const s=e[e.length-1],l=t%s,h=e.findIndex(S=>S>=l),A=Math.max(0,h-1);if(!Array.isArray(i[o]))switch(o){case"translation":i[o]=[0,0,0];break;case"rotation":i[o]=[0,0,0,1];break;case"scale":i[o]=[1,1,1];break;default:Yt.warn(`Bad animation path ${o}`)()}const b=e[A],C=e[h];switch(r){case"STEP":Npe(i,o,n[A]);break;case"LINEAR":if(C>b){const S=(l-b)/(C-b);Fpe(i,o,n[A],n[h],S)}break;case"CUBICSPLINE":if(C>b){const S=(l-b)/(C-b),D=C-b,N=n[3*A+1],U=n[3*A+2],V=n[3*h+0],j=n[3*h+1];kpe(i,o,{p0:N,outTangent0:U,inTangent1:V,p1:j,tDiff:D,ratio:S})}break;default:Yt.warn(`Interpolation ${r} not supported`)();break}}const Gpe=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,zpe=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,jpe=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function Hpe(t,e){const{id:r,geometry:n,material:i,vertexCount:o,materialOptions:s,modelOptions:l}=e,h=hk(t,i,n.attributes,s);Yt.info(4,"createGLTFModel defines: ",h.defines)();const A=[],b={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},C={id:r,source:Gpe,vs:zpe,fs:jpe,geometry:n,topology:n.topology,vertexCount:o,modules:[sC],...l,defines:{...h.defines,...l.defines},parameters:{...b,...h.parameters,...l.parameters}},S=new Di(t,C),{camera:D,...N}={...h.uniforms,...l.uniforms,...h.bindings,...l.bindings};return S.shaderInputs.setProps({pbrMaterial:N,pbrProjection:{camera:D}}),new N2({managedResources:A,model:S})}var Xh;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Xh||(Xh={}));function Vpe(t){switch(t){case Xh.POINTS:return"point-list";case Xh.LINES:return"line-list";case Xh.LINE_STRIP:return"line-strip";case Xh.TRIANGLES:return"triangle-list";case Xh.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(t))}}const Wpe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Jpe{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...Wpe,...r}}instantiate(e){return this.gltf=Dx(e),(this.gltf.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new Rpe(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(n=>this.createNode(n));return new vp({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const n=(e.children||[]).map(o=>this.createNode(o));e.mesh&&n.push(this.createMesh(e.mesh));const i=new vp({id:e.name||e.id,children:n});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const o=new bn().fromQuaternion(e.rotation);i.matrix.multiplyRight(o)}e.scale&&i.matrix.scale(e.scale)}e._node=i}const r=this.gltf.nodes.find(n=>n.id===e.id);return r._node=e._node,e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((i,o)=>this.createPrimitive(i,o,e)),n=new vp({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}createPrimitive(e,r,n){const i=e.name||`${n.name||n.id}-primitive-${r}`,o=Vpe(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),l=Hpe(this.device,{id:i,geometry:this.createGeometry(i,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return l.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],l}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,n){const i={};for(const[o,s]of Object.entries(r.attributes)){const{components:l,size:h,value:A}=s;i[o]={size:h??l,value:A}}return new eo({id:e,topology:n,indices:r.indices.value,attributes:i})}createBuffer(e,r){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[r]||(n.lumaBuffers[r]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}}function Dx(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(Dx);if(t&&typeof t=="object"){const e={};for(const r in t)e[r]=Dx(t[r]);return e}return t}function Kpe(t,e,r){const n=new Jpe(t,r),i=n.instantiate(e),o=n.createAnimator();return{scenes:i,animator:o}}function Aa(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const fk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dk={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},u4=["SCALAR","VEC2","VEC3","VEC4"],Xpe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Qpe=new Map(Xpe),Zpe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$pe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},qpe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function pk(t){return u4[t-1]||u4[0]}function Jy(t){const e=Qpe.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function oE(t,e){const r=qpe[t.componentType],n=Zpe[t.type],i=$pe[t.componentType],o=t.count*n,s=t.count*n*i;Aa(s>=0&&s<=e.byteLength);const l=dk[t.componentType],h=fk[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:l,numberOfComponentsInElement:h}}function Ype(t,e,r){const n=t.bufferViews[r];Aa(n);const i=n.buffer,o=e[i];Aa(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function eAe(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],l=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:h,length:A,componentByteSize:b,numberOfComponentsInElement:C}=oE(n,i),S=b*C,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new h(o,l,A);const N=new h(A);for(let U=0;U<n.count;U++){const V=new h(o,l+U*D,C);N.set(V,U*C)}return N}function tAe(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Ns=class{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||tAe(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(n=>n===t),r=this.getRequiredExtensions().find(n=>n===t);return typeof e=="string"||typeof r=="string"}getExtension(t){const e=this.getUsedExtensions().find(n=>n===t),r=this.json.extensions||{};return e?r[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,r=this.gltf.buffers[e];Aa(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return eAe(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){const n=t.extensions||{};n[e]=r}removeObjectExtension(t,e){const r=t?.extensions||{};if(r[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}delete r[e]}addExtension(t,e={}){return Aa(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return Aa(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const n={mesh:e};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:n,mode:i=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:i}]};if(r){const s=this._addIndices(r);o.primitives[0].indices=s}return Number.isFinite(n)&&(o.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=jy(t),n=e||r?.mimeType,i={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(t,e=0,r=this.byteLength){const n=t.byteLength;Aa(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:e,byteOffset:r,byteLength:n};return this.byteLength+=au(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:pk(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const r=this.addBufferView(t);let n={min:e.min,max:e.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,e.size));const i={size:e.size,componentType:Jy(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(i,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){const t=this.byteLength,e=new ArrayBuffer(t),r=new Uint8Array(e);let n=0;for(const i of this.sourceBuffers||[])n=O8(i,r,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=e,this.sourceBuffers=[e],this.gltf.buffers=[{arrayBuffer:e,byteOffset:0,byteLength:e.byteLength}]}_removeStringFromArray(t,e){let r=!0;for(;r;){const n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}_addAttributes(t={}){const e={};for(const r in t){const n=t[r],i=this._getGltfAttributeName(r),o=this.addBinaryBuffer(n.value,n);e[i]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const n=t.subarray(0,e);for(const i of n)r.min.push(i),r.max.push(i);for(let i=e;i<t.length;i+=e)for(let o=0;o<e;o++)r.min[0+o]=Math.min(r.min[0+o],t[i+o]),r.max[0+o]=Math.max(r.max[0+o],t[i+o]);return r}};function h4(t){return(t%1+1)%1}const Ak={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},rAe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},gk={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function aE(t,e){return gk[e]*Ak[t]}function Ky(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=Xy(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Xy(t,e,r,n=1){const i=Ak[e],o=rAe[r],s=gk[r],l=n*i,h=l*s;let A=t.buffer,b=t.byteOffset;return b%s!==0&&(A=new Uint8Array(A).slice(b,b+h).buffer,b=0),new o(A,b,l)}function lE(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,l=e.index,h=s.textures?.[l]?.source;if(typeof h<"u"){const A=s.images?.[h]?.mimeType,b=t.gltf.images?.[h];if(b&&typeof b.width<"u"){const C=[];for(let S=0;S<o.length;S+=2){const D=nAe(b,A,o,S,e.channels);C.push(D)}return C}}return[]}function mk(t,e,r,n,i){if(!r?.length)return;const o=[];for(const b of r){let C=n.findIndex(S=>S===b);C===-1&&(C=n.push(b)-1),o.push(C)}const s=new Uint32Array(o),l=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,h=t.addBufferView(s,l,0),A=t.addAccessor(h,{size:1,componentType:Jy(s),count:s.length});i.attributes[e]=A}function nAe(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],l=r[n+1];let h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);const A=iAe(s,l,t,h);let b=0;for(const C of i){const S=typeof C=="number"?Object.values(o)[C]:o[C],D=A+S.offset,N=WC(t);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const U=N.data[D];b|=U<<S.shift}return b}function iAe(t,e,r,n=1){const i=r.width,o=h4(t)*(i-1),s=Math.round(o),l=r.height,h=h4(e)*(l-1),A=Math.round(h),b=r.components?r.components:n;return(A*i+s)*b}function _k(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const l=r[s],h=r[s+1]-r[s];if(h+l>n)break;const A=l/i,b=h/i;o.push(t.slice(A,A+b))}return o}function yk(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function bk(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let l=0;l<t;l++){const h=n[l+1]-n[l];if(h+s<=e.length){const A=e.subarray(s,h+s),b=o.decode(A);i.push(b),s+=h}}return i}return[]}const Ip="EXT_mesh_features",sAe=Ip;async function oAe(t,e){const r=new Ns(t);lAe(r,e)}function aAe(t,e){const r=new Ns(t);return uAe(r),r.createBinaryChunk(),r.gltf}function lAe(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)cAe(t,i,e)}function cAe(t,e,r){if(!r?.gltf?.loadBuffers)return;const n=e.extensions?.[Ip]?.featureIds;if(n)for(const i of n){let o;if(typeof i.attribute<"u"){const s=`_FEATURE_ID_${i.attribute}`,l=e.attributes[s];o=t.getTypedArrayForAccessor(l)}else typeof i.texture<"u"&&r?.gltf?.loadImages?o=lE(t,i.texture,e):o=[];i.data=o}}function uAe(t,e){const r=t.gltf.json.meshes;if(r)for(const n of r)for(const i of n.primitives)fAe(t,i)}function hAe(t,e,r,n){e.extensions||(e.extensions={});let i=e.extensions[Ip];i||(i={featureIds:[]},e.extensions[Ip]=i);const{featureIds:o}=i,s={featureCount:r.length,propertyTable:n,data:r};o.push(s),t.addObjectExtension(e,Ip,i)}function fAe(t,e){const r=e.extensions?.[Ip];if(!r)return;const n=r.featureIds;n.forEach((i,o)=>{if(i.data){const{accessorKey:s,index:l}=dAe(e.attributes),h=new Uint32Array(i.data);n[o]={featureCount:h.length,propertyTable:i.propertyTable,attribute:l},t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=t.addBufferView(h),b=t.addAccessor(A,{size:1,componentType:Jy(h),count:h.length});e.attributes[s]=b}})}function dAe(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(i=>i.indexOf(e)===0);let n=-1;for(const i of r){const o=Number(i.substring(e.length));o>n&&(n=o)}return n++,{accessorKey:`${e}${n}`,index:n}}const pAe=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:hAe,decode:oAe,encode:aAe,name:sAe},Symbol.toStringTag,{value:"Module"})),Wp="EXT_structural_metadata",AAe=Wp;async function gAe(t,e){const r=new Ns(t);_Ae(r,e)}function mAe(t,e){const r=new Ns(t);return OAe(r),r.createBinaryChunk(),r.gltf}function _Ae(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(Wp);r&&(e.gltf?.loadImages&&yAe(t,r),bAe(t,r))}function yAe(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)xAe(t,r,o,e)}function bAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=vAe(i,o);s&&CAe(t,r,s)}}function vAe(t,e){for(const r of t)if(r.class===e)return r;return null}function xAe(t,e,r,n){if(!e)return;const i=r.extensions?.[Wp]?.propertyTextures;if(i)for(const o of i){const s=e[o];wAe(t,s,r,n)}}function wAe(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,l=e.properties?.[o];if(!l)continue;l.data||(l.data=[]);const h=l.data,A=lE(t,l,r);A!==null&&(mk(t,s,A,h,r),l.data=h,n.dataAttributeNames.push(s))}}function CAe(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=EAe(t,e,s,i,l);l.data=h}}}function EAe(t,e,r,n,i){let o=[];const s=i.values,l=t.getTypedArrayForBufferView(s),h=BAe(t,r,i,n),A=TAe(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=SAe(r,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=bk(n,l,h,A);break}case"ENUM":{o=IAe(e,r,n,l,h);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function BAe(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?Ky(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function TAe(t,e,r){return typeof e.stringOffsets<"u"?Ky(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function SAe(t,e,r,n){const i=t.array,o=t.count,s=aE(t.type,t.componentType),l=r.byteLength/s;let h;return t.componentType?h=Xy(r,t.type,t.componentType,l):h=r,i?n?_k(h,e,n,r.length,s):o?yk(h,e,o):[]:h}function IAe(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=s.valueType||"UINT16",h=aE(e.type,l),A=n.byteLength/h;let b=Xy(n,e.type,l,A);if(b||(b=n),e.array){if(i)return MAe({valuesData:b,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:h,enumEntry:s});const C=e.count;return C?PAe(b,r,C,s):[]}return cE(b,0,r,s)}function MAe(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,l=[];for(let h=0;h<r;h++){const A=n[h],b=n[h+1]-n[h];if(b+A>i)break;const C=A/o,S=b/o,D=cE(e,C,S,s);l.push(D)}return l}function PAe(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,l=cE(t,s,r,n);i.push(l)}return i}function cE(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],l=LAe(n,s);l?i.push(l.name):i.push("")}return i}function LAe(t,e){for(const r of t.values)if(r.value===e)return r;return null}const RAe="schemaClassId";function OAe(t,e){const r=t.getExtension(Wp);if(r&&r.propertyTables)for(const n of r.propertyTables){const i=n.class,o=r.schema?.classes?.[i];n.properties&&o&&DAe(n,o,t)}}function DAe(t,e,r){for(const n in t.properties){const i=t.properties[n].data;if(i){const o=e.properties[n];if(o){const s=UAe(i,o,r);t.properties[n]=s}}}}function FAe(t,e,r=RAe){let n=t.getExtension(Wp);n||(n=t.addExtension(Wp)),n.schema=kAe(e,r,n.schema);const i=NAe(e,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function kAe(t,e,r){const n=r??{id:"schema_id"},i={properties:{}};for(const o of t){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function NAe(t,e,r){const n={class:e,count:0};let i=0;const o=r.classes?.[e];for(const s of t){if(i===0&&(i=s.values.length),i!==s.values.length&&s.values.length)throw new Error("Illegal values in attributes");o?.properties[s.name]&&(n.properties||(n.properties={}),n.properties[s.name]={values:0,data:s.values})}return n.count=i,n}function UAe(t,e,r){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=jAe(t);n.stringOffsets=C1(o,r),n.values=C1(i,r)}else if(e.type==="SCALAR"&&e.componentType){const i=zAe(t,e.componentType);n.values=C1(i,r)}return n}const GAe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function zAe(t,e){const r=[];for(const i of t)r.push(Number(i));const n=GAe[e];if(!n)throw new Error("Illegal component type");return new n(r)}function jAe(t){const e=new TextEncoder,r=[];let n=0;for(const h of t){const A=e.encode(h);n+=A.length,r.push(A)}const i=new Uint8Array(n),o=[];let s=0;for(const h of r)i.set(h,s),o.push(s),s+=h.length;o.push(s);const l=new Uint32Array(o);return{stringData:i,stringOffsets:l}}function C1(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const HAe=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:FAe,decode:gAe,encode:mAe,name:AAe},Symbol.toStringTag,{value:"Module"})),vk="EXT_feature_metadata",VAe=vk;async function WAe(t,e){const r=new Ns(t);JAe(r,e)}function JAe(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(vk);r&&(e.gltf?.loadImages&&KAe(t,r),XAe(t,r))}function KAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],l=ZAe(i,o);l&&qAe(t,l,s)}}function XAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=QAe(i,o);s&&$Ae(t,r,s)}}function QAe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function ZAe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function $Ae(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=YAe(t,e,s,i,l);l.data=h}}}function qAe(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=ige(t,o,n);o.data=s}}}function YAe(t,e,r,n,i){let o=[];const s=i.bufferView,l=t.getTypedArrayForBufferView(s),h=ege(t,r,i,n),A=tge(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=bk(n,l,h,A):rge(r)&&(o=nge(r,n,l,h)),o}function ege(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?Ky(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function tge(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?Ky(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function rge(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function nge(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",l=t.componentType||t.type,h=aE(s,l),A=r.byteLength/h,b=Xy(r,s,l,A);return i?n?_k(b,e,n,r.length,h):o?yk(b,e,o):[]:b}function ige(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)sge(t,r,e,i,s);return i}function sge(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=lE(t,o,i);s&&mk(t,e,s,n,i)}const oge=Object.freeze(Object.defineProperty({__proto__:null,decode:WAe,name:VAe},Symbol.toStringTag,{value:"Module"})),age="4.3.1",lge="4.3.1",ny={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let f4;async function d4(t){return zue(t.modules),jue("basis")||(f4||=cge(t),await f4)}async function cge(t){let e=null,r=null;return[e,r]=await Promise.all([await cf(ny.TRANSCODER,"textures",t),await cf(ny.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await uge(e,r)}function uge(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let E1;async function p4(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(E1=E1||hge(t),await E1)}async function hge(t){let e=null,r=null;return[e,r]=await Promise.all([await cf(ny.ENCODER,"textures",t),await cf(ny.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await fge(e,r)}function fge(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:l,BasisEncoder:h}=i;l(),n({BasisFile:o,KTX2File:s,BasisEncoder:h})})})}const kd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},dge=["","WEBKIT_","MOZ_"],A4={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let v0=null;function pge(t){if(!v0){t=t||Age()||void 0,v0=new Set;for(const e of dge)for(const r in A4)if(t&&t.getExtension(`${e}${r}`)){const n=A4[r];v0.add(n)}}return v0}function Age(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ua=[171,75,84,88,32,50,48,187,13,10,26,10];function gge(t){const e=new Uint8Array(t);return!(e.byteLength<ua.length||e[0]!==ua[0]||e[1]!==ua[1]||e[2]!==ua[2]||e[3]!==ua[3]||e[4]!==ua[4]||e[5]!==ua[5]||e[6]!==ua[6]||e[7]!==ua[7]||e[8]!==ua[8]||e[9]!==ua[9]||e[10]!==ua[10]||e[11]!==ua[11])}const mge={etc1:{basisFormat:0,compressed:!0,format:kd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:kd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:kd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:kd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:kd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:kd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function _ge(t,e){if(e.basis.containerFormat==="auto"){if(gge(t)){const n=await p4(e);return g4(n.KTX2File,t,e)}const{BasisFile:r}=await d4(e);return B1(r,t,e)}switch(e.basis.module){case"encoder":const r=await p4(e);switch(e.basis.containerFormat){case"ktx2":return g4(r.KTX2File,t,e);case"basis":default:return B1(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await d4(e);return B1(n,t,e)}}function B1(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const l=n.getNumLevels(s),h=[];for(let A=0;A<l;A++)h.push(yge(n,s,A,r));o.push(h)}return o}finally{n.close(),n.delete()}}function yge(t,e,r,n){const i=t.getImageWidth(e,r),o=t.getImageHeight(e,r),s=t.getHasAlpha(),{compressed:l,format:h,basisFormat:A}=xk(n,s),b=t.getImageTranscodedSizeInBytes(e,r,A),C=new Uint8Array(b);if(!t.transcodeImage(C,e,r,A,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:C,compressed:l,format:h,hasAlpha:s}}function g4(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++)o.push(bge(n,s,r));return[o]}finally{n.close(),n.delete()}}function bge(t,e,r){const{alphaFlag:n,height:i,width:o}=t.getImageLevelInfo(e,0,0),{compressed:s,format:l,basisFormat:h}=xk(r,n),A=t.getImageTranscodedSizeInBytes(e,0,0,h),b=new Uint8Array(A);if(!t.transcodeImage(b,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:b,compressed:s,levelSize:A,hasAlpha:n,format:l}}function xk(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=uE()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),mge[r]}function uE(){const t=pge();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const vge={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:lge,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},wk={...vge,parse:_ge},Jp=!0,m4=1735152710,hE=12,iy=8,xge=1313821514,wge=5130562,Cge=0,Ege=0,Bge=1;function Tge(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function Sge(t,e=0,r={}){const n=new DataView(t),{magic:i=m4}=r,o=n.getUint32(e,!1);return o===i||o===m4}function Ige(t,e,r=0,n={}){const i=new DataView(e),o=Tge(i,r+0),s=i.getUint32(r+4,Jp),l=i.getUint32(r+8,Jp);switch(Object.assign(t,{header:{byteOffset:r,byteLength:l,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=hE,t.version){case 1:return Mge(t,i,r);case 2:return Pge(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function Mge(t,e,r){Ai(t.header.byteLength>hE+iy);const n=e.getUint32(r+0,Jp),i=e.getUint32(r+4,Jp);return r+=iy,Ai(i===Cge),Fx(t,e,r,n),r+=n,r+=kx(t,e,r,t.header.byteLength),r}function Pge(t,e,r,n){return Ai(t.header.byteLength>hE+iy),Lge(t,e,r,n),r+t.header.byteLength}function Lge(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,Jp),o=e.getUint32(r+4,Jp);switch(r+=iy,o){case xge:Fx(t,e,r,i);break;case wge:kx(t,e,r,i);break;case Ege:n.strict||Fx(t,e,r,i);break;case Bge:n.strict||kx(t,e,r,i);break}r+=au(i,4)}return r}function Fx(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),au(n,4)}function kx(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),au(n,4)}function Ck(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const Rge="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Oge="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Dge=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Fge=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),kge={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Nge={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Uge(t,e,r,n,i,o="NONE"){const s=await Gge();Hge(s,s.exports[Nge[i]],t,e,r,n,s.exports[kge[o||"NONE"]])}let T1;async function Gge(){return T1||(T1=zge()),T1}async function zge(){let t=Rge;WebAssembly.validate(Dge)&&(t=Oge,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(jge(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function jge(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?Fge[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function Hge(t,e,r,n,i,o,s){const l=t.exports.sbrk,h=n+3&-4,A=l(h*i),b=l(o.length),C=new Uint8Array(t.exports.memory.buffer);C.set(o,b);const S=e(A,n,i,b,o.length);if(S===0&&s&&s(A,h,i),r.set(C.subarray(A,A+n*i)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const sy="EXT_meshopt_compression",Vge=sy;async function Wge(t,e){const r=new Ns(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(Jge(r,i));await Promise.all(n),r.removeExtension(sy)}async function Jge(t,e){const r=t.getObjectExtension(e,sy);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:l,filter:h="NONE",buffer:A}=r,b=t.gltf.buffers[A],C=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Uge(S,s,o,C,l,h),t.removeObjectExtension(e,sy)}}const Kge=Object.freeze(Object.defineProperty({__proto__:null,decode:Wge,name:Vge},Symbol.toStringTag,{value:"Module"})),rp="EXT_texture_webp",Xge=rp;function Qge(t,e){const r=new Ns(t);if(!z8("image/webp")){if(r.getRequiredExtensions().includes(rp))throw new Error(`gltf: Required extension ${rp} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,rp);o&&(i.source=o.source),r.removeObjectExtension(i,rp)}r.removeExtension(rp)}const Zge=Object.freeze(Object.defineProperty({__proto__:null,name:Xge,preprocess:Qge},Symbol.toStringTag,{value:"Module"})),e_="KHR_texture_basisu",$ge=e_;function qge(t,e){const r=new Ns(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,e_);o&&(i.source=o.source,r.removeObjectExtension(i,e_))}r.removeExtension(e_)}const Yge=Object.freeze(Object.defineProperty({__proto__:null,name:$ge,preprocess:qge},Symbol.toStringTag,{value:"Module"})),eme="4.3.1",tme={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:eme,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function rme(t,e,r){const n=Ek(e.metadata),i=[],o=nme(e.attributes);for(const s in t){const l=t[s],h=_4(s,l,o[s]);i.push(h)}if(r){const s=_4("indices",r);i.push(s)}return{fields:i,metadata:n}}function nme(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}function _4(t,e,r){const n=r?Ek(r.metadata):void 0;return Cpe(t,e,n)}function Ek(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const y4={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ime={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},sme=4;class ome{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const C=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(C)}const l=this._getDracoLoaderData(o,i,r),h=this._getMeshData(o,l,r),A=uk(h.attributes),b=rme(h.attributes,l,h.indices);return{loader:"draco",loaderData:l,header:{vertexCount:o.num_points(),boundingBox:A},...h,schema:b}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,r,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,r){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const l=this._getQuantizationTransform(o,r);l&&(n[o.unique_id()].quantization_transform=l);const h=this._getOctahedronTransform(o,r);h&&(n[o.unique_id()].octahedron_transform=h)}return n}_getMeshData(e,r,n){const i=this._getMeshAttributes(r,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,r,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const l=this._getAttributeValues(r,o);if(l){const{value:h,size:A}=l;i[s]={value:h,size:A,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const r=e.num_faces()*3,n=r*sme,i=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,i),new Uint32Array(this.draco.HEAPF32.buffer,i,r).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),cme(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const n=ime[r.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const i=r.num_components,o=e.num_points()*i,s=o*n.BYTES_PER_ELEMENT,l=ame(this.draco,n);let h;const A=this.draco._malloc(s);try{const b=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,b,l,s,A),h=new n(this.draco.HEAPF32.buffer,A,o).slice()}finally{this.draco._free(A)}return{value:h,size:i}}_deduceAttributeName(e,r){const n=e.unique_id;for(const[s,l]of Object.entries(r.extraAttributes||{}))if(l===n)return s;const i=e.attribute_type;for(const s in y4)if(this.draco[s]===i)return y4[s];const o=r.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const n=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);r[o]=this._getDracoMetadataField(e,o)}return r}_getDracoMetadataField(e,r){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,n);const i=lme(n);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:n=[]}=e,i=[...r,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,r){const{quantizedAttributes:n=[]}=r,i=e.attribute_type();if(n.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(s=>o.min_value(s))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:n=[]}=r,i=e.attribute_type();if(n.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function ame(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function lme(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function cme(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}const ume="1.5.6",hme="1.4.1",S1=`https://www.gstatic.com/draco/versioned/decoders/${ume}`,Vo={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},I1={[Vo.DECODER]:`${S1}/${Vo.DECODER}`,[Vo.DECODER_WASM]:`${S1}/${Vo.DECODER_WASM}`,[Vo.FALLBACK_DECODER]:`${S1}/${Vo.FALLBACK_DECODER}`,[Vo.ENCODER]:`https://raw.githubusercontent.com/google/draco/${hme}/javascript/${Vo.ENCODER}`};let M1;async function fme(t){const e=t.modules||{};return e.draco3d?M1||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):M1||=dme(t),await M1}async function dme(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await cf(I1[Vo.FALLBACK_DECODER],"draco",t,Vo.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await cf(I1[Vo.DECODER],"draco",t,Vo.DECODER),await cf(I1[Vo.DECODER_WASM],"draco",t,Vo.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await pme(e,r)}function pme(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t({...r,onModuleLoaded:i=>n({draco:i})})})}const fE={...tme,parse:Ame};async function Ame(t,e){const{draco:r}=await fme(e),n=new ome(r);try{return n.parseSync(t,e?.draco)}finally{n.destroy()}}function gme(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=Bk(n);e[r]=i}}return e}function Bk(t){const{buffer:e,size:r,count:n}=mme(t);return{value:e,size:r,byteOffset:0,count:n,type:pk(r),componentType:Jy(e)}}function mme(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=_me(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function _me(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const lh="KHR_draco_mesh_compression",yme=lh;function bme(t,e,r){const n=new Ns(t);for(const i of Tk(n))n.getObjectExtension(i,lh)}async function vme(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new Ns(t),i=[];for(const o of Tk(n))n.getObjectExtension(o,lh)&&i.push(wme(n,o,e,r));await Promise.all(i),n.removeExtension(lh)}function xme(t,e={}){const r=new Ns(t);for(const n of r.json.meshes||[])Cme(n),r.addRequiredExtension(lh)}async function wme(t,e,r,n){const i=t.getObjectExtension(e,lh);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=em(o.buffer,o.byteOffset),l={...r};delete l["3d-tiles"];const h=await Tf(s,fE,l,n),A=gme(h.attributes);for(const[b,C]of Object.entries(A))if(b in e.attributes){const S=e.attributes[b],D=t.getAccessor(S);D?.min&&D?.max&&(C.min=D.min,C.max=D.max)}e.attributes=A,h.indices&&(e.indices=Bk(h.indices)),t.removeObjectExtension(e,lh),Eme(e)}function Cme(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),l=n._addFauxAttributes(s.attributes),h=n.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[lh]:{bufferView:h,attributes:l}}}]}}function Eme(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Tk(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const Bme=Object.freeze(Object.defineProperty({__proto__:null,decode:vme,encode:xme,name:yme,preprocess:bme},Symbol.toStringTag,{value:"Module"})),Qy="KHR_texture_transform",Tme=Qy,x0=new ft,Sme=new gi,Ime=new gi;async function Mme(t,e){if(!new Ns(t).hasExtension(Qy)||!e.gltf?.loadBuffers)return;const r=t.json.materials||[];for(let n=0;n<r.length;n++)Pme(n,t)}function Pme(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[Qy]&&Lme(e,t,o,i)}function Lme(t,e,r,n){const i=Rme(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const l of s.primitives){const h=l.material;Number.isFinite(h)&&e===h&&Ome(t,l,i)}}function Rme(t,e){const r=t.extensions?.[Qy],{texCoord:n=0}=t,{texCoord:i=n}=r;if(e.findIndex(([o,s])=>o===n&&s===i)===-1){const o=kme(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function Ome(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const l=t.json.accessors?.[s];if(l&&l.bufferView){const h=t.json.bufferViews?.[l.bufferView];if(h){const{arrayBuffer:A,byteOffset:b}=t.buffers[h.buffer],C=(b||0)+(l.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:D}=oE(l,h),N=dk[l.componentType],U=fk[l.type],V=h.byteStride||N*U,j=new Float32Array(D);for(let ee=0;ee<l.count;ee++){const Q=new S(A,C+ee*V,2);x0.set(Q[0],Q[1],1),x0.transformByMatrix3(o),j.set([x0[0],x0[1]],ee*U)}n===i?Dme(l,h,t.buffers,j):Fme(i,l,e,t,j)}}}}function Dme(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Fme(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function kme(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new gi().set(1,0,0,0,1,0,e[0],e[1],1),o=Sme.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=Ime.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Nme=Object.freeze(Object.defineProperty({__proto__:null,decode:Mme,name:Tme},Symbol.toStringTag,{value:"Module"})),ef="KHR_lights_punctual",Ume=ef;async function Gme(t){const e=new Ns(t),{json:r}=e,n=e.getExtension(ef);n&&(e.json.lights=n.lights,e.removeExtension(ef));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,ef);o&&(i.light=o.light),e.removeObjectExtension(i,ef)}}async function zme(t){const e=new Ns(t),{json:r}=e;if(r.lights){const n=e.addExtension(ef);Aa(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,ef,n)}delete e.json.lights}}const jme=Object.freeze(Object.defineProperty({__proto__:null,decode:Gme,encode:zme,name:Ume},Symbol.toStringTag,{value:"Module"})),zg="KHR_materials_unlit",Hme=zg;async function Vme(t){const e=new Ns(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,zg);e.removeExtension(zg)}function Wme(t){const e=new Ns(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,zg,{}),e.addExtension(zg))}const Jme=Object.freeze(Object.defineProperty({__proto__:null,decode:Vme,encode:Wme,name:Hme},Symbol.toStringTag,{value:"Module"})),rg="KHR_techniques_webgl",Kme=rg;async function Xme(t){const e=new Ns(t),{json:r}=e,n=e.getExtension(rg);if(n){const i=Zme(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,rg);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=$me(o.technique,e)),e.removeObjectExtension(o,rg)}e.removeExtension(rg)}}async function Qme(t,e){}function Zme(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function $me(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const qme=Object.freeze(Object.defineProperty({__proto__:null,decode:Xme,encode:Qme,name:Kme},Symbol.toStringTag,{value:"Module"})),Sk=[HAe,pAe,Kge,Zge,Yge,Bme,jme,Jme,qme,Nme,oge];function Yme(t,e={},r){const n=Sk.filter(i=>Ik(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function e0e(t,e={},r){const n=Sk.filter(i=>Ik(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function Ik(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const P1="KHR_binary_glTF";function t0e(t){const e=new Ns(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,P1);i&&Object.assign(n,i),e.removeObjectExtension(n,P1)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(P1)}const b4={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},r0e={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let n0e=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),t0e(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in b4)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(!(!r||Array.isArray(r))){t[e]=[];for(const n in r){const i=r[n];i.id=i.id||n;const o=t[e].length;t[e].push(i),this.idToIndexMap[e][n]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in b4)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:r,indices:n,material:i}=e;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),i&&(e.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const r of t[e])for(const n in r){const i=r[n],o=this._convertIdToIndex(i,n);r[n]=o}}_convertIdToIndex(t,e){const r=r0e[e];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return n}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=e.values?.tex||e.values?.texture2d_0||e.values?.diffuseTex,n=t.textures.findIndex(i=>i.id===r);n!==-1&&(e.pbrMetallicRoughness.baseColorTexture={index:n})}}};function i0e(t,e={}){return new n0e().normalize(t,e)}async function s0e(t,e,r=0,n,i){return o0e(t,e,r,n),i0e(t,{normalize:n?.gltf?.normalize}),Yme(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await a0e(t,n,i),n?.gltf?.loadImages&&await l0e(t,n,i),await e0e(t,n,i),t}function o0e(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!Sge(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=R8(e);else if(e instanceof ArrayBuffer){const s={};r=Ige(s,e,r,n.glb),Aa(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else Aa(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function a0e(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;Aa(s);const l=Ck(o.uri,e),h=await(await r?.fetch?.(l))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function l0e(t,e,r){const n=c0e(t),i=t.json.images||[],o=[];for(const s of n)o.push(u0e(t,i[s],s,e,r));return await Promise.all(o)}function c0e(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function u0e(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=Ck(e.uri,n),{fetch:h}=i;o=await(await h(l)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const l=Ype(t.json,t.buffers,e.bufferView);o=em(l.buffer,l.byteOffset,l.byteLength)}Aa(o,"glTF image has no data");let s=await Tf(o,[Q_,wk],{...n,mimeType:e.mimeType,basis:n.basis||{format:uE()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const Nx={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:age,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:h0e,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function h0e(t,e={},r){e={...Nx.options,...e},e.gltf={...Nx.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await s0e({},t,n,e,r)}const f0e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d0e={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Da={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},p0e={magFilter:Da.TEXTURE_MAG_FILTER,minFilter:Da.TEXTURE_MIN_FILTER,wrapS:Da.TEXTURE_WRAP_S,wrapT:Da.TEXTURE_WRAP_T},A0e={[Da.TEXTURE_MAG_FILTER]:Da.LINEAR,[Da.TEXTURE_MIN_FILTER]:Da.NEAREST_MIPMAP_LINEAR,[Da.TEXTURE_WRAP_S]:Da.REPEAT,[Da.TEXTURE_WRAP_T]:Da.REPEAT};function g0e(){return{id:"default-sampler",parameters:A0e}}function m0e(t){return d0e[t]}function _0e(t){return f0e[t]}let y0e=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(t,e={}){const{json:r,buffers:n=[],images:i=[]}=t,{baseUri:o=""}=t;return Aa(r),this.baseUri=o,this.buffers=n,this.images=i,this.jsonUnprocessed=r,this.json=this._resolveTree(t.json,e),this.json}_resolveTree(t,e={}){const r={...t};return this.json=r,t.bufferViews&&(r.bufferViews=t.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),t.images&&(r.images=t.images.map((n,i)=>this._resolveImage(n,i))),t.samplers&&(r.samplers=t.samplers.map((n,i)=>this._resolveSampler(n,i))),t.textures&&(r.textures=t.textures.map((n,i)=>this._resolveTexture(n,i))),t.accessors&&(r.accessors=t.accessors.map((n,i)=>this._resolveAccessor(n,i))),t.materials&&(r.materials=t.materials.map((n,i)=>this._resolveMaterial(n,i))),t.meshes&&(r.meshes=t.meshes.map((n,i)=>this._resolveMesh(n,i))),t.nodes&&(r.nodes=t.nodes.map((n,i)=>this._resolveNode(n,i)),r.nodes=r.nodes.map((n,i)=>this._resolveNodeChildren(n))),t.skins&&(r.skins=t.skins.map((n,i)=>this._resolveSkin(n,i))),t.scenes&&(r.scenes=t.scenes.map((n,i)=>this._resolveScene(n,i))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,e){if(typeof e=="object")return e;const r=t&&t[e];return r||console.warn(`glTF file error: Could not find ${t}[${e}]`),r}_resolveScene(t,e){return{...t,id:t.id||`scene-${e}`,nodes:(t.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(t,e){const r={...t,id:t?.id||`node-${e}`};return t.mesh!==void 0&&(r.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(r.camera=this.getCamera(t.camera)),t.skin!==void 0&&(r.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(r.mesh=t.meshes.reduce((n,i)=>{const o=this.getMesh(i);return n.id=o.id,n.primitives=n.primitives.concat(o.primitives),n},{primitives:[]})),r}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(e=>this.getNode(e))),t}_resolveSkin(t,e){const r=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${e}`,inverseBindMatrices:r}}_resolveMesh(t,e){const r={...t,id:t.id||`mesh-${e}`,primitives:[]};return t.primitives&&(r.primitives=t.primitives.map(n=>{const i={...n,attributes:{},indices:void 0,material:void 0},o=n.attributes;for(const s in o)i.attributes[s]=this.getAccessor(o[s]);return n.indices!==void 0&&(i.indices=this.getAccessor(n.indices)),n.material!==void 0&&(i.material=this.getMaterial(n.material)),i})),r}_resolveMaterial(t,e){const r={...t,id:t.id||`material-${e}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const n=r.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return r}_resolveAccessor(t,e){const r=m0e(t.componentType),n=_0e(t.type),i=r*n,o={...t,id:t.id||`accessor-${e}`,bytesPerComponent:r,components:n,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const s=o.bufferView.buffer,{ArrayType:l,byteLength:h}=oE(o,o.bufferView),A=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+s.byteOffset;let b=s.arrayBuffer.slice(A,A+h);o.bufferView.byteStride&&(b=this._getValueFromInterleavedBuffer(s,A,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new l(b)}return o}_getValueFromInterleavedBuffer(t,e,r,n,i){const o=new Uint8Array(i*n);for(let s=0;s<i;s++){const l=e+s*r;o.set(new Uint8Array(t.arrayBuffer.slice(l,l+n)),s*n)}return o.buffer}_resolveTexture(t,e){return{...t,id:t.id||`texture-${e}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):g0e(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,e){const r={id:t.id||`sampler-${e}`,...t,parameters:{}};for(const n in r){const i=this._enumSamplerParameter(n);i!==void 0&&(r.parameters[i]=r[n])}return r}_enumSamplerParameter(t){return p0e[t]}_resolveImage(t,e){const r={...t,id:t.id||`image-${e}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},n=this.images[e];return n&&(r.image=n),r}_resolveBufferView(t,e){const r=t.buffer,n=this.buffers[r].arrayBuffer;let i=this.buffers[r].byteOffset||0;return t.byteOffset&&(i+=t.byteOffset),{id:`bufferView-${e}`,...t,buffer:this.buffers[r],data:new Uint8Array(n,i,t.byteLength)}}_resolveCamera(t,e){const r={...t,id:t.id||`camera-${e}`};return r.perspective,r.orthographic,r}};function b0e(t,e){return new y0e().postProcess(t,e)}async function v0e(t){const e=[];return t.scenes.forEach(r=>{r.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await x0e(()=>e.some(r=>!r.loaded))}async function x0e(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const v4=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,w0e={name:"scenegraph",vs:v4,fs:v4,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},C0e=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,E0e=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mk=[255,255,255,255],B0e={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Mk},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Nx]};class jg extends Es{getShaders(){const e={};let r;this.props._lighting==="pbr"?(r=sC,e.LIGHTING_PBR=1):r={name:"pbrMaterial"};const n=[Fs,_a,w0e,r];return super.getShaders({defines:e,vs:C0e,fs:E0e,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Mk,transition:!0},instanceModelMatrix:lk})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;r.scenegraph!==n.scenegraph?this._updateScenegraph():r._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const e=this.props,{device:r}=this.context;let n=null;if(e.scenegraph instanceof E_)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const l=e.scenegraph,h=l.json?b0e(l):l,A=Kpe(r,h,this._getModelOptions());n={gltf:h,...A},v0e(A).then(()=>{this.setNeedsRedraw()}).catch(b=>{this.raiseError(b,"loading glTF")})}const i={layer:this,device:this.context.device},o=e.getScene(n,i),s=e.getAnimator(n,i);if(o instanceof vp){this.state.scenegraph?.destroy(),this._applyAnimationsProp(s,e._animations);const l=[];o.traverse(h=>{h instanceof N2&&l.push(h.model)}),this.setState({scenegraph:o,animator:s,models:l}),this.getAttributeManager().invalidateAll()}else o!==null&&$r.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,r){if(!e||!r)return;const n=e.getAnimations();Object.keys(r).sort().forEach(i=>{const o=r[i];if(i==="*")n.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(i))){const s=Number(i);s>=0&&s<n.length?Object.assign(n[s],o):$r.warn(`animation ${i} not found`)()}else{const s=n.find(({name:l})=>l===i);s?Object.assign(s,o):$r.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,coordinateSystem:l}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse((A,{worldMatrix:b})=>{if(A instanceof N2){const{model:C}=A;C.setInstanceCount(h);const S={camera:C.uniforms.cameraPosition},D={sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:ck(r,l),sceneModelMatrix:b};C.shaderInputs.setProps({pbrProjection:S,scenegraph:D}),C.draw(n)}})}}jg.defaultProps=B0e,jg.layerName="ScenegraphLayer";const T0e=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:jg,SimpleMeshLayer:mf},Symbol.toStringTag,{value:"Module"})),x4=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,S0e={name:"mesh",vs:x4,fs:x4,uniformTypes:{pickFeatureIds:"f32"}},I0e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,M0e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function P0e(t){const e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const L0e={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Ux extends mf{getShaders(){const e=super.getShaders();return e.modules.push(sC,S0e),{...e,vs:I0e,fs:M0e}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;r.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){const{featureIds:r}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!r},o={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:o,mesh:i}),super.draw(e)}getModel(e){const{id:r}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return P0e(e.attributes),new Di(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:r}=this.state;if(r){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:o}=i.bindings,{emptyTexture:s}=this.state,l={sampler:o||s,hasTexture:!!o},{camera:h,...A}={...i.bindings,...i.uniforms};r.shaderInputs.setProps({simpleMesh:l,pbrMaterial:A})}}parseMaterial(e,r){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return hk(this.context.device,{unlit:n,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const r=this.props.featureIds,n=new Uint8ClampedArray(r.length*e.size),i=[];for(let o=0;o<r.length;o++)this.encodePickingColor(r[o],i),n[o*3]=i[0],n[o*3+1]=i[1],n[o*3+2]=i[2];e.value=n}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}Ux.layerName="MeshLayer",Ux.defaultProps=L0e;const R0e=6378137,O0e=6378137,D0e=6356752314245179e-9;function Zy(t){return t}new ft;function F0e(t,e=[],r=Zy){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function k0e(t,e=[]){return F0e(t,e,Cs._cartographicRadians?Zy:SH)}function N0e(t,e,r=Zy){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function U0e(t,e){return N0e(t,e,Cs._cartographicRadians?Zy:IH)}const w4=1e-14,G0e=new ft,C4={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},L1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},VA={east:new ft,north:new ft,up:new ft,west:new ft,south:new ft,down:new ft},z0e=new ft,j0e=new ft,H0e=new ft;function E4(t,e,r,n,i,o){const s=C4[e]&&C4[e][r];yl(s&&(!n||n===s));let l,h,A;const b=G0e.copy(i);if(ma(b.x,0,w4)&&ma(b.y,0,w4)){const C=Math.sign(b.z);l=z0e.fromArray(L1[e]),e!=="east"&&e!=="west"&&l.scale(C),h=j0e.fromArray(L1[r]),r!=="east"&&r!=="west"&&h.scale(C),A=H0e.fromArray(L1[n]),n!=="east"&&n!=="west"&&A.scale(C)}else{const{up:C,east:S,north:D}=VA;S.set(-b.y,b.x,0).normalize(),t.geodeticSurfaceNormal(b,C),D.copy(C).cross(S);const{down:N,west:U,south:V}=VA;N.copy(C).scale(-1),U.copy(S).scale(-1),V.copy(D).scale(-1),l=VA[e],h=VA[r],A=VA[n]}return o[0]=l.x,o[1]=l.y,o[2]=l.z,o[3]=0,o[4]=h.x,o[5]=h.y,o[6]=h.z,o[7]=0,o[8]=A.x,o[9]=A.y,o[10]=A.z,o[11]=0,o[12]=b.x,o[13]=b.y,o[14]=b.z,o[15]=1,o}const Nd=new ft,V0e=new ft,W0e=new ft;function J0e(t,e,r=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:o}=e;Nd.from(t);const s=Nd.x,l=Nd.y,h=Nd.z,A=n.x,b=n.y,C=n.z,S=s*s*A*A,D=l*l*b*b,N=h*h*C*C,U=S+D+N,V=Math.sqrt(1/U);if(!Number.isFinite(V))return;const j=V0e;if(j.copy(t).scale(V),U<o)return j.to(r);const ee=i.x,Q=i.y,X=i.z,pe=W0e;pe.set(j.x*ee*2,j.y*Q*2,j.z*X*2);let Y=(1-V)*Nd.len()/(.5*pe.len()),Ge=0,ze,de,ce,De;do{Y-=Ge,ze=1/(1+Y*ee),de=1/(1+Y*Q),ce=1/(1+Y*X);const J=ze*ze,ue=de*de,Ee=ce*ce,ct=J*ze,Ce=ue*de,Le=Ee*ce;De=S*J+D*ue+N*Ee-1;const Ne=-2*(S*ct*ee+D*Ce*Q+N*Le*X);Ge=De/Ne}while(Math.abs(De)>XV);return Nd.scale([ze,de,ce]).to(r)}const w0=new ft,B4=new ft,K0e=new ft,ul=new ft,X0e=new ft,C0=new ft;class wi{constructor(e=0,r=0,n=0){this.centerToleranceSquared=KV,yl(e>=0),yl(r>=0),yl(n>=0),this.radii=new ft(e,r,n),this.radiiSquared=new ft(e*e,r*r,n*n),this.radiiToTheFourth=new ft(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new ft(e===0?0:1/e,r===0?0:1/r,n===0?0:1/n),this.oneOverRadiiSquared=new ft(e===0?0:1/(e*e),r===0?0:1/(r*r),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){const n=B4,i=K0e,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(o),i.add(n),i.to(r)}cartesianToCartographic(e,r=[0,0,0]){C0.from(e);const n=this.scaleToGeodeticSurface(C0,ul);if(!n)return;const i=this.geodeticSurfaceNormal(n,B4),o=X0e;o.copy(C0).subtract(n);const s=Math.atan2(i.y,i.x),l=Math.asin(i.z),h=Math.sign(Yw(o,C0))*xD(o);return U0e([s,l,h],r)}eastNorthUpToFixedFrame(e,r=new bn){return E4(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,n,i,o=new bn){return E4(this,e,r,n,i,o)}geocentricSurfaceNormal(e,r=[0,0,0]){return w0.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){const n=k0e(e),i=n[0],o=n[1],s=Math.cos(o);return w0.set(s*Math.cos(i),s*Math.sin(i),Math.sin(o)).normalize(),w0.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return w0.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return J0e(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){ul.from(e);const n=ul.x,i=ul.y,o=ul.z,s=this.oneOverRadiiSquared,l=1/Math.sqrt(n*n*s.x+i*i*s.y+o*o*s.z);return ul.multiplyScalar(l).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return ul.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return ul.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,n=[0,0,0]){yl(ma(this.radii.x,this.radii.y,RD)),yl(this.radii.z>0),ul.from(e);const i=ul.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-r))return ul.set(0,0,i).to(n)}}wi.WGS84=new wi(R0e,O0e,D0e);class Q0e{item;previous;next;constructor(e,r,n){this.item=e,this.previous=r,this.next=n}}class Z0e{head=null;tail=null;_length=0;get length(){return this._length}add(e){const r=new Q0e(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){const n=e.next;e.next=r,this.tail===e?this.tail=r:n.previous=r,r.next=n,r.previous=e,++this._length}}class $0e{_list;_sentinel;_trimTiles;constructor(){this._list=new Z0e,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,n){r._cacheNode||(r._cacheNode=this._list.add(r),n&&n(e,r))}unloadTile(e,r,n){const i=r._cacheNode;i&&(this._list.remove(i),r._cacheNode=null,n&&n(e,r))}unloadTiles(e,r){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel;let l=i.head;for(;l!==s&&(e.gpuMemoryUsageInBytes>o||n);){const h=l.item;l=l.next,this.unloadTile(e,h,r)}}trim(){this._trimTiles=!0}}function q0e(t,e){Ai(t),Ai(e);const{rtcCenter:r,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:o}}=t;let s=new bn(i);switch(r&&s.translate(r),n){case"Z":break;case"Y":const b=new bn().rotateX(Math.PI/2);s=s.multiplyRight(b);break;case"X":const C=new bn().rotateY(-Math.PI/2);s=s.multiplyRight(C);break}e.isQuantized&&s.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new ft(o);e.cartesianModelMatrix=s,e.cartesianOrigin=l;const h=wi.WGS84.cartesianToCartographic(l,new ft),A=wi.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=A.multiplyRight(s),e.cartographicOrigin=h,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const T4=new ft,R1=new ft,Gx=new pa([new _l,new _l,new _l,new _l,new _l,new _l]);function Y0e(t,e){const{cameraDirection:r,cameraUp:n,height:i}=t,{metersPerUnit:o}=t.distanceScales,s=t_(t,t.center),l=wi.WGS84.eastNorthUpToFixedFrame(s),h=t.unprojectPosition(t.cameraPosition),A=wi.WGS84.cartographicToCartesian(h,new ft),b=new ft(l.transformAsVector(new ft(r).scale(o))).normalize(),C=new ft(l.transformAsVector(new ft(n).scale(o))).normalize();t_e(t);const S=t.constructor,{longitude:D,latitude:N,width:U,bearing:V,zoom:j}=t,ee=new S({longitude:D,latitude:N,height:i,width:U,bearing:V,zoom:j,pitch:0});return{camera:{position:A,direction:b,up:C},viewport:t,topDownViewport:ee,height:i,cullingVolume:Gx,frameNumber:e,sseDenominator:1.15}}function e_e(t,e,r){if(r===0||t.length<=r)return[t,[]];const n=[],{longitude:i,latitude:o}=e.viewport;for(const[A,b]of t.entries()){const[C,S]=b.header.mbs,D=Math.abs(i-C),N=Math.abs(o-S),U=Math.sqrt(N*N+D*D);n.push([A,U])}const s=n.sort((A,b)=>A[1]-b[1]),l=[];for(let A=0;A<r;A++)l.push(t[s[A][0]]);const h=[];for(let A=r;A<s.length;A++)h.push(t[s[A][0]]);return[l,h]}function t_e(t){const e=t.getFrustumPlanes(),r=S4(e.near,t.cameraPosition),n=t_(t,r),i=t_(t,t.cameraPosition,R1);let o=0;Gx.planes[o++].fromPointNormal(n,T4.copy(n).subtract(i));for(const s in e){if(s==="near")continue;const l=e[s],h=S4(l,r,R1),A=t_(t,h,R1);Gx.planes[o++].fromPointNormal(A,T4.copy(n).subtract(A))}}function S4(t,e,r=new ft){const n=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-n).add(e),r}function t_(t,e,r=new ft){const n=t.unprojectPosition(e);return wi.WGS84.cartographicToCartesian(n,r)}const r_e=6378137,n_e=6378137,zx=6356752314245179e-9,_p=new ft;function i_e(t,e){if(t instanceof nm){const{halfAxes:r}=t,n=o_e(r);return Math.log2(zx/(n+e[2]))}else if(t instanceof rm){const{radius:r}=t;return Math.log2(zx/(r+e[2]))}else if(t.width&&t.height){const{width:r,height:n}=t,i=Math.log2(r_e/r),o=Math.log2(n_e/n);return(i+o)/2}return 1}function Pk(t,e,r){wi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],_p);const n=Math.sqrt(Math.pow(_p[0]-r[0],2)+Math.pow(_p[1]-r[1],2)+Math.pow(_p[2]-r[2],2));return Math.log2(zx/(n+e[2]))}function s_e(t,e,r){const[n,i,o,s]=t;return Pk({xmax:o,ymax:s,zmax:0},e,r)}function o_e(t){t.getColumn(0,_p);const e=t.getColumn(1),r=t.getColumn(2);return _p.add(e).add(r).len()}const ha={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Tl;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Tl||(Tl={}));var Yc;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Yc||(Yc={}));var jo;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(jo||(jo={}));var Kp;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Kp||(Kp={}));const a_e={USE_OPTIMIZATION:1};function Lk(t){return t!=null}const bo=new ft,r_=new ft,l_e=new ft,c_e=new ft,Hh=new ft,I4=new ft,M4=new ft,P4=new ft;function O1(t,e,r){if(Ai(t,"3D Tile: boundingVolume must be defined"),t.box)return Rk(t.box,e,r);if(t.region)return f_e(t.region);if(t.sphere)return h_e(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function u_e(t,e){if(t.box)return d_e(e);if(t.region){const[r,n,i,o,s,l]=t.region;return[[ml(r),ml(n),s],[ml(i),ml(o),l]]}if(t.sphere)return p_e(e);throw new Error("Unkown boundingVolume type")}function Rk(t,e,r){const n=new ft(t[0],t[1],t[2]);e.transform(n,n);let i=[];if(t.length===10){const A=t.slice(3,6),b=new Eg;b.fromArray(t,6);const C=new ft([1,0,0]),S=new ft([0,1,0]),D=new ft([0,0,1]);C.transformByQuaternion(b),C.scale(A[0]),S.transformByQuaternion(b),S.scale(A[1]),D.transformByQuaternion(b),D.scale(A[2]),i=[...C.toArray(),...S.toArray(),...D.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=e.transformAsVector(i.slice(0,3)),s=e.transformAsVector(i.slice(3,6)),l=e.transformAsVector(i.slice(6,9)),h=new gi([o[0],o[1],o[2],s[0],s[1],s[2],l[0],l[1],l[2]]);return Lk(r)?(r.center=n,r.halfAxes=h,r):new nm(n,h)}function h_e(t,e,r){const n=new ft(t[0],t[1],t[2]);e.transform(n,n);const i=e.getScale(r_),o=Math.max(Math.max(i[0],i[1]),i[2]),s=t[3]*o;return Lk(r)?(r.center=n,r.radius=s,r):new rm(n,s)}function f_e(t){const[e,r,n,i,o,s]=t,l=wi.WGS84.cartographicToCartesian([ml(e),ml(i),o],l_e),h=wi.WGS84.cartographicToCartesian([ml(n),ml(r),s],c_e),A=new ft().addVectors(l,h).multiplyByScalar(.5);return wi.WGS84.cartesianToCartographic(A,Hh),wi.WGS84.cartographicToCartesian([ml(n),Hh[1],Hh[2]],I4),wi.WGS84.cartographicToCartesian([Hh[0],ml(i),Hh[2]],M4),wi.WGS84.cartographicToCartesian([Hh[0],Hh[1],s],P4),Rk([...A,...I4.subtract(A),...M4.subtract(A),...P4.subtract(A)],new bn)}function d_e(t){const e=Ok(),{halfAxes:r}=t,n=new ft(r.getColumn(0)),i=new ft(r.getColumn(1)),o=new ft(r.getColumn(2));for(let s=0;s<2;s++){for(let l=0;l<2;l++){for(let h=0;h<2;h++)bo.copy(t.center),bo.add(n),bo.add(i),bo.add(o),Dk(e,bo),o.negate();i.negate()}n.negate()}return e}function p_e(t){const e=Ok(),{center:r,radius:n}=t,i=wi.WGS84.scaleToGeodeticSurface(r,bo);let o;i?o=wi.WGS84.geodeticSurfaceNormal(i):o=new ft(0,0,1);let s=new ft(o[2],-o[1],0);s.len()>0?s.normalize():s=new ft(0,1,0);const l=s.clone().cross(o);for(const h of[s,l,o]){r_.copy(h).scale(n);for(let A=0;A<2;A++)bo.copy(r),bo.add(r_),Dk(e,bo),r_.negate()}return e}function Ok(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Dk(t,e){wi.WGS84.cartesianToCartographic(e,bo),t[0][0]=Math.min(t[0][0],bo[0]),t[0][1]=Math.min(t[0][1],bo[1]),t[0][2]=Math.min(t[0][2],bo[2]),t[1][0]=Math.max(t[1][0],bo[0]),t[1][1]=Math.max(t[1][1],bo[1]),t[1][2]=Math.max(t[1][2],bo[2])}new ft,new ft,new bn,new ft,new ft,new ft;function A_e(t,e){const r=t*e;return 1-Math.exp(-(r*r))}function g_e(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return A_e(e,r)*n}return 0}function m_e(t,e,r){const n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=r?i:t.lodMetricValue;if(o===0)return 0;const s=Math.max(t._distanceToCamera,1e-7),{height:l,sseDenominator:h}=e,{viewDistanceScale:A}=n.options;let b=o*l*(A||1)/(s*h);return b-=g_e(n,s),b}const D1=new ft,L4=new ft,Gu=new ft,R4=new ft,__e=new ft,F1=new bn,O4=new bn;function y_e(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const r=2*Fk(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function Fk(t,e){const{topDownViewport:r}=e,n=t.header.mbs[1],i=t.header.mbs[0],o=t.header.mbs[2],s=t.header.mbs[3],l=[...t.boundingVolume.center],h=r.unprojectPosition(r.cameraPosition);wi.WGS84.cartographicToCartesian(h,D1),L4.copy(D1).subtract(l).normalize(),wi.WGS84.eastNorthUpToFixedFrame(l,F1),O4.copy(F1).invert(),Gu.copy(D1).transform(O4);const A=Math.sqrt(Gu[0]*Gu[0]+Gu[1]*Gu[1]),b=A*A/Gu[2];R4.copy([Gu[0],Gu[1],b]);const C=R4.transform(F1).subtract(l).normalize(),S=L4.cross(C).normalize().scale(s).add(l),D=wi.WGS84.cartesianToCartographic(S),N=r.project([i,n,o]),U=r.project(D);return __e.copy(N).subtract(U).magnitude()}function b_e(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class D4{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ai(e<this._array.length),this._array[e]}set(e,r){Ai(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){const r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ai(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ai(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const v_e={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class $y{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new D4;_emptyTraversalStack=new D4;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...v_e,...e}}traverse(e,r,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const o=n.pop();let s=!1;this.canTraverse(o,r)&&(this.updateChildTiles(o,r),s=this.updateAndPushChildren(o,r,n,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const l=o.parent,h=!!(!l||l._shouldRefine),A=!s;o.hasRenderContent?o.refine===Tl.ADD?(this.loadTile(o,r),this.selectTile(o,r)):o.refine===Tl.REPLACE&&(this.loadTile(o,r),A&&this.selectTile(o,r)):(this.emptyTiles[o.id]=o,this.loadTile(o,r),A&&this.selectTile(o,r)),this.touchTile(o,r),o._shouldRefine=s&&h}const i=new Date().getTime();(this.traversalFinished(r)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(r))}updateChildTiles(e,r){const n=e.children;for(const i of n)this.updateTile(i,r)}updateAndPushChildren(e,r,n,i){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const h=e.refine===Tl.REPLACE&&e.hasRenderContent&&!s;let A=!1,b=!0;for(const C of l)if(C._selectionDepth=i,C.isVisibleAndInRequestVolume?(n.find(C)&&n.delete(C),n.push(C),A=!0):(h||o)&&(this.loadTile(C,r),this.touchTile(C,r)),h){let S;if(C._inRequestVolume?C.hasRenderContent?S=C.contentAvailable:S=this.executeEmptyTraversal(C,r):S=!1,b=b&&S,!b)return!1}return A||(b=!1),b}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(r,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===r.viewport.id&&n.push(i);else n.push(r.viewport.id);e.updateVisibility(r,n)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let n=!1;for(const i of e.children)i.updateVisibility(r),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,r){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const o=i.pop(),s=!o.hasRenderContent&&this.canTraverse(o,r),l=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!l&&(n=!1),this.updateTile(o,r),o.isVisibleAndInRequestVolume||(this.loadTile(o,r),this.touchTile(o,r)),s){const h=o.children;for(const A of h)i.push(A)}}return n}}const F4=new ft;function x_e(t){return t!=null}class jx{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=ha.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new bn;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new $y({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new bn;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,n,i=""){this.header=r,this.tileset=e,this.id=i||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ha.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ha.UNLOADED}get contentExpired(){return this.contentState===ha.EXPIRED}get contentFailed(){return this.contentState===ha.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=u_e(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case jo.I3S:return Fk(this,e);case jo.TILES3D:return m_e(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,n=this.refine===Tl.ADD||r;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ha.UNLOADED)return-1;const i=this.parent,o=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ha.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=ha.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,i={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await eA(r,n,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ha.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=ha.FAILED,r}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ha.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:pa.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==pa.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,r)}contentVisibility(){return!0}distanceToTile(e){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const r=this.boundingVolume;return F4.subVectors(r.center,e.position),e.direction.dot(F4)}insideViewerRequestVolume(e){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(x_e(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ha.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new bn(e.transform):new bn;const r=this.parent,n=this.tileset,i=r&&r.computedTransform?r.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new bn(i).multiplyRight(this.transform);const o=r&&r._initialTransform?r._initialTransform.clone():new bn;this._initialTransform=new bn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ha.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=pa.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Tl.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=O1(e.boundingVolume,this.computedTransform,this.boundingVolume);const r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=O1(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=O1(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new bn){const r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return b_e(this.tileset.tileset)}}}class w_e extends $y{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const s=e.children[0];this.updateTileVisibility(s,r),e._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}const i=e.refine===Tl.REPLACE,o=e._optimChildrenWithinParent===a_e.USE_OPTIMIZATION;if(i&&o&&n&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==Tl.ADD?!1:!this.shouldRefine(e,r,!0)}}class C_e{frameNumberMap=new Map;register(e,r){const n=this.frameNumberMap.get(e)||new Map,i=n.get(r)||0;n.set(r,i+1),this.frameNumberMap.set(e,n)}deregister(e,r){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(r)||1;n.set(r,i-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}}const k1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class E_e{_statusMap;pendingTilesRegister=new C_e;constructor(){this._statusMap={}}add(e,r,n,i){if(!this._statusMap[r]){const{frameNumber:o,viewport:{id:s}}=i;this._statusMap[r]={request:e,callback:n,key:r,frameState:i,status:k1.REQUESTED},this.pendingTilesRegister.register(s,o),e().then(l=>{this._statusMap[r].status=k1.COMPLETED;const{frameNumber:h,viewport:{id:A}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(A,h),this._statusMap[r].callback(l,i)}).catch(l=>{this._statusMap[r].status=k1.ERROR;const{frameNumber:h,viewport:{id:A}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(A,h),n(l)})}}update(e,r){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:o,viewport:{id:s}}=r;this.pendingTilesRegister.register(s,o),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}}class B_e extends $y{_tileManager;constructor(e){super(e),this._tileManager=new E_e}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=y_e(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){const n=e.header.children||[],i=e.children,o=e.tileset;for(const s of n){const l=`${s.id}-${r.viewport.id}`,h=i&&i.find(A=>A.id===l);if(h)h&&this.updateTile(h,r);else{let A=()=>this._loadTile(s.id,o);this._tileManager.find(l)?this._tileManager.update(l,r):(o.tileset.nodePages&&(A=()=>o.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(A,l,b=>this._onTileLoad(b,e,l),r))}}return!1}async _loadTile(e,r){const{loader:n}=r,i=r.getTileUrl(`${r.url}/nodes/${e}`),o={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await eA(i,n,o)}_onTileLoad(e,r,n){const i=new jx(r.tileset,e,r,n);r.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const T_e={description:"",ellipsoid:wi.WGS84,modelMatrix:new bn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},E0="Tiles In Tileset(s)",N1="Tiles In Memory",k4="Tiles In View",N4="Tiles To Render",U4="Tiles Loaded",U1="Tiles Loading",G4="Tiles Unloaded",z4="Failed Tile Loads",j4="Points/Vertices",G1="Tile Memory Use",H4="Maximum Screen Space Error";class S_e{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new $0e;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...T_e,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||F8(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new D8({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Y6({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let r=e;return this.queryParams.length&&(r=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),r}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const n=[];for(const i of r){const o=i.id;this._needTraverse(o)?n.push(o):this.traverseCounter--}for(const i of r){const o=i.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!n.includes(o))continue;const s=Y0e(i,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){const r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[r],i=Object.values(this._traverser.selectedTiles),[o,s]=e_e(i,e,this.options.maximumTilesSelected);n.selectedTiles=o;for(const l of s)l.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;const n=new Set(e.map(s=>s.id)),i=new Set(r.map(s=>s.id));let o=e.filter(s=>!i.has(s.id)).length>0;return o=o||r.filter(s=>!n.has(s.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?r+=n.content.pointCount:r+=n.content.vertexCount);this.stats.get(k4).count=this.selectedTiles.length,this.stats.get(N4).count=e,this.stats.get(j4).count=r,this.stats.get(H4).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===jo.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===jo.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===jo.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:n,xmax:i,ymin:o,ymax:s,zmin:l,zmax:h}=e;this.cartographicCenter=new ft(n+(i-n)/2,o+(s-o)/2,l+(h-l)/2),this.cartesianCenter=new ft,wi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Pk(e,this.cartographicCenter,this.cartesianCenter);return}const r=this.tileset.store?.extent;if(r){const[n,i,o,s]=r;this.cartographicCenter=new ft(n+(o-n)/2,i+(s-i)/2,0),this.cartesianCenter=new ft,wi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=s_e(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ft,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ft,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new ft,wi.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new ft(0,0,-wi.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=i_e(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(E0),this.stats.get(U1),this.stats.get(N1),this.stats.get(k4),this.stats.get(N4),this.stats.get(U4),this.stats.get(G4),this.stats.get(z4),this.stats.get(j4),this.stats.get(G1,"memory"),this.stats.get(H4)}_initializeTileHeaders(e,r){const n=new jx(this,e.root,r);if(r&&(r.children.push(n),n.depth=r.depth+1),this.type===jo.TILES3D){const i=[];for(i.push(n);i.length>0;){const o=i.pop();this.stats.get(E0).incrementCount();const s=o.header.children||[];for(const l of s){const h=new jx(this,l,o);if(h.contentUrl?.includes("?session=")){const A=new URL(h.contentUrl).searchParams.get("session");A&&(this._queryParams.session=A)}o.children.push(h),h.depth=o.depth+1,i.push(h)}}}return n}_initializeTraverser(){let e;switch(this.type){case jo.TILES3D:e=w_e;break;case jo.I3S:e=B_e;break;default:e=$y}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(z4).incrementCount();const n=r.message||r.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,r){if(r){if(this.type===jo.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(E0).reset(),this.stats.get(E0).addCount(n)}e&&e.content&&q0e(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===jo.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===jo.TILES3D){const{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(U1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(U1).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(U4).incrementCount(),this.stats.get(N1).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(G1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(N1).decrementCount(),this.stats.get(G4).incrementCount(),this.stats.get(G1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const r=e.pop();for(const n of r.children)e.push(n);this._destroyTile(r)}this.root=null}_destroySubtree(e){const r=e,n=[];for(n.push(r);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const r=new URLSearchParams(e.queryString),n=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const kk="4.3.1",WA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function Nk(t,e,r){Ai(t instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}function I_e(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}const M_e={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ds={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Gn={...M_e,...ds},z1={[ds.DOUBLE]:Float64Array,[ds.FLOAT]:Float32Array,[ds.UNSIGNED_SHORT]:Uint16Array,[ds.UNSIGNED_INT]:Uint32Array,[ds.UNSIGNED_BYTE]:Uint8Array,[ds.BYTE]:Int8Array,[ds.SHORT]:Int16Array,[ds.INT]:Int32Array},P_e={DOUBLE:ds.DOUBLE,FLOAT:ds.FLOAT,UNSIGNED_SHORT:ds.UNSIGNED_SHORT,UNSIGNED_INT:ds.UNSIGNED_INT,UNSIGNED_BYTE:ds.UNSIGNED_BYTE,BYTE:ds.BYTE,SHORT:ds.SHORT,INT:ds.INT},j1="Failed to convert GL type";class cc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const r in z1)if(z1[r]===e)return r;throw new Error(j1)}static fromName(e){const r=P_e[e];if(!r)throw new Error(j1);return r}static getArrayType(e){switch(e){case ds.UNSIGNED_SHORT_5_6_5:case ds.UNSIGNED_SHORT_4_4_4_4:case ds.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=z1[e];if(!r)throw new Error(j1);return r}}static getByteSize(e){return cc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!cc.getArrayType(e)}static createTypedArray(e,r,n=0,i){i===void 0&&(i=(r.byteLength-n)/cc.getByteSize(e));const o=cc.getArrayType(e);return new o(r,n,i)}}function L_e(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function R_e(t,e=[0,0,0]){const r=t>>11&31,n=t>>5&63,i=t&31;return e[0]=r<<3,e[1]=n<<2,e[2]=i<<3,e}new nv,new ft,new nv,new nv;function V4(t,e=255){return $c(t,0,e)/e*2-1}function W4(t){return t<0?-1:1}function O_e(t,e,r,n){if(L_e(n),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=V4(t,r),n.y=V4(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*W4(i),n.y=(1-Math.abs(i))*W4(n.y)}return n.normalize()}function D_e(t,e,r){return O_e(t,e,255,r)}class dE{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=Gn.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,r,n,1,i.byteOffset):i}getPropertyArray(e,r,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(r=cc.fromName(i.componentType)),this._getTypedArrayFromBinary(e,r,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,r,i)}getProperty(e,r,n,i,o){const s=this.json[e];if(!s)return s;const l=this.getPropertyArray(e,r,n);if(n===1)return l[i];for(let h=0;h<n;++h)o[h]=l[n*i+h];return o}_getTypedArrayFromBinary(e,r,n,i,o){const s=this._cachedTypedArrays;let l=s[e];return l||(l=cc.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+o,i*n),s[e]=l),l}_getTypedArrayFromArray(e,r,n){const i=this._cachedTypedArrays;let o=i[e];return o||(o=cc.createTypedArray(r,n),i[e]=o),o}}const F_e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k_e={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},N_e={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function U_e(t,e,r,n){const{componentType:i}=t;Ai(t.componentType);const o=typeof i=="string"?cc.fromName(i):i,s=F_e[t.type],l=k_e[t.type],h=N_e[t.type];return r+=t.byteOffset,{values:cc.createTypedArray(o,e,r,s*n),type:o,size:s,unpacker:l,packer:h}}const ac=t=>t!==void 0;function G_e(t,e,r){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?z_e(n,r):null}function z_e(t,e){let r,n,i;const o=t.instancesLength,s=t.classes;let l=t.classIds,h=t.parentCounts,A=t.parentIds,b=o;ac(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,o));let C;if(ac(h))for(ac(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,o)),C=new Uint16Array(o),b=0,r=0;r<o;++r)C[r]=b,b+=h[r];ac(A)&&ac(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,i=getBinaryAccessor(A),A=i.createArrayBufferView(e.buffer,e.byteOffset+A.byteOffset,b));const S=s.length;for(r=0;r<S;++r){const V=s[r].length,j=s[r].instances,ee=getBinaryProperties(V,j,e);s[r].instances=combine(ee,j)}const D=new Array(S).fill(0),N=new Uint16Array(o);for(r=0;r<o;++r)n=l[r],N[r]=D[n],++D[n];const U={classes:s,classIds:l,classIndexes:N,parentCounts:h,parentIndexes:C,parentIds:A};return V_e(U),U}function JA(t,e,r){if(!t)return;const n=t.parentCounts;return t.parentIds?r(t,e):n>0?j_e(t,e,r):H_e(t,e,r)}function j_e(t,e,r){const n=t.classIds,i=t.parentCounts,o=t.parentIds,s=t.parentIndexes,l=n.length,h=scratchVisited;h.length=Math.max(h.length,l);const A=++marker,b=scratchStack;for(b.length=0,b.push(e);b.length>0;){if(e=b.pop(),h[e]===A)continue;h[e]=A;const C=r(t,e);if(ac(C))return C;const S=i[e],D=s[e];for(let N=0;N<S;++N){const U=o[D+N];U!==e&&b.push(U)}}return null}function H_e(t,e,r){let n=!0;for(;n;){const i=r(t,e);if(ac(i))return i;const o=t.parentIds[e];n=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function V_e(t){const e=t.classIds.length;for(let r=0;r<e;++r)Uk(t,r,stack)}function Uk(t,e,r){const n=t.parentCounts,i=t.parentIds,o=t.parentIndexes,s=t.classIds.length;if(!ac(i))return;assert(e<s,`Parent index ${e} exceeds the total number of instances: ${s}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);const l=ac(n)?n[e]:1,h=ac(n)?o[e]:e;for(let A=0;A<l;++A){const b=i[h+A];b!==e&&Uk(t,b,r)}r.pop(e)}function Go(t){return t!=null}const B0=(t,e)=>t,W_e={HIERARCHY:!0,extensions:!0,extras:!0};class Gk{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,n,i={}){Ai(n>=0),this.json=e||{},this.binary=r,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const o in this.json)W_e[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=G_e(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Ai(typeof r=="string",r),this._hierarchy){const n=JA(this._hierarchy,e,(i,o)=>{const s=i.classIds[o];return i.classes[s].name===r});return Go(n)}return!1}isExactClass(e,r){return Ai(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Ai(typeof r=="string",r),Go(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=Go(r)?r:[],r.length=0;const n=Object.keys(this._properties);return r.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Ai(typeof r=="string",r),this._binaryProperties){const i=this._binaryProperties[r];if(Go(i))return this._getBinaryProperty(i,e)}const n=this._properties[r];if(Go(n))return B0(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,r);if(Go(i))return i}}setProperty(e,r,n){const i=this.featureCount;if(this._checkBatchId(e),Ai(typeof r=="string",r),this._binaryProperties){const s=this._binaryProperties[r];if(s){this._setBinaryProperty(s,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,n))return;let o=this._properties[r];Go(o)||(this._properties[r]=new Array(i),o=this._properties[r]),o[e]=B0(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,n){e.pack(n,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(const r in this._properties){const n=this._properties[r],i=this._initializeBinaryProperty(r,n);i&&(e=e||{},e[r]=i)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){const n=r;Ai(this.binary,`Property ${e} requires a batch table binary.`),Ai(n.type,`Property ${e} requires a type.`);const i=U_e(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;const n=JA(this._hierarchy,e,(i,o)=>{const s=i.classIds[o],l=i.classes[s].instances;return Go(l[r])});return Go(n)}_getPropertyNamesInHierarchy(e,r){JA(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o].instances;for(const l in s)s.hasOwnProperty(l)&&r.indexOf(l)===-1&&r.push(l)})}_getHierarchyProperty(e,r){return JA(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o],l=n.classIndexes[i],h=s.instances[r];return Go(h)?Go(h.typedArray)?this._getBinaryProperty(h,l):B0(h[l]):null})}_setHierarchyProperty(e,r,n,i){const o=JA(this._hierarchy,r,(s,l)=>{const h=s.classIds[l],A=s.classes[h],b=s.classIndexes[l],C=A.instances[n];return Go(C)?(Ai(l===r,`Inherited property "${n}" is read-only.`),Go(C.typedArray)?this._setBinaryProperty(C,b,i):C[b]=B0(i),!0):!1});return Go(o)}}const H1=4;function qy(t,e,r=0){const n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=H1,t.version=n.getUint32(r,!0),r+=H1,t.byteLength=n.getUint32(r,!0),r+=H1,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const Ud=4,J4="b3dm tile in legacy format.";function pE(t,e,r){const n=new DataView(e);let i;t.header=t.header||{};let o=n.getUint32(r,!0);r+=Ud;let s=n.getUint32(r,!0);r+=Ud;let l=n.getUint32(r,!0);r+=Ud;let h=n.getUint32(r,!0);return r+=Ud,l>=570425344?(r-=Ud*2,i=o,l=s,h=0,o=0,s=0,console.warn(J4)):h>=570425344&&(r-=Ud,i=l,l=o,h=s,o=0,s=0,console.warn(J4)),t.header.featureTableJsonByteLength=o,t.header.featureTableBinaryByteLength=s,t.header.batchTableJsonByteLength=l,t.header.batchTableBinaryByteLength=h,t.header.batchLength=i,r}function AE(t,e,r,n){return r=J_e(t,e,r),r=K_e(t,e,r),r}function J_e(t,e,r,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:o,batchLength:s}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:s||0},i&&i>0){const l=Nk(e,r,i);t.featureTableJson=JSON.parse(l)}return r+=i||0,t.featureTableBinary=new Uint8Array(e,r,o),r+=o||0,r}function K_e(t,e,r,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:o}=t.header||{};if(i&&i>0){const s=Nk(e,r,i);t.batchTableJson=JSON.parse(s),r+=i,o&&o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}function zk(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;const{batchIds:n,isRGB565:i,pointCount:o=0}=t;if(n&&r){const s=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const h=n[l],A=r.getProperty(h,"dimensions").map(b=>b*255);s[l*3]=A[0],s[l*3+1]=A[1],s[l*3+2]=A[2]}return{type:Gn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(e&&i){const s=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const h=R_e(e[l]);s[l*3]=h[0],s[l*3+1]=h[1],s[l*3+2]=h[2]}return{type:Gn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return e&&e.length===o*3?{type:Gn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Gn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const K4=new ft;function X_e(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array((t.pointsLength||0)*3);for(let n=0;n<(t.pointsLength||0);n++)D_e(e[n*2],e[n*2+1],K4),K4.toArray(r,n*3);return{type:Gn.FLOAT,size:2,value:r}}return{type:Gn.FLOAT,size:2,value:e}}function Q_e(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Z_e(t,e)):{type:Gn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Z_e(t,e){const r=new ft,n=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)r.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,i*3);return n}async function $_e(t,e,r,n,i){r=qy(t,e,r),r=pE(t,e,r),r=AE(t,e,r),q_e(t);const{featureTable:o,batchTable:s}=Y_e(t);return await iye(t,o,s,n,i),eye(t,o,n),tye(t,o,s),rye(t,o),r}function q_e(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Y_e(t){const e=new dE(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3);const n=nye(t,e);return{featureTable:e,batchTable:n}}function eye(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Gn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Gn.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Gn.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Gn.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Q_e(t,n,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function tye(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Gn.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Gn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Gn.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=zk(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Gn.UNSIGNED_BYTE,4))}function rye(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",Gn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",Gn.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=X_e(t,r)}}function nye(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Gn.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:o}=t;r=new Gk(i,o,n)}return r}async function iye(t,e,r,n,i){let o,s,l;const h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(l=h.properties);const A=e.getExtension("3DTILES_draco_point_compression");if(A){s=A.properties;const C=A.byteOffset,S=A.byteLength;if(!s||!Number.isFinite(C)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(t.featureTableBinary||[]).slice(C,C+S),t.hasPositions=Number.isFinite(s.POSITION),t.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),t.hasNormals=Number.isFinite(s.NORMAL),t.hasBatchIds=Number.isFinite(s.BATCH_ID),t.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const b={buffer:o,properties:{...s,...l},batchTableProperties:l};return await sye(t,b,n,i)}async function sye(t,e,r,n){if(!n)return;const i={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const o=await Tf(e.buffer,fE,i,n),s=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,A=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,b=s&&o.attributes.POSITION.value.quantization,C=h&&o.attributes.NORMAL.value.quantization;if(b){const D=o.POSITION.data.quantization,N=D.range;t.quantizedVolumeScale=new ft(N,N,N),t.quantizedVolumeOffset=new ft(D.minValues),t.quantizedRange=(1<<D.quantizationBits)-1,t.isQuantizedDraco=!0}C&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const S={};if(e.batchTableProperties)for(const D of Object.keys(e.batchTableProperties))o.attributes[D]&&o.attributes[D].value&&(S[D.toLowerCase()]=o.attributes[D].value);t.attributes={positions:s,colors:zk(t,l,void 0),normals:h,batchIds:A,...S}}function ga(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const jk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hk={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},oye=1.33,X4=["SCALAR","VEC2","VEC3","VEC4"],aye=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],lye=new Map(aye),cye={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uye={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},hye={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Vk(t){return X4[t-1]||X4[0]}function Yy(t){const e=lye.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function gE(t,e){const r=hye[t.componentType],n=cye[t.type],i=uye[t.componentType],o=t.count*n,s=t.count*n*i;ga(s>=0&&s<=e.byteLength);const l=Hk[t.componentType],h=jk[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:l,numberOfComponentsInElement:h}}function Wk(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];const n=e.map(s=>s.bufferView);r=r.filter(s=>!n.includes(s));const i=r.reduce((s,l)=>s+l.byteLength,0),o=e.reduce((s,l)=>{const{width:h,height:A}=l.image;return s+h*A},0);return i+Math.ceil(4*o*oye)}function fye(t,e,r){const n=t.bufferViews[r];ga(n);const i=n.buffer,o=e[i];ga(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function dye(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],l=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:h,length:A,componentByteSize:b,numberOfComponentsInElement:C}=gE(n,i),S=b*C,D=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new h(o,l,A);const N=new h(A);for(let U=0;U<n.count;U++){const V=new h(o,l+U*D,C);N.set(V,U*C)}return N}function pye(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Us{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||pye(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof r=="string"||typeof n=="string"}getExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return r?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const n=this.json[e]&&this.json[e][r];if(!n)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,n=this.gltf.buffers[r];ga(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return dye(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),n=this.getBuffer(r.buffer).data,i=r.byteOffset||0;return new Uint8Array(n,i,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,n){return e.extensions=e.extensions||{},e.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(e,r,n){const i=e.extensions||{};i[r]=n}removeObjectExtension(e,r){const n=e?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(r)||i.push(r)}delete n[r]}addExtension(e,r={}){return ga(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return ga(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:r};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:n,material:i,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(n){const l=this._addIndices(n);s.primitives[0].indices=l}return Number.isFinite(i)&&(s.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,r){const n=jy(e),i=r||n?.mimeType,o={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,r=0,n=this.byteLength){const i=e.byteLength;ga(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:r,byteOffset:n,byteLength:i};return this.byteLength+=au(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){const n={bufferView:e,type:Vk(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const n=this.addBufferView(e);let i={min:r.min,max:r.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,r.size));const o={size:r.size,componentType:Yy(e),count:Math.round(e.length/r.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,r))}addTexture(e){const{imageIndex:r}=e,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,r=new ArrayBuffer(e),n=new Uint8Array(r);let i=0;for(const o of this.sourceBuffers||[])i=O8(o,n,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let n=!0;for(;n;){const i=e.indexOf(r);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const r={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);r[o]=s}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const n={min:null,max:null};if(e.length<r)return n;n.min=[],n.max=[];const i=e.subarray(0,r);for(const o of i)n.min.push(o),n.max.push(o);for(let o=r;o<e.length;o+=r)for(let s=0;s<r;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}}function Q4(t){return(t%1+1)%1}const Jk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Aye={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Kk={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function mE(t,e){return Kk[e]*Jk[t]}function eb(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=tb(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function tb(t,e,r,n=1){const i=Jk[e],o=Aye[r],s=Kk[r],l=n*i,h=l*s;let A=t.buffer,b=t.byteOffset;return b%s!==0&&(A=new Uint8Array(A).slice(b,b+h).buffer,b=0),new o(A,b,l)}function _E(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,l=e.index,h=s.textures?.[l]?.source;if(typeof h<"u"){const A=s.images?.[h]?.mimeType,b=t.gltf.images?.[h];if(b&&typeof b.width<"u"){const C=[];for(let S=0;S<o.length;S+=2){const D=gye(b,A,o,S,e.channels);C.push(D)}return C}}return[]}function Xk(t,e,r,n,i){if(!r?.length)return;const o=[];for(const b of r){let C=n.findIndex(S=>S===b);C===-1&&(C=n.push(b)-1),o.push(C)}const s=new Uint32Array(o),l=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,h=t.addBufferView(s,l,0),A=t.addAccessor(h,{size:1,componentType:Yy(s),count:s.length});i.attributes[e]=A}function gye(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],l=r[n+1];let h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);const A=mye(s,l,t,h);let b=0;for(const C of i){const S=typeof C=="number"?Object.values(o)[C]:o[C],D=A+S.offset,N=WC(t);if(N.data.length<=D)throw new Error(`${N.data.length} <= ${D}`);const U=N.data[D];b|=U<<S.shift}return b}function mye(t,e,r,n=1){const i=r.width,o=Q4(t)*(i-1),s=Math.round(o),l=r.height,h=Q4(e)*(l-1),A=Math.round(h),b=r.components?r.components:n;return(A*i+s)*b}function Qk(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const l=r[s],h=r[s+1]-r[s];if(h+l>n)break;const A=l/i,b=h/i;o.push(t.slice(A,A+b))}return o}function Zk(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function $k(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let l=0;l<t;l++){const h=n[l+1]-n[l];if(h+s<=e.length){const A=e.subarray(s,h+s),b=o.decode(A);i.push(b),s+=h}}return i}return[]}const Mp="EXT_mesh_features",_ye=Mp;async function yye(t,e){const r=new Us(t);vye(r,e)}function bye(t,e){const r=new Us(t);return wye(r),r.createBinaryChunk(),r.gltf}function vye(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)xye(t,i,e)}function xye(t,e,r){if(!r?.gltf?.loadBuffers)return;const n=e.extensions?.[Mp]?.featureIds;if(n)for(const i of n){let o;if(typeof i.attribute<"u"){const s=`_FEATURE_ID_${i.attribute}`,l=e.attributes[s];o=t.getTypedArrayForAccessor(l)}else typeof i.texture<"u"&&r?.gltf?.loadImages?o=_E(t,i.texture,e):o=[];i.data=o}}function wye(t,e){const r=t.gltf.json.meshes;if(r)for(const n of r)for(const i of n.primitives)Eye(t,i)}function Cye(t,e,r,n){e.extensions||(e.extensions={});let i=e.extensions[Mp];i||(i={featureIds:[]},e.extensions[Mp]=i);const{featureIds:o}=i,s={featureCount:r.length,propertyTable:n,data:r};o.push(s),t.addObjectExtension(e,Mp,i)}function Eye(t,e){const r=e.extensions?.[Mp];if(!r)return;const n=r.featureIds;n.forEach((i,o)=>{if(i.data){const{accessorKey:s,index:l}=Bye(e.attributes),h=new Uint32Array(i.data);n[o]={featureCount:h.length,propertyTable:i.propertyTable,attribute:l},t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=t.addBufferView(h),b=t.addAccessor(A,{size:1,componentType:Yy(h),count:h.length});e.attributes[s]=b}})}function Bye(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(i=>i.indexOf(e)===0);let n=-1;for(const i of r){const o=Number(i.substring(e.length));o>n&&(n=o)}return n++,{accessorKey:`${e}${n}`,index:n}}const Tye=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Cye,decode:yye,encode:bye,name:_ye},Symbol.toStringTag,{value:"Module"})),Xp="EXT_structural_metadata",Sye=Xp;async function Iye(t,e){const r=new Us(t);Pye(r,e)}function Mye(t,e){const r=new Us(t);return Kye(r),r.createBinaryChunk(),r.gltf}function Pye(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(Xp);r&&(e.gltf?.loadImages&&Lye(t,r),Rye(t,r))}function Lye(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)Dye(t,r,o,e)}function Rye(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=Oye(i,o);s&&kye(t,r,s)}}function Oye(t,e){for(const r of t)if(r.class===e)return r;return null}function Dye(t,e,r,n){if(!e)return;const i=r.extensions?.[Xp]?.propertyTextures;if(i)for(const o of i){const s=e[o];Fye(t,s,r,n)}}function Fye(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,l=e.properties?.[o];if(!l)continue;l.data||(l.data=[]);const h=l.data,A=_E(t,l,r);A!==null&&(Xk(t,s,A,h,r),l.data=h,n.dataAttributeNames.push(s))}}function kye(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=Nye(t,e,s,i,l);l.data=h}}}function Nye(t,e,r,n,i){let o=[];const s=i.values,l=t.getTypedArrayForBufferView(s),h=Uye(t,r,i,n),A=Gye(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=zye(r,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=$k(n,l,h,A);break}case"ENUM":{o=jye(e,r,n,l,h);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function Uye(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?eb(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function Gye(t,e,r){return typeof e.stringOffsets<"u"?eb(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function zye(t,e,r,n){const i=t.array,o=t.count,s=mE(t.type,t.componentType),l=r.byteLength/s;let h;return t.componentType?h=tb(r,t.type,t.componentType,l):h=r,i?n?Qk(h,e,n,r.length,s):o?Zk(h,e,o):[]:h}function jye(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=s.valueType||"UINT16",h=mE(e.type,l),A=n.byteLength/h;let b=tb(n,e.type,l,A);if(b||(b=n),e.array){if(i)return Hye({valuesData:b,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:h,enumEntry:s});const C=e.count;return C?Vye(b,r,C,s):[]}return yE(b,0,r,s)}function Hye(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,l=[];for(let h=0;h<r;h++){const A=n[h],b=n[h+1]-n[h];if(b+A>i)break;const C=A/o,S=b/o,D=yE(e,C,S,s);l.push(D)}return l}function Vye(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,l=yE(t,s,r,n);i.push(l)}return i}function yE(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],l=Wye(n,s);l?i.push(l.name):i.push("")}return i}function Wye(t,e){for(const r of t.values)if(r.value===e)return r;return null}const Jye="schemaClassId";function Kye(t,e){const r=t.getExtension(Xp);if(r&&r.propertyTables)for(const n of r.propertyTables){const i=n.class,o=r.schema?.classes?.[i];n.properties&&o&&Xye(n,o,t)}}function Xye(t,e,r){for(const n in t.properties){const i=t.properties[n].data;if(i){const o=e.properties[n];if(o){const s=qye(i,o,r);t.properties[n]=s}}}}function Qye(t,e,r=Jye){let n=t.getExtension(Xp);n||(n=t.addExtension(Xp)),n.schema=Zye(e,r,n.schema);const i=$ye(e,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function Zye(t,e,r){const n=r??{id:"schema_id"},i={properties:{}};for(const o of t){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function $ye(t,e,r){const n={class:e,count:0};let i=0;const o=r.classes?.[e];for(const s of t){if(i===0&&(i=s.values.length),i!==s.values.length&&s.values.length)throw new Error("Illegal values in attributes");o?.properties[s.name]&&(n.properties||(n.properties={}),n.properties[s.name]={values:0,data:s.values})}return n.count=i,n}function qye(t,e,r){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=tbe(t);n.stringOffsets=V1(o,r),n.values=V1(i,r)}else if(e.type==="SCALAR"&&e.componentType){const i=ebe(t,e.componentType);n.values=V1(i,r)}return n}const Yye={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function ebe(t,e){const r=[];for(const i of t)r.push(Number(i));const n=Yye[e];if(!n)throw new Error("Illegal component type");return new n(r)}function tbe(t){const e=new TextEncoder,r=[];let n=0;for(const h of t){const A=e.encode(h);n+=A.length,r.push(A)}const i=new Uint8Array(n),o=[];let s=0;for(const h of r)i.set(h,s),o.push(s),s+=h.length;o.push(s);const l=new Uint32Array(o);return{stringData:i,stringOffsets:l}}function V1(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const rbe=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Qye,decode:Iye,encode:Mye,name:Sye},Symbol.toStringTag,{value:"Module"})),qk="EXT_feature_metadata",nbe=qk;async function ibe(t,e){const r=new Us(t);sbe(r,e)}function sbe(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(qk);r&&(e.gltf?.loadImages&&obe(t,r),abe(t,r))}function obe(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],l=cbe(i,o);l&&hbe(t,l,s)}}function abe(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=lbe(i,o);s&&ube(t,r,s)}}function lbe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function cbe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function ube(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],l=r.properties?.[o];if(l){const h=fbe(t,e,s,i,l);l.data=h}}}function hbe(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=mbe(t,o,n);o.data=s}}}function fbe(t,e,r,n,i){let o=[];const s=i.bufferView,l=t.getTypedArrayForBufferView(s),h=dbe(t,r,i,n),A=pbe(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=$k(n,l,h,A):Abe(r)&&(o=gbe(r,n,l,h)),o}function dbe(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?eb(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function pbe(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?eb(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function Abe(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function gbe(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",l=t.componentType||t.type,h=mE(s,l),A=r.byteLength/h,b=tb(r,s,l,A);return i?n?Qk(b,e,n,r.length,h):o?Zk(b,e,o):[]:b}function mbe(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)_be(t,r,e,i,s);return i}function _be(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=_E(t,o,i);s&&Xk(t,e,s,n,i)}const ybe=Object.freeze(Object.defineProperty({__proto__:null,decode:ibe,name:nbe},Symbol.toStringTag,{value:"Module"})),bbe="4.3.1",Qp=!0,Z4=1735152710,bE=12,oy=8,vbe=1313821514,xbe=5130562,wbe=0,Cbe=0,Ebe=1;function Bbe(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function Tbe(t,e=0,r={}){const n=new DataView(t),{magic:i=Z4}=r,o=n.getUint32(e,!1);return o===i||o===Z4}function Sbe(t,e,r=0,n={}){const i=new DataView(e),o=Bbe(i,r+0),s=i.getUint32(r+4,Qp),l=i.getUint32(r+8,Qp);switch(Object.assign(t,{header:{byteOffset:r,byteLength:l,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=bE,t.version){case 1:return Ibe(t,i,r);case 2:return Mbe(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function Ibe(t,e,r){Ai(t.header.byteLength>bE+oy);const n=e.getUint32(r+0,Qp),i=e.getUint32(r+4,Qp);return r+=oy,Ai(i===wbe),Hx(t,e,r,n),r+=n,r+=Vx(t,e,r,t.header.byteLength),r}function Mbe(t,e,r,n){return Ai(t.header.byteLength>bE+oy),Pbe(t,e,r,n),r+t.header.byteLength}function Pbe(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,Qp),o=e.getUint32(r+4,Qp);switch(r+=oy,o){case vbe:Hx(t,e,r,i);break;case xbe:Vx(t,e,r,i);break;case Cbe:n.strict||Hx(t,e,r,i);break;case Ebe:n.strict||Vx(t,e,r,i);break}r+=au(i,4)}return r}function Hx(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),au(n,4)}function Vx(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),au(n,4)}function Yk(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const Lbe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Rbe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Obe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Dbe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Fbe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},kbe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Nbe(t,e,r,n,i,o="NONE"){const s=await Ube();jbe(s,s.exports[kbe[i]],t,e,r,n,s.exports[Fbe[o||"NONE"]])}let W1;async function Ube(){return W1||(W1=Gbe()),W1}async function Gbe(){let t=Lbe;WebAssembly.validate(Obe)&&(t=Rbe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(zbe(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function zbe(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?Dbe[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function jbe(t,e,r,n,i,o,s){const l=t.exports.sbrk,h=n+3&-4,A=l(h*i),b=l(o.length),C=new Uint8Array(t.exports.memory.buffer);C.set(o,b);const S=e(A,n,i,b,o.length);if(S===0&&s&&s(A,h,i),r.set(C.subarray(A,A+n*i)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const ay="EXT_meshopt_compression",Hbe=ay;async function Vbe(t,e){const r=new Us(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(Wbe(r,i));await Promise.all(n),r.removeExtension(ay)}async function Wbe(t,e){const r=t.getObjectExtension(e,ay);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:l,filter:h="NONE",buffer:A}=r,b=t.gltf.buffers[A],C=new Uint8Array(b.arrayBuffer,b.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Nbe(S,s,o,C,l,h),t.removeObjectExtension(e,ay)}}const Jbe=Object.freeze(Object.defineProperty({__proto__:null,decode:Vbe,name:Hbe},Symbol.toStringTag,{value:"Module"})),np="EXT_texture_webp",Kbe=np;function Xbe(t,e){const r=new Us(t);if(!z8("image/webp")){if(r.getRequiredExtensions().includes(np))throw new Error(`gltf: Required extension ${np} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,np);o&&(i.source=o.source),r.removeObjectExtension(i,np)}r.removeExtension(np)}const Qbe=Object.freeze(Object.defineProperty({__proto__:null,name:Kbe,preprocess:Xbe},Symbol.toStringTag,{value:"Module"})),n_="KHR_texture_basisu",Zbe=n_;function $be(t,e){const r=new Us(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,n_);o&&(i.source=o.source,r.removeObjectExtension(i,n_))}r.removeExtension(n_)}const qbe=Object.freeze(Object.defineProperty({__proto__:null,name:Zbe,preprocess:$be},Symbol.toStringTag,{value:"Module"}));function Ybe(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=e5(n);e[r]=i}}return e}function e5(t){const{buffer:e,size:r,count:n}=eve(t);return{value:e,size:r,byteOffset:0,count:n,type:Vk(r),componentType:Yy(e)}}function eve(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=tve(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function tve(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const ch="KHR_draco_mesh_compression",rve=ch;function nve(t,e,r){const n=new Us(t);for(const i of t5(n))n.getObjectExtension(i,ch)}async function ive(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new Us(t),i=[];for(const o of t5(n))n.getObjectExtension(o,ch)&&i.push(ove(n,o,e,r));await Promise.all(i),n.removeExtension(ch)}function sve(t,e={}){const r=new Us(t);for(const n of r.json.meshes||[])ave(n),r.addRequiredExtension(ch)}async function ove(t,e,r,n){const i=t.getObjectExtension(e,ch);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=em(o.buffer,o.byteOffset),l={...r};delete l["3d-tiles"];const h=await Tf(s,fE,l,n),A=Ybe(h.attributes);for(const[b,C]of Object.entries(A))if(b in e.attributes){const S=e.attributes[b],D=t.getAccessor(S);D?.min&&D?.max&&(C.min=D.min,C.max=D.max)}e.attributes=A,h.indices&&(e.indices=e5(h.indices)),t.removeObjectExtension(e,ch),lve(e)}function ave(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),l=n._addFauxAttributes(s.attributes),h=n.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[ch]:{bufferView:h,attributes:l}}}]}}function lve(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*t5(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const cve=Object.freeze(Object.defineProperty({__proto__:null,decode:ive,encode:sve,name:rve,preprocess:nve},Symbol.toStringTag,{value:"Module"})),rb="KHR_texture_transform",uve=rb,T0=new ft,hve=new gi,fve=new gi;async function dve(t,e){if(!new Us(t).hasExtension(rb)||!e.gltf?.loadBuffers)return;const r=t.json.materials||[];for(let n=0;n<r.length;n++)pve(n,t)}function pve(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[rb]&&Ave(e,t,o,i)}function Ave(t,e,r,n){const i=gve(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const l of s.primitives){const h=l.material;Number.isFinite(h)&&e===h&&mve(t,l,i)}}function gve(t,e){const r=t.extensions?.[rb],{texCoord:n=0}=t,{texCoord:i=n}=r;if(e.findIndex(([o,s])=>o===n&&s===i)===-1){const o=bve(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:o}}return null}function mve(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const l=t.json.accessors?.[s];if(l&&l.bufferView){const h=t.json.bufferViews?.[l.bufferView];if(h){const{arrayBuffer:A,byteOffset:b}=t.buffers[h.buffer],C=(b||0)+(l.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:D}=gE(l,h),N=Hk[l.componentType],U=jk[l.type],V=h.byteStride||N*U,j=new Float32Array(D);for(let ee=0;ee<l.count;ee++){const Q=new S(A,C+ee*V,2);T0.set(Q[0],Q[1],1),T0.transformByMatrix3(o),j.set([T0[0],T0[1]],ee*U)}n===i?_ve(l,h,t.buffers,j):yve(i,l,e,t,j)}}}}function _ve(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function yve(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function bve(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new gi().set(1,0,0,0,1,0,e[0],e[1],1),o=hve.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=fve.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const vve=Object.freeze(Object.defineProperty({__proto__:null,decode:dve,name:uve},Symbol.toStringTag,{value:"Module"})),tf="KHR_lights_punctual",xve=tf;async function wve(t){const e=new Us(t),{json:r}=e,n=e.getExtension(tf);n&&(e.json.lights=n.lights,e.removeExtension(tf));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,tf);o&&(i.light=o.light),e.removeObjectExtension(i,tf)}}async function Cve(t){const e=new Us(t),{json:r}=e;if(r.lights){const n=e.addExtension(tf);ga(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,tf,n)}delete e.json.lights}}const Eve=Object.freeze(Object.defineProperty({__proto__:null,decode:wve,encode:Cve,name:xve},Symbol.toStringTag,{value:"Module"})),Hg="KHR_materials_unlit",Bve=Hg;async function Tve(t){const e=new Us(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,Hg);e.removeExtension(Hg)}function Sve(t){const e=new Us(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,Hg,{}),e.addExtension(Hg))}const Ive=Object.freeze(Object.defineProperty({__proto__:null,decode:Tve,encode:Sve,name:Bve},Symbol.toStringTag,{value:"Module"})),ng="KHR_techniques_webgl",Mve=ng;async function Pve(t){const e=new Us(t),{json:r}=e,n=e.getExtension(ng);if(n){const i=Rve(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,ng);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Ove(o.technique,e)),e.removeObjectExtension(o,ng)}e.removeExtension(ng)}}async function Lve(t,e){}function Rve(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function Ove(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const Dve=Object.freeze(Object.defineProperty({__proto__:null,decode:Pve,encode:Lve,name:Mve},Symbol.toStringTag,{value:"Module"})),r5=[rbe,Tye,Jbe,Qbe,qbe,cve,Eve,Ive,Dve,vve,ybe];function Fve(t,e={},r){const n=r5.filter(i=>n5(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function kve(t,e={},r){const n=r5.filter(i=>n5(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function n5(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const J1="KHR_binary_glTF";function Nve(t){const e=new Us(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,J1);i&&Object.assign(n,i),e.removeObjectExtension(n,J1)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(J1)}const $4={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Uve={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Gve{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Nve(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in $4)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const n=e[r];if(!(!n||Array.isArray(n))){e[r]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[r].length;e[r].push(o),this.idToIndexMap[r][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const r in $4)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:n,indices:i,material:o}=r;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(r.indices=this._convertIdToIndex(i,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const n of e[r])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,r){const n=Uve[r];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return i}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,i=e.textures.findIndex(o=>o.id===n);i!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:i})}}}function zve(t,e={}){return new Gve().normalize(t,e)}async function jve(t,e,r=0,n,i){return Hve(t,e,r,n),zve(t,{normalize:n?.gltf?.normalize}),Fve(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await Vve(t,n,i),n?.gltf?.loadImages&&await Wve(t,n,i),await kve(t,n,i),t}function Hve(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!Tbe(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=R8(e);else if(e instanceof ArrayBuffer){const s={};r=Sbe(s,e,r,n.glb),ga(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else ga(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function Vve(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;ga(s);const l=Yk(o.uri,e),h=await(await r?.fetch?.(l))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Wve(t,e,r){const n=Jve(t),i=t.json.images||[],o=[];for(const s of n)o.push(Kve(t,i[s],s,e,r));return await Promise.all(o)}function Jve(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Kve(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=Yk(e.uri,n),{fetch:h}=i;o=await(await h(l)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const l=fye(t.json,t.buffers,e.bufferView);o=em(l.buffer,l.byteOffset,l.byteLength)}ga(o,"glTF image has no data");let s=await Tf(o,[Q_,wk],{...n,mimeType:e.mimeType,basis:n.basis||{format:uE()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const ly={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:bbe,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Xve,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Xve(t,e={},r){e={...ly.options,...e},e.gltf={...ly.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await jve({},t,n,e,r)}const Qve={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zve={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Fa={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},$ve={magFilter:Fa.TEXTURE_MAG_FILTER,minFilter:Fa.TEXTURE_MIN_FILTER,wrapS:Fa.TEXTURE_WRAP_S,wrapT:Fa.TEXTURE_WRAP_T},qve={[Fa.TEXTURE_MAG_FILTER]:Fa.LINEAR,[Fa.TEXTURE_MIN_FILTER]:Fa.NEAREST_MIPMAP_LINEAR,[Fa.TEXTURE_WRAP_S]:Fa.REPEAT,[Fa.TEXTURE_WRAP_T]:Fa.REPEAT};function Yve(){return{id:"default-sampler",parameters:qve}}function e1e(t){return Zve[t]}function t1e(t){return Qve[t]}class r1e{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return ga(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const n=e&&e[r];return n||console.warn(`glTF file error: Could not find ${e}[${r}]`),n}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,r){const n={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:n}}_resolveMesh(e,r){const n={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const l in s)o.attributes[l]=this.getAccessor(s[l]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,r){const n={...e,id:e.id||`material-${r}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,r){const n=e1e(e.componentType),i=t1e(e.type),o=n*i,s={...e,id:e.id||`accessor-${r}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const l=s.bufferView.buffer,{ArrayType:h,byteLength:A}=gE(s,s.bufferView),b=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+l.byteOffset;let C=l.arrayBuffer.slice(b,b+A);s.bufferView.byteStride&&(C=this._getValueFromInterleavedBuffer(l,b,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new h(C)}return s}_getValueFromInterleavedBuffer(e,r,n,i,o){const s=new Uint8Array(o*i);for(let l=0;l<o;l++){const h=r+l*n;s.set(new Uint8Array(e.arrayBuffer.slice(h,h+i)),l*i)}return s.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Yve(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const n={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return $ve[e]}_resolveImage(e,r){const n={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[r];return i&&(n.image=i),n}_resolveBufferView(e,r){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,r){const n={...e,id:e.id||`camera-${r}`};return n.perspective,n.orthographic,n}}function i5(t,e){return new r1e().postProcess(t,e)}const Wx={URI:0,EMBEDDED:1};function s5(t,e,r,n){t.rotateYtoZ=!0;const i=(t.byteOffset||0)+(t.byteLength||0)-r;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=em(e,r,i),t.gltfByteOffset=0,t.gltfByteLength=i,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function o5(t,e,r,n){const i=r?.["3d-tiles"]||{};if(n1e(t,e),i.loadGLTF){if(!n)return;if(t.gltfUrl){const{fetch:o}=n,s=await o(t.gltfUrl,r);t.gltfArrayBuffer=await s.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const o=await Tf(t.gltfArrayBuffer,ly,r,n);t.gltf=i5(o),t.gpuMemoryUsageInBytes=Wk(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function n1e(t,e,r){switch(e){case Wx.URI:if(t.gltfArrayBuffer){const n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=new TextDecoder().decode(n);t.gltfUrl=i.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Wx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function i1e(t,e,r,n,i){r=s1e(t,e,r,n),await o5(t,Wx.EMBEDDED,n,i);const o=t?.gltf?.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}function s1e(t,e,r,n,i){r=qy(t,e,r),r=pE(t,e,r),r=AE(t,e,r),r=s5(t,e,r,n);const o=new dE(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3),r}async function o1e(t,e,r,n,i){return r=a1e(t,e,r,n),await o5(t,t.gltfFormat||0,n,i),r}function a1e(t,e,r,n,i){if(r=qy(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=pE(t,e,r);const o=new DataView(e);if(t.gltfFormat=o.getUint32(r,!0),r+=4,r=AE(t,e,r),r=s5(t,e,r,n),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new dE(t.featureTableJson,t.featureTableBinary),l=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=s.getGlobalProperty("RTC_CENTER",Gn.FLOAT,3);const h=new Gk(t.batchTableJson,t.batchTableBinary,l);return l1e(t,s,h,l),r}function l1e(t,e,r,n){const i=new Array(n),o=new ft;new ft,new ft,new ft;const s=new gi,l=new Eg,h=new ft,A={},b=new bn,C=[],S=[],D=[],N=[];for(let U=0;U<n;U++){let V;if(e.hasProperty("POSITION"))V=e.getProperty("POSITION",Gn.FLOAT,3,U,o);else if(e.hasProperty("POSITION_QUANTIZED")){V=e.getProperty("POSITION_QUANTIZED",Gn.UNSIGNED_SHORT,3,U,o);const Y=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Gn.FLOAT,3);if(!Y)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ge=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Gn.FLOAT,3);if(!Ge)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ze=65535;for(let de=0;de<3;de++)V[de]=V[de]/ze*Ge[de]+Y[de]}if(!V)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(V),A.translation=o,t.normalUp=e.getProperty("NORMAL_UP",Gn.FLOAT,3,U,C),t.normalRight=e.getProperty("NORMAL_RIGHT",Gn.FLOAT,3,U,S),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Gn.UNSIGNED_SHORT,2,U,C),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Gn.UNSIGNED_SHORT,2,U,S),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(wi.WGS84.eastNorthUpToFixedFrame(o,b),b.getRotationMatrix3(s)):s.identity()}l.fromMatrix3(s),A.rotation=l,h.set(1,1,1);const j=e.getProperty("SCALE",Gn.FLOAT,1,U,D);Number.isFinite(j)&&h.multiplyByScalar(j);const ee=e.getProperty("SCALE_NON_UNIFORM",Gn.FLOAT,3,U,C);ee&&h.scale(ee),A.scale=h;let Q=e.getProperty("BATCH_ID",Gn.UNSIGNED_SHORT,1,U,N);Q===void 0&&(Q=U);const X=new bn().fromQuaternion(A.rotation);b.identity(),b.translate(A.translation),b.multiplyRight(X),b.scale(A.scale);const pe=b.clone();i[U]={modelMatrix:pe,batchId:Q}}t.instances=i}async function c1e(t,e,r,n,i,o){r=qy(t,e,r);const s=new DataView(e);for(t.tilesLength=s.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){const l={shape:"tile3d"};t.tiles.push(l),r=await o(e,r,n,i,l)}return r}async function u1e(t,e,r,n){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!n)return e.byteLength;const i=await Tf(e,ly,r,n);t.gltf=i5(i),t.gpuMemoryUsageInBytes=Wk(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function a5(t,e=0,r,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=I_e(t,e),i.type){case WA.COMPOSITE:return await c1e(i,t,e,r,n,a5);case WA.BATCHED_3D_MODEL:return await i1e(i,t,e,r,n);case WA.GLTF:return await u1e(i,t,r,n);case WA.INSTANCED_3D_MODEL:return await o1e(i,t,e,r,n);case WA.POINT_CLOUD:return await $_e(i,t,e,r,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const h1e=1952609651,f1e=1;async function d1e(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==h1e)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==f1e)throw new Error("Wrong subtree file verson, must be 1");const n=q4(t.slice(8,16)),i=new Uint8Array(t,24,n),o=new TextDecoder("utf8").decode(i),s=JSON.parse(o),l=q4(t.slice(16,24));let h=new ArrayBuffer(0);if(l&&(h=t.slice(24+n)),await S0(s,s.tileAvailability,h,r),Array.isArray(s.contentAvailability))for(const A of s.contentAvailability)await S0(s,A,h,r);else await S0(s,s.contentAvailability,h,r);return await S0(s,s.childSubtreeAvailability,h,r),s}async function S0(t,e,r,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const o=t.bufferViews[i],s=t.buffers[o.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(s.uri){const h=`${n?.baseUrl||""}/${s.uri}`,A=await(await n.fetch(h)).arrayBuffer();e.explicitBitstream=new Uint8Array(A,o.byteOffset,o.byteLength);return}const l=t.buffers.slice(0,o.buffer).reduce((h,A)=>h+A.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(l,l+s.byteLength),o.byteOffset,o.byteLength)}function q4(t){const e=new DataView(t),r=e.getUint32(0,!0),n=e.getUint32(4,!0);return r+2**32*n}const l5={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:kk,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:d1e,options:{}};/**
* @license
* Copyright 2009 The Closure Library Authors
* Copyright 2020 Daniel Wirtz / The long.js Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* SPDX-License-Identifier: Apache-2.0
*/var Oa=null;try{Oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ai(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}ai.prototype.__isLong__,Object.defineProperty(ai.prototype,"__isLong__",{value:!0});function go(t){return(t&&t.__isLong__)===!0}function Y4(t){var e=Math.clz32(t&-t);return t?31-e:e}ai.isLong=go;var eL={},tL={};function Sf(t,e){var r,n,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(n=tL[t],n)?n:(r=jn(t,0,!0),i&&(tL[t]=r),r)):(t|=0,(i=-128<=t&&t<128)&&(n=eL[t],n)?n:(r=jn(t,t<0?-1:0,!1),i&&(eL[t]=r),r))}ai.fromInt=Sf;function ka(t,e){if(isNaN(t))return e?Zc:gl;if(e){if(t<0)return Zc;if(t>=c5)return f5}else{if(t<=-nL)return zo;if(t+1>=nL)return h5}return t<0?ka(-t,e).neg():jn(t%Zp|0,t/Zp|0,e)}ai.fromNumber=ka;function jn(t,e,r){return new ai(t,e,r)}ai.fromBits=jn;var cy=Math.pow;function vE(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Zc:gl;if(r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return vE(t.substring(1),e,r).neg();for(var i=ka(cy(r,8)),o=gl,s=0;s<t.length;s+=8){var l=Math.min(8,t.length-s),h=parseInt(t.substring(s,s+l),r);if(l<8){var A=ka(cy(r,l));o=o.mul(A).add(ka(h))}else o=o.mul(i),o=o.add(ka(h))}return o.unsigned=e,o}ai.fromString=vE;function dl(t,e){return typeof t=="number"?ka(t,e):typeof t=="string"?vE(t,e):jn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}ai.fromValue=dl;var rL=65536,p1e=1<<24,Zp=rL*rL,c5=Zp*Zp,nL=c5/2,iL=Sf(p1e),gl=Sf(0);ai.ZERO=gl;var Zc=Sf(0,!0);ai.UZERO=Zc;var ip=Sf(1);ai.ONE=ip;var u5=Sf(1,!0);ai.UONE=u5;var Jx=Sf(-1);ai.NEG_ONE=Jx;var h5=jn(-1,2147483647,!1);ai.MAX_VALUE=h5;var f5=jn(-1,-1,!0);ai.MAX_UNSIGNED_VALUE=f5;var zo=jn(0,-2147483648,!1);ai.MIN_VALUE=zo;var rr=ai.prototype;rr.toInt=function(){return this.unsigned?this.low>>>0:this.low},rr.toNumber=function(){return this.unsigned?(this.high>>>0)*Zp+(this.low>>>0):this.high*Zp+(this.low>>>0)},rr.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(zo)){var e=ka(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=ka(cy(t,6),this.unsigned),o=this,s="";;){var l=o.div(i),h=o.sub(l.mul(i)).toInt()>>>0,A=h.toString(t);if(o=l,o.isZero())return A+s;for(;A.length<6;)A="0"+A;s=""+A+s}},rr.getHighBits=function(){return this.high},rr.getHighBitsUnsigned=function(){return this.high>>>0},rr.getLowBits=function(){return this.low},rr.getLowBitsUnsigned=function(){return this.low>>>0},rr.getNumBitsAbs=function(){if(this.isNegative())return this.eq(zo)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&(t&1<<e)==0;e--);return this.high!=0?e+33:e+1},rr.isZero=function(){return this.high===0&&this.low===0},rr.eqz=rr.isZero,rr.isNegative=function(){return!this.unsigned&&this.high<0},rr.isPositive=function(){return this.unsigned||this.high>=0},rr.isOdd=function(){return(this.low&1)===1},rr.isEven=function(){return(this.low&1)===0},rr.equals=function(t){return go(t)||(t=dl(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},rr.eq=rr.equals,rr.notEquals=function(t){return!this.eq(t)},rr.neq=rr.notEquals,rr.ne=rr.notEquals,rr.lessThan=function(t){return this.comp(t)<0},rr.lt=rr.lessThan,rr.lessThanOrEqual=function(t){return this.comp(t)<=0},rr.lte=rr.lessThanOrEqual,rr.le=rr.lessThanOrEqual,rr.greaterThan=function(t){return this.comp(t)>0},rr.gt=rr.greaterThan,rr.greaterThanOrEqual=function(t){return this.comp(t)>=0},rr.gte=rr.greaterThanOrEqual,rr.ge=rr.greaterThanOrEqual,rr.compare=function(t){if(go(t)||(t=dl(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},rr.comp=rr.compare,rr.negate=function(){return!this.unsigned&&this.eq(zo)?zo:this.not().add(ip)},rr.neg=rr.negate,rr.add=function(t){go(t)||(t=dl(t));var e=this.high>>>16,r=this.high&65535,n=this.low>>>16,i=this.low&65535,o=t.high>>>16,s=t.high&65535,l=t.low>>>16,h=t.low&65535,A=0,b=0,C=0,S=0;return S+=i+h,C+=S>>>16,S&=65535,C+=n+l,b+=C>>>16,C&=65535,b+=r+s,A+=b>>>16,b&=65535,A+=e+o,A&=65535,jn(C<<16|S,A<<16|b,this.unsigned)},rr.subtract=function(t){return go(t)||(t=dl(t)),this.add(t.neg())},rr.sub=rr.subtract,rr.multiply=function(t){if(this.isZero())return this;if(go(t)||(t=dl(t)),Oa){var e=Oa.mul(this.low,this.high,t.low,t.high);return jn(e,Oa.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Zc:gl;if(this.eq(zo))return t.isOdd()?zo:gl;if(t.eq(zo))return this.isOdd()?zo:gl;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(iL)&&t.lt(iL))return ka(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,i=this.low>>>16,o=this.low&65535,s=t.high>>>16,l=t.high&65535,h=t.low>>>16,A=t.low&65535,b=0,C=0,S=0,D=0;return D+=o*A,S+=D>>>16,D&=65535,S+=i*A,C+=S>>>16,S&=65535,S+=o*h,C+=S>>>16,S&=65535,C+=n*A,b+=C>>>16,C&=65535,C+=i*h,b+=C>>>16,C&=65535,C+=o*l,b+=C>>>16,C&=65535,b+=r*A+n*h+i*l+o*s,b&=65535,jn(S<<16|D,b<<16|C,this.unsigned)},rr.mul=rr.multiply,rr.divide=function(t){if(go(t)||(t=dl(t)),t.isZero())throw Error("division by zero");if(Oa){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Oa.div_u:Oa.div_s)(this.low,this.high,t.low,t.high);return jn(e,Oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Zc:gl;var r,n,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Zc;if(t.gt(this.shru(1)))return u5;i=Zc}else{if(this.eq(zo)){if(t.eq(ip)||t.eq(Jx))return zo;if(t.eq(zo))return ip;var o=this.shr(1);return r=o.div(t).shl(1),r.eq(gl)?t.isNegative()?ip:Jx:(n=this.sub(t.mul(r)),i=r.add(n.div(t)),i)}else if(t.eq(zo))return this.unsigned?Zc:gl;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=gl}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),l=s<=48?1:cy(2,s-48),h=ka(r),A=h.mul(t);A.isNegative()||A.gt(n);)r-=l,h=ka(r,this.unsigned),A=h.mul(t);h.isZero()&&(h=ip),i=i.add(h),n=n.sub(A)}return i},rr.div=rr.divide,rr.modulo=function(t){if(go(t)||(t=dl(t)),Oa){var e=(this.unsigned?Oa.rem_u:Oa.rem_s)(this.low,this.high,t.low,t.high);return jn(e,Oa.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},rr.mod=rr.modulo,rr.rem=rr.modulo,rr.not=function(){return jn(~this.low,~this.high,this.unsigned)},rr.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},rr.clz=rr.countLeadingZeros,rr.countTrailingZeros=function(){return this.low?Y4(this.low):Y4(this.high)+32},rr.ctz=rr.countTrailingZeros,rr.and=function(t){return go(t)||(t=dl(t)),jn(this.low&t.low,this.high&t.high,this.unsigned)},rr.or=function(t){return go(t)||(t=dl(t)),jn(this.low|t.low,this.high|t.high,this.unsigned)},rr.xor=function(t){return go(t)||(t=dl(t)),jn(this.low^t.low,this.high^t.high,this.unsigned)},rr.shiftLeft=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?jn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):jn(0,this.low<<t-32,this.unsigned)},rr.shl=rr.shiftLeft,rr.shiftRight=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?jn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):jn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},rr.shr=rr.shiftRight,rr.shiftRightUnsigned=function(t){return go(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?jn(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?jn(this.high,0,this.unsigned):jn(this.high>>>t-32,0,this.unsigned)},rr.shru=rr.shiftRightUnsigned,rr.shr_u=rr.shiftRightUnsigned,rr.rotateLeft=function(t){var e;return go(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?jn(this.high,this.low,this.unsigned):t<32?(e=32-t,jn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,jn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},rr.rotl=rr.rotateLeft,rr.rotateRight=function(t){var e;return go(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?jn(this.high,this.low,this.unsigned):t<32?(e=32-t,jn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,jn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},rr.rotr=rr.rotateRight,rr.toSigned=function(){return this.unsigned?jn(this.low,this.high,!1):this},rr.toUnsigned=function(){return this.unsigned?this:jn(this.low,this.high,!0)},rr.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},rr.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},rr.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},ai.fromBytes=function(t,e,r){return r?ai.fromBytesLE(t,e):ai.fromBytesBE(t,e)},ai.fromBytesLE=function(t,e){return new ai(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},ai.fromBytesBE=function(t,e){return new ai(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const A1e=16;function d5(t){t==="X"&&(t="");const e=t.padEnd(A1e,"0");return ai.fromString(e,!0,16)}function g1e(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const r=e%4;e=(e-r)/4;const n=e;e*=4;const i=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-i.length).join("0")+i}function m1e(t,e){const r=_1e(t).shiftRightUnsigned(2);return t.add(ai.fromNumber(2*e+1-4).multiply(r))}function _1e(t){return t.and(t.not().add(1))}const y1e=3,b1e=30,v1e=2*b1e+1,sL=180/Math.PI;function x1e(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),r=parseInt(e[0],10),n=e[1],i=n.length;let o=0;const s=[0,0];for(let l=i-1;l>=0;l--){o=i-l;const h=n[l];let A=0,b=0;h==="1"?b=1:h==="2"?(A=1,b=1):h==="3"&&(A=1);const C=Math.pow(2,o-1);C1e(C,s,A,b),s[0]+=C*A,s[1]+=C*b}if(r%2===1){const l=s[0];s[0]=s[1],s[1]=l}return{face:r,ij:s,level:o}}function w1e(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<y1e+v1e;)e="0"+e;const r=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,r),o=i.length/2,s=ai.fromString(n,!0,2).toString(10);let l="";if(o!==0)for(l=ai.fromString(i,!0,2).toString(4);l.length<o;)l="0"+l;return`${s}/${l}`}function p5(t,e,r){const n=1<<e;return[(t[0]+r[0])/n,(t[1]+r[1])/n]}function oL(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function A5(t){return[oL(t[0]),oL(t[1])]}function g5(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function m5([t,e,r]){const n=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*sL,n*sL]}function C1e(t,e,r,n){if(n===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function E1e(t){const e=p5(t.ij,t.level,[.5,.5]),r=A5(e),n=g5(t.face,r);return m5(n)}const B1e=100;function aL(t){const{face:e,ij:r,level:n}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(B1e*Math.pow(2,-n))),s=new Float64Array(4*o*2+2);let l=0,h=0;for(let A=0;A<4;A++){const b=i[A].slice(0),C=i[A+1],S=(C[0]-b[0])/o,D=(C[1]-b[1])/o;for(let N=0;N<o;N++){b[0]+=S,b[1]+=D;const U=p5(r,n,b),V=A5(U),j=g5(e,V),ee=m5(j);Math.abs(ee[1])>89.999&&(ee[0]=h);const Q=ee[0]-h;ee[0]+=Q>180?-360:Q<-180?360:0,s[l++]=ee[0],s[l++]=ee[1],h=ee[0]}}return s[l++]=s[0],s[l++]=s[1],s}function xE(t){const e=T1e(t);return x1e(e)}function T1e(t){if(t.indexOf("/")>0)return t;const e=d5(t);return w1e(e)}function S1e(t){const e=xE(t);return E1e(e)}function I1e(t){let e;if(t.face===2||t.face===5){let r=null,n=0;for(let i=0;i<4;i++){const o=`${t.face}/${i}`,s=xE(o),l=aL(s);(typeof r>"u"||r===null)&&(r=new Float64Array(4*l.length)),r.set(l,n),n+=l.length}e=lL(r)}else{const r=aL(t);e=lL(r)}return e}function lL(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],r=[];for(let n=0;n<t.length;n+=2)e.push(t[n]),r.push(t[n+1]);return e.sort((n,i)=>n-i),r.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function M1e(t,e){const r=e?.minimumHeight||0,n=e?.maximumHeight||0,i=xE(t),o=I1e(i),s=o.west,l=o.south,h=o.east,A=o.north,b=[];return b.push(new ft(s,A,r)),b.push(new ft(h,A,r)),b.push(new ft(h,l,r)),b.push(new ft(s,l,r)),b.push(new ft(s,A,n)),b.push(new ft(h,A,n)),b.push(new ft(h,l,n)),b.push(new ft(s,l,n)),b}function _5(t){const e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},n=M1e(e,r),i=S1e(e),o=i[0],s=i[1],l=wi.WGS84.cartographicToCartesian([o,s,r.maximumHeight]),h=new ft(l[0],l[1],l[2]);n.push(h);const A=H8(n);return[...A.center,...A.halfAxes]}const P1e=4,L1e=8,R1e={QUADTREE:P1e,OCTREE:L1e};function O1e(t,e,r){if(t?.box){const n=d5(t.s2VolumeInfo.token),i=m1e(n,e),o=g1e(i),s={...t.s2VolumeInfo};switch(s.token=o,r){case"OCTREE":const l=t.s2VolumeInfo,h=l.maximumHeight-l.minimumHeight,A=h/2,b=l.minimumHeight+h/2;l.minimumHeight=b-A,l.maximumHeight=b+A;break}return{box:_5(s),s2VolumeInfo:s}}}async function y5(t){const{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:o,loaderOptions:s,s2VolumeBox:l}=t,{subdivisionScheme:h,subtreeLevels:A,maximumLevel:b,contentUrlTemplate:C,subtreesUriTemplate:S,basePath:D}=o,N={children:[],lodMetricValue:0,contentUrl:""};if(!b)return Q6.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${C} won't be loaded...`),N;const U=n.localLevel+1,V=r.level+U;if(V>b)return N;const j=R1e[h],ee=Math.log2(j),Q=i&1,X=i>>1&1,pe=i>>2&1,Y=Vh(n.localX,Q,1),Ge=Vh(n.localY,X,1),ze=Vh(n.localZ,pe,1),de=Vh(r.x,Y,U),ce=Vh(r.y,Ge,U),De=Vh(r.z,ze,U),J=Vh(n.mortonIndex,i,ee),ue=U===A&&K1(e.childSubtreeAvailability,J);let Ee,ct,Ce,Le;if(ue){const Ne=`${D}/${S}`,$e=Kx(Ne,V,de,ce,De);Ee=await eA($e,l5,s),Le=0,ct={level:V,x:de,y:ce,z:De},Ce={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Ee=e,Le=(j**U-1)/(j-1)+J,ct=r,Ce={mortonIndex:J,localLevel:U,localX:Y,localY:Ge,localZ:ze};if(!K1(Ee.tileAvailability,Le))return N;K1(Ee.contentAvailability,Le)&&(N.contentUrl=Kx(C,V,de,ce,De));for(let Ne=0;Ne<j;Ne++){const $e=O1e(l,Ne,h),it=await y5({subtree:Ee,subtreeData:ct,parentData:Ce,childIndex:Ne,implicitOptions:o,loaderOptions:s,s2VolumeBox:$e});(it.contentUrl||it.children.length)&&N.children.push(it)}return N.contentUrl||N.children.length?D1e(N,{level:V,x:de,y:ce,z:De},o,l):N}function K1(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&Q6.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?N1e(e,r.explicitBitstream):!1}function D1e(t,e,r,n){const{basePath:i,refine:o,getRefine:s,lodMetricType:l,getTileType:h,rootLodMetricValue:A,rootBoundingVolume:b}=r,C=t.contentUrl&&t.contentUrl.replace(`${i}/`,""),S=A/2**e.level,D=n?.box?{box:n.box}:b,N=F1e(D,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:C},id:t.contentUrl,refine:s(o),type:h(t),lodMetricType:l,lodMetricValue:S,geometricError:S,transform:t.transform,boundingVolume:N}}function F1e(t,e,r){if(t.region){const{level:n,x:i,y:o,z:s}=e,[l,h,A,b,C,S]=t.region,D=2**n,N=(A-l)/D,[U,V]=[l+N*i,l+N*(i+1)],j=(b-h)/D,[ee,Q]=[h+j*o,h+j*(o+1)];let X,pe;if(r==="OCTREE"){const Y=(S-C)/D;[X,pe]=[C+Y*s,C+Y*(s+1)]}else[X,pe]=[C,S];return{region:[U,ee,V,Q,X,pe]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function Vh(t,e,r){return(t<<r)+e}function Kx(t,e,r,n,i){const o=k1e({level:e,x:r,y:n,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function k1e(t){const e={};for(const r in t)e[`{${r}}`]=t[r];return e}function N1e(t,e){const r=Math.floor(t/8),n=t%8;return(e[r]>>n&1)===1}function wE(t,e=""){if(!e)return Yc.EMPTY;const r=e.split("?")[0].split(".").pop();switch(r){case"pnts":return Yc.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Yc.SCENEGRAPH;default:return r||Yc.EMPTY}}function CE(t){switch(t){case"REPLACE":case"replace":return Tl.REPLACE;case"ADD":case"add":return Tl.ADD;default:return t}}function Xx(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,`${e}/`);return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return she(e,t)}function cL(t,e){if(!t)return null;let r;if(t.content){const n=t.content.uri||t.content?.url;typeof n<"u"&&(r=Xx(n,e))}return{...t,id:r,contentUrl:r,lodMetricType:Kp.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:wE(t,r),refine:CE(t.refine)}}async function U1e(t,e,r){let n=null;const i=hL(t.root);i&&t.root?n=await uL(t.root,t,e,i,r):n=cL(t.root,e);const o=[];for(o.push(n);o.length>0;){const s=o.pop()||{},l=s.children||[],h=[];for(const A of l){const b=hL(A);let C;b?C=await uL(A,t,e,b,r):C=cL(A,e),C&&(h.push(C),o.push(C))}s.children=h}return n}async function uL(t,e,r,n,i){const{subdivisionScheme:o,maximumLevel:s,availableLevels:l,subtreeLevels:h,subtrees:{uri:A}}=n,b=Kx(A,0,0,0,0),C=Xx(b,r),S=await eA(C,l5,i),D=t.content?.uri,N=D?Xx(D,r):"",U=e?.root?.refine,V=t.geometricError,j=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(j){const X={box:_5(j),s2VolumeInfo:j};t.boundingVolume=X}const ee=t.boundingVolume,Q={contentUrlTemplate:N,subtreesUriTemplate:A,subdivisionScheme:o,subtreeLevels:h,maximumLevel:Number.isFinite(l)?l-1:s,refine:U,basePath:r,lodMetricType:Kp.GEOMETRIC_ERROR,rootLodMetricValue:V,rootBoundingVolume:ee,getTileType:wE,getRefine:CE};return await G1e(t,r,S,Q,i)}async function G1e(t,e,r,n,i){if(!t)return null;const{children:o,contentUrl:s}=await y5({subtree:r,implicitOptions:n,loaderOptions:i});let l,h=null;return s&&(l=s,h={uri:s.replace(`${e}/`,"")}),{...t,id:l,contentUrl:l,lodMetricType:Kp.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:wE(t,l),refine:CE(t.refine),content:h||t.content,children:o}}function hL(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}const b5={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:kk,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:z1e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function z1e(t,e={},r){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=r?.url&&r.url.indexOf(".json")!==-1:i=n.isTileset,i?j1e(t,e,r):H1e(t,e,r)}async function j1e(t,e,r){const n=JSON.parse(new TextDecoder().decode(t)),i=r?.url||"",o=V1e(i),s=await U1e(n,o,e||{});return{...n,shape:"tileset3d",loader:b5,url:i,queryString:r?.queryString||"",basePath:o,root:s||n.root,type:jo.TILES3D,lodMetricType:Kp.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function H1e(t,e,r){const n={content:{shape:"tile3d",featureIds:null}};return await a5(t,0,e,r,n.content),n.content}function V1e(t){return F8(t)}var fL={},dL;function ph(){return dL||(dL=1,(function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function r(o,s){return Object.prototype.hasOwnProperty.call(o,s)}t.assign=function(o){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var l=s.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)r(l,h)&&(o[h]=l[h])}}return o},t.shrinkBuf=function(o,s){return o.length===s?o:o.subarray?o.subarray(0,s):(o.length=s,o)};var n={arraySet:function(o,s,l,h,A){if(s.subarray&&o.subarray){o.set(s.subarray(l,l+h),A);return}for(var b=0;b<h;b++)o[A+b]=s[l+b]},flattenChunks:function(o){var s,l,h,A,b,C;for(h=0,s=0,l=o.length;s<l;s++)h+=o[s].length;for(C=new Uint8Array(h),A=0,s=0,l=o.length;s<l;s++)b=o[s],C.set(b,A),A+=b.length;return C}},i={arraySet:function(o,s,l,h,A){for(var b=0;b<h;b++)o[A+b]=s[l+b]},flattenChunks:function(o){return[].concat.apply([],o)}};t.setTyped=function(o){o?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(e)})(fL)),fL}var Gd={},hl={},Wh={},pL;function W1e(){if(pL)return Wh;pL=1;var t=ph(),e=4,r=0,n=1,i=2;function o(Se){for(var kt=Se.length;--kt>=0;)Se[kt]=0}var s=0,l=1,h=2,A=3,b=258,C=29,S=256,D=S+1+C,N=30,U=19,V=2*D+1,j=15,ee=16,Q=7,X=256,pe=16,Y=17,Ge=18,ze=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],de=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],De=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=512,ue=new Array((D+2)*2);o(ue);var Ee=new Array(N*2);o(Ee);var ct=new Array(J);o(ct);var Ce=new Array(b-A+1);o(Ce);var Le=new Array(C);o(Le);var Ne=new Array(N);o(Ne);function $e(Se,kt,Jt,cr,qe){this.static_tree=Se,this.extra_bits=kt,this.extra_base=Jt,this.elems=cr,this.max_length=qe,this.has_stree=Se&&Se.length}var it,ot,dt;function Mt(Se,kt){this.dyn_tree=Se,this.max_code=0,this.stat_desc=kt}function St(Se){return Se<256?ct[Se]:ct[256+(Se>>>7)]}function st(Se,kt){Se.pending_buf[Se.pending++]=kt&255,Se.pending_buf[Se.pending++]=kt>>>8&255}function Ar(Se,kt,Jt){Se.bi_valid>ee-Jt?(Se.bi_buf|=kt<<Se.bi_valid&65535,st(Se,Se.bi_buf),Se.bi_buf=kt>>ee-Se.bi_valid,Se.bi_valid+=Jt-ee):(Se.bi_buf|=kt<<Se.bi_valid&65535,Se.bi_valid+=Jt)}function Qt(Se,kt,Jt){Ar(Se,Jt[kt*2],Jt[kt*2+1])}function Zt(Se,kt){var Jt=0;do Jt|=Se&1,Se>>>=1,Jt<<=1;while(--kt>0);return Jt>>>1}function Ht(Se){Se.bi_valid===16?(st(Se,Se.bi_buf),Se.bi_buf=0,Se.bi_valid=0):Se.bi_valid>=8&&(Se.pending_buf[Se.pending++]=Se.bi_buf&255,Se.bi_buf>>=8,Se.bi_valid-=8)}function dr(Se,kt){var Jt=kt.dyn_tree,cr=kt.max_code,qe=kt.stat_desc.static_tree,Lt=kt.stat_desc.has_stree,ge=kt.stat_desc.extra_bits,Gt=kt.stat_desc.extra_base,wt=kt.stat_desc.max_length,H,yt,Bt,xe,Ke,lt,Z=0;for(xe=0;xe<=j;xe++)Se.bl_count[xe]=0;for(Jt[Se.heap[Se.heap_max]*2+1]=0,H=Se.heap_max+1;H<V;H++)yt=Se.heap[H],xe=Jt[Jt[yt*2+1]*2+1]+1,xe>wt&&(xe=wt,Z++),Jt[yt*2+1]=xe,!(yt>cr)&&(Se.bl_count[xe]++,Ke=0,yt>=Gt&&(Ke=ge[yt-Gt]),lt=Jt[yt*2],Se.opt_len+=lt*(xe+Ke),Lt&&(Se.static_len+=lt*(qe[yt*2+1]+Ke)));if(Z!==0){do{for(xe=wt-1;Se.bl_count[xe]===0;)xe--;Se.bl_count[xe]--,Se.bl_count[xe+1]+=2,Se.bl_count[wt]--,Z-=2}while(Z>0);for(xe=wt;xe!==0;xe--)for(yt=Se.bl_count[xe];yt!==0;)Bt=Se.heap[--H],!(Bt>cr)&&(Jt[Bt*2+1]!==xe&&(Se.opt_len+=(xe-Jt[Bt*2+1])*Jt[Bt*2],Jt[Bt*2+1]=xe),yt--)}}function ln(Se,kt,Jt){var cr=new Array(j+1),qe=0,Lt,ge;for(Lt=1;Lt<=j;Lt++)cr[Lt]=qe=qe+Jt[Lt-1]<<1;for(ge=0;ge<=kt;ge++){var Gt=Se[ge*2+1];Gt!==0&&(Se[ge*2]=Zt(cr[Gt]++,Gt))}}function Lr(){var Se,kt,Jt,cr,qe,Lt=new Array(j+1);for(Jt=0,cr=0;cr<C-1;cr++)for(Le[cr]=Jt,Se=0;Se<1<<ze[cr];Se++)Ce[Jt++]=cr;for(Ce[Jt-1]=cr,qe=0,cr=0;cr<16;cr++)for(Ne[cr]=qe,Se=0;Se<1<<de[cr];Se++)ct[qe++]=cr;for(qe>>=7;cr<N;cr++)for(Ne[cr]=qe<<7,Se=0;Se<1<<de[cr]-7;Se++)ct[256+qe++]=cr;for(kt=0;kt<=j;kt++)Lt[kt]=0;for(Se=0;Se<=143;)ue[Se*2+1]=8,Se++,Lt[8]++;for(;Se<=255;)ue[Se*2+1]=9,Se++,Lt[9]++;for(;Se<=279;)ue[Se*2+1]=7,Se++,Lt[7]++;for(;Se<=287;)ue[Se*2+1]=8,Se++,Lt[8]++;for(ln(ue,D+1,Lt),Se=0;Se<N;Se++)Ee[Se*2+1]=5,Ee[Se*2]=Zt(Se,5);it=new $e(ue,ze,S+1,D,j),ot=new $e(Ee,de,0,N,j),dt=new $e(new Array(0),ce,0,U,Q)}function vr(Se){var kt;for(kt=0;kt<D;kt++)Se.dyn_ltree[kt*2]=0;for(kt=0;kt<N;kt++)Se.dyn_dtree[kt*2]=0;for(kt=0;kt<U;kt++)Se.bl_tree[kt*2]=0;Se.dyn_ltree[X*2]=1,Se.opt_len=Se.static_len=0,Se.last_lit=Se.matches=0}function Hn(Se){Se.bi_valid>8?st(Se,Se.bi_buf):Se.bi_valid>0&&(Se.pending_buf[Se.pending++]=Se.bi_buf),Se.bi_buf=0,Se.bi_valid=0}function _r(Se,kt,Jt,cr){Hn(Se),st(Se,Jt),st(Se,~Jt),t.arraySet(Se.pending_buf,Se.window,kt,Jt,Se.pending),Se.pending+=Jt}function yr(Se,kt,Jt,cr){var qe=kt*2,Lt=Jt*2;return Se[qe]<Se[Lt]||Se[qe]===Se[Lt]&&cr[kt]<=cr[Jt]}function un(Se,kt,Jt){for(var cr=Se.heap[Jt],qe=Jt<<1;qe<=Se.heap_len&&(qe<Se.heap_len&&yr(kt,Se.heap[qe+1],Se.heap[qe],Se.depth)&&qe++,!yr(kt,cr,Se.heap[qe],Se.depth));)Se.heap[Jt]=Se.heap[qe],Jt=qe,qe<<=1;Se.heap[Jt]=cr}function Rr(Se,kt,Jt){var cr,qe,Lt=0,ge,Gt;if(Se.last_lit!==0)do cr=Se.pending_buf[Se.d_buf+Lt*2]<<8|Se.pending_buf[Se.d_buf+Lt*2+1],qe=Se.pending_buf[Se.l_buf+Lt],Lt++,cr===0?Qt(Se,qe,kt):(ge=Ce[qe],Qt(Se,ge+S+1,kt),Gt=ze[ge],Gt!==0&&(qe-=Le[ge],Ar(Se,qe,Gt)),cr--,ge=St(cr),Qt(Se,ge,Jt),Gt=de[ge],Gt!==0&&(cr-=Ne[ge],Ar(Se,cr,Gt)));while(Lt<Se.last_lit);Qt(Se,X,kt)}function ci(Se,kt){var Jt=kt.dyn_tree,cr=kt.stat_desc.static_tree,qe=kt.stat_desc.has_stree,Lt=kt.stat_desc.elems,ge,Gt,wt=-1,H;for(Se.heap_len=0,Se.heap_max=V,ge=0;ge<Lt;ge++)Jt[ge*2]!==0?(Se.heap[++Se.heap_len]=wt=ge,Se.depth[ge]=0):Jt[ge*2+1]=0;for(;Se.heap_len<2;)H=Se.heap[++Se.heap_len]=wt<2?++wt:0,Jt[H*2]=1,Se.depth[H]=0,Se.opt_len--,qe&&(Se.static_len-=cr[H*2+1]);for(kt.max_code=wt,ge=Se.heap_len>>1;ge>=1;ge--)un(Se,Jt,ge);H=Lt;do ge=Se.heap[1],Se.heap[1]=Se.heap[Se.heap_len--],un(Se,Jt,1),Gt=Se.heap[1],Se.heap[--Se.heap_max]=ge,Se.heap[--Se.heap_max]=Gt,Jt[H*2]=Jt[ge*2]+Jt[Gt*2],Se.depth[H]=(Se.depth[ge]>=Se.depth[Gt]?Se.depth[ge]:Se.depth[Gt])+1,Jt[ge*2+1]=Jt[Gt*2+1]=H,Se.heap[1]=H++,un(Se,Jt,1);while(Se.heap_len>=2);Se.heap[--Se.heap_max]=Se.heap[1],dr(Se,kt),ln(Jt,wt,Se.bl_count)}function qn(Se,kt,Jt){var cr,qe=-1,Lt,ge=kt[1],Gt=0,wt=7,H=4;for(ge===0&&(wt=138,H=3),kt[(Jt+1)*2+1]=65535,cr=0;cr<=Jt;cr++)Lt=ge,ge=kt[(cr+1)*2+1],!(++Gt<wt&&Lt===ge)&&(Gt<H?Se.bl_tree[Lt*2]+=Gt:Lt!==0?(Lt!==qe&&Se.bl_tree[Lt*2]++,Se.bl_tree[pe*2]++):Gt<=10?Se.bl_tree[Y*2]++:Se.bl_tree[Ge*2]++,Gt=0,qe=Lt,ge===0?(wt=138,H=3):Lt===ge?(wt=6,H=3):(wt=7,H=4))}function mn(Se,kt,Jt){var cr,qe=-1,Lt,ge=kt[1],Gt=0,wt=7,H=4;for(ge===0&&(wt=138,H=3),cr=0;cr<=Jt;cr++)if(Lt=ge,ge=kt[(cr+1)*2+1],!(++Gt<wt&&Lt===ge)){if(Gt<H)do Qt(Se,Lt,Se.bl_tree);while(--Gt!==0);else Lt!==0?(Lt!==qe&&(Qt(Se,Lt,Se.bl_tree),Gt--),Qt(Se,pe,Se.bl_tree),Ar(Se,Gt-3,2)):Gt<=10?(Qt(Se,Y,Se.bl_tree),Ar(Se,Gt-3,3)):(Qt(Se,Ge,Se.bl_tree),Ar(Se,Gt-11,7));Gt=0,qe=Lt,ge===0?(wt=138,H=3):Lt===ge?(wt=6,H=3):(wt=7,H=4)}}function ri(Se){var kt;for(qn(Se,Se.dyn_ltree,Se.l_desc.max_code),qn(Se,Se.dyn_dtree,Se.d_desc.max_code),ci(Se,Se.bl_desc),kt=U-1;kt>=3&&Se.bl_tree[De[kt]*2+1]===0;kt--);return Se.opt_len+=3*(kt+1)+5+5+4,kt}function Vn(Se,kt,Jt,cr){var qe;for(Ar(Se,kt-257,5),Ar(Se,Jt-1,5),Ar(Se,cr-4,4),qe=0;qe<cr;qe++)Ar(Se,Se.bl_tree[De[qe]*2+1],3);mn(Se,Se.dyn_ltree,kt-1),mn(Se,Se.dyn_dtree,Jt-1)}function Tn(Se){var kt=4093624447,Jt;for(Jt=0;Jt<=31;Jt++,kt>>>=1)if(kt&1&&Se.dyn_ltree[Jt*2]!==0)return r;if(Se.dyn_ltree[18]!==0||Se.dyn_ltree[20]!==0||Se.dyn_ltree[26]!==0)return n;for(Jt=32;Jt<S;Jt++)if(Se.dyn_ltree[Jt*2]!==0)return n;return r}var Yn=!1;function zt(Se){Yn||(Lr(),Yn=!0),Se.l_desc=new Mt(Se.dyn_ltree,it),Se.d_desc=new Mt(Se.dyn_dtree,ot),Se.bl_desc=new Mt(Se.bl_tree,dt),Se.bi_buf=0,Se.bi_valid=0,vr(Se)}function gr(Se,kt,Jt,cr){Ar(Se,(s<<1)+(cr?1:0),3),_r(Se,kt,Jt)}function Mr(Se){Ar(Se,l<<1,3),Qt(Se,X,ue),Ht(Se)}function nn(Se,kt,Jt,cr){var qe,Lt,ge=0;Se.level>0?(Se.strm.data_type===i&&(Se.strm.data_type=Tn(Se)),ci(Se,Se.l_desc),ci(Se,Se.d_desc),ge=ri(Se),qe=Se.opt_len+3+7>>>3,Lt=Se.static_len+3+7>>>3,Lt<=qe&&(qe=Lt)):qe=Lt=Jt+5,Jt+4<=qe&&kt!==-1?gr(Se,kt,Jt,cr):Se.strategy===e||Lt===qe?(Ar(Se,(l<<1)+(cr?1:0),3),Rr(Se,ue,Ee)):(Ar(Se,(h<<1)+(cr?1:0),3),Vn(Se,Se.l_desc.max_code+1,Se.d_desc.max_code+1,ge+1),Rr(Se,Se.dyn_ltree,Se.dyn_dtree)),vr(Se),cr&&Hn(Se)}function _i(Se,kt,Jt){return Se.pending_buf[Se.d_buf+Se.last_lit*2]=kt>>>8&255,Se.pending_buf[Se.d_buf+Se.last_lit*2+1]=kt&255,Se.pending_buf[Se.l_buf+Se.last_lit]=Jt&255,Se.last_lit++,kt===0?Se.dyn_ltree[Jt*2]++:(Se.matches++,kt--,Se.dyn_ltree[(Ce[Jt]+S+1)*2]++,Se.dyn_dtree[St(kt)*2]++),Se.last_lit===Se.lit_bufsize-1}return Wh._tr_init=zt,Wh._tr_stored_block=gr,Wh._tr_flush_block=nn,Wh._tr_tally=_i,Wh._tr_align=Mr,Wh}var X1,AL;function v5(){if(AL)return X1;AL=1;function t(e,r,n,i){for(var o=e&65535|0,s=e>>>16&65535|0,l=0;n!==0;){l=n>2e3?2e3:n,n-=l;do o=o+r[i++]|0,s=s+o|0;while(--l);o%=65521,s%=65521}return o|s<<16|0}return X1=t,X1}var Q1,gL;function x5(){if(gL)return Q1;gL=1;function t(){for(var n,i=[],o=0;o<256;o++){n=o;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;i[o]=n}return i}var e=t();function r(n,i,o,s){var l=e,h=s+o;n^=-1;for(var A=s;A<h;A++)n=n>>>8^l[(n^i[A])&255];return n^-1}return Q1=r,Q1}var mL,_L;function EE(){return _L||(_L=1,mL={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),mL}var yL;function J1e(){if(yL)return hl;yL=1;var t=ph(),e=W1e(),r=v5(),n=x5(),i=EE(),o=0,s=1,l=3,h=4,A=5,b=0,C=1,S=-2,D=-3,N=-5,U=-1,V=1,j=2,ee=3,Q=4,X=0,pe=2,Y=8,Ge=9,ze=15,de=8,ce=29,De=256,J=De+1+ce,ue=30,Ee=19,ct=2*J+1,Ce=15,Le=3,Ne=258,$e=Ne+Le+1,it=32,ot=42,dt=69,Mt=73,St=91,st=103,Ar=113,Qt=666,Zt=1,Ht=2,dr=3,ln=4,Lr=3;function vr(H,yt){return H.msg=i[yt],yt}function Hn(H){return(H<<1)-(H>4?9:0)}function _r(H){for(var yt=H.length;--yt>=0;)H[yt]=0}function yr(H){var yt=H.state,Bt=yt.pending;Bt>H.avail_out&&(Bt=H.avail_out),Bt!==0&&(t.arraySet(H.output,yt.pending_buf,yt.pending_out,Bt,H.next_out),H.next_out+=Bt,yt.pending_out+=Bt,H.total_out+=Bt,H.avail_out-=Bt,yt.pending-=Bt,yt.pending===0&&(yt.pending_out=0))}function un(H,yt){e._tr_flush_block(H,H.block_start>=0?H.block_start:-1,H.strstart-H.block_start,yt),H.block_start=H.strstart,yr(H.strm)}function Rr(H,yt){H.pending_buf[H.pending++]=yt}function ci(H,yt){H.pending_buf[H.pending++]=yt>>>8&255,H.pending_buf[H.pending++]=yt&255}function qn(H,yt,Bt,xe){var Ke=H.avail_in;return Ke>xe&&(Ke=xe),Ke===0?0:(H.avail_in-=Ke,t.arraySet(yt,H.input,H.next_in,Ke,Bt),H.state.wrap===1?H.adler=r(H.adler,yt,Ke,Bt):H.state.wrap===2&&(H.adler=n(H.adler,yt,Ke,Bt)),H.next_in+=Ke,H.total_in+=Ke,Ke)}function mn(H,yt){var Bt=H.max_chain_length,xe=H.strstart,Ke,lt,Z=H.prev_length,ne=H.nice_match,ae=H.strstart>H.w_size-$e?H.strstart-(H.w_size-$e):0,ye=H.window,Oe=H.w_mask,fe=H.prev,be=H.strstart+Ne,oe=ye[xe+Z-1],we=ye[xe+Z];H.prev_length>=H.good_match&&(Bt>>=2),ne>H.lookahead&&(ne=H.lookahead);do if(Ke=yt,!(ye[Ke+Z]!==we||ye[Ke+Z-1]!==oe||ye[Ke]!==ye[xe]||ye[++Ke]!==ye[xe+1])){xe+=2,Ke++;do;while(ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&ye[++xe]===ye[++Ke]&&xe<be);if(lt=Ne-(be-xe),xe=be-Ne,lt>Z){if(H.match_start=yt,Z=lt,lt>=ne)break;oe=ye[xe+Z-1],we=ye[xe+Z]}}while((yt=fe[yt&Oe])>ae&&--Bt!==0);return Z<=H.lookahead?Z:H.lookahead}function ri(H){var yt=H.w_size,Bt,xe,Ke,lt,Z;do{if(lt=H.window_size-H.lookahead-H.strstart,H.strstart>=yt+(yt-$e)){t.arraySet(H.window,H.window,yt,yt,0),H.match_start-=yt,H.strstart-=yt,H.block_start-=yt,xe=H.hash_size,Bt=xe;do Ke=H.head[--Bt],H.head[Bt]=Ke>=yt?Ke-yt:0;while(--xe);xe=yt,Bt=xe;do Ke=H.prev[--Bt],H.prev[Bt]=Ke>=yt?Ke-yt:0;while(--xe);lt+=yt}if(H.strm.avail_in===0)break;if(xe=qn(H.strm,H.window,H.strstart+H.lookahead,lt),H.lookahead+=xe,H.lookahead+H.insert>=Le)for(Z=H.strstart-H.insert,H.ins_h=H.window[Z],H.ins_h=(H.ins_h<<H.hash_shift^H.window[Z+1])&H.hash_mask;H.insert&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[Z+Le-1])&H.hash_mask,H.prev[Z&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=Z,Z++,H.insert--,!(H.lookahead+H.insert<Le)););}while(H.lookahead<$e&&H.strm.avail_in!==0)}function Vn(H,yt){var Bt=65535;for(Bt>H.pending_buf_size-5&&(Bt=H.pending_buf_size-5);;){if(H.lookahead<=1){if(ri(H),H.lookahead===0&&yt===o)return Zt;if(H.lookahead===0)break}H.strstart+=H.lookahead,H.lookahead=0;var xe=H.block_start+Bt;if((H.strstart===0||H.strstart>=xe)&&(H.lookahead=H.strstart-xe,H.strstart=xe,un(H,!1),H.strm.avail_out===0)||H.strstart-H.block_start>=H.w_size-$e&&(un(H,!1),H.strm.avail_out===0))return Zt}return H.insert=0,yt===h?(un(H,!0),H.strm.avail_out===0?dr:ln):(H.strstart>H.block_start&&(un(H,!1),H.strm.avail_out),Zt)}function Tn(H,yt){for(var Bt,xe;;){if(H.lookahead<$e){if(ri(H),H.lookahead<$e&&yt===o)return Zt;if(H.lookahead===0)break}if(Bt=0,H.lookahead>=Le&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Le-1])&H.hash_mask,Bt=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),Bt!==0&&H.strstart-Bt<=H.w_size-$e&&(H.match_length=mn(H,Bt)),H.match_length>=Le)if(xe=e._tr_tally(H,H.strstart-H.match_start,H.match_length-Le),H.lookahead-=H.match_length,H.match_length<=H.max_lazy_match&&H.lookahead>=Le){H.match_length--;do H.strstart++,H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Le-1])&H.hash_mask,Bt=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart;while(--H.match_length!==0);H.strstart++}else H.strstart+=H.match_length,H.match_length=0,H.ins_h=H.window[H.strstart],H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+1])&H.hash_mask;else xe=e._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++;if(xe&&(un(H,!1),H.strm.avail_out===0))return Zt}return H.insert=H.strstart<Le-1?H.strstart:Le-1,yt===h?(un(H,!0),H.strm.avail_out===0?dr:ln):H.last_lit&&(un(H,!1),H.strm.avail_out===0)?Zt:Ht}function Yn(H,yt){for(var Bt,xe,Ke;;){if(H.lookahead<$e){if(ri(H),H.lookahead<$e&&yt===o)return Zt;if(H.lookahead===0)break}if(Bt=0,H.lookahead>=Le&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Le-1])&H.hash_mask,Bt=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),H.prev_length=H.match_length,H.prev_match=H.match_start,H.match_length=Le-1,Bt!==0&&H.prev_length<H.max_lazy_match&&H.strstart-Bt<=H.w_size-$e&&(H.match_length=mn(H,Bt),H.match_length<=5&&(H.strategy===V||H.match_length===Le&&H.strstart-H.match_start>4096)&&(H.match_length=Le-1)),H.prev_length>=Le&&H.match_length<=H.prev_length){Ke=H.strstart+H.lookahead-Le,xe=e._tr_tally(H,H.strstart-1-H.prev_match,H.prev_length-Le),H.lookahead-=H.prev_length-1,H.prev_length-=2;do++H.strstart<=Ke&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Le-1])&H.hash_mask,Bt=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart);while(--H.prev_length!==0);if(H.match_available=0,H.match_length=Le-1,H.strstart++,xe&&(un(H,!1),H.strm.avail_out===0))return Zt}else if(H.match_available){if(xe=e._tr_tally(H,0,H.window[H.strstart-1]),xe&&un(H,!1),H.strstart++,H.lookahead--,H.strm.avail_out===0)return Zt}else H.match_available=1,H.strstart++,H.lookahead--}return H.match_available&&(xe=e._tr_tally(H,0,H.window[H.strstart-1]),H.match_available=0),H.insert=H.strstart<Le-1?H.strstart:Le-1,yt===h?(un(H,!0),H.strm.avail_out===0?dr:ln):H.last_lit&&(un(H,!1),H.strm.avail_out===0)?Zt:Ht}function zt(H,yt){for(var Bt,xe,Ke,lt,Z=H.window;;){if(H.lookahead<=Ne){if(ri(H),H.lookahead<=Ne&&yt===o)return Zt;if(H.lookahead===0)break}if(H.match_length=0,H.lookahead>=Le&&H.strstart>0&&(Ke=H.strstart-1,xe=Z[Ke],xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke])){lt=H.strstart+Ne;do;while(xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&xe===Z[++Ke]&&Ke<lt);H.match_length=Ne-(lt-Ke),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=Le?(Bt=e._tr_tally(H,1,H.match_length-Le),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(Bt=e._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),Bt&&(un(H,!1),H.strm.avail_out===0))return Zt}return H.insert=0,yt===h?(un(H,!0),H.strm.avail_out===0?dr:ln):H.last_lit&&(un(H,!1),H.strm.avail_out===0)?Zt:Ht}function gr(H,yt){for(var Bt;;){if(H.lookahead===0&&(ri(H),H.lookahead===0)){if(yt===o)return Zt;break}if(H.match_length=0,Bt=e._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,Bt&&(un(H,!1),H.strm.avail_out===0))return Zt}return H.insert=0,yt===h?(un(H,!0),H.strm.avail_out===0?dr:ln):H.last_lit&&(un(H,!1),H.strm.avail_out===0)?Zt:Ht}function Mr(H,yt,Bt,xe,Ke){this.good_length=H,this.max_lazy=yt,this.nice_length=Bt,this.max_chain=xe,this.func=Ke}var nn;nn=[new Mr(0,0,0,0,Vn),new Mr(4,4,8,4,Tn),new Mr(4,5,16,8,Tn),new Mr(4,6,32,32,Tn),new Mr(4,4,16,16,Yn),new Mr(8,16,32,32,Yn),new Mr(8,16,128,128,Yn),new Mr(8,32,128,256,Yn),new Mr(32,128,258,1024,Yn),new Mr(32,258,258,4096,Yn)];function _i(H){H.window_size=2*H.w_size,_r(H.head),H.max_lazy_match=nn[H.level].max_lazy,H.good_match=nn[H.level].good_length,H.nice_match=nn[H.level].nice_length,H.max_chain_length=nn[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=Le-1,H.match_available=0,H.ins_h=0}function Se(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(ct*2),this.dyn_dtree=new t.Buf16((2*ue+1)*2),this.bl_tree=new t.Buf16((2*Ee+1)*2),_r(this.dyn_ltree),_r(this.dyn_dtree),_r(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(Ce+1),this.heap=new t.Buf16(2*J+1),_r(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*J+1),_r(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function kt(H){var yt;return!H||!H.state?vr(H,S):(H.total_in=H.total_out=0,H.data_type=pe,yt=H.state,yt.pending=0,yt.pending_out=0,yt.wrap<0&&(yt.wrap=-yt.wrap),yt.status=yt.wrap?ot:Ar,H.adler=yt.wrap===2?0:1,yt.last_flush=o,e._tr_init(yt),b)}function Jt(H){var yt=kt(H);return yt===b&&_i(H.state),yt}function cr(H,yt){return!H||!H.state||H.state.wrap!==2?S:(H.state.gzhead=yt,b)}function qe(H,yt,Bt,xe,Ke,lt){if(!H)return S;var Z=1;if(yt===U&&(yt=6),xe<0?(Z=0,xe=-xe):xe>15&&(Z=2,xe-=16),Ke<1||Ke>Ge||Bt!==Y||xe<8||xe>15||yt<0||yt>9||lt<0||lt>Q)return vr(H,S);xe===8&&(xe=9);var ne=new Se;return H.state=ne,ne.strm=H,ne.wrap=Z,ne.gzhead=null,ne.w_bits=xe,ne.w_size=1<<ne.w_bits,ne.w_mask=ne.w_size-1,ne.hash_bits=Ke+7,ne.hash_size=1<<ne.hash_bits,ne.hash_mask=ne.hash_size-1,ne.hash_shift=~~((ne.hash_bits+Le-1)/Le),ne.window=new t.Buf8(ne.w_size*2),ne.head=new t.Buf16(ne.hash_size),ne.prev=new t.Buf16(ne.w_size),ne.lit_bufsize=1<<Ke+6,ne.pending_buf_size=ne.lit_bufsize*4,ne.pending_buf=new t.Buf8(ne.pending_buf_size),ne.d_buf=1*ne.lit_bufsize,ne.l_buf=3*ne.lit_bufsize,ne.level=yt,ne.strategy=lt,ne.method=Bt,Jt(H)}function Lt(H,yt){return qe(H,yt,Y,ze,de,X)}function ge(H,yt){var Bt,xe,Ke,lt;if(!H||!H.state||yt>A||yt<0)return H?vr(H,S):S;if(xe=H.state,!H.output||!H.input&&H.avail_in!==0||xe.status===Qt&&yt!==h)return vr(H,H.avail_out===0?N:S);if(xe.strm=H,Bt=xe.last_flush,xe.last_flush=yt,xe.status===ot)if(xe.wrap===2)H.adler=0,Rr(xe,31),Rr(xe,139),Rr(xe,8),xe.gzhead?(Rr(xe,(xe.gzhead.text?1:0)+(xe.gzhead.hcrc?2:0)+(xe.gzhead.extra?4:0)+(xe.gzhead.name?8:0)+(xe.gzhead.comment?16:0)),Rr(xe,xe.gzhead.time&255),Rr(xe,xe.gzhead.time>>8&255),Rr(xe,xe.gzhead.time>>16&255),Rr(xe,xe.gzhead.time>>24&255),Rr(xe,xe.level===9?2:xe.strategy>=j||xe.level<2?4:0),Rr(xe,xe.gzhead.os&255),xe.gzhead.extra&&xe.gzhead.extra.length&&(Rr(xe,xe.gzhead.extra.length&255),Rr(xe,xe.gzhead.extra.length>>8&255)),xe.gzhead.hcrc&&(H.adler=n(H.adler,xe.pending_buf,xe.pending,0)),xe.gzindex=0,xe.status=dt):(Rr(xe,0),Rr(xe,0),Rr(xe,0),Rr(xe,0),Rr(xe,0),Rr(xe,xe.level===9?2:xe.strategy>=j||xe.level<2?4:0),Rr(xe,Lr),xe.status=Ar);else{var Z=Y+(xe.w_bits-8<<4)<<8,ne=-1;xe.strategy>=j||xe.level<2?ne=0:xe.level<6?ne=1:xe.level===6?ne=2:ne=3,Z|=ne<<6,xe.strstart!==0&&(Z|=it),Z+=31-Z%31,xe.status=Ar,ci(xe,Z),xe.strstart!==0&&(ci(xe,H.adler>>>16),ci(xe,H.adler&65535)),H.adler=1}if(xe.status===dt)if(xe.gzhead.extra){for(Ke=xe.pending;xe.gzindex<(xe.gzhead.extra.length&65535)&&!(xe.pending===xe.pending_buf_size&&(xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),yr(H),Ke=xe.pending,xe.pending===xe.pending_buf_size));)Rr(xe,xe.gzhead.extra[xe.gzindex]&255),xe.gzindex++;xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),xe.gzindex===xe.gzhead.extra.length&&(xe.gzindex=0,xe.status=Mt)}else xe.status=Mt;if(xe.status===Mt)if(xe.gzhead.name){Ke=xe.pending;do{if(xe.pending===xe.pending_buf_size&&(xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),yr(H),Ke=xe.pending,xe.pending===xe.pending_buf_size)){lt=1;break}xe.gzindex<xe.gzhead.name.length?lt=xe.gzhead.name.charCodeAt(xe.gzindex++)&255:lt=0,Rr(xe,lt)}while(lt!==0);xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),lt===0&&(xe.gzindex=0,xe.status=St)}else xe.status=St;if(xe.status===St)if(xe.gzhead.comment){Ke=xe.pending;do{if(xe.pending===xe.pending_buf_size&&(xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),yr(H),Ke=xe.pending,xe.pending===xe.pending_buf_size)){lt=1;break}xe.gzindex<xe.gzhead.comment.length?lt=xe.gzhead.comment.charCodeAt(xe.gzindex++)&255:lt=0,Rr(xe,lt)}while(lt!==0);xe.gzhead.hcrc&&xe.pending>Ke&&(H.adler=n(H.adler,xe.pending_buf,xe.pending-Ke,Ke)),lt===0&&(xe.status=st)}else xe.status=st;if(xe.status===st&&(xe.gzhead.hcrc?(xe.pending+2>xe.pending_buf_size&&yr(H),xe.pending+2<=xe.pending_buf_size&&(Rr(xe,H.adler&255),Rr(xe,H.adler>>8&255),H.adler=0,xe.status=Ar)):xe.status=Ar),xe.pending!==0){if(yr(H),H.avail_out===0)return xe.last_flush=-1,b}else if(H.avail_in===0&&Hn(yt)<=Hn(Bt)&&yt!==h)return vr(H,N);if(xe.status===Qt&&H.avail_in!==0)return vr(H,N);if(H.avail_in!==0||xe.lookahead!==0||yt!==o&&xe.status!==Qt){var ae=xe.strategy===j?gr(xe,yt):xe.strategy===ee?zt(xe,yt):nn[xe.level].func(xe,yt);if((ae===dr||ae===ln)&&(xe.status=Qt),ae===Zt||ae===dr)return H.avail_out===0&&(xe.last_flush=-1),b;if(ae===Ht&&(yt===s?e._tr_align(xe):yt!==A&&(e._tr_stored_block(xe,0,0,!1),yt===l&&(_r(xe.head),xe.lookahead===0&&(xe.strstart=0,xe.block_start=0,xe.insert=0))),yr(H),H.avail_out===0))return xe.last_flush=-1,b}return yt!==h?b:xe.wrap<=0?C:(xe.wrap===2?(Rr(xe,H.adler&255),Rr(xe,H.adler>>8&255),Rr(xe,H.adler>>16&255),Rr(xe,H.adler>>24&255),Rr(xe,H.total_in&255),Rr(xe,H.total_in>>8&255),Rr(xe,H.total_in>>16&255),Rr(xe,H.total_in>>24&255)):(ci(xe,H.adler>>>16),ci(xe,H.adler&65535)),yr(H),xe.wrap>0&&(xe.wrap=-xe.wrap),xe.pending!==0?b:C)}function Gt(H){var yt;return!H||!H.state?S:(yt=H.state.status,yt!==ot&&yt!==dt&&yt!==Mt&&yt!==St&&yt!==st&&yt!==Ar&&yt!==Qt?vr(H,S):(H.state=null,yt===Ar?vr(H,D):b))}function wt(H,yt){var Bt=yt.length,xe,Ke,lt,Z,ne,ae,ye,Oe;if(!H||!H.state||(xe=H.state,Z=xe.wrap,Z===2||Z===1&&xe.status!==ot||xe.lookahead))return S;for(Z===1&&(H.adler=r(H.adler,yt,Bt,0)),xe.wrap=0,Bt>=xe.w_size&&(Z===0&&(_r(xe.head),xe.strstart=0,xe.block_start=0,xe.insert=0),Oe=new t.Buf8(xe.w_size),t.arraySet(Oe,yt,Bt-xe.w_size,xe.w_size,0),yt=Oe,Bt=xe.w_size),ne=H.avail_in,ae=H.next_in,ye=H.input,H.avail_in=Bt,H.next_in=0,H.input=yt,ri(xe);xe.lookahead>=Le;){Ke=xe.strstart,lt=xe.lookahead-(Le-1);do xe.ins_h=(xe.ins_h<<xe.hash_shift^xe.window[Ke+Le-1])&xe.hash_mask,xe.prev[Ke&xe.w_mask]=xe.head[xe.ins_h],xe.head[xe.ins_h]=Ke,Ke++;while(--lt);xe.strstart=Ke,xe.lookahead=Le-1,ri(xe)}return xe.strstart+=xe.lookahead,xe.block_start=xe.strstart,xe.insert=xe.lookahead,xe.lookahead=0,xe.match_length=xe.prev_length=Le-1,xe.match_available=0,H.next_in=ae,H.input=ye,H.avail_in=ne,xe.wrap=Z,b}return hl.deflateInit=Lt,hl.deflateInit2=qe,hl.deflateReset=Jt,hl.deflateResetKeep=kt,hl.deflateSetHeader=cr,hl.deflate=ge,hl.deflateEnd=Gt,hl.deflateSetDictionary=wt,hl.deflateInfo="pako deflate (from Nodeca project)",hl}var Jh={},bL;function w5(){if(bL)return Jh;bL=1;var t=ph(),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var n=new t.Buf8(256),i=0;i<256;i++)n[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;n[254]=n[254]=1,Jh.string2buf=function(s){var l,h,A,b,C,S=s.length,D=0;for(b=0;b<S;b++)h=s.charCodeAt(b),(h&64512)===55296&&b+1<S&&(A=s.charCodeAt(b+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),b++)),D+=h<128?1:h<2048?2:h<65536?3:4;for(l=new t.Buf8(D),C=0,b=0;C<D;b++)h=s.charCodeAt(b),(h&64512)===55296&&b+1<S&&(A=s.charCodeAt(b+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),b++)),h<128?l[C++]=h:h<2048?(l[C++]=192|h>>>6,l[C++]=128|h&63):h<65536?(l[C++]=224|h>>>12,l[C++]=128|h>>>6&63,l[C++]=128|h&63):(l[C++]=240|h>>>18,l[C++]=128|h>>>12&63,l[C++]=128|h>>>6&63,l[C++]=128|h&63);return l};function o(s,l){if(l<65534&&(s.subarray&&r||!s.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(s,l));for(var h="",A=0;A<l;A++)h+=String.fromCharCode(s[A]);return h}return Jh.buf2binstring=function(s){return o(s,s.length)},Jh.binstring2buf=function(s){for(var l=new t.Buf8(s.length),h=0,A=l.length;h<A;h++)l[h]=s.charCodeAt(h);return l},Jh.buf2string=function(s,l){var h,A,b,C,S=l||s.length,D=new Array(S*2);for(A=0,h=0;h<S;){if(b=s[h++],b<128){D[A++]=b;continue}if(C=n[b],C>4){D[A++]=65533,h+=C-1;continue}for(b&=C===2?31:C===3?15:7;C>1&&h<S;)b=b<<6|s[h++]&63,C--;if(C>1){D[A++]=65533;continue}b<65536?D[A++]=b:(b-=65536,D[A++]=55296|b>>10&1023,D[A++]=56320|b&1023)}return o(D,A)},Jh.utf8border=function(s,l){var h;for(l=l||s.length,l>s.length&&(l=s.length),h=l-1;h>=0&&(s[h]&192)===128;)h--;return h<0||h===0?l:h+n[s[h]]>l?h:l},Jh}var Z1,vL;function C5(){if(vL)return Z1;vL=1;function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return Z1=t,Z1}var xL;function K1e(){if(xL)return Gd;xL=1;var t=J1e(),e=ph(),r=w5(),n=EE(),i=C5(),o=Object.prototype.toString,s=0,l=4,h=0,A=1,b=2,C=-1,S=0,D=8;function N(ee){if(!(this instanceof N))return new N(ee);this.options=e.assign({level:C,method:D,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},ee||{});var Q=this.options;Q.raw&&Q.windowBits>0?Q.windowBits=-Q.windowBits:Q.gzip&&Q.windowBits>0&&Q.windowBits<16&&(Q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var X=t.deflateInit2(this.strm,Q.level,Q.method,Q.windowBits,Q.memLevel,Q.strategy);if(X!==h)throw new Error(n[X]);if(Q.header&&t.deflateSetHeader(this.strm,Q.header),Q.dictionary){var pe;if(typeof Q.dictionary=="string"?pe=r.string2buf(Q.dictionary):o.call(Q.dictionary)==="[object ArrayBuffer]"?pe=new Uint8Array(Q.dictionary):pe=Q.dictionary,X=t.deflateSetDictionary(this.strm,pe),X!==h)throw new Error(n[X]);this._dict_set=!0}}N.prototype.push=function(ee,Q){var X=this.strm,pe=this.options.chunkSize,Y,Ge;if(this.ended)return!1;Ge=Q===~~Q?Q:Q===!0?l:s,typeof ee=="string"?X.input=r.string2buf(ee):o.call(ee)==="[object ArrayBuffer]"?X.input=new Uint8Array(ee):X.input=ee,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new e.Buf8(pe),X.next_out=0,X.avail_out=pe),Y=t.deflate(X,Ge),Y!==A&&Y!==h)return this.onEnd(Y),this.ended=!0,!1;(X.avail_out===0||X.avail_in===0&&(Ge===l||Ge===b))&&(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf(X.output,X.next_out))):this.onData(e.shrinkBuf(X.output,X.next_out)))}while((X.avail_in>0||X.avail_out===0)&&Y!==A);return Ge===l?(Y=t.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===h):(Ge===b&&(this.onEnd(h),X.avail_out=0),!0)},N.prototype.onData=function(ee){this.chunks.push(ee)},N.prototype.onEnd=function(ee){ee===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=ee,this.msg=this.strm.msg};function U(ee,Q){var X=new N(Q);if(X.push(ee,!0),X.err)throw X.msg||n[X.err];return X.result}function V(ee,Q){return Q=Q||{},Q.raw=!0,U(ee,Q)}function j(ee,Q){return Q=Q||{},Q.gzip=!0,U(ee,Q)}return Gd.Deflate=N,Gd.deflate=U,Gd.deflateRaw=V,Gd.gzip=j,Gd}var zd={},Ra={},$1,wL;function X1e(){if(wL)return $1;wL=1;var t=30,e=12;return $1=function(r,n){var i,o,s,l,h,A,b,C,S,D,N,U,V,j,ee,Q,X,pe,Y,Ge,ze,de,ce,De,J;i=r.state,o=r.next_in,De=r.input,s=o+(r.avail_in-5),l=r.next_out,J=r.output,h=l-(n-r.avail_out),A=l+(r.avail_out-257),b=i.dmax,C=i.wsize,S=i.whave,D=i.wnext,N=i.window,U=i.hold,V=i.bits,j=i.lencode,ee=i.distcode,Q=(1<<i.lenbits)-1,X=(1<<i.distbits)-1;e:do{V<15&&(U+=De[o++]<<V,V+=8,U+=De[o++]<<V,V+=8),pe=j[U&Q];t:for(;;){if(Y=pe>>>24,U>>>=Y,V-=Y,Y=pe>>>16&255,Y===0)J[l++]=pe&65535;else if(Y&16){Ge=pe&65535,Y&=15,Y&&(V<Y&&(U+=De[o++]<<V,V+=8),Ge+=U&(1<<Y)-1,U>>>=Y,V-=Y),V<15&&(U+=De[o++]<<V,V+=8,U+=De[o++]<<V,V+=8),pe=ee[U&X];r:for(;;){if(Y=pe>>>24,U>>>=Y,V-=Y,Y=pe>>>16&255,Y&16){if(ze=pe&65535,Y&=15,V<Y&&(U+=De[o++]<<V,V+=8,V<Y&&(U+=De[o++]<<V,V+=8)),ze+=U&(1<<Y)-1,ze>b){r.msg="invalid distance too far back",i.mode=t;break e}if(U>>>=Y,V-=Y,Y=l-h,ze>Y){if(Y=ze-Y,Y>S&&i.sane){r.msg="invalid distance too far back",i.mode=t;break e}if(de=0,ce=N,D===0){if(de+=C-Y,Y<Ge){Ge-=Y;do J[l++]=N[de++];while(--Y);de=l-ze,ce=J}}else if(D<Y){if(de+=C+D-Y,Y-=D,Y<Ge){Ge-=Y;do J[l++]=N[de++];while(--Y);if(de=0,D<Ge){Y=D,Ge-=Y;do J[l++]=N[de++];while(--Y);de=l-ze,ce=J}}}else if(de+=D-Y,Y<Ge){Ge-=Y;do J[l++]=N[de++];while(--Y);de=l-ze,ce=J}for(;Ge>2;)J[l++]=ce[de++],J[l++]=ce[de++],J[l++]=ce[de++],Ge-=3;Ge&&(J[l++]=ce[de++],Ge>1&&(J[l++]=ce[de++]))}else{de=l-ze;do J[l++]=J[de++],J[l++]=J[de++],J[l++]=J[de++],Ge-=3;while(Ge>2);Ge&&(J[l++]=J[de++],Ge>1&&(J[l++]=J[de++]))}}else if((Y&64)===0){pe=ee[(pe&65535)+(U&(1<<Y)-1)];continue r}else{r.msg="invalid distance code",i.mode=t;break e}break}}else if((Y&64)===0){pe=j[(pe&65535)+(U&(1<<Y)-1)];continue t}else if(Y&32){i.mode=e;break e}else{r.msg="invalid literal/length code",i.mode=t;break e}break}}while(o<s&&l<A);Ge=V>>3,o-=Ge,V-=Ge<<3,U&=(1<<V)-1,r.next_in=o,r.next_out=l,r.avail_in=o<s?5+(s-o):5-(o-s),r.avail_out=l<A?257+(A-l):257-(l-A),i.hold=U,i.bits=V},$1}var q1,CL;function Q1e(){if(CL)return q1;CL=1;var t=ph(),e=15,r=852,n=592,i=0,o=1,s=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],A=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],b=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return q1=function(C,S,D,N,U,V,j,ee){var Q=ee.bits,X=0,pe=0,Y=0,Ge=0,ze=0,de=0,ce=0,De=0,J=0,ue=0,Ee,ct,Ce,Le,Ne,$e=null,it=0,ot,dt=new t.Buf16(e+1),Mt=new t.Buf16(e+1),St=null,st=0,Ar,Qt,Zt;for(X=0;X<=e;X++)dt[X]=0;for(pe=0;pe<N;pe++)dt[S[D+pe]]++;for(ze=Q,Ge=e;Ge>=1&&dt[Ge]===0;Ge--);if(ze>Ge&&(ze=Ge),Ge===0)return U[V++]=1<<24|64<<16|0,U[V++]=1<<24|64<<16|0,ee.bits=1,0;for(Y=1;Y<Ge&&dt[Y]===0;Y++);for(ze<Y&&(ze=Y),De=1,X=1;X<=e;X++)if(De<<=1,De-=dt[X],De<0)return-1;if(De>0&&(C===i||Ge!==1))return-1;for(Mt[1]=0,X=1;X<e;X++)Mt[X+1]=Mt[X]+dt[X];for(pe=0;pe<N;pe++)S[D+pe]!==0&&(j[Mt[S[D+pe]]++]=pe);if(C===i?($e=St=j,ot=19):C===o?($e=l,it-=257,St=h,st-=257,ot=256):($e=A,St=b,ot=-1),ue=0,pe=0,X=Y,Ne=V,de=ze,ce=0,Ce=-1,J=1<<ze,Le=J-1,C===o&&J>r||C===s&&J>n)return 1;for(;;){Ar=X-ce,j[pe]<ot?(Qt=0,Zt=j[pe]):j[pe]>ot?(Qt=St[st+j[pe]],Zt=$e[it+j[pe]]):(Qt=96,Zt=0),Ee=1<<X-ce,ct=1<<de,Y=ct;do ct-=Ee,U[Ne+(ue>>ce)+ct]=Ar<<24|Qt<<16|Zt|0;while(ct!==0);for(Ee=1<<X-1;ue&Ee;)Ee>>=1;if(Ee!==0?(ue&=Ee-1,ue+=Ee):ue=0,pe++,--dt[X]===0){if(X===Ge)break;X=S[D+j[pe]]}if(X>ze&&(ue&Le)!==Ce){for(ce===0&&(ce=ze),Ne+=Y,de=X-ce,De=1<<de;de+ce<Ge&&(De-=dt[de+ce],!(De<=0));)de++,De<<=1;if(J+=1<<de,C===o&&J>r||C===s&&J>n)return 1;Ce=ue&Le,U[Ce]=ze<<24|de<<16|Ne-V|0}}return ue!==0&&(U[Ne+ue]=X-ce<<24|64<<16|0),ee.bits=ze,0},q1}var EL;function Z1e(){if(EL)return Ra;EL=1;var t=ph(),e=v5(),r=x5(),n=X1e(),i=Q1e(),o=0,s=1,l=2,h=4,A=5,b=6,C=0,S=1,D=2,N=-2,U=-3,V=-4,j=-5,ee=8,Q=1,X=2,pe=3,Y=4,Ge=5,ze=6,de=7,ce=8,De=9,J=10,ue=11,Ee=12,ct=13,Ce=14,Le=15,Ne=16,$e=17,it=18,ot=19,dt=20,Mt=21,St=22,st=23,Ar=24,Qt=25,Zt=26,Ht=27,dr=28,ln=29,Lr=30,vr=31,Hn=32,_r=852,yr=592,un=15,Rr=un;function ci(qe){return(qe>>>24&255)+(qe>>>8&65280)+((qe&65280)<<8)+((qe&255)<<24)}function qn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mn(qe){var Lt;return!qe||!qe.state?N:(Lt=qe.state,qe.total_in=qe.total_out=Lt.total=0,qe.msg="",Lt.wrap&&(qe.adler=Lt.wrap&1),Lt.mode=Q,Lt.last=0,Lt.havedict=0,Lt.dmax=32768,Lt.head=null,Lt.hold=0,Lt.bits=0,Lt.lencode=Lt.lendyn=new t.Buf32(_r),Lt.distcode=Lt.distdyn=new t.Buf32(yr),Lt.sane=1,Lt.back=-1,C)}function ri(qe){var Lt;return!qe||!qe.state?N:(Lt=qe.state,Lt.wsize=0,Lt.whave=0,Lt.wnext=0,mn(qe))}function Vn(qe,Lt){var ge,Gt;return!qe||!qe.state||(Gt=qe.state,Lt<0?(ge=0,Lt=-Lt):(ge=(Lt>>4)+1,Lt<48&&(Lt&=15)),Lt&&(Lt<8||Lt>15))?N:(Gt.window!==null&&Gt.wbits!==Lt&&(Gt.window=null),Gt.wrap=ge,Gt.wbits=Lt,ri(qe))}function Tn(qe,Lt){var ge,Gt;return qe?(Gt=new qn,qe.state=Gt,Gt.window=null,ge=Vn(qe,Lt),ge!==C&&(qe.state=null),ge):N}function Yn(qe){return Tn(qe,Rr)}var zt=!0,gr,Mr;function nn(qe){if(zt){var Lt;for(gr=new t.Buf32(512),Mr=new t.Buf32(32),Lt=0;Lt<144;)qe.lens[Lt++]=8;for(;Lt<256;)qe.lens[Lt++]=9;for(;Lt<280;)qe.lens[Lt++]=7;for(;Lt<288;)qe.lens[Lt++]=8;for(i(s,qe.lens,0,288,gr,0,qe.work,{bits:9}),Lt=0;Lt<32;)qe.lens[Lt++]=5;i(l,qe.lens,0,32,Mr,0,qe.work,{bits:5}),zt=!1}qe.lencode=gr,qe.lenbits=9,qe.distcode=Mr,qe.distbits=5}function _i(qe,Lt,ge,Gt){var wt,H=qe.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new t.Buf8(H.wsize)),Gt>=H.wsize?(t.arraySet(H.window,Lt,ge-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(wt=H.wsize-H.wnext,wt>Gt&&(wt=Gt),t.arraySet(H.window,Lt,ge-Gt,wt,H.wnext),Gt-=wt,Gt?(t.arraySet(H.window,Lt,ge-Gt,Gt,0),H.wnext=Gt,H.whave=H.wsize):(H.wnext+=wt,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=wt))),0}function Se(qe,Lt){var ge,Gt,wt,H,yt,Bt,xe,Ke,lt,Z,ne,ae,ye,Oe,fe=0,be,oe,we,g,le,Ct,Qe,Et,Pt=new t.Buf8(4),Dt,ht,Ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!qe||!qe.state||!qe.output||!qe.input&&qe.avail_in!==0)return N;ge=qe.state,ge.mode===Ee&&(ge.mode=ct),yt=qe.next_out,wt=qe.output,xe=qe.avail_out,H=qe.next_in,Gt=qe.input,Bt=qe.avail_in,Ke=ge.hold,lt=ge.bits,Z=Bt,ne=xe,Et=C;e:for(;;)switch(ge.mode){case Q:if(ge.wrap===0){ge.mode=ct;break}for(;lt<16;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(ge.wrap&2&&Ke===35615){ge.check=0,Pt[0]=Ke&255,Pt[1]=Ke>>>8&255,ge.check=r(ge.check,Pt,2,0),Ke=0,lt=0,ge.mode=X;break}if(ge.flags=0,ge.head&&(ge.head.done=!1),!(ge.wrap&1)||(((Ke&255)<<8)+(Ke>>8))%31){qe.msg="incorrect header check",ge.mode=Lr;break}if((Ke&15)!==ee){qe.msg="unknown compression method",ge.mode=Lr;break}if(Ke>>>=4,lt-=4,Qe=(Ke&15)+8,ge.wbits===0)ge.wbits=Qe;else if(Qe>ge.wbits){qe.msg="invalid window size",ge.mode=Lr;break}ge.dmax=1<<Qe,qe.adler=ge.check=1,ge.mode=Ke&512?J:Ee,Ke=0,lt=0;break;case X:for(;lt<16;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(ge.flags=Ke,(ge.flags&255)!==ee){qe.msg="unknown compression method",ge.mode=Lr;break}if(ge.flags&57344){qe.msg="unknown header flags set",ge.mode=Lr;break}ge.head&&(ge.head.text=Ke>>8&1),ge.flags&512&&(Pt[0]=Ke&255,Pt[1]=Ke>>>8&255,ge.check=r(ge.check,Pt,2,0)),Ke=0,lt=0,ge.mode=pe;case pe:for(;lt<32;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.head&&(ge.head.time=Ke),ge.flags&512&&(Pt[0]=Ke&255,Pt[1]=Ke>>>8&255,Pt[2]=Ke>>>16&255,Pt[3]=Ke>>>24&255,ge.check=r(ge.check,Pt,4,0)),Ke=0,lt=0,ge.mode=Y;case Y:for(;lt<16;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.head&&(ge.head.xflags=Ke&255,ge.head.os=Ke>>8),ge.flags&512&&(Pt[0]=Ke&255,Pt[1]=Ke>>>8&255,ge.check=r(ge.check,Pt,2,0)),Ke=0,lt=0,ge.mode=Ge;case Ge:if(ge.flags&1024){for(;lt<16;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.length=Ke,ge.head&&(ge.head.extra_len=Ke),ge.flags&512&&(Pt[0]=Ke&255,Pt[1]=Ke>>>8&255,ge.check=r(ge.check,Pt,2,0)),Ke=0,lt=0}else ge.head&&(ge.head.extra=null);ge.mode=ze;case ze:if(ge.flags&1024&&(ae=ge.length,ae>Bt&&(ae=Bt),ae&&(ge.head&&(Qe=ge.head.extra_len-ge.length,ge.head.extra||(ge.head.extra=new Array(ge.head.extra_len)),t.arraySet(ge.head.extra,Gt,H,ae,Qe)),ge.flags&512&&(ge.check=r(ge.check,Gt,ae,H)),Bt-=ae,H+=ae,ge.length-=ae),ge.length))break e;ge.length=0,ge.mode=de;case de:if(ge.flags&2048){if(Bt===0)break e;ae=0;do Qe=Gt[H+ae++],ge.head&&Qe&&ge.length<65536&&(ge.head.name+=String.fromCharCode(Qe));while(Qe&&ae<Bt);if(ge.flags&512&&(ge.check=r(ge.check,Gt,ae,H)),Bt-=ae,H+=ae,Qe)break e}else ge.head&&(ge.head.name=null);ge.length=0,ge.mode=ce;case ce:if(ge.flags&4096){if(Bt===0)break e;ae=0;do Qe=Gt[H+ae++],ge.head&&Qe&&ge.length<65536&&(ge.head.comment+=String.fromCharCode(Qe));while(Qe&&ae<Bt);if(ge.flags&512&&(ge.check=r(ge.check,Gt,ae,H)),Bt-=ae,H+=ae,Qe)break e}else ge.head&&(ge.head.comment=null);ge.mode=De;case De:if(ge.flags&512){for(;lt<16;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(Ke!==(ge.check&65535)){qe.msg="header crc mismatch",ge.mode=Lr;break}Ke=0,lt=0}ge.head&&(ge.head.hcrc=ge.flags>>9&1,ge.head.done=!0),qe.adler=ge.check=0,ge.mode=Ee;break;case J:for(;lt<32;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}qe.adler=ge.check=ci(Ke),Ke=0,lt=0,ge.mode=ue;case ue:if(ge.havedict===0)return qe.next_out=yt,qe.avail_out=xe,qe.next_in=H,qe.avail_in=Bt,ge.hold=Ke,ge.bits=lt,D;qe.adler=ge.check=1,ge.mode=Ee;case Ee:if(Lt===A||Lt===b)break e;case ct:if(ge.last){Ke>>>=lt&7,lt-=lt&7,ge.mode=Ht;break}for(;lt<3;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}switch(ge.last=Ke&1,Ke>>>=1,lt-=1,Ke&3){case 0:ge.mode=Ce;break;case 1:if(nn(ge),ge.mode=dt,Lt===b){Ke>>>=2,lt-=2;break e}break;case 2:ge.mode=$e;break;case 3:qe.msg="invalid block type",ge.mode=Lr}Ke>>>=2,lt-=2;break;case Ce:for(Ke>>>=lt&7,lt-=lt&7;lt<32;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if((Ke&65535)!==(Ke>>>16^65535)){qe.msg="invalid stored block lengths",ge.mode=Lr;break}if(ge.length=Ke&65535,Ke=0,lt=0,ge.mode=Le,Lt===b)break e;case Le:ge.mode=Ne;case Ne:if(ae=ge.length,ae){if(ae>Bt&&(ae=Bt),ae>xe&&(ae=xe),ae===0)break e;t.arraySet(wt,Gt,H,ae,yt),Bt-=ae,H+=ae,xe-=ae,yt+=ae,ge.length-=ae;break}ge.mode=Ee;break;case $e:for(;lt<14;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(ge.nlen=(Ke&31)+257,Ke>>>=5,lt-=5,ge.ndist=(Ke&31)+1,Ke>>>=5,lt-=5,ge.ncode=(Ke&15)+4,Ke>>>=4,lt-=4,ge.nlen>286||ge.ndist>30){qe.msg="too many length or distance symbols",ge.mode=Lr;break}ge.have=0,ge.mode=it;case it:for(;ge.have<ge.ncode;){for(;lt<3;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.lens[Ft[ge.have++]]=Ke&7,Ke>>>=3,lt-=3}for(;ge.have<19;)ge.lens[Ft[ge.have++]]=0;if(ge.lencode=ge.lendyn,ge.lenbits=7,Dt={bits:ge.lenbits},Et=i(o,ge.lens,0,19,ge.lencode,0,ge.work,Dt),ge.lenbits=Dt.bits,Et){qe.msg="invalid code lengths set",ge.mode=Lr;break}ge.have=0,ge.mode=ot;case ot:for(;ge.have<ge.nlen+ge.ndist;){for(;fe=ge.lencode[Ke&(1<<ge.lenbits)-1],be=fe>>>24,oe=fe>>>16&255,we=fe&65535,!(be<=lt);){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(we<16)Ke>>>=be,lt-=be,ge.lens[ge.have++]=we;else{if(we===16){for(ht=be+2;lt<ht;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(Ke>>>=be,lt-=be,ge.have===0){qe.msg="invalid bit length repeat",ge.mode=Lr;break}Qe=ge.lens[ge.have-1],ae=3+(Ke&3),Ke>>>=2,lt-=2}else if(we===17){for(ht=be+3;lt<ht;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}Ke>>>=be,lt-=be,Qe=0,ae=3+(Ke&7),Ke>>>=3,lt-=3}else{for(ht=be+7;lt<ht;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}Ke>>>=be,lt-=be,Qe=0,ae=11+(Ke&127),Ke>>>=7,lt-=7}if(ge.have+ae>ge.nlen+ge.ndist){qe.msg="invalid bit length repeat",ge.mode=Lr;break}for(;ae--;)ge.lens[ge.have++]=Qe}}if(ge.mode===Lr)break;if(ge.lens[256]===0){qe.msg="invalid code -- missing end-of-block",ge.mode=Lr;break}if(ge.lenbits=9,Dt={bits:ge.lenbits},Et=i(s,ge.lens,0,ge.nlen,ge.lencode,0,ge.work,Dt),ge.lenbits=Dt.bits,Et){qe.msg="invalid literal/lengths set",ge.mode=Lr;break}if(ge.distbits=6,ge.distcode=ge.distdyn,Dt={bits:ge.distbits},Et=i(l,ge.lens,ge.nlen,ge.ndist,ge.distcode,0,ge.work,Dt),ge.distbits=Dt.bits,Et){qe.msg="invalid distances set",ge.mode=Lr;break}if(ge.mode=dt,Lt===b)break e;case dt:ge.mode=Mt;case Mt:if(Bt>=6&&xe>=258){qe.next_out=yt,qe.avail_out=xe,qe.next_in=H,qe.avail_in=Bt,ge.hold=Ke,ge.bits=lt,n(qe,ne),yt=qe.next_out,wt=qe.output,xe=qe.avail_out,H=qe.next_in,Gt=qe.input,Bt=qe.avail_in,Ke=ge.hold,lt=ge.bits,ge.mode===Ee&&(ge.back=-1);break}for(ge.back=0;fe=ge.lencode[Ke&(1<<ge.lenbits)-1],be=fe>>>24,oe=fe>>>16&255,we=fe&65535,!(be<=lt);){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(oe&&(oe&240)===0){for(g=be,le=oe,Ct=we;fe=ge.lencode[Ct+((Ke&(1<<g+le)-1)>>g)],be=fe>>>24,oe=fe>>>16&255,we=fe&65535,!(g+be<=lt);){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}Ke>>>=g,lt-=g,ge.back+=g}if(Ke>>>=be,lt-=be,ge.back+=be,ge.length=we,oe===0){ge.mode=Zt;break}if(oe&32){ge.back=-1,ge.mode=Ee;break}if(oe&64){qe.msg="invalid literal/length code",ge.mode=Lr;break}ge.extra=oe&15,ge.mode=St;case St:if(ge.extra){for(ht=ge.extra;lt<ht;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.length+=Ke&(1<<ge.extra)-1,Ke>>>=ge.extra,lt-=ge.extra,ge.back+=ge.extra}ge.was=ge.length,ge.mode=st;case st:for(;fe=ge.distcode[Ke&(1<<ge.distbits)-1],be=fe>>>24,oe=fe>>>16&255,we=fe&65535,!(be<=lt);){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if((oe&240)===0){for(g=be,le=oe,Ct=we;fe=ge.distcode[Ct+((Ke&(1<<g+le)-1)>>g)],be=fe>>>24,oe=fe>>>16&255,we=fe&65535,!(g+be<=lt);){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}Ke>>>=g,lt-=g,ge.back+=g}if(Ke>>>=be,lt-=be,ge.back+=be,oe&64){qe.msg="invalid distance code",ge.mode=Lr;break}ge.offset=we,ge.extra=oe&15,ge.mode=Ar;case Ar:if(ge.extra){for(ht=ge.extra;lt<ht;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}ge.offset+=Ke&(1<<ge.extra)-1,Ke>>>=ge.extra,lt-=ge.extra,ge.back+=ge.extra}if(ge.offset>ge.dmax){qe.msg="invalid distance too far back",ge.mode=Lr;break}ge.mode=Qt;case Qt:if(xe===0)break e;if(ae=ne-xe,ge.offset>ae){if(ae=ge.offset-ae,ae>ge.whave&&ge.sane){qe.msg="invalid distance too far back",ge.mode=Lr;break}ae>ge.wnext?(ae-=ge.wnext,ye=ge.wsize-ae):ye=ge.wnext-ae,ae>ge.length&&(ae=ge.length),Oe=ge.window}else Oe=wt,ye=yt-ge.offset,ae=ge.length;ae>xe&&(ae=xe),xe-=ae,ge.length-=ae;do wt[yt++]=Oe[ye++];while(--ae);ge.length===0&&(ge.mode=Mt);break;case Zt:if(xe===0)break e;wt[yt++]=ge.length,xe--,ge.mode=Mt;break;case Ht:if(ge.wrap){for(;lt<32;){if(Bt===0)break e;Bt--,Ke|=Gt[H++]<<lt,lt+=8}if(ne-=xe,qe.total_out+=ne,ge.total+=ne,ne&&(qe.adler=ge.check=ge.flags?r(ge.check,wt,ne,yt-ne):e(ge.check,wt,ne,yt-ne)),ne=xe,(ge.flags?Ke:ci(Ke))!==ge.check){qe.msg="incorrect data check",ge.mode=Lr;break}Ke=0,lt=0}ge.mode=dr;case dr:if(ge.wrap&&ge.flags){for(;lt<32;){if(Bt===0)break e;Bt--,Ke+=Gt[H++]<<lt,lt+=8}if(Ke!==(ge.total&4294967295)){qe.msg="incorrect length check",ge.mode=Lr;break}Ke=0,lt=0}ge.mode=ln;case ln:Et=S;break e;case Lr:Et=U;break e;case vr:return V;case Hn:default:return N}return qe.next_out=yt,qe.avail_out=xe,qe.next_in=H,qe.avail_in=Bt,ge.hold=Ke,ge.bits=lt,(ge.wsize||ne!==qe.avail_out&&ge.mode<Lr&&(ge.mode<Ht||Lt!==h))&&_i(qe,qe.output,qe.next_out,ne-qe.avail_out),Z-=qe.avail_in,ne-=qe.avail_out,qe.total_in+=Z,qe.total_out+=ne,ge.total+=ne,ge.wrap&&ne&&(qe.adler=ge.check=ge.flags?r(ge.check,wt,ne,qe.next_out-ne):e(ge.check,wt,ne,qe.next_out-ne)),qe.data_type=ge.bits+(ge.last?64:0)+(ge.mode===Ee?128:0)+(ge.mode===dt||ge.mode===Le?256:0),(Z===0&&ne===0||Lt===h)&&Et===C&&(Et=j),Et}function kt(qe){if(!qe||!qe.state)return N;var Lt=qe.state;return Lt.window&&(Lt.window=null),qe.state=null,C}function Jt(qe,Lt){var ge;return!qe||!qe.state||(ge=qe.state,(ge.wrap&2)===0)?N:(ge.head=Lt,Lt.done=!1,C)}function cr(qe,Lt){var ge=Lt.length,Gt,wt,H;return!qe||!qe.state||(Gt=qe.state,Gt.wrap!==0&&Gt.mode!==ue)?N:Gt.mode===ue&&(wt=1,wt=e(wt,Lt,ge,0),wt!==Gt.check)?U:(H=_i(qe,Lt,ge,ge),H?(Gt.mode=vr,V):(Gt.havedict=1,C))}return Ra.inflateReset=ri,Ra.inflateReset2=Vn,Ra.inflateResetKeep=mn,Ra.inflateInit=Yn,Ra.inflateInit2=Tn,Ra.inflate=Se,Ra.inflateEnd=kt,Ra.inflateGetHeader=Jt,Ra.inflateSetDictionary=cr,Ra.inflateInfo="pako inflate (from Nodeca project)",Ra}var BL,TL;function E5(){return TL||(TL=1,BL={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),BL}var Y1,SL;function $1e(){if(SL)return Y1;SL=1;function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return Y1=t,Y1}var IL;function q1e(){if(IL)return zd;IL=1;var t=Z1e(),e=ph(),r=w5(),n=E5(),i=EE(),o=C5(),s=$1e(),l=Object.prototype.toString;function h(C){if(!(this instanceof h))return new h(C);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},C||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(C&&C.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15)===0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var D=t.inflateInit2(this.strm,S.windowBits);if(D!==n.Z_OK)throw new Error(i[D]);if(this.header=new s,t.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=r.string2buf(S.dictionary):l.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(D=t.inflateSetDictionary(this.strm,S.dictionary),D!==n.Z_OK)))throw new Error(i[D])}h.prototype.push=function(C,S){var D=this.strm,N=this.options.chunkSize,U=this.options.dictionary,V,j,ee,Q,X,pe=!1;if(this.ended)return!1;j=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof C=="string"?D.input=r.binstring2buf(C):l.call(C)==="[object ArrayBuffer]"?D.input=new Uint8Array(C):D.input=C,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new e.Buf8(N),D.next_out=0,D.avail_out=N),V=t.inflate(D,n.Z_NO_FLUSH),V===n.Z_NEED_DICT&&U&&(V=t.inflateSetDictionary(this.strm,U)),V===n.Z_BUF_ERROR&&pe===!0&&(V=n.Z_OK,pe=!1),V!==n.Z_STREAM_END&&V!==n.Z_OK)return this.onEnd(V),this.ended=!0,!1;D.next_out&&(D.avail_out===0||V===n.Z_STREAM_END||D.avail_in===0&&(j===n.Z_FINISH||j===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(ee=r.utf8border(D.output,D.next_out),Q=D.next_out-ee,X=r.buf2string(D.output,ee),D.next_out=Q,D.avail_out=N-Q,Q&&e.arraySet(D.output,D.output,ee,Q,0),this.onData(X)):this.onData(e.shrinkBuf(D.output,D.next_out))),D.avail_in===0&&D.avail_out===0&&(pe=!0)}while((D.avail_in>0||D.avail_out===0)&&V!==n.Z_STREAM_END);return V===n.Z_STREAM_END&&(j=n.Z_FINISH),j===n.Z_FINISH?(V=t.inflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===n.Z_OK):(j===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),D.avail_out=0),!0)},h.prototype.onData=function(C){this.chunks.push(C)},h.prototype.onEnd=function(C){C===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg};function A(C,S){var D=new h(S);if(D.push(C,!0),D.err)throw D.msg||i[D.err];return D.result}function b(C,S){return S=S||{},S.raw=!0,A(C,S)}return zd.Inflate=h,zd.inflate=A,zd.inflateRaw=b,zd.ungzip=A,zd}var e2,ML;function Y1e(){if(ML)return e2;ML=1;var t=ph().assign,e=K1e(),r=q1e(),n=E5(),i={};return t(i,e,r,n),e2=i,e2}var e2e=Y1e();const jd=bf(e2e),PL=[0],t2e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:b5,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Qx extends Bs{initializeState(){"onTileLoadFail"in this.props&&$r.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:n}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const o in i)i[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:r,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,r[e.id]=e;const i=n?.[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){const n=r&&r.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:r}){const{tile:n}=e.props,{id:i}=r;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const r=e.sourceTile,n=this.state.layerMap[r?.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:r={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,o={loadOptions:{...r}};let s=e;if(i.preload){const A=await i.preload(e,r);A.url&&(s=A.url),A.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:A.headers}),Object.assign(o,A)}const l=await eA(s,i,o.loadOptions),h=new S_e(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(e){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:r}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!r||r.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Yc.POINTCLOUD:return this._makePointCloudLayer(e,r);case Yc.SCENEGRAPH:return this._make3DModelLayer(e);case Yc.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){const{attributes:n,pointCount:i,constantRGBA:o,cartographicOrigin:s,modelMatrix:l}=e.content,{positions:h,normals:A,colors:b}=n;if(!h)return null;const C=r&&r.props.data||{header:{vertexCount:i},attributes:{POSITION:h,NORMAL:A,COLOR_0:b}},{pointSize:S,getPointColor:D}=this.props,N=this.getSubLayerClass("pointcloud",kg);return new N({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:C,coordinateSystem:Yr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:l,getColor:o||D,_offset:0})}_make3DModelLayer(e){const{gltf:r,instances:n,cartographicOrigin:i,modelMatrix:o}=e.content,s=this.getSubLayerClass("scenegraph",jg);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||PL,scenegraph:r,coordinateSystem:Yr.METER_OFFSETS,coordinateOrigin:i,modelMatrix:o,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){const n=e.content,{attributes:i,indices:o,modelMatrix:s,cartographicOrigin:l,coordinateSystem:h=Yr.METER_OFFSETS,material:A,featureIds:b}=n,{_getMeshColor:C}=this.props,S=r&&r.props.mesh||new eo({topology:"triangle-list",attributes:r2e(i),indices:o}),D=this.getSubLayerClass("mesh",Ux);return new D(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:S,data:PL,getColor:C(e),pbrMaterial:A,modelMatrix:s,coordinateOrigin:l,coordinateSystem:h,featureIds:b,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(n=>{const i=r[n.id]=r[n.id]||{tile:n};let{layer:o}=i;return n.selected&&(o?i.needsUpdate&&(o=this._getSubLayer(n,o),i.needsUpdate=!1):o=this._getSubLayer(n)),i.layer=o,o}).filter(Boolean):null}}Qx.defaultProps=t2e,Qx.layerName="Tile3DLayer";function r2e(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const n2e="4.3.1",B5={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:n2e,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...B5});const LL=[1],i2e={...su.defaultProps,elevationData:q_,texture:{...q_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[B5]};function RL(t){return Array.isArray(t)?t.join(";"):t||""}class Zx extends Bs{updateState({props:e,oldProps:r}){const n=e.elevationData!==r.elevationData;if(n){const{elevationData:o}=e,s=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:s})}const i=n||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&i){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&$r.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:n,meshMaxError:i,signal:o}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?i*2:0,...s?.terrain,bounds:r,meshMaxError:i,elevationDecoder:n}};const{fetch:l}=this.props;return l(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:r,fetch:n,texture:i,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:l}=this.context,h=gf(r,e),A=i&&gf(i,e),{signal:b}=e;let C=[0,0],S=[0,0];if(l.isGeospatial){const V=e.bbox;C=l.projectFlat([V.west,V.south]),S=l.projectFlat([V.east,V.north])}else{const V=e.bbox;C=[V.left,V.bottom],S=[V.right,V.top]}const D=[C[0],C[1],S[0],S[1]],N=this.loadTerrain({elevationData:h,bounds:D,elevationDecoder:o,meshMaxError:s,signal:b}),U=A?n(A,{propName:"texture",layer:this,loaders:[],signal:b}).catch(V=>null):Promise.resolve(null);return Promise.all([N,U])}renderSubLayers(e){const r=this.getSubLayerClass("mesh",mf),{color:n,wireframe:i,material:o}=this.props,{data:s}=e;if(!s)return null;const[l,h]=s;return new r(e,{data:LL,mesh:l,texture:h,_instanced:!1,coordinateSystem:Yr.CARTESIAN,getPosition:A=>[0,0,0],getColor:n,wireframe:i,material:o})}onViewportLoad(e){if(!e)return;const{zRange:r}=this.state,n=e.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(l=>l[2]));if(n.length===0)return;const i=Math.min(...n.map(s=>s[0])),o=Math.max(...n.map(s=>s[1]));(!r||i<r[0]||o>r[1])&&this.setState({zRange:[i,o]})}renderLayers(){const{color:e,material:r,elevationData:n,texture:i,wireframe:o,meshMaxError:s,elevationDecoder:l,tileSize:h,maxZoom:A,minZoom:b,extent:C,maxRequests:S,onTileLoad:D,onTileUnload:N,onTileError:U,maxCacheSize:V,maxCacheByteSize:j,refinementStrategy:ee}=this.props;if(this.state.isTiled)return new su(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:RL(n),texture:RL(i),meshMaxError:s,elevationDecoder:l}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:h,maxZoom:A,minZoom:b,extent:C,maxRequests:S,onTileLoad:D,onTileUnload:N,onTileError:U,maxCacheSize:V,maxCacheByteSize:j,refinementStrategy:ee});if(!n)return null;const Q=this.getSubLayerClass("mesh",mf);return new Q(this.getSubLayerProps({id:"mesh"}),{data:LL,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:X=>[0,0,0],getColor:e,material:r,wireframe:o})}}Zx.defaultProps=i2e,Zx.layerName="TerrainLayer";const s2e={clipBounds:[0,0,1,1],clipByInstance:void 0},T5=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,o2e={name:"clip",vs:T5,uniformTypes:{bounds:"vec4<f32>"}},a2e={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},l2e={name:"clip",fs:T5,uniformTypes:{bounds:"vec4<f32>"}},c2e={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class uy extends M_{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[o2e],inject:a2e}:{modules:[l2e],inject:c2e}}draw(){const{clipBounds:e}=this.props,r={};if(this.state.clipByInstance)r.bounds=e;else{const n=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);r.bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}this.setShaderModuleProps({clip:r})}}uy.defaultProps=s2e,uy.extensionName="ClipExtension";const u2e=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,h2e={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},f2e=t=>{if(!t||!("dummyCollisionMap"in t))return{};const{enabled:e,collisionFBO:r,drawToCollisionMap:n,dummyCollisionMap:i}=t;return{enabled:e&&!n,sort:!!n,collision_texture:!n&&r?r.colorAttachments[0]:i}},d2e={name:"collision",dependencies:[Sy],vs:u2e,inject:h2e,getUniforms:f2e,uniformTypes:{sort:"i32",enabled:"i32"}};class p2e extends Iy{renderCollisionMap(e,r){const n=[0,0,0,0],i=[1,1,e.width-2,e.height-2];this.render({...r,clearColor:n,scissorRect:i,target:e,pass:"collision"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const t2=2;class A2e{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:r}=e;this.dummyCollisionMap=r.createTexture({width:1,height:1}),this.collisionFilterPass=new p2e(r,{id:"default-collision-filter"})}preRender({effects:e,layers:r,layerFilter:n,viewports:i,onViewportActive:o,views:s,isPicking:l,preRenderStats:h={}}){const{device:A}=this.context;if(l)return;const b=r.filter(({props:{visible:V,collisionEnabled:j}})=>V&&j);if(b.length===0){this.channels={};return}const C=e?.filter(V=>V.useInPicking&&h[V.id]),S=h["mask-effect"]?.didRender,D=this._groupByCollisionGroup(A,b),N=i[0],U=!this.lastViewport||!this.lastViewport.equals(N)||S;for(const V in D){const j=this.collisionFBOs[V],ee=D[V],[Q,X]=A.canvasContext.getPixelSize();j.resize({width:Q/t2,height:X/t2}),this._render(ee,{effects:C,layerFilter:n,onViewportActive:o,views:s,viewport:N,viewportChanged:U})}}_render(e,{effects:r,layerFilter:n,onViewportActive:i,views:o,viewport:s,viewportChanged:l}){const{collisionGroup:h}=e,A=this.channels[h];if(!A)return;const b=l||e===A||!es(A.layers,e.layers,1)||e.layerBounds.some((C,S)=>!ma(C,A.layerBounds[S]))||e.allLayersLoaded!==A.allLayersLoaded||e.layers.some(C=>C.props.transitions);if(this.channels[h]=e,b){this.lastViewport=s;const C=this.collisionFBOs[h];this.collisionFilterPass.renderCollisionMap(C,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:r,layerFilter:n,viewports:s?[s]:[],onViewportActive:i,views:o,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:C.device.canvasContext.getDevicePixelRatio()/t2}}})}}_groupByCollisionGroup(e,r){const n={};for(const i of r){const o=i.props.collisionGroup;let s=n[o];s||(s={collisionGroup:o,layers:[],layerBounds:[],allLayersLoaded:!0},n[o]=s),s.layers.push(i),s.layerBounds.push(i.getBounds()),i.isLoaded||(s.allLayersLoaded=!1)}for(const i of Object.keys(n))this.collisionFBOs[i]||this.createFBO(e,i),this.channels[i]||(this.channels[i]=n[i]);for(const i of Object.keys(this.collisionFBOs))n[i]||this.destroyFBO(i);return n}getShaderModuleProps(e){const{collisionGroup:r,collisionEnabled:n}=e.props,{collisionFBOs:i,dummyCollisionMap:o}=this,s=i[r];return{collision:{enabled:n&&!!s,collisionFBO:s,dummyCollisionMap:o}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,r){const{width:n,height:i}=e.gl.canvas,o=e.createTexture({format:"rgba8unorm",width:n,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:n,height:i,mipmaps:!1});this.collisionFBOs[r]=e.createFramebuffer({id:`collision-${r}`,width:n,height:i,colorAttachments:[o],depthStencilAttachment:s})}destroyFBO(e){const r=this.collisionFBOs[e];r.colorAttachments[0]?.destroy(),r.depthStencilAttachment?.destroy(),r.destroy(),delete this.collisionFBOs[e]}}const g2e={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class $x extends M_{getShaders(){return{modules:[d2e]}}draw({shaderModuleProps:e}){e.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,r){this.getAttributeManager()!==null&&(this.context.deck?._addDefaultEffect(new A2e),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}$x.defaultProps=g2e,$x.extensionName="CollisionFilterExtension";function qx(t,e){const r=e?.globalFeatureId;return r!==void 0?m2e(t,r):_2e(t,e?.type)}function m2e(t,e){const r=S5(t);for(const n of r){let i=0,o=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const l=n.featureIds.value[s];if(l!==o){if(e===n.globalFeatureIds.value[i])return hy(n,i,s);i=s,o=l}}if(e===n.globalFeatureIds.value[i])return hy(n,i,n.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function _2e(t,e){const r=S5(t);return b2e(r)}function y2e(t,e,r){switch(t.type){case"Point":return C2e(t,e,r);case"LineString":return w2e(t,e,r);case"Polygon":return I5(t,e,r);default:const n=t;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function S5(t,e){const r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function b2e(t){const e=[];for(const r of t){if(r.featureIds.value.length===0)continue;let n=0,i=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){const s=r.featureIds.value[o];s!==i&&(e.push(hy(r,n,o)),n=o,i=s)}e.push(hy(r,n,r.featureIds.value.length))}return e}function hy(t,e,r){const n=y2e(t,e,r),i=x2e(t,e),o=v2e(t,e);return{type:"Feature",geometry:n,properties:i,...o}}function v2e(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function x2e(t,e=0,r){const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const i in t.numericProps)n[i]=t.numericProps[i].value[e];return n}function I5(t,e=-1/0,r=1/0){const{positions:n}=t,i=t.polygonIndices.value.filter(l=>l>=e&&l<=r),o=t.primitivePolygonIndices.value.filter(l=>l>=e&&l<=r);if(!(i.length>2)){const l=[];for(let h=0;h<o.length-1;h++){const A=o[h],b=o[h+1],C=fy(n,A,b);l.push(C)}return{type:"Polygon",coordinates:l}}const s=[];for(let l=0;l<i.length-1;l++){const h=i[l],A=i[l+1],b=I5(t,h,A).coordinates;s.push(b)}return{type:"MultiPolygon",coordinates:s}}function w2e(t,e=-1/0,r=1/0){const{positions:n}=t,i=t.pathIndices.value.filter(s=>s>=e&&s<=r);if(!(i.length>2))return{type:"LineString",coordinates:fy(n,i[0],i[1])};const o=[];for(let s=0;s<i.length-1;s++){const l=fy(n,i[s],i[s+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function C2e(t,e,r){const{positions:n}=t,i=fy(n,e,r);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function fy(t,e,r){e=e||0,r=r||t.value.length/t.size;const n=[];for(let i=e;i<r;i++){const o=Array();for(let s=i*t.size;s<(i+1)*t.size;s++)o.push(Number(t.value[s]));n.push(o)}return n}var r2={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var OL;function E2e(){return OL||(OL=1,r2.read=function(t,e,r,n,i){var o,s,l=i*8-n-1,h=(1<<l)-1,A=h>>1,b=-7,C=r?i-1:0,S=r?-1:1,D=t[e+C];for(C+=S,o=D&(1<<-b)-1,D>>=-b,b+=l;b>0;o=o*256+t[e+C],C+=S,b-=8);for(s=o&(1<<-b)-1,o>>=-b,b+=n;b>0;s=s*256+t[e+C],C+=S,b-=8);if(o===0)o=1-A;else{if(o===h)return s?NaN:(D?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-A}return(D?-1:1)*s*Math.pow(2,o-n)},r2.write=function(t,e,r,n,i,o){var s,l,h,A=o*8-i-1,b=(1<<A)-1,C=b>>1,S=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=n?0:o-1,N=n?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,s=b):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),s+C>=1?e+=S/h:e+=S*Math.pow(2,1-C),e*h>=2&&(s++,h/=2),s+C>=b?(l=0,s=b):s+C>=1?(l=(e*h-1)*Math.pow(2,i),s=s+C):(l=e*Math.pow(2,C-1)*Math.pow(2,i),s=0));i>=8;t[r+D]=l&255,D+=N,l/=256,i-=8);for(s=s<<i|l,A+=i;A>0;t[r+D]=s&255,D+=N,s/=256,A-=8);t[r+D-N]|=U*128}),r2}var n2,DL;function B2e(){if(DL)return n2;DL=1,n2=e;var t=E2e();function e(J){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(J)?J:new Uint8Array(J||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=65536*65536,n=1/r,i=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf8");e.prototype={destroy:function(){this.buf=null},readFields:function(J,ue,Ee){for(Ee=Ee||this.length;this.pos<Ee;){var ct=this.readVarint(),Ce=ct>>3,Le=this.pos;this.type=ct&7,J(Ce,ue,this),this.pos===Le&&this.skip(ct)}return ue},readMessage:function(J,ue){return this.readFields(J,ue,this.readVarint()+this.pos)},readFixed32:function(){var J=Y(this.buf,this.pos);return this.pos+=4,J},readSFixed32:function(){var J=ze(this.buf,this.pos);return this.pos+=4,J},readFixed64:function(){var J=Y(this.buf,this.pos)+Y(this.buf,this.pos+4)*r;return this.pos+=8,J},readSFixed64:function(){var J=Y(this.buf,this.pos)+ze(this.buf,this.pos+4)*r;return this.pos+=8,J},readFloat:function(){var J=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,J},readDouble:function(){var J=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,J},readVarint:function(J){var ue=this.buf,Ee,ct;return ct=ue[this.pos++],Ee=ct&127,ct<128||(ct=ue[this.pos++],Ee|=(ct&127)<<7,ct<128)||(ct=ue[this.pos++],Ee|=(ct&127)<<14,ct<128)||(ct=ue[this.pos++],Ee|=(ct&127)<<21,ct<128)?Ee:(ct=ue[this.pos],Ee|=(ct&15)<<28,s(Ee,J,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var J=this.readVarint();return J%2===1?(J+1)/-2:J/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var J=this.readVarint()+this.pos,ue=this.pos;return this.pos=J,J-ue>=i&&o?ce(this.buf,ue,J):de(this.buf,ue,J)},readBytes:function(){var J=this.readVarint()+this.pos,ue=this.buf.subarray(this.pos,J);return this.pos=J,ue},readPackedVarint:function(J,ue){if(this.type!==e.Bytes)return J.push(this.readVarint(ue));var Ee=l(this);for(J=J||[];this.pos<Ee;)J.push(this.readVarint(ue));return J},readPackedSVarint:function(J){if(this.type!==e.Bytes)return J.push(this.readSVarint());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readSVarint());return J},readPackedBoolean:function(J){if(this.type!==e.Bytes)return J.push(this.readBoolean());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readBoolean());return J},readPackedFloat:function(J){if(this.type!==e.Bytes)return J.push(this.readFloat());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readFloat());return J},readPackedDouble:function(J){if(this.type!==e.Bytes)return J.push(this.readDouble());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readDouble());return J},readPackedFixed32:function(J){if(this.type!==e.Bytes)return J.push(this.readFixed32());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readFixed32());return J},readPackedSFixed32:function(J){if(this.type!==e.Bytes)return J.push(this.readSFixed32());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readSFixed32());return J},readPackedFixed64:function(J){if(this.type!==e.Bytes)return J.push(this.readFixed64());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readFixed64());return J},readPackedSFixed64:function(J){if(this.type!==e.Bytes)return J.push(this.readSFixed64());var ue=l(this);for(J=J||[];this.pos<ue;)J.push(this.readSFixed64());return J},skip:function(J){var ue=J&7;if(ue===e.Varint)for(;this.buf[this.pos++]>127;);else if(ue===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ue===e.Fixed32)this.pos+=4;else if(ue===e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ue)},writeTag:function(J,ue){this.writeVarint(J<<3|ue)},realloc:function(J){for(var ue=this.length||16;ue<this.pos+J;)ue*=2;if(ue!==this.length){var Ee=new Uint8Array(ue);Ee.set(this.buf),this.buf=Ee,this.length=ue}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(J){this.realloc(4),Ge(this.buf,J,this.pos),this.pos+=4},writeSFixed32:function(J){this.realloc(4),Ge(this.buf,J,this.pos),this.pos+=4},writeFixed64:function(J){this.realloc(8),Ge(this.buf,J&-1,this.pos),Ge(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeSFixed64:function(J){this.realloc(8),Ge(this.buf,J&-1,this.pos),Ge(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeVarint:function(J){if(J=+J||0,J>268435455||J<0){A(J,this);return}this.realloc(4),this.buf[this.pos++]=J&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=J>>>7&127)))},writeSVarint:function(J){this.writeVarint(J<0?-J*2-1:J*2)},writeBoolean:function(J){this.writeVarint(!!J)},writeString:function(J){J=String(J),this.realloc(J.length*4),this.pos++;var ue=this.pos;this.pos=De(this.buf,J,this.pos);var Ee=this.pos-ue;Ee>=128&&S(ue,Ee,this),this.pos=ue-1,this.writeVarint(Ee),this.pos+=Ee},writeFloat:function(J){this.realloc(4),t.write(this.buf,J,this.pos,!0,23,4),this.pos+=4},writeDouble:function(J){this.realloc(8),t.write(this.buf,J,this.pos,!0,52,8),this.pos+=8},writeBytes:function(J){var ue=J.length;this.writeVarint(ue),this.realloc(ue);for(var Ee=0;Ee<ue;Ee++)this.buf[this.pos++]=J[Ee]},writeRawMessage:function(J,ue){this.pos++;var Ee=this.pos;J(ue,this);var ct=this.pos-Ee;ct>=128&&S(Ee,ct,this),this.pos=Ee-1,this.writeVarint(ct),this.pos+=ct},writeMessage:function(J,ue,Ee){this.writeTag(J,e.Bytes),this.writeRawMessage(ue,Ee)},writePackedVarint:function(J,ue){ue.length&&this.writeMessage(J,D,ue)},writePackedSVarint:function(J,ue){ue.length&&this.writeMessage(J,N,ue)},writePackedBoolean:function(J,ue){ue.length&&this.writeMessage(J,j,ue)},writePackedFloat:function(J,ue){ue.length&&this.writeMessage(J,U,ue)},writePackedDouble:function(J,ue){ue.length&&this.writeMessage(J,V,ue)},writePackedFixed32:function(J,ue){ue.length&&this.writeMessage(J,ee,ue)},writePackedSFixed32:function(J,ue){ue.length&&this.writeMessage(J,Q,ue)},writePackedFixed64:function(J,ue){ue.length&&this.writeMessage(J,X,ue)},writePackedSFixed64:function(J,ue){ue.length&&this.writeMessage(J,pe,ue)},writeBytesField:function(J,ue){this.writeTag(J,e.Bytes),this.writeBytes(ue)},writeFixed32Field:function(J,ue){this.writeTag(J,e.Fixed32),this.writeFixed32(ue)},writeSFixed32Field:function(J,ue){this.writeTag(J,e.Fixed32),this.writeSFixed32(ue)},writeFixed64Field:function(J,ue){this.writeTag(J,e.Fixed64),this.writeFixed64(ue)},writeSFixed64Field:function(J,ue){this.writeTag(J,e.Fixed64),this.writeSFixed64(ue)},writeVarintField:function(J,ue){this.writeTag(J,e.Varint),this.writeVarint(ue)},writeSVarintField:function(J,ue){this.writeTag(J,e.Varint),this.writeSVarint(ue)},writeStringField:function(J,ue){this.writeTag(J,e.Bytes),this.writeString(ue)},writeFloatField:function(J,ue){this.writeTag(J,e.Fixed32),this.writeFloat(ue)},writeDoubleField:function(J,ue){this.writeTag(J,e.Fixed64),this.writeDouble(ue)},writeBooleanField:function(J,ue){this.writeVarintField(J,!!ue)}};function s(J,ue,Ee){var ct=Ee.buf,Ce,Le;if(Le=ct[Ee.pos++],Ce=(Le&112)>>4,Le<128||(Le=ct[Ee.pos++],Ce|=(Le&127)<<3,Le<128)||(Le=ct[Ee.pos++],Ce|=(Le&127)<<10,Le<128)||(Le=ct[Ee.pos++],Ce|=(Le&127)<<17,Le<128)||(Le=ct[Ee.pos++],Ce|=(Le&127)<<24,Le<128)||(Le=ct[Ee.pos++],Ce|=(Le&1)<<31,Le<128))return h(J,Ce,ue);throw new Error("Expected varint not more than 10 bytes")}function l(J){return J.type===e.Bytes?J.readVarint()+J.pos:J.pos+1}function h(J,ue,Ee){return Ee?ue*4294967296+(J>>>0):(ue>>>0)*4294967296+(J>>>0)}function A(J,ue){var Ee,ct;if(J>=0?(Ee=J%4294967296|0,ct=J/4294967296|0):(Ee=~(-J%4294967296),ct=~(-J/4294967296),Ee^4294967295?Ee=Ee+1|0:(Ee=0,ct=ct+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ue.realloc(10),b(Ee,ct,ue),C(ct,ue)}function b(J,ue,Ee){Ee.buf[Ee.pos++]=J&127|128,J>>>=7,Ee.buf[Ee.pos++]=J&127|128,J>>>=7,Ee.buf[Ee.pos++]=J&127|128,J>>>=7,Ee.buf[Ee.pos++]=J&127|128,J>>>=7,Ee.buf[Ee.pos]=J&127}function C(J,ue){var Ee=(J&7)<<4;ue.buf[ue.pos++]|=Ee|((J>>>=3)?128:0),J&&(ue.buf[ue.pos++]=J&127|((J>>>=7)?128:0),J&&(ue.buf[ue.pos++]=J&127|((J>>>=7)?128:0),J&&(ue.buf[ue.pos++]=J&127|((J>>>=7)?128:0),J&&(ue.buf[ue.pos++]=J&127|((J>>>=7)?128:0),J&&(ue.buf[ue.pos++]=J&127)))))}function S(J,ue,Ee){var ct=ue<=16383?1:ue<=2097151?2:ue<=268435455?3:Math.floor(Math.log(ue)/(Math.LN2*7));Ee.realloc(ct);for(var Ce=Ee.pos-1;Ce>=J;Ce--)Ee.buf[Ce+ct]=Ee.buf[Ce]}function D(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeVarint(J[Ee])}function N(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeSVarint(J[Ee])}function U(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeFloat(J[Ee])}function V(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeDouble(J[Ee])}function j(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeBoolean(J[Ee])}function ee(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeFixed32(J[Ee])}function Q(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeSFixed32(J[Ee])}function X(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeFixed64(J[Ee])}function pe(J,ue){for(var Ee=0;Ee<J.length;Ee++)ue.writeSFixed64(J[Ee])}function Y(J,ue){return(J[ue]|J[ue+1]<<8|J[ue+2]<<16)+J[ue+3]*16777216}function Ge(J,ue,Ee){J[Ee]=ue,J[Ee+1]=ue>>>8,J[Ee+2]=ue>>>16,J[Ee+3]=ue>>>24}function ze(J,ue){return(J[ue]|J[ue+1]<<8|J[ue+2]<<16)+(J[ue+3]<<24)}function de(J,ue,Ee){for(var ct="",Ce=ue;Ce<Ee;){var Le=J[Ce],Ne=null,$e=Le>239?4:Le>223?3:Le>191?2:1;if(Ce+$e>Ee)break;var it,ot,dt;$e===1?Le<128&&(Ne=Le):$e===2?(it=J[Ce+1],(it&192)===128&&(Ne=(Le&31)<<6|it&63,Ne<=127&&(Ne=null))):$e===3?(it=J[Ce+1],ot=J[Ce+2],(it&192)===128&&(ot&192)===128&&(Ne=(Le&15)<<12|(it&63)<<6|ot&63,(Ne<=2047||Ne>=55296&&Ne<=57343)&&(Ne=null))):$e===4&&(it=J[Ce+1],ot=J[Ce+2],dt=J[Ce+3],(it&192)===128&&(ot&192)===128&&(dt&192)===128&&(Ne=(Le&15)<<18|(it&63)<<12|(ot&63)<<6|dt&63,(Ne<=65535||Ne>=1114112)&&(Ne=null))),Ne===null?(Ne=65533,$e=1):Ne>65535&&(Ne-=65536,ct+=String.fromCharCode(Ne>>>10&1023|55296),Ne=56320|Ne&1023),ct+=String.fromCharCode(Ne),Ce+=$e}return ct}function ce(J,ue,Ee){return o.decode(J.subarray(ue,Ee))}function De(J,ue,Ee){for(var ct=0,Ce,Le;ct<ue.length;ct++){if(Ce=ue.charCodeAt(ct),Ce>55295&&Ce<57344)if(Le)if(Ce<56320){J[Ee++]=239,J[Ee++]=191,J[Ee++]=189,Le=Ce;continue}else Ce=Le-55296<<10|Ce-56320|65536,Le=null;else{Ce>56319||ct+1===ue.length?(J[Ee++]=239,J[Ee++]=191,J[Ee++]=189):Le=Ce;continue}else Le&&(J[Ee++]=239,J[Ee++]=191,J[Ee++]=189,Le=null);Ce<128?J[Ee++]=Ce:(Ce<2048?J[Ee++]=Ce>>6|192:(Ce<65536?J[Ee++]=Ce>>12|224:(J[Ee++]=Ce>>18|240,J[Ee++]=Ce>>12&63|128),J[Ee++]=Ce>>6&63|128),J[Ee++]=Ce&63|128)}return Ee}return n2}var T2e=B2e();const S2e=bf(T2e),I2e="4.3.1",M5={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:I2e,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...M5});const M2e={Point:P5,MultiPoint:P2e,LineString:L5,MultiLineString:L2e,Polygon:R5,MultiPolygon:R2e};function P5([t,e],[r,n],i){const o=El(r[0],n[0],t),s=El(r[1],n[1],e);return i.unprojectFlat([o,s])}function BE(t,e,r){return t.map(n=>P5(n,e,r))}function P2e(t,e,r){return BE(t,e,r)}function L5(t,e,r){return BE(t,e,r)}function L2e(t,e,r){return t.map(n=>L5(n,e,r))}function R5(t,e,r){return t.map(n=>BE(n,e,r))}function R2e(t,e,r){return t.map(n=>R5(n,e,r))}function O2e(t,e,r){const n=r.projectFlat([e.west,e.north]),i=r.projectFlat([e.east,e.south]),o=[n,i];return{...t,coordinates:M2e[t.type](t.coordinates,o,r)}}const D2e=["points","lines","polygons"];function F2e(t,e,r,n){for(const i of D2e){const o=t[i]&&k2e(t[i],e,r,n);if(o>=0)return o}return-1}function k2e(t,e,r,n){const i=t.featureIds.value;if(!i.length)return-1;let o=0,s=i[i.length-1]+1;if(n){const h=N2e(t,n);if(h)o=h[0],s=h[1]+1;else return-1}let l=-1;if(e in t.numericProps){const h=t.numericProps[e].value.findIndex((A,b)=>A===r&&i[b]>=o&&i[b]<s);return h>=0?t.globalFeatureIds.value[h]:-1}else e?l=FL(t.properties,h=>h[e]===r,o,s):t.fields&&(l=FL(t.fields,h=>h.id===r,o,s));return l>=0?U2e(t,l):-1}function N2e(t,e){if(!t.__layers){const r={},{properties:n}=t;for(let i=0;i<n.length;i++){const{layerName:o}=n[i];o&&(r[o]?r[o][1]=i:r[o]=[i,i])}t.__layers=r}return t.__layers[e]}function U2e(t,e){if(!t.__ids){const r=[],n=t.featureIds.value,i=t.globalFeatureIds.value;for(let o=0;o<n.length;o++)r[n[o]]=i[o];t.__ids=r}return t.__ids[e]}function FL(t,e,r,n){for(let i=r;i<n;i++)if(e(t[i],i))return i;return-1}const i2=512,G2e={...nu.defaultProps,data:q_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[M5],binary:!0};class $p extends su{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:n,changeFlags:i}){i.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:r,context:n,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==r.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!pde(e)){const{onDataLoad:n,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{r=await i(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}n&&n(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){const e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:n,maxZoom:i}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>n&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(i)||r.maxzoom<i)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){const{data:r,binary:n}=this.state,{index:i,signal:o}=e,s=gf(r,e);if(!s)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:h}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...l?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:n?{format:"binary"}:{}},h(s,{propName:"data",layer:this,loadOptions:l,signal:o})}renderSubLayers(e){const{x:r,y:n,z:i}=e.tile.index,o=Math.pow(2,i),s=i2/o,l=-s,h=i2*r/o,A=i2*(1-n/o),b=new bn().scale([s,l,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=b,e.coordinateOrigin=[h,A,0],e.coordinateSystem=Yr.CARTESIAN,e.extensions=[...e.extensions||[],new uy]);const C=super.renderSubLayers(e);return this.state.binary&&!(C instanceof nu)&&$r.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),C}_updateAutoHighlight(e){const{uniqueIdProperty:r}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:i}=this.state,o=e.object;let s=null,l=null;o&&(s=s2(o,r),l=kL(o));let{highlightColor:h}=this.props;typeof h=="function"&&(h=h(e)),(n!==s||i!==l)&&this.setState({highlightColor:h,hoveredFeatureId:s,hoveredFeatureLayerName:l})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){const{data:n}=e.sourceLayer.props;r.object=qx(n,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=UL(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r,hoveredFeatureLayerName:n,binary:i}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,l=e.content,h=NL(s);if(!(NL(r)||h))return-1;const A=h?s:r;return Array.isArray(l)?l.findIndex(b=>{const C=s2(b,o)===A,S=h||kL(b)===n;return C&&S}):l&&i?F2e(l,o,A,h?"":n):-1}_pickObjects(e){const{deck:r,viewport:n}=this.context,i=n.width,o=n.height,s=n.x,l=n.y,h=[this.id];return r.pickObjects({x:s,y:l,width:i,height:o,layerIds:h,maxObjects:e})}getRenderedFeatures(e=null){const r=this._pickObjects(e),n=new Set,i=[];for(const o of r){const s=s2(o.object,this.props.uniqueIdProperty);s===void 0?i.push(o.object):n.has(s)||(n.add(s),i.push(o.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(r=>{r.hasOwnProperty(e)||Object.defineProperty(r,e,{get:()=>{if(!r.content)return null;if(this.state.binary&&Array.isArray(r.content)&&!r.content.length)return[];const{bbox:n}=r;if(r._contentWGS84===void 0&&Ade(n)){const i=this.state.binary?qx(r.content):r.content;r._contentWGS84=i.map(o=>UL(o,n,this.context.viewport))}return r._contentWGS84}})})}}$p.layerName="MVTLayer",$p.defaultProps=G2e;function s2(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function kL(t){return t.properties?.layerName||null}function NL(t){return t!=null&&t!==""}function UL(t,e,r){const n={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>O2e(t.geometry,e,r).coordinates}),n}const zL="0123456789bcdefghjkmnpqrstuvwxyz",O5={};for(let t=0;t<zL.length;t++)O5[zL.charAt(t)]=t;const z2e=-90,j2e=90,H2e=-180,V2e=180;function W2e(t){let e=!0,r=j2e,n=z2e,i=V2e,o=H2e,s,l=0;for(let h=0,A=t.length;h<A;h++){const b=t[h].toLowerCase();l=O5[b];for(let C=4;C>=0;C--){const S=l>>C&1;e?(s=(i+o)/2,S===1?o=s:i=s):(s=(r+n)/2,S===1?n=s:r=s),e=!e}}return[n,o,r,i]}function J2e(t){const[e,r,n,i]=W2e(t);return[i,n,i,e,r,e,r,n,i,n]}const K2e={getGeohash:{type:"accessor",value:t=>t.geohash}};class dy extends oh{indexToBounds(){const{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>J2e(r(n,i))}}}dy.layerName="GeohashLayer",dy.defaultProps=K2e;const X2e=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:dy,GreatCircleLayer:Ix,H3ClusterLayer:ry,H3HexagonLayer:fc,MVTLayer:$p,QuadkeyLayer:$_,S2Layer:Z_,TerrainLayer:Zx,Tile3DLayer:Qx,TileLayer:su,TripsLayer:Y_,_GeoCellLayer:oh,_Tile2DHeader:j8,_Tileset2D:Vy,_WMSLayer:Sx,_getURLFromTemplate:gf},Symbol.toStringTag,{value:"Module"}));function Q2e({pointCount:t,getBinId:e}){const r=new Map;for(let n=0;n<t;n++){const i=e(n);if(i===null)continue;let o=r.get(String(i));o?o.points.push(n):(o={id:i,index:r.size,points:[n]},r.set(String(i),o))}return Array.from(r.values())}function Z2e({bins:t,dimensions:e,target:r}){const n=t.length*e;(!r||r.length<n)&&(r=new Float32Array(n));for(let i=0;i<t.length;i++){const{id:o}=t[i];Array.isArray(o)?r.set(o,i*e):r[i]=o}return r}const $2e=t=>t.length,D5=(t,e)=>{let r=0;for(const n of t)r+=e(n);return r},q2e=(t,e)=>t.length===0?NaN:D5(t,e)/t.length,Y2e=(t,e)=>{let r=1/0;for(const n of t){const i=e(n);i<r&&(r=i)}return r},exe=(t,e)=>{let r=-1/0;for(const n of t){const i=e(n);i>r&&(r=i)}return r},txe={COUNT:$2e,SUM:D5,MEAN:q2e,MIN:Y2e,MAX:exe};function rxe({bins:t,getValue:e,operation:r,target:n}){(!n||n.length<t.length)&&(n=new Float32Array(t.length));let i=1/0,o=-1/0;for(let s=0;s<t.length;s++){const{points:l}=t[s];n[s]=r(l,e),n[s]<i&&(i=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[i,o]}}function jL(t,e,r){const n={};for(const o of t.sources||[]){const s=e[o];if(s)n[o]=nxe(s);else throw new Error(`Cannot find attribute ${o}`)}const i={};return o=>{for(const s in n)i[s]=n[s](o);return t.getValue(i,o,r)}}function nxe(t){const e=t.value,{offset:r=0,stride:n,size:i}=t.getAccessor(),o=e.BYTES_PER_ELEMENT,s=r/o,l=n?n/o:i;if(i===1)return t.isConstant?()=>e[0]:A=>{const b=s+l*A;return e[b]};let h;return t.isConstant?(h=Array.from(e),()=>h):(h=new Array(i),A=>{const b=s+l*A;for(let C=0;C<i;C++)h[C]=e[b+C];return h})}class tA{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const r=this.props;if(e.binOptions&&(es(e.binOptions,r.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)!!e.customOperations[n]!=!!r.customOperations[n]&&this.setNeedsUpdate(n);e.pointCount!==void 0&&e.pointCount!==r.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...r.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=Q2e({pointCount:this.props.pointCount,getBinId:jL(this.props.getBin,this.props.attributes,this.props.binOptions)});const e=Z2e({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){const r=this.props.customOperations[e]||txe[this.props.operations[e]],{value:n,domain:i}=rxe({bins:this.bins,getValue:jL(this.props.getValue[e],this.props.attributes,void 0),operation:r,target:this.results[e]?.value});this.results[e]={value:n,domain:i,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){const r=this.bins[e];if(!r)return null;const n=new Array(this.channelCount);for(let i=0;i<n.length;i++){const o=this.results[i];n[i]=o?.value[e]}return{id:r.id,value:n,count:r.points.length,pointIndices:r.points}}}function F5(t,e,r){return t.createFramebuffer({width:e,height:r,colorAttachments:[t.createTexture({width:e,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const ixe=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,sxe={name:"binSorter",vs:ixe,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},k5=[1,2,4,8],HL=3e38,oxe={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},i_=1024;class axe{constructor(e,r){this.binsFBO=null,this.device=e,this.model=cxe(e,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;const r=e%i_,n=Math.floor(e/i_),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(e,r){const n=i_,i=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=F5(this.device,n,i);const o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(e){const r=this.model;e.attributes&&r.setAttributes(e.attributes),e.constantAttributes&&r.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&r.setVertexCount(e.vertexCount),e.shaderModuleProps&&r.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const r=lxe(e);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(e,r){if(r===0)return;r|=k5[3];const n=this.model,i=this.binsFBO,o=e==="MAX"?-HL:e==="MIN"?HL:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:r},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}}function lxe(t){const e={...oxe};for(let r=0;r<t.length;r++){const n=t[r];n&&(e[n]+=k5[r])}return e}function cxe(t,e){let r=e.vs;e.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Di(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],sxe],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}const uxe=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,hxe={name:"aggregatorTransform",vs:uxe,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class fxe{constructor(e,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=r.channelCount,this.transform=dxe(e,r),this.domainFBO=F5(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(e);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,r){const{model:n,transformFeedback:i}=this.transform;n.setVertexCount(e);const o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:o});const s=e*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),i.setBuffer("binIds",this.binBuffer));const l=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<l)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:l}),i.setBuffer("values",this.valueBuffer))}update(e,r){if(!e)return;const n=this.transform,i=this.domainFBO,o=[0,1,2].map(h=>r[h]==="COUNT"?1:0),s=[0,1,2].map(h=>r[h]==="MEAN"?1:0),l={isCount:o,isMean:s,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:l}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function dxe(t,e){const r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new ff(t,{vs:r,fs:n,topology:"point-list",modules:[hxe],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:i_},varyings:["binIds","values"],disableWarnings:!0})}class za{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,r){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new axe(e,r),this.aggregationTransform=new fxe(e,r),this.setProps(r)}getBins(){const e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){const r=this.aggregationTransform.valueBuffer;return!r||e>=this.channelCount?null:(this.results[e]?.buffer!==r&&(this.results[e]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:r}=this.props;let n;if(this.dimensions===1)n=[e+r[0][0]];else{const[[l,h],[A]]=r,b=h-l;n=[e%b+l,Math.floor(e/b)+A]}const i=this.binSorter.getBinValues(e);if(!i)return null;const o=i[3],s=[];for(let l=0;l<this.channelCount;l++){const h=this.props.operations[l];h==="COUNT"?s[l]=o:o===0?s[l]=NaN:s[l]=h==="MEAN"?i[l]/o:i[l]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const r=this.props;if("binIdRange"in e&&!es(e.binIdRange,r.binIdRange,2)){const n=e.binIdRange;if($r.assert(n.length===this.dimensions),this.dimensions===1){const[[i,o]]=n;this.binCount=o-i}else{const[[i,o],[s,l]]=n;this.binCount=(o-i)*(l-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(e.pointCount!==void 0&&e.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(es(e.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const n={},i={};for(const o of Object.values(e.attributes))for(const[s,l]of Object.entries(o.getValue()))ArrayBuffer.isView(l)?i[s]=l:l&&(n[s]=l);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,r=this.needsUpdate.map((n,i)=>n?e[i]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,e);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}}let rA=class extends Bs{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(t){super.updateState(t);const e=this.getAggregatorType();if(t.changeFlags.extensionsChanged||this.state.aggregatorType!==e){this.state.aggregator?.destroy();const r=this.createAggregator(e);return r.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:r,aggregatorType:e}),!0}return!1}finalizeState(t){super.finalizeState(t),this.state.aggregator.destroy()}updateAttributes(t){const{aggregator:e}=this.state;e.setProps({attributes:t});for(const r in t)this.onAttributeChange(r);e.update()}draw({shaderModuleProps:t}){const{aggregator:e}=this.state;e.setProps({shaderModuleProps:t}),e.preDraw()}_getAttributeManager(){return new Ly(this.context.device,{id:this.props.id,stats:this.context.stats})}};rA.layerName="AggregationLayer";const nb=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function N5(t,e=!1,r=Float32Array){let n;if(Number.isFinite(t[0]))n=new r(t);else{n=new r(t.length*4);let i=0;for(let o=0;o<t.length;o++){const s=t[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let i=0;i<n.length;i++)n[i]/=255;return n}const py={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function TE(t,e){t.setSampler({minFilter:py[e],magFilter:py[e]})}function SE(t,e,r="linear"){const n=N5(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:py[r],magFilter:py[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const pxe=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,Axe=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gxe=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,mxe={name:"screenGrid",vs:gxe,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class U5 extends Es{getShaders(){return super.getShaders({vs:pxe,fs:Axe,modules:[_a,mxe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.state.model;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=SE(this.context.device,r.colorRange,r.colorScaleType);const s={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:s})}else n.colorScaleType!==r.colorScaleType&&TE(this.state.colorTexture,r.colorScaleType);if(n.cellMarginPixels!==r.cellMarginPixels||n.cellSizePixels!==r.cellSizePixels||i.viewportChanged){const{width:s,height:l}=this.context.viewport,{cellSizePixels:h,cellMarginPixels:A}=this.props,b=Math.max(h-A,0),C={gridSizeClipspace:[h/s*2,h/l*2],cellSizeClipspace:[b/s*2,b/l*2]};o.shaderInputs.setProps({screenGrid:C})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){const r=this.props.colorDomain(),n=this.state.model,i={colorDomain:r};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new Di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new eo({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}U5.layerName="ScreenGridCellLayer";const _xe=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,yxe={name:"binOptions",vs:_xe,uniformTypes:{cellSizePixels:"f32"}},bxe={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:nb,colorScaleType:"linear",getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class Yx extends rA{getAggregatorType(){return this.props.gpuAggregation&&za.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!za.isSupported(this.context.device)?new tA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,i)=>{const o=this.context.viewport,s=o.project(r),l=i.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/l),Math.floor(s[1]/l)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new za(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fs,yxe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{cellSizePixels:s,aggregation:l}=n;if(r||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||l!==i.aggregation||s!==i.cellSizePixels){const{width:h,height:A}=this.context.viewport,{aggregator:b}=this.state;b instanceof za&&b.setProps({binIdRange:[[0,Math.ceil(h/s)],[0,Math.ceil(A/s)]]}),b.setProps({pointCount:this.getNumInstances(),operations:[l],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:e}=this.state,r=this.getSubLayerClass("cells",U5),n=e.getBins(),i=e.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}}Yx.layerName="ScreenGridLayer",Yx.defaultProps=bxe;class Ay{constructor(e,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=r,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=VL(this.input,this.inputLength);this._percentile=xxe(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=VL(this.input,this.inputLength);this._ordinal=vxe(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:r,upperPercentile:n}){if(e==="quantile")return[r,n-1];if(r>0||n<100){const{domain:i}=this.getScalePercentile();let o=i[Math.floor(r)-1]??-1/0,s=i[Math.floor(n)-1]??1/0;if(e==="ordinal"){const{domain:l}=this.getScaleOrdinal();o=l.findIndex(h=>h>=o),s=l.findIndex(h=>h>s)-1,s===-2&&(s=l.length-1)}return[o,s]}return null}update(e){const r=this.props;if(e.scaleType!==r.scaleType)switch(e.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:i}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,i.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==r.scaleType||e.lowerPercentile!==r.lowerPercentile||e.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function vxe(t){const e=new Set;for(const i of t)Number.isFinite(i)&&e.add(i);const r=Array.from(e).sort(),n=new Map;for(let i=0;i<r.length;i++)n.set(r[i],i);return{attribute:{value:t.map(i=>Number.isFinite(i)?n.get(i):NaN),type:"float32",size:1},domain:r}}function xxe(t,e=100){const r=Array.from(t).filter(Number.isFinite).sort(wxe);let n=0;const i=Math.max(1,e),o=new Array(i-1);for(;++n<i;)o[n-1]=Cxe(r,n/i);return{attribute:{value:t.map(s=>Number.isFinite(s)?Exe(o,s):NaN),type:"float32",size:1},domain:o}}function VL(t,e){const r=(t.stride??4)/4,n=(t.offset??0)/4;let i=t.value;if(!i){const s=t.buffer?.readSyncWebGL(0,r*4*e);s&&(i=new Float32Array(s.buffer),t.value=i)}if(r===1)return i.subarray(0,e);const o=new Float32Array(e);for(let s=0;s<e;s++)o[s]=i[s*r+n];return o}function wxe(t,e){return t-e}function Cxe(t,e){const r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];const n=(r-1)*e,i=Math.floor(n),o=t[i],s=t[i+1];return o+(s-o)*(n-i)}function Exe(t,e){let r=0,n=t.length;for(;r<n;){const i=r+n>>>1;t[i]>e?n=i:r=i+1}return r}function IE({dataBounds:t,getBinId:e,padding:r=0}){const n=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(h=>e(h)),i=Math.min(...n.map(h=>h[0]))-r,o=Math.min(...n.map(h=>h[1]))-r,s=Math.max(...n.map(h=>h[0]))+r+1,l=Math.max(...n.map(h=>h[1]))+r+1;return[[i,s],[o,l]]}const G5=Math.PI/3,ib=2*Math.sin(G5),sb=1.5,Bxe=Array.from({length:6},(t,e)=>{const r=e*G5;return[Math.sin(r),-Math.cos(r)]});function o2([t,e],r){let n=Math.round(e=e/r/sb),i=Math.round(t=t/r/ib-(n&1)/2);const o=e-n;if(Math.abs(o)*3>1){const s=t-i,l=i+(t<i?-1:1)/2,h=n+(e<n?-1:1),A=t-l,b=e-h;s*s+o*o>A*A+b*b&&(i=l+(n&1?1:-1)/2,n=h)}return[i,n]}const Txe=`
const vec2 DIST = vec2(${ib}, ${sb});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function WL([t,e],r){return[(t+(e&1)/2)*r*ib,e*r*sb]}const Sxe=`
const vec2 DIST = vec2(${ib}, ${sb});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,Ixe=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${Sxe}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Mxe=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,Pxe={name:"hexagon",vs:Mxe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class z5 extends Ac{getShaders(){const e=super.getShaders();return e.modules.push(Pxe),{...e,vs:Ixe}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=SE(this.context.device,r.colorRange,r.colorScaleType);const o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({hexagon:o})}else n.colorScaleType!==r.colorScaleType&&TE(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){const{radius:r,hexOriginCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:l,colorDomain:h,elevationDomain:A}=this.props,b=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel;S.vertexArray.indexBuffer&&S.setIndexBuffer(null),S.setVertexCount(this.state.fillVertexCount);const D={colorDomain:[Math.max(h[0],b[0]),Math.min(h[1],b[1]),Math.max(h[0]-1,b[0]),Math.min(h[1]+1,b[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:l,radius:r},hexagon:D}),S.draw(this.context.renderPass)}}z5.layerName="HexagonCellLayer";const Lxe=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,Rxe={name:"binOptions",vs:Lxe,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function JL(){}const Oxe={gpuAggregation:!0,colorDomain:null,colorRange:nb,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:JL,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:JL,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class ew extends rA{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:r,getColorValue:n,getElevationValue:i}=this.props;return e&&(r||n||i)?($r.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&za.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:r,radius:n}=this.props;return new tA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(r)return r(i,n);const l=this.state.aggregatorViewport.projectPosition(i),{radiusCommon:h,hexOriginCommon:A}=s;return o2([l[0]-A[0],l[1]-A[1]],h)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new za(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fs,Rxe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${Txe}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(yc(n.data).iterable)),r||o.dataChanged||n.radius!==i.radius||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{radiusCommon:l,hexOriginCommon:h,binIdRange:A,dataAsArray:b}=this.state;if(s.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:l,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),b){const{getColorValue:C,getElevationValue:S}=this.props;s.setProps({customOperations:[C&&(D=>C(D.map(N=>b[N]),{indices:D,data:n.data})),S&&(D=>S(D.map(N=>b[N]),{indices:D,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),r}_updateBinOptions(){const e=this.getBounds();let r=1,n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:l}=this.props,{unitsPerMeter:h}=o.getDistanceScales(s);r=h[0]*l;const A=o2(o.projectFlat(s),r);s=o.unprojectFlat(WL(A,r));const b=o.constructor;o=o.isGeospatial?new b({longitude:s[0],latitude:s[1],zoom:12}):new ou({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=IE({dataBounds:e,getBinId:C=>{const S=o.projectFlat(C);return S[0]-=n[0],S[1]-=n[1],o2(S,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new Ay(i,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new Ay(i,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{radiusCommon:n,hexOriginCommon:i}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:e,radiusCommon:r,hexOriginCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:l,coverage:h,material:A,transitions:b,colorScaleType:C,lowerPercentile:S,upperPercentile:D,colorDomain:N,elevationScaleType:U,elevationLowerPercentile:V,elevationUpperPercentile:j,elevationDomain:ee}=this.props,Q=this.getSubLayerClass("cells",z5),X=e.getBins(),pe=this.state.colors?.update({scaleType:C,lowerPercentile:S,upperPercentile:D}),Y=this.state.elevations?.update({scaleType:U,lowerPercentile:V,upperPercentile:j});return!pe||!Y?null:new Q(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:X,getColorValue:pe.attribute,getElevationValue:Y.attribute}},dataComparator:(Ge,ze)=>Ge.length===ze.length,updateTriggers:{getBin:[X],getColorValue:[pe.attribute],getElevationValue:[Y.attribute]},diskResolution:6,vertices:Bxe,radius:r,hexOriginCommon:n,elevationScale:i,colorRange:o,colorScaleType:C,elevationRange:s,extruded:l,coverage:h,material:A,colorDomain:pe.domain||N||e.getResultDomain(0),elevationDomain:Y.domain||ee||e.getResultDomain(1),colorCutoff:pe.cutoff,elevationCutoff:Y.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;if(i){const s=WL(i.id,this.state.radiusCommon),l=this.context.viewport.unprojectFlat(s);o={col:i.id[0],row:i.id[1],position:l,colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(h=>this.props.data[h]):[])}r.object=o}return r}}ew.layerName="HexagonLayer",ew.defaultProps=Oxe;const lr=.5,wr=1/6,bt={N:[0,lr],E:[lr,0],S:[0,-lr],W:[-lr,0],NE:[lr,lr],NW:[-lr,lr],SE:[lr,-lr],SW:[-lr,-lr]},Hd=[bt.W,bt.SW,bt.S],Vd=[bt.S,bt.SE,bt.E],Wd=[bt.E,bt.NE,bt.N],Jd=[bt.NW,bt.W,bt.N],Kd=[[-lr,wr],[-lr,-wr],[-wr,-lr],[wr,-lr]],Xd=[[-wr,-lr],[wr,-lr],[lr,-wr],[lr,wr]],Qd=[[lr,-wr],[lr,wr],[wr,lr],[-wr,lr]],Zd=[[-lr,wr],[-lr,-wr],[wr,lr],[-wr,lr]],KL=[bt.W,bt.SW,bt.SE,bt.E],XL=[bt.S,bt.SE,bt.NE,bt.N],QL=[bt.NW,bt.W,bt.E,bt.NE],ZL=[bt.NW,bt.SW,bt.S,bt.N],$L=[[-lr,wr],[-lr,-wr],[lr,-wr],[lr,wr]],qL=[[-wr,-lr],[wr,-lr],[wr,lr],[-wr,lr]],Dxe=[bt.NW,bt.SW,bt.SE,bt.NE],YL=[bt.NW,bt.SW,bt.SE,bt.E,bt.N],eR=[bt.W,bt.SW,bt.SE,bt.NE,bt.N],tR=[bt.NW,bt.W,bt.S,bt.SE,bt.NE],rR=[bt.NW,bt.SW,bt.S,bt.E,bt.NE],nR=[bt.NW,bt.W,[lr,-wr],[lr,wr],bt.N],iR=[[-wr,-lr],[wr,-lr],bt.E,bt.NE,bt.N],sR=[[-lr,wr],[-lr,-wr],bt.S,bt.SE,bt.E],oR=[bt.W,bt.SW,bt.S,[wr,lr],[-wr,lr]],aR=[bt.NW,bt.W,[-wr,-lr],[wr,-lr],bt.N],lR=[[-lr,wr],[-lr,-wr],bt.E,bt.NE,bt.N],cR=[bt.S,bt.SE,bt.E,[wr,lr],[-wr,lr]],uR=[bt.W,bt.SW,bt.S,[lr,-wr],[lr,wr]],hR=[bt.W,bt.SW,bt.SE,bt.E,[wr,lr],[-wr,lr]],fR=[[-lr,wr],[-lr,-wr],bt.S,bt.SE,bt.NE,bt.N],dR=[bt.NW,bt.W,[-wr,-lr],[wr,-lr],bt.E,bt.NE],pR=[bt.NW,bt.SW,bt.S,[lr,-wr],[lr,wr],bt.N],$d=[bt.W,bt.SW,bt.S,bt.E,bt.NE,bt.N],qd=[bt.NW,bt.W,bt.S,bt.SE,bt.E,bt.N],I0=[[-lr,wr],[-lr,-wr],[-wr,-lr],[wr,-lr],bt.E,bt.NE,bt.N],M0=[bt.W,bt.SW,bt.S,[lr,-wr],[lr,wr],[wr,lr],[-wr,lr]],P0=[bt.NW,bt.W,[-wr,-lr],[wr,-lr],[lr,-wr],[lr,wr],bt.N],L0=[[-lr,wr],[-lr,-wr],bt.S,bt.SE,bt.E,[wr,lr],[-wr,lr]],AR=[[-lr,wr],[-lr,-wr],[-wr,-lr],[wr,-lr],[lr,-wr],[lr,wr],[wr,lr],[-wr,lr]],Fxe={0:[],1:[[bt.W,bt.S]],2:[[bt.S,bt.E]],3:[[bt.W,bt.E]],4:[[bt.N,bt.E]],5:{0:[[bt.W,bt.S],[bt.N,bt.E]],1:[[bt.W,bt.N],[bt.S,bt.E]]},6:[[bt.N,bt.S]],7:[[bt.W,bt.N]],8:[[bt.W,bt.N]],9:[[bt.N,bt.S]],10:{0:[[bt.W,bt.N],[bt.S,bt.E]],1:[[bt.W,bt.S],[bt.N,bt.E]]},11:[[bt.N,bt.E]],12:[[bt.W,bt.E]],13:[[bt.S,bt.E]],14:[[bt.W,bt.S]],15:[]};function hr(t){return parseInt(t,4)}const kxe={[hr("0000")]:[],[hr("2222")]:[],[hr("2221")]:[Hd],[hr("2212")]:[Vd],[hr("2122")]:[Wd],[hr("1222")]:[Jd],[hr("0001")]:[Hd],[hr("0010")]:[Vd],[hr("0100")]:[Wd],[hr("1000")]:[Jd],[hr("2220")]:[Kd],[hr("2202")]:[Xd],[hr("2022")]:[Qd],[hr("0222")]:[Zd],[hr("0002")]:[Kd],[hr("0020")]:[Xd],[hr("0200")]:[Qd],[hr("2000")]:[Zd],[hr("0011")]:[KL],[hr("0110")]:[XL],[hr("1100")]:[QL],[hr("1001")]:[ZL],[hr("2211")]:[KL],[hr("2112")]:[XL],[hr("1122")]:[QL],[hr("1221")]:[ZL],[hr("2200")]:[$L],[hr("2002")]:[qL],[hr("0022")]:[$L],[hr("0220")]:[qL],[hr("1111")]:[Dxe],[hr("1211")]:[YL],[hr("2111")]:[eR],[hr("1112")]:[tR],[hr("1121")]:[rR],[hr("1011")]:[YL],[hr("0111")]:[eR],[hr("1110")]:[tR],[hr("1101")]:[rR],[hr("1200")]:[nR],[hr("0120")]:[iR],[hr("0012")]:[sR],[hr("2001")]:[oR],[hr("1022")]:[nR],[hr("2102")]:[iR],[hr("2210")]:[sR],[hr("0221")]:[oR],[hr("1002")]:[aR],[hr("2100")]:[lR],[hr("0210")]:[cR],[hr("0021")]:[uR],[hr("1220")]:[aR],[hr("0122")]:[lR],[hr("2012")]:[cR],[hr("2201")]:[uR],[hr("0211")]:[hR],[hr("2110")]:[fR],[hr("1102")]:[dR],[hr("1021")]:[pR],[hr("2011")]:[hR],[hr("0112")]:[fR],[hr("1120")]:[dR],[hr("1201")]:[pR],[hr("2101")]:[$d],[hr("0121")]:[$d],[hr("1012")]:[qd],[hr("1210")]:[qd],[hr("0101")]:{0:[Hd,Wd],1:[$d],2:[$d]},[hr("1010")]:{0:[Jd,Vd],1:[qd],2:[qd]},[hr("2121")]:{0:[$d],1:[$d],2:[Hd,Wd]},[hr("1212")]:{0:[qd],1:[qd],2:[Jd,Vd]},[hr("2120")]:{0:[I0],1:[I0],2:[Kd,Wd]},[hr("2021")]:{0:[M0],1:[M0],2:[Hd,Qd]},[hr("1202")]:{0:[P0],1:[P0],2:[Jd,Xd]},[hr("0212")]:{0:[L0],1:[L0],2:[Vd,Zd]},[hr("0102")]:{0:[Kd,Wd],1:[I0],2:[I0]},[hr("0201")]:{0:[Hd,Qd],1:[M0],2:[M0]},[hr("1020")]:{0:[Jd,Xd],1:[P0],2:[P0]},[hr("2010")]:{0:[Vd,Zd],1:[L0],2:[L0]},[hr("2020")]:{0:[Zd,Xd],1:[AR],2:[Kd,Qd]},[hr("0202")]:{0:[Qd,Kd],1:[AR],2:[Zd,Xd]}};function KA(t,e){return Number.isNaN(t)?0:Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function Nxe(t){const{x:e,y:r,xRange:n,yRange:i,getValue:o,threshold:s}=t,l=e<n[0],h=e>=n[1]-1,A=r<i[0],b=r>=i[1]-1,C=l||h||A||b;let S=0,D,N,U,V;if(l||b)U=0;else{const Q=o(e,r+1);U=KA(Q,s),S+=Q}if(h||b)V=0;else{const Q=o(e+1,r+1);V=KA(Q,s),S+=Q}if(h||A)N=0;else{const Q=o(e+1,r);N=KA(Q,s),S+=Q}if(l||A)D=0;else{const Q=o(e,r);D=KA(Q,s),S+=Q}let j=-1;Number.isFinite(s)&&(j=U<<3|V<<2|N<<1|D),Array.isArray(s)&&(j=U<<6|V<<4|N<<2|D);let ee=0;return C||(ee=KA(S/4,s)),{code:j,meanCode:ee}}function Uxe(t){const{x:e,y:r,z:n,code:i,meanCode:o}=t;let s=kxe[i];Array.isArray(s)||(s=s[o]);const l=e+1,h=r+1,A=[];return s.forEach(b=>{const C=[];b.forEach(S=>{const D=l+S[0],N=h+S[1];C.push([D,N,n])}),A.push(C)}),A}function Gxe(t){const{x:e,y:r,z:n,code:i,meanCode:o}=t;let s=Fxe[i];Array.isArray(s)||(s=s[o]);const l=e+1,h=r+1,A=[];return s.forEach(b=>{b.forEach(C=>{const S=l+C[0],D=h+C[1];A.push([S,D,n])})}),A}function zxe({contours:t,getValue:e,xRange:r,yRange:n}){const i=[],o=[];let s=0,l=0;for(let h=0;h<t.length;h++){const A=t[h],b=A.zIndex??h,{threshold:C}=A;for(let S=r[0]-1;S<r[1];S++)for(let D=n[0]-1;D<n[1];D++){const{code:N,meanCode:U}=Nxe({getValue:e,threshold:C,x:S,y:D,xRange:r,yRange:n}),V={x:S,y:D,z:b,code:N,meanCode:U};if(Array.isArray(C)){const j=Uxe(V);for(const ee of j)o[l++]={vertices:ee,contour:A}}else{const j=Gxe(V);j.length>0&&(i[s++]={vertices:j,contour:A})}}}return{lines:i,polygons:o}}function jxe(t){const{aggregator:e,binIdRange:r,channel:n}=t;if(e instanceof za){const i=e.getResult(n)?.buffer;if(i){const o=new Float32Array(i.readSyncWebGL().buffer);return Hxe(o,r)}}if(e instanceof tA){const i=e.getResult(n)?.value,o=e.getBins()?.value;if(o&&i)return Vxe(i,o,e.binCount)}return null}function Hxe(t,e){const[[r,n],[i,o]]=e,s=n-r,l=o-i;return(h,A)=>(h-=r,A-=i,h<0||h>=s||A<0||A>=l?NaN:t[A*s+h])}function Vxe(t,e,r){const n={};for(let i=0;i<r;i++){const o=e[i*2],s=e[i*2+1];n[o]=n[o]||{},n[o][s]=t[i]}return(i,o)=>n[i]?.[o]??NaN}const Wxe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Jxe={name:"binOptions",vs:Wxe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},gR=[255,255,255,255],Kxe=1,Xxe={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let tw=class extends rA{getAggregatorType(){return this.props.gpuAggregation&&za.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"?new tA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:e},r,n)=>{const i=this.state.aggregatorViewport.projectPosition(e),{cellSizeCommon:o,cellOriginCommon:s}=n;return[Math.floor((i[0]-s[0])/o[0]),Math.floor((i[1]-s[1])/o[1])]}},getValue:[{sources:["counts"],getValue:({counts:e})=>e}],onUpdate:this._onAggregationUpdate.bind(this)}):new za(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fs,Jxe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(t){const e=super.updateState(t),{props:r,oldProps:n,changeFlags:i}=t,{aggregator:o}=this.state;if(e||i.dataChanged||r.cellSize!==n.cellSize||!es(r.gridOrigin,n.gridOrigin,1)||r.aggregation!==n.aggregation){this._updateBinOptions();const{cellSizeCommon:s,cellOriginCommon:l,binIdRange:h}=this.state;o.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[r.aggregation],binOptions:{cellSizeCommon:s,cellOriginCommon:l}})}return es(n.contours,r.contours,2)||this.setState({contourData:null}),e}_updateBinOptions(){const t=this.getBounds(),e=[1,1];let r=[0,0],n=[[0,1],[0,1]],i=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{cellSize:s,gridOrigin:l}=this.props,{unitsPerMeter:h}=i.getDistanceScales(o);e[0]=h[0]*s,e[1]=h[1]*s;const A=i.projectFlat(o);r=[Math.floor((A[0]-l[0])/e[0])*e[0]+l[0],Math.floor((A[1]-l[1])/e[1])*e[1]+l[1]],o=i.unprojectFlat(r);const b=i.constructor;i=i.isGeospatial?new b({longitude:o[0],latitude:o[1],zoom:12}):new ou({position:[o[0],o[1],0],zoom:12}),r=[Math.fround(i.center[0]),Math.fround(i.center[1])],n=IE({dataBounds:t,getBinId:C=>{const S=i.projectFlat(C);return[Math.floor((S[0]-r[0])/e[0]),Math.floor((S[1]-r[1])/e[1])]}})}this.setState({cellSizeCommon:e,cellOriginCommon:r,binIdRange:n,aggregatorViewport:i})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate(){const{aggregator:t,binIdRange:e}=this.state;this.setState({aggregatedValueReader:jxe({aggregator:t,binIdRange:e,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:t}=this.state;if(!t)return null;if(!this.state.contourData){const{binIdRange:e}=this.state,{contours:r}=this.props,n=zxe({contours:r,getValue:t,xRange:e[0],yRange:e[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(t){const{aggregator:e}=this.state;switch(t){case"positions":e.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:r,cellOriginCommon:n,binIdRange:i}=this.state;e.setProps({binIdRange:i,binOptions:{cellSizeCommon:r,cellOriginCommon:n}});break;case"counts":e.setNeedsUpdate(0);break}}renderLayers(){const t=this._getContours();if(!t)return null;const{lines:e,polygons:r}=t,{zOffset:n}=this.props,{cellOriginCommon:i,cellSizeCommon:o}=this.state,s=this.getSubLayerClass("lines",nh),l=this.getSubLayerClass("bands",ih),h=new bn().translate([i[0],i[1],0]).scale([o[0],o[1],n]),A=e&&e.length>0&&new s(this.getSubLayerProps({id:"lines"}),{data:e,coordinateSystem:Yr.CARTESIAN,modelMatrix:h,getPath:C=>C.vertices,getColor:C=>C.contour.color??gR,getWidth:C=>C.contour.strokeWidth??Kxe,widthUnits:"pixels"}),b=r&&r.length>0&&new l(this.getSubLayerProps({id:"bands"}),{data:r,coordinateSystem:Yr.CARTESIAN,modelMatrix:h,getPolygon:C=>C.vertices,getFillColor:C=>C.contour.color??gR});return[A,b]}getPickingInfo(t){const e=t.info,{object:r}=e;return r&&(e.object={contour:r.contour}),e}};tw.layerName="ContourLayer",tw.defaultProps=Xxe;const Qxe=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Zxe=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,$xe={name:"grid",vs:Zxe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class j5 extends Ac{getShaders(){const e=super.getShaders();return e.modules.push($xe),{...e,vs:Qxe}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=SE(this.context.device,r.colorRange,r.colorScaleType);const o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({grid:o})}else n.colorScaleType!==r.colorScaleType&&TE(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){const e=new l6;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{cellOriginCommon:r,cellSizeCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:l,colorDomain:h,elevationDomain:A}=this.props,b=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel,D={colorDomain:[Math.max(h[0],b[0]),Math.min(h[1],b[1]),Math.max(h[0]-1,b[0]),Math.min(h[1]+1,b[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:r,sizeCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:l},grid:D}),S.draw(this.context.renderPass)}}j5.layerName="GridCellLayer";const qxe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Yxe={name:"binOptions",vs:qxe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function mR(){}const ewe={gpuAggregation:!0,colorDomain:null,colorRange:nb,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:mR,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:mR,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class rw extends rA{getAggregatorType(){const{gpuAggregation:e,gridAggregator:r,getColorValue:n,getElevationValue:i}=this.props;return e&&(r||n||i)?($r.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&za.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{gridAggregator:r,cellSize:n}=this.props;return new tA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(r)return r(i,n);const l=this.state.aggregatorViewport.projectPosition(i),{cellSizeCommon:h,cellOriginCommon:A}=s;return[Math.floor((l[0]-A[0])/h[0]),Math.floor((l[1]-A[1])/h[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new za(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fs,Yxe],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(yc(n.data).iterable)),r||o.dataChanged||n.cellSize!==i.cellSize||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:l,cellOriginCommon:h,binIdRange:A,dataAsArray:b}=this.state;if(s.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:l,cellOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),b){const{getColorValue:C,getElevationValue:S}=this.props;s.setProps({customOperations:[C&&(D=>C(D.map(N=>b[N]),{indices:D,data:n.data})),S&&(D=>S(D.map(N=>b[N]),{indices:D,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),r}_updateBinOptions(){const e=this.getBounds(),r=[1,1];let n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:l}=this.props,{unitsPerMeter:h}=o.getDistanceScales(s);r[0]=h[0]*l,r[1]=h[1]*l;const A=o.projectFlat(s);n=[Math.floor(A[0]/r[0])*r[0],Math.floor(A[1]/r[1])*r[1]],s=o.unprojectFlat(n);const b=o.constructor;o=o.isGeospatial?new b({longitude:s[0],latitude:s[1],zoom:12}):new ou({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=IE({dataBounds:e,getBinId:C=>{const S=o.projectFlat(C);return[Math.floor((S[0]-n[0])/r[0]),Math.floor((S[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new Ay(i,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new Ay(i,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:e,cellOriginCommon:r,cellSizeCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:l,coverage:h,material:A,transitions:b,colorScaleType:C,lowerPercentile:S,upperPercentile:D,colorDomain:N,elevationScaleType:U,elevationLowerPercentile:V,elevationUpperPercentile:j,elevationDomain:ee}=this.props,Q=this.getSubLayerClass("cells",j5),X=e.getBins(),pe=this.state.colors?.update({scaleType:C,lowerPercentile:S,upperPercentile:D}),Y=this.state.elevations?.update({scaleType:U,lowerPercentile:V,upperPercentile:j});return!pe||!Y?null:new Q(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:X,getColorValue:pe.attribute,getElevationValue:Y.attribute}},dataComparator:(Ge,ze)=>Ge.length===ze.length,updateTriggers:{getBin:[X],getColorValue:[pe.attribute],getElevationValue:[Y.attribute]},cellOriginCommon:r,cellSizeCommon:n,elevationScale:i,colorRange:o,colorScaleType:C,elevationRange:s,extruded:l,coverage:h,material:A,colorDomain:pe.domain||N||e.getResultDomain(0),elevationDomain:Y.domain||ee||e.getResultDomain(1),colorCutoff:pe.cutoff,elevationCutoff:Y.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}}rw.layerName="GridLayer",rw.defaultProps=ewe;function twe(t){const e=t.map(l=>l[0]),r=t.map(l=>l[1]),n=Math.min.apply(null,e),i=Math.max.apply(null,e),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[n,o,i,s]}function rwe(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}const _R=new Float32Array(12);function yR(t,e=2){let r=0;for(const n of t)for(let i=0;i<e;i++)_R[r++]=n[i]||0;return _R}function nwe(t,e,r){const[n,i,o,s]=t,l=o-n,h=s-i;let A=l,b=h;l/h<e/r?A=e/r*h:b=r/e*l,A<e&&(A=e,b=r);const C=(o+n)/2,S=(s+i)/2;return[C-A/2,S-b/2,C+A/2,S+b/2]}function iwe(t,e){const[r,n,i,o]=e;return[(t[0]-r)/(i-r),(t[1]-n)/(o-n)]}const swe=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,owe=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,bR=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,awe={name:"triangle",vs:bR,fs:bR,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class H5 extends Es{getShaders(){return super.getShaders({vs:swe,fs:owe,modules:[Fs,awe]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:r,data:n}=this.props;return new Di(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){const{model:e}=this.state,{aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:l,weightsTexture:h}=this.props,A={aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:l,weightsTexture:h};e.shaderInputs.setProps({triangle:A}),e.draw(this.context.renderPass)}}H5.layerName="TriangleLayer";function lwe(t,e){const r={};for(const n in t)e.includes(n)||(r[n]=t[n]);return r}class V5 extends Bs{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:lwe(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:r}=e;if(r.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){const{props:n,oldProps:i,changeFlags:o}=e,{compareAll:s=!1,dimension:l}=r,{ignoreProps:h}=this.state,{props:A,accessors:b=[]}=l,{updateTriggersChanged:C}=o;if(o.dataChanged)return!0;if(C){if(C.all)return!0;for(const S of b)if(C[S])return!0}if(s)return o.extensionsChanged?!0:gC({oldProps:i,newProps:n,ignoreProps:h,propTypes:this.constructor._propTypes});for(const S of A)if(n[S]!==i[S])return!0;return!1}isAttributeChanged(e){const{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!cwe(r)}_getAttributeManager(){return new Ly(this.context.device,{id:this.props.id,stats:this.context.stats})}}V5.layerName="AggregationLayer";function cwe(t){let e=!0;for(const r in t){e=!1;break}return e}const vR=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,xR=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,uwe=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,hwe=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,fwe=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,dwe={name:"weight",vs:fwe,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},pwe={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},Awe=2,a2={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},wR=[0,0],gwe={SUM:0,MEAN:1},mwe={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:nb,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},_we=["float32-renderable-webgl","texture-blend-float-webgl"],ywe={data:{props:["radiusPixels"]}};class nw extends V5{getShaders(e){let r=[Fs];return e.modules&&(r=[...r,...e.modules]),super.getShaders({...e,modules:r})}initializeState(){super.initializeAggregationLayer(ywe),this.setState({colorDomain:wR}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:r,oldProps:n}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:l,intensity:h,threshold:A,aggregation:b}=this.props,C=this.getSubLayerClass("triangle",H5);return new C(this.getSubLayerProps({id:"triangle-layer",updateTriggers:l}),{coordinateSystem:Yr.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:gwe[b]||0,weightsTexture:e,intensity:h,threshold:A,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:r,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:l,colorTexture:h,updateTimer:A}=this.state;r?.destroy(),n?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),l?.destroy(),h?.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new Ly(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(r.viewportZoomChanged=!0),r}_createTextures(){const{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...a2,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...a2,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,e.limits.maxTextureDimension2D),i=_we.every(l=>e.features.has(l)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||$r.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();r?.destroy(),r=new cS(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,dwe]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:vR,fs:xR});this._createWeightsTransform(o);const s=this.getShaders({vs:uwe,fs:hwe,modules:[pwe]}),l=new cS(e,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:n,textureSize:r};l.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:l,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:vR,fs:xR,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(l=>l.map(Math.fround)),i=twe(n),o={visibleWorldBounds:i,viewportCorners:n};let s=!1;if(e||!this.state.worldBounds||!rwe(this.state.worldBounds,i)){const l=this._worldToCommonBounds(i),h=this._commonToWorldBounds(l);this.props.coordinateSystem===Yr.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));const A=this._worldToCommonBounds(h);o.worldBounds=h,o.normalizedCommonBounds=A,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;e.write(yR(i,3));const s=i.map(l=>iwe(o.projectPosition(l),n));r.write(yR(s,2))}_updateColorTexture(e){const{colorRange:r}=e.props;let{colorTexture:n}=this.state;const i=N5(r,!1,Uint8Array);n&&n?.width===r.length?n.setTexture2DData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...a2,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:r,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s,weightsTexture:l}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){const{viewport:ee}=this.context,Q=ee.distanceScales.metersPerUnit[2]*(A[2]-A[0])/o;this.state.colorDomain=r.map(X=>X*Q*s)}else this.state.colorDomain=r||wR;const b=this.getAttributeManager().getAttributes(),C=this.getModuleSettings();this._setModelAttributes(h.model,b),h.model.setVertexCount(this.getNumInstances());const S={radiusPixels:e,commonBounds:A,textureWidth:o,weightsScale:s,weightsTexture:l},{viewport:D,devicePixelRatio:N,coordinateSystem:U,coordinateOrigin:V}=C,{modelMatrix:j}=this.props;h.model.shaderInputs.setProps({project:{viewport:D,devicePixelRatio:N,modelMatrix:j,coordinateSystem:U,coordinateOrigin:V},weight:S}),h.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state;const{debounceTimeout:n}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){const{useLayerCoordinateSystem:n=!1}=r,[i,o,s,l]=e,{viewport:h}=this.context,{textureSize:A}=this.state,{coordinateSystem:b}=this.props,C=n&&(b===Yr.LNGLAT_OFFSETS||b===Yr.METER_OFFSETS),S=C?h.projectPosition(this.props.coordinateOrigin):[0,0],D=A*Awe/h.scale;let N,U;return n&&!C?(N=this.projectPosition([i,o,0]),U=this.projectPosition([s,l,0])):(N=h.projectPosition([i,o,0]),U=h.projectPosition([s,l,0])),nwe([N[0]-S[0],N[1]-S[1],U[0]-S[0],U[1]-S[1]],D,D)}_commonToWorldBounds(e){const[r,n,i,o]=e,{viewport:s}=this.context,l=s.unprojectPosition([r,n]),h=s.unprojectPosition([i,o]);return l.slice(0,2).concat(h.slice(0,2))}}nw.layerName="HeatmapLayer",nw.defaultProps=mwe;const bwe=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:tA,ContourLayer:tw,GridLayer:rw,HeatmapLayer:nw,HexagonLayer:ew,ScreenGridLayer:Yx,WebGLAggregator:za,_AggregationLayer:rA},Symbol.toStringTag,{value:"Module"})),W5=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],J5=[0n,1n,2n,4n,8n,16n];function vwe(t){return BigInt(`0x${t}`)}function iw(t){return t.toString(16)}function xwe(t){if(t.z<0||t.z>26)throw new Error("Wrong zoom");const e=BigInt(t.z);let r=BigInt(t.x)<<32n-e,n=BigInt(t.y)<<32n-e;for(let i=0;i<5;i++){const o=J5[5-i],s=W5[4-i];r=(r|r<<o)&s,n=(n|n<<o)&s}return 0x4000000000000000n|1n<<59n|e<<52n|(r|n<<1n)>>12n|0xfffffffffffffn>>e*2n}function K5(t){const e=t>>59n&7n,r=t>>57n&3n,n=t>>52n&0x1fn,i=(t&0xfffffffffffffn)<<12n;if(e!==1n&&r!==0n)throw new Error("Wrong mode");let o=i,s=i>>1n;for(let l=0;l<6;l++){const h=J5[l],A=W5[l];o=(o|o>>h)&A,s=(s|s>>h)&A}return o=o>>32n-n,s=s>>32n-n,{z:Number(n),x:Number(o),y:Number(s)}}function ME(t){return t>>52n&0x1fn}function X5(t){const e=ME(t)-1n;return t&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function _f(t,e){$r.assert(t,e)}function wwe(t,e){const{properties:r,numericProps:n}=t;return new Proxy(r[e]||{},{get(i,o){return o in n?n[o].value[e]:i[o]},has(i,o){return o in n||o in i},ownKeys(i){return[...Object.keys(n),...Reflect.ownKeys(i)]},getOwnPropertyDescriptor(i,o){return{enumerable:!0,configurable:!0}}})}function ob(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}const xg=new Uint16Array,l2={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:xg,size:1},globalFeatureIds:{value:xg,size:1}};function Q5(){return{shape:"binary-feature-collection",points:{type:"Point",...l2},lines:{type:"LineString",pathIndices:{value:xg,size:1},...l2},polygons:{type:"Polygon",polygonIndices:{value:xg,size:1},primitivePolygonIndices:{value:xg,size:1},...l2}}}function PE(t,e,r,n,i,o=2){return{type:"Point",positions:{value:new Float32Array(t),size:o},featureIds:{value:new Uint16Array(e),size:1},globalFeatureIds:{value:new Uint32Array(r),size:1},numericProps:n,properties:i}}function Z5(t,e){const r={};return e&&Object.keys(e).forEach(n=>{r[n]={value:new Float32Array(t),size:1}}),r}function $5(t,e,r,n){Object.keys(t).forEach(i=>{e[i].value[n]=t[i].value[r]})}function Cwe(t,e,r,n=[],i,o){if(!t.content)return!1;t.userData||(t.userData={});const s=e.get(r)?.[0];if(s){if(n.every(h=>h.name in s))return!1;e.clear()}const l={};for(const h of t.content){let A=h.id;const b=typeof i=="function"?i(h,{}):i;for(let U=0;U<r-1;U++)A=X5(A);const C=Number(A);if(!(C in l)){l[C]={id:A,count:0,position:[0,0]};for(const{name:U,aggregation:V}of n)V==="any"?l[C][U]=h.properties[U]:l[C][U]=0}const S=l[C].count;l[C].count+=typeof o=="function"?o(h,{}):o;const D=l[C].count,N=D-S;l[C].position[0]=(S*l[C].position[0]+N*b[0])/D,l[C].position[1]=(S*l[C].position[1]+N*b[1])/D;for(const{name:U,aggregation:V}of n){const j=l[C][U],ee=h.properties[U];V==="average"?l[C][U]=(S*j+N*ee)/D:V==="count"||V==="sum"?l[C][U]=j+ee:V==="max"?l[C][U]=Math.max(j,ee):V==="min"&&(l[C][U]=Math.min(j,ee))}}return e.set(r,Object.values(l)),!0}function Ewe(t){const e=[],r=["any","average","count","min","max","sum"];for(const n of Object.keys(t.content[0].properties)){let i=n.split("_").pop().toLowerCase();r.includes(i)||($r.warn(`No valid aggregation present in ${n} property`)(),i="any"),e.push({name:n,aggregation:i})}return e}function Bwe(t,e){const r={};for(const{name:n,aggregation:i}of e)if(r[n]={min:1/0,max:-1/0},i!=="any")for(const o of t)r[n].min=Math.min(r[n].min,o[n]),r[n].max=Math.max(r[n].max,o[n]);return r}function Twe(t){const e=new Float32Array(t.length*2),r=new Uint16Array(t.length);for(let n=0;n<t.length;n++)e.set(t[n].position,2*n),r[n]=n;return{...Q5(),points:PE(e,r,r,{},t)}}const nA=512;class LE extends Vy{getTileIndices(e){return super.getTileIndices(e).map(xwe).map(r=>({q:r,i:iw(r)}))}getTileId({q:e,i:r}){return r||iw(e)}getTileMetadata({q:e}){return super.getTileMetadata(K5(e))}getTileZoom({q:e}){return Number(ME(e))}getParentIndex({q:e}){return{q:X5(e)}}}const CR=512;function q5(t){const{x:e,y:r,z:n}=K5(t),i=CR/(1<<n);return[e*i,CR-r*i,i]}function Swe(t,e){const[r,n,i]=q5(t);return[[r,n],[r+e*i,n-e*i]]}function Y5(t,e=1){const[r,n]=Swe(t,e),[i,o]=dc(r),[s,l]=dc(n);return[s,o,s,l,i,l,i,o,s,o]}const R0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ER=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ER&&parseFloat(ER[1]);function Iwe(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function Mwe(...t){return Pwe(t)}function Pwe(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function Lwe(t){const e=[];for await(const r of t)e.push(r);return Mwe(...e)}function Rwe(t){return t&&typeof t=="object"&&t.isBuffer}function O0(t){if(Rwe(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function D0(t){return e=>new Promise((r,n)=>t(e,(i,o)=>i?n(i):r(o)))}class Owe{constructor(e){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(e={}){Iwe(e)}async compress(e){return await this.preload(),this.compressSync(e)}async decompress(e,r){return await this.preload(),this.decompressSync(e,r)}compressSync(e){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(e,r){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(e){const r=await this.concatenate(e);yield this.compress(r)}async*decompressBatches(e){const r=await this.concatenate(e);yield this.decompress(r)}concatenate(e){return Lwe(e)}improveError(e){return e.message.includes(this.name)||(e.message=`${this.name} ${e.message}`),e}}class Dwe extends Owe{name="deflate";extensions=[];contentEncodings=["deflate"];isSupported=!0;options;_chunks=[];constructor(e={}){super(e),this.options=e}async compress(e){if(!R0&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?await D0(Ou.gzip)(e):await D0(Ou.deflate)(e);return O0(r)}return this.compressSync(e)}async decompress(e){if(!R0&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?await D0(Ou.gunzip)(e):await D0(Ou.inflate)(e);return O0(r)}return this.decompressSync(e)}compressSync(e){if(!R0&&this.options.deflate?.useZlib){const i=this.options.deflate?.gzip?Ou.gzipSync(e):Ou.deflateSync(e);return O0(i)}const r=this.options?.deflate||{},n=new Uint8Array(e);return(this.options?.raw?jd.deflateRaw:jd.deflate)(n,r).buffer}decompressSync(e){if(!R0&&this.options.deflate?.useZlib){const i=this.options.deflate?.gzip?Ou.gunzipSync(e):Ou.inflateSync(e);return O0(i)}const r=this.options?.deflate||{},n=new Uint8Array(e);return(this.options?.raw?jd.inflateRaw:jd.inflate)(n,r).buffer}async*compressBatches(e){const r=this.options?.deflate||{},n=new jd.Deflate(r);yield*this.transformBatches(n,e)}async*decompressBatches(e){const r=this.options?.deflate||{},n=new jd.Inflate(r);yield*this.transformBatches(n,e)}async*transformBatches(e,r){e.onData=this._onData.bind(this),e.onEnd=this._onEnd.bind(this);for await(const i of r){const o=new Uint8Array(i);if(!e.push(o,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const n=new Uint8Array(0);e.push(n,!0),yield*this._getChunks()}_onData(e){this._chunks.push(e)}_onEnd(e){if(e!==0)throw new Error(this._getError(e)+this._chunks.length)}_getChunks(){const e=this._chunks;return this._chunks=[],e}_getError(e=0){const r={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${r[e]}`}}class Fwe extends Dwe{name="gzip";extensions=["gz","gzip"];contentEncodings=["gzip","x-gzip"];isSupported=!0;constructor(e){super({...e,deflate:{...e?.gzip,gzip:!0}})}}function ab(t,e,r,n){const i=e.type===2?e.readVarint()+e.pos:e.pos+1,o=e.buf.buffer.slice(e.pos,i);if(n?.compression==="gzip"){const s=new Fwe().decompressSync(o);r.value=new t(s)}else r.value=new t(o);return e.pos=i,r.value}class RE{static read(e,r){return e.readFields(RE._readField,{key:"",value:null},r)}static _readField(e,r,n){e===1?r.key=n.readString():e===2&&(r.value=n.readString())}}class If{static read(e,r){return e.readFields(If._readField,{},r)}static _readField(e,r,n){if(e===1){const{key:i,value:o}=RE.read(n,n.readVarint()+n.pos);r[i]=o}}}class im{static read(e,r){const{value:n,size:i}=e.readFields(im._readField,{value:[],size:0},r);return{value:n,size:i}}static _readField(e,r,n){e===1?ab(Float64Array,n,r):e===2&&(r.size=n.readVarint(!0))}}class Na{static read(e,r){const{value:n,size:i}=e.readFields(Na._readField,{value:[],size:0},r);return{value:new Uint32Array(n),size:i}}static _readField(e,r,n){e===1?n.readPackedVarint(r.value):e===2&&(r.size=n.readVarint(!0))}}class sm{static read(e,r){return e.readFields(sm._readField,{id:0},r)}static _readField(e,r,n){e===1&&(r.id=n.readVarint())}}class OE{static read(e,r){return e.readFields(OE._readField,{value:[]},r)}static _readField(e,r,n){e===1&&ab(Float64Array,n,r)}}class Mf{static read(e,r){return e.readFields(Mf._readField,{key:"",value:null},r)}static _readField(e,r,n){e===1?r.key=n.readString():e===2&&(r.value=OE.read(n,n.readVarint()+n.pos))}}class DE{static read(e,r){return e.readFields(DE._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=im.read(n,n.readVarint()+n.pos);else if(e===2)r.globalFeatureIds=Na.read(n,n.readVarint()+n.pos);else if(e===3)r.featureIds=Na.read(n,n.readVarint()+n.pos);else if(e===4)r.properties.push(If.read(n,n.readVarint()+n.pos));else if(e===5){const i=Mf.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===6&&r.fields.push(sm.read(n,n.readVarint()+n.pos))}}class FE{static read(e,r){return e.readFields(FE._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=im.read(n,n.readVarint()+n.pos);else if(e===2)r.pathIndices=Na.read(n,n.readVarint()+n.pos);else if(e===3)r.globalFeatureIds=Na.read(n,n.readVarint()+n.pos);else if(e===4)r.featureIds=Na.read(n,n.readVarint()+n.pos);else if(e===5)r.properties.push(If.read(n,n.readVarint()+n.pos));else if(e===6){const i=Mf.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===7&&r.fields.push(sm.read(n,n.readVarint()+n.pos))}}class kE{static read(e,r){return e.readFields(kE._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=im.read(n,n.readVarint()+n.pos);else if(e===2)r.polygonIndices=Na.read(n,n.readVarint()+n.pos);else if(e===3)r.globalFeatureIds=Na.read(n,n.readVarint()+n.pos);else if(e===4)r.featureIds=Na.read(n,n.readVarint()+n.pos);else if(e===5)r.primitivePolygonIndices=Na.read(n,n.readVarint()+n.pos);else if(e===6)r.triangles=Na.read(n,n.readVarint()+n.pos);else if(e===7)r.properties.push(If.read(n,n.readVarint()+n.pos));else if(e===8){const i=Mf.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===9&&r.fields.push(sm.read(n,n.readVarint()+n.pos))}}let kwe=class e9{static read(e,r){return e.readFields(e9._readField,{points:null,lines:null,polygons:null},r)}static _readField(e,r,n){e===1?r.points=DE.read(n,n.readVarint()+n.pos):e===2?r.lines=FE.read(n,n.readVarint()+n.pos):e===3&&(r.polygons=kE.read(n,n.readVarint()+n.pos))}};class NE{static read(e,r){return e.readFields(NE._readField,{value:[]},r)}static _readField(e,r,n){e===1&&ab(BigUint64Array,n,r)}}class UE{static read(e,r){return e.readFields(UE._readField,{indices:null,properties:[],numericProps:{}},r)}static _readField(e,r,n){if(e===1)r.indices=NE.read(n,n.readVarint()+n.pos);else if(e===2)r.properties.push(If.read(n,n.readVarint()+n.pos));else if(e===3){const i=Mf.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}}}let Nwe=class t9{static read(e,r){return e.readFields(t9._readField,{scheme:0,cells:null},r)}static _readField(e,r,n){e===1?r.scheme=n.readVarint():e===2&&(r.cells=UE.read(n,n.readVarint()+n.pos))}};function lb(t,e){const r=new S2e(t);return e.read(r)}function Uwe(t){const{cells:e,scheme:r}=t,n=e.indices.value.length,i=[];for(let o=0;o<n;o++){const s=r==="h3"?iw(e.indices.value[o]):e.indices.value[o],l={...e.properties[o]};for(const h of Object.keys(e.numericProps))l[h]=e.numericProps[h].value[o];i.push({id:s,properties:l})}return i}const r9="9.1.14",n9="cartoSpatialTile",Gwe={cartoSpatialTile:{scheme:"quadbin",workerUrl:ob(n9,r9)}},i9={name:"CARTO Spatial Tile",version:r9,id:n9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>BR(t,e),parseSync:BR,worker:!0,options:Gwe};function BR(t,e){if(!t)return null;const r=lb(t,Nwe),{cells:n}=r,i=e?.cartoSpatialTile?.scheme;return Uwe({cells:n,scheme:i})}function iA(t,e,r=0){if(!t)return e;if(!e)return t;if(r>10)return e;const n={...t};for(const i in e){const o=e[i];o===t||o===e||(typeof o=="object"&&o!==null?n[i]=iA(t[i],o,r+1):n[i]=o)}return n}function zwe(t,e){const r={};for(const{geoid:n,...i}of e.properties)n in r?$r.warn("Duplicate geoid key in boundary mapping, using first occurance")():r[n]=i;for(const n of["points","lines","polygons"]){const i=t[n];if(i.positions.value.length===0)continue;i.properties=i.properties.map(({geoid:A})=>r[A]);const{positions:o,globalFeatureIds:s}=i;let l=null;n==="lines"&&(l=i.pathIndices.value),n==="polygons"&&(l=i.polygonIndices.value);const h=o.value.length/o.size;for(const A in e.numericProps){const b=e.numericProps[A].value,C=b.constructor,S=new C(h);if(i.numericProps[A]={value:S,size:1},l)for(let D=0;D<l.length-1;D++){const N=l[D],U=l[D+1],V=s.value[N];S.fill(b[V],N,U)}else for(let D=0;D<h;D++){const N=s.value[D];S[D]=b[N]}}}return t}const yf={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(r=>typeof r=="string"),equal:(t,e)=>es(t,e,2),async:!0};Qg([i9]);const s9={data:yf,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:t})=>Y5(t,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:nA};class sw extends su{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){const e=this.state.tileset?.tiles.filter(S=>S.isLoaded&&S.content&&this.state.tileset.isTileVisible(S));if(!e?.length)return null;e.sort((S,D)=>D.zoom-S.zoom);const{zoom:r}=this.context.viewport,{clusterLevel:n,getPosition:i,getWeight:o}=this.props,{aggregationCache:s}=this.state,l=Ewe(e[0]),h=[];let A=!1;for(const S of e){const D=Math.round(r-S.zoom),N=Math.round(n)-D;let U=s.get(S.content);U||(U=new Map,s.set(S.content,U));const V=Cwe(S,U,N,l,i,o);A||(A=V),h.push(...U.get(N))}h.sort((S,D)=>Number(D.count-S.count));const b=h?.map(S=>S.id);if(A||(A=!es(b,this.state.clusterIds,1)),this.setState({clusterIds:b}),A){const S=Bwe(h,l),D=Twe(h);D.points.attributes={stats:S},this.setState({data:D})}const C={...this.props,id:"clusters",data:this.state.data,dataComparator:(S,D)=>{const N=S?.points?.properties?.map(V=>V.id),U=D?.points?.properties?.map(V=>V.id);return es(N,U,1)}};return new nu(this.getSubLayerProps(C))}getPickingInfo(e){const r=e.info;if(r.index!==-1){const{data:n}=e.sourceLayer.props;r.object=qx(n,{globalFeatureId:r.index})}return r}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}filterSubLayer(){return!0}}sw.layerName="ClusterGeoJsonLayer",sw.defaultProps=s9;class ow extends Bs{getLoadOptions(){const e=this.props.data;return iA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:n}=e;return[new sw(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:r,TilesetClass:LE,maxZoom:n,loadOptions:this.getLoadOptions()})]}}ow.layerName="ClusterTileLayer",ow.defaultProps=s9;const TR=85.051128;function o9({west:t,north:e,east:r,south:n},i,o=1){const s=[[e,r],[n,r],[n,t],[e,t]].map(A=>nE(A[0],A[1],i)).map(A=>Math.max(...lpe(A).map(b=>upe(b,Sp.rads)))*180/Math.PI),l=Math.max(...s)*o,h=Math.min(180,l/Math.cos((e+n)/2*Math.PI/180));return{north:Math.min(e+l,TR),east:r+h,south:Math.max(n-l,-TR),west:t-h}}function a9({west:t,north:e,east:r,south:n},i){const o=Math.abs(r-t);if(o>180){const s=Math.ceil(o/180);let l=[];for(let h=0;h<s;h++){const A=t+h*180,b=Math.min(A+179.9999999,r);l=l.concat(a9({west:A,north:e,east:b,south:n},i))}return[...new Set(l)]}return ope([[e,r],[n,r],[n,t],[e,t],[e,r]],i)}function jwe(t){const e=ok(t),r=e.map(h=>h[0]),n=e.map(h=>h[1]),i=Math.min(...n),o=Math.min(...r),s=Math.max(...n),l=Math.max(...r);return o9({west:i,south:o,east:s,north:l},ty(t),.12)}const Hwe=2;function aw(t,e){const r=Math.log2(e/512),n=2/3*(t.zoom-r),i=Math.log(1/Math.cos(Math.PI*t.latitude/180));return Math.max(0,Math.floor(n+i-Hwe))}class Vwe extends Vy{getTileIndices({viewport:e,minZoom:r,maxZoom:n}){if(e.latitude===void 0)return[];const[i,o,s,l]=e.getBounds(),{tileSize:h}=this.opts;let A=aw(e,h),b;if(typeof r=="number"&&Number.isFinite(r)&&A<r)return[];if(typeof n=="number"&&Number.isFinite(n)&&A>n){A=n;const C=nE(e.latitude,e.longitude,n);b=spe(C,1)}else{const C=o9({west:i,north:l,east:s,south:o},A);b=a9(C,A)}return b.map(C=>({i:C}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:jwe(e)}}getTileZoom({i:e}){return ty(e)}getParentIndex(e){const r=ty(e.i);return{i:ipe(e.i,r-1)}}}Qg([i9]);function Wwe(t){return t!=null&&t!==""}const Jwe={tileSize:nA};class gy extends su{_updateAutoHighlight(e){const{hoveredFeatureId:r}=this.state,n=e.object;let i=null;if(n&&(i=n.id),r!==i){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(e)),this.setState({highlightColor:o,hoveredFeatureId:i})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r}=this.state,n=e.content;return!Wwe(r)||!Array.isArray(n)||!this._featureInTile(e,r)?-1:n.findIndex(i=>i.id===r)}_featureInTile(e,r){const n=this.state.tileset,i=n.getTileZoom(e.index),o=e.index.q?"q":"i";let s={[o]:r},l=n.getTileZoom(s);for(;!(l<=i);)s=n.getParentIndex(s),l=n.getTileZoom(s);return s[o]===e.index[o]}}gy.layerName="SpatialIndexTileLayer",gy.defaultProps=Jwe;const Kwe=t=>{const{data:e}=t,{index:r}=t.tile;return!e||!e.length?null:new fc(t,{getHexagon:n=>n.id,centerHexagon:r,highPrecision:!0})},Xwe={data:yf,tileSize:nA};class lw extends Bs{initializeState(){fc._checkH3Lib()}getLoadOptions(){const e=this.props.data;return iA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"h3"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r}=e;let{minresolution:n,maxresolution:i}=e;this.props.minZoom&&(n=Math.max(n,aw({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(i=Math.min(i,aw({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const o=this.getSubLayerClass("spatial-index-tile",gy);return new o(this.props,{id:`h3-tile-layer-${this.props.id}`,data:r,TilesetClass:Vwe,renderSubLayers:Kwe,minZoom:n,maxZoom:i,loadOptions:this.getLoadOptions()})}}lw.layerName="H3TileLayer",lw.defaultProps=Xwe;const Qwe=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,Zwe={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:t=>{if(!t)return{};const{colorDomain:e=[0,1],colorTexture:r,delta:n=[1,0],intensity:i=1,opacity:o=1,radiusPixels:s=20}=t;return{colorDomain:e,colorTexture:r,delta:n,intensity:i,opacity:o,radiusPixels:s}},fs:Qwe,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},$we={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function cw(t){for(;t.parent&&!t.applyPostProcess;)t=t.parent;return t}class l9 extends Es{initializeState(){this.id=`draw-callback-${cw(this).props.id}`}_drawLayer(){cw(this).applyPostProcess()}}l9.layerName="DrawCallbackLayer";function c9(t){var e;return e=class extends t{draw(r){const{shaderModuleProps:n}=r,{picking:i}=n,o=cw(this);i.isActive||o.enableRTT(r),super.draw(r),i.isActive||o.disableRTT()}},e.layerName=`RTT-${t.layerName}`,e}function u9(t,e){var r;return r=class extends t{initializeState(n){super.initializeState(n),this._createTextures(),this.internalState.postProcess=new dX(e,this.props),this.internalState.postProcess.setup(n)}updateState(n){super.updateState(n),this.internalState.postProcess.setProps(this.props)}renderLayers(){let n=super.renderLayers();return n?(n=Array.isArray(n)?n:[n],[...n,new l9]):null}_createTextures(){const{device:n}=this.context;this.internalState.renderBuffers=[0,1].map(i=>n.createFramebuffer({id:`layer-fbo-${i}`,colorAttachments:[n.createTexture($we)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(n){const{shaderModuleProps:i}=n,{viewport:o}=this.context,{devicePixelRatio:s}=i.project,l=s*o.width,h=s*o.height;this.internalState.renderBuffers.forEach(A=>A.resize({width:l,height:h}))}enableRTT(n){this._resizeBuffers(n),this.internalState.originalRenderPass=this.context.renderPass;const[i]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:i,parameters:{viewport:[0,0,i.width,i.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[n,i]=this.internalState.renderBuffers,{framebuffer:o}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:n,swapBuffer:i,target:o}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(n=>{n.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},r.layerName=`PostProcess${t.layerName}`,r}const qwe=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,Ywe={name:"copy",fs:qwe,getUniforms:()=>({}),passes:[{filter:!0}]},eCe={getQuadbin:{type:"accessor",value:t=>t.quadbin}};class uw extends oh{indexToBounds(){const{data:e,extruded:r,getQuadbin:n}=this.props,i=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>Y5(n(o,s),i),updateTriggers:{getPolygon:i}}}}uw.layerName="QuadbinLayer",uw.defaultProps=eCe;const tCe=t=>{const{data:e}=t;if(!e||!e.length)return null;const r=typeof e[0].id=="bigint";return new uw(t,{getQuadbin:r?n=>n.id:n=>vwe(n.id)})},rCe={data:yf,tileSize:nA};class my extends Bs{getLoadOptions(){const e=this.props.data;return iA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:n}=e,i=this.getSubLayerClass("spatial-index-tile",gy);return new i(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:r,TilesetClass:LE,renderSubLayers:tCe,maxZoom:n,loadOptions:this.getLoadOptions()})}}my.layerName="QuadbinTileLayer",my.defaultProps=rCe;const nCe=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],iCe={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function h9(t){const e=Number(ME(t));return Math.pow(4,e)}function sCe(t){const e=new Uint8Array(t.length*4);let r=0;for(let n=0;n<t.length;n++){const i=t[n];e[r++]=i[0],e[r++]=i[1],e[r++]=i[2],e[r++]=Number.isFinite(i[3])?i[3]:255}return e}const oCe=`uniform densityUniforms {
  float factor;
} density;
`,aCe={name:"density",vs:oCe,uniformTypes:{factor:"f32"}};class f9 extends c9(ih){getShaders(e){const r=super.getShaders(e);return r.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},r.modules=[...r.modules,aCe],r}draw(e){const r=this.props.data[0],n=this.props.elevationScale,i={factor:h9(r.id)/n};for(const o of this.state.models)o.shaderInputs.setProps({density:i});super.draw(e)}}f9.layerName="RTTSolidPolygonLayer";const lCe=u9(my,Zwe),cCe={data:yf,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:nCe,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class hw extends Bs{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:r}=e;return this.setState({viewportChanged:r}),e.somethingChanged}updateState(e){const{props:r,oldProps:n}=e;super.updateState(e),r.colorRange!==n.colorRange&&this._updateColorTexture(e)}renderLayers(){const{data:e,getWeight:r,colorDomain:n,intensity:i,radiusPixels:o,_subLayerProps:s,updateTriggers:l,onMaxDensityChange:h,onViewportLoad:A,onTileLoad:b,onTileUnload:C,...S}=this.props,D={...s,cell:{...s?.cell,_subLayerProps:{...s?.cell?._subLayerProps,fill:{...s?.cell?._subLayerProps?.fill,type:f9}}}};let N=0,U=0;const V=[...this.state.tiles].filter(X=>X.content),j=V.filter(X=>X.isVisible),ee=j.length?j:V;for(const X of ee){const pe=X.content[0],Y=h9(pe.id);U=Math.max(X.userData.maxWeight*Y,U),N=Math.max(X.zoom,N)}const Q=this.context.viewport.zoom-N;return U=U*Math.pow(2,Q),typeof h=="function"&&h(U),new lCe(S,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:r,elevationScale:U,colorDomain:n,radiusPixels:o,intensity:i,_subLayerProps:D,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:l.getWeight},onViewportLoad:X=>{this.setState({isLoaded:!0}),typeof A=="function"&&A(X)},onTileLoad:X=>{let pe=-1/0;if(typeof r!="function")pe=r;else if(X.content)for(const Y of X.content)pe=Math.max(r(Y,{}),pe);X.userData={maxWeight:pe},this.state.tiles.add(X),typeof b=="function"&&b(X)},onTileUnload:X=>{this.state.tiles.delete(X),typeof C=="function"&&C(X)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(e){const{colorRange:r}=e.props;let{colorTexture:n}=this.state;const i=sCe(r);n&&n?.width===r.length?n.setTexture2DData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...iCe,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}}hw.layerName="HeatmapTileLayer",hw.defaultProps=cCe;const[SR,IR,MR,PR]=[0,1,2,3];class d9 extends Gg{getShaders(){const e=super.getShaders();let r=e.vs;return r=r.replaceAll("textBackground.padding.","_padding."),r=r.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:r}}}d9.layerName="EnhancedTextBackgroundLayer";class p9 extends Af{filterSubLayer({layer:e,renderPass:r}){const n=e.id.includes("primary-background");return r==="collision"?n:!n}}p9.layerName="EnhancedTextLayer";const uCe={...Af.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class _y extends Bs{calculatePixelOffset(e){const{getTextAnchor:r,getAlignmentBaseline:n,getRadius:i,getSecondaryText:o,radiusScale:s,secondarySizeScale:l,sizeScale:h}=this.props,A=r==="middle"?0:r==="start"?1:-1,b=n==="center"?0:n==="bottom"?1:-1,C=h/4,S=h*(1+1/4),D=.6*(1-b)*h;let N=e?D:0;r==="middle"&&n==="top"&&o&&(N-=D,N-=l,N+=h);const U=1+1/4;return typeof i=="function"?(V,j)=>{const ee=(j?i(V,j):1)*s*U;return[A*(ee+C),b*(ee+S)+N]}:[A*(i*s*U+C),b*(i*s*U+S)+N]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:r,sizeScale:n}=this.props,i=12*n,o=3*n,s=[0,0,0,0];return r==="top"?s[IR]=o:r==="bottom"?s[PR]=o:(s[IR]=.5*o,s[PR]=.5*o),e==="start"?s[SR]=i:e==="end"?s[MR]=i:(s[SR]=.5*i,s[MR]=.5*i),s}renderTextLayer(e,{updateTriggers:r={},...n}){const{data:i,characterSet:o,fontFamily:s,fontSettings:l,fontWeight:h,outlineColor:A,outlineWidth:b,sizeScale:C,radiusScale:S,getAlignmentBaseline:D,getColor:N,getPosition:U,getTextAnchor:V,updateTriggers:j}=this.props;if(C<2){const ee=this.parent?.props?.textSizeScale?"textSizeScale":"sizeScale";$r.warn(`${ee} has small value (${C}). Note getTextSize is not supported on PointLabelLayer`)()}return new p9(this.getSubLayerProps({id:e,data:i,characterSet:o,fontFamily:s,fontSettings:l,fontWeight:h,outlineColor:A,outlineWidth:b,sizeScale:C,getAlignmentBaseline:D,getColor:N,getPosition:U,getTextAnchor:V,updateTriggers:{...j,...r,getPixelOffset:[j.getRadius,j.getTextAnchor,j.getAlignmentBaseline,S,C]}}),{getSize:1,_subLayerProps:{background:{type:d9}}},n)}renderLayers(){const{getText:e,getSecondaryColor:r,getSecondaryText:n,secondaryOutlineColor:i,secondarySizeScale:o,updateTriggers:s}=this.props,l=this.calculatePixelOffset(!1),h=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:h,getText:e,getPixelOffset:l,background:!0}),!!n&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...r&&{getColor:r},...o&&{sizeScale:o},...i&&{outlineColor:i}})]}}_y.layerName="PointLabelLayer",_y.defaultProps=uCe;const hCe=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,fCe={...Ac.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class A9 extends c9(Ac){getShaders(){const e=super.getShaders(),r=this.props.data,n=r.data.blockSize??Math.sqrt(r.length);return{...e,defines:{...e.defines,BLOCK_WIDTH:n},vs:hCe}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}A9.layerName="RasterColumnLayer";function dCe(t,e){return t.data===e.data&&t.length===e.length}class fw extends Bs{renderLayers(){const{data:e,getElevation:r,getFillColor:n,getLineColor:i,getLineWidth:o,tileIndex:s,updateTriggers:l}=this.props;if(!e||!s)return null;const h=e.blockSize??0,[A,b,C]=q5(s),S=[A,b],D=C/h,N=this.getSubLayerClass("column",A9),{highlightedObjectIndex:U,highlightColor:V}=this.state;return new N(this.props,this.getSubLayerProps({id:"cell",updateTriggers:l,getElevation:this.getSubLayerAccessor(r),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:e,length:h*h},dataComparator:dCe,offset:S,lineWidthScale:D,highlightedObjectIndex:U,highlightColor:V,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(e){return typeof e!="function"?super.getSubLayerAccessor(e):(r,n)=>{const{data:i,index:o}=n,s=i.data,l=wwe(s.cells,o);return e({properties:l},n)}}getPickingInfo(e){const r=super.getPickingInfo(e);return r.index!==-1&&(r.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:r.index})),r}_updateAutoHighlight(e){const{highlightedObjectIndex:r}=this.state;let n=-1;if(e.index!==-1&&(n=e.index),r!==n){let{highlightColor:i}=this.props;typeof i=="function"&&(i=i(e)),this.setState({highlightColor:i,highlightedObjectIndex:n})}}}fw.layerName="RasterLayer",fw.defaultProps=fCe;const pCe={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class GE{static read(e,r){return e.readFields(GE._readField,{name:"",type:"",data:null},r)}static _readField(e,r,n){if(e===1)r.name=n.readString();else if(e===2)r.type=n.readString();else if(e===3){const i=pCe[r.type];if(!i)throw Error(`Invalid data type: ${r.type}`);r.data={};const{compression:o}=dw;ab(i,n,r.data,{compression:o})}}}let dw=class g9{static read(e,r){return e.readFields(g9._readField,{blockSize:0,bands:[]},r)}static _readField(e,r,n){e===1?r.blockSize=n.readVarint():e===2&&r.bands.push(GE.read(n,n.readVarint()+n.pos))}};const m9="9.1.14",_9="cartoRasterTile",ACe={cartoRasterTile:{metadata:null,workerUrl:ob(_9,m9)}},gCe={name:"CARTO Raster Tile",version:m9,id:_9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(t,e)=>LR(t,e),parseSync:LR,worker:!0,options:ACe};function LR(t,e){const r=e?.cartoRasterTile?.metadata;if(!t||!r)return null;dw.compression=r.compression;const n=lb(t,dw),{bands:i,blockSize:o}=n,s={};for(let l=0;l<i.length;l++){const{name:h,data:A}=i[l];s[h]=A}return{blockSize:o,cells:{numericProps:s,properties:[]}}}Qg([gCe]);const mCe=t=>{const e=t.tile?.index?.q;return e?new fw(t,{tileIndex:e}):null},_Ce={data:yf,refinementStrategy:"no-overlap",tileSize:nA};class yCe extends u9(su,Ywe){filterSubLayer(e){const{tile:r}=e.layer.props;return r?super.filterSubLayer(e):!0}}class pw extends Bs{getLoadOptions(){const e=this.props.data;return iA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,minzoom:n,maxzoom:i,raster_metadata:o}=e,s=this.getSubLayerClass("tile",yCe),l=this.getLoadOptions();return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:r,TilesetClass:LE,renderSubLayers:mCe,minZoom:n,maxZoom:i,loadOptions:{...l,cartoRasterTile:{...l?.cartoRasterTile,metadata:o}}})}}pw.layerName="RasterTileLayer",pw.defaultProps=_Ce;class zE{static read(e,r){return e.readFields(zE._readField,{properties:[],numericProps:{}},r)}static _readField(e,r,n){if(e===1)r.properties.push(If.read(n,n.readVarint()+n.pos));else if(e===2){const i=Mf.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}}}const y9="9.1.14",b9="cartoPropertiesTile",bCe={cartoPropertiesTile:{workerUrl:ob(b9,y9)}},vCe={name:"CARTO Properties Tile",version:y9,id:b9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(t,e)=>RR(t),parseSync:RR,options:bCe};function RR(t,e){return t?lb(t,zE):null}const v9="9.1.14",x9="cartoVectorTile",xCe={cartoVectorTile:{workerUrl:ob(x9,v9)}},wCe={name:"CARTO Vector Tile",version:v9,id:x9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(t,e)=>OR(t),parseSync:OR,worker:!0,options:xCe};function CCe(t,e,{startPosition:r,endPosition:n,indices:i}){const o=t.positions.size,s=r*o,l=n*o,h=t.positions.value.subarray(s,l),A=i.slice(1).map(C=>C-r),b=b8(h,A,o);for(let C=0,S=b.length;C<S;++C)e.push(r+b[C])}function ECe(t){const{polygonIndices:e,primitivePolygonIndices:r}=t,n=[];let i=0;for(let o=0;o<e.value.length-1;o++){const s=e.value[o],l=e.value[o+1],h=r.value.indexOf(l),A=r.value.subarray(i,h);i=h,CCe(t,n,{startPosition:s,endPosition:l,indices:A})}t.triangles={value:new Uint32Array(n),size:1}}function OR(t,e){if(!t)return null;const r=lb(t,kwe);return r.polygons&&!r.polygons.triangles&&ECe(r.polygons),r}function BCe(t,e){const r=e?e in t.numericProps:!1,n=new Map;for(let b=0;b<t.pathIndices.value.length-1;b++){const C=t.pathIndices.value[b],S=t.featureIds.value[C];let D;e===void 0?D=S:r?D=t.numericProps[e].value[C]:t.properties[S]&&e in t.properties[S]?D=t.properties[S][e]:D=void 0;const N=RCe(t,b);(!n.has(D)||N>n.get(D).length)&&n.set(D,{index:b,length:N})}const i=[],o=[],s=[],l=[],h=Z5(n.size,t.numericProps);let A=0;for(const[b,{index:C}]of n){const S=OCe(t,C);i.push(...S);const D=t.pathIndices.value[C],N=t.featureIds.value[D];s.push(A),o.push(t.properties[N]),l.push(t.globalFeatureIds.value[D]),$5(t.numericProps,h,D,A),A++}return PE(i,s,l,h,o)}function TCe(t,e,r){const{west:n,south:i,east:o,north:s}=e,l=(o-n)*(s-i)*1e-4,h=[],A=[],b=[],C=[],S=Z5(t.polygonIndices.value.length-1,t.numericProps);let D=0,N=0;const{extruded:U}=r;for(let V=0;V<t.polygonIndices.value.length-1;V++){const j=t.polygonIndices.value[V],ee=t.polygonIndices.value[V+1];if(SCe(t,V)<l)continue;const Q=PCe(t,V);let X=-1,pe=[0,0],Y=!1;for(;N<t.triangles.value.length;){const ze=t.triangles.value[N];if(ze>=ee)break;if(Y){N+=3;continue}const de=t.triangles.value[N+1],ce=t.triangles.value[N+2],De=t.positions.value.subarray(ze*t.positions.size,ze*t.positions.size+t.positions.size),J=t.positions.value.subarray(de*t.positions.size,de*t.positions.size+t.positions.size),ue=t.positions.value.subarray(ce*t.positions.size,ce*t.positions.size+t.positions.size);if(MCe(Q,De,J,ue))Y=!0;else{const Ee=w9(De,J,ue);Ee>X&&(X=Ee,pe=[(De[0]+J[0]+ue[0])/3,(De[1]+J[1]+ue[1])/3])}N+=3}const Ge=Y?Q:pe;if(ICe(Ge,e)){h.push(...Ge);const ze=t.featureIds.value[j];if(U){const de=r.getElevation(void 0,{data:t,index:ze});h.push(de*r.elevationScale)}A.push(t.properties[ze]),b.push(D),C.push(t.globalFeatureIds.value[j]),$5(t.numericProps,S,j,D),D++}}return t.numericProps&&Object.keys(S).forEach(V=>{S[V].value=S[V].value.slice(0,D)}),PE(h,b,C,S,A,U?3:2)}function SCe(t,e){const{positions:{value:r,size:n},polygonIndices:{value:i},triangles:{value:o}}=t,s=i[e],l=i[e+1];let h=0,A=0;for(;A<o.length&&!(o[A]>=s);)A+=3;for(;A<o.length;){const b=o[A];if(b>=l)break;const C=o[A+1],S=o[A+2],D=r.subarray(b*n,b*n+n),N=r.subarray(C*n,C*n+n),U=r.subarray(S*n,S*n+n);h+=w9(D,N,U),A+=3}return h}function ICe([t,e],{west:r,east:n,south:i,north:o}){return t>=r&&t<n&&e>=i&&e<o}function MCe(t,e,r,n){const i=Math.abs((r[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(r[1]-e[1]))/2,o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]))/2,s=Math.abs((r[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(r[1]-t[1]))/2,l=Math.abs((n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1]))/2;return Math.abs(i-(o+s+l))<1e-10}function w9([t,e],[r,n],[i,o]){return Math.abs((t*(n-o)+r*(o-e)+i*(e-n))/2)}function PCe(t,e){const{positions:{value:r,size:n}}=t,i=n*t.polygonIndices.value[e],o=n*t.polygonIndices.value[e+1];let s=1/0,l=1/0,h=-1/0,A=-1/0;for(let b=i;b<o;b+=n){const[C,S]=r.subarray(b,b+2);s=Math.min(s,C),l=Math.min(l,S),h=Math.max(h,C),A=Math.max(A,S)}return[(s+h)/2,(l+A)/2]}function LCe(t,e){const{positions:{value:r}}=t,[n,i,o,s]=r.subarray(e,e+4);return Math.sqrt(Math.pow(o-n,2)+Math.pow(s-i,2))}function RCe(t,e){const{positions:{size:r}}=t,n=r*t.pathIndices.value[e],i=r*t.pathIndices.value[e+1];let o=0;for(let s=n;s<i;s+=r)o+=LCe(t,s);return o}function OCe(t,e){const{positions:{value:r},pathIndices:{value:n}}=t,i=n[e]*2,o=(n[e+1]*2-i)/2;if(o===2){const[l,h,A,b]=r.subarray(i,i+4);return[(l+A)/2,(h+b)/2]}const s=i+Math.floor(o/2)*2;return[r[s],r[s+1]]}Qg([vCe,wCe]);const DCe={...$p.defaultProps,autoLabels:!1,data:yf,dataComparator:yf.equal,tileSize:nA};class Aw extends $p{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:r}=e;if(r.data){super.updateState(e);const n=new URL(r.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const e=this.props.data;return iA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},gis:{format:"binary"}})}async getTileData(e){const r=this.props.data,{tiles:n,properties_tiles:i}=r,o=gf(n,e);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:l}=this.props,{signal:h}=e,A=l(o,{propName:"data",layer:this,loadOptions:s,signal:h});if(!i)return await A;const b=gf(i,e);if(!b)return Promise.reject("Invalid properties URL");const C=l(b,{propName:"data",layer:this,loadOptions:s,signal:h}),[S,D]=await Promise.all([A,C]);return S?D?zwe(S,D):S:null}renderSubLayers(e){if(e.data===null)return null;const r=e.tile.bbox,n=[],i={"points-text":{type:_y,...e?._subLayerProps?.["points-text"],extensions:[new $x,...e.extensions||[],...e?._subLayerProps?.["points-text"]?.extensions||[]]}};if(this.state.mvt)n.push(super.renderSubLayers(e));else{const{west:o,south:s,east:l,north:h}=r,A=[new uy,...e.extensions||[]],b={clipBounds:[o,s,l,h]},C=D=>({[D]:{...b,...e?._subLayerProps?.[D],extensions:[...A,...e?._subLayerProps?.[D]?.extensions||[]]}}),S={...e,data:{...e.data,tileBbox:r},autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...i,...C("polygons-fill"),...C("polygons-stroke"),...C("linestrings")}};n.push(new nu(S))}if(n[0]&&e.autoLabels){const o=Q5();e.data.lines&&e.data.lines.positions.value.length>0&&(o.points=BCe(e.data.lines,typeof e.autoLabels=="object"?e.autoLabels.uniqueIdProperty:void 0)),e.data.polygons&&e.data.polygons.positions.value.length>0&&(o.points=TCe(e.data.polygons,r,e)),n.push(n[0].clone({id:`${e.id}-labels`,data:o,pickable:!1,autoHighlight:!1}))}return n}renderLayers(){const e=super.renderLayers();if(!this.props.autoLabels)return e;const r=e.flat().filter(Boolean);return r.sort((n,i)=>{const o=n.id.includes("labels"),s=i.id.includes("labels");return o&&!s?1:!o&&s?-1:0}),r.map(n=>n.id.includes("labels")?n.clone({highlightedObjectIndex:-1}):n)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}Aw.layerName="VectorTileLayer",Aw.defaultProps=DCe;var Pn={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},FCe={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},kCe={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},NCe={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},UCe={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},GCe={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},zCe={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},jCe={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},HCe={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},VCe={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},WCe={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},JCe={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},KCe={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},XCe={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},QCe={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},ZCe={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},$Ce={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},qCe={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},YCe={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},eEe={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},tEe={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},rEe={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},nEe={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},iEe={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},sEe={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},oEe={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},aEe={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},lEe={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},cEe={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},uEe={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},hEe={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},fEe={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},dEe={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},pEe={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},AEe={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},gEe={...Pn.BuGn,tags:["quantitative"]},mEe={...Pn.BuPu,tags:["quantitative"]},_Ee={...Pn.GnBu,tags:["quantitative"]},yEe={...Pn.OrRd,tags:["quantitative"]},bEe={...Pn.PuBu,tags:["quantitative"]},vEe={...Pn.PuBuGn,tags:["quantitative"]},xEe={...Pn.PuRd,tags:["quantitative"]},wEe={...Pn.RdPu,tags:["quantitative"]},CEe={...Pn.YlGn,tags:["quantitative"]},EEe={...Pn.YlGnBu,tags:["quantitative"]},BEe={...Pn.YlOrBr,tags:["quantitative"]},TEe={...Pn.YlOrRd,tags:["quantitative"]},SEe={...Pn.Accent,tags:["qualitative"]},IEe={...Pn.Dark2,tags:["qualitative"]},MEe={...Pn.Paired,tags:["qualitative"]},PEe={...Pn.Pastel1,tags:["qualitative"]},LEe={...Pn.Pastel2,tags:["qualitative"]},REe={...Pn.Set1,tags:["qualitative"]},OEe={...Pn.Set2,tags:["qualitative"]},DEe={...Pn.Set3,tags:["qualitative"]},FEe={...Pn.Blues,tags:["quantitative"]},kEe={...Pn.Greens,tags:["quantitative"]},NEe={...Pn.Greys,tags:["quantitative"]},UEe={...Pn.Oranges,tags:["quantitative"]},GEe={...Pn.Purples,tags:["quantitative"]},zEe={...Pn.Reds,tags:["quantitative"]},jEe={...Pn.BrBG,tags:["diverging"]},HEe={...Pn.PiYG,tags:["diverging"]},VEe={...Pn.PRGn,tags:["diverging"]},WEe={...Pn.PuOr,tags:["diverging"]},JEe={...Pn.RdBu,tags:["diverging"]},KEe={...Pn.RdGy,tags:["diverging"]},XEe={...Pn.RdYlBu,tags:["diverging"]},QEe={...Pn.RdYlGn,tags:["diverging"]},ZEe={...Pn.Spectral,tags:["diverging"]};const $Ee=Object.freeze(Object.defineProperty({__proto__:null,Antique:uEe,ArmyRose:nEe,BluGrn:HCe,BluYl:KCe,Bold:hEe,BrwnYl:rEe,Burg:FCe,BurgYl:kCe,DarkMint:VCe,Earth:cEe,Emrld:WCe,Fall:iEe,Geyser:sEe,Magenta:YCe,Mint:jCe,OrYel:UCe,Pastel:fEe,Peach:GCe,PinkYl:zCe,Prism:dEe,Purp:ZCe,PurpOr:$Ce,RedOr:NCe,Safe:pEe,Sunset:qCe,SunsetDark:eEe,Teal:XCe,TealGrn:QCe,TealRose:aEe,Temps:oEe,Tropic:lEe,Vivid:AEe,ag_GrnYl:JCe,ag_Sunset:tEe,cb_Accent:SEe,cb_Blues:FEe,cb_BrBG:jEe,cb_BuGn:gEe,cb_BuPu:mEe,cb_Dark2:IEe,cb_GnBu:_Ee,cb_Greens:kEe,cb_Greys:NEe,cb_OrRd:yEe,cb_Oranges:UEe,cb_PRGn:VEe,cb_Paired:MEe,cb_Pastel1:PEe,cb_Pastel2:LEe,cb_PiYG:HEe,cb_PuBu:bEe,cb_PuBuGn:vEe,cb_PuOr:WEe,cb_PuRd:xEe,cb_Purples:GEe,cb_RdBu:JEe,cb_RdGy:KEe,cb_RdPu:wEe,cb_RdYlBu:XEe,cb_RdYlGn:QEe,cb_Reds:zEe,cb_Set1:REe,cb_Set2:OEe,cb_Set3:DEe,cb_Spectral:ZEe,cb_YlGn:CEe,cb_YlGnBu:EEe,cb_YlOrBr:BEe,cb_YlOrRd:TEe},Symbol.toStringTag,{value:"Module"})),jE="PurpOr",HE=[204,204,204],qEe=[119,119,119];function VE(t,e){const r=$Ee[t];let n=e;_f(r,`Palette "${t}" not found. Expected a CARTOColors string`);const i=Object.keys(r).filter(h=>h!=="tags").map(Number),o=Math.max(...i),s=Math.min(...i);!Number.isInteger(e)||e>o?n=o:e<s&&(n=s);let l=r[n];return r.tags&&r.tags.includes("qualitative")&&(l=l.slice(0,-1)),l.map(h=>YEe(h))}function YEe(t){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),_f(e,`Hexadecimal color "${t}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const e3e=Object.freeze(["function","string"]);function WE(t,e,r){return _f(typeof e=="object",'Expected "data" to be an object'),_f(e3e.includes(typeof t),'Expected "attr" to be a function or string'),typeof t=="function"?t(e,r):e?.properties?.[t]}function t3e({attr:t,domain:e,colors:r=jE,nullColor:n=HE}){_f(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof r=="string"?VE(r,e.length+1):r,o=yU().domain(e).range(i);return(s,l)=>{const h=WE(t,s,l);return typeof h=="number"&&Number.isFinite(h)?o(h):n}}function r3e({attr:t,domain:e,colors:r=jE,nullColor:n=HE,othersColor:i=qEe}){_f(Array.isArray(e),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof r=="string"?VE(r,e.length):r;for(const[l,h]of e.entries())o[h]=s[l];return(l,h)=>{const A=WE(t,l,h);return typeof A=="number"&&Number.isFinite(A)||typeof A=="string"?o[A]||i:n}}function n3e({attr:t,domain:e,colors:r=jE,nullColor:n=HE}){_f(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof r=="string"?VE(r,e.length):r,o=_U().domain(e).range(i);return(s,l)=>{const h=WE(t,s,l);return typeof h=="number"&&Number.isFinite(h)?o(h):n}}const i3e={ClusterTileLayer:ow,H3TileLayer:lw,HeatmapTileLayer:hw,PointLabelLayer:_y,QuadbinTileLayer:my,RasterTileLayer:pw,VectorTileLayer:Aw};function gw(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function s3e(t,e){const r=a3e(e);let n=t;for(const i of r)n=o3e(n)?n[i]:void 0;return n}function o3e(t){return t!==null&&typeof t=="object"}const DR={};function a3e(t){if(typeof t=="string"){let e=DR[t];return e||(e=t.split("."),DR[t]=e),e}return Array.isArray(t)?t:[t]}var c2={exports:{}},FR;function l3e(){return FR||(FR=1,(function(t,e){(function(r){var n="Compound",i="Identifier",o="MemberExpression",s="Literal",l="ThisExpression",h="CallExpression",A="UnaryExpression",b="BinaryExpression",C="LogicalExpression",S="ConditionalExpression",D="ArrayExpression",N=46,U=44,V=39,j=34,ee=40,Q=41,X=91,pe=93,Y=63,Ge=59,ze=58,de=function(St,st){var Ar=new Error(St+" at character "+st);throw Ar.index=st,Ar.description=St,Ar},ce=!0,De={"-":ce,"!":ce,"~":ce,"+":ce},J={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ue=function(St){var st=0,Ar;for(var Qt in St)(Ar=Qt.length)>st&&St.hasOwnProperty(Qt)&&(st=Ar);return st},Ee=ue(De),ct=ue(J),Ce={true:!0,false:!1,null:null},Le="this",Ne=function(St){return J[St]||0},$e=function(St,st,Ar){var Qt=St==="||"||St==="&&"?C:b;return{type:Qt,operator:St,left:st,right:Ar}},it=function(St){return St>=48&&St<=57},ot=function(St){return St===36||St===95||St>=65&&St<=90||St>=97&&St<=122||St>=128&&!J[String.fromCharCode(St)]},dt=function(St){return St===36||St===95||St>=65&&St<=90||St>=97&&St<=122||St>=48&&St<=57||St>=128&&!J[String.fromCharCode(St)]},Mt=function(St){for(var st=0,Ar=St.charAt,Qt=St.charCodeAt,Zt=function(zt){return Ar.call(St,zt)},Ht=function(zt){return Qt.call(St,zt)},dr=St.length,ln=function(){for(var zt=Ht(st);zt===32||zt===9||zt===10||zt===13;)zt=Ht(++st)},Lr=function(){var zt=Hn(),gr,Mr;if(ln(),Ht(st)===Y){if(st++,gr=Lr(),gr||de("Expected expression",st),ln(),Ht(st)===ze)return st++,Mr=Lr(),Mr||de("Expected expression",st),{type:S,test:zt,consequent:gr,alternate:Mr};de("Expected :",st)}else return zt},vr=function(){ln();for(var zt=St.substr(st,ct),gr=zt.length;gr>0;){if(J.hasOwnProperty(zt)&&(!ot(Ht(st))||st+zt.length<St.length&&!dt(Ht(st+zt.length))))return st+=gr,zt;zt=zt.substr(0,--gr)}return!1},Hn=function(){var zt,gr,Mr,nn,_i,Se,kt,Jt,cr;if(Se=_r(),gr=vr(),!gr)return Se;for(_i={value:gr,prec:Ne(gr)},kt=_r(),kt||de("Expected expression after "+gr,st),nn=[Se,_i,kt];(gr=vr())&&(Mr=Ne(gr),Mr!==0);){for(_i={value:gr,prec:Mr},cr=gr;nn.length>2&&Mr<=nn[nn.length-2].prec;)kt=nn.pop(),gr=nn.pop().value,Se=nn.pop(),zt=$e(gr,Se,kt),nn.push(zt);zt=_r(),zt||de("Expected expression after "+cr,st),nn.push(_i,zt)}for(Jt=nn.length-1,zt=nn[Jt];Jt>1;)zt=$e(nn[Jt-1].value,nn[Jt-2],zt),Jt-=2;return zt},_r=function(){var zt,gr,Mr;if(ln(),zt=Ht(st),it(zt)||zt===N)return yr();if(zt===V||zt===j)return un();if(zt===X)return ri();for(gr=St.substr(st,Ee),Mr=gr.length;Mr>0;){if(De.hasOwnProperty(gr)&&(!ot(Ht(st))||st+gr.length<St.length&&!dt(Ht(st+gr.length))))return st+=Mr,{type:A,operator:gr,argument:_r(),prefix:!0};gr=gr.substr(0,--Mr)}return ot(zt)||zt===ee?qn():!1},yr=function(){for(var zt="",gr,Mr;it(Ht(st));)zt+=Zt(st++);if(Ht(st)===N)for(zt+=Zt(st++);it(Ht(st));)zt+=Zt(st++);if(gr=Zt(st),gr==="e"||gr==="E"){for(zt+=Zt(st++),gr=Zt(st),(gr==="+"||gr==="-")&&(zt+=Zt(st++));it(Ht(st));)zt+=Zt(st++);it(Ht(st-1))||de("Expected exponent ("+zt+Zt(st)+")",st)}return Mr=Ht(st),ot(Mr)?de("Variable names cannot start with a number ("+zt+Zt(st)+")",st):Mr===N&&de("Unexpected period",st),{type:s,value:parseFloat(zt),raw:zt}},un=function(){for(var zt="",gr=Zt(st++),Mr=!1,nn;st<dr;)if(nn=Zt(st++),nn===gr){Mr=!0;break}else if(nn==="\\")switch(nn=Zt(st++),nn){case"n":zt+=`
`;break;case"r":zt+="\r";break;case"t":zt+="	";break;case"b":zt+="\b";break;case"f":zt+="\f";break;case"v":zt+="\v";break;default:zt+=nn}else zt+=nn;return Mr||de('Unclosed quote after "'+zt+'"',st),{type:s,value:zt,raw:gr+zt+gr}},Rr=function(){var zt=Ht(st),gr=st,Mr;for(ot(zt)?st++:de("Unexpected "+Zt(st),st);st<dr&&(zt=Ht(st),dt(zt));)st++;return Mr=St.slice(gr,st),Ce.hasOwnProperty(Mr)?{type:s,value:Ce[Mr],raw:Mr}:Mr===Le?{type:l}:{type:i,name:Mr}},ci=function(zt){for(var gr,Mr=[],nn,_i=!1,Se=0;st<dr;)if(ln(),gr=Ht(st),gr===zt){_i=!0,st++,zt===Q&&Se&&Se>=Mr.length&&de("Unexpected token "+String.fromCharCode(zt),st);break}else if(gr===U){if(st++,Se++,Se!==Mr.length){if(zt===Q)de("Unexpected token ,",st);else if(zt===pe)for(var kt=Mr.length;kt<Se;kt++)Mr.push(null)}}else nn=Lr(),(!nn||nn.type===n)&&de("Expected comma",st),Mr.push(nn);return _i||de("Expected "+String.fromCharCode(zt),st),Mr},qn=function(){var zt,gr;for(zt=Ht(st),zt===ee?gr=mn():gr=Rr(),ln(),zt=Ht(st);zt===N||zt===X||zt===ee;)st++,zt===N?(ln(),gr={type:o,computed:!1,object:gr,property:Rr()}):zt===X?(gr={type:o,computed:!0,object:gr,property:Lr()},ln(),zt=Ht(st),zt!==pe&&de("Unclosed [",st),st++):zt===ee&&(gr={type:h,arguments:ci(Q),callee:gr}),ln(),zt=Ht(st);return gr},mn=function(){st++;var zt=Lr();if(ln(),Ht(st)===Q)return st++,zt;de("Unclosed (",st)},ri=function(){return st++,{type:D,elements:ci(pe)}},Vn=[],Tn,Yn;st<dr;)Tn=Ht(st),Tn===Ge||Tn===U?st++:(Yn=Lr())?Vn.push(Yn):st<dr&&de('Unexpected "'+Zt(st)+'"',st);return Vn.length===1?Vn[0]:{type:n,body:Vn}};Mt.version="0.3.5",Mt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Mt.version},Mt.addUnaryOp=function(St){return Ee=Math.max(St.length,Ee),De[St]=ce,this},Mt.addBinaryOp=function(St,st){return ct=Math.max(St.length,ct),J[St]=st,this},Mt.addLiteral=function(St,st){return Ce[St]=st,this},Mt.removeUnaryOp=function(St){return delete De[St],St.length===Ee&&(Ee=ue(De)),this},Mt.removeAllUnaryOps=function(){return De={},Ee=0,this},Mt.removeBinaryOp=function(St){return delete J[St],St.length===ct&&(ct=ue(J)),this},Mt.removeAllBinaryOps=function(){return J={},ct=0,this},Mt.removeLiteral=function(St){return delete Ce[St],this},Mt.removeAllLiterals=function(){return Ce={},this},t.exports?e=t.exports=Mt:e.parse=Mt})()})(c2,c2.exports)),c2.exports}var c3e=l3e();const u3e=bf(c3e),kR={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},h3e={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function NR(t,e){return t.map(function(r){return qs(r,e)})}function UR(t,e){const r=qs(t.object,e);let n;if(t.computed?n=qs(t.property,e):n=t.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[r,r[n]]}function qs(t,e){const r=t;switch(r.type){case"ArrayExpression":return NR(r.elements,e);case"BinaryExpression":return kR[r.operator](qs(r.left,e),qs(r.right,e));case"CallExpression":let n,i,o;return r.callee.type==="MemberExpression"?(o=UR(r.callee,e),n=o[0],i=o[1]):i=qs(r.callee,e),typeof i!="function"?void 0:i.apply(n,NR(r.arguments,e));case"ConditionalExpression":return qs(r.test,e)?qs(r.consequent,e):qs(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?qs(r.left,e)||qs(r.right,e):r.operator==="&&"?qs(r.left,e)&&qs(r.right,e):kR[r.operator](qs(r.left,e),qs(r.right,e));case"MemberExpression":return UR(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return h3e[r.operator](qs(r.argument,e));default:return}}const u2={"-":t=>t};function C9(t,e){if(t in u2)return u2[t];let r;const n=u3e(t);return n.type==="Identifier"?r=i=>s3e(i,t):(mw(n,i=>{if(i.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=i=>qs(n,i)),u2[t]=r,r}function mw(t,e){if(Array.isArray(t))t.forEach(r=>mw(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(const r in t)mw(t[r],e)}}const yy="@@=",GR="@@#",f3e="@@type",E9="@@function",zR=t=>t&&typeof t=="object";class _w{constructor(...e){this.typeKey=f3e,this.functionKey=E9,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=C9,this.preProcessClassProps=(r,n)=>n,this.postProcessConvertedJson=r=>r;for(const r of e)this.merge(r)}merge(e){for(const r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){const n=e[r];this[r]=zR(this[r])?Object.assign(this[r],n):n}}}validate(e){return gw(!this.typeKey||typeof this.typeKey=="string"),gw(zR(this.classes)),!0}}function d3e(t){return typeof t=="string"&&t.startsWith(yy)}function p3e(t){return t.replace(yy,"")}function B9(t,e){const r={};for(const n in t){let i=t[n];d3e(i)&&(i=p3e(i),i=C9(i)),r[n]=i}return r}function A3e(t,e,r){const n=r.classes[t],i=r.reactComponents[t];if(!n&&!i){const{log:o}=r;if(o){const s=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${t}(${s}...)  `)}return null}return n?g3e(n,e,r):m3e(i,e,r)}function g3e(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=B9(e),new t(e)}function m3e(t,e,r){const{React:n}=r,{children:i=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=B9(e),n.createElement(t,e,i)}function _3e(t,e,r){const n=r.functions[t];if(!n){const{log:i}=r;if(i){const o=JSON.stringify(e,null,0).slice(0,40);i.warn(`JSON converter: No registered function ${t}(${o}...)  `)}return null}return n(e)}function y3e(t){return typeof t=="string"?JSON.parse(t):t}const JE=t=>t&&typeof t=="object";class b3e{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof _w?e.configuration:new _w(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;const r=y3e(e);let n=v3e(r,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(e){return this.convert(e)}}function v3e(t,e){return e=new _w(e),KE(t,"",e)}function KE(t,e,r){return Array.isArray(t)?t.map((n,i)=>KE(n,String(i),r)):x3e(t,r)?w3e(t,r):JE(t)?E9 in t?C3e(t,r):XE(t,r):typeof t=="string"?E3e(t,e,r):t}function x3e(t,e){const{typeKey:r}=e;return JE(t)&&!!t[r]}function w3e(t,e){const{typeKey:r}=e,n=t[r];let i={...t};return delete i[r],i=XE(i,e),A3e(n,i,e)}function C3e(t,e){const{functionKey:r}=e,n=t[r];let i={...t};return delete i[r],i=XE(i,e),_3e(n,i,e)}function XE(t,e){gw(JE(t));const r={};for(const n in t){const i=t[n];r[n]=KE(i,n,e)}return r}function E3e(t,e,r){if(t.startsWith(yy)&&r.convertFunction)return t=t.replace(yy,""),r.convertFunction(t,r);if(t.startsWith(GR)){if(t=t.replace(GR,""),r.constants[t])return r.constants[t];const[n,i]=t.split(".");return r.enumerations[n][i]}return t}const B3e={classes:{...Cue,...bwe,...X2e,...T0e,...i3e},functions:{colorBins:t3e,colorCategories:r3e,colorContinuous:n3e}},T9=new b3e({configuration:B3e}),T3e={[dy.layerName]:["getFillColor"],[ry.layerName]:["getFillColor"],[fc.layerName]:["getFillColor"],[$p.layerName]:["getFillColor"],[$_.layerName]:["getFillColor"],[Z_.layerName]:["getFillColor"],[Y_.layerName]:["getColor"],[Dg.layerName]:["getTargetColor","getSourceColor"],[Ac.layerName]:["getFillColor"],[nu.layerName]:["getFillColor"],[zp.layerName]:["getColor"],[V_.layerName]:["getColor"],[nh.layerName]:["getColor"],[kg.layerName]:["getColor"],[sh.layerName]:["getFillColor"],[Ng.layerName]:["getFillColor","getColor","getLineColor"],[ih.layerName]:["getFillColor"],[Af.layerName]:["getColor"],[jg.layerName]:["getColor"],[mf.layerName]:["getColor"]},S3e=({object:t,objectInfo:e,originalFillFunction:r})=>{const n=typeof r=="function"?r(t,e):r;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const i=T9.convert({originalColor:n}).originalColor(t);return[i[0]||0,i[1]||0,i[2]||0,i[3]||255]}return null},jR=({isSelected:t,object:e,objectInfo:r,opacity:n,originalFillFunction:i})=>{const o=S3e({object:e,objectInfo:r,originalFillFunction:i});if(!o)return null;let s=0;return t?s=Math.max(typeof o[3]=="number"?o[3]:n,n):s=Math.min(typeof o[3]=="number"?o[3]:n,n),[o[0]||0,o[1]||0,o[2]||0,s]},I3e=({isSelected:t,object:e,objectInfo:r,originalFillFunction:n,selectedColor:i,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:l=Math.floor(255*.4)})=>t?jR({opacity:o,isSelected:!0,object:e,objectInfo:r,originalFillFunction:n})||i:jR({opacity:l,isSelected:!1,object:e,objectInfo:r,originalFillFunction:n})||s,Vg={selection:{indices:{},objects:{}}},HR=(t,e)=>{const r=e.match(/{(.*?)}/g);return r&&r.forEach(n=>{const i=n.substring(1,n.length-1);Object.hasOwn(t.object,i)?e=e.replace(n,t.object[i]):Object.hasOwn(t.object,"properties")&&Object.hasOwn(t.object.properties,i)&&(e=e.replace(n,t.object.properties[i]))}),e};function M3e(t,e){return e.id?t.getElementState(e.id,"selection")??Vg:Vg}function P3e(t,e){if(!e.id)return Vg;const r=t.getStringValue(e);return(r?f2.parse(r):null)??Vg}function L3e(t,e,r,n){t.id&&e.setStringValue(t,JSON.stringify(r.value),{fromUi:r.fromUi},n)}const R3e=t=>{const{height:e,width:r,expanded:n}=VR(XR),{element:i,fragmentId:o,isLightTheme:s,theme:l,widgetMgr:h}=t,{selectionMode:A,tooltip:b,useContainerWidth:C}=i,S=n??!1,[D,N]=mU({element:i,getDefaultState:M3e,getStateFromWidgetMgr:P3e,updateWidgetMgrState:L3e,widgetMgr:h,fragmentId:o}),[U,V]=Tt.useState(null),{height:j,width:ee}=ule({element:i,isFullScreen:S,shouldUseContainerWidth:C,container:{height:e,width:r},heightFallback:U?.initialViewState?.height||l.sizes.defaultMapHeight}),[Q,X]=Tt.useState(null),pe=A[0],Y=pe!==void 0,Ge=Y&&Object.keys(D.selection.indices).length>0,ze=Tt.useMemo(()=>Object.freeze(f2.parse(i.json)),[S,s,i.json]),de=Tt.useMemo(()=>{const J={...ze};if(J.mapStyle||(J.mapStyle=s?"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json":"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"),(J?.mapProvider=="carto"||J?.mapStyle&&J.mapStyle?.indexOf("cartocdn")>=0)&&!J.cartoKey&&(J.cartoKey="x7g2plm9yq8vfrc"),J.layers){const ue=Object.values(D.selection.indices).some(ct=>ct?.length),Ee=J.layers.some(ct=>Object.hasOwn(ct,"pickable"));J.layers=J.layers.map(ct=>{if(!ct||Array.isArray(ct)||!Y)return ct;Ee||(ct.pickable=!0);const Ce=`${ct.id||null}`,Le=D?.selection?.indices?.[Ce]||[],Ne=T3e[ct["@@type"]];if(!Ne)return ct;const $e={...ct};return Ne.forEach(it=>{$e.updateTriggers={[it]:[...$e.updateTriggers?.[it]||[],Le,ue]};const ot=!ue,dt=ct[it];if(ot||!dt)return $e;const Mt=255,St=Math.floor(255*.4),st=gB(l.colors.primary),Ar=[st[0],st[1],st[2],Mt],Qt=gB(l.colors.gray20),Zt=[Qt[0],Qt[1],Qt[2],St],Ht=(dr,ln)=>I3e({isSelected:Le.includes(ln.index),object:dr,objectInfo:ln,originalFillFunction:dt,selectedColor:Ar,unselectedColor:Zt,selectedOpacity:Mt,unselectedOpacity:St});$e[it]=Ht}),$e})}return delete J?.views,T9.convert(J)},[D.selection.indices,s,Y,ze,l.colors.gray20,l.colors.primary]);Tt.useEffect(()=>{if(!uU(de.initialViewState,Q)){const J=Object.keys(de.initialViewState).reduce((ue,Ee)=>de.initialViewState[Ee]===Q?.[Ee]?ue:{...ue,[Ee]:de.initialViewState[Ee]},{});V(ue=>({...ue,...J})),X(de.initialViewState)}},[de.initialViewState,Q,U]);const ce=Tt.useCallback(J=>{if(!J||!J.object||!b)return null;const ue=f2.parse(b);return ue.html?ue.html=HR(J,ue.html):ue.text=HR(J,ue.text),ue},[b]),De=Tt.useCallback(({viewState:J})=>{V(J)},[V]);return{createTooltip:ce,data:D,deck:de,hasActiveSelection:Ge,height:j,isSelectionModeActivated:Y,onViewStateChange:De,selectionMode:pe,setSelection:N,viewState:U,width:ee}};Qg([EC,ix]);const h2=Vg.selection,O3e=[],D3e=t=>{const{disabled:e,disableFullscreenMode:r,element:n,fragmentId:i,widgetMgr:o}=t,{libConfig:s}=Tt.useContext(aU),l=lU(),{expanded:h,expand:A,collapse:b}=VR(XR),{createTooltip:C,data:S,deck:D,hasActiveSelection:N,height:U,isSelectionModeActivated:V,onViewStateChange:j,selectionMode:ee,setSelection:Q,viewState:X,width:pe}=R3e({element:n,fragmentId:i,isLightTheme:WR(l),theme:l,widgetMgr:o}),Y=n.mapboxToken||s.mapboxToken,Ge=D.mapProvider=="mapbox"||D?.mapStyle&&D.mapStyle?.indexOf("mapbox")>=0,[ze,de]=Tt.useState(!1);Tt.useEffect(()=>{de(!0)},[]);const ce=Tt.useCallback(J=>{if(ee===void 0)return;const{index:ue,object:Ee}=J,ct=`${J.layer?.id||null}`,Ce=S,Le=ue===-1,Ne=(()=>{if(Le)return h2;switch(ee){case AB.SelectionMode.SINGLE_OBJECT:return Ce.selection.indices[ct]?.[0]===ue?h2:{indices:{[`${ct}`]:[ue]},objects:{[`${ct}`]:[Ee]}};case AB.SelectionMode.MULTI_OBJECT:{const $e=new Map((Ce?.selection?.indices?.[ct]||[]).map((it,ot)=>[it,Ce.selection?.objects?.[ct]?.[ot]]));if($e.has(ue)?$e.delete(ue):$e.set(ue,Ee),$e.size===0){const{[ct]:it,...ot}=Ce.selection.indices,{[ct]:dt,...Mt}=Ce.selection.objects;return{indices:ot,objects:Mt}}return{indices:{...Ce.selection.indices,[`${ct}`]:Array.from($e.keys())},objects:{...Ce.selection.objects,[`${ct}`]:Array.from($e.values())}}}default:throw cU(ee),new Error("Invalid selection mode")}})();JSON.stringify(Ne)!==JSON.stringify(Ce.selection)&&Q({fromUi:!0,value:{selection:Ne}})},[ee,S,Q]),De=Tt.useCallback(()=>{Q({value:{selection:h2},fromUi:!0})},[Q]);return rc.jsxs(RM,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:U,children:[Ge?rc.jsx(lle,{}):null,rc.jsx(AU,{isFullScreen:h,disableFullscreenMode:r,onExpand:A,onCollapse:b,target:RM,locked:N&&!e?!0:void 0,children:N&&!e&&rc.jsx(gU,{label:"Clear selection",onClick:De,icon:dU})}),X&&rc.jsxs(Fq,{viewState:X,onViewStateChange:j,height:U,width:pe,layers:ze?D.layers:O3e,getTooltip:C,ContextProvider:Bf.Provider,controller:!0,onClick:V&&!e?ce:void 0,children:[rc.jsx(eu,{height:U,width:pe,mapStyle:D.mapStyle&&(typeof D.mapStyle=="string"?D.mapStyle:D.mapStyle[0]),mapboxApiAccessToken:Y}),rc.jsx(cle,{children:rc.jsx(ile,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},F3e=pU(D3e),J3e=Tt.memo(F3e);export{J3e as default};
