import{r as c,m as k,f as ce,cj as pe,cJ as ue,v as M,cK as y,j as o,c as g,cu as R,co as ge,a9 as he,E as O,_ as X,cn as me,c7 as Y,ct as _,c1 as q,cq as fe,cp as xe,bD as G,cr as ye,cv as be}from"./index-B_CN4CJH.js";import{z as ve,h as B,x as je,D as Ie,j as J,E as we,d as Ce,k as ze,a as Fe}from"./FileHelper-BRV59FzM-512PahoD.js";import{y as Ee}from"./InputInstructions-ClHVf2-Y-CX6XkxNU.js";import{u as Re,Q as Te}from"./useTextInputAutoExpand-Ccek2psp-BVP-964S.js";import{r as Se}from"./inputUtils-DCYiajnz-DsrlAoKH.js";import{i as De}from"./ErrorOutline.esm-DpRBeJ0n-BSmRX91D.js";import{t as Q}from"./UploadFileInfo-B5SttewO-BfvME59S.js";import"./base-input-Dqu1lvr4-DzEfVqSG.js";var Z=c.forwardRef(function(e,t){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(O,X({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),c.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),c.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});Z.displayName="AttachFile";var ee=c.forwardRef(function(e,t){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return c.createElement(O,X({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),c.createElement("rect",{width:24,height:24,fill:"none"}),c.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});ee.displayName="Send";const te=(e,t)=>t===y.Directory?{...e,webkitdirectory:"",multiple:!0}:e,Le=(e,t)=>{if(!t||t.length===0)return!0;const i=e.name.toLowerCase(),n=i.lastIndexOf(".");if(n===-1||n===i.length-1)return t.some(f=>f===""||f===".");const p=i.substring(n),a=i.substring(n+1);return t.some(f=>{const b=f.toLowerCase();return b.startsWith(".")?p===b:a===b})},Me=(e,t)=>Le(e,t)?{isValid:!0}:{isValid:!1,errorMessage:`${e.type||"This type of"} files are not allowed.`},oe=e=>{switch(e){case y.None:return"a file";case y.Single:return"a file";case y.Multiple:return"files";case y.Directory:return"a directory";default:return G(e),"a file"}},Ue=g("div",{target:"e3id6jz12"})(({theme:e,height:t})=>({backgroundColor:e.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${e.sizes.emptyDropdownHeight}, ${t})`,width:"100%",zIndex:e.zIndices.priority}),""),He=g("div",{target:"e3id6jz11"})(({theme:e,height:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.primary,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,color:e.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:t,width:"100%",fontWeight:e.fontWeights.bold}),""),Be=g("div",{target:"e3id6jz10"})(({theme:e,disabled:t})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${e.sizes.borderWidth}`,cursor:t?"not-allowed":"auto"}),""),ke=g("div",{target:"e3id6jz9"})(({disabled:e})=>({pointerEvents:e?"none":"auto"}),""),Pe=g("div",{target:"e3id6jz8"})(({theme:e})=>({marginTop:"0.625em",marginLeft:e.spacing.sm,height:e.spacing.xl,width:e.sizes.borderWidth,backgroundColor:e.colors.fadedText20}),""),Ne=g("div",{target:"e3id6jz7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingLeft:e.spacing.sm,paddingRight:e.spacing.sm,overflowX:"auto"}),""),We=g("div",{target:"e3id6jz6"})({name:"zjik7",styles:"display:flex"}),$e=g("div",{target:"e3id6jz5"})({name:"ou8xsw",styles:"flex:0 0 auto"}),Ve=g("div",{target:"e3id6jz4"})(({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing.sm,gap:e.spacing.twoXS}),""),Ae=g("div",{target:"e3id6jz3"})(({theme:e})=>({color:e.colors.fadedText60}),""),Ke=g("div",{target:"e3id6jz2"})(({theme:e,fileStatus:t})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t.type==="uploaded"?e.colors.bodyText:e.colors.fadedText60}),""),Oe=g("div",{target:"e3id6jz1"})(({theme:e})=>({marginRight:e.spacing.md,color:e.colors.fadedText60}),""),Xe=g("small",{target:"e3id6jz0"})(({theme:e})=>({display:"flex",alignItems:"center",maxHeight:e.sizes.smallElementHeight,color:e.colors.fadedText60,"& :hover":{color:e.colors.bodyText}}),""),Ye=({getRootProps:e,getInputProps:t,acceptFile:i,disabled:n,theme:p})=>{const a=te(t(),i);return o.jsxs(Be,{disabled:n,children:[o.jsxs(ke,{"data-testid":"stChatInputFileUploadButton",disabled:n,...e(),children:[o.jsx("input",{...a}),o.jsx(me,{content:`Upload or drag and drop ${oe(i)}`,placement:Y.TOP,onMouseEnterDelay:500,children:o.jsx(_,{kind:q.MINIMAL,disabled:n,children:o.jsx(R,{content:Z,size:"lg",color:n?p.colors.fadedText40:p.colors.fadedText60})})})]}),o.jsx(Pe,{})]})},_e=c.memo(Ye),qe=({getRootProps:e,getInputProps:t,acceptFile:i,inputHeight:n})=>{const p=te(t(),i);return o.jsxs(o.Fragment,{children:[o.jsx(Ue,{height:n,...e(),children:o.jsx("input",{...p})}),o.jsx(He,{height:n,children:`Drag and drop ${oe(i)} here`})]})},Ge=c.memo(qe);function Je({children:e,content:t}){const i=k();return o.jsx(be,{content:t,placement:Y.TOP,overrides:{Body:{style:{top:`-${i.sizes.minElementHeight}`}}},children:e})}const Qe=({fileInfo:e})=>{const t=k(),{type:i}=e.status;switch(i){case"uploading":return o.jsx(ye,{"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return o.jsx(Je,{content:e.status.errorMessage,children:o.jsx(R,{color:t.colors.redTextColor,content:De,size:"lg"})});case"uploaded":return o.jsx(R,{content:Fe,size:"lg"});default:return G(i),null}},Ze=({fileInfo:e,onDelete:t})=>o.jsxs(Ve,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[o.jsx(Ae,{children:o.jsx(Qe,{fileInfo:e})}),o.jsx(Ke,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:e.name,fileStatus:e.status,children:e.name}),o.jsx(Oe,{children:Ce(e.size,B.Byte)}),o.jsx(Xe,{"data-testid":"stChatInputDeleteBtn",children:o.jsx(_,{onClick:()=>t(e.id),kind:q.MINIMAL,children:o.jsx(R,{content:ze,size:"lg"})})})]}),et=c.memo(Ze),tt=({items:e,onDelete:t})=>o.jsx(Ne,{"data-testid":"stChatUploadedFiles",children:o.jsx(We,{children:e.map(i=>o.jsx($e,{children:o.jsx(et,{fileInfo:i,onDelete:t})},i.id))})}),ot=c.memo(tt),it=(e,t)=>{const i=[],n=[];return e.forEach(p=>{const a=Me(p,t.fileType);a.isValid?i.push(p):n.push({file:p,errors:[{code:J.FileInvalidType,message:a.errorMessage||"File type not allowed."}]})}),{accepted:i,rejected:n}},rt=({acceptMultipleFiles:e,acceptDirectoryFiles:t,maxFileSize:i,uploadClient:n,uploadFile:p,addFiles:a,getNextLocalFileId:f,deleteExistingFiles:b,onUploadComplete:I,element:v})=>(m,h)=>{if(t&&m.length>0){const{accepted:u,rejected:x}=it(m,v);m=u,h=[...h,...x]}if(!e&&m.length===0&&h.length>1){const u=h.findIndex(x=>x.errors?.[0].code===J.TooManyFiles);u>=0&&(m.push(h[u].file),h.splice(u,1))}if(!e&&m.length>0&&b(),n.fetchFileURLs(m).then(u=>{ge(u,m).forEach(([x,w])=>{p(x,w)})}).catch(u=>{a(m.map(x=>new Q(x.name,x.size,f(),{type:"error",errorMessage:u})))}),h.length>0){const u=h.map(x=>we(x,f(),i));a(u)}I()},st=({getNextLocalFileId:e,addFiles:t,updateFile:i,uploadClient:n,element:p,onUploadProgress:a,onUploadComplete:f})=>(b,I)=>{const v=I.webkitRelativePath||I.name,m=new AbortController,h=new Q(v,I.size,e(),{type:"uploading",abortController:m,progress:1});t([h]),n.uploadFile({formId:"",...p},b.uploadUrl,I,u=>a(u,h.id),m.signal).then(()=>f(h.id,b)).catch(u=>{u instanceof DOMException&&u.name==="AbortError"||i(h.id,h.setStatus({type:"error",errorMessage:u?u.toString():"Unknown error"}))})},nt=g("div",{target:"e1d2x3se4"})({name:"1nibcdy",styles:"border:none;position:relative;display:flex"}),at=g("div",{target:"e1d2x3se3"})(({theme:e,extended:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.widgetBorderColor??e.colors.transparent,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:e.spacing.lg,maxHeight:t?"none":e.sizes.minElementHeight,gap:e.spacing.sm,overflow:"hidden",":focus-within":{borderColor:e.colors.primary}}),""),lt=g("button",{target:"e1d2x3se2"})(({theme:e,disabled:t,extended:i})=>{const n=he(e),[p,a]=n?[e.colors.gray60,e.colors.gray80]:[e.colors.gray80,e.colors.gray40];return{border:"none",backgroundColor:e.colors.transparent,borderTopRightRadius:i?"0":e.radii.chatInput,borderTopLeftRadius:i?e.radii.default:"0",borderBottomRightRadius:e.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.sm,color:t?p:a,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:n?e.colors.gray10:e.colors.gray90},"&:hover":{color:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:e.colors.transparent,borderColor:e.colors.transparent,color:e.colors.gray60,cursor:"not-allowed"}}},""),dt=g("div",{target:"e1d2x3se1"})(({theme:e})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${e.sizes.borderWidth}`,pointerEvents:"none"}),""),ct=g("div",{target:"e1d2x3se0"})(({theme:e})=>({position:"absolute",bottom:"0px",right:`calc(${e.iconSizes.xl} + 2 * ${e.spacing.sm} + ${e.spacing.sm})`}),""),U=(e,t,i)=>i.map(n=>n.id===e?t:n),H=(e,t)=>t.find(i=>i.id===e);function pt({disabled:e,element:t,widgetMgr:i,fragmentId:n,uploadClient:p}){const a=k(),{placeholder:f,maxChars:b}=t,I=c.useRef(0),v=c.useRef(null),{width:m,elementRef:h}=ce(),{innerWidth:u,innerHeight:x}=pe(),[w,S]=c.useState(t.default),[z,F]=c.useState([]),[E,D]=c.useState(!1),C=Re({textareaRef:v,dependencies:[f]}),L=c.useMemo(()=>z.some(r=>r.status.type==="uploading")?!1:w!==""||z.length>0,[z,w]),j=ue(t.acceptFile),P=ve(t.maxUploadSizeMb,B.Megabyte,B.Byte),N=c.useCallback(r=>F(l=>[...l,...r]),[]),W=c.useCallback(r=>{F(l=>{const d=H(r,l);return M(d)?l:(d.status.type==="uploading"&&d.status.abortController.abort(),d.status.type==="uploaded"&&d.status.fileUrls.deleteUrl&&p.deleteFile(d.status.fileUrls.deleteUrl),l.filter(s=>s.id!==r))})},[p]),ie=()=>{const r=z.filter(l=>l.status.type==="uploaded").map(l=>{const{name:d,size:s,status:T}=l,{fileId:le,fileUrls:de}=T;return new fe({fileId:le,fileUrls:de,name:d,size:s})});return new xe({uploadedFileInfo:r})},$=()=>I.current++,re=rt({acceptMultipleFiles:j===y.Multiple||j===y.Directory,acceptDirectoryFiles:j===y.Directory,maxFileSize:P,uploadClient:p,uploadFile:st({getNextLocalFileId:$,addFiles:N,updateFile:(r,l)=>{F(d=>U(r,l,d))},uploadClient:p,element:t,onUploadProgress:(r,l)=>{F(d=>{const s=H(l,d);if(M(s)||s.status.type!=="uploading")return d;const T=Math.round(r.loaded*100/r.total);return s.status.progress===T?d:U(l,s.setStatus({type:"uploading",abortController:s.status.abortController,progress:T}),d)})},onUploadComplete:(r,l)=>{F(d=>{const s=H(r,d);return M(s)||s.status.type!=="uploading"?d:U(s.id,s.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}),d)})}}),addFiles:N,getNextLocalFileId:$,deleteExistingFiles:()=>z.forEach(r=>W(r.id)),onUploadComplete:()=>{v.current&&v.current.focus()},element:t}),{getRootProps:V,getInputProps:A}=je({onDrop:re,multiple:j===y.Multiple||j===y.Directory,accept:Ie(t.fileType),maxSize:P}),K=()=>{if(v.current&&v.current.focus(),!L||e)return;const r={data:w,fileUploaderState:ie()};i.setChatInputValue(t,r,{fromUi:!0},n),F([]),S(""),C.clearScrollHeight()},se=r=>{const{metaKey:l,ctrlKey:d,shiftKey:s}=r;Se(r)&&!s&&!d&&!l&&(r.preventDefault(),K())},ne=r=>{const{value:l}=r.target;b!==0&&l.length>b||(S(l),C.updateScrollHeight())};c.useEffect(()=>{if(t.setValue){t.setValue=!1;const r=t.value||"";S(r)}},[t]),c.useEffect(()=>{const r=s=>{s.preventDefault(),s.stopPropagation(),!E&&s.dataTransfer?.types.includes("Files")&&D(!0)},l=s=>{s.preventDefault(),s.stopPropagation(),E&&(s.clientX<=0&&s.clientY<=0||s.clientX>=u&&s.clientY>=x)&&D(!1)},d=s=>{s.preventDefault(),s.stopPropagation(),E&&D(!1)};return window.addEventListener("dragover",r),window.addEventListener("drop",d),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",r),window.removeEventListener("drop",d),window.removeEventListener("dragleave",l)}},[E,u,x]);const ae=j!==y.None&&E;return o.jsxs(o.Fragment,{children:[j===y.None?null:o.jsx(ot,{items:[...z],onDelete:W}),o.jsx(nt,{className:"stChatInput","data-testid":"stChatInput",ref:h,children:ae?o.jsx(Ge,{getRootProps:V,getInputProps:A,acceptFile:j,inputHeight:C.height}):o.jsxs(at,{extended:C.isExtended,children:[j===y.None?null:o.jsx(_e,{getRootProps:V,getInputProps:A,acceptFile:j,disabled:e,theme:a}),o.jsx(Te,{inputRef:v,value:w,placeholder:f,onChange:ne,onKeyDown:se,"aria-label":f,disabled:e,rows:1,overrides:{Root:{style:{minHeight:a.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:a.fontWeights.normal,lineHeight:a.lineHeights.inputWidget,"::placeholder":{color:a.colors.fadedText60},height:C.height,maxHeight:C.maxHeight,paddingLeft:a.spacing.none,paddingBottom:a.spacing.sm,paddingTop:a.spacing.sm,paddingRight:`calc(${a.iconSizes.xl} + 2 * ${a.spacing.sm} + ${a.spacing.sm})`}}}}),m>a.breakpoints.hideWidgetDetails&&o.jsx(ct,{children:o.jsx(Ee,{dirty:L,value:w,maxLength:b,type:"chat",inForm:!1})}),o.jsx(dt,{children:o.jsx(lt,{onClick:K,disabled:!L||e,extended:C.isExtended,"data-testid":"stChatInputSubmitButton",children:o.jsx(R,{content:ee,size:"xl",color:"inherit"})})})]})})]})}const vt=c.memo(pt);export{vt as default};
