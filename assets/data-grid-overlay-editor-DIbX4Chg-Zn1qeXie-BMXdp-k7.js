import{r,b as J}from"./index-BXy9S0ZG.js";import{V as R,E as Q,m as U,G as Z,c as ee,k as te,a as re}from"./index-63iycogk-8hBpw-Jk-CcXfZ4B6.js";import"./withFullScreenWrapper-Dg0Awf9i-COlHnLQx-Bp_4iEIe.js";import"./Toolbar-DwupCvdF-D3M7JP7B-Cc0ZFnXH.js";import"./FormClearHelper-DSORW5o1-C9o5k7P7-CT8OSwJM.js";import"./sprintf-D5E86llw-yUkJWEcD-CuWy5xoB.js";import"./checkbox-Dxl2YmNe-CYX1lqsr-CuTwlO8a.js";import"./createDownloadLinkElement-CbRjLJ8e-BjJEUuqX-BXneJz2V.js";import"./slicedToArray-DufnYpuP-Dm33nlg3-DmtlpYEl.js";import"./inherits-D0t4NnD4-B3o6Mc-f-B2t_lqEE.js";import"./createSuper-DyjlCwUw-BiTb64Ih-L14cEwuZ.js";import"./FileDownload.esm-CV5-Gba--CRvvl245-C9izKCBC.js";const ie=()=>t=>t.targetX,ae=()=>t=>t.targetY,oe=()=>t=>t.targetWidth,ne=()=>t=>t.targetHeight,se=()=>t=>t.targetY+10,le=()=>t=>Math.max(0,(t.targetHeight-28)/2),de=re("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ae(),"px"],"d19meir1-1":[ie(),"px"],"d19meir1-2":[oe(),"px"],"d19meir1-3":[ne(),"px"],"d19meir1-4":[se(),"px"],"d19meir1-5":[le(),"px"]}});function ce(){const[t,o]=r.useState();return[t??void 0,o]}function ue(){const[t,o]=ce(),[a,f]=r.useState(0),[m,b]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const n=new IntersectionObserver(s=>{s.length!==0&&b(s[0].isIntersecting)},{threshold:1});return n.observe(t),()=>n.disconnect()},[t]),r.useEffect(()=>{if(m||t===void 0)return;let n;const s=()=>{const{right:C}=t.getBoundingClientRect();f(g=>Math.min(g+window.innerWidth-C-10,0)),n=requestAnimationFrame(s)};return n=requestAnimationFrame(s),()=>{n!==void 0&&cancelAnimationFrame(n)}},[t,m]);const k=r.useMemo(()=>({transform:`translateX(${a}px)`}),[a]);return{ref:o,style:k}}const we=t=>{const{target:o,content:a,onFinishEditing:f,forceEditMode:m,initialValue:b,imageEditorOverride:k,markdownDivCreateNode:n,highlight:s,className:C,theme:g,id:K,cell:v,bloom:S,portalElementRef:P,validateCell:p,getCellRenderer:I,provideEditor:M,isOutsideClick:W,customEventTarget:X,activation:x}=t,[l,Y]=r.useState(m?a:void 0),w=r.useRef(l??a);w.current=l??a;const[h,N]=r.useState(()=>p===void 0?!0:!(R(a)&&p?.(v,a,w.current)===!1)),c=r.useCallback((e,i)=>{f(h?e:void 0,i)},[h,f]),q=r.useCallback(e=>{if(p!==void 0&&e!==void 0&&R(e)){const i=p(v,e,w.current);i===!1?N(!1):(typeof i=="object"&&(e=i),N(!0))}Y(e)},[v,p]),E=r.useRef(!1),u=r.useRef(void 0),B=r.useCallback(()=>{c(l,[0,0]),E.current=!0},[l,c]),j=r.useCallback((e,i)=>{c(e,i??u.current??[0,0]),E.current=!0},[c]),z=r.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),u.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),u.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),u.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!E.current&&u.current!==void 0&&(c(i?l:void 0,u.current),E.current=!0)},0)},[c,l]),D=l??a,[d,L]=r.useMemo(()=>{if(Q(a))return[];const e={...a,location:v,activation:x},i=M?.(e);return i!==void 0?[i,!1]:[I(a)?.provideEditor?.(e),!1]},[v,a,I,M,x]),{ref:_,style:$}=ue();let F=!0,A,G=!0,y;if(d!==void 0){F=d.disablePadding!==!0,G=d.disableStyling!==!0;const e=U(d);e&&(y=d.styleOverride);const i=e?d.editor:d;A=r.createElement(i,{portalElementRef:P,isHighlighted:s,activation:x,onChange:q,value:D,initialValue:b,onFinishedEditing:j,validatedSelection:R(D)?D.selectionRange:void 0,forceEditMode:m,target:o,imageEditorOverride:k,markdownDivCreateNode:n,isValid:h,theme:g})}y={...y,...$};const H=P?.current??document.getElementById("portal");if(H===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let O=G?"gdg-style":"gdg-unstyle";h||(O+=" gdg-invalid"),F&&(O+=" gdg-pad");const T=S?.[0]??1,V=S?.[1]??1;return J.createPortal(r.createElement(Z.Provider,{value:g},r.createElement(ee,{style:te(g),className:C,onClickOutside:B,isOutsideClick:W,customEventTarget:X},r.createElement(de,{ref:_,id:K,className:O,style:y,as:L===!0?"label":void 0,targetX:o.x-T,targetY:o.y-V,targetWidth:o.width+T*2,targetHeight:o.height+V*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:z},A)))),H)};export{we as default};
