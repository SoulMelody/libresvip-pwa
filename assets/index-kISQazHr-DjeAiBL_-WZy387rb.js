import{cC as W,r as d,y as $,cm as O,v as g,b as f,co as X,cn as q,j as a,c,cj as _,ck as G,cD as K,cl as Y,c5 as J,O as Q,cr as u,c2 as Z,b$ as x,cg as ee,cs as m,E as b,_ as y}from"./index-BXy9S0ZG.js";import{a as te}from"./FormClearHelper-DSORW5o1-C9o5k7P7-CT8OSwJM.js";import{E as ie,D as se,b as le,z as ae,d as z,h as w,a as re,k as oe}from"./FileHelper-PYRDHdiG-C7iSwcNJ-C8ClnwoV.js";import{q as ne,U as de}from"./ProgressBar-CaQH2hO0-BTGN2Gkz-CjZqfg8A.js";import{c as ce}from"./Hooks-BLb3umpI-DKif_5q7-BW6UBtMn.js";import{t as F}from"./UploadFileInfo-B5SttewO-Cfj4jyqp-BfvME59S.js";var U=d.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});U.displayName="ChevronLeft";var v=d.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});v.displayName="ChevronRight";var I=d.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),d.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),d.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});I.displayName="CloudUpload";var C=d.forwardRef(function(e,s){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return d.createElement(b,y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:s}),d.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});C.displayName="Error";const M=c("section",{target:"e1b2p2ww17"})(({isDisabled:e,theme:s})=>({display:"flex",gap:s.spacing.lg,alignItems:"center",padding:s.spacing.lg,backgroundColor:s.colors.secondaryBg,borderRadius:s.radii.default,border:s.colors.widgetBorderColor?`${s.sizes.borderWidth} solid ${s.colors.widgetBorderColor}`:void 0,height:s.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${s.colors.primary}`},cursor:e?"not-allowed":"pointer"}),""),pe=c("div",{target:"e1b2p2ww16"})(({theme:e})=>({marginRight:"auto",alignItems:"center",display:"flex",gap:e.spacing.lg,minWidth:0,width:"100%"}),""),B=c("span",{target:"e1b2p2ww15"})(({theme:e})=>({color:e.colors.darkenedBgMix100}),""),D=c("span",{target:"e1b2p2ww14"})(({theme:e,disabled:s})=>({color:s?e.colors.fadedText40:e.colors.bodyText}),""),he=c("span",{target:"e1b2p2ww13"})(({theme:e,disabled:s})=>({fontSize:e.fontSizes.sm,color:s?e.colors.fadedText40:e.colors.fadedText60,display:"block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"}),""),ge=c("div",{target:"e1b2p2ww12"})({name:"1s8jot1",styles:"display:flex;flex-direction:column;min-width:0;max-width:100%"}),me=c("span",{target:"e1b2p2ww11"})({name:"1bmnxg7",styles:"white-space:nowrap"}),E=c("div",{target:"e1b2p2ww10"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg}),""),fe=c("ul",{target:"e1b2p2ww9"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none}),""),L=c("li",{target:"e1b2p2ww8"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none}),""),V=c("div",{target:"e1b2p2ww7"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"}),""),A=c("div",{target:"e1b2p2ww6"})(({theme:e,disabled:s})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:s?e.colors.fadedText40:e.colors.bodyText}),""),R=c("div",{target:"e1b2p2ww5"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS}),""),ue=c("span",{target:"e1b2p2ww4"})(({theme:e})=>({marginRight:e.spacing.twoXS}),""),xe=c("div",{target:"e1b2p2ww3"})(({theme:e,disabled:s})=>({display:"flex",padding:e.spacing.twoXS,color:s?e.colors.fadedText40:e.colors.darkenedBgMix100}),""),T=c("small",{target:"e1b2p2ww2"})(({theme:e})=>({color:e.colors.redTextColor,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),""),k=c("span",{target:"e1b2p2ww1"})({name:"0",styles:""}),we=e=>({[M]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto",gap:e.spacing.sm},[B]:{display:"none"},[D]:{marginBottom:e.spacing.twoXS},[E]:{paddingRight:e.spacing.lg},[R]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[A]:{width:e.sizes.full},[V]:{flexDirection:"column"},[T]:{height:"auto",whiteSpace:"initial"},[k]:{display:"none"},[L]:{margin:e.spacing.none,padding:e.spacing.none}}),be=c("div",{target:"e1b2p2ww0"})(({theme:e,width:s})=>{if(s<Q("23rem"))return we(e)},""),ye=({multiple:e,acceptedExtensions:s,maxSizeBytes:t,acceptDirectory:i=!1,disabled:l})=>{const o=()=>i?"directories":e?"files":"file",r=()=>s.length?` â€¢ ${s.map(p=>p.replace(/^\./,"").toUpperCase()).join(", ")}`:null,n=()=>`Limit ${z(t,w.Byte,0)} per file`;return a.jsxs(pe,{"data-testid":"stFileUploaderDropzoneInstructions",children:[a.jsx(B,{children:a.jsx(m,{content:I,size:"threeXL"})}),a.jsxs(ge,{children:[a.jsxs(D,{disabled:l,children:["Drag and drop ",o()," here"]}),a.jsxs(he,{disabled:l,children:[n(),r()]})]})]})},Se=d.memo(ye),Fe=({onDrop:e,multiple:s,acceptedExtensions:t,maxSizeBytes:i,disabled:l,label:o,acceptDirectory:r=!1})=>a.jsx(le,{onDrop:e,multiple:s,accept:ae(t),maxSize:i,disabled:l,useFsAccessApi:!1,children:({getRootProps:n,getInputProps:p})=>{const h=p({multiple:s||!!r});return a.jsxs(M,{...n(),"data-testid":"stFileUploaderDropzone",isDisabled:l,"aria-label":o,"aria-disabled":l,children:[a.jsx("input",{"data-testid":"stFileUploaderDropzoneInput",...h,...r&&{webkitdirectory:""}}),a.jsx(Se,{multiple:s,acceptedExtensions:t,maxSizeBytes:i,acceptDirectory:r,disabled:l}),a.jsx(me,{children:a.jsx(u,{kind:x.SECONDARY,disabled:l,size:Z.SMALL,children:r?"Browse directories":"Browse files"})})]})}}),je=d.memo(Fe),H=c("small",{target:"e1bju1570"})(({kind:e,disabled:s,theme:t})=>{const{redTextColor:i,fadedText60:l,fadedText40:o}=t.colors;let r=l;return s&&(r=o),e==="danger"&&(r=i),{color:r,fontSize:t.fontSizes.sm,lineHeight:t.lineHeights.tight}},""),ze=({fileInfo:e,disabled:s})=>e.status.type==="uploading"?a.jsx(ne,{value:e.status.progress,size:de.SMALL}):e.status.type==="error"?a.jsxs(T,{children:[a.jsx(ue,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),a.jsx(k,{children:a.jsx(m,{content:C,size:"lg"})})]}):e.status.type==="uploaded"?a.jsx(H,{disabled:s,children:z(e.size,w.Byte)}):null,Ue=({fileInfo:e,onDelete:s,disabled:t})=>a.jsxs(R,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[a.jsx(xe,{disabled:t,children:a.jsx(m,{content:re,size:"twoXL"})}),a.jsxs(V,{className:"stFileUploaderFileData",children:[a.jsx(A,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,disabled:t,children:e.name}),a.jsx(ze,{fileInfo:e,disabled:t})]}),a.jsx("div",{"data-testid":"stFileUploaderDeleteBtn",children:a.jsx(u,{onClick:()=>s(e.id),kind:x.MINIMAL,disabled:t,"aria-label":`Remove ${e.name}`,children:a.jsx(m,{content:oe,size:"lg"})})})]}),ve=d.memo(Ue),Ie=c("div",{target:"e1nlpozb1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS}),""),Ce=c("div",{target:"e1nlpozb0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40}),""),Me=({currentPage:e,totalPages:s,onNext:t,onPrevious:i})=>a.jsxs(Ie,{"data-testid":"stFileUploaderPagination",children:[a.jsx(H,{children:`Showing page ${e} of ${s}`}),a.jsxs(Ce,{children:[a.jsx(u,{onClick:i,kind:x.MINIMAL,children:a.jsx(m,{content:U,size:"xl"})}),a.jsx(u,{onClick:t,kind:x.MINIMAL,children:a.jsx(m,{content:v,size:"xl"})})]})]}),Be=d.memo(Me),j=(e,s)=>Math.ceil(e.length/s),De=e=>ee(({pageSize:s,items:t,resetOnAdd:i,...l})=>{const[o,r]=d.useState(0),[n,p]=d.useState(()=>j(t,s)),h=ce(t);d.useEffect(()=>{h&&h.length!==t.length&&p(j(t,s)),h&&h.length<t.length?i&&r(0):o+1>=n&&r(n-1)},[t,o,s,h,i,n]);const S=()=>{r(Math.min(o+1,n-1))},N=()=>{r(Math.max(0,o-1))},P=t.slice(o*s,o*s+s);return a.jsxs(a.Fragment,{children:[a.jsx(e,{items:P,...l}),t.length>s?a.jsx(Be,{pageSize:s,totalPages:n,currentPage:o+1,onNext:S,onPrevious:N}):null]})},e),Ee=({items:e,onDelete:s,disabled:t})=>a.jsx(fe,{children:e.map(i=>a.jsx(L,{children:a.jsx(ve,{fileInfo:i,onDelete:s,disabled:t})},i.id))}),Le=De(Ee),Ve=e=>a.jsx(E,{children:a.jsx(Le,{...e})}),Ae=d.memo(Ve);class Re extends d.PureComponent{constructor(s){super(s),this.formClearHelper=new te,this.localFileIdCounter=1,this.forceUpdatingStatus=!1,this.componentDidUpdate=()=>{if(this.status!=="ready")return;const t=this.createWidgetValue(),{element:i,widgetMgr:l,fragmentId:o}=this.props,r=l.getFileUploaderStateValue(i);$(t,r)||l.setFileUploaderStateValue(i,t,{fromUi:!0},o)},this.isFileTypeAllowed=t=>{const{element:i}=this.props,{type:l}=i;if(!l||l.length===0)return!0;const o=t.name.toLowerCase();return l.some(r=>o.endsWith(r.toLowerCase()))},this.filterDirectoryFiles=t=>{const i=[],l=[];return t.forEach(o=>{this.isFileTypeAllowed(o)?i.push(o):l.push({file:o,errors:[{code:"file-invalid-type",message:`${o.type} files are not allowed.`}]})}),{accepted:i,rejected:l}},this.dropHandler=(t,i)=>{const{element:l}=this.props,{multipleFiles:o}=l;if(l.acceptDirectory&&t.length>0){const{accepted:r,rejected:n}=this.filterDirectoryFiles(t);t=r,i=[...i,...n]}if(!o&&t.length===0&&i.length>1){const r=i.findIndex(n=>n.errors.length===1&&n.errors[0].code==="too-many-files");r>=0&&(t.push(i[r].file),i.splice(r,1))}if(this.props.uploadClient.fetchFileURLs(t).then(r=>{if(!o&&t.length>0){const n=this.state.files.find(p=>p.status.type!=="error");n&&(this.forceUpdatingStatus=!0,this.deleteFile(n.id),this.forceUpdatingStatus=!1)}O(r,t).forEach(([n,p])=>{this.uploadFile(n,p)})}).catch(r=>{this.addFiles(t.map(n=>new F(n.name,n.size,this.nextLocalFileId(),{type:"error",errorMessage:r})))}),i.length>0){const r=i.map(n=>ie(n,this.nextLocalFileId(),this.maxUploadSizeInBytes));this.addFiles(r)}},this.uploadFile=(t,i)=>{const l=new AbortController,o=i.webkitRelativePath||i.name,r=new F(o,i.size,this.nextLocalFileId(),{type:"uploading",abortController:l,progress:1});this.addFile(r),this.props.uploadClient.uploadFile(this.props.element,t.uploadUrl,i,n=>this.onUploadProgress(n,r.id),l.signal).then(()=>this.onUploadComplete(r.id,t)).catch(n=>{n instanceof DOMException&&n.name==="AbortError"||this.updateFile(r.id,r.setStatus({type:"error",errorMessage:n?n.toString():"Unknown error"}))})},this.onUploadComplete=(t,i)=>{const l=this.getFile(t);g(l)||l.status.type!=="uploading"||this.updateFile(l.id,l.setStatus({type:"uploaded",fileId:i.fileId,fileUrls:i}))},this.deleteFile=t=>{if(this.props.disabled)return;const i=this.getFile(t);g(i)||(i.status.type==="uploading"&&i.status.abortController.abort(),i.status.type==="uploaded"&&i.status.fileUrls.deleteUrl&&this.props.uploadClient.deleteFile(i.status.fileUrls.deleteUrl),this.removeFile(t))},this.addFile=t=>{f.flushSync(()=>{this.setState(i=>({files:[...i.files,t]}))})},this.addFiles=t=>{f.flushSync(()=>{this.setState(i=>({files:[...i.files,...t]}))})},this.removeFile=t=>{f.flushSync(()=>{this.setState(i=>({files:i.files.filter(l=>l.id!==t)}))})},this.getFile=t=>this.state.files.find(i=>i.id===t),this.updateFile=(t,i)=>{f.flushSync(()=>{this.setState(l=>({files:l.files.map(o=>o.id===t?i:o)}))})},this.onUploadProgress=(t,i)=>{const l=this.getFile(i);if(g(l)||l.status.type!=="uploading")return;const o=Math.round(t.loaded*100/t.total);l.status.progress!==o&&this.updateFile(i,l.setStatus({type:"uploading",abortController:l.status.abortController,progress:o}))},this.onFormCleared=()=>{f.flushSync(()=>{this.setState({files:[]},()=>{const t=this.createWidgetValue();if(g(t))return;const{widgetMgr:i,element:l,fragmentId:o}=this.props;i.setFileUploaderStateValue(l,t,{fromUi:!0},o)})})},this.state=this.initialValue}get initialValue(){const s={files:[]},{widgetMgr:t,element:i}=this.props,l=t.getFileUploaderStateValue(i);if(g(l))return s;const{uploadedFileInfo:o}=l;return g(o)||o.length===0?s:{files:o.map(r=>{const n=r.name,p=r.size,h=r.fileId,S=r.fileUrls;return new F(n,p,this.nextLocalFileId(),{type:"uploaded",fileId:h,fileUrls:S})})}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){const s=this.props.element.maxUploadSizeMb;return se(s,w.Megabyte,w.Byte)}get status(){const s=t=>t.status.type==="uploading";return this.state.files.some(s)||this.forceUpdatingStatus?"updating":"ready"}componentDidMount(){const s=this.createWidgetValue(),{element:t,widgetMgr:i,fragmentId:l}=this.props;i.getFileUploaderStateValue(t)===void 0&&i.setFileUploaderStateValue(t,s,{fromUi:!1},l)}createWidgetValue(){const s=this.state.files.filter(t=>t.status.type==="uploaded").map(t=>{const{name:i,size:l,status:o}=t,{fileId:r,fileUrls:n}=o;return new X({fileId:r,fileUrls:n,name:i,size:l})});return new q({uploadedFileInfo:s})}render(){const{files:s}=this.state,{element:t,disabled:i,widgetMgr:l,width:o}=this.props,r=t.type;this.formClearHelper.manageFormClearListener(l,t.formId,this.onFormCleared);const n=s.slice().reverse();return a.jsxs(be,{className:"stFileUploader","data-testid":"stFileUploader",width:o,children:[a.jsx(_,{label:t.label,disabled:i,labelVisibility:G(t.labelVisibility?.value),children:t.help&&a.jsx(K,{children:a.jsx(Y,{content:t.help,placement:J.TOP_RIGHT})})}),a.jsx(je,{onDrop:this.dropHandler,multiple:t.multipleFiles,acceptedExtensions:r,maxSizeBytes:this.maxUploadSizeInBytes,label:t.label,disabled:i,acceptDirectory:!!t.acceptDirectory}),n.length>0&&a.jsx(Ae,{items:n,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0,disabled:i})]})}nextLocalFileId(){return this.localFileIdCounter++}}const $e=W(d.memo(Re));export{$e as default};
